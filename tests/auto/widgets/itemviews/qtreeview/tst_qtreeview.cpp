begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2014 Digia Plc and/or its subsidiary(-ies). ** Contact: http://www.qt-project.org/legal ** ** This file is part of the test suite of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL21$ ** Commercial License Usage ** Licensees holding valid commercial Qt licenses may use this file in ** accordance with the commercial license agreement provided with the ** Software or, alternatively, in accordance with the terms contained in ** a written agreement between you and Digia. For licensing terms and ** conditions see http://qt.digia.com/licensing. For further information ** use the contact form at http://qt.digia.com/contact-us. ** ** GNU Lesser General Public License Usage ** Alternatively, this file may be used under the terms of the GNU Lesser ** General Public License version 2.1 or version 3 as published by the Free ** Software Foundation and appearing in the file LICENSE.LGPLv21 and ** LICENSE.LGPLv3 included in the packaging of this file. Please review the ** following information to ensure the GNU Lesser General Public License ** requirements will be met: https://www.gnu.org/licenses/lgpl.html and ** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html. ** ** In addition, as a special exception, Digia gives you certain additional ** rights. These rights are described in the Digia Qt LGPL Exception ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package. ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_include
include|#
directive|include
file|"../../../../shared/fakedirmodel.h"
end_include
begin_include
include|#
directive|include
file|<qabstractitemview.h>
end_include
begin_include
include|#
directive|include
file|<QtTest/QtTest>
end_include
begin_include
include|#
directive|include
file|<QtGui/QtGui>
end_include
begin_include
include|#
directive|include
file|<QtWidgets/QtWidgets>
end_include
begin_include
include|#
directive|include
file|<private/qabstractitemview_p.h>
end_include
begin_ifndef
ifndef|#
directive|ifndef
name|QT_NO_DRAGANDDROP
end_ifndef
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QAbstractItemView::DragDropMode
argument_list|)
end_macro
begin_endif
endif|#
directive|endif
end_endif
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QAbstractItemView::EditTriggers
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QAbstractItemView::EditTrigger
argument_list|)
end_macro
begin_function
DECL|function|initStandardTreeModel
specifier|static
name|void
name|initStandardTreeModel
parameter_list|(
name|QStandardItemModel
modifier|*
name|model
parameter_list|)
block|{
name|QStandardItem
modifier|*
name|item
decl_stmt|;
name|item
operator|=
operator|new
name|QStandardItem
argument_list|(
name|QLatin1String
argument_list|(
literal|"Row 1 Item"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|->
name|insertRow
argument_list|(
literal|0
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|item
operator|=
operator|new
name|QStandardItem
argument_list|(
name|QLatin1String
argument_list|(
literal|"Row 2 Item"
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setCheckable
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|model
operator|->
name|insertRow
argument_list|(
literal|1
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QStandardItem
modifier|*
name|childItem
init|=
operator|new
name|QStandardItem
argument_list|(
name|QLatin1String
argument_list|(
literal|"Row 2 Child Item"
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setChild
argument_list|(
literal|0
argument_list|,
name|childItem
argument_list|)
expr_stmt|;
name|item
operator|=
operator|new
name|QStandardItem
argument_list|(
name|QLatin1String
argument_list|(
literal|"Row 3 Item"
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setIcon
argument_list|(
name|QIcon
argument_list|()
argument_list|)
expr_stmt|;
name|model
operator|->
name|insertRow
argument_list|(
literal|2
argument_list|,
name|item
argument_list|)
expr_stmt|;
block|}
end_function
begin_class_decl
class_decl|class
name|tst_QTreeView
class_decl|;
end_class_decl
begin_struct
DECL|struct|PublicView
struct|struct
name|PublicView
super|:
specifier|public
name|QTreeView
block|{
friend|friend
class_decl|class
name|tst_QTreeView
class_decl|;
DECL|function|executeDelayedItemsLayout
specifier|inline
name|void
name|executeDelayedItemsLayout
parameter_list|()
block|{
name|QTreeView
operator|::
name|executeDelayedItemsLayout
argument_list|()
expr_stmt|;
block|}
DECL|enum|PublicCursorAction
enum|enum
name|PublicCursorAction
block|{
DECL|enumerator|MoveUp
name|MoveUp
init|=
name|QAbstractItemView
operator|::
name|MoveUp
block|,
DECL|enumerator|MoveDown
name|MoveDown
init|=
name|QAbstractItemView
operator|::
name|MoveDown
block|,
DECL|enumerator|MoveLeft
name|MoveLeft
init|=
name|QAbstractItemView
operator|::
name|MoveLeft
block|,
DECL|enumerator|MoveRight
name|MoveRight
init|=
name|QAbstractItemView
operator|::
name|MoveRight
block|,
DECL|enumerator|MoveHome
name|MoveHome
init|=
name|QAbstractItemView
operator|::
name|MoveHome
block|,
DECL|enumerator|MoveEnd
name|MoveEnd
init|=
name|QAbstractItemView
operator|::
name|MoveEnd
block|,
DECL|enumerator|MovePageUp
name|MovePageUp
init|=
name|QAbstractItemView
operator|::
name|MovePageUp
block|,
DECL|enumerator|MovePageDown
name|MovePageDown
init|=
name|QAbstractItemView
operator|::
name|MovePageDown
block|,
DECL|enumerator|MoveNext
name|MoveNext
init|=
name|QAbstractItemView
operator|::
name|MoveNext
block|,
DECL|enumerator|MovePrevious
name|MovePrevious
init|=
name|QAbstractItemView
operator|::
name|MovePrevious
block|}
enum|;
comment|// enum PublicCursorAction and moveCursor() are protected in QTreeView.
DECL|function|doMoveCursor
specifier|inline
name|QModelIndex
name|doMoveCursor
parameter_list|(
name|PublicCursorAction
name|ca
parameter_list|,
name|Qt
operator|::
name|KeyboardModifiers
name|kbm
parameter_list|)
block|{
return|return
name|QTreeView
operator|::
name|moveCursor
argument_list|(
operator|(
name|CursorAction
operator|)
name|ca
argument_list|,
name|kbm
argument_list|)
return|;
block|}
DECL|function|setSelection
specifier|inline
name|void
name|setSelection
parameter_list|(
specifier|const
name|QRect
modifier|&
name|rect
parameter_list|,
name|QItemSelectionModel
operator|::
name|SelectionFlags
name|command
parameter_list|)
block|{
name|QTreeView
operator|::
name|setSelection
argument_list|(
name|rect
argument_list|,
name|command
argument_list|)
expr_stmt|;
block|}
DECL|function|state
specifier|inline
name|int
name|state
parameter_list|()
block|{
return|return
name|QTreeView
operator|::
name|state
argument_list|()
return|;
block|}
DECL|function|rowHeight
specifier|inline
name|int
name|rowHeight
parameter_list|(
name|QModelIndex
name|idx
parameter_list|)
block|{
return|return
name|QTreeView
operator|::
name|rowHeight
argument_list|(
name|idx
argument_list|)
return|;
block|}
DECL|function|indexRowSizeHint
specifier|inline
name|int
name|indexRowSizeHint
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|index
parameter_list|)
specifier|const
block|{
return|return
name|QTreeView
operator|::
name|indexRowSizeHint
argument_list|(
name|index
argument_list|)
return|;
block|}
DECL|function|selectedIndexes
specifier|inline
name|QModelIndexList
name|selectedIndexes
parameter_list|()
specifier|const
block|{
return|return
name|QTreeView
operator|::
name|selectedIndexes
argument_list|()
return|;
block|}
DECL|function|viewOptions
specifier|inline
name|QStyleOptionViewItem
name|viewOptions
parameter_list|()
specifier|const
block|{
return|return
name|QTreeView
operator|::
name|viewOptions
argument_list|()
return|;
block|}
DECL|function|sizeHintForColumn
specifier|inline
name|int
name|sizeHintForColumn
parameter_list|(
name|int
name|column
parameter_list|)
specifier|const
block|{
return|return
name|QTreeView
operator|::
name|sizeHintForColumn
argument_list|(
name|column
argument_list|)
return|;
block|}
DECL|function|aiv_priv
name|QAbstractItemViewPrivate
modifier|*
name|aiv_priv
parameter_list|()
block|{
return|return
cast|static_cast
argument_list|<
name|QAbstractItemViewPrivate
operator|*
argument_list|>
argument_list|(
name|d_ptr
operator|.
name|data
argument_list|()
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_comment
comment|// Make a widget frameless to prevent size constraints of title bars
end_comment
begin_comment
comment|// from interfering (Windows).
end_comment
begin_function
DECL|function|setFrameless
specifier|static
specifier|inline
name|void
name|setFrameless
parameter_list|(
name|QWidget
modifier|*
name|w
parameter_list|)
block|{
name|Qt
operator|::
name|WindowFlags
name|flags
init|=
name|w
operator|->
name|windowFlags
argument_list|()
decl_stmt|;
name|flags
operator||=
name|Qt
operator|::
name|FramelessWindowHint
expr_stmt|;
name|flags
operator|&=
operator|~
operator|(
name|Qt
operator|::
name|WindowTitleHint
operator||
name|Qt
operator|::
name|WindowSystemMenuHint
operator||
name|Qt
operator|::
name|WindowMinMaxButtonsHint
operator||
name|Qt
operator|::
name|WindowCloseButtonHint
operator|)
expr_stmt|;
name|w
operator|->
name|setWindowFlags
argument_list|(
name|flags
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|tst_QTreeView
class|class
name|tst_QTreeView
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
public|public:
name|tst_QTreeView
parameter_list|()
constructor_decl|;
specifier|virtual
name|~
name|tst_QTreeView
parameter_list|()
destructor_decl|;
public|public
name|slots
public|:
name|void
name|initTestCase
parameter_list|()
function_decl|;
name|void
name|cleanupTestCase
parameter_list|()
function_decl|;
name|void
name|init
parameter_list|()
function_decl|;
name|void
name|cleanup
parameter_list|()
function_decl|;
name|void
name|selectionOrderTest
parameter_list|()
function_decl|;
private|private
name|slots
private|:
name|void
name|getSetCheck
parameter_list|()
function_decl|;
comment|// one test per QTreeView property
name|void
name|construction
parameter_list|()
function_decl|;
name|void
name|alternatingRowColors
parameter_list|()
function_decl|;
name|void
name|currentIndex_data
parameter_list|()
function_decl|;
name|void
name|currentIndex
parameter_list|()
function_decl|;
ifndef|#
directive|ifndef
name|QT_NO_DRAGANDDROP
name|void
name|dragDropMode_data
parameter_list|()
function_decl|;
name|void
name|dragDropMode
parameter_list|()
function_decl|;
name|void
name|dragDropModeFromDragEnabledAndAcceptDrops_data
parameter_list|()
function_decl|;
name|void
name|dragDropModeFromDragEnabledAndAcceptDrops
parameter_list|()
function_decl|;
name|void
name|dragDropOverwriteMode
parameter_list|()
function_decl|;
endif|#
directive|endif
name|void
name|editTriggers_data
parameter_list|()
function_decl|;
name|void
name|editTriggers
parameter_list|()
function_decl|;
name|void
name|hasAutoScroll
parameter_list|()
function_decl|;
name|void
name|horizontalScrollMode
parameter_list|()
function_decl|;
name|void
name|iconSize
parameter_list|()
function_decl|;
name|void
name|indexAt
parameter_list|()
function_decl|;
name|void
name|indexWidget
parameter_list|()
function_decl|;
name|void
name|itemDelegate
parameter_list|()
function_decl|;
name|void
name|itemDelegateForColumnOrRow
parameter_list|()
function_decl|;
name|void
name|keyboardSearch
parameter_list|()
function_decl|;
name|void
name|keyboardSearchMultiColumn
parameter_list|()
function_decl|;
name|void
name|setModel
parameter_list|()
function_decl|;
name|void
name|openPersistentEditor
parameter_list|()
function_decl|;
name|void
name|rootIndex
parameter_list|()
function_decl|;
comment|// specialized tests below
name|void
name|setHeader
parameter_list|()
function_decl|;
name|void
name|columnHidden
parameter_list|()
function_decl|;
name|void
name|rowHidden
parameter_list|()
function_decl|;
name|void
name|noDelegate
parameter_list|()
function_decl|;
name|void
name|noModel
parameter_list|()
function_decl|;
name|void
name|emptyModel
parameter_list|()
function_decl|;
name|void
name|removeRows
parameter_list|()
function_decl|;
name|void
name|removeCols
parameter_list|()
function_decl|;
name|void
name|limitedExpand
parameter_list|()
function_decl|;
name|void
name|expandAndCollapse_data
parameter_list|()
function_decl|;
name|void
name|expandAndCollapse
parameter_list|()
function_decl|;
name|void
name|expandAndCollapseAll
parameter_list|()
function_decl|;
name|void
name|expandWithNoChildren
parameter_list|()
function_decl|;
ifndef|#
directive|ifndef
name|QT_NO_ANIMATION
name|void
name|quickExpandCollapse
parameter_list|()
function_decl|;
endif|#
directive|endif
name|void
name|keyboardNavigation
parameter_list|()
function_decl|;
name|void
name|headerSections
parameter_list|()
function_decl|;
name|void
name|moveCursor_data
parameter_list|()
function_decl|;
name|void
name|moveCursor
parameter_list|()
function_decl|;
name|void
name|setSelection_data
parameter_list|()
function_decl|;
name|void
name|setSelection
parameter_list|()
function_decl|;
name|void
name|extendedSelection_data
parameter_list|()
function_decl|;
name|void
name|extendedSelection
parameter_list|()
function_decl|;
name|void
name|indexAbove
parameter_list|()
function_decl|;
name|void
name|indexBelow
parameter_list|()
function_decl|;
name|void
name|clicked
parameter_list|()
function_decl|;
name|void
name|mouseDoubleClick
parameter_list|()
function_decl|;
name|void
name|rowsAboutToBeRemoved
parameter_list|()
function_decl|;
name|void
name|headerSections_unhideSection
parameter_list|()
function_decl|;
name|void
name|columnAt
parameter_list|()
function_decl|;
name|void
name|scrollTo
parameter_list|()
function_decl|;
name|void
name|rowsAboutToBeRemoved_move
parameter_list|()
function_decl|;
name|void
name|resizeColumnToContents
parameter_list|()
function_decl|;
name|void
name|insertAfterSelect
parameter_list|()
function_decl|;
name|void
name|removeAfterSelect
parameter_list|()
function_decl|;
name|void
name|hiddenItems
parameter_list|()
function_decl|;
name|void
name|spanningItems
parameter_list|()
function_decl|;
name|void
name|rowSizeHint
parameter_list|()
function_decl|;
name|void
name|setSortingEnabled
parameter_list|()
function_decl|;
name|void
name|headerHidden
parameter_list|()
function_decl|;
name|void
name|indentation
parameter_list|()
function_decl|;
name|void
name|selection
parameter_list|()
function_decl|;
name|void
name|removeAndInsertExpandedCol0
parameter_list|()
function_decl|;
name|void
name|selectionWithHiddenItems
parameter_list|()
function_decl|;
name|void
name|selectAll
parameter_list|()
function_decl|;
name|void
name|disabledButCheckable
parameter_list|()
function_decl|;
name|void
name|sortByColumn_data
parameter_list|()
function_decl|;
name|void
name|sortByColumn
parameter_list|()
function_decl|;
name|void
name|evilModel_data
parameter_list|()
function_decl|;
name|void
name|evilModel
parameter_list|()
function_decl|;
name|void
name|indexRowSizeHint
parameter_list|()
function_decl|;
name|void
name|addRowsWhileSectionsAreHidden
parameter_list|()
function_decl|;
name|void
name|filterProxyModelCrash
parameter_list|()
function_decl|;
name|void
name|renderToPixmap_data
parameter_list|()
function_decl|;
name|void
name|renderToPixmap
parameter_list|()
function_decl|;
name|void
name|styleOptionViewItem
parameter_list|()
function_decl|;
name|void
name|keyboardNavigationWithDisabled
parameter_list|()
function_decl|;
comment|// task-specific tests:
name|void
name|task174627_moveLeftToRoot
parameter_list|()
function_decl|;
name|void
name|task171902_expandWith1stColHidden
parameter_list|()
function_decl|;
name|void
name|task203696_hidingColumnsAndRowsn
parameter_list|()
function_decl|;
name|void
name|task211293_removeRootIndex
parameter_list|()
function_decl|;
name|void
name|task216717_updateChildren
parameter_list|()
function_decl|;
name|void
name|task220298_selectColumns
parameter_list|()
function_decl|;
name|void
name|task224091_appendColumns
parameter_list|()
function_decl|;
name|void
name|task225539_deleteModel
parameter_list|()
function_decl|;
name|void
name|task230123_setItemsExpandable
parameter_list|()
function_decl|;
name|void
name|task202039_closePersistentEditor
parameter_list|()
function_decl|;
name|void
name|task238873_avoidAutoReopening
parameter_list|()
function_decl|;
name|void
name|task244304_clickOnDecoration
parameter_list|()
function_decl|;
name|void
name|task246536_scrollbarsNotWorking
parameter_list|()
function_decl|;
name|void
name|task250683_wrongSectionSize
parameter_list|()
function_decl|;
name|void
name|task239271_addRowsWithFirstColumnHidden
parameter_list|()
function_decl|;
name|void
name|task254234_proxySort
parameter_list|()
function_decl|;
name|void
name|task248022_changeSelection
parameter_list|()
function_decl|;
name|void
name|task245654_changeModelAndExpandAll
parameter_list|()
function_decl|;
name|void
name|doubleClickedWithSpans
parameter_list|()
function_decl|;
name|void
name|taskQTBUG_6450_selectAllWith1stColumnHidden
parameter_list|()
function_decl|;
name|void
name|taskQTBUG_9216_setSizeAndUniformRowHeightsWrongRepaint
parameter_list|()
function_decl|;
name|void
name|taskQTBUG_11466_keyboardNavigationRegression
parameter_list|()
function_decl|;
name|void
name|taskQTBUG_13567_removeLastItemRegression
parameter_list|()
function_decl|;
name|void
name|taskQTBUG_25333_adjustViewOptionsForIndex
parameter_list|()
function_decl|;
name|void
name|taskQTBUG_18539_emitLayoutChanged
parameter_list|()
function_decl|;
name|void
name|taskQTBUG_8176_emitOnExpandAll
parameter_list|()
function_decl|;
name|void
name|taskQTBUG_34717_collapseAtBottom
parameter_list|()
function_decl|;
name|void
name|taskQTBUG_37813_crash
parameter_list|()
function_decl|;
name|void
name|testInitialFocus
parameter_list|()
function_decl|;
block|}
class|;
end_class
begin_class
DECL|class|QtTestModel
class|class
name|QtTestModel
super|:
specifier|public
name|QAbstractItemModel
block|{
public|public:
DECL|function|QtTestModel
name|QtTestModel
parameter_list|(
name|QObject
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QAbstractItemModel
argument_list|(
name|parent
argument_list|)
member_init_list|,
name|fetched
argument_list|(
literal|false
argument_list|)
member_init_list|,
name|rows
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|cols
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|levels
argument_list|(
name|INT_MAX
argument_list|)
member_init_list|,
name|wrongIndex
argument_list|(
literal|false
argument_list|)
block|{
name|init
argument_list|()
expr_stmt|;
block|}
DECL|function|QtTestModel
name|QtTestModel
parameter_list|(
name|int
name|_rows
parameter_list|,
name|int
name|_cols
parameter_list|,
name|QObject
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QAbstractItemModel
argument_list|(
name|parent
argument_list|)
member_init_list|,
name|fetched
argument_list|(
literal|false
argument_list|)
member_init_list|,
name|rows
argument_list|(
name|_rows
argument_list|)
member_init_list|,
name|cols
argument_list|(
name|_cols
argument_list|)
member_init_list|,
name|levels
argument_list|(
name|INT_MAX
argument_list|)
member_init_list|,
name|wrongIndex
argument_list|(
literal|false
argument_list|)
block|{
name|init
argument_list|()
expr_stmt|;
block|}
DECL|function|init
name|void
name|init
parameter_list|()
block|{
name|decorationsEnabled
operator|=
literal|false
expr_stmt|;
block|}
DECL|function|level
specifier|inline
name|qint32
name|level
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|index
parameter_list|)
specifier|const
block|{
return|return
name|index
operator|.
name|isValid
argument_list|()
condition|?
name|qint32
argument_list|(
name|index
operator|.
name|internalId
argument_list|()
argument_list|)
else|:
name|qint32
argument_list|(
operator|-
literal|1
argument_list|)
return|;
block|}
DECL|function|canFetchMore
name|bool
name|canFetchMore
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
parameter_list|)
specifier|const
block|{
return|return
operator|!
name|fetched
return|;
block|}
DECL|function|fetchMore
name|void
name|fetchMore
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
parameter_list|)
block|{
name|fetched
operator|=
literal|true
expr_stmt|;
block|}
DECL|function|hasChildren
name|bool
name|hasChildren
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|parent
init|=
name|QModelIndex
argument_list|()
parameter_list|)
specifier|const
block|{
name|bool
name|hasFetched
init|=
name|fetched
decl_stmt|;
name|fetched
operator|=
literal|true
expr_stmt|;
name|bool
name|r
init|=
name|QAbstractItemModel
operator|::
name|hasChildren
argument_list|(
name|parent
argument_list|)
decl_stmt|;
name|fetched
operator|=
name|hasFetched
expr_stmt|;
return|return
name|r
return|;
block|}
DECL|function|rowCount
name|int
name|rowCount
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|parent
init|=
name|QModelIndex
argument_list|()
parameter_list|)
specifier|const
block|{
if|if
condition|(
operator|!
name|fetched
condition|)
name|qFatal
argument_list|(
literal|"%s: rowCount should not be called before fetching"
argument_list|,
name|Q_FUNC_INFO
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|parent
operator|.
name|column
argument_list|()
operator|>
literal|0
operator|)
operator|||
operator|(
name|level
argument_list|(
name|parent
argument_list|)
operator|>
name|levels
operator|)
condition|)
return|return
literal|0
return|;
return|return
name|rows
return|;
block|}
DECL|function|columnCount
name|int
name|columnCount
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|parent
init|=
name|QModelIndex
argument_list|()
parameter_list|)
specifier|const
block|{
if|if
condition|(
operator|(
name|parent
operator|.
name|column
argument_list|()
operator|>
literal|0
operator|)
operator|||
operator|(
name|level
argument_list|(
name|parent
argument_list|)
operator|>
name|levels
operator|)
condition|)
return|return
literal|0
return|;
return|return
name|cols
return|;
block|}
DECL|function|isEditable
name|bool
name|isEditable
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|index
parameter_list|)
specifier|const
block|{
if|if
condition|(
name|index
operator|.
name|isValid
argument_list|()
condition|)
return|return
literal|true
return|;
return|return
literal|false
return|;
block|}
DECL|function|index
name|QModelIndex
name|index
parameter_list|(
name|int
name|row
parameter_list|,
name|int
name|column
parameter_list|,
specifier|const
name|QModelIndex
modifier|&
name|parent
init|=
name|QModelIndex
argument_list|()
parameter_list|)
specifier|const
block|{
if|if
condition|(
name|row
operator|<
literal|0
operator|||
name|column
operator|<
literal|0
operator|||
operator|(
name|level
argument_list|(
name|parent
argument_list|)
operator|>
name|levels
operator|)
operator|||
name|column
operator|>=
name|cols
operator|||
name|row
operator|>=
name|rows
condition|)
block|{
return|return
name|QModelIndex
argument_list|()
return|;
block|}
name|QModelIndex
name|i
init|=
name|createIndex
argument_list|(
name|row
argument_list|,
name|column
argument_list|,
name|level
argument_list|(
name|parent
argument_list|)
operator|+
literal|1
argument_list|)
decl_stmt|;
name|parentHash
index|[
name|i
index|]
operator|=
name|parent
expr_stmt|;
return|return
name|i
return|;
block|}
DECL|function|parent
name|QModelIndex
name|parent
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|index
parameter_list|)
specifier|const
block|{
if|if
condition|(
operator|!
name|parentHash
operator|.
name|contains
argument_list|(
name|index
argument_list|)
condition|)
return|return
name|QModelIndex
argument_list|()
return|;
return|return
name|parentHash
index|[
name|index
index|]
return|;
block|}
DECL|function|data
name|QVariant
name|data
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|idx
parameter_list|,
name|int
name|role
parameter_list|)
specifier|const
block|{
if|if
condition|(
operator|!
name|idx
operator|.
name|isValid
argument_list|()
condition|)
return|return
name|QVariant
argument_list|()
return|;
if|if
condition|(
name|role
operator|==
name|Qt
operator|::
name|DisplayRole
condition|)
block|{
if|if
condition|(
name|idx
operator|.
name|row
argument_list|()
operator|<
literal|0
operator|||
name|idx
operator|.
name|column
argument_list|()
operator|<
literal|0
operator|||
name|idx
operator|.
name|column
argument_list|()
operator|>=
name|cols
operator|||
name|idx
operator|.
name|row
argument_list|()
operator|>=
name|rows
condition|)
block|{
name|wrongIndex
operator|=
literal|true
expr_stmt|;
name|qWarning
argument_list|(
literal|"Invalid modelIndex [%d,%d,%p]"
argument_list|,
name|idx
operator|.
name|row
argument_list|()
argument_list|,
name|idx
operator|.
name|column
argument_list|()
argument_list|,
name|idx
operator|.
name|internalPointer
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|idx
operator|.
name|row
argument_list|()
operator|&
literal|1
condition|)
return|return
name|QString
argument_list|(
literal|"[%1,%2,%3] - this item is extra wide"
argument_list|)
operator|.
name|arg
argument_list|(
name|idx
operator|.
name|row
argument_list|()
argument_list|)
operator|.
name|arg
argument_list|(
name|idx
operator|.
name|column
argument_list|()
argument_list|)
operator|.
name|arg
argument_list|(
name|level
argument_list|(
name|idx
argument_list|)
argument_list|)
return|;
return|return
name|QString
argument_list|(
literal|"[%1,%2,%3]"
argument_list|)
operator|.
name|arg
argument_list|(
name|idx
operator|.
name|row
argument_list|()
argument_list|)
operator|.
name|arg
argument_list|(
name|idx
operator|.
name|column
argument_list|()
argument_list|)
operator|.
name|arg
argument_list|(
name|level
argument_list|(
name|idx
argument_list|)
argument_list|)
return|;
block|}
if|if
condition|(
name|decorationsEnabled
operator|&&
name|role
operator|==
name|Qt
operator|::
name|DecorationRole
condition|)
block|{
name|QPixmap
name|pm
argument_list|(
literal|16
argument_list|,
literal|16
argument_list|)
decl_stmt|;
name|pm
operator|.
name|fill
argument_list|(
name|QColor
operator|::
name|fromHsv
argument_list|(
operator|(
name|idx
operator|.
name|column
argument_list|()
operator|%
literal|16
operator|)
operator|*
literal|8
operator|+
literal|64
argument_list|,
literal|254
argument_list|,
operator|(
name|idx
operator|.
name|row
argument_list|()
operator|%
literal|16
operator|)
operator|*
literal|8
operator|+
literal|32
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|pm
return|;
block|}
return|return
name|QVariant
argument_list|()
return|;
block|}
DECL|function|removeLastRow
name|void
name|removeLastRow
parameter_list|()
block|{
name|beginRemoveRows
argument_list|(
name|QModelIndex
argument_list|()
argument_list|,
name|rows
operator|-
literal|1
argument_list|,
name|rows
operator|-
literal|1
argument_list|)
expr_stmt|;
operator|--
name|rows
expr_stmt|;
name|endRemoveRows
argument_list|()
expr_stmt|;
block|}
DECL|function|removeAllRows
name|void
name|removeAllRows
parameter_list|()
block|{
name|beginRemoveRows
argument_list|(
name|QModelIndex
argument_list|()
argument_list|,
literal|0
argument_list|,
name|rows
operator|-
literal|1
argument_list|)
expr_stmt|;
name|rows
operator|=
literal|0
expr_stmt|;
name|endRemoveRows
argument_list|()
expr_stmt|;
block|}
DECL|function|removeLastColumn
name|void
name|removeLastColumn
parameter_list|()
block|{
name|beginRemoveColumns
argument_list|(
name|QModelIndex
argument_list|()
argument_list|,
name|cols
operator|-
literal|1
argument_list|,
name|cols
operator|-
literal|1
argument_list|)
expr_stmt|;
operator|--
name|cols
expr_stmt|;
name|endRemoveColumns
argument_list|()
expr_stmt|;
block|}
DECL|function|removeAllColumns
name|void
name|removeAllColumns
parameter_list|()
block|{
name|beginRemoveColumns
argument_list|(
name|QModelIndex
argument_list|()
argument_list|,
literal|0
argument_list|,
name|cols
operator|-
literal|1
argument_list|)
expr_stmt|;
name|cols
operator|=
literal|0
expr_stmt|;
name|endRemoveColumns
argument_list|()
expr_stmt|;
block|}
DECL|function|insertNewRow
name|void
name|insertNewRow
parameter_list|()
block|{
name|beginInsertRows
argument_list|(
name|QModelIndex
argument_list|()
argument_list|,
name|rows
operator|-
literal|1
argument_list|,
name|rows
operator|-
literal|1
argument_list|)
expr_stmt|;
operator|++
name|rows
expr_stmt|;
name|endInsertRows
argument_list|()
expr_stmt|;
block|}
DECL|function|setDecorationsEnabled
name|void
name|setDecorationsEnabled
parameter_list|(
name|bool
name|enable
parameter_list|)
block|{
name|decorationsEnabled
operator|=
name|enable
expr_stmt|;
block|}
DECL|member|fetched
specifier|mutable
name|bool
name|fetched
decl_stmt|;
DECL|member|decorationsEnabled
name|bool
name|decorationsEnabled
decl_stmt|;
DECL|member|rows
DECL|member|cols
name|int
name|rows
decl_stmt|,
name|cols
decl_stmt|;
DECL|member|levels
name|int
name|levels
decl_stmt|;
DECL|member|wrongIndex
specifier|mutable
name|bool
name|wrongIndex
decl_stmt|;
DECL|member|parentHash
specifier|mutable
name|QMap
argument_list|<
name|QModelIndex
argument_list|,
name|QModelIndex
argument_list|>
name|parentHash
decl_stmt|;
block|}
class|;
end_class
begin_constructor
DECL|function|tst_QTreeView
name|tst_QTreeView
operator|::
name|tst_QTreeView
parameter_list|()
block|{ }
end_constructor
begin_destructor
DECL|function|~tst_QTreeView
name|tst_QTreeView
operator|::
name|~
name|tst_QTreeView
parameter_list|()
block|{ }
end_destructor
begin_function
DECL|function|initTestCase
name|void
name|tst_QTreeView
operator|::
name|initTestCase
parameter_list|()
block|{
ifdef|#
directive|ifdef
name|Q_OS_WINCE
comment|//disable magic for WindowsCE
name|qApp
operator|->
name|setAutoMaximizeThreshold
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function
begin_function
DECL|function|cleanupTestCase
name|void
name|tst_QTreeView
operator|::
name|cleanupTestCase
parameter_list|()
block|{ }
end_function
begin_function
DECL|function|init
name|void
name|tst_QTreeView
operator|::
name|init
parameter_list|()
block|{ }
end_function
begin_function
DECL|function|cleanup
name|void
name|tst_QTreeView
operator|::
name|cleanup
parameter_list|()
block|{ }
end_function
begin_comment
comment|// Testing get/set functions
end_comment
begin_function
DECL|function|getSetCheck
name|void
name|tst_QTreeView
operator|::
name|getSetCheck
parameter_list|()
block|{
name|QTreeView
name|obj1
decl_stmt|;
comment|// int QTreeView::indentation()
comment|// void QTreeView::setIndentation(int)
specifier|const
name|int
name|styledIndentation
init|=
name|obj1
operator|.
name|style
argument_list|()
operator|->
name|pixelMetric
argument_list|(
name|QStyle
operator|::
name|PM_TreeViewIndentation
argument_list|,
literal|0
argument_list|,
operator|&
name|obj1
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|indentation
argument_list|()
argument_list|,
name|styledIndentation
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setIndentation
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|indentation
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setIndentation
argument_list|(
name|INT_MIN
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|indentation
argument_list|()
argument_list|,
name|INT_MIN
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setIndentation
argument_list|(
name|INT_MAX
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|indentation
argument_list|()
argument_list|,
name|INT_MAX
argument_list|)
expr_stmt|;
comment|// bool QTreeView::rootIsDecorated()
comment|// void QTreeView::setRootIsDecorated(bool)
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|rootIsDecorated
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setRootIsDecorated
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|rootIsDecorated
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setRootIsDecorated
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|rootIsDecorated
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
comment|// bool QTreeView::uniformRowHeights()
comment|// void QTreeView::setUniformRowHeights(bool)
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|uniformRowHeights
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setUniformRowHeights
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|uniformRowHeights
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setUniformRowHeights
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|uniformRowHeights
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
comment|// bool QTreeView::itemsExpandable()
comment|// void QTreeView::setItemsExpandable(bool)
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|itemsExpandable
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setItemsExpandable
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|itemsExpandable
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setItemsExpandable
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|itemsExpandable
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
comment|// bool QTreeView::allColumnsShowFocus
comment|// void QTreeView::setAllColumnsShowFocus
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|allColumnsShowFocus
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setAllColumnsShowFocus
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|allColumnsShowFocus
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setAllColumnsShowFocus
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|allColumnsShowFocus
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
comment|// bool QTreeView::isAnimated
comment|// void QTreeView::setAnimated
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|isAnimated
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setAnimated
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|isAnimated
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setAnimated
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|isAnimated
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
comment|// bool QTreeView::setSortingEnabled
comment|// void QTreeView::isSortingEnabled
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|isSortingEnabled
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setSortingEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|isSortingEnabled
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|isSortingEnabled
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|construction
name|void
name|tst_QTreeView
operator|::
name|construction
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
comment|// QAbstractItemView properties
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|alternatingRowColors
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|QT_NO_DRAGANDDROP
name|QCOMPARE
argument_list|(
name|view
operator|.
name|dragDropMode
argument_list|()
argument_list|,
name|QAbstractItemView
operator|::
name|NoDragDrop
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|dragDropOverwriteMode
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|dragEnabled
argument_list|()
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QCOMPARE
argument_list|(
name|view
operator|.
name|editTriggers
argument_list|()
argument_list|,
name|QAbstractItemView
operator|::
name|EditKeyPressed
operator||
name|QAbstractItemView
operator|::
name|DoubleClicked
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|hasAutoScroll
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollMode
argument_list|()
argument_list|,
name|QAbstractItemView
operator|::
name|ScrollPerPixel
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|iconSize
argument_list|()
argument_list|,
name|QSize
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indexAt
argument_list|(
name|QPoint
argument_list|()
argument_list|)
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|indexWidget
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qobject_cast
argument_list|<
name|QStyledItemDelegate
operator|*
argument_list|>
argument_list|(
name|view
operator|.
name|itemDelegate
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemDelegateForColumn
argument_list|(
operator|-
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemDelegateForColumn
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemDelegateForColumn
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemDelegateForRow
argument_list|(
operator|-
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemDelegateForRow
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemDelegateForRow
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|model
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|rootIndex
argument_list|()
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|selectionBehavior
argument_list|()
argument_list|,
name|QAbstractItemView
operator|::
name|SelectRows
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|selectionMode
argument_list|()
argument_list|,
name|QAbstractItemView
operator|::
name|SingleSelection
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|selectionModel
argument_list|()
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|QT_NO_DRAGANDDROP
name|QVERIFY
argument_list|(
name|view
operator|.
name|showDropIndicator
argument_list|()
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QCOMPARE
argument_list|(
name|view
operator|.
name|QAbstractItemView
operator|::
name|sizeHintForColumn
argument_list|(
operator|-
literal|1
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|//<- protected in QTreeView
name|QCOMPARE
argument_list|(
name|view
operator|.
name|QAbstractItemView
operator|::
name|sizeHintForColumn
argument_list|(
literal|0
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|//<- protected in QTreeView
name|QCOMPARE
argument_list|(
name|view
operator|.
name|QAbstractItemView
operator|::
name|sizeHintForColumn
argument_list|(
literal|1
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|//<- protected in QTreeView
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sizeHintForIndex
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
name|QSize
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sizeHintForRow
argument_list|(
operator|-
literal|1
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sizeHintForRow
argument_list|(
literal|0
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sizeHintForRow
argument_list|(
literal|1
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|tabKeyNavigation
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|textElideMode
argument_list|()
argument_list|,
name|Qt
operator|::
name|ElideRight
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|verticalScrollMode
argument_list|()
argument_list|,
name|QAbstractItemView
operator|::
name|ScrollPerItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|visualRect
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
name|QRect
argument_list|()
argument_list|)
expr_stmt|;
comment|// QTreeView properties
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|allColumnsShowFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|autoExpandDelay
argument_list|()
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|columnAt
argument_list|(
operator|-
literal|1
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|columnAt
argument_list|(
literal|0
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|columnAt
argument_list|(
literal|1
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|columnViewportPosition
argument_list|(
operator|-
literal|1
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|columnViewportPosition
argument_list|(
literal|0
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|columnViewportPosition
argument_list|(
literal|1
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|columnWidth
argument_list|(
operator|-
literal|1
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|columnWidth
argument_list|(
literal|0
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|columnWidth
argument_list|(
literal|1
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|header
argument_list|()
argument_list|)
expr_stmt|;
specifier|const
name|int
name|styledIndentation
init|=
name|view
operator|.
name|style
argument_list|()
operator|->
name|pixelMetric
argument_list|(
name|QStyle
operator|::
name|PM_TreeViewIndentation
argument_list|,
literal|0
argument_list|,
operator|&
name|view
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indentation
argument_list|()
argument_list|,
name|styledIndentation
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indexAbove
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indexBelow
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isAnimated
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isColumnHidden
argument_list|(
operator|-
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isColumnHidden
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isColumnHidden
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isExpanded
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isRowHidden
argument_list|(
operator|-
literal|1
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isRowHidden
argument_list|(
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isRowHidden
argument_list|(
literal|1
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isFirstColumnSpanned
argument_list|(
operator|-
literal|1
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isFirstColumnSpanned
argument_list|(
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isFirstColumnSpanned
argument_list|(
literal|1
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isSortingEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|itemsExpandable
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|rootIsDecorated
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|uniformRowHeights
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|visualRect
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
name|QRect
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|wordWrap
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|alternatingRowColors
name|void
name|tst_QTreeView
operator|::
name|alternatingRowColors
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|alternatingRowColors
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setAlternatingRowColors
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|alternatingRowColors
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setAlternatingRowColors
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|alternatingRowColors
argument_list|()
argument_list|)
expr_stmt|;
comment|// ### Test visual effect.
block|}
end_function
begin_function
DECL|function|currentIndex_data
name|void
name|tst_QTreeView
operator|::
name|currentIndex_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"row"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"column"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"indexRow"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"indexColumn"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"parentIndexRow"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"parentIndexColumn"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"-1, -1"
argument_list|)
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"-1, 0"
argument_list|)
operator|<<
operator|-
literal|1
operator|<<
literal|0
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, -1"
argument_list|)
operator|<<
literal|0
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 0"
argument_list|)
operator|<<
literal|0
operator|<<
literal|0
operator|<<
literal|0
operator|<<
literal|0
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 1"
argument_list|)
operator|<<
literal|0
operator|<<
literal|0
operator|<<
literal|0
operator|<<
literal|0
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"1, 0"
argument_list|)
operator|<<
literal|1
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|0
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"1, 1"
argument_list|)
operator|<<
literal|1
operator|<<
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2, 0"
argument_list|)
operator|<<
literal|2
operator|<<
literal|0
operator|<<
literal|2
operator|<<
literal|0
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2, 1"
argument_list|)
operator|<<
literal|2
operator|<<
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"3, -1"
argument_list|)
operator|<<
literal|3
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"3, 0"
argument_list|)
operator|<<
literal|3
operator|<<
literal|0
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"3, 1"
argument_list|)
operator|<<
literal|3
operator|<<
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
expr_stmt|;
block|}
end_function
begin_function
DECL|function|currentIndex
name|void
name|tst_QTreeView
operator|::
name|currentIndex
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|row
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|column
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|indexRow
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|indexColumn
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|parentIndexRow
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|parentIndexColumn
argument_list|)
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
name|treeModel
decl_stmt|;
name|initStandardTreeModel
argument_list|(
operator|&
name|treeModel
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|treeModel
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setCurrentIndex
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
name|row
argument_list|,
name|column
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
operator|.
name|row
argument_list|()
argument_list|,
name|indexRow
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
operator|.
name|column
argument_list|()
argument_list|,
name|indexColumn
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
operator|.
name|parent
argument_list|()
operator|.
name|row
argument_list|()
argument_list|,
name|parentIndexRow
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
operator|.
name|parent
argument_list|()
operator|.
name|column
argument_list|()
argument_list|,
name|parentIndexColumn
argument_list|)
expr_stmt|;
comment|// ### Test child and grandChild indexes.
block|}
end_function
begin_ifndef
ifndef|#
directive|ifndef
name|QT_NO_DRAGANDDROP
end_ifndef
begin_function
DECL|function|dragDropMode_data
name|void
name|tst_QTreeView
operator|::
name|dragDropMode_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QAbstractItemView
operator|::
name|DragDropMode
argument_list|>
argument_list|(
literal|"dragDropMode"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"acceptDrops"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"dragEnabled"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"NoDragDrop"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|NoDragDrop
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DragOnly"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|DragOnly
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DropOnly"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|DropOnly
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DragDrop"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|DragDrop
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"InternalMove"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|InternalMove
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_function
DECL|function|dragDropMode
name|void
name|tst_QTreeView
operator|::
name|dragDropMode
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QAbstractItemView
operator|::
name|DragDropMode
argument_list|,
name|dragDropMode
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|acceptDrops
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|dragEnabled
argument_list|)
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|dragDropMode
argument_list|()
argument_list|,
name|QAbstractItemView
operator|::
name|NoDragDrop
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|acceptDrops
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|dragEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setDragDropMode
argument_list|(
name|dragDropMode
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|dragDropMode
argument_list|()
argument_list|,
name|dragDropMode
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|acceptDrops
argument_list|()
argument_list|,
name|acceptDrops
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|dragEnabled
argument_list|()
argument_list|,
name|dragEnabled
argument_list|)
expr_stmt|;
comment|// ### Test effects of this mode
block|}
end_function
begin_function
DECL|function|dragDropModeFromDragEnabledAndAcceptDrops_data
name|void
name|tst_QTreeView
operator|::
name|dragDropModeFromDragEnabledAndAcceptDrops_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"dragEnabled"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"acceptDrops"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QAbstractItemView
operator|::
name|DragDropMode
argument_list|>
argument_list|(
literal|"dragDropMode"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QAbstractItemView
operator|::
name|DragDropMode
argument_list|>
argument_list|(
literal|"setBehavior"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"NoDragDrop -1"
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
operator|<<
name|QAbstractItemView
operator|::
name|NoDragDrop
operator|<<
name|QAbstractItemView
operator|::
name|DragDropMode
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"NoDragDrop 0"
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
operator|<<
name|QAbstractItemView
operator|::
name|NoDragDrop
operator|<<
name|QAbstractItemView
operator|::
name|NoDragDrop
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"NoDragDrop 1"
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
operator|<<
name|QAbstractItemView
operator|::
name|NoDragDrop
operator|<<
name|QAbstractItemView
operator|::
name|DragOnly
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"NoDragDrop 2"
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
operator|<<
name|QAbstractItemView
operator|::
name|NoDragDrop
operator|<<
name|QAbstractItemView
operator|::
name|DropOnly
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"NoDragDrop 3"
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
operator|<<
name|QAbstractItemView
operator|::
name|NoDragDrop
operator|<<
name|QAbstractItemView
operator|::
name|DragDrop
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"NoDragDrop 4"
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
operator|<<
name|QAbstractItemView
operator|::
name|NoDragDrop
operator|<<
name|QAbstractItemView
operator|::
name|InternalMove
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DragOnly -1"
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
operator|<<
name|QAbstractItemView
operator|::
name|DragOnly
operator|<<
name|QAbstractItemView
operator|::
name|DragDropMode
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DragOnly 0"
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
operator|<<
name|QAbstractItemView
operator|::
name|DragOnly
operator|<<
name|QAbstractItemView
operator|::
name|NoDragDrop
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DragOnly 1"
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
operator|<<
name|QAbstractItemView
operator|::
name|DragOnly
operator|<<
name|QAbstractItemView
operator|::
name|DragOnly
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DragOnly 2"
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
operator|<<
name|QAbstractItemView
operator|::
name|DragOnly
operator|<<
name|QAbstractItemView
operator|::
name|DropOnly
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DragOnly 3"
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
operator|<<
name|QAbstractItemView
operator|::
name|DragOnly
operator|<<
name|QAbstractItemView
operator|::
name|DragDrop
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DragOnly 4"
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
operator|<<
name|QAbstractItemView
operator|::
name|DragOnly
operator|<<
name|QAbstractItemView
operator|::
name|InternalMove
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DropOnly -1"
argument_list|)
operator|<<
literal|false
operator|<<
literal|true
operator|<<
name|QAbstractItemView
operator|::
name|DropOnly
operator|<<
name|QAbstractItemView
operator|::
name|DragDropMode
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DropOnly 0"
argument_list|)
operator|<<
literal|false
operator|<<
literal|true
operator|<<
name|QAbstractItemView
operator|::
name|DropOnly
operator|<<
name|QAbstractItemView
operator|::
name|NoDragDrop
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DropOnly 1"
argument_list|)
operator|<<
literal|false
operator|<<
literal|true
operator|<<
name|QAbstractItemView
operator|::
name|DropOnly
operator|<<
name|QAbstractItemView
operator|::
name|DragOnly
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DropOnly 2"
argument_list|)
operator|<<
literal|false
operator|<<
literal|true
operator|<<
name|QAbstractItemView
operator|::
name|DropOnly
operator|<<
name|QAbstractItemView
operator|::
name|DropOnly
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DropOnly 3"
argument_list|)
operator|<<
literal|false
operator|<<
literal|true
operator|<<
name|QAbstractItemView
operator|::
name|DropOnly
operator|<<
name|QAbstractItemView
operator|::
name|DragDrop
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DropOnly 4"
argument_list|)
operator|<<
literal|false
operator|<<
literal|true
operator|<<
name|QAbstractItemView
operator|::
name|DropOnly
operator|<<
name|QAbstractItemView
operator|::
name|InternalMove
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DragDrop -1"
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
operator|<<
name|QAbstractItemView
operator|::
name|DragDrop
operator|<<
name|QAbstractItemView
operator|::
name|DragDropMode
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DragDrop 0"
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
operator|<<
name|QAbstractItemView
operator|::
name|DragDrop
operator|<<
name|QAbstractItemView
operator|::
name|DragDropMode
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DragDrop 1"
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
operator|<<
name|QAbstractItemView
operator|::
name|DragDrop
operator|<<
name|QAbstractItemView
operator|::
name|NoDragDrop
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DragDrop 2"
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
operator|<<
name|QAbstractItemView
operator|::
name|DragDrop
operator|<<
name|QAbstractItemView
operator|::
name|DragOnly
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DragDrop 3"
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
operator|<<
name|QAbstractItemView
operator|::
name|DragDrop
operator|<<
name|QAbstractItemView
operator|::
name|DropOnly
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DragDrop 4"
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
operator|<<
name|QAbstractItemView
operator|::
name|DragDrop
operator|<<
name|QAbstractItemView
operator|::
name|DragDrop
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DragDrop 5"
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
operator|<<
name|QAbstractItemView
operator|::
name|InternalMove
operator|<<
name|QAbstractItemView
operator|::
name|InternalMove
expr_stmt|;
block|}
end_function
begin_function
DECL|function|dragDropModeFromDragEnabledAndAcceptDrops
name|void
name|tst_QTreeView
operator|::
name|dragDropModeFromDragEnabledAndAcceptDrops
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|acceptDrops
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|dragEnabled
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QAbstractItemView
operator|::
name|DragDropMode
argument_list|,
name|dragDropMode
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QAbstractItemView
operator|::
name|DragDropMode
argument_list|,
name|setBehavior
argument_list|)
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|dragDropMode
argument_list|()
argument_list|,
name|QAbstractItemView
operator|::
name|NoDragDrop
argument_list|)
expr_stmt|;
if|if
condition|(
name|setBehavior
operator|!=
name|QAbstractItemView
operator|::
name|DragDropMode
argument_list|(
operator|-
literal|1
argument_list|)
condition|)
name|view
operator|.
name|setDragDropMode
argument_list|(
name|setBehavior
argument_list|)
expr_stmt|;
name|view
operator|.
name|setAcceptDrops
argument_list|(
name|acceptDrops
argument_list|)
expr_stmt|;
name|view
operator|.
name|setDragEnabled
argument_list|(
name|dragEnabled
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|dragDropMode
argument_list|()
argument_list|,
name|dragDropMode
argument_list|)
expr_stmt|;
comment|// ### Test effects of this mode
block|}
end_function
begin_function
DECL|function|dragDropOverwriteMode
name|void
name|tst_QTreeView
operator|::
name|dragDropOverwriteMode
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|dragDropOverwriteMode
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setDragDropOverwriteMode
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|dragDropOverwriteMode
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setDragDropOverwriteMode
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|dragDropOverwriteMode
argument_list|()
argument_list|)
expr_stmt|;
comment|// ### This property changes the behavior of dropIndicatorPosition(),
comment|// which is protected and called only from within QListWidget and
comment|// QTableWidget, from their reimplementations of dropMimeData(). Hard to
comment|// test.
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_function
DECL|function|editTriggers_data
name|void
name|tst_QTreeView
operator|::
name|editTriggers_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|>
argument_list|(
literal|"editTriggers"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QAbstractItemView
operator|::
name|EditTrigger
argument_list|>
argument_list|(
literal|"triggeredTrigger"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"editorOpened"
argument_list|)
expr_stmt|;
comment|// NoEditTriggers
name|QTest
operator|::
name|newRow
argument_list|(
literal|"NoEditTriggers 0"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|NoEditTriggers
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|NoEditTriggers
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"NoEditTriggers 1"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|NoEditTriggers
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|CurrentChanged
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"NoEditTriggers 2"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|NoEditTriggers
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|DoubleClicked
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"NoEditTriggers 3"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|NoEditTriggers
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|SelectedClicked
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"NoEditTriggers 4"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|NoEditTriggers
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditKeyPressed
operator|<<
literal|false
expr_stmt|;
comment|// CurrentChanged
name|QTest
operator|::
name|newRow
argument_list|(
literal|"CurrentChanged 0"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|CurrentChanged
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|NoEditTriggers
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"CurrentChanged 1"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|CurrentChanged
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|CurrentChanged
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"CurrentChanged 2"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|CurrentChanged
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|DoubleClicked
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"CurrentChanged 3"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|CurrentChanged
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|SelectedClicked
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"CurrentChanged 4"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|CurrentChanged
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditKeyPressed
operator|<<
literal|false
expr_stmt|;
comment|// DoubleClicked
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DoubleClicked 0"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|DoubleClicked
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|NoEditTriggers
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DoubleClicked 1"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|DoubleClicked
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|CurrentChanged
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DoubleClicked 2"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|DoubleClicked
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|DoubleClicked
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DoubleClicked 3"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|DoubleClicked
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|SelectedClicked
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"DoubleClicked 4"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|DoubleClicked
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditKeyPressed
operator|<<
literal|false
expr_stmt|;
comment|// SelectedClicked
name|QTest
operator|::
name|newRow
argument_list|(
literal|"SelectedClicked 0"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|SelectedClicked
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|NoEditTriggers
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"SelectedClicked 1"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|SelectedClicked
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|CurrentChanged
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"SelectedClicked 2"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|SelectedClicked
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|DoubleClicked
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"SelectedClicked 3"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|SelectedClicked
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|SelectedClicked
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"SelectedClicked 4"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|SelectedClicked
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditKeyPressed
operator|<<
literal|false
expr_stmt|;
comment|// EditKeyPressed
name|QTest
operator|::
name|newRow
argument_list|(
literal|"EditKeyPressed 0"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|EditKeyPressed
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|NoEditTriggers
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"EditKeyPressed 1"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|EditKeyPressed
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|CurrentChanged
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"EditKeyPressed 2"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|EditKeyPressed
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|DoubleClicked
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"EditKeyPressed 3"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|EditKeyPressed
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|SelectedClicked
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"EditKeyPressed 4"
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|(
name|QAbstractItemView
operator|::
name|EditKeyPressed
argument_list|)
operator|<<
name|QAbstractItemView
operator|::
name|EditKeyPressed
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_function
DECL|function|editTriggers
name|void
name|tst_QTreeView
operator|::
name|editTriggers
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QAbstractItemView
operator|::
name|EditTriggers
argument_list|,
name|editTriggers
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QAbstractItemView
operator|::
name|EditTrigger
argument_list|,
name|triggeredTrigger
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|editorOpened
argument_list|)
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
name|treeModel
decl_stmt|;
name|initStandardTreeModel
argument_list|(
operator|&
name|treeModel
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|treeModel
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|editTriggers
argument_list|()
argument_list|,
name|QAbstractItemView
operator|::
name|EditKeyPressed
operator||
name|QAbstractItemView
operator|::
name|DoubleClicked
argument_list|)
expr_stmt|;
comment|// Initialize the first index
name|view
operator|.
name|setCurrentIndex
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
comment|// Verify that we don't have any editor initially
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|findChild
argument_list|<
name|QLineEdit
operator|*
argument_list|>
argument_list|(
name|QString
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
comment|// Set the triggers
name|view
operator|.
name|setEditTriggers
argument_list|(
name|editTriggers
argument_list|)
expr_stmt|;
comment|// Interact with the view
switch|switch
condition|(
name|triggeredTrigger
condition|)
block|{
case|case
name|QAbstractItemView
operator|::
name|NoEditTriggers
case|:
comment|// Do nothing, the editor shouldn't be there
break|break;
case|case
name|QAbstractItemView
operator|::
name|CurrentChanged
case|:
comment|// Change the index to open an editor
name|view
operator|.
name|setCurrentIndex
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|QAbstractItemView
operator|::
name|DoubleClicked
case|:
comment|// Doubleclick the center of the current cell
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|visualRect
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseDClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|visualRect
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
break|break;
case|case
name|QAbstractItemView
operator|::
name|SelectedClicked
case|:
comment|// Click the center of the current cell
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|select
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QItemSelectionModel
operator|::
name|Select
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|visualRect
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
name|int
argument_list|(
name|QApplication
operator|::
name|doubleClickInterval
argument_list|()
operator|*
literal|1.5
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|QAbstractItemView
operator|::
name|EditKeyPressed
case|:
name|view
operator|.
name|setFocus
argument_list|()
expr_stmt|;
ifdef|#
directive|ifdef
name|Q_OS_MAC
comment|// Mac OS X uses Enter for editing
name|QTest
operator|::
name|keyPress
argument_list|(
operator|&
name|view
argument_list|,
name|Qt
operator|::
name|Key_Enter
argument_list|)
expr_stmt|;
else|#
directive|else
comment|// All other platforms use F2
name|QTest
operator|::
name|keyPress
argument_list|(
operator|&
name|view
argument_list|,
name|Qt
operator|::
name|Key_F2
argument_list|)
expr_stmt|;
endif|#
directive|endif
break|break;
default|default:
break|break;
block|}
comment|// Check if we got an editor
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|findChild
argument_list|<
name|QLineEdit
operator|*
argument_list|>
argument_list|(
name|QString
argument_list|()
argument_list|)
operator|!=
literal|0
argument_list|,
name|editorOpened
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|hasAutoScroll
name|void
name|tst_QTreeView
operator|::
name|hasAutoScroll
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|hasAutoScroll
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setAutoScroll
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|hasAutoScroll
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setAutoScroll
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|hasAutoScroll
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|horizontalScrollMode
name|void
name|tst_QTreeView
operator|::
name|horizontalScrollMode
parameter_list|()
block|{
name|QStandardItemModel
name|model
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|100
condition|;
operator|++
name|i
control|)
block|{
name|model
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"An item that has very long text and should"
literal|" cause the horizontal scroll bar to appear."
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"An item that has very long text and should"
literal|" cause the horizontal scroll bar to appear."
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|QTreeView
name|view
decl_stmt|;
name|setFrameless
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|view
operator|.
name|header
argument_list|()
operator|->
name|resizeSection
argument_list|(
literal|0
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollMode
argument_list|()
argument_list|,
name|QAbstractItemView
operator|::
name|ScrollPerPixel
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|minimum
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|maximum
argument_list|()
operator|>
literal|2
argument_list|)
expr_stmt|;
name|view
operator|.
name|setHorizontalScrollMode
argument_list|(
name|QAbstractItemView
operator|::
name|ScrollPerItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollMode
argument_list|()
argument_list|,
name|QAbstractItemView
operator|::
name|ScrollPerItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|minimum
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|maximum
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|view
operator|.
name|setHorizontalScrollMode
argument_list|(
name|QAbstractItemView
operator|::
name|ScrollPerPixel
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollMode
argument_list|()
argument_list|,
name|QAbstractItemView
operator|::
name|ScrollPerPixel
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|minimum
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|maximum
argument_list|()
operator|>
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|RepaintTreeView
class|class
name|RepaintTreeView
super|:
specifier|public
name|QTreeView
block|{
public|public:
DECL|function|RepaintTreeView
name|RepaintTreeView
parameter_list|()
member_init_list|:
name|repainted
argument_list|(
literal|false
argument_list|)
block|{ }
DECL|member|repainted
name|bool
name|repainted
decl_stmt|;
protected|protected:
DECL|function|paintEvent
name|void
name|paintEvent
parameter_list|(
name|QPaintEvent
modifier|*
name|event
parameter_list|)
block|{
name|repainted
operator|=
literal|true
expr_stmt|;
name|QTreeView
operator|::
name|paintEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|iconSize
name|void
name|tst_QTreeView
operator|::
name|iconSize
parameter_list|()
block|{
name|RepaintTreeView
name|view
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|iconSize
argument_list|()
argument_list|,
name|QSize
argument_list|()
argument_list|)
expr_stmt|;
name|QStandardItemModel
name|treeModel
decl_stmt|;
name|initStandardTreeModel
argument_list|(
operator|&
name|treeModel
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|treeModel
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|iconSize
argument_list|()
argument_list|,
name|QSize
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|repainted
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|view
operator|.
name|update
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repainted
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|iconSize
argument_list|()
argument_list|,
name|QSize
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|repainted
operator|=
literal|false
expr_stmt|;
name|view
operator|.
name|setIconSize
argument_list|(
name|QSize
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|view
operator|.
name|repainted
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|iconSize
argument_list|()
argument_list|,
name|QSize
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setIconSize
argument_list|(
name|QSize
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repainted
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|iconSize
argument_list|()
argument_list|,
name|QSize
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|repainted
operator|=
literal|false
expr_stmt|;
name|view
operator|.
name|setIconSize
argument_list|(
name|QSize
argument_list|(
literal|10000
argument_list|,
literal|10000
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repainted
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|iconSize
argument_list|()
argument_list|,
name|QSize
argument_list|(
literal|10000
argument_list|,
literal|10000
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|indexAt
name|void
name|tst_QTreeView
operator|::
name|indexAt
parameter_list|()
block|{
name|QtTestModel
name|model
decl_stmt|;
name|model
operator|.
name|rows
operator|=
name|model
operator|.
name|cols
operator|=
literal|5
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indexAt
argument_list|(
name|QPoint
argument_list|()
argument_list|)
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|indexAt
argument_list|(
name|QPoint
argument_list|()
argument_list|)
operator|!=
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QSize
name|itemSize
init|=
name|view
operator|.
name|visualRect
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
operator|.
name|size
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|model
operator|.
name|rowCount
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QPoint
name|pos
argument_list|(
name|itemSize
operator|.
name|width
argument_list|()
operator|/
literal|2
argument_list|,
operator|(
name|i
operator|*
name|itemSize
operator|.
name|height
argument_list|()
operator|)
operator|+
operator|(
name|itemSize
operator|.
name|height
argument_list|()
operator|/
literal|2
operator|)
argument_list|)
decl_stmt|;
name|QModelIndex
name|index
init|=
name|view
operator|.
name|indexAt
argument_list|(
name|pos
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|index
argument_list|,
name|model
operator|.
name|index
argument_list|(
name|i
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|/*       // ### this is wrong; the widget _will_ affect the item size     for (int j = 0; j< model.rowCount(); ++j)         view.setIndexWidget(model.index(j, 0), new QPushButton);     */
for|for
control|(
name|int
name|k
init|=
literal|0
init|;
name|k
operator|<
name|model
operator|.
name|rowCount
argument_list|()
condition|;
operator|++
name|k
control|)
block|{
name|QPoint
name|pos
argument_list|(
name|itemSize
operator|.
name|width
argument_list|()
operator|/
literal|2
argument_list|,
operator|(
name|k
operator|*
name|itemSize
operator|.
name|height
argument_list|()
operator|)
operator|+
operator|(
name|itemSize
operator|.
name|height
argument_list|()
operator|/
literal|2
operator|)
argument_list|)
decl_stmt|;
name|QModelIndex
name|index
init|=
name|view
operator|.
name|indexAt
argument_list|(
name|pos
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|index
argument_list|,
name|model
operator|.
name|index
argument_list|(
name|k
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|600
argument_list|,
literal|600
argument_list|)
expr_stmt|;
name|view
operator|.
name|header
argument_list|()
operator|->
name|setStretchLastSection
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indexAt
argument_list|(
name|QPoint
argument_list|(
literal|550
argument_list|,
literal|20
argument_list|)
argument_list|)
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|indexWidget
name|void
name|tst_QTreeView
operator|::
name|indexWidget
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
name|treeModel
decl_stmt|;
name|initStandardTreeModel
argument_list|(
operator|&
name|treeModel
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|treeModel
argument_list|)
expr_stmt|;
name|QModelIndex
name|index
init|=
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|indexWidget
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|indexWidget
argument_list|(
name|index
argument_list|)
argument_list|)
expr_stmt|;
name|QString
name|text
init|=
name|QLatin1String
argument_list|(
literal|"TestLabel"
argument_list|)
decl_stmt|;
name|QWidget
modifier|*
name|label
init|=
operator|new
name|QLabel
argument_list|(
name|text
argument_list|)
decl_stmt|;
name|view
operator|.
name|setIndexWidget
argument_list|(
name|QModelIndex
argument_list|()
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|indexWidget
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|label
operator|->
name|parent
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setIndexWidget
argument_list|(
name|index
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indexWidget
argument_list|(
name|index
argument_list|)
argument_list|,
name|label
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|label
operator|->
name|parentWidget
argument_list|()
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
argument_list|)
expr_stmt|;
name|QTextEdit
modifier|*
name|widget
init|=
operator|new
name|QTextEdit
argument_list|(
name|text
argument_list|)
decl_stmt|;
name|widget
operator|->
name|setFixedSize
argument_list|(
literal|200
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|view
operator|.
name|setIndexWidget
argument_list|(
name|index
argument_list|,
name|widget
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indexWidget
argument_list|(
name|index
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|->
name|parentWidget
argument_list|()
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|->
name|geometry
argument_list|()
argument_list|,
name|view
operator|.
name|visualRect
argument_list|(
name|index
argument_list|)
operator|.
name|intersected
argument_list|(
name|widget
operator|->
name|geometry
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|->
name|toPlainText
argument_list|()
argument_list|,
name|text
argument_list|)
expr_stmt|;
comment|//now let's try to do that later when the widget is already shown
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|index
operator|=
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|indexWidget
argument_list|(
name|index
argument_list|)
argument_list|)
expr_stmt|;
name|widget
operator|=
operator|new
name|QTextEdit
argument_list|(
name|text
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setFixedSize
argument_list|(
literal|200
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|view
operator|.
name|setIndexWidget
argument_list|(
name|index
argument_list|,
name|widget
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indexWidget
argument_list|(
name|index
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|->
name|parentWidget
argument_list|()
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|->
name|geometry
argument_list|()
argument_list|,
name|view
operator|.
name|visualRect
argument_list|(
name|index
argument_list|)
operator|.
name|intersected
argument_list|(
name|widget
operator|->
name|geometry
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|->
name|toPlainText
argument_list|()
argument_list|,
name|text
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemDelegate
name|void
name|tst_QTreeView
operator|::
name|itemDelegate
parameter_list|()
block|{
name|QPointer
argument_list|<
name|QAbstractItemDelegate
argument_list|>
name|oldDelegate
decl_stmt|;
name|QPointer
argument_list|<
name|QItemDelegate
argument_list|>
name|otherItemDelegate
decl_stmt|;
block|{
name|QTreeView
name|view
decl_stmt|;
name|QVERIFY
argument_list|(
name|qobject_cast
argument_list|<
name|QStyledItemDelegate
operator|*
argument_list|>
argument_list|(
name|view
operator|.
name|itemDelegate
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QPointer
argument_list|<
name|QAbstractItemDelegate
argument_list|>
name|oldDelegate
init|=
name|view
operator|.
name|itemDelegate
argument_list|()
decl_stmt|;
name|otherItemDelegate
operator|=
operator|new
name|QItemDelegate
expr_stmt|;
name|view
operator|.
name|setItemDelegate
argument_list|(
name|otherItemDelegate
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|otherItemDelegate
operator|->
name|parent
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|oldDelegate
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemDelegate
argument_list|()
argument_list|,
operator|(
name|QAbstractItemDelegate
operator|*
operator|)
name|otherItemDelegate
argument_list|)
expr_stmt|;
name|view
operator|.
name|setItemDelegate
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemDelegate
argument_list|()
argument_list|)
expr_stmt|;
comment|//<- view does its own drawing?
name|QVERIFY
argument_list|(
name|otherItemDelegate
argument_list|)
expr_stmt|;
block|}
comment|// This is strange. Why doesn't setItemDelegate() reparent the delegate?
name|QVERIFY
argument_list|(
operator|!
name|oldDelegate
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|otherItemDelegate
argument_list|)
expr_stmt|;
operator|delete
name|otherItemDelegate
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemDelegateForColumnOrRow
name|void
name|tst_QTreeView
operator|::
name|itemDelegateForColumnOrRow
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QAbstractItemDelegate
modifier|*
name|defaultDelegate
init|=
name|view
operator|.
name|itemDelegate
argument_list|()
decl_stmt|;
name|QVERIFY
argument_list|(
name|defaultDelegate
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemDelegateForRow
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemDelegateForColumn
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemDelegate
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
name|defaultDelegate
argument_list|)
expr_stmt|;
name|QStandardItemModel
name|model
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|100
condition|;
operator|++
name|i
control|)
block|{
name|model
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"An item that has very long text and should"
literal|" cause the horizontal scroll bar to appear."
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"An item that has very long text and should"
literal|" cause the horizontal scroll bar to appear."
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"An item that has very long text and should"
literal|" cause the horizontal scroll bar to appear."
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemDelegateForRow
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemDelegateForColumn
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemDelegate
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
name|defaultDelegate
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemDelegate
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
name|defaultDelegate
argument_list|)
expr_stmt|;
name|QPointer
argument_list|<
name|QAbstractItemDelegate
argument_list|>
name|rowDelegate
init|=
operator|new
name|QItemDelegate
decl_stmt|;
name|view
operator|.
name|setItemDelegateForRow
argument_list|(
literal|0
argument_list|,
name|rowDelegate
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rowDelegate
operator|->
name|parent
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemDelegateForRow
argument_list|(
literal|0
argument_list|)
argument_list|,
operator|(
name|QAbstractItemDelegate
operator|*
operator|)
name|rowDelegate
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemDelegate
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
operator|(
name|QAbstractItemDelegate
operator|*
operator|)
name|rowDelegate
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemDelegate
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|,
operator|(
name|QAbstractItemDelegate
operator|*
operator|)
name|rowDelegate
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemDelegate
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
name|defaultDelegate
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemDelegate
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|,
name|defaultDelegate
argument_list|)
expr_stmt|;
name|QPointer
argument_list|<
name|QAbstractItemDelegate
argument_list|>
name|columnDelegate
init|=
operator|new
name|QItemDelegate
decl_stmt|;
name|view
operator|.
name|setItemDelegateForColumn
argument_list|(
literal|1
argument_list|,
name|columnDelegate
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|columnDelegate
operator|->
name|parent
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemDelegateForColumn
argument_list|(
literal|1
argument_list|)
argument_list|,
operator|(
name|QAbstractItemDelegate
operator|*
operator|)
name|columnDelegate
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemDelegate
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
operator|(
name|QAbstractItemDelegate
operator|*
operator|)
name|rowDelegate
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemDelegate
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|,
operator|(
name|QAbstractItemDelegate
operator|*
operator|)
name|rowDelegate
argument_list|)
expr_stmt|;
comment|// row wins
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemDelegate
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
name|defaultDelegate
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemDelegate
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|,
operator|(
name|QAbstractItemDelegate
operator|*
operator|)
name|columnDelegate
argument_list|)
expr_stmt|;
name|view
operator|.
name|setItemDelegateForRow
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemDelegateForRow
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rowDelegate
argument_list|)
expr_stmt|;
comment|//<- wasn't deleted
name|view
operator|.
name|setItemDelegateForColumn
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemDelegateForColumn
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|columnDelegate
argument_list|)
expr_stmt|;
comment|//<- wasn't deleted
operator|delete
name|rowDelegate
expr_stmt|;
operator|delete
name|columnDelegate
expr_stmt|;
block|}
end_function
begin_function
DECL|function|keyboardSearch
name|void
name|tst_QTreeView
operator|::
name|keyboardSearch
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
name|model
decl_stmt|;
name|model
operator|.
name|appendRow
argument_list|(
operator|new
name|QStandardItem
argument_list|(
literal|"Andreas"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|appendRow
argument_list|(
operator|new
name|QStandardItem
argument_list|(
literal|"Baldrian"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|appendRow
argument_list|(
operator|new
name|QStandardItem
argument_list|(
literal|"Cecilie"
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
comment|// Nothing is selected
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|hasSelection
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|isSelected
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// First item is selected
name|view
operator|.
name|keyboardSearch
argument_list|(
name|QLatin1String
argument_list|(
literal|"A"
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|isSelected
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// First item is still selected
name|view
operator|.
name|keyboardSearch
argument_list|(
name|QLatin1String
argument_list|(
literal|"n"
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|isSelected
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// No "AnB" item - keep the same selection.
name|view
operator|.
name|keyboardSearch
argument_list|(
name|QLatin1String
argument_list|(
literal|"B"
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|isSelected
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// Wait a bit.
name|QTest
operator|::
name|qWait
argument_list|(
name|QApplication
operator|::
name|keyboardInputInterval
argument_list|()
operator|*
literal|2
argument_list|)
expr_stmt|;
comment|// The item that starts with B is selected.
name|view
operator|.
name|keyboardSearch
argument_list|(
name|QLatin1String
argument_list|(
literal|"B"
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|isSelected
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|keyboardSearchMultiColumn
name|void
name|tst_QTreeView
operator|::
name|keyboardSearchMultiColumn
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
name|model
argument_list|(
literal|4
argument_list|,
literal|2
argument_list|)
decl_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"1"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"green"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"bad"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"eggs"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|2
argument_list|,
literal|0
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"moof"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"and"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|3
argument_list|,
literal|0
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"elf"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|3
argument_list|,
literal|1
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"ham"
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setCurrentIndex
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
comment|// First item is selected
name|view
operator|.
name|keyboardSearch
argument_list|(
name|QLatin1String
argument_list|(
literal|"eggs"
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|isSelected
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
name|QApplication
operator|::
name|keyboardInputInterval
argument_list|()
operator|*
literal|2
argument_list|)
expr_stmt|;
comment|// 'ham' is selected
name|view
operator|.
name|keyboardSearch
argument_list|(
name|QLatin1String
argument_list|(
literal|"h"
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|isSelected
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|3
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setModel
name|void
name|tst_QTreeView
operator|::
name|setModel
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|model
argument_list|()
argument_list|,
operator|(
name|QAbstractItemModel
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
argument_list|,
operator|(
name|QItemSelectionModel
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|->
name|model
argument_list|()
argument_list|,
operator|(
name|QAbstractItemModel
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|->
name|selectionModel
argument_list|()
argument_list|,
operator|(
name|QItemSelectionModel
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
literal|2
condition|;
operator|++
name|x
control|)
block|{
name|QtTestModel
modifier|*
name|model
init|=
operator|new
name|QtTestModel
argument_list|(
literal|10
argument_list|,
literal|8
argument_list|)
decl_stmt|;
name|QAbstractItemModel
modifier|*
name|oldModel
init|=
name|view
operator|.
name|model
argument_list|()
decl_stmt|;
name|QSignalSpy
name|modelDestroyedSpy
argument_list|(
name|oldModel
condition|?
name|oldModel
else|:
name|model
argument_list|,
name|SIGNAL
argument_list|(
name|destroyed
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
comment|// set the same model twice
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
operator|++
name|i
control|)
block|{
name|QItemSelectionModel
modifier|*
name|oldSelectionModel
init|=
name|view
operator|.
name|selectionModel
argument_list|()
decl_stmt|;
name|QItemSelectionModel
modifier|*
name|dummy
init|=
operator|new
name|QItemSelectionModel
argument_list|(
name|model
argument_list|)
decl_stmt|;
name|QSignalSpy
name|selectionModelDestroyedSpy
argument_list|(
name|oldSelectionModel
condition|?
name|oldSelectionModel
else|:
name|dummy
argument_list|,
name|SIGNAL
argument_list|(
name|destroyed
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
name|model
argument_list|)
expr_stmt|;
comment|//                QCOMPARE(selectionModelDestroyedSpy.count(), (x == 0 || i == 1) ? 0 : 1);
name|QCOMPARE
argument_list|(
name|view
operator|.
name|model
argument_list|()
argument_list|,
operator|(
name|QAbstractItemModel
operator|*
operator|)
name|model
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|->
name|model
argument_list|()
argument_list|,
operator|(
name|QAbstractItemModel
operator|*
operator|)
name|model
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|!=
name|oldSelectionModel
argument_list|,
operator|(
name|i
operator|==
literal|0
operator|)
argument_list|)
expr_stmt|;
block|}
name|QTRY_COMPARE
argument_list|(
name|modelDestroyedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|model
argument_list|()
argument_list|,
operator|(
name|QAbstractItemModel
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// ### shouldn't selectionModel also be 0 now?
comment|//        QCOMPARE(view.selectionModel(), (QItemSelectionModel*)0);
operator|delete
name|model
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|openPersistentEditor
name|void
name|tst_QTreeView
operator|::
name|openPersistentEditor
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
name|treeModel
decl_stmt|;
name|initStandardTreeModel
argument_list|(
operator|&
name|treeModel
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|treeModel
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|findChild
argument_list|<
name|QLineEdit
operator|*
argument_list|>
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|openPersistentEditor
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|findChild
argument_list|<
name|QLineEdit
operator|*
argument_list|>
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|closePersistentEditor
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|findChild
argument_list|<
name|QLineEdit
operator|*
argument_list|>
argument_list|()
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendPostedEvents
argument_list|(
literal|0
argument_list|,
name|QEvent
operator|::
name|DeferredDelete
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|findChild
argument_list|<
name|QLineEdit
operator|*
argument_list|>
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|rootIndex
name|void
name|tst_QTreeView
operator|::
name|rootIndex
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|rootIndex
argument_list|()
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QStandardItemModel
name|treeModel
decl_stmt|;
name|initStandardTreeModel
argument_list|(
operator|&
name|treeModel
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|treeModel
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|rootIndex
argument_list|()
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRootIndex
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|data
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
name|view
operator|.
name|header
argument_list|()
operator|->
name|visualIndex
argument_list|(
literal|0
argument_list|)
argument_list|,
name|view
operator|.
name|rootIndex
argument_list|()
argument_list|)
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Row 2 Child Item"
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setHeader
name|void
name|tst_QTreeView
operator|::
name|setHeader
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|->
name|orientation
argument_list|()
argument_list|,
name|Qt
operator|::
name|Horizontal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|->
name|parent
argument_list|()
argument_list|,
operator|(
name|QObject
operator|*
operator|)
operator|&
name|view
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
literal|2
condition|;
operator|++
name|x
control|)
block|{
name|QSignalSpy
name|destroyedSpy
argument_list|(
name|view
operator|.
name|header
argument_list|()
argument_list|,
name|SIGNAL
argument_list|(
name|destroyed
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|Qt
operator|::
name|Orientation
name|orient
init|=
name|x
condition|?
name|Qt
operator|::
name|Vertical
else|:
name|Qt
operator|::
name|Horizontal
decl_stmt|;
name|QHeaderView
modifier|*
name|head
init|=
operator|new
name|QHeaderView
argument_list|(
name|orient
argument_list|)
decl_stmt|;
name|view
operator|.
name|setHeader
argument_list|(
name|head
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|destroyedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|head
operator|->
name|parent
argument_list|()
argument_list|,
operator|(
name|QObject
operator|*
operator|)
operator|&
name|view
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
argument_list|,
name|head
argument_list|)
expr_stmt|;
name|view
operator|.
name|setHeader
argument_list|(
name|head
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
argument_list|,
name|head
argument_list|)
expr_stmt|;
comment|// Itemviews in Qt< 4.2 have asserts for this. Qt>= 4.2 should handle this gracefully
name|view
operator|.
name|setHeader
argument_list|(
operator|(
name|QHeaderView
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
argument_list|,
name|head
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|columnHidden
name|void
name|tst_QTreeView
operator|::
name|columnHidden
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QtTestModel
name|model
argument_list|(
literal|10
argument_list|,
literal|8
argument_list|)
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
for|for
control|(
name|int
name|c
init|=
literal|0
init|;
name|c
operator|<
name|model
operator|.
name|columnCount
argument_list|()
condition|;
operator|++
name|c
control|)
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isColumnHidden
argument_list|(
name|c
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
comment|// hide even columns
for|for
control|(
name|int
name|c
init|=
literal|0
init|;
name|c
operator|<
name|model
operator|.
name|columnCount
argument_list|()
condition|;
name|c
operator|+=
literal|2
control|)
name|view
operator|.
name|setColumnHidden
argument_list|(
name|c
argument_list|,
literal|true
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|c
init|=
literal|0
init|;
name|c
operator|<
name|model
operator|.
name|columnCount
argument_list|()
condition|;
operator|++
name|c
control|)
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isColumnHidden
argument_list|(
name|c
argument_list|)
argument_list|,
operator|(
name|c
operator|&
literal|1
operator|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|update
argument_list|()
expr_stmt|;
comment|// hide odd columns too
for|for
control|(
name|int
name|c
init|=
literal|1
init|;
name|c
operator|<
name|model
operator|.
name|columnCount
argument_list|()
condition|;
name|c
operator|+=
literal|2
control|)
name|view
operator|.
name|setColumnHidden
argument_list|(
name|c
argument_list|,
literal|true
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|c
init|=
literal|0
init|;
name|c
operator|<
name|model
operator|.
name|columnCount
argument_list|()
condition|;
operator|++
name|c
control|)
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isColumnHidden
argument_list|(
name|c
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|update
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|rowHidden
name|void
name|tst_QTreeView
operator|::
name|rowHidden
parameter_list|()
block|{
name|QtTestModel
name|model
argument_list|(
literal|4
argument_list|,
literal|6
argument_list|)
decl_stmt|;
name|model
operator|.
name|levels
operator|=
literal|3
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|500
argument_list|,
literal|500
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isRowHidden
argument_list|(
operator|-
literal|1
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isRowHidden
argument_list|(
literal|999999
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRowHidden
argument_list|(
operator|-
literal|1
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRowHidden
argument_list|(
literal|999999
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isRowHidden
argument_list|(
operator|-
literal|1
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isRowHidden
argument_list|(
literal|999999
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRowHidden
argument_list|(
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isRowHidden
argument_list|(
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRowHidden
argument_list|(
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isRowHidden
argument_list|(
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QStack
argument_list|<
name|QModelIndex
argument_list|>
name|parents
decl_stmt|;
name|parents
operator|.
name|push
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
while|while
condition|(
operator|!
name|parents
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|QModelIndex
name|p
init|=
name|parents
operator|.
name|pop
argument_list|()
decl_stmt|;
if|if
condition|(
name|model
operator|.
name|canFetchMore
argument_list|(
name|p
argument_list|)
condition|)
name|model
operator|.
name|fetchMore
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|int
name|rows
init|=
name|model
operator|.
name|rowCount
argument_list|(
name|p
argument_list|)
decl_stmt|;
comment|// hide all
for|for
control|(
name|int
name|r
init|=
literal|0
init|;
name|r
operator|<
name|rows
condition|;
operator|++
name|r
control|)
block|{
name|view
operator|.
name|setRowHidden
argument_list|(
name|r
argument_list|,
name|p
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isRowHidden
argument_list|(
name|r
argument_list|,
name|p
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
comment|// hide none
for|for
control|(
name|int
name|r
init|=
literal|0
init|;
name|r
operator|<
name|rows
condition|;
operator|++
name|r
control|)
block|{
name|view
operator|.
name|setRowHidden
argument_list|(
name|r
argument_list|,
name|p
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isRowHidden
argument_list|(
name|r
argument_list|,
name|p
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
comment|// hide only even rows
for|for
control|(
name|int
name|r
init|=
literal|0
init|;
name|r
operator|<
name|rows
condition|;
operator|++
name|r
control|)
block|{
name|bool
name|hide
init|=
operator|(
name|r
operator|&
literal|1
operator|)
operator|==
literal|0
decl_stmt|;
name|view
operator|.
name|setRowHidden
argument_list|(
name|r
argument_list|,
name|p
argument_list|,
name|hide
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isRowHidden
argument_list|(
name|r
argument_list|,
name|p
argument_list|)
argument_list|,
name|hide
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|int
name|r
init|=
literal|0
init|;
name|r
operator|<
name|rows
condition|;
operator|++
name|r
control|)
name|parents
operator|.
name|push
argument_list|(
name|model
operator|.
name|index
argument_list|(
name|r
argument_list|,
literal|0
argument_list|,
name|p
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|parents
operator|.
name|push
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
while|while
condition|(
operator|!
name|parents
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|QModelIndex
name|p
init|=
name|parents
operator|.
name|pop
argument_list|()
decl_stmt|;
comment|// all even rows should still be hidden
for|for
control|(
name|int
name|r
init|=
literal|0
init|;
name|r
operator|<
name|model
operator|.
name|rowCount
argument_list|(
name|p
argument_list|)
condition|;
operator|++
name|r
control|)
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isRowHidden
argument_list|(
name|r
argument_list|,
name|p
argument_list|)
argument_list|,
operator|(
name|r
operator|&
literal|1
operator|)
operator|==
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|model
operator|.
name|rowCount
argument_list|(
name|p
argument_list|)
operator|>
literal|0
condition|)
block|{
for|for
control|(
name|int
name|r
init|=
literal|0
init|;
name|r
operator|<
name|model
operator|.
name|rowCount
argument_list|(
name|p
argument_list|)
condition|;
operator|++
name|r
control|)
name|parents
operator|.
name|push
argument_list|(
name|model
operator|.
name|index
argument_list|(
name|r
argument_list|,
literal|0
argument_list|,
name|p
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function
DECL|function|noDelegate
name|void
name|tst_QTreeView
operator|::
name|noDelegate
parameter_list|()
block|{
name|QtTestModel
name|model
argument_list|(
literal|10
argument_list|,
literal|7
argument_list|)
decl_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|setItemDelegate
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemDelegate
argument_list|()
argument_list|,
operator|(
name|QAbstractItemDelegate
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|noModel
name|void
name|tst_QTreeView
operator|::
name|noModel
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|view
operator|.
name|setRowHidden
argument_list|(
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|emptyModel
name|void
name|tst_QTreeView
operator|::
name|emptyModel
parameter_list|()
block|{
name|QtTestModel
name|model
decl_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|model
operator|.
name|wrongIndex
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|removeRows
name|void
name|tst_QTreeView
operator|::
name|removeRows
parameter_list|()
block|{
name|QtTestModel
name|model
argument_list|(
literal|7
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|model
operator|.
name|removeLastRow
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|model
operator|.
name|wrongIndex
argument_list|)
expr_stmt|;
name|model
operator|.
name|removeAllRows
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|model
operator|.
name|wrongIndex
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|removeCols
name|void
name|tst_QTreeView
operator|::
name|removeCols
parameter_list|()
block|{
name|QtTestModel
name|model
argument_list|(
literal|5
argument_list|,
literal|8
argument_list|)
decl_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|model
operator|.
name|fetched
operator|=
literal|true
expr_stmt|;
name|model
operator|.
name|removeLastColumn
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|model
operator|.
name|wrongIndex
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|->
name|count
argument_list|()
argument_list|,
name|model
operator|.
name|cols
argument_list|)
expr_stmt|;
name|model
operator|.
name|removeAllColumns
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|model
operator|.
name|wrongIndex
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|->
name|count
argument_list|()
argument_list|,
name|model
operator|.
name|cols
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|limitedExpand
name|void
name|tst_QTreeView
operator|::
name|limitedExpand
parameter_list|()
block|{
block|{
name|QStandardItemModel
name|model
decl_stmt|;
name|QStandardItem
modifier|*
name|parentItem
init|=
name|model
operator|.
name|invisibleRootItem
argument_list|()
decl_stmt|;
name|parentItem
operator|->
name|appendRow
argument_list|(
operator|new
name|QStandardItem
argument_list|)
expr_stmt|;
name|parentItem
operator|->
name|appendRow
argument_list|(
operator|new
name|QStandardItem
argument_list|)
expr_stmt|;
name|parentItem
operator|->
name|appendRow
argument_list|(
operator|new
name|QStandardItem
argument_list|)
expr_stmt|;
name|QStandardItem
modifier|*
name|firstItem
init|=
name|model
operator|.
name|item
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|firstItem
operator|->
name|setFlags
argument_list|(
name|firstItem
operator|->
name|flags
argument_list|()
operator||
name|Qt
operator|::
name|ItemNeverHasChildren
argument_list|)
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QSignalSpy
name|spy
argument_list|(
operator|&
name|view
argument_list|,
name|SIGNAL
argument_list|(
name|expanded
argument_list|(
name|QModelIndex
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|spy
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|expand
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|expand
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
block|{
name|QStringListModel
name|model
argument_list|(
name|QStringList
argument_list|()
operator|<<
literal|"one"
operator|<<
literal|"two"
argument_list|)
decl_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QSignalSpy
name|spy
argument_list|(
operator|&
name|view
argument_list|,
name|SIGNAL
argument_list|(
name|expanded
argument_list|(
name|QModelIndex
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|spy
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|expand
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|expandAndCollapse_data
name|void
name|tst_QTreeView
operator|::
name|expandAndCollapse_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"animationEnabled"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"normal"
argument_list|)
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"animated"
argument_list|)
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_function
DECL|function|expandAndCollapse
name|void
name|tst_QTreeView
operator|::
name|expandAndCollapse
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|animationEnabled
argument_list|)
expr_stmt|;
name|QtTestModel
name|model
argument_list|(
literal|10
argument_list|,
literal|9
argument_list|)
decl_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setUniformRowHeights
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|setAnimated
argument_list|(
name|animationEnabled
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QModelIndex
name|a
init|=
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
decl_stmt|;
name|QModelIndex
name|b
init|=
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|a
argument_list|)
decl_stmt|;
name|QSignalSpy
name|expandedSpy
argument_list|(
operator|&
name|view
argument_list|,
name|SIGNAL
argument_list|(
name|expanded
argument_list|(
name|QModelIndex
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QSignalSpy
name|collapsedSpy
argument_list|(
operator|&
name|view
argument_list|,
name|SIGNAL
argument_list|(
name|collapsed
argument_list|(
name|QModelIndex
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QVariantList
name|args
decl_stmt|;
for|for
control|(
name|int
name|y
init|=
literal|0
init|;
name|y
operator|<
literal|2
condition|;
operator|++
name|y
control|)
block|{
name|view
operator|.
name|setVisible
argument_list|(
name|y
operator|==
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
literal|2
condition|;
operator|++
name|x
control|)
block|{
name|view
operator|.
name|setItemsExpandable
argument_list|(
name|x
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|// Test bad args
name|view
operator|.
name|expand
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|view
operator|.
name|collapse
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|expandedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|collapsedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// expand a first level item
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isExpanded
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|expand
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|expandedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|collapsedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|args
operator|=
name|expandedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QModelIndex
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|view
operator|.
name|expand
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|expandedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|collapsedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// expand a second level item
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isExpanded
argument_list|(
name|b
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|expand
argument_list|(
name|b
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|b
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|expandedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|collapsedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|args
operator|=
name|expandedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QModelIndex
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|view
operator|.
name|expand
argument_list|(
name|b
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|b
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|expandedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|collapsedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// collapse the first level item
name|view
operator|.
name|collapse
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isExpanded
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|b
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|expandedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|collapsedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|args
operator|=
name|collapsedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QModelIndex
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|view
operator|.
name|collapse
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isExpanded
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|expandedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|collapsedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// expand the first level item again
name|view
operator|.
name|expand
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|b
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|expandedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|collapsedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|args
operator|=
name|expandedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QModelIndex
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|a
argument_list|)
expr_stmt|;
comment|// collapse the second level item
name|view
operator|.
name|collapse
argument_list|(
name|b
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isExpanded
argument_list|(
name|b
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|expandedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|collapsedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|args
operator|=
name|collapsedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QModelIndex
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|b
argument_list|)
expr_stmt|;
comment|// collapse the first level item
name|view
operator|.
name|collapse
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isExpanded
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isExpanded
argument_list|(
name|b
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|expandedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|collapsedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|args
operator|=
name|collapsedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QModelIndex
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|a
argument_list|)
expr_stmt|;
comment|// expand and remove row
name|QPersistentModelIndex
name|c
init|=
name|model
operator|.
name|index
argument_list|(
literal|9
argument_list|,
literal|0
argument_list|,
name|b
argument_list|)
decl_stmt|;
name|view
operator|.
name|expand
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|view
operator|.
name|expand
argument_list|(
name|b
argument_list|)
expr_stmt|;
name|model
operator|.
name|removeLastRow
argument_list|()
expr_stmt|;
comment|// remove c
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|b
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isExpanded
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|expandedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|collapsedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|args
operator|=
name|expandedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QModelIndex
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|args
operator|=
name|expandedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QModelIndex
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|b
argument_list|)
expr_stmt|;
name|view
operator|.
name|collapse
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|view
operator|.
name|collapse
argument_list|(
name|b
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isExpanded
argument_list|(
name|a
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isExpanded
argument_list|(
name|b
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isExpanded
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|expandedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|collapsedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|args
operator|=
name|collapsedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QModelIndex
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|args
operator|=
name|collapsedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QModelIndex
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|b
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function
DECL|function|expandAndCollapseAll
name|void
name|tst_QTreeView
operator|::
name|expandAndCollapseAll
parameter_list|()
block|{
name|QtTestModel
name|model
argument_list|(
literal|3
argument_list|,
literal|2
argument_list|)
decl_stmt|;
name|model
operator|.
name|levels
operator|=
literal|2
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setUniformRowHeights
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QSignalSpy
name|expandedSpy
argument_list|(
operator|&
name|view
argument_list|,
name|SIGNAL
argument_list|(
name|expanded
argument_list|(
name|QModelIndex
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QSignalSpy
name|collapsedSpy
argument_list|(
operator|&
name|view
argument_list|,
name|SIGNAL
argument_list|(
name|collapsed
argument_list|(
name|QModelIndex
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|view
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|collapsedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QStack
argument_list|<
name|QModelIndex
argument_list|>
name|parents
decl_stmt|;
name|parents
operator|.
name|push
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|int
name|count
init|=
literal|0
decl_stmt|;
while|while
condition|(
operator|!
name|parents
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|QModelIndex
name|p
init|=
name|parents
operator|.
name|pop
argument_list|()
decl_stmt|;
name|int
name|rows
init|=
name|model
operator|.
name|rowCount
argument_list|(
name|p
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|r
init|=
literal|0
init|;
name|r
operator|<
name|rows
condition|;
operator|++
name|r
control|)
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|model
operator|.
name|index
argument_list|(
name|r
argument_list|,
literal|0
argument_list|,
name|p
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|count
operator|+=
name|rows
expr_stmt|;
for|for
control|(
name|int
name|r
init|=
literal|0
init|;
name|r
operator|<
name|rows
condition|;
operator|++
name|r
control|)
name|parents
operator|.
name|push
argument_list|(
name|model
operator|.
name|index
argument_list|(
name|r
argument_list|,
literal|0
argument_list|,
name|p
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|expandedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|12
argument_list|)
expr_stmt|;
comment|// == (3+1)*(2+1) from QtTestModel model(3, 2);
name|view
operator|.
name|collapseAll
argument_list|()
expr_stmt|;
name|parents
operator|.
name|push
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|count
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|!
name|parents
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|QModelIndex
name|p
init|=
name|parents
operator|.
name|pop
argument_list|()
decl_stmt|;
name|int
name|rows
init|=
name|model
operator|.
name|rowCount
argument_list|(
name|p
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|r
init|=
literal|0
init|;
name|r
operator|<
name|rows
condition|;
operator|++
name|r
control|)
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isExpanded
argument_list|(
name|model
operator|.
name|index
argument_list|(
name|r
argument_list|,
literal|0
argument_list|,
name|p
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|count
operator|+=
name|rows
expr_stmt|;
for|for
control|(
name|int
name|r
init|=
literal|0
init|;
name|r
operator|<
name|rows
condition|;
operator|++
name|r
control|)
name|parents
operator|.
name|push
argument_list|(
name|model
operator|.
name|index
argument_list|(
name|r
argument_list|,
literal|0
argument_list|,
name|p
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|collapsedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|12
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|expandWithNoChildren
name|void
name|tst_QTreeView
operator|::
name|expandWithNoChildren
parameter_list|()
block|{
name|QTreeView
name|tree
decl_stmt|;
name|QStandardItemModel
name|model
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|tree
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|tree
operator|.
name|setAnimated
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|tree
operator|.
name|doItemsLayout
argument_list|()
expr_stmt|;
comment|//this test should not output warnings
name|tree
operator|.
name|expand
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|keyboardNavigation
name|void
name|tst_QTreeView
operator|::
name|keyboardNavigation
parameter_list|()
block|{
specifier|const
name|int
name|rows
init|=
literal|10
decl_stmt|;
specifier|const
name|int
name|columns
init|=
literal|7
decl_stmt|;
name|QtTestModel
name|model
argument_list|(
name|rows
argument_list|,
name|columns
argument_list|)
decl_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVector
argument_list|<
name|Qt
operator|::
name|Key
argument_list|>
name|keymoves
decl_stmt|;
name|keymoves
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Right
operator|<<
name|Qt
operator|::
name|Key_Right
operator|<<
name|Qt
operator|::
name|Key_Right
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Right
operator|<<
name|Qt
operator|::
name|Key_Right
operator|<<
name|Qt
operator|::
name|Key_Right
operator|<<
name|Qt
operator|::
name|Key_Left
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Left
operator|<<
name|Qt
operator|::
name|Key_Left
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Left
operator|<<
name|Qt
operator|::
name|Key_Left
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Down
expr_stmt|;
name|int
name|row
init|=
literal|0
decl_stmt|;
name|int
name|column
init|=
literal|0
decl_stmt|;
name|QModelIndex
name|index
init|=
name|model
operator|.
name|index
argument_list|(
name|row
argument_list|,
name|column
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
decl_stmt|;
name|view
operator|.
name|setCurrentIndex
argument_list|(
name|index
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|index
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|keymoves
operator|.
name|size
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|Qt
operator|::
name|Key
name|key
init|=
name|keymoves
operator|.
name|at
argument_list|(
name|i
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|view
argument_list|,
name|key
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|key
condition|)
block|{
case|case
name|Qt
operator|::
name|Key_Up
case|:
if|if
condition|(
name|row
operator|>
literal|0
condition|)
block|{
name|index
operator|=
name|index
operator|.
name|sibling
argument_list|(
name|row
operator|-
literal|1
argument_list|,
name|column
argument_list|)
expr_stmt|;
name|row
operator|-=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|index
operator|.
name|parent
argument_list|()
operator|!=
name|QModelIndex
argument_list|()
condition|)
block|{
name|index
operator|=
name|index
operator|.
name|parent
argument_list|()
expr_stmt|;
name|row
operator|=
name|index
operator|.
name|row
argument_list|()
expr_stmt|;
block|}
break|break;
case|case
name|Qt
operator|::
name|Key_Down
case|:
if|if
condition|(
name|view
operator|.
name|isExpanded
argument_list|(
name|index
argument_list|)
condition|)
block|{
name|row
operator|=
literal|0
expr_stmt|;
name|index
operator|=
name|index
operator|.
name|child
argument_list|(
name|row
argument_list|,
name|column
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|row
operator|=
name|qMin
argument_list|(
name|rows
operator|-
literal|1
argument_list|,
name|row
operator|+
literal|1
argument_list|)
expr_stmt|;
name|index
operator|=
name|index
operator|.
name|sibling
argument_list|(
name|row
argument_list|,
name|column
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|Qt
operator|::
name|Key_Left
case|:
block|{
name|QScrollBar
modifier|*
name|b
init|=
name|view
operator|.
name|horizontalScrollBar
argument_list|()
decl_stmt|;
if|if
condition|(
name|b
operator|->
name|value
argument_list|()
operator|==
name|b
operator|->
name|minimum
argument_list|()
condition|)
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isExpanded
argument_list|(
name|index
argument_list|)
argument_list|)
expr_stmt|;
comment|// windows style right will walk to the parent
if|if
condition|(
name|view
operator|.
name|currentIndex
argument_list|()
operator|!=
name|index
condition|)
block|{
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|index
operator|.
name|parent
argument_list|()
argument_list|)
expr_stmt|;
name|index
operator|=
name|view
operator|.
name|currentIndex
argument_list|()
expr_stmt|;
name|row
operator|=
name|index
operator|.
name|row
argument_list|()
expr_stmt|;
name|column
operator|=
name|index
operator|.
name|column
argument_list|()
expr_stmt|;
block|}
break|break;
block|}
case|case
name|Qt
operator|::
name|Key_Right
case|:
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|index
argument_list|)
argument_list|)
expr_stmt|;
comment|// windows style right will walk to the first child
if|if
condition|(
name|view
operator|.
name|currentIndex
argument_list|()
operator|!=
name|index
condition|)
block|{
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
operator|.
name|parent
argument_list|()
argument_list|,
name|index
argument_list|)
expr_stmt|;
name|row
operator|=
name|view
operator|.
name|currentIndex
argument_list|()
operator|.
name|row
argument_list|()
expr_stmt|;
name|column
operator|=
name|view
operator|.
name|currentIndex
argument_list|()
operator|.
name|column
argument_list|()
expr_stmt|;
name|index
operator|=
name|view
operator|.
name|currentIndex
argument_list|()
expr_stmt|;
block|}
break|break;
default|default:
name|QVERIFY
argument_list|(
literal|false
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
operator|.
name|row
argument_list|()
argument_list|,
name|row
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
operator|.
name|column
argument_list|()
argument_list|,
name|column
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|index
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_class
DECL|class|Dmodel
class|class
name|Dmodel
super|:
specifier|public
name|QtTestModel
block|{
public|public:
DECL|function|Dmodel
name|Dmodel
parameter_list|()
member_init_list|:
name|QtTestModel
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
block|{}
DECL|function|columnCount
name|int
name|columnCount
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|parent
parameter_list|)
specifier|const
block|{
if|if
condition|(
name|parent
operator|.
name|row
argument_list|()
operator|==
literal|5
condition|)
return|return
literal|1
return|;
return|return
name|QtTestModel
operator|::
name|columnCount
argument_list|(
name|parent
argument_list|)
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|headerSections
name|void
name|tst_QTreeView
operator|::
name|headerSections
parameter_list|()
block|{
name|Dmodel
name|model
decl_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|QHeaderView
modifier|*
name|header
init|=
name|view
operator|.
name|header
argument_list|()
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QModelIndex
name|index
init|=
name|model
operator|.
name|index
argument_list|(
literal|5
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|view
operator|.
name|setRootIndex
argument_list|(
name|index
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|model
operator|.
name|columnCount
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|model
operator|.
name|columnCount
argument_list|(
name|index
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|header
operator|->
name|count
argument_list|()
argument_list|,
name|model
operator|.
name|columnCount
argument_list|(
name|index
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|moveCursor_data
name|void
name|tst_QTreeView
operator|::
name|moveCursor_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"uniformRowHeights"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"scrollPerPixel"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"uniformRowHeights = false, scrollPerPixel = false"
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"uniformRowHeights = true, scrollPerPixel = false"
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"uniformRowHeights = false, scrollPerPixel = true"
argument_list|)
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"uniformRowHeights = true, scrollPerPixel = true"
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_function
DECL|function|moveCursor
name|void
name|tst_QTreeView
operator|::
name|moveCursor
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|uniformRowHeights
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|scrollPerPixel
argument_list|)
expr_stmt|;
name|QtTestModel
name|model
argument_list|(
literal|8
argument_list|,
literal|6
argument_list|)
decl_stmt|;
name|PublicView
name|view
decl_stmt|;
name|view
operator|.
name|setUniformRowHeights
argument_list|(
name|uniformRowHeights
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRowHidden
argument_list|(
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setVerticalScrollMode
argument_list|(
name|scrollPerPixel
condition|?
name|QAbstractItemView
operator|::
name|ScrollPerPixel
else|:
name|QAbstractItemView
operator|::
name|ScrollPerItem
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isRowHidden
argument_list|(
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setColumnHidden
argument_list|(
literal|0
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isColumnHidden
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
comment|//here the first visible index should be selected
comment|//because the view got the focus
name|QModelIndex
name|expected
init|=
name|model
operator|.
name|index
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|expected
argument_list|)
expr_stmt|;
comment|//then pressing down should go to the next line
name|QModelIndex
name|actual
init|=
name|view
operator|.
name|doMoveCursor
argument_list|(
name|PublicView
operator|::
name|MoveDown
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|)
decl_stmt|;
name|expected
operator|=
name|model
operator|.
name|index
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|actual
argument_list|,
name|expected
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRowHidden
argument_list|(
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|view
operator|.
name|setColumnHidden
argument_list|(
literal|0
argument_list|,
literal|false
argument_list|)
expr_stmt|;
comment|// PageUp was broken with uniform row heights turned on
name|view
operator|.
name|setCurrentIndex
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|actual
operator|=
name|view
operator|.
name|doMoveCursor
argument_list|(
name|PublicView
operator|::
name|MovePageUp
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|)
expr_stmt|;
name|expected
operator|=
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|actual
argument_list|,
name|expected
argument_list|)
expr_stmt|;
comment|//let's try another column
name|view
operator|.
name|setCurrentIndex
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSelectionBehavior
argument_list|(
name|QAbstractItemView
operator|::
name|SelectItems
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Up
argument_list|)
expr_stmt|;
name|expected
operator|=
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|expected
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Down
argument_list|)
expr_stmt|;
name|expected
operator|=
name|model
operator|.
name|index
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|expected
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Up
argument_list|)
expr_stmt|;
name|expected
operator|=
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|expected
argument_list|)
expr_stmt|;
name|view
operator|.
name|setColumnHidden
argument_list|(
literal|0
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Left
argument_list|)
expr_stmt|;
name|expected
operator|=
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
comment|//it shouldn't have changed
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|expected
argument_list|)
expr_stmt|;
name|view
operator|.
name|setColumnHidden
argument_list|(
literal|0
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Left
argument_list|)
expr_stmt|;
name|expected
operator|=
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|expected
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|TestDelegate
class|class
name|TestDelegate
super|:
specifier|public
name|QItemDelegate
block|{
public|public:
DECL|function|TestDelegate
name|TestDelegate
parameter_list|(
name|QObject
modifier|*
name|parent
parameter_list|)
member_init_list|:
name|QItemDelegate
argument_list|(
name|parent
argument_list|)
block|{}
DECL|function|sizeHint
name|QSize
name|sizeHint
parameter_list|(
specifier|const
name|QStyleOptionViewItem
modifier|&
parameter_list|,
specifier|const
name|QModelIndex
modifier|&
parameter_list|)
specifier|const
block|{
return|return
name|QSize
argument_list|(
literal|200
argument_list|,
literal|50
argument_list|)
return|;
block|}
block|}
class|;
end_class
begin_typedef
DECL|typedef|PointList
typedef|typedef
name|QList
argument_list|<
name|QPoint
argument_list|>
name|PointList
typedef|;
end_typedef
begin_function
DECL|function|setSelection_data
name|void
name|tst_QTreeView
operator|::
name|setSelection_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QRect
argument_list|>
argument_list|(
literal|"selectionRect"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"selectionMode"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"selectionCommand"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|PointList
argument_list|>
argument_list|(
literal|"expectedItems"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"verticalOffset"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(0,0,50,20),rows"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|20
argument_list|)
operator|<<
name|int
argument_list|(
name|QAbstractItemView
operator|::
name|SingleSelection
argument_list|)
operator|<<
name|int
argument_list|(
name|QItemSelectionModel
operator|::
name|ClearAndSelect
operator||
name|QItemSelectionModel
operator|::
name|Rows
argument_list|)
operator|<<
operator|(
name|PointList
argument_list|()
operator|<<
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|2
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|3
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|4
argument_list|,
literal|0
argument_list|)
operator|)
operator|<<
literal|0
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(0,0,50,90),rows"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|90
argument_list|)
operator|<<
name|int
argument_list|(
name|QAbstractItemView
operator|::
name|ExtendedSelection
argument_list|)
operator|<<
name|int
argument_list|(
name|QItemSelectionModel
operator|::
name|ClearAndSelect
operator||
name|QItemSelectionModel
operator|::
name|Rows
argument_list|)
operator|<<
operator|(
name|PointList
argument_list|()
operator|<<
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|2
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|3
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|4
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|3
argument_list|,
literal|1
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|4
argument_list|,
literal|1
argument_list|)
operator|)
operator|<<
literal|0
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(50,0,0,90),rows,invalid rect"
argument_list|)
operator|<<
name|QRect
argument_list|(
name|QPoint
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|90
argument_list|)
argument_list|)
operator|<<
name|int
argument_list|(
name|QAbstractItemView
operator|::
name|ExtendedSelection
argument_list|)
operator|<<
name|int
argument_list|(
name|QItemSelectionModel
operator|::
name|ClearAndSelect
operator||
name|QItemSelectionModel
operator|::
name|Rows
argument_list|)
operator|<<
operator|(
name|PointList
argument_list|()
operator|<<
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|2
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|3
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|4
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|3
argument_list|,
literal|1
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|4
argument_list|,
literal|1
argument_list|)
operator|)
operator|<<
literal|0
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(0,-20,20,50),rows"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
operator|-
literal|20
argument_list|,
literal|20
argument_list|,
literal|50
argument_list|)
operator|<<
name|int
argument_list|(
name|QAbstractItemView
operator|::
name|ExtendedSelection
argument_list|)
operator|<<
name|int
argument_list|(
name|QItemSelectionModel
operator|::
name|ClearAndSelect
operator||
name|QItemSelectionModel
operator|::
name|Rows
argument_list|)
operator|<<
operator|(
name|PointList
argument_list|()
operator|<<
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|2
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|3
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|4
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|3
argument_list|,
literal|1
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|4
argument_list|,
literal|1
argument_list|)
operator|)
operator|<<
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(0,-50,20,90),rows"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
operator|-
literal|50
argument_list|,
literal|20
argument_list|,
literal|90
argument_list|)
operator|<<
name|int
argument_list|(
name|QAbstractItemView
operator|::
name|ExtendedSelection
argument_list|)
operator|<<
name|int
argument_list|(
name|QItemSelectionModel
operator|::
name|ClearAndSelect
operator||
name|QItemSelectionModel
operator|::
name|Rows
argument_list|)
operator|<<
operator|(
name|PointList
argument_list|()
operator|<<
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|2
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|3
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|4
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|3
argument_list|,
literal|1
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|4
argument_list|,
literal|1
argument_list|)
operator|)
operator|<<
literal|1
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setSelection
name|void
name|tst_QTreeView
operator|::
name|setSelection
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QRect
argument_list|,
name|selectionRect
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|selectionMode
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|selectionCommand
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|PointList
argument_list|,
name|expectedItems
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|verticalOffset
argument_list|)
expr_stmt|;
name|QtTestModel
name|model
argument_list|(
literal|10
argument_list|,
literal|5
argument_list|)
decl_stmt|;
name|model
operator|.
name|levels
operator|=
literal|1
expr_stmt|;
name|model
operator|.
name|setDecorationsEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|PublicView
name|view
decl_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|400
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|view
operator|.
name|setRootIsDecorated
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|view
operator|.
name|setItemDelegate
argument_list|(
operator|new
name|TestDelegate
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSelectionMode
argument_list|(
name|QAbstractItemView
operator|::
name|SelectionMode
argument_list|(
name|selectionMode
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|setUniformRowHeights
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setVerticalScrollMode
argument_list|(
name|QAbstractItemView
operator|::
name|ScrollPerItem
argument_list|)
expr_stmt|;
name|view
operator|.
name|scrollTo
argument_list|(
name|model
operator|.
name|index
argument_list|(
name|verticalOffset
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QAbstractItemView
operator|::
name|PositionAtTop
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSelection
argument_list|(
name|selectionRect
argument_list|,
name|QItemSelectionModel
operator|::
name|SelectionFlags
argument_list|(
name|selectionCommand
argument_list|)
argument_list|)
expr_stmt|;
name|QItemSelectionModel
modifier|*
name|selectionModel
init|=
name|view
operator|.
name|selectionModel
argument_list|()
decl_stmt|;
name|QVERIFY
argument_list|(
name|selectionModel
argument_list|)
expr_stmt|;
name|QModelIndexList
name|selectedIndexes
init|=
name|selectionModel
operator|->
name|selectedIndexes
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|selectedIndexes
operator|.
name|count
argument_list|()
argument_list|,
name|expectedItems
operator|.
name|count
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|selectedIndexes
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QModelIndex
name|idx
init|=
name|selectedIndexes
operator|.
name|at
argument_list|(
name|i
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|expectedItems
operator|.
name|contains
argument_list|(
name|QPoint
argument_list|(
name|idx
operator|.
name|column
argument_list|()
argument_list|,
name|idx
operator|.
name|row
argument_list|()
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|indexAbove
name|void
name|tst_QTreeView
operator|::
name|indexAbove
parameter_list|()
block|{
name|QtTestModel
name|model
argument_list|(
literal|6
argument_list|,
literal|7
argument_list|)
decl_stmt|;
name|model
operator|.
name|levels
operator|=
literal|2
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indexAbove
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indexAbove
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QStack
argument_list|<
name|QModelIndex
argument_list|>
name|parents
decl_stmt|;
name|parents
operator|.
name|push
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
while|while
condition|(
operator|!
name|parents
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|QModelIndex
name|p
init|=
name|parents
operator|.
name|pop
argument_list|()
decl_stmt|;
if|if
condition|(
name|model
operator|.
name|canFetchMore
argument_list|(
name|p
argument_list|)
condition|)
name|model
operator|.
name|fetchMore
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|int
name|rows
init|=
name|model
operator|.
name|rowCount
argument_list|(
name|p
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|r
init|=
name|rows
operator|-
literal|1
init|;
name|r
operator|>
literal|0
condition|;
operator|--
name|r
control|)
block|{
for|for
control|(
name|int
name|column
init|=
literal|0
init|;
name|column
operator|<
literal|3
condition|;
operator|++
name|column
control|)
block|{
name|QModelIndex
name|idx
init|=
name|model
operator|.
name|index
argument_list|(
name|r
argument_list|,
name|column
argument_list|,
name|p
argument_list|)
decl_stmt|;
name|QModelIndex
name|expected
init|=
name|model
operator|.
name|index
argument_list|(
name|r
operator|-
literal|1
argument_list|,
name|column
argument_list|,
name|p
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indexAbove
argument_list|(
name|idx
argument_list|)
argument_list|,
name|expected
argument_list|)
expr_stmt|;
block|}
block|}
comment|// hide even rows
for|for
control|(
name|int
name|r
init|=
literal|0
init|;
name|r
operator|<
name|rows
condition|;
name|r
operator|+=
literal|2
control|)
name|view
operator|.
name|setRowHidden
argument_list|(
name|r
argument_list|,
name|p
argument_list|,
literal|true
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|r
init|=
name|rows
operator|-
literal|1
init|;
name|r
operator|>
literal|0
condition|;
name|r
operator|-=
literal|2
control|)
block|{
for|for
control|(
name|int
name|column
init|=
literal|0
init|;
name|column
operator|<
literal|3
condition|;
operator|++
name|column
control|)
block|{
name|QModelIndex
name|idx
init|=
name|model
operator|.
name|index
argument_list|(
name|r
argument_list|,
name|column
argument_list|,
name|p
argument_list|)
decl_stmt|;
name|QModelIndex
name|expected
init|=
name|model
operator|.
name|index
argument_list|(
name|r
operator|-
literal|2
argument_list|,
name|column
argument_list|,
name|p
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indexAbove
argument_list|(
name|idx
argument_list|)
argument_list|,
name|expected
argument_list|)
expr_stmt|;
block|}
block|}
comment|//        for (int r = 0; r< rows; ++r)
comment|//            parents.push(model.index(r, 0, p));
block|}
block|}
end_function
begin_function
DECL|function|indexBelow
name|void
name|tst_QTreeView
operator|::
name|indexBelow
parameter_list|()
block|{
name|QtTestModel
name|model
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
decl_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
block|{
name|QModelIndex
name|i
init|=
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|rootIndex
argument_list|()
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|i
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i
operator|.
name|row
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i
operator|.
name|column
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|i
operator|=
name|view
operator|.
name|indexBelow
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|i
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i
operator|.
name|row
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i
operator|.
name|column
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|i
operator|=
name|view
operator|.
name|indexBelow
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|i
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
name|QModelIndex
name|i
init|=
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
name|view
operator|.
name|rootIndex
argument_list|()
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|i
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i
operator|.
name|row
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i
operator|.
name|column
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|i
operator|=
name|view
operator|.
name|indexBelow
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|i
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i
operator|.
name|row
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i
operator|.
name|column
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|i
operator|=
name|view
operator|.
name|indexBelow
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|i
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|clicked
name|void
name|tst_QTreeView
operator|::
name|clicked
parameter_list|()
block|{
name|QtTestModel
name|model
argument_list|(
literal|10
argument_list|,
literal|2
argument_list|)
decl_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QModelIndex
name|firstIndex
init|=
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|firstIndex
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|int
name|itemHeight
init|=
name|view
operator|.
name|visualRect
argument_list|(
name|firstIndex
argument_list|)
operator|.
name|height
argument_list|()
decl_stmt|;
name|int
name|itemOffset
init|=
name|view
operator|.
name|visualRect
argument_list|(
name|firstIndex
argument_list|)
operator|.
name|width
argument_list|()
operator|/
literal|2
decl_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
name|itemHeight
operator|*
operator|(
name|model
operator|.
name|rows
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|model
operator|.
name|rowCount
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QPoint
name|p
argument_list|(
name|itemOffset
argument_list|,
literal|1
operator|+
name|itemHeight
operator|*
name|i
argument_list|)
decl_stmt|;
name|QModelIndex
name|index
init|=
name|view
operator|.
name|indexAt
argument_list|(
name|p
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|index
operator|.
name|isValid
argument_list|()
condition|)
continue|continue;
name|QSignalSpy
name|spy
argument_list|(
operator|&
name|view
argument_list|,
name|SIGNAL
argument_list|(
name|clicked
argument_list|(
name|QModelIndex
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|mouseDoubleClick
name|void
name|tst_QTreeView
operator|::
name|mouseDoubleClick
parameter_list|()
block|{
comment|// Test double clicks outside the viewport.
comment|// (Should be a no-op and should not expand any item.)
name|QStandardItemModel
name|model
argument_list|(
literal|20
argument_list|,
literal|2
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|model
operator|.
name|rowCount
argument_list|()
condition|;
name|i
operator|++
control|)
block|{
name|QModelIndex
name|index
init|=
name|model
operator|.
name|index
argument_list|(
name|i
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
decl_stmt|;
name|model
operator|.
name|insertRows
argument_list|(
literal|0
argument_list|,
literal|20
argument_list|,
name|index
argument_list|)
expr_stmt|;
name|model
operator|.
name|insertColumns
argument_list|(
literal|0
argument_list|,
literal|2
argument_list|,
name|index
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i1
init|=
literal|0
init|;
name|i1
operator|<
name|model
operator|.
name|rowCount
argument_list|(
name|index
argument_list|)
condition|;
name|i1
operator|++
control|)
block|{
operator|(
name|void
operator|)
name|model
operator|.
name|index
argument_list|(
name|i1
argument_list|,
literal|0
argument_list|,
name|index
argument_list|)
expr_stmt|;
block|}
block|}
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
comment|// make sure the viewport height is smaller than the contents height.
name|view
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|view
operator|.
name|move
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QModelIndex
name|index
init|=
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
decl_stmt|;
name|view
operator|.
name|setCurrentIndex
argument_list|(
name|index
argument_list|)
expr_stmt|;
name|view
operator|.
name|setExpanded
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setHorizontalScrollBarPolicy
argument_list|(
name|Qt
operator|::
name|ScrollBarAlwaysOn
argument_list|)
expr_stmt|;
name|view
operator|.
name|setVerticalScrollBarPolicy
argument_list|(
name|Qt
operator|::
name|ScrollBarAlwaysOn
argument_list|)
expr_stmt|;
comment|// Make sure all items are collapsed
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|model
operator|.
name|rowCount
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|view
operator|.
name|setExpanded
argument_list|(
name|model
operator|.
name|index
argument_list|(
name|i
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
name|int
name|maximum
init|=
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|maximum
argument_list|()
decl_stmt|;
comment|// Doubleclick in the bottom right corner, in the unused area between the vertical and horizontal scrollbar.
name|int
name|vsw
init|=
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|width
argument_list|()
decl_stmt|;
name|int
name|hsh
init|=
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|height
argument_list|()
decl_stmt|;
name|QTest
operator|::
name|mouseDClick
argument_list|(
operator|&
name|view
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|,
name|QPoint
argument_list|(
name|view
operator|.
name|width
argument_list|()
operator|-
name|vsw
operator|+
literal|1
argument_list|,
name|view
operator|.
name|height
argument_list|()
operator|-
name|hsh
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
comment|// Should not have expanded, thus maximum() should have the same value.
name|QCOMPARE
argument_list|(
name|maximum
argument_list|,
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|maximum
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setExpandsOnDoubleClick
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseDClick
argument_list|(
operator|&
name|view
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|,
name|view
operator|.
name|visualRect
argument_list|(
name|index
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isExpanded
argument_list|(
name|index
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|rowsAboutToBeRemoved
name|void
name|tst_QTreeView
operator|::
name|rowsAboutToBeRemoved
parameter_list|()
block|{
name|QStandardItemModel
name|model
argument_list|(
literal|3
argument_list|,
literal|1
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|model
operator|.
name|rowCount
argument_list|()
condition|;
name|i
operator|++
control|)
block|{
name|QModelIndex
name|index
init|=
name|model
operator|.
name|index
argument_list|(
name|i
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
decl_stmt|;
name|model
operator|.
name|setData
argument_list|(
name|index
argument_list|,
name|QString
argument_list|(
literal|"%1"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|insertRows
argument_list|(
literal|0
argument_list|,
literal|4
argument_list|,
name|index
argument_list|)
expr_stmt|;
name|model
operator|.
name|insertColumns
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
name|index
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i1
init|=
literal|0
init|;
name|i1
operator|<
name|model
operator|.
name|rowCount
argument_list|(
name|index
argument_list|)
condition|;
name|i1
operator|++
control|)
block|{
name|QModelIndex
name|index2
init|=
name|model
operator|.
name|index
argument_list|(
name|i1
argument_list|,
literal|0
argument_list|,
name|index
argument_list|)
decl_stmt|;
name|model
operator|.
name|setData
argument_list|(
name|index2
argument_list|,
name|QString
argument_list|(
literal|"%1%2"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
operator|.
name|arg
argument_list|(
name|i1
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|PublicView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QModelIndex
name|index
init|=
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
decl_stmt|;
name|view
operator|.
name|setCurrentIndex
argument_list|(
name|index
argument_list|)
expr_stmt|;
name|view
operator|.
name|setExpanded
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|model
operator|.
name|rowCount
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
condition|;
name|i
operator|++
control|)
block|{
name|view
operator|.
name|setExpanded
argument_list|(
name|model
operator|.
name|index
argument_list|(
name|i
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
name|QSignalSpy
name|spy1
argument_list|(
operator|&
name|model
argument_list|,
name|SIGNAL
argument_list|(
name|rowsAboutToBeRemoved
argument_list|(
name|QModelIndex
argument_list|,
name|int
argument_list|,
name|int
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|model
operator|.
name|removeRows
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|state
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Should not be 5 (or any other number for that sake :)
name|QCOMPARE
argument_list|(
name|spy1
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|headerSections_unhideSection
name|void
name|tst_QTreeView
operator|::
name|headerSections_unhideSection
parameter_list|()
block|{
name|QtTestModel
name|model
argument_list|(
literal|10
argument_list|,
literal|7
argument_list|)
decl_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|int
name|size
init|=
name|view
operator|.
name|header
argument_list|()
operator|->
name|sectionSize
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|view
operator|.
name|setColumnHidden
argument_list|(
literal|0
argument_list|,
literal|true
argument_list|)
expr_stmt|;
comment|// should go back to old size
name|view
operator|.
name|setColumnHidden
argument_list|(
literal|0
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|size
argument_list|,
name|view
operator|.
name|header
argument_list|()
operator|->
name|sectionSize
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|columnAt
name|void
name|tst_QTreeView
operator|::
name|columnAt
parameter_list|()
block|{
name|QtTestModel
name|model
decl_stmt|;
name|model
operator|.
name|rows
operator|=
name|model
operator|.
name|cols
operator|=
literal|10
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|500
argument_list|,
literal|500
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|columnAt
argument_list|(
literal|0
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// really this is testing the header... so not much more should be needed if the header is working...
block|}
end_function
begin_function
DECL|function|scrollTo
name|void
name|tst_QTreeView
operator|::
name|scrollTo
parameter_list|()
block|{
DECL|macro|CHECK_VISIBLE
define|#
directive|define
name|CHECK_VISIBLE
parameter_list|(
name|ROW
parameter_list|,
name|COL
parameter_list|)
value|QVERIFY(QRect(QPoint(),view.viewport()->size()).contains(\                     view.visualRect(model.index((ROW),(COL),QModelIndex()))))
name|QtTestModel
name|model
decl_stmt|;
name|model
operator|.
name|rows
operator|=
name|model
operator|.
name|cols
operator|=
literal|100
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setUniformRowHeights
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|scrollTo
argument_list|(
name|QModelIndex
argument_list|()
argument_list|,
name|QTreeView
operator|::
name|PositionAtTop
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
comment|// ### check the scrollbar values an make sure it actually scrolls to the item
comment|// ### check for bot item based and pixel based scrolling
comment|// ### create a data function for this test
name|view
operator|.
name|scrollTo
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|scrollTo
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|scrollTo
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
name|QTreeView
operator|::
name|PositionAtTop
argument_list|)
expr_stmt|;
name|view
operator|.
name|scrollTo
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
name|QTreeView
operator|::
name|PositionAtBottom
argument_list|)
expr_stmt|;
comment|//
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|view
operator|.
name|setVerticalScrollMode
argument_list|(
name|QAbstractItemView
operator|::
name|ScrollPerItem
argument_list|)
expr_stmt|;
comment|//some styles change that in Polish
name|view
operator|.
name|resize
argument_list|(
literal|300
argument_list|,
literal|200
argument_list|)
expr_stmt|;
comment|//view.verticalScrollBar()->setValue(0);
name|view
operator|.
name|scrollTo
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|CHECK_VISIBLE
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|header
argument_list|()
operator|->
name|resizeSection
argument_list|(
literal|0
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|// now we only see the branches
name|view
operator|.
name|scrollTo
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|5
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|,
name|QTreeView
operator|::
name|PositionAtTop
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|view
operator|.
name|scrollTo
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|60
argument_list|,
literal|60
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|CHECK_VISIBLE
argument_list|(
literal|60
argument_list|,
literal|60
argument_list|)
expr_stmt|;
name|view
operator|.
name|scrollTo
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|60
argument_list|,
literal|30
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|CHECK_VISIBLE
argument_list|(
literal|60
argument_list|,
literal|30
argument_list|)
expr_stmt|;
name|view
operator|.
name|scrollTo
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|CHECK_VISIBLE
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|)
expr_stmt|;
comment|// TODO force it to move to the left and then the right
block|}
end_function
begin_function
DECL|function|rowsAboutToBeRemoved_move
name|void
name|tst_QTreeView
operator|::
name|rowsAboutToBeRemoved_move
parameter_list|()
block|{
name|QStandardItemModel
name|model
argument_list|(
literal|3
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QModelIndex
name|indexThatWantsToLiveButWillDieDieITellYou
decl_stmt|;
name|QModelIndex
name|parent
init|=
name|model
operator|.
name|index
argument_list|(
literal|2
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|view
operator|.
name|expand
argument_list|(
name|parent
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|6
condition|;
operator|++
name|i
control|)
block|{
name|model
operator|.
name|insertRows
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
name|parent
argument_list|)
expr_stmt|;
name|model
operator|.
name|insertColumns
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
name|parent
argument_list|)
expr_stmt|;
name|QModelIndex
name|index
init|=
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|parent
argument_list|)
decl_stmt|;
name|view
operator|.
name|expand
argument_list|(
name|index
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|3
condition|)
name|indexThatWantsToLiveButWillDieDieITellYou
operator|=
name|index
expr_stmt|;
name|model
operator|.
name|setData
argument_list|(
name|index
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|parent
operator|=
name|index
expr_stmt|;
block|}
name|view
operator|.
name|resize
argument_list|(
literal|600
argument_list|,
literal|800
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|view
operator|.
name|doItemsLayout
argument_list|()
expr_stmt|;
cast|static_cast
argument_list|<
name|PublicView
operator|*
argument_list|>
argument_list|(
operator|&
name|view
argument_list|)
operator|->
name|executeDelayedItemsLayout
argument_list|()
expr_stmt|;
name|parent
operator|=
name|indexThatWantsToLiveButWillDieDieITellYou
operator|.
name|parent
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|indexThatWantsToLiveButWillDieDieITellYou
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|.
name|isValid
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|.
name|parent
argument_list|()
operator|.
name|isValid
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|expand
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|parent
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|indexThatWantsToLiveButWillDieDieITellYou
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|model
operator|.
name|removeRow
argument_list|(
literal|0
argument_list|,
name|indexThatWantsToLiveButWillDieDieITellYou
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|parent
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|indexThatWantsToLiveButWillDieDieITellYou
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|resizeColumnToContents
name|void
name|tst_QTreeView
operator|::
name|resizeColumnToContents
parameter_list|()
block|{
name|QStandardItemModel
name|model
argument_list|(
literal|50
argument_list|,
literal|2
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|r
init|=
literal|0
init|;
name|r
operator|<
name|model
operator|.
name|rowCount
argument_list|()
condition|;
operator|++
name|r
control|)
block|{
for|for
control|(
name|int
name|c
init|=
literal|0
init|;
name|c
operator|<
name|model
operator|.
name|columnCount
argument_list|()
condition|;
operator|++
name|c
control|)
block|{
name|QModelIndex
name|idx
init|=
name|model
operator|.
name|index
argument_list|(
name|r
argument_list|,
name|c
argument_list|)
decl_stmt|;
name|model
operator|.
name|setData
argument_list|(
name|idx
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"%1,%2"
argument_list|)
operator|.
name|arg
argument_list|(
name|r
argument_list|)
operator|.
name|arg
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|insertColumns
argument_list|(
literal|0
argument_list|,
literal|2
argument_list|,
name|idx
argument_list|)
expr_stmt|;
name|model
operator|.
name|insertRows
argument_list|(
literal|0
argument_list|,
literal|6
argument_list|,
name|idx
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|6
condition|;
operator|++
name|i
control|)
block|{
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
literal|2
condition|;
operator|++
name|j
control|)
block|{
name|model
operator|.
name|setData
argument_list|(
name|model
operator|.
name|index
argument_list|(
name|i
argument_list|,
name|j
argument_list|,
name|idx
argument_list|)
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"child%1%2"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
operator|.
name|arg
argument_list|(
name|j
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|//must have this, or else it will not scroll
name|view
operator|.
name|scrollToBottom
argument_list|()
expr_stmt|;
name|view
operator|.
name|resizeColumnToContents
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|int
name|oldColumnSize
init|=
name|view
operator|.
name|header
argument_list|()
operator|->
name|sectionSize
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|view
operator|.
name|setRootIndex
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|resizeColumnToContents
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|//Earlier, this gave an assert
name|QVERIFY
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|->
name|sectionSize
argument_list|(
literal|0
argument_list|)
operator|>
name|oldColumnSize
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|insertAfterSelect
name|void
name|tst_QTreeView
operator|::
name|insertAfterSelect
parameter_list|()
block|{
name|QtTestModel
name|model
decl_stmt|;
name|model
operator|.
name|rows
operator|=
name|model
operator|.
name|cols
operator|=
literal|10
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QModelIndex
name|firstIndex
init|=
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|firstIndex
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|int
name|itemOffset
init|=
name|view
operator|.
name|visualRect
argument_list|(
name|firstIndex
argument_list|)
operator|.
name|width
argument_list|()
operator|/
literal|2
decl_stmt|;
name|QPoint
name|p
argument_list|(
name|itemOffset
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|isSelected
argument_list|(
name|firstIndex
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|insertNewRow
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|isSelected
argument_list|(
name|firstIndex
argument_list|)
argument_list|)
expr_stmt|;
comment|// Should still be selected
block|}
end_function
begin_function
DECL|function|removeAfterSelect
name|void
name|tst_QTreeView
operator|::
name|removeAfterSelect
parameter_list|()
block|{
name|QtTestModel
name|model
decl_stmt|;
name|model
operator|.
name|rows
operator|=
name|model
operator|.
name|cols
operator|=
literal|10
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QModelIndex
name|firstIndex
init|=
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|firstIndex
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|int
name|itemOffset
init|=
name|view
operator|.
name|visualRect
argument_list|(
name|firstIndex
argument_list|)
operator|.
name|width
argument_list|()
operator|/
literal|2
decl_stmt|;
name|QPoint
name|p
argument_list|(
name|itemOffset
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|isSelected
argument_list|(
name|firstIndex
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|removeLastRow
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|isSelected
argument_list|(
name|firstIndex
argument_list|)
argument_list|)
expr_stmt|;
comment|// Should still be selected
block|}
end_function
begin_function
DECL|function|hiddenItems
name|void
name|tst_QTreeView
operator|::
name|hiddenItems
parameter_list|()
block|{
name|QtTestModel
name|model
decl_stmt|;
name|model
operator|.
name|rows
operator|=
name|model
operator|.
name|cols
operator|=
literal|10
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QModelIndex
name|firstIndex
init|=
name|model
operator|.
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|firstIndex
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|model
operator|.
name|canFetchMore
argument_list|(
name|firstIndex
argument_list|)
condition|)
name|model
operator|.
name|fetchMore
argument_list|(
name|firstIndex
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|model
operator|.
name|rowCount
argument_list|(
name|firstIndex
argument_list|)
condition|;
name|i
operator|++
control|)
name|view
operator|.
name|setRowHidden
argument_list|(
name|i
argument_list|,
name|firstIndex
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|int
name|itemOffset
init|=
name|view
operator|.
name|visualRect
argument_list|(
name|firstIndex
argument_list|)
operator|.
name|width
argument_list|()
operator|/
literal|2
decl_stmt|;
name|int
name|itemHeight
init|=
name|view
operator|.
name|visualRect
argument_list|(
name|firstIndex
argument_list|)
operator|.
name|height
argument_list|()
decl_stmt|;
name|QPoint
name|p
argument_list|(
name|itemOffset
argument_list|,
name|itemHeight
operator|+
literal|1
argument_list|)
decl_stmt|;
name|view
operator|.
name|setExpanded
argument_list|(
name|firstIndex
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseDClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|firstIndex
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|p
operator|.
name|setX
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|firstIndex
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|spanningItems
name|void
name|tst_QTreeView
operator|::
name|spanningItems
parameter_list|()
block|{
name|QtTestModel
name|model
decl_stmt|;
name|model
operator|.
name|rows
operator|=
name|model
operator|.
name|cols
operator|=
literal|10
expr_stmt|;
name|PublicView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|int
name|itemWidth
init|=
name|view
operator|.
name|header
argument_list|()
operator|->
name|sectionSize
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|int
name|itemHeight
init|=
name|view
operator|.
name|visualRect
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
operator|.
name|height
argument_list|()
decl_stmt|;
comment|// every second row is spanning
for|for
control|(
name|int
name|i
init|=
literal|1
init|;
name|i
operator|<
name|model
operator|.
name|rowCount
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
condition|;
name|i
operator|+=
literal|2
control|)
name|view
operator|.
name|setFirstColumnSpanned
argument_list|(
name|i
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
comment|// non-spanning item
name|QPoint
name|p
argument_list|(
name|itemWidth
operator|/
literal|2
argument_list|,
name|itemHeight
operator|/
literal|2
argument_list|)
decl_stmt|;
comment|// column 0, row 0
name|view
operator|.
name|setCurrentIndex
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|->
name|sectionSize
argument_list|(
literal|0
argument_list|)
operator|-
name|view
operator|.
name|indentation
argument_list|()
argument_list|,
name|view
operator|.
name|visualRect
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
operator|.
name|width
argument_list|()
argument_list|)
expr_stmt|;
comment|// spanning item
name|p
operator|.
name|setX
argument_list|(
name|itemWidth
operator|+
operator|(
name|itemWidth
operator|/
literal|2
operator|)
argument_list|)
expr_stmt|;
comment|// column 1
name|p
operator|.
name|setY
argument_list|(
name|itemHeight
operator|+
operator|(
name|itemHeight
operator|/
literal|2
operator|)
argument_list|)
expr_stmt|;
comment|// row 1
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|model
operator|.
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|->
name|length
argument_list|()
operator|-
name|view
operator|.
name|indentation
argument_list|()
argument_list|,
name|view
operator|.
name|visualRect
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
operator|.
name|width
argument_list|()
argument_list|)
expr_stmt|;
comment|// size hint
comment|// every second row is un-spanned
name|QStyleOptionViewItem
name|option
init|=
name|view
operator|.
name|viewOptions
argument_list|()
decl_stmt|;
name|int
name|w
init|=
name|view
operator|.
name|header
argument_list|()
operator|->
name|sectionSizeHint
argument_list|(
literal|0
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|model
operator|.
name|rowCount
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
condition|;
operator|++
name|i
control|)
block|{
if|if
condition|(
operator|!
name|view
operator|.
name|isFirstColumnSpanned
argument_list|(
name|i
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
condition|)
block|{
name|QModelIndex
name|index
init|=
name|model
operator|.
name|index
argument_list|(
name|i
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
decl_stmt|;
name|w
operator|=
name|qMax
argument_list|(
name|w
argument_list|,
name|view
operator|.
name|itemDelegate
argument_list|(
name|index
argument_list|)
operator|->
name|sizeHint
argument_list|(
name|option
argument_list|,
name|index
argument_list|)
operator|.
name|width
argument_list|()
operator|+
name|view
operator|.
name|indentation
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sizeHintForColumn
argument_list|(
literal|0
argument_list|)
argument_list|,
name|w
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|selectionOrderTest
name|void
name|tst_QTreeView
operator|::
name|selectionOrderTest
parameter_list|()
block|{
name|QVERIFY
argument_list|(
operator|(
operator|(
name|QItemSelectionModel
operator|*
operator|)
name|sender
argument_list|()
operator|)
operator|->
name|currentIndex
argument_list|()
operator|.
name|row
argument_list|()
operator|!=
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|selection
name|void
name|tst_QTreeView
operator|::
name|selection
parameter_list|()
block|{
if|if
condition|(
name|qApp
operator|->
name|platformName
argument_list|()
operator|.
name|toLower
argument_list|()
operator|==
name|QLatin1String
argument_list|(
literal|"wayland"
argument_list|)
condition|)
name|QSKIP
argument_list|(
literal|"Wayland: This causes a crash triggered by setVisible(false)"
argument_list|)
expr_stmt|;
name|QTreeView
name|treeView
decl_stmt|;
name|QStandardItemModel
name|m
argument_list|(
literal|10
argument_list|,
literal|2
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
operator|++
name|i
control|)
name|m
operator|.
name|setData
argument_list|(
name|m
operator|.
name|index
argument_list|(
name|i
argument_list|,
literal|0
argument_list|)
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|treeView
operator|.
name|setModel
argument_list|(
operator|&
name|m
argument_list|)
expr_stmt|;
name|treeView
operator|.
name|setSelectionBehavior
argument_list|(
name|QAbstractItemView
operator|::
name|SelectRows
argument_list|)
expr_stmt|;
name|treeView
operator|.
name|setSelectionMode
argument_list|(
name|QAbstractItemView
operator|::
name|ExtendedSelection
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|treeView
operator|.
name|selectionModel
argument_list|()
argument_list|,
name|SIGNAL
argument_list|(
name|selectionChanged
argument_list|(
name|QItemSelection
argument_list|,
name|QItemSelection
argument_list|)
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|selectionOrderTest
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|treeView
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|mousePress
argument_list|(
name|treeView
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|treeView
operator|.
name|visualRect
argument_list|(
name|m
operator|.
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|treeView
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Down
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|//From task 151686 QTreeView ExtendedSelection selects hidden rows
end_comment
begin_function
DECL|function|selectionWithHiddenItems
name|void
name|tst_QTreeView
operator|::
name|selectionWithHiddenItems
parameter_list|()
block|{
name|QStandardItemModel
name|model
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|model
operator|.
name|rowCount
argument_list|()
condition|;
operator|++
name|i
control|)
name|model
operator|.
name|setData
argument_list|(
name|model
operator|.
name|index
argument_list|(
name|i
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QString
argument_list|(
literal|"row %1"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|QStandardItem
name|item0
argument_list|(
literal|"row 0"
argument_list|)
decl_stmt|;
name|QStandardItem
name|item1
argument_list|(
literal|"row 1"
argument_list|)
decl_stmt|;
name|QStandardItem
name|item2
argument_list|(
literal|"row 2"
argument_list|)
decl_stmt|;
name|QStandardItem
name|item3
argument_list|(
literal|"row 3"
argument_list|)
decl_stmt|;
name|model
operator|.
name|appendColumn
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|&
name|item0
operator|<<
operator|&
name|item1
operator|<<
operator|&
name|item2
operator|<<
operator|&
name|item3
argument_list|)
expr_stmt|;
name|QStandardItem
name|child
argument_list|(
literal|"child"
argument_list|)
decl_stmt|;
name|item1
operator|.
name|appendRow
argument_list|(
operator|&
name|child
argument_list|)
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSelectionMode
argument_list|(
name|QAbstractItemView
operator|::
name|ExtendedSelection
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|//child should not be selected as it is hidden (its parent is not expanded)
name|view
operator|.
name|selectAll
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|selection
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//one range
name|QCOMPARE
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|selectedRows
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|view
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|item1
operator|.
name|index
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|selection
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|selectedRows
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|isSelected
argument_list|(
name|model
operator|.
name|indexFromItem
argument_list|(
operator|&
name|child
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|clearSelection
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|item1
operator|.
name|index
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
comment|//child should be selected as it is visible (its parent is expanded)
name|view
operator|.
name|selectAll
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|selection
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|selectedRows
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|//everything is selected
name|view
operator|.
name|clearSelection
argument_list|()
expr_stmt|;
comment|//we hide the node with a child (there should then be 3 items selected in 2 ranges)
name|view
operator|.
name|setRowHidden
argument_list|(
literal|1
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|item1
operator|.
name|index
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|view
operator|.
name|selectAll
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|selection
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|selectedRows
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|isSelected
argument_list|(
name|model
operator|.
name|indexFromItem
argument_list|(
operator|&
name|item1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|isSelected
argument_list|(
name|model
operator|.
name|indexFromItem
argument_list|(
operator|&
name|child
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRowHidden
argument_list|(
literal|1
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|item1
operator|.
name|index
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|clearSelection
argument_list|()
expr_stmt|;
comment|//we hide a node without children (there should then be 4 items selected in 3 ranges)
name|view
operator|.
name|setRowHidden
argument_list|(
literal|2
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|item1
operator|.
name|index
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|selectAll
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|item1
operator|.
name|index
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|selection
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|selectedRows
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|isSelected
argument_list|(
name|model
operator|.
name|indexFromItem
argument_list|(
operator|&
name|item2
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRowHidden
argument_list|(
literal|2
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|item1
operator|.
name|index
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|clearSelection
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|selectAll
name|void
name|tst_QTreeView
operator|::
name|selectAll
parameter_list|()
block|{
name|QStandardItemModel
name|model
argument_list|(
literal|4
argument_list|,
literal|4
argument_list|)
decl_stmt|;
name|PublicView
name|view2
decl_stmt|;
name|view2
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view2
operator|.
name|setSelectionMode
argument_list|(
name|QAbstractItemView
operator|::
name|ExtendedSelection
argument_list|)
expr_stmt|;
name|view2
operator|.
name|selectAll
argument_list|()
expr_stmt|;
comment|// Should work with an empty model
comment|//everything should be selected since we are in ExtendedSelection mode
name|QCOMPARE
argument_list|(
name|view2
operator|.
name|selectedIndexes
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
name|model
operator|.
name|rowCount
argument_list|()
operator|*
name|model
operator|.
name|columnCount
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|model
operator|.
name|rowCount
argument_list|()
condition|;
operator|++
name|i
control|)
name|model
operator|.
name|setData
argument_list|(
name|model
operator|.
name|index
argument_list|(
name|i
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QString
argument_list|(
literal|"row %1"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|PublicView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|int
name|selectedCount
init|=
name|view
operator|.
name|selectedIndexes
argument_list|()
operator|.
name|count
argument_list|()
decl_stmt|;
name|view
operator|.
name|selectAll
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|selectedIndexes
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
name|selectedCount
argument_list|)
expr_stmt|;
name|PublicView
name|view3
decl_stmt|;
name|view3
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view3
operator|.
name|setSelectionMode
argument_list|(
name|QAbstractItemView
operator|::
name|NoSelection
argument_list|)
expr_stmt|;
name|view3
operator|.
name|selectAll
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view3
operator|.
name|selectedIndexes
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|extendedSelection_data
name|void
name|tst_QTreeView
operator|::
name|extendedSelection_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QPoint
argument_list|>
argument_list|(
literal|"mousePressPos"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"selectedCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"select"
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
literal|2
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"unselect"
argument_list|)
operator|<<
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|300
argument_list|)
operator|<<
literal|0
expr_stmt|;
block|}
end_function
begin_function
DECL|function|extendedSelection
name|void
name|tst_QTreeView
operator|::
name|extendedSelection
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QPoint
argument_list|,
name|mousePressPos
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|selectedCount
argument_list|)
expr_stmt|;
name|QStandardItemModel
name|model
argument_list|(
literal|5
argument_list|,
literal|2
argument_list|)
decl_stmt|;
name|QWidget
name|topLevel
decl_stmt|;
name|QTreeView
name|view
argument_list|(
operator|&
name|topLevel
argument_list|)
decl_stmt|;
name|view
operator|.
name|resize
argument_list|(
name|qMax
argument_list|(
name|mousePressPos
operator|.
name|x
argument_list|()
operator|*
literal|2
argument_list|,
literal|300
argument_list|)
argument_list|,
name|qMax
argument_list|(
name|mousePressPos
operator|.
name|y
argument_list|()
operator|*
literal|2
argument_list|,
literal|350
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSelectionMode
argument_list|(
name|QAbstractItemView
operator|::
name|ExtendedSelection
argument_list|)
expr_stmt|;
name|topLevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|mousePress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|mousePressPos
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|selectedIndexes
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
name|selectedCount
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|rowSizeHint
name|void
name|tst_QTreeView
operator|::
name|rowSizeHint
parameter_list|()
block|{
comment|//tests whether the correct visible columns are taken into account when
comment|//calculating the height of a line
name|QStandardItemModel
name|model
argument_list|(
literal|1
argument_list|,
literal|3
argument_list|)
decl_stmt|;
name|model
operator|.
name|setData
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QSize
argument_list|(
literal|20
argument_list|,
literal|40
argument_list|)
argument_list|,
name|Qt
operator|::
name|SizeHintRole
argument_list|)
expr_stmt|;
name|model
operator|.
name|setData
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
argument_list|,
name|QSize
argument_list|(
literal|20
argument_list|,
literal|10
argument_list|)
argument_list|,
name|Qt
operator|::
name|SizeHintRole
argument_list|)
expr_stmt|;
name|model
operator|.
name|setData
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|2
argument_list|)
argument_list|,
name|QSize
argument_list|(
literal|20
argument_list|,
literal|10
argument_list|)
argument_list|,
name|Qt
operator|::
name|SizeHintRole
argument_list|)
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|header
argument_list|()
operator|->
name|moveSection
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|//the 2nd column goes to the 1st place
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
comment|//it must be 40 since the tallest item that defines the height of a line
name|QCOMPARE
argument_list|(
name|view
operator|.
name|visualRect
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
operator|.
name|height
argument_list|()
argument_list|,
literal|40
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|visualRect
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
argument_list|)
operator|.
name|height
argument_list|()
argument_list|,
literal|40
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|visualRect
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|2
argument_list|)
argument_list|)
operator|.
name|height
argument_list|()
argument_list|,
literal|40
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|//From task 155449 (QTreeWidget has a large width for the first section when sorting
end_comment
begin_comment
comment|//is turned on before items are added)
end_comment
begin_function
DECL|function|setSortingEnabled
name|void
name|tst_QTreeView
operator|::
name|setSortingEnabled
parameter_list|()
block|{
comment|//1st the treeview is a top-level
block|{
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
name|model
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
specifier|const
name|int
name|size
init|=
name|view
operator|.
name|header
argument_list|()
operator|->
name|sectionSize
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|view
operator|.
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|model
operator|.
name|setColumnCount
argument_list|(
literal|3
argument_list|)
expr_stmt|;
comment|//we test that changing the column count doesn't change the 1st column size
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|->
name|sectionSize
argument_list|(
literal|0
argument_list|)
argument_list|,
name|size
argument_list|)
expr_stmt|;
block|}
comment|//then it is no more a top-level
block|{
name|QMainWindow
name|win
decl_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
name|model
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|win
operator|.
name|setCentralWidget
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
specifier|const
name|int
name|size
init|=
name|view
operator|.
name|header
argument_list|()
operator|->
name|sectionSize
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|view
operator|.
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|model
operator|.
name|setColumnCount
argument_list|(
literal|3
argument_list|)
expr_stmt|;
comment|//we test that changing the column count doesn't change the 1st column size
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|->
name|sectionSize
argument_list|(
literal|0
argument_list|)
argument_list|,
name|size
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|headerHidden
name|void
name|tst_QTreeView
operator|::
name|headerHidden
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
name|model
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isHeaderHidden
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|->
name|isHidden
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|view
operator|.
name|setHeaderHidden
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isHeaderHidden
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|->
name|isHidden
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|TestTreeViewStyle
class|class
name|TestTreeViewStyle
super|:
specifier|public
name|QProxyStyle
block|{
public|public:
DECL|function|TestTreeViewStyle
name|TestTreeViewStyle
parameter_list|()
member_init_list|:
name|indentation
argument_list|(
literal|20
argument_list|)
block|{}
name|int
name|pixelMetric
parameter_list|(
name|PixelMetric
name|metric
parameter_list|,
specifier|const
name|QStyleOption
modifier|*
name|option
init|=
literal|0
parameter_list|,
specifier|const
name|QWidget
modifier|*
name|widget
init|=
literal|0
parameter_list|)
specifier|const
name|Q_DECL_OVERRIDE
block|{
if|if
condition|(
name|metric
operator|==
name|QStyle
operator|::
name|PM_TreeViewIndentation
condition|)
return|return
name|indentation
return|;
else|else
return|return
name|QProxyStyle
operator|::
name|pixelMetric
argument_list|(
name|metric
argument_list|,
name|option
argument_list|,
name|widget
argument_list|)
return|;
block|}
DECL|member|indentation
name|int
name|indentation
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|indentation
name|void
name|tst_QTreeView
operator|::
name|indentation
parameter_list|()
block|{
name|TestTreeViewStyle
name|style1
decl_stmt|;
name|TestTreeViewStyle
name|style2
decl_stmt|;
name|style1
operator|.
name|indentation
operator|=
literal|20
expr_stmt|;
name|style2
operator|.
name|indentation
operator|=
literal|30
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setStyle
argument_list|(
operator|&
name|style1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indentation
argument_list|()
argument_list|,
name|style1
operator|.
name|indentation
argument_list|)
expr_stmt|;
name|view
operator|.
name|setStyle
argument_list|(
operator|&
name|style2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indentation
argument_list|()
argument_list|,
name|style2
operator|.
name|indentation
argument_list|)
expr_stmt|;
name|view
operator|.
name|setIndentation
argument_list|(
literal|70
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indentation
argument_list|()
argument_list|,
literal|70
argument_list|)
expr_stmt|;
name|view
operator|.
name|setStyle
argument_list|(
operator|&
name|style1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indentation
argument_list|()
argument_list|,
literal|70
argument_list|)
expr_stmt|;
name|view
operator|.
name|resetIndentation
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indentation
argument_list|()
argument_list|,
name|style1
operator|.
name|indentation
argument_list|)
expr_stmt|;
name|view
operator|.
name|setStyle
argument_list|(
operator|&
name|style2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indentation
argument_list|()
argument_list|,
name|style2
operator|.
name|indentation
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// From Task 145199 (crash when column 0 having at least one expanded item is removed and then
end_comment
begin_comment
comment|// inserted). The test passes simply if it doesn't crash, hence there are no calls
end_comment
begin_comment
comment|// to QCOMPARE() or QVERIFY().
end_comment
begin_function
DECL|function|removeAndInsertExpandedCol0
name|void
name|tst_QTreeView
operator|::
name|removeAndInsertExpandedCol0
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
name|model
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|model
operator|.
name|setColumnCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QStandardItem
modifier|*
name|item0
init|=
operator|new
name|QStandardItem
argument_list|(
name|QString
argument_list|(
literal|"item 0"
argument_list|)
argument_list|)
decl_stmt|;
name|model
operator|.
name|invisibleRootItem
argument_list|()
operator|->
name|appendRow
argument_list|(
name|item0
argument_list|)
expr_stmt|;
name|view
operator|.
name|expand
argument_list|(
name|item0
operator|->
name|index
argument_list|()
argument_list|)
expr_stmt|;
name|QStandardItem
modifier|*
name|item1
init|=
operator|new
name|QStandardItem
argument_list|(
name|QString
argument_list|(
literal|"item 1"
argument_list|)
argument_list|)
decl_stmt|;
name|item0
operator|->
name|appendRow
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|model
operator|.
name|removeColumns
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|model
operator|.
name|insertColumns
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|disabledButCheckable
name|void
name|tst_QTreeView
operator|::
name|disabledButCheckable
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
name|model
decl_stmt|;
name|QStandardItem
modifier|*
name|item
decl_stmt|;
name|item
operator|=
operator|new
name|QStandardItem
argument_list|(
name|QLatin1String
argument_list|(
literal|"Row 1 Item"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|insertRow
argument_list|(
literal|0
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|item
operator|=
operator|new
name|QStandardItem
argument_list|(
name|QLatin1String
argument_list|(
literal|"Row 2 Item"
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setCheckable
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|item
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|model
operator|.
name|insertRow
argument_list|(
literal|1
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|setCurrentIndex
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|checkState
argument_list|()
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|view
argument_list|,
name|Qt
operator|::
name|Key_Space
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|checkState
argument_list|()
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sortByColumn_data
name|void
name|tst_QTreeView
operator|::
name|sortByColumn_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"sortingEnabled"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"sorting enabled"
argument_list|)
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"sorting disabled"
argument_list|)
operator|<<
literal|false
expr_stmt|;
block|}
end_function
begin_comment
comment|// Checks sorting and that sortByColumn also sets the sortIndicator
end_comment
begin_function
DECL|function|sortByColumn
name|void
name|tst_QTreeView
operator|::
name|sortByColumn
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|sortingEnabled
argument_list|)
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
name|model
argument_list|(
literal|4
argument_list|,
literal|2
argument_list|)
decl_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"b"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"d"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|2
argument_list|,
literal|0
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"c"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|3
argument_list|,
literal|0
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"a"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"e"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"g"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"h"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|3
argument_list|,
literal|1
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"f"
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSortingEnabled
argument_list|(
name|sortingEnabled
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|sortByColumn
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|->
name|sortIndicatorSection
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|data
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"h"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|data
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"g"
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|sortByColumn
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|->
name|sortIndicatorSection
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|data
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"a"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|data
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"b"
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|/*     This is a model that every time kill() is called it will completely change     all of its nodes for new nodes.  It then qFatal's if you later use a dead node.  */
end_comment
begin_class
DECL|class|EvilModel
class|class
name|EvilModel
super|:
specifier|public
name|QAbstractItemModel
block|{
public|public:
DECL|class|Node
class|class
name|Node
block|{
public|public:
DECL|function|Node
name|Node
parameter_list|(
name|Node
modifier|*
name|p
init|=
literal|0
parameter_list|,
name|int
name|level
init|=
literal|0
parameter_list|)
member_init_list|:
name|parent
argument_list|(
name|p
argument_list|)
member_init_list|,
name|isDead
argument_list|(
literal|false
argument_list|)
block|{
name|populate
argument_list|(
name|level
argument_list|)
expr_stmt|;
block|}
DECL|function|~Node
name|~
name|Node
parameter_list|()
block|{
name|qDeleteAll
argument_list|(
name|children
operator|.
name|begin
argument_list|()
argument_list|,
name|children
operator|.
name|end
argument_list|()
argument_list|)
expr_stmt|;
name|qDeleteAll
argument_list|(
name|deadChildren
operator|.
name|begin
argument_list|()
argument_list|,
name|deadChildren
operator|.
name|end
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|function|populate
name|void
name|populate
parameter_list|(
name|int
name|level
init|=
literal|0
parameter_list|)
block|{
if|if
condition|(
name|level
operator|<
literal|4
condition|)
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
operator|++
name|i
control|)
name|children
operator|.
name|append
argument_list|(
operator|new
name|Node
argument_list|(
name|this
argument_list|,
name|level
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|function|kill
name|void
name|kill
parameter_list|()
block|{
for|for
control|(
name|int
name|i
init|=
name|children
operator|.
name|count
argument_list|()
operator|-
literal|1
init|;
name|i
operator|>=
literal|0
condition|;
operator|--
name|i
control|)
block|{
name|children
operator|.
name|at
argument_list|(
name|i
argument_list|)
operator|->
name|kill
argument_list|()
expr_stmt|;
if|if
condition|(
name|parent
operator|==
literal|0
condition|)
block|{
name|deadChildren
operator|.
name|append
argument_list|(
name|children
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|children
operator|.
name|removeAt
argument_list|(
name|i
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|parent
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|children
operator|.
name|isEmpty
argument_list|()
condition|)
name|qFatal
argument_list|(
literal|"%s: children should be empty when parent is null"
argument_list|,
name|Q_FUNC_INFO
argument_list|)
expr_stmt|;
name|populate
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|isDead
operator|=
literal|true
expr_stmt|;
block|}
block|}
DECL|member|children
name|QList
argument_list|<
name|Node
modifier|*
argument_list|>
name|children
decl_stmt|;
DECL|member|deadChildren
name|QList
argument_list|<
name|Node
modifier|*
argument_list|>
name|deadChildren
decl_stmt|;
DECL|member|parent
name|Node
modifier|*
name|parent
decl_stmt|;
DECL|member|isDead
name|bool
name|isDead
decl_stmt|;
block|}
class|;
DECL|member|root
name|Node
modifier|*
name|root
decl_stmt|;
DECL|function|EvilModel
name|EvilModel
parameter_list|(
name|QObject
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QAbstractItemModel
argument_list|(
name|parent
argument_list|)
member_init_list|,
name|root
argument_list|(
operator|new
name|Node
argument_list|)
block|{     }
DECL|function|~EvilModel
name|~
name|EvilModel
parameter_list|()
block|{
operator|delete
name|root
expr_stmt|;
block|}
DECL|function|change
name|void
name|change
parameter_list|()
block|{
emit|emit
name|layoutAboutToBeChanged
argument_list|()
emit|;
name|QModelIndexList
name|oldList
init|=
name|persistentIndexList
argument_list|()
decl_stmt|;
name|QList
argument_list|<
name|QStack
argument_list|<
name|int
argument_list|>
argument_list|>
name|oldListPath
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|oldList
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QModelIndex
name|idx
init|=
name|oldList
operator|.
name|at
argument_list|(
name|i
argument_list|)
decl_stmt|;
name|QStack
argument_list|<
name|int
argument_list|>
name|path
decl_stmt|;
while|while
condition|(
name|idx
operator|.
name|isValid
argument_list|()
condition|)
block|{
name|path
operator|.
name|push
argument_list|(
name|idx
operator|.
name|row
argument_list|()
argument_list|)
expr_stmt|;
name|idx
operator|=
name|idx
operator|.
name|parent
argument_list|()
expr_stmt|;
block|}
name|oldListPath
operator|.
name|append
argument_list|(
name|path
argument_list|)
expr_stmt|;
block|}
name|root
operator|->
name|kill
argument_list|()
expr_stmt|;
name|QModelIndexList
name|newList
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|oldListPath
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QStack
argument_list|<
name|int
argument_list|>
name|path
init|=
name|oldListPath
index|[
name|i
index|]
decl_stmt|;
name|QModelIndex
name|idx
decl_stmt|;
while|while
condition|(
operator|!
name|path
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|idx
operator|=
name|index
argument_list|(
name|path
operator|.
name|pop
argument_list|()
argument_list|,
literal|0
argument_list|,
name|idx
argument_list|)
expr_stmt|;
block|}
name|newList
operator|.
name|append
argument_list|(
name|idx
argument_list|)
expr_stmt|;
block|}
name|changePersistentIndexList
argument_list|(
name|oldList
argument_list|,
name|newList
argument_list|)
expr_stmt|;
emit|emit
name|layoutChanged
argument_list|()
emit|;
block|}
DECL|function|rowCount
name|int
name|rowCount
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|parent
init|=
name|QModelIndex
argument_list|()
parameter_list|)
specifier|const
block|{
name|Node
modifier|*
name|parentNode
init|=
name|root
decl_stmt|;
if|if
condition|(
name|parent
operator|.
name|isValid
argument_list|()
condition|)
block|{
name|parentNode
operator|=
cast|static_cast
argument_list|<
name|Node
operator|*
argument_list|>
argument_list|(
name|parent
operator|.
name|internalPointer
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|parentNode
operator|->
name|isDead
condition|)
name|qFatal
argument_list|(
literal|"%s: parentNode is dead!"
argument_list|,
name|Q_FUNC_INFO
argument_list|)
expr_stmt|;
block|}
return|return
name|parentNode
operator|->
name|children
operator|.
name|count
argument_list|()
return|;
block|}
DECL|function|columnCount
name|int
name|columnCount
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|parent
init|=
name|QModelIndex
argument_list|()
parameter_list|)
specifier|const
block|{
if|if
condition|(
name|parent
operator|.
name|column
argument_list|()
operator|>
literal|0
condition|)
return|return
literal|0
return|;
return|return
literal|1
return|;
block|}
DECL|function|index
name|QModelIndex
name|index
parameter_list|(
name|int
name|row
parameter_list|,
name|int
name|column
parameter_list|,
specifier|const
name|QModelIndex
modifier|&
name|parent
init|=
name|QModelIndex
argument_list|()
parameter_list|)
specifier|const
block|{
name|Node
modifier|*
name|grandparentNode
init|=
cast|static_cast
argument_list|<
name|Node
operator|*
argument_list|>
argument_list|(
name|parent
operator|.
name|internalPointer
argument_list|()
argument_list|)
decl_stmt|;
name|Node
modifier|*
name|parentNode
init|=
name|root
decl_stmt|;
if|if
condition|(
name|parent
operator|.
name|isValid
argument_list|()
condition|)
block|{
if|if
condition|(
name|grandparentNode
operator|->
name|isDead
condition|)
name|qFatal
argument_list|(
literal|"%s: grandparentNode is dead!"
argument_list|,
name|Q_FUNC_INFO
argument_list|)
expr_stmt|;
name|parentNode
operator|=
name|grandparentNode
operator|->
name|children
index|[
name|parent
operator|.
name|row
argument_list|()
index|]
expr_stmt|;
if|if
condition|(
name|parentNode
operator|->
name|isDead
condition|)
name|qFatal
argument_list|(
literal|"%s: grandparentNode is dead!"
argument_list|,
name|Q_FUNC_INFO
argument_list|)
expr_stmt|;
block|}
return|return
name|createIndex
argument_list|(
name|row
argument_list|,
name|column
argument_list|,
name|parentNode
argument_list|)
return|;
block|}
DECL|function|parent
name|QModelIndex
name|parent
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|index
parameter_list|)
specifier|const
block|{
name|Node
modifier|*
name|parent
init|=
cast|static_cast
argument_list|<
name|Node
operator|*
argument_list|>
argument_list|(
name|index
operator|.
name|internalPointer
argument_list|()
argument_list|)
decl_stmt|;
name|Node
modifier|*
name|grandparent
init|=
name|parent
operator|->
name|parent
decl_stmt|;
if|if
condition|(
operator|!
name|grandparent
condition|)
return|return
name|QModelIndex
argument_list|()
return|;
return|return
name|createIndex
argument_list|(
name|grandparent
operator|->
name|children
operator|.
name|indexOf
argument_list|(
name|parent
argument_list|)
argument_list|,
literal|0
argument_list|,
name|grandparent
argument_list|)
return|;
block|}
DECL|function|data
name|QVariant
name|data
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|idx
parameter_list|,
name|int
name|role
parameter_list|)
specifier|const
block|{
if|if
condition|(
name|idx
operator|.
name|isValid
argument_list|()
operator|&&
name|role
operator|==
name|Qt
operator|::
name|DisplayRole
condition|)
block|{
name|Node
modifier|*
name|parentNode
init|=
name|root
decl_stmt|;
if|if
condition|(
name|idx
operator|.
name|isValid
argument_list|()
condition|)
block|{
name|parentNode
operator|=
cast|static_cast
argument_list|<
name|Node
operator|*
argument_list|>
argument_list|(
name|idx
operator|.
name|internalPointer
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|parentNode
operator|->
name|isDead
condition|)
name|qFatal
argument_list|(
literal|"%s: grandparentNode is dead!"
argument_list|,
name|Q_FUNC_INFO
argument_list|)
expr_stmt|;
block|}
return|return
name|QString
argument_list|(
literal|"[%1,%2,%3]"
argument_list|)
operator|.
name|arg
argument_list|(
name|idx
operator|.
name|row
argument_list|()
argument_list|)
operator|.
name|arg
argument_list|(
name|idx
operator|.
name|column
argument_list|()
argument_list|)
operator|.
name|arg
argument_list|(
name|parentNode
operator|->
name|isDead
condition|?
literal|"dead"
else|:
literal|"alive"
argument_list|)
return|;
block|}
return|return
name|QVariant
argument_list|()
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|evilModel_data
name|void
name|tst_QTreeView
operator|::
name|evilModel_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"visible"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"visible"
argument_list|)
operator|<<
literal|false
expr_stmt|;
block|}
end_function
begin_function
DECL|function|evilModel
name|void
name|tst_QTreeView
operator|::
name|evilModel
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|visible
argument_list|)
expr_stmt|;
comment|// init
name|PublicView
name|view
decl_stmt|;
name|EvilModel
name|model
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|setVisible
argument_list|(
name|visible
argument_list|)
expr_stmt|;
name|QPersistentModelIndex
name|firstLevel
init|=
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QPersistentModelIndex
name|secondLevel
init|=
name|model
operator|.
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
name|firstLevel
argument_list|)
decl_stmt|;
name|QPersistentModelIndex
name|thirdLevel
init|=
name|model
operator|.
name|index
argument_list|(
literal|2
argument_list|,
literal|0
argument_list|,
name|secondLevel
argument_list|)
decl_stmt|;
name|view
operator|.
name|setExpanded
argument_list|(
name|firstLevel
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setExpanded
argument_list|(
name|secondLevel
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setExpanded
argument_list|(
name|thirdLevel
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
comment|// tests
name|view
operator|.
name|setRowHidden
argument_list|(
literal|0
argument_list|,
name|firstLevel
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
return|return;
name|view
operator|.
name|setFirstColumnSpanned
argument_list|(
literal|1
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|expand
argument_list|(
name|secondLevel
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|collapse
argument_list|(
name|secondLevel
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|isExpanded
argument_list|(
name|secondLevel
argument_list|)
expr_stmt|;
name|view
operator|.
name|setCurrentIndex
argument_list|(
name|firstLevel
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|keyboardSearch
argument_list|(
literal|"foo"
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|visualRect
argument_list|(
name|secondLevel
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|scrollTo
argument_list|(
name|thirdLevel
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|repaint
argument_list|()
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|mouseDClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|indexAt
argument_list|(
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|indexAbove
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|2
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|indexBelow
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|QRect
name|rect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|view
operator|.
name|setSelection
argument_list|(
name|rect
argument_list|,
name|QItemSelectionModel
operator|::
name|Select
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|doMoveCursor
argument_list|(
name|PublicView
operator|::
name|MoveDown
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|resizeColumnToContents
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|QAbstractItemView
operator|::
name|sizeHintForColumn
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|rowHeight
argument_list|(
name|secondLevel
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|setRootIsDecorated
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|setItemsExpandable
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|columnViewportPosition
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|columnWidth
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|setColumnWidth
argument_list|(
literal|0
argument_list|,
literal|30
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|columnAt
argument_list|(
literal|15
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|isColumnHidden
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|setColumnHidden
argument_list|(
literal|2
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|isHeaderHidden
argument_list|()
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|setHeaderHidden
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|isRowHidden
argument_list|(
literal|2
argument_list|,
name|secondLevel
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|setRowHidden
argument_list|(
literal|3
argument_list|,
name|secondLevel
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|isFirstColumnSpanned
argument_list|(
literal|3
argument_list|,
name|thirdLevel
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|isSortingEnabled
argument_list|()
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|setAnimated
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|isAnimated
argument_list|()
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|setAllColumnsShowFocus
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|allColumnsShowFocus
argument_list|()
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|doItemsLayout
argument_list|()
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|sortByColumn
argument_list|(
literal|1
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|dataChanged
argument_list|(
name|secondLevel
argument_list|,
name|secondLevel
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|hideColumn
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|showColumn
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|resizeColumnToContents
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|sortByColumn
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|selectAll
argument_list|()
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|collapseAll
argument_list|()
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|expandToDepth
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|model
operator|.
name|change
argument_list|()
expr_stmt|;
name|view
operator|.
name|setRootIndex
argument_list|(
name|secondLevel
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|indexRowSizeHint
name|void
name|tst_QTreeView
operator|::
name|indexRowSizeHint
parameter_list|()
block|{
name|QStandardItemModel
name|model
argument_list|(
literal|10
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|PublicView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QModelIndex
name|index
init|=
name|model
operator|.
name|index
argument_list|(
literal|5
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QPushButton
modifier|*
name|w
init|=
operator|new
name|QPushButton
argument_list|(
literal|"Test"
argument_list|)
decl_stmt|;
name|view
operator|.
name|setIndexWidget
argument_list|(
name|index
argument_list|,
name|w
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indexRowSizeHint
argument_list|(
name|index
argument_list|)
argument_list|,
name|w
operator|->
name|sizeHint
argument_list|()
operator|.
name|height
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|filterProxyModelCrash
name|void
name|tst_QTreeView
operator|::
name|filterProxyModelCrash
parameter_list|()
block|{
name|QStandardItemModel
name|model
decl_stmt|;
name|QList
argument_list|<
name|QStandardItem
modifier|*
argument_list|>
name|items
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|100
condition|;
name|i
operator|++
control|)
name|items
operator|<<
operator|new
name|QStandardItem
argument_list|(
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"item %1"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|appendColumn
argument_list|(
name|items
argument_list|)
expr_stmt|;
name|QSortFilterProxyModel
name|proxy
decl_stmt|;
name|proxy
operator|.
name|setSourceModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|proxy
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|30
argument_list|)
expr_stmt|;
name|proxy
operator|.
name|invalidate
argument_list|()
expr_stmt|;
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|setValue
argument_list|(
literal|15
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|proxy
operator|.
name|invalidate
argument_list|()
expr_stmt|;
name|view
operator|.
name|repaint
argument_list|()
expr_stmt|;
comment|//used to crash
block|}
end_function
begin_function
DECL|function|renderToPixmap_data
name|void
name|tst_QTreeView
operator|::
name|renderToPixmap_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"row"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"row-0"
argument_list|)
operator|<<
literal|0
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"row-1"
argument_list|)
operator|<<
literal|1
expr_stmt|;
block|}
end_function
begin_function
DECL|function|renderToPixmap
name|void
name|tst_QTreeView
operator|::
name|renderToPixmap
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|row
argument_list|)
expr_stmt|;
name|PublicView
name|view
decl_stmt|;
name|QStandardItemModel
name|model
decl_stmt|;
name|model
operator|.
name|appendRow
argument_list|(
operator|new
name|QStandardItem
argument_list|(
literal|"Spanning"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Not"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Spanning"
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFirstColumnSpanned
argument_list|(
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|QT_BUILD_INTERNAL
block|{
comment|// We select the index at row=0 because it spans the
comment|// column (regression test for an assert)
comment|// We select the index at row=1 for coverage.
name|QItemSelection
name|sel
argument_list|(
name|model
operator|.
name|index
argument_list|(
name|row
argument_list|,
literal|0
argument_list|)
argument_list|,
name|model
operator|.
name|index
argument_list|(
name|row
argument_list|,
literal|1
argument_list|)
argument_list|)
decl_stmt|;
name|QRect
name|rect
decl_stmt|;
name|view
operator|.
name|aiv_priv
argument_list|()
operator|->
name|renderToPixmap
argument_list|(
name|sel
operator|.
name|indexes
argument_list|()
argument_list|,
operator|&
name|rect
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
block|}
end_function
begin_function
DECL|function|styleOptionViewItem
name|void
name|tst_QTreeView
operator|::
name|styleOptionViewItem
parameter_list|()
block|{
class|class
name|MyDelegate
super|:
specifier|public
name|QStyledItemDelegate
block|{
specifier|static
name|QString
name|posToString
parameter_list|(
name|QStyleOptionViewItemV4
operator|::
name|ViewItemPosition
name|pos
parameter_list|)
block|{
specifier|static
specifier|const
name|char
modifier|*
name|s_pos
index|[]
init|=
block|{
literal|"Invalid"
block|,
literal|"Beginning"
block|,
literal|"Middle"
block|,
literal|"End"
block|,
literal|"OnlyOne"
block|}
decl_stmt|;
return|return
name|s_pos
index|[
name|pos
index|]
return|;
block|}
public|public:
name|MyDelegate
parameter_list|()
member_init_list|:
name|QStyledItemDelegate
argument_list|()
member_init_list|,
name|count
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|allCollapsed
argument_list|(
literal|false
argument_list|)
block|{}
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionViewItem
modifier|&
name|option
parameter_list|,
specifier|const
name|QModelIndex
modifier|&
name|index
parameter_list|)
specifier|const
block|{
name|QVERIFY
argument_list|(
name|qstyleoption_cast
argument_list|<
specifier|const
name|QStyleOptionViewItemV4
operator|*
argument_list|>
argument_list|(
operator|&
name|option
argument_list|)
argument_list|)
expr_stmt|;
name|QStyleOptionViewItemV4
name|opt
argument_list|(
name|option
argument_list|)
decl_stmt|;
name|initStyleOption
argument_list|(
operator|&
name|opt
argument_list|,
name|index
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|opt
operator|.
name|text
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|opt
operator|.
name|index
argument_list|,
name|index
argument_list|)
expr_stmt|;
comment|//qDebug()<< index<< opt.text;
if|if
condition|(
name|allCollapsed
condition|)
name|QCOMPARE
argument_list|(
operator|!
operator|(
name|opt
operator|.
name|features
operator|&
name|QStyleOptionViewItemV2
operator|::
name|Alternate
operator|)
argument_list|,
operator|!
operator|(
name|index
operator|.
name|row
argument_list|()
operator|%
literal|2
operator|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
operator|!
operator|(
name|opt
operator|.
name|features
operator|&
name|QStyleOptionViewItemV2
operator|::
name|HasCheckIndicator
operator|)
argument_list|,
operator|!
name|opt
operator|.
name|text
operator|.
name|contains
argument_list|(
literal|"Checkable"
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|opt
operator|.
name|text
operator|.
name|contains
argument_list|(
literal|"Beginning"
argument_list|)
condition|)
name|QCOMPARE
argument_list|(
name|posToString
argument_list|(
name|opt
operator|.
name|viewItemPosition
argument_list|)
argument_list|,
name|posToString
argument_list|(
name|QStyleOptionViewItemV4
operator|::
name|Beginning
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|opt
operator|.
name|text
operator|.
name|contains
argument_list|(
literal|"Middle"
argument_list|)
condition|)
name|QCOMPARE
argument_list|(
name|posToString
argument_list|(
name|opt
operator|.
name|viewItemPosition
argument_list|)
argument_list|,
name|posToString
argument_list|(
name|QStyleOptionViewItemV4
operator|::
name|Middle
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|opt
operator|.
name|text
operator|.
name|contains
argument_list|(
literal|"End"
argument_list|)
condition|)
name|QCOMPARE
argument_list|(
name|posToString
argument_list|(
name|opt
operator|.
name|viewItemPosition
argument_list|)
argument_list|,
name|posToString
argument_list|(
name|QStyleOptionViewItemV4
operator|::
name|End
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|opt
operator|.
name|text
operator|.
name|contains
argument_list|(
literal|"OnlyOne"
argument_list|)
condition|)
name|QCOMPARE
argument_list|(
name|posToString
argument_list|(
name|opt
operator|.
name|viewItemPosition
argument_list|)
argument_list|,
name|posToString
argument_list|(
name|QStyleOptionViewItemV4
operator|::
name|OnlyOne
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|opt
operator|.
name|text
operator|.
name|contains
argument_list|(
literal|"Checked"
argument_list|)
condition|)
name|QCOMPARE
argument_list|(
name|opt
operator|.
name|checkState
argument_list|,
name|Qt
operator|::
name|Checked
argument_list|)
expr_stmt|;
else|else
name|QCOMPARE
argument_list|(
name|opt
operator|.
name|checkState
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
operator|!
operator|(
name|opt
operator|.
name|state
operator|&
name|QStyle
operator|::
name|State_Children
operator|)
argument_list|,
operator|!
name|opt
operator|.
name|text
operator|.
name|contains
argument_list|(
literal|"HasChildren"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
operator|!
operator|!
operator|(
name|opt
operator|.
name|state
operator|&
name|QStyle
operator|::
name|State_Sibling
operator|)
argument_list|,
operator|!
name|opt
operator|.
name|text
operator|.
name|contains
argument_list|(
literal|"Last"
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|opt
operator|.
name|text
operator|.
name|contains
argument_list|(
literal|"Assert"
argument_list|)
argument_list|)
expr_stmt|;
name|QStyledItemDelegate
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|index
argument_list|)
expr_stmt|;
name|count
operator|++
expr_stmt|;
block|}
specifier|mutable
name|int
name|count
decl_stmt|;
name|bool
name|allCollapsed
decl_stmt|;
block|}
class|;
name|PublicView
name|view
decl_stmt|;
name|QStandardItemModel
name|model
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|MyDelegate
name|delegate
decl_stmt|;
name|view
operator|.
name|setItemDelegate
argument_list|(
operator|&
name|delegate
argument_list|)
expr_stmt|;
name|model
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Beginning"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Hidden"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Middle"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Middle"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"End"
argument_list|)
argument_list|)
expr_stmt|;
name|QStandardItem
modifier|*
name|par1
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"Beginning HasChildren"
argument_list|)
decl_stmt|;
name|model
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|par1
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Hidden"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Middle HasChildren"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Middle HasChildren"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"End HasChildren"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"OnlyOne"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Hidden"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Assert"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Assert"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Assert"
argument_list|)
argument_list|)
expr_stmt|;
name|QStandardItem
modifier|*
name|checkable
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"Checkable"
argument_list|)
decl_stmt|;
name|checkable
operator|->
name|setCheckable
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QStandardItem
modifier|*
name|checked
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"Checkable Checked"
argument_list|)
decl_stmt|;
name|checked
operator|->
name|setCheckable
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|checked
operator|->
name|setCheckState
argument_list|(
name|Qt
operator|::
name|Checked
argument_list|)
expr_stmt|;
name|model
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Beginning"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Hidden"
argument_list|)
operator|<<
name|checkable
operator|<<
name|checked
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"End"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Beginning Last"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Hidden"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Middle Last"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Middle Last"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"End Last"
argument_list|)
argument_list|)
expr_stmt|;
name|par1
operator|->
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Beginning"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Hidden"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Middle"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Middle"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"End"
argument_list|)
argument_list|)
expr_stmt|;
name|QStandardItem
modifier|*
name|par2
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"Beginning HasChildren"
argument_list|)
decl_stmt|;
name|par1
operator|->
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|par2
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Hidden"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Middle HasChildren"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Middle HasChildren"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"End HasChildren"
argument_list|)
argument_list|)
expr_stmt|;
name|par2
operator|->
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Beginning Last"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Hidden"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Middle Last"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Middle Last"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"End Last"
argument_list|)
argument_list|)
expr_stmt|;
name|QStandardItem
modifier|*
name|par3
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"Beginning Last"
argument_list|)
decl_stmt|;
name|par1
operator|->
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|par3
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Hidden"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Middle Last"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Middle Last"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"End Last"
argument_list|)
argument_list|)
expr_stmt|;
name|par3
operator|->
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Assert"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Hidden"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Assert"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Assert"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Asser"
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRowHidden
argument_list|(
literal|0
argument_list|,
name|par3
operator|->
name|index
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|par1
operator|->
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Assert"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Hidden"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Assert"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Assert"
argument_list|)
operator|<<
operator|new
name|QStandardItem
argument_list|(
literal|"Asser"
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRowHidden
argument_list|(
literal|3
argument_list|,
name|par1
operator|->
name|index
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setColumnHidden
argument_list|(
literal|1
argument_list|,
literal|true
argument_list|)
expr_stmt|;
specifier|const
name|int
name|visibleColumns
init|=
literal|4
decl_stmt|;
specifier|const
name|int
name|modelColumns
init|=
literal|5
decl_stmt|;
name|view
operator|.
name|header
argument_list|()
operator|->
name|swapSections
argument_list|(
literal|2
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFirstColumnSpanned
argument_list|(
literal|2
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setAlternatingRowColors
argument_list|(
literal|true
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|QT_BUILD_INTERNAL
block|{
comment|// Test the rendering to pixmap before painting the widget.
comment|// The rendering to pixmap should not depend on having been
comment|// painted already yet.
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|QItemSelection
name|sel
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
name|modelColumns
operator|-
literal|1
argument_list|)
argument_list|)
decl_stmt|;
name|QRect
name|rect
decl_stmt|;
name|view
operator|.
name|aiv_priv
argument_list|()
operator|->
name|renderToPixmap
argument_list|(
name|sel
operator|.
name|indexes
argument_list|()
argument_list|,
operator|&
name|rect
argument_list|)
expr_stmt|;
if|if
condition|(
name|delegate
operator|.
name|count
operator|!=
name|visibleColumns
condition|)
block|{
name|qDebug
argument_list|()
operator|<<
name|rect
operator|<<
name|view
operator|.
name|rect
argument_list|()
operator|<<
name|view
operator|.
name|isVisible
argument_list|()
expr_stmt|;
block|}
name|QTRY_COMPARE
argument_list|(
name|delegate
operator|.
name|count
argument_list|,
name|visibleColumns
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|delegate
operator|.
name|allCollapsed
operator|=
literal|true
expr_stmt|;
name|view
operator|.
name|showMaximized
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|count
operator|>=
literal|13
argument_list|)
expr_stmt|;
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|delegate
operator|.
name|allCollapsed
operator|=
literal|false
expr_stmt|;
name|view
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|count
operator|>=
literal|13
argument_list|)
expr_stmt|;
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|view
operator|.
name|collapse
argument_list|(
name|par2
operator|->
name|index
argument_list|()
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|count
operator|>=
literal|4
argument_list|)
expr_stmt|;
comment|// test that the rendering of drag pixmap sets the correct options too (QTBUG-15834)
ifdef|#
directive|ifdef
name|QT_BUILD_INTERNAL
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|QItemSelection
name|sel
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
name|modelColumns
operator|-
literal|1
argument_list|)
argument_list|)
decl_stmt|;
name|QRect
name|rect
decl_stmt|;
name|view
operator|.
name|aiv_priv
argument_list|()
operator|->
name|renderToPixmap
argument_list|(
name|sel
operator|.
name|indexes
argument_list|()
argument_list|,
operator|&
name|rect
argument_list|)
expr_stmt|;
if|if
condition|(
name|delegate
operator|.
name|count
operator|!=
name|visibleColumns
condition|)
block|{
name|qDebug
argument_list|()
operator|<<
name|rect
operator|<<
name|view
operator|.
name|rect
argument_list|()
operator|<<
name|view
operator|.
name|isVisible
argument_list|()
expr_stmt|;
block|}
name|QTRY_COMPARE
argument_list|(
name|delegate
operator|.
name|count
argument_list|,
name|visibleColumns
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|//test dynamic models
block|{
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|QStandardItemModel
name|model2
decl_stmt|;
name|QStandardItem
modifier|*
name|item0
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"OnlyOne Last"
argument_list|)
decl_stmt|;
name|model2
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item0
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model2
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|count
operator|>=
literal|1
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QStandardItem
modifier|*
name|item00
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"OnlyOne Last"
argument_list|)
decl_stmt|;
name|item0
operator|->
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item00
argument_list|)
expr_stmt|;
name|item0
operator|->
name|setText
argument_list|(
literal|"OnlyOne Last HasChildren"
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|view
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|count
operator|>=
literal|2
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QStandardItem
modifier|*
name|item1
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"OnlyOne Last"
argument_list|)
decl_stmt|;
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|item0
operator|->
name|setText
argument_list|(
literal|"OnlyOne HasChildren"
argument_list|)
expr_stmt|;
name|model2
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item1
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|count
operator|>=
literal|3
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QStandardItem
modifier|*
name|item01
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"OnlyOne Last"
argument_list|)
decl_stmt|;
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|item00
operator|->
name|setText
argument_list|(
literal|"OnlyOne"
argument_list|)
expr_stmt|;
name|item0
operator|->
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item01
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|count
operator|>=
literal|4
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QStandardItem
modifier|*
name|item000
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"OnlyOne Last"
argument_list|)
decl_stmt|;
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|item00
operator|->
name|setText
argument_list|(
literal|"OnlyOne HasChildren"
argument_list|)
expr_stmt|;
name|item00
operator|->
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item000
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|count
operator|>=
literal|5
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|item0
operator|->
name|removeRow
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|count
operator|>=
literal|3
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|item00
operator|=
operator|new
name|QStandardItem
argument_list|(
literal|"OnlyOne"
argument_list|)
expr_stmt|;
name|item0
operator|->
name|insertRow
argument_list|(
literal|0
argument_list|,
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item00
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|view
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|count
operator|>=
literal|4
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|item0
operator|->
name|removeRow
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|item00
operator|->
name|setText
argument_list|(
literal|"OnlyOne Last"
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|count
operator|>=
literal|3
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|item0
operator|->
name|removeRow
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|item0
operator|->
name|setText
argument_list|(
literal|"OnlyOne"
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|count
operator|>=
literal|2
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
comment|//with hidden items
name|item0
operator|->
name|setText
argument_list|(
literal|"OnlyOne HasChildren"
argument_list|)
expr_stmt|;
name|item00
operator|=
operator|new
name|QStandardItem
argument_list|(
literal|"OnlyOne"
argument_list|)
expr_stmt|;
name|item0
operator|->
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item00
argument_list|)
expr_stmt|;
name|item01
operator|=
operator|new
name|QStandardItem
argument_list|(
literal|"Assert"
argument_list|)
expr_stmt|;
name|item0
operator|->
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item01
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRowHidden
argument_list|(
literal|1
argument_list|,
name|item0
operator|->
name|index
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|QStandardItem
modifier|*
name|item02
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"OnlyOne Last"
argument_list|)
decl_stmt|;
name|item0
operator|->
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item02
argument_list|)
expr_stmt|;
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|count
operator|>=
literal|4
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|item0
operator|->
name|removeRow
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|item00
operator|->
name|setText
argument_list|(
literal|"OnlyOne Last"
argument_list|)
expr_stmt|;
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|count
operator|>=
literal|3
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|item00
operator|->
name|setText
argument_list|(
literal|"OnlyOne"
argument_list|)
expr_stmt|;
name|item0
operator|->
name|insertRow
argument_list|(
literal|2
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"OnlyOne Last"
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|collapse
argument_list|(
name|item0
operator|->
name|index
argument_list|()
argument_list|)
expr_stmt|;
name|item0
operator|->
name|removeRow
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|count
operator|>=
literal|2
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|item0
operator|->
name|removeRow
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|item0
operator|->
name|setText
argument_list|(
literal|"OnlyOne"
argument_list|)
expr_stmt|;
name|delegate
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|count
operator|>=
literal|2
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|}
block|}
end_function
begin_class
DECL|class|task174627_TreeView
class|class
name|task174627_TreeView
super|:
specifier|public
name|QTreeView
block|{
name|Q_OBJECT
protected|protected
name|slots
protected|:
DECL|function|currentChanged
name|void
name|currentChanged
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|current
parameter_list|,
specifier|const
name|QModelIndex
modifier|&
parameter_list|)
block|{
emit|emit
name|currentChanged
argument_list|(
name|current
argument_list|)
emit|;
block|}
signals|signals:
name|void
name|currentChanged
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
parameter_list|)
function_decl|;
block|}
class|;
end_class
begin_function
DECL|function|task174627_moveLeftToRoot
name|void
name|tst_QTreeView
operator|::
name|task174627_moveLeftToRoot
parameter_list|()
block|{
name|QStandardItemModel
name|model
decl_stmt|;
name|QStandardItem
modifier|*
name|item1
init|=
operator|new
name|QStandardItem
argument_list|(
name|QString
argument_list|(
literal|"item 1"
argument_list|)
argument_list|)
decl_stmt|;
name|model
operator|.
name|invisibleRootItem
argument_list|()
operator|->
name|appendRow
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|QStandardItem
modifier|*
name|item2
init|=
operator|new
name|QStandardItem
argument_list|(
name|QString
argument_list|(
literal|"item 2"
argument_list|)
argument_list|)
decl_stmt|;
name|item1
operator|->
name|appendRow
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|task174627_TreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRootIndex
argument_list|(
name|item1
operator|->
name|index
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setCurrentIndex
argument_list|(
name|item2
operator|->
name|index
argument_list|()
argument_list|)
expr_stmt|;
name|QSignalSpy
name|spy
argument_list|(
operator|&
name|view
argument_list|,
name|SIGNAL
argument_list|(
name|currentChanged
argument_list|(
name|QModelIndex
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|view
argument_list|,
name|Qt
operator|::
name|Key_Left
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task171902_expandWith1stColHidden
name|void
name|tst_QTreeView
operator|::
name|task171902_expandWith1stColHidden
parameter_list|()
block|{
comment|//the task was: if the first column of a treeview is hidden, the expanded state is not correctly restored
name|QStandardItemModel
name|model
decl_stmt|;
name|QStandardItem
name|root
argument_list|(
literal|"root"
argument_list|)
decl_stmt|,
name|root2
argument_list|(
literal|"root"
argument_list|)
decl_stmt|,
name|subitem
argument_list|(
literal|"subitem"
argument_list|)
decl_stmt|,
name|subitem2
argument_list|(
literal|"subitem"
argument_list|)
decl_stmt|,
name|subsubitem
argument_list|(
literal|"subsubitem"
argument_list|)
decl_stmt|,
name|subsubitem2
argument_list|(
literal|"subsubitem"
argument_list|)
decl_stmt|;
name|model
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|&
name|root
operator|<<
operator|&
name|root2
argument_list|)
expr_stmt|;
name|root
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|&
name|subitem
operator|<<
operator|&
name|subitem2
argument_list|)
expr_stmt|;
name|subitem
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|&
name|subsubitem
operator|<<
operator|&
name|subsubitem2
argument_list|)
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|setColumnHidden
argument_list|(
literal|0
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|view
operator|.
name|collapse
argument_list|(
name|root
operator|.
name|index
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|expand
argument_list|(
name|root
operator|.
name|index
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|root
operator|.
name|index
argument_list|()
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|subitem
operator|.
name|index
argument_list|()
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task203696_hidingColumnsAndRowsn
name|void
name|tst_QTreeView
operator|::
name|task203696_hidingColumnsAndRowsn
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
modifier|*
name|model
init|=
operator|new
name|QStandardItemModel
argument_list|(
literal|0
argument_list|,
literal|3
argument_list|,
operator|&
name|view
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
operator|++
name|i
control|)
block|{
name|model
operator|->
name|insertRow
argument_list|(
name|model
operator|->
name|rowCount
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|model
operator|->
name|columnCount
argument_list|()
condition|;
operator|++
name|j
control|)
name|model
operator|->
name|setData
argument_list|(
name|model
operator|->
name|index
argument_list|(
name|i
argument_list|,
name|j
argument_list|)
argument_list|,
name|QString
argument_list|(
literal|"row %1 col %2"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
operator|.
name|arg
argument_list|(
name|j
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|view
operator|.
name|setModel
argument_list|(
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|view
operator|.
name|setColumnHidden
argument_list|(
literal|0
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRowHidden
argument_list|(
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indexAt
argument_list|(
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
name|model
operator|->
name|index
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|addRowsWhileSectionsAreHidden
name|void
name|tst_QTreeView
operator|::
name|addRowsWhileSectionsAreHidden
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
for|for
control|(
name|int
name|pass
init|=
literal|1
init|;
name|pass
operator|<=
literal|2
condition|;
operator|++
name|pass
control|)
block|{
name|QStandardItemModel
modifier|*
name|model
init|=
operator|new
name|QStandardItemModel
argument_list|(
literal|6
argument_list|,
name|pass
argument_list|,
operator|&
name|view
argument_list|)
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
operator|++
name|i
control|)
block|{
name|model
operator|->
name|insertRow
argument_list|(
name|model
operator|->
name|rowCount
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|model
operator|->
name|columnCount
argument_list|()
condition|;
operator|++
name|j
control|)
block|{
name|model
operator|->
name|setData
argument_list|(
name|model
operator|->
name|index
argument_list|(
name|i
argument_list|,
name|j
argument_list|)
argument_list|,
name|QString
argument_list|(
literal|"row %1 col %2"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
operator|.
name|arg
argument_list|(
name|j
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|int
name|col
decl_stmt|;
for|for
control|(
name|col
operator|=
literal|0
init|;
name|col
operator|<
name|pass
condition|;
operator|++
name|col
control|)
name|view
operator|.
name|setColumnHidden
argument_list|(
name|col
argument_list|,
literal|true
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|3
init|;
name|i
operator|<
literal|6
condition|;
operator|++
name|i
control|)
block|{
name|model
operator|->
name|insertRow
argument_list|(
name|model
operator|->
name|rowCount
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|model
operator|->
name|columnCount
argument_list|()
condition|;
operator|++
name|j
control|)
block|{
name|model
operator|->
name|setData
argument_list|(
name|model
operator|->
name|index
argument_list|(
name|i
argument_list|,
name|j
argument_list|)
argument_list|,
name|QString
argument_list|(
literal|"row %1 col %2"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
operator|.
name|arg
argument_list|(
name|j
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|col
operator|=
literal|0
init|;
name|col
operator|<
name|pass
condition|;
operator|++
name|col
control|)
name|view
operator|.
name|setColumnHidden
argument_list|(
name|col
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|250
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|6
condition|;
operator|++
name|i
control|)
block|{
name|QRect
name|rect
init|=
name|view
operator|.
name|visualRect
argument_list|(
name|model
operator|->
name|index
argument_list|(
name|i
argument_list|,
literal|0
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|.
name|isValid
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
operator|delete
name|model
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|task216717_updateChildren
name|void
name|tst_QTreeView
operator|::
name|task216717_updateChildren
parameter_list|()
block|{
class|class
name|Tree
super|:
specifier|public
name|QTreeWidget
block|{
protected|protected:
name|void
name|paintEvent
parameter_list|(
name|QPaintEvent
modifier|*
name|e
parameter_list|)
block|{
name|QTreeWidget
operator|::
name|paintEvent
argument_list|(
name|e
argument_list|)
expr_stmt|;
name|refreshed
operator|=
literal|true
expr_stmt|;
block|}
public|public:
name|bool
name|refreshed
decl_stmt|;
block|}
name|tree
class|;
name|tree
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|tree
argument_list|)
argument_list|)
expr_stmt|;
name|tree
operator|.
name|refreshed
operator|=
literal|false
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|parent
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
literal|"parent"
argument_list|)
decl_stmt|;
name|tree
operator|.
name|addTopLevelItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|tree
operator|.
name|refreshed
argument_list|)
expr_stmt|;
name|tree
operator|.
name|refreshed
operator|=
literal|false
expr_stmt|;
name|parent
operator|->
name|addChild
argument_list|(
operator|new
name|QTreeWidgetItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
literal|"child"
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|tree
operator|.
name|refreshed
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task220298_selectColumns
name|void
name|tst_QTreeView
operator|::
name|task220298_selectColumns
parameter_list|()
block|{
comment|//this is a very simple 3x3 model where the internalId of the index are different for each cell
class|class
name|Model
super|:
specifier|public
name|QAbstractTableModel
block|{
public|public:
specifier|virtual
name|int
name|columnCount
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|parent
init|=
name|QModelIndex
argument_list|()
parameter_list|)
specifier|const
block|{
return|return
name|parent
operator|.
name|isValid
argument_list|()
condition|?
literal|0
else|:
literal|3
return|;
block|}
specifier|virtual
name|int
name|rowCount
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|parent
init|=
name|QModelIndex
argument_list|()
parameter_list|)
specifier|const
block|{
return|return
name|parent
operator|.
name|isValid
argument_list|()
condition|?
literal|0
else|:
literal|3
return|;
block|}
specifier|virtual
name|QVariant
name|data
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|index
parameter_list|,
name|int
name|role
init|=
name|Qt
operator|::
name|DisplayRole
parameter_list|)
specifier|const
block|{
if|if
condition|(
name|role
operator|==
name|Qt
operator|::
name|DisplayRole
condition|)
return|return
name|QVariant
argument_list|(
name|QString
argument_list|(
literal|"%1-%2"
argument_list|)
operator|.
name|arg
argument_list|(
name|index
operator|.
name|column
argument_list|()
argument_list|)
operator|.
name|arg
argument_list|(
name|index
operator|.
name|row
argument_list|()
argument_list|)
argument_list|)
return|;
return|return
name|QVariant
argument_list|()
return|;
block|}
specifier|virtual
name|QModelIndex
name|index
parameter_list|(
name|int
name|row
parameter_list|,
name|int
name|column
parameter_list|,
specifier|const
name|QModelIndex
modifier|&
name|parent
init|=
name|QModelIndex
argument_list|()
parameter_list|)
specifier|const
block|{
return|return
name|hasIndex
argument_list|(
name|row
argument_list|,
name|column
argument_list|,
name|parent
argument_list|)
condition|?
name|createIndex
argument_list|(
name|row
argument_list|,
name|column
argument_list|,
name|column
operator|*
literal|10
operator|+
name|row
argument_list|)
else|:
name|QModelIndex
argument_list|()
return|;
block|}
block|}
class|;
class|class
name|TreeView
super|:
specifier|public
name|QTreeView
block|{
public|public:
name|QModelIndexList
name|selectedIndexes
parameter_list|()
specifier|const
block|{
return|return
name|QTreeView
operator|::
name|selectedIndexes
argument_list|()
return|;
block|}
block|}
name|view
class|;
name|Model
name|model
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|visualRect
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|selectedIndexes
argument_list|()
operator|.
name|contains
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|1
argument_list|,
literal|2
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|selectedIndexes
argument_list|()
operator|.
name|contains
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|selectedIndexes
argument_list|()
operator|.
name|contains
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task224091_appendColumns
name|void
name|tst_QTreeView
operator|::
name|task224091_appendColumns
parameter_list|()
block|{
name|QStandardItemModel
modifier|*
name|model
init|=
operator|new
name|QStandardItemModel
argument_list|()
decl_stmt|;
name|QWidget
modifier|*
name|topLevel
init|=
operator|new
name|QWidget
decl_stmt|;
name|setFrameless
argument_list|(
name|topLevel
argument_list|)
expr_stmt|;
name|QTreeView
modifier|*
name|treeView
init|=
operator|new
name|QTreeView
argument_list|(
name|topLevel
argument_list|)
decl_stmt|;
name|treeView
operator|->
name|setModel
argument_list|(
name|model
argument_list|)
expr_stmt|;
name|topLevel
operator|->
name|show
argument_list|()
expr_stmt|;
name|treeView
operator|->
name|resize
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
name|topLevel
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
name|topLevel
argument_list|)
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QStandardItem
modifier|*
argument_list|>
name|projlist
decl_stmt|;
for|for
control|(
name|int
name|k
init|=
literal|0
init|;
name|k
operator|<
literal|10
condition|;
operator|++
name|k
control|)
name|projlist
operator|.
name|append
argument_list|(
operator|new
name|QStandardItem
argument_list|(
name|QString
argument_list|(
literal|"Top Level %0"
argument_list|)
operator|.
name|arg
argument_list|(
name|k
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|->
name|appendColumn
argument_list|(
name|projlist
argument_list|)
expr_stmt|;
name|model
operator|->
name|invisibleRootItem
argument_list|()
operator|->
name|appendRow
argument_list|(
operator|new
name|QStandardItem
argument_list|(
literal|"end"
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|treeView
operator|->
name|verticalScrollBar
argument_list|()
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
operator|delete
name|topLevel
expr_stmt|;
operator|delete
name|model
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task211293_removeRootIndex
name|void
name|tst_QTreeView
operator|::
name|task211293_removeRootIndex
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
name|model
decl_stmt|;
name|QStandardItem
modifier|*
name|A1
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"A1"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|B11
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"B1.1"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|C111
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"C1.1.1"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|C112
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"C1.1.2"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|C113
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"C1.1.3"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|D1131
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"D1.1.3.1"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|E11311
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"E1.1.3.1.1"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|E11312
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"E1.1.3.1.2"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|E11313
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"E1.1.3.1.3"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|E11314
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"E1.1.3.1.4"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|D1132
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"D1.1.3.2"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|E11321
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"E1.1.3.2.1"
argument_list|)
decl_stmt|;
name|D1132
operator|->
name|appendRow
argument_list|(
name|E11321
argument_list|)
expr_stmt|;
name|D1131
operator|->
name|appendRow
argument_list|(
name|E11311
argument_list|)
expr_stmt|;
name|D1131
operator|->
name|appendRow
argument_list|(
name|E11312
argument_list|)
expr_stmt|;
name|D1131
operator|->
name|appendRow
argument_list|(
name|E11313
argument_list|)
expr_stmt|;
name|D1131
operator|->
name|appendRow
argument_list|(
name|E11314
argument_list|)
expr_stmt|;
name|C113
operator|->
name|appendRow
argument_list|(
name|D1131
argument_list|)
expr_stmt|;
name|C113
operator|->
name|appendRow
argument_list|(
name|D1132
argument_list|)
expr_stmt|;
name|B11
operator|->
name|appendRow
argument_list|(
name|C111
argument_list|)
expr_stmt|;
name|B11
operator|->
name|appendRow
argument_list|(
name|C112
argument_list|)
expr_stmt|;
name|B11
operator|->
name|appendRow
argument_list|(
name|C113
argument_list|)
expr_stmt|;
name|A1
operator|->
name|appendRow
argument_list|(
name|B11
argument_list|)
expr_stmt|;
name|model
operator|.
name|appendRow
argument_list|(
name|A1
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRootIndex
argument_list|(
name|model
operator|.
name|indexFromItem
argument_list|(
name|B11
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setExpanded
argument_list|(
name|model
operator|.
name|indexFromItem
argument_list|(
name|B11
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setCurrentIndex
argument_list|(
name|model
operator|.
name|indexFromItem
argument_list|(
name|E11314
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setExpanded
argument_list|(
name|model
operator|.
name|indexFromItem
argument_list|(
name|E11314
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|model
operator|.
name|removeRows
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task225539_deleteModel
name|void
name|tst_QTreeView
operator|::
name|task225539_deleteModel
parameter_list|()
block|{
name|QTreeView
name|treeView
decl_stmt|;
name|treeView
operator|.
name|show
argument_list|()
expr_stmt|;
name|QStandardItemModel
modifier|*
name|model
init|=
operator|new
name|QStandardItemModel
argument_list|(
operator|&
name|treeView
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|parentItem
init|=
name|model
operator|->
name|invisibleRootItem
argument_list|()
decl_stmt|;
name|QStandardItem
modifier|*
name|item
init|=
operator|new
name|QStandardItem
argument_list|(
name|QString
argument_list|(
literal|"item"
argument_list|)
argument_list|)
decl_stmt|;
name|parentItem
operator|->
name|appendRow
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|treeView
operator|.
name|setModel
argument_list|(
name|model
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|index
argument_list|()
argument_list|,
name|treeView
operator|.
name|indexAt
argument_list|(
name|QPoint
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
operator|delete
name|model
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|treeView
operator|.
name|indexAt
argument_list|(
name|QPoint
argument_list|()
argument_list|)
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task230123_setItemsExpandable
name|void
name|tst_QTreeView
operator|::
name|task230123_setItemsExpandable
parameter_list|()
block|{
comment|//let's check that we prevent the expansion inside a treeview
comment|//when the property is set.
name|QTreeWidget
name|tree
decl_stmt|;
name|QTreeWidgetItem
name|root
decl_stmt|;
name|QTreeWidgetItem
name|child
decl_stmt|;
name|root
operator|.
name|addChild
argument_list|(
operator|&
name|child
argument_list|)
expr_stmt|;
name|tree
operator|.
name|addTopLevelItem
argument_list|(
operator|&
name|root
argument_list|)
expr_stmt|;
name|tree
operator|.
name|setCurrentItem
argument_list|(
operator|&
name|root
argument_list|)
expr_stmt|;
name|tree
operator|.
name|setItemsExpandable
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|tree
argument_list|,
name|Qt
operator|::
name|Key_Plus
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|root
operator|.
name|isExpanded
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|tree
argument_list|,
name|Qt
operator|::
name|Key_Right
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|root
operator|.
name|isExpanded
argument_list|()
argument_list|)
expr_stmt|;
name|tree
operator|.
name|setItemsExpandable
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|tree
argument_list|,
name|Qt
operator|::
name|Key_Plus
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|root
operator|.
name|isExpanded
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|tree
argument_list|,
name|Qt
operator|::
name|Key_Minus
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|root
operator|.
name|isExpanded
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|tree
argument_list|,
name|Qt
operator|::
name|Key_Right
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|root
operator|.
name|isExpanded
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|tree
argument_list|,
name|Qt
operator|::
name|Key_Left
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|root
operator|.
name|isExpanded
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|tree
argument_list|,
name|Qt
operator|::
name|Key_Right
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|root
operator|.
name|isExpanded
argument_list|()
argument_list|)
expr_stmt|;
specifier|const
name|bool
name|navToChild
init|=
name|tree
operator|.
name|style
argument_list|()
operator|->
name|styleHint
argument_list|(
name|QStyle
operator|::
name|SH_ItemView_ArrowKeysNavigateIntoChildren
argument_list|,
literal|0
argument_list|,
operator|&
name|tree
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|tree
argument_list|,
name|Qt
operator|::
name|Key_Right
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|currentItem
argument_list|()
argument_list|,
name|navToChild
condition|?
operator|&
name|child
else|:
operator|&
name|root
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|tree
argument_list|,
name|Qt
operator|::
name|Key_Right
argument_list|)
expr_stmt|;
comment|//it should not be expanded: it has no leaf
name|QCOMPARE
argument_list|(
name|child
operator|.
name|isExpanded
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|tree
argument_list|,
name|Qt
operator|::
name|Key_Left
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|currentItem
argument_list|()
argument_list|,
operator|&
name|root
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|tree
argument_list|,
name|Qt
operator|::
name|Key_Left
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|root
operator|.
name|isExpanded
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task202039_closePersistentEditor
name|void
name|tst_QTreeView
operator|::
name|task202039_closePersistentEditor
parameter_list|()
block|{
name|QStandardItemModel
name|model
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QModelIndex
name|current
init|=
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|mousePress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|visualRect
argument_list|(
name|current
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseDClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|visualRect
argument_list|(
name|current
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|current
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|indexWidget
argument_list|(
name|current
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|closePersistentEditor
argument_list|(
name|current
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|indexWidget
argument_list|(
name|current
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
comment|//here was the bug: closing the persistent editor would not reset the state
comment|//and it was impossible to go into editinon again
name|QTest
operator|::
name|mousePress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|visualRect
argument_list|(
name|current
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseDClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|visualRect
argument_list|(
name|current
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|current
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|indexWidget
argument_list|(
name|current
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task238873_avoidAutoReopening
name|void
name|tst_QTreeView
operator|::
name|task238873_avoidAutoReopening
parameter_list|()
block|{
name|QStandardItemModel
name|model
decl_stmt|;
name|QStandardItem
name|item0
argument_list|(
literal|"row 0"
argument_list|)
decl_stmt|;
name|QStandardItem
name|item1
argument_list|(
literal|"row 1"
argument_list|)
decl_stmt|;
name|QStandardItem
name|item2
argument_list|(
literal|"row 2"
argument_list|)
decl_stmt|;
name|QStandardItem
name|item3
argument_list|(
literal|"row 3"
argument_list|)
decl_stmt|;
name|model
operator|.
name|appendColumn
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|&
name|item0
operator|<<
operator|&
name|item1
operator|<<
operator|&
name|item2
operator|<<
operator|&
name|item3
argument_list|)
expr_stmt|;
name|QStandardItem
name|child
argument_list|(
literal|"child"
argument_list|)
decl_stmt|;
name|item1
operator|.
name|appendRow
argument_list|(
operator|&
name|child
argument_list|)
expr_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|view
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|visualRect
argument_list|(
name|child
operator|.
name|index
argument_list|()
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|child
operator|.
name|index
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setExpanded
argument_list|(
name|item1
operator|.
name|index
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|500
argument_list|)
expr_stmt|;
comment|//enough to trigger the delayedAutoScroll timer
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|isExpanded
argument_list|(
name|item1
operator|.
name|index
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task244304_clickOnDecoration
name|void
name|tst_QTreeView
operator|::
name|task244304_clickOnDecoration
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
name|model
decl_stmt|;
name|QStandardItem
name|item0
argument_list|(
literal|"row 0"
argument_list|)
decl_stmt|;
name|QStandardItem
name|item00
argument_list|(
literal|"row 0"
argument_list|)
decl_stmt|;
name|item0
operator|.
name|appendRow
argument_list|(
operator|&
name|item00
argument_list|)
expr_stmt|;
name|QStandardItem
name|item1
argument_list|(
literal|"row 1"
argument_list|)
decl_stmt|;
name|model
operator|.
name|appendColumn
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|&
name|item0
operator|<<
operator|&
name|item1
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|currentIndex
argument_list|()
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QRect
name|rect
init|=
name|view
operator|.
name|visualRect
argument_list|(
name|item0
operator|.
name|index
argument_list|()
argument_list|)
decl_stmt|;
comment|//we click on the decoration
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|rect
operator|.
name|topLeft
argument_list|()
operator|+
name|QPoint
argument_list|(
operator|-
name|rect
operator|.
name|left
argument_list|()
operator|/
literal|2
argument_list|,
name|rect
operator|.
name|height
argument_list|()
operator|/
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|currentIndex
argument_list|()
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|item0
operator|.
name|index
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|rect
operator|=
name|view
operator|.
name|visualRect
argument_list|(
name|item1
operator|.
name|index
argument_list|()
argument_list|)
expr_stmt|;
comment|//the item has no decoration, it should get selected
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|rect
operator|.
name|topLeft
argument_list|()
operator|+
name|QPoint
argument_list|(
operator|-
name|rect
operator|.
name|left
argument_list|()
operator|/
literal|2
argument_list|,
name|rect
operator|.
name|height
argument_list|()
operator|/
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|item1
operator|.
name|index
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task246536_scrollbarsNotWorking
name|void
name|tst_QTreeView
operator|::
name|task246536_scrollbarsNotWorking
parameter_list|()
block|{
struct|struct
name|MyObject
super|:
specifier|public
name|QObject
block|{
name|MyObject
parameter_list|()
member_init_list|:
name|count
argument_list|(
literal|0
argument_list|)
block|{         }
name|bool
name|eventFilter
parameter_list|(
name|QObject
modifier|*
parameter_list|,
name|QEvent
modifier|*
name|e
parameter_list|)
block|{
if|if
condition|(
name|e
operator|->
name|type
argument_list|()
operator|==
name|QEvent
operator|::
name|Paint
condition|)
name|count
operator|++
expr_stmt|;
return|return
literal|false
return|;
block|}
name|int
name|count
decl_stmt|;
block|}
struct|;
name|QTreeView
name|tree
decl_stmt|;
name|MyObject
name|o
decl_stmt|;
name|tree
operator|.
name|viewport
argument_list|()
operator|->
name|installEventFilter
argument_list|(
operator|&
name|o
argument_list|)
expr_stmt|;
name|QStandardItemModel
name|model
decl_stmt|;
name|tree
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|tree
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|tree
argument_list|)
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QStandardItem
modifier|*
argument_list|>
name|items
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|100
condition|;
operator|++
name|i
control|)
block|{
name|items
operator|<<
operator|new
name|QStandardItem
argument_list|(
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"item %1"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|model
operator|.
name|invisibleRootItem
argument_list|()
operator|->
name|appendColumn
argument_list|(
name|items
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|o
operator|.
name|count
operator|=
literal|0
expr_stmt|;
name|tree
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|setValue
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|o
operator|.
name|count
operator|>
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task250683_wrongSectionSize
name|void
name|tst_QTreeView
operator|::
name|task250683_wrongSectionSize
parameter_list|()
block|{
name|QStandardItemModel
name|model
decl_stmt|;
name|populateFakeDirModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QTreeView
name|treeView
decl_stmt|;
name|treeView
operator|.
name|header
argument_list|()
operator|->
name|setSectionResizeMode
argument_list|(
name|QHeaderView
operator|::
name|ResizeToContents
argument_list|)
expr_stmt|;
name|treeView
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|treeView
operator|.
name|setColumnHidden
argument_list|(
literal|2
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|treeView
operator|.
name|setColumnHidden
argument_list|(
literal|3
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|treeView
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|treeView
operator|.
name|header
argument_list|()
operator|->
name|sectionSize
argument_list|(
literal|0
argument_list|)
operator|+
name|treeView
operator|.
name|header
argument_list|()
operator|->
name|sectionSize
argument_list|(
literal|1
argument_list|)
argument_list|,
name|treeView
operator|.
name|viewport
argument_list|()
operator|->
name|width
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task239271_addRowsWithFirstColumnHidden
name|void
name|tst_QTreeView
operator|::
name|task239271_addRowsWithFirstColumnHidden
parameter_list|()
block|{
class|class
name|MyDelegate
super|:
specifier|public
name|QStyledItemDelegate
block|{
public|public:
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionViewItem
modifier|&
name|option
parameter_list|,
specifier|const
name|QModelIndex
modifier|&
name|index
parameter_list|)
specifier|const
block|{
name|paintedIndexes
operator|<<
name|index
expr_stmt|;
name|QStyledItemDelegate
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|index
argument_list|)
expr_stmt|;
block|}
specifier|mutable
name|QSet
argument_list|<
name|QModelIndex
argument_list|>
name|paintedIndexes
decl_stmt|;
block|}
class|;
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
name|model
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|MyDelegate
name|delegate
decl_stmt|;
name|view
operator|.
name|setItemDelegate
argument_list|(
operator|&
name|delegate
argument_list|)
expr_stmt|;
name|QStandardItem
name|root0
argument_list|(
literal|"root0"
argument_list|)
decl_stmt|,
name|root1
argument_list|(
literal|"root1"
argument_list|)
decl_stmt|;
name|model
operator|.
name|invisibleRootItem
argument_list|()
operator|->
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|&
name|root0
operator|<<
operator|&
name|root1
argument_list|)
expr_stmt|;
name|QStandardItem
name|sub0
argument_list|(
literal|"sub0"
argument_list|)
decl_stmt|,
name|sub00
argument_list|(
literal|"sub00"
argument_list|)
decl_stmt|;
name|root0
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|&
name|sub0
operator|<<
operator|&
name|sub00
argument_list|)
expr_stmt|;
name|view
operator|.
name|expand
argument_list|(
name|root0
operator|.
name|index
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|hideColumn
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|delegate
operator|.
name|paintedIndexes
operator|.
name|clear
argument_list|()
expr_stmt|;
name|QStandardItem
name|sub1
argument_list|(
literal|"sub1"
argument_list|)
decl_stmt|,
name|sub11
argument_list|(
literal|"sub11"
argument_list|)
decl_stmt|;
name|root0
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
operator|&
name|sub1
operator|<<
operator|&
name|sub11
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
comment|//items in the 2nd column should have been painted
name|QTRY_VERIFY
argument_list|(
operator|!
name|delegate
operator|.
name|paintedIndexes
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|delegate
operator|.
name|paintedIndexes
operator|.
name|contains
argument_list|(
name|sub00
operator|.
name|index
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|delegate
operator|.
name|paintedIndexes
operator|.
name|contains
argument_list|(
name|sub11
operator|.
name|index
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task254234_proxySort
name|void
name|tst_QTreeView
operator|::
name|task254234_proxySort
parameter_list|()
block|{
comment|//based on tst_QTreeView::sortByColumn
comment|// it used not to work when setting the source of a proxy after enabling sorting
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
name|model
argument_list|(
literal|4
argument_list|,
literal|2
argument_list|)
decl_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"b"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"d"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|2
argument_list|,
literal|0
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"c"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|3
argument_list|,
literal|0
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"a"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"e"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"g"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"h"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|3
argument_list|,
literal|1
argument_list|,
operator|new
name|QStandardItem
argument_list|(
literal|"f"
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|sortByColumn
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QSortFilterProxyModel
name|proxy
decl_stmt|;
name|proxy
operator|.
name|setDynamicSortFilter
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|proxy
argument_list|)
expr_stmt|;
name|proxy
operator|.
name|setSourceModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|header
argument_list|()
operator|->
name|sortIndicatorSection
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|data
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"h"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|data
argument_list|(
name|view
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"g"
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|TreeView
class|class
name|TreeView
super|:
specifier|public
name|QTreeView
block|{
name|Q_OBJECT
public|public
name|slots
public|:
DECL|function|handleSelectionChanged
name|void
name|handleSelectionChanged
parameter_list|()
block|{
comment|//let's select the last item
name|QModelIndex
name|idx
init|=
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|selectionModel
argument_list|()
operator|->
name|select
argument_list|(
name|QItemSelection
argument_list|(
name|idx
argument_list|,
name|idx
argument_list|)
argument_list|,
name|QItemSelectionModel
operator|::
name|Select
argument_list|)
expr_stmt|;
name|disconnect
argument_list|(
name|selectionModel
argument_list|()
argument_list|,
name|SIGNAL
argument_list|(
name|selectionChanged
argument_list|(
name|QItemSelection
argument_list|,
name|QItemSelection
argument_list|)
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|handleSelectionChanged
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|task248022_changeSelection
name|void
name|tst_QTreeView
operator|::
name|task248022_changeSelection
parameter_list|()
block|{
comment|//we check that changing the selection between the mouse press and the mouse release
comment|//works correctly
name|TreeView
name|view
decl_stmt|;
name|QStringList
name|list
init|=
name|QStringList
argument_list|()
operator|<<
literal|"1"
operator|<<
literal|"2"
decl_stmt|;
name|QStringListModel
name|model
argument_list|(
name|list
argument_list|)
decl_stmt|;
name|view
operator|.
name|setSelectionMode
argument_list|(
name|QAbstractItemView
operator|::
name|ExtendedSelection
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|connect
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
argument_list|,
name|SIGNAL
argument_list|(
name|selectionChanged
argument_list|(
name|QItemSelection
argument_list|,
name|QItemSelection
argument_list|)
argument_list|)
argument_list|,
name|SLOT
argument_list|(
name|handleSelectionChanged
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|visualRect
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|1
argument_list|)
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|selectionModel
argument_list|()
operator|->
name|selectedIndexes
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
name|list
operator|.
name|count
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task245654_changeModelAndExpandAll
name|void
name|tst_QTreeView
operator|::
name|task245654_changeModelAndExpandAll
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
modifier|*
name|model
init|=
operator|new
name|QStandardItemModel
decl_stmt|;
name|QStandardItem
modifier|*
name|top
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"top"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|sub
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"sub"
argument_list|)
decl_stmt|;
name|top
operator|->
name|appendRow
argument_list|(
name|sub
argument_list|)
expr_stmt|;
name|model
operator|->
name|appendRow
argument_list|(
name|top
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|top
operator|->
name|index
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
comment|//now let's try to delete the model
comment|//then repopulate and expand again
operator|delete
name|model
expr_stmt|;
name|model
operator|=
operator|new
name|QStandardItemModel
expr_stmt|;
name|top
operator|=
operator|new
name|QStandardItem
argument_list|(
literal|"top"
argument_list|)
expr_stmt|;
name|sub
operator|=
operator|new
name|QStandardItem
argument_list|(
literal|"sub"
argument_list|)
expr_stmt|;
name|top
operator|->
name|appendRow
argument_list|(
name|sub
argument_list|)
expr_stmt|;
name|model
operator|->
name|appendRow
argument_list|(
name|top
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isExpanded
argument_list|(
name|top
operator|->
name|index
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|doubleClickedWithSpans
name|void
name|tst_QTreeView
operator|::
name|doubleClickedWithSpans
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QStandardItemModel
name|model
argument_list|(
literal|1
argument_list|,
literal|2
argument_list|)
decl_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFirstColumnSpanned
argument_list|(
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QPoint
name|p
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indexAt
argument_list|(
name|p
argument_list|)
argument_list|,
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QSignalSpy
name|spy
argument_list|(
operator|&
name|view
argument_list|,
name|SIGNAL
argument_list|(
name|doubleClicked
argument_list|(
name|QModelIndex
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|mousePress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseDClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseRelease
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//let's click on the 2nd column
name|p
operator|.
name|setX
argument_list|(
name|p
operator|.
name|x
argument_list|()
operator|+
name|view
operator|.
name|header
argument_list|()
operator|->
name|sectionSize
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|indexAt
argument_list|(
name|p
argument_list|)
argument_list|,
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
comment|//end the previous edition
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|150
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mousePress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseDClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseRelease
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|taskQTBUG_6450_selectAllWith1stColumnHidden
name|void
name|tst_QTreeView
operator|::
name|taskQTBUG_6450_selectAllWith1stColumnHidden
parameter_list|()
block|{
name|QTreeWidget
name|tree
decl_stmt|;
name|tree
operator|.
name|setSelectionMode
argument_list|(
name|QAbstractItemView
operator|::
name|MultiSelection
argument_list|)
expr_stmt|;
name|tree
operator|.
name|setColumnCount
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QTreeWidgetItem
modifier|*
argument_list|>
name|items
decl_stmt|;
specifier|const
name|int
name|nrRows
init|=
literal|10
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|nrRows
condition|;
operator|++
name|i
control|)
block|{
name|items
operator|.
name|append
argument_list|(
operator|new
name|QTreeWidgetItem
argument_list|(
operator|(
name|QTreeWidget
operator|*
operator|)
literal|0
argument_list|,
name|QStringList
argument_list|(
name|QString
argument_list|(
literal|"item: %1"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|items
operator|.
name|last
argument_list|()
operator|->
name|setText
argument_list|(
literal|1
argument_list|,
name|QString
argument_list|(
literal|"is an item"
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|tree
operator|.
name|insertTopLevelItems
argument_list|(
literal|0
argument_list|,
name|items
argument_list|)
expr_stmt|;
name|tree
operator|.
name|hideColumn
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|tree
operator|.
name|selectAll
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|tree
operator|.
name|selectionModel
argument_list|()
operator|->
name|hasSelection
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|nrRows
condition|;
operator|++
name|i
control|)
name|QVERIFY
argument_list|(
name|tree
operator|.
name|selectionModel
argument_list|()
operator|->
name|isRowSelected
argument_list|(
name|i
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|TreeViewQTBUG_9216
class|class
name|TreeViewQTBUG_9216
super|:
specifier|public
name|QTreeView
block|{
name|Q_OBJECT
public|public:
DECL|function|paintEvent
name|void
name|paintEvent
parameter_list|(
name|QPaintEvent
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
name|doCompare
condition|)
name|QCOMPARE
argument_list|(
name|event
operator|->
name|rect
argument_list|()
argument_list|,
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
argument_list|)
expr_stmt|;
name|QTreeView
operator|::
name|paintEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
name|painted
operator|++
expr_stmt|;
block|}
DECL|member|painted
name|int
name|painted
decl_stmt|;
DECL|member|doCompare
name|bool
name|doCompare
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|taskQTBUG_9216_setSizeAndUniformRowHeightsWrongRepaint
name|void
name|tst_QTreeView
operator|::
name|taskQTBUG_9216_setSizeAndUniformRowHeightsWrongRepaint
parameter_list|()
block|{
name|QStandardItemModel
name|model
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
name|this
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|row
init|=
literal|0
init|;
name|row
operator|<
literal|10
condition|;
name|row
operator|++
control|)
for|for
control|(
name|int
name|col
init|=
literal|0
init|;
name|col
operator|<
literal|10
condition|;
name|col
operator|++
control|)
name|model
operator|.
name|setItem
argument_list|(
name|row
argument_list|,
name|col
argument_list|,
operator|new
name|QStandardItem
argument_list|(
name|QString
argument_list|(
literal|"row %0, col %1"
argument_list|)
operator|.
name|arg
argument_list|(
name|row
argument_list|)
operator|.
name|arg
argument_list|(
name|col
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|TreeViewQTBUG_9216
name|view
decl_stmt|;
name|view
operator|.
name|setUniformRowHeights
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|painted
operator|=
literal|0
expr_stmt|;
name|view
operator|.
name|doCompare
operator|=
literal|false
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|painted
operator|>
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
comment|// This one is needed to make the test fail before the patch.
name|view
operator|.
name|painted
operator|=
literal|0
expr_stmt|;
name|view
operator|.
name|doCompare
operator|=
literal|true
expr_stmt|;
name|model
operator|.
name|setData
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QVariant
argument_list|(
name|QSize
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|SizeHintRole
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|painted
operator|>
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|keyboardNavigationWithDisabled
name|void
name|tst_QTreeView
operator|::
name|keyboardNavigationWithDisabled
parameter_list|()
block|{
name|QWidget
name|topLevel
decl_stmt|;
name|QTreeView
name|view
argument_list|(
operator|&
name|topLevel
argument_list|)
decl_stmt|;
name|QStandardItemModel
name|model
argument_list|(
literal|90
argument_list|,
literal|0
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|90
condition|;
name|i
operator|++
control|)
block|{
name|model
operator|.
name|setItem
argument_list|(
name|i
argument_list|,
operator|new
name|QStandardItem
argument_list|(
name|QString
operator|::
name|number
argument_list|(
name|i
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|item
argument_list|(
name|i
argument_list|)
operator|->
name|setEnabled
argument_list|(
name|i
operator|%
literal|6
operator|==
literal|0
argument_list|)
expr_stmt|;
block|}
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
name|view
operator|.
name|visualRect
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
operator|.
name|height
argument_list|()
operator|*
literal|10
argument_list|)
expr_stmt|;
name|topLevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|topLevel
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|topLevel
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|topLevel
operator|.
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setCurrentIndex
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Up
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|model
operator|.
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Down
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|model
operator|.
name|index
argument_list|(
literal|6
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_PageDown
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|model
operator|.
name|index
argument_list|(
literal|18
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Down
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|model
operator|.
name|index
argument_list|(
literal|24
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_PageUp
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|model
operator|.
name|index
argument_list|(
literal|12
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Up
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|model
operator|.
name|index
argument_list|(
literal|6
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|Model_11466
class|class
name|Model_11466
super|:
specifier|public
name|QAbstractItemModel
block|{
name|Q_OBJECT
public|public:
DECL|function|Model_11466
name|Model_11466
parameter_list|(
name|QObject
modifier|*
comment|/* parent */
parameter_list|)
member_init_list|:
name|m_block
argument_list|(
literal|false
argument_list|)
block|{
comment|// set up the model to have two top level items and a few others
name|m_selectionModel
operator|=
operator|new
name|QItemSelectionModel
argument_list|(
name|this
argument_list|,
name|this
argument_list|)
expr_stmt|;
comment|// owned by this
name|connect
argument_list|(
name|m_selectionModel
argument_list|,
name|SIGNAL
argument_list|(
name|currentChanged
argument_list|(
name|QModelIndex
argument_list|,
name|QModelIndex
argument_list|)
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|slotCurrentChanged
argument_list|(
name|QModelIndex
argument_list|,
name|QModelIndex
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
empty_stmt|;
DECL|function|rowCount
name|int
name|rowCount
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|parent
parameter_list|)
specifier|const
block|{
if|if
condition|(
name|parent
operator|.
name|isValid
argument_list|()
condition|)
return|return
operator|(
name|parent
operator|.
name|internalId
argument_list|()
operator|==
literal|0
operator|)
condition|?
literal|4
else|:
literal|0
return|;
return|return
literal|2
return|;
comment|// two top level items
block|}
DECL|function|columnCount
name|int
name|columnCount
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
comment|/* parent */
parameter_list|)
specifier|const
block|{
return|return
literal|2
return|;
block|}
DECL|function|data
name|QVariant
name|data
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|index
parameter_list|,
name|int
name|role
parameter_list|)
specifier|const
block|{
if|if
condition|(
name|role
operator|==
name|Qt
operator|::
name|DisplayRole
operator|&&
name|index
operator|.
name|isValid
argument_list|()
condition|)
block|{
name|qint64
name|parentRowPlusOne
init|=
name|index
operator|.
name|internalId
argument_list|()
decl_stmt|;
name|QString
name|str
decl_stmt|;
name|QTextStream
name|stream
argument_list|(
operator|&
name|str
argument_list|)
decl_stmt|;
if|if
condition|(
name|parentRowPlusOne
operator|>
literal|0
condition|)
name|stream
operator|<<
name|parentRowPlusOne
operator|<<
literal|" -> "
operator|<<
name|index
operator|.
name|row
argument_list|()
operator|<<
literal|" : "
operator|<<
name|index
operator|.
name|column
argument_list|()
expr_stmt|;
else|else
name|stream
operator|<<
name|index
operator|.
name|row
argument_list|()
operator|<<
literal|" : "
operator|<<
name|index
operator|.
name|column
argument_list|()
expr_stmt|;
return|return
name|QVariant
argument_list|(
name|str
argument_list|)
return|;
block|}
return|return
name|QVariant
argument_list|()
return|;
block|}
DECL|function|parent
name|QModelIndex
name|parent
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|index
parameter_list|)
specifier|const
block|{
if|if
condition|(
name|index
operator|.
name|isValid
argument_list|()
condition|)
block|{
name|qint64
name|parentRowPlusOne
init|=
name|index
operator|.
name|internalId
argument_list|()
decl_stmt|;
if|if
condition|(
name|parentRowPlusOne
operator|>
literal|0
condition|)
block|{
name|int
name|row
init|=
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|parentRowPlusOne
operator|-
literal|1
argument_list|)
decl_stmt|;
return|return
name|createIndex
argument_list|(
name|row
argument_list|,
literal|0
argument_list|)
return|;
block|}
block|}
return|return
name|QModelIndex
argument_list|()
return|;
block|}
DECL|function|bindView
name|void
name|bindView
parameter_list|(
name|QTreeView
modifier|*
name|view
parameter_list|)
block|{
comment|// sets the view to this model with a shared selection model
name|QItemSelectionModel
modifier|*
name|oldModel
init|=
name|view
operator|->
name|selectionModel
argument_list|()
decl_stmt|;
if|if
condition|(
name|oldModel
operator|!=
name|m_selectionModel
condition|)
operator|delete
name|oldModel
expr_stmt|;
name|view
operator|->
name|setModel
argument_list|(
name|this
argument_list|)
expr_stmt|;
comment|// this creates a new selection model for the view, but we don't want it either ...
name|oldModel
operator|=
name|view
operator|->
name|selectionModel
argument_list|()
expr_stmt|;
name|view
operator|->
name|setSelectionModel
argument_list|(
name|m_selectionModel
argument_list|)
expr_stmt|;
operator|delete
name|oldModel
expr_stmt|;
block|}
DECL|function|index
name|QModelIndex
name|index
parameter_list|(
name|int
name|row
parameter_list|,
name|int
name|column
parameter_list|,
specifier|const
name|QModelIndex
modifier|&
name|parent
parameter_list|)
specifier|const
block|{
return|return
name|createIndex
argument_list|(
name|row
argument_list|,
name|column
argument_list|,
name|parent
operator|.
name|isValid
argument_list|()
condition|?
call|(
name|quintptr
call|)
argument_list|(
name|parent
operator|.
name|row
argument_list|()
operator|+
literal|1
argument_list|)
else|:
operator|(
name|quintptr
operator|)
literal|0
argument_list|)
return|;
block|}
public|public
name|slots
public|:
DECL|function|slotCurrentChanged
name|void
name|slotCurrentChanged
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|current
parameter_list|,
specifier|const
name|QModelIndex
modifier|&
parameter_list|)
block|{
if|if
condition|(
name|m_block
condition|)
return|return;
if|if
condition|(
name|current
operator|.
name|isValid
argument_list|()
condition|)
block|{
name|int
name|selectedRow
init|=
name|current
operator|.
name|row
argument_list|()
decl_stmt|;
specifier|const
name|quintptr
name|parentRowPlusOne
init|=
name|current
operator|.
name|internalId
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
operator|++
name|i
control|)
block|{
comment|// announce the removal of all non top level items
name|beginRemoveRows
argument_list|(
name|createIndex
argument_list|(
name|i
argument_list|,
literal|0
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|// nothing to actually do for the removal
name|endRemoveRows
argument_list|()
expr_stmt|;
comment|// put them back in again
name|beginInsertRows
argument_list|(
name|createIndex
argument_list|(
name|i
argument_list|,
literal|0
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|// nothing to actually do for the insertion
name|endInsertRows
argument_list|()
expr_stmt|;
block|}
comment|// reselect the current item ...
name|QModelIndex
name|selectedIndex
init|=
name|createIndex
argument_list|(
name|selectedRow
argument_list|,
literal|0
argument_list|,
name|parentRowPlusOne
argument_list|)
decl_stmt|;
name|m_block
operator|=
literal|true
expr_stmt|;
comment|// recursion block
name|m_selectionModel
operator|->
name|select
argument_list|(
name|selectedIndex
argument_list|,
name|QItemSelectionModel
operator|::
name|ClearAndSelect
operator||
name|QItemSelectionModel
operator|::
name|Current
operator||
name|QItemSelectionModel
operator|::
name|Rows
argument_list|)
expr_stmt|;
name|m_selectionModel
operator|->
name|setCurrentIndex
argument_list|(
name|selectedIndex
argument_list|,
name|QItemSelectionModel
operator|::
name|NoUpdate
argument_list|)
expr_stmt|;
name|m_block
operator|=
literal|false
expr_stmt|;
block|}
else|else
block|{
name|m_selectionModel
operator|->
name|clear
argument_list|()
expr_stmt|;
block|}
block|}
private|private:
DECL|member|m_block
name|bool
name|m_block
decl_stmt|;
DECL|member|m_selectionModel
name|QItemSelectionModel
modifier|*
name|m_selectionModel
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|taskQTBUG_11466_keyboardNavigationRegression
name|void
name|tst_QTreeView
operator|::
name|taskQTBUG_11466_keyboardNavigationRegression
parameter_list|()
block|{
name|QTreeView
name|treeView
decl_stmt|;
name|treeView
operator|.
name|setSelectionBehavior
argument_list|(
name|QAbstractItemView
operator|::
name|SelectRows
argument_list|)
expr_stmt|;
name|treeView
operator|.
name|setSelectionMode
argument_list|(
name|QAbstractItemView
operator|::
name|SingleSelection
argument_list|)
expr_stmt|;
name|Model_11466
name|model
argument_list|(
operator|&
name|treeView
argument_list|)
decl_stmt|;
name|model
operator|.
name|bindView
argument_list|(
operator|&
name|treeView
argument_list|)
expr_stmt|;
name|treeView
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|treeView
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|treeView
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|treeView
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Down
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|treeView
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|treeView
operator|.
name|selectionModel
argument_list|()
operator|->
name|selection
argument_list|()
operator|.
name|indexes
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|taskQTBUG_13567_removeLastItemRegression
name|void
name|tst_QTreeView
operator|::
name|taskQTBUG_13567_removeLastItemRegression
parameter_list|()
block|{
name|QtTestModel
name|model
argument_list|(
literal|200
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|QTreeView
name|view
decl_stmt|;
name|view
operator|.
name|setSelectionMode
argument_list|(
name|QAbstractItemView
operator|::
name|ExtendedSelection
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|scrollToBottom
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|CHECK_VISIBLE
argument_list|(
literal|199
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|setCurrentIndex
argument_list|(
name|model
operator|.
name|index
argument_list|(
literal|199
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|removeLastRow
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|currentIndex
argument_list|()
argument_list|,
name|model
operator|.
name|index
argument_list|(
literal|198
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|CHECK_VISIBLE
argument_list|(
literal|198
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// From QTBUG-25333 (QTreeWidget drag crashes when there was a hidden item in tree)
end_comment
begin_comment
comment|// The test passes simply if it doesn't crash, hence there are no calls
end_comment
begin_comment
comment|// to QCOMPARE() or QVERIFY().
end_comment
begin_comment
comment|// Note: define QT_BUILD_INTERNAL to run this test
end_comment
begin_function
DECL|function|taskQTBUG_25333_adjustViewOptionsForIndex
name|void
name|tst_QTreeView
operator|::
name|taskQTBUG_25333_adjustViewOptionsForIndex
parameter_list|()
block|{
name|PublicView
name|view
decl_stmt|;
name|QStandardItemModel
name|model
decl_stmt|;
name|QStandardItem
modifier|*
name|item1
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"Item1"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|item2
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"Item2"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|item3
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"Item3"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|data1
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"Data1"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|data2
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"Data2"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|data3
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"Data3"
argument_list|)
decl_stmt|;
comment|// Create a treeview
name|model
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item1
operator|<<
name|data1
argument_list|)
expr_stmt|;
name|model
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item2
operator|<<
name|data2
argument_list|)
expr_stmt|;
name|model
operator|.
name|appendRow
argument_list|(
name|QList
argument_list|<
name|QStandardItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item3
operator|<<
name|data3
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
comment|// Hide a row
name|view
operator|.
name|setRowHidden
argument_list|(
literal|1
argument_list|,
name|QModelIndex
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
ifdef|#
directive|ifdef
name|QT_BUILD_INTERNAL
block|{
name|QStyleOptionViewItemV4
name|option
decl_stmt|;
name|view
operator|.
name|aiv_priv
argument_list|()
operator|->
name|adjustViewOptionsForIndex
argument_list|(
operator|&
name|option
argument_list|,
name|model
operator|.
name|indexFromItem
argument_list|(
name|item1
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|aiv_priv
argument_list|()
operator|->
name|adjustViewOptionsForIndex
argument_list|(
operator|&
name|option
argument_list|,
name|model
operator|.
name|indexFromItem
argument_list|(
name|item3
argument_list|)
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
block|}
end_function
begin_function
DECL|function|taskQTBUG_18539_emitLayoutChanged
name|void
name|tst_QTreeView
operator|::
name|taskQTBUG_18539_emitLayoutChanged
parameter_list|()
block|{
name|QTreeView
name|view
decl_stmt|;
name|QStandardItem
modifier|*
name|item
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"Orig"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|child
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"Child"
argument_list|)
decl_stmt|;
name|item
operator|->
name|setChild
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|child
argument_list|)
expr_stmt|;
name|QStandardItemModel
name|model
decl_stmt|;
name|model
operator|.
name|appendRow
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|view
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QStandardItem
modifier|*
name|replacementItem
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"Replacement"
argument_list|)
decl_stmt|;
name|QStandardItem
modifier|*
name|replacementChild
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"ReplacementChild"
argument_list|)
decl_stmt|;
name|replacementItem
operator|->
name|setChild
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|replacementChild
argument_list|)
expr_stmt|;
name|QSignalSpy
name|beforeSpy
argument_list|(
operator|&
name|model
argument_list|,
name|SIGNAL
argument_list|(
name|layoutAboutToBeChanged
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|QSignalSpy
name|afterSpy
argument_list|(
operator|&
name|model
argument_list|,
name|SIGNAL
argument_list|(
name|layoutChanged
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|QSignalSpy
name|beforeRISpy
argument_list|(
operator|&
name|model
argument_list|,
name|SIGNAL
argument_list|(
name|rowsAboutToBeInserted
argument_list|(
name|QModelIndex
argument_list|,
name|int
argument_list|,
name|int
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QSignalSpy
name|afterRISpy
argument_list|(
operator|&
name|model
argument_list|,
name|SIGNAL
argument_list|(
name|rowsInserted
argument_list|(
name|QModelIndex
argument_list|,
name|int
argument_list|,
name|int
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QSignalSpy
name|beforeRRSpy
argument_list|(
operator|&
name|model
argument_list|,
name|SIGNAL
argument_list|(
name|rowsAboutToBeRemoved
argument_list|(
name|QModelIndex
argument_list|,
name|int
argument_list|,
name|int
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QSignalSpy
name|afterRRSpy
argument_list|(
operator|&
name|model
argument_list|,
name|SIGNAL
argument_list|(
name|rowsRemoved
argument_list|(
name|QModelIndex
argument_list|,
name|int
argument_list|,
name|int
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|model
operator|.
name|setItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|replacementItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|beforeSpy
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|afterSpy
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|beforeRISpy
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|afterRISpy
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|beforeRISpy
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|afterRISpy
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|taskQTBUG_8176_emitOnExpandAll
name|void
name|tst_QTreeView
operator|::
name|taskQTBUG_8176_emitOnExpandAll
parameter_list|()
block|{
name|QTreeWidget
name|tw
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|tw
argument_list|,
name|QStringList
argument_list|(
name|QString
argument_list|(
literal|"item 1"
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|item2
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|item
argument_list|,
name|QStringList
argument_list|(
name|QString
argument_list|(
literal|"item 2"
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
operator|new
name|QTreeWidgetItem
argument_list|(
name|item2
argument_list|,
name|QStringList
argument_list|(
name|QString
argument_list|(
literal|"item 3"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
operator|new
name|QTreeWidgetItem
argument_list|(
name|item2
argument_list|,
name|QStringList
argument_list|(
name|QString
argument_list|(
literal|"item 4"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|item5
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|tw
argument_list|,
name|QStringList
argument_list|(
name|QString
argument_list|(
literal|"item 5"
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
operator|new
name|QTreeWidgetItem
argument_list|(
name|item5
argument_list|,
name|QStringList
argument_list|(
name|QString
argument_list|(
literal|"item 6"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QSignalSpy
name|spy
argument_list|(
operator|&
name|tw
argument_list|,
name|SIGNAL
argument_list|(
name|expanded
argument_list|(
specifier|const
name|QModelIndex
operator|&
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
comment|// expand all
name|tw
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|size
argument_list|()
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|spy
operator|.
name|clear
argument_list|()
expr_stmt|;
name|tw
operator|.
name|collapseAll
argument_list|()
expr_stmt|;
name|item2
operator|->
name|setExpanded
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|spy
operator|.
name|clear
argument_list|()
expr_stmt|;
name|tw
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|// collapse all
name|QSignalSpy
name|spy2
argument_list|(
operator|&
name|tw
argument_list|,
name|SIGNAL
argument_list|(
name|collapsed
argument_list|(
specifier|const
name|QModelIndex
operator|&
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|tw
operator|.
name|collapseAll
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy2
operator|.
name|size
argument_list|()
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|tw
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|item2
operator|->
name|setExpanded
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|spy2
operator|.
name|clear
argument_list|()
expr_stmt|;
name|tw
operator|.
name|collapseAll
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy2
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|// expand to depth
name|item2
operator|->
name|setExpanded
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|spy
operator|.
name|clear
argument_list|()
expr_stmt|;
name|spy2
operator|.
name|clear
argument_list|()
expr_stmt|;
name|tw
operator|.
name|expandToDepth
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// item and item5 are expanded
name|QCOMPARE
argument_list|(
name|spy2
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// item2 is collapsed
block|}
end_function
begin_comment
comment|// From QTBUG_34717 (QTreeWidget crashes when scrolling to the end
end_comment
begin_comment
comment|// of an expanded tree, then collapse all)
end_comment
begin_comment
comment|// The test passes simply if it doesn't crash.
end_comment
begin_function
DECL|function|taskQTBUG_34717_collapseAtBottom
name|void
name|tst_QTreeView
operator|::
name|taskQTBUG_34717_collapseAtBottom
parameter_list|()
block|{
name|QTreeWidget
name|treeWidget
decl_stmt|;
name|treeWidget
operator|.
name|header
argument_list|()
operator|->
name|setSectionResizeMode
argument_list|(
name|QHeaderView
operator|::
name|ResizeToContents
argument_list|)
expr_stmt|;
name|treeWidget
operator|.
name|setColumnCount
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|mainItem
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|treeWidget
argument_list|,
name|QStringList
argument_list|()
operator|<<
literal|"Root"
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|200
condition|;
operator|++
name|i
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|mainItem
argument_list|,
name|QStringList
argument_list|(
name|QString
argument_list|(
literal|"Item"
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
operator|new
name|QTreeWidgetItem
argument_list|(
name|item
argument_list|,
name|QStringList
argument_list|()
operator|<<
literal|"Child"
operator|<<
literal|"1"
argument_list|)
expr_stmt|;
operator|new
name|QTreeWidgetItem
argument_list|(
name|item
argument_list|,
name|QStringList
argument_list|()
operator|<<
literal|"Child"
operator|<<
literal|"2"
argument_list|)
expr_stmt|;
operator|new
name|QTreeWidgetItem
argument_list|(
name|item
argument_list|,
name|QStringList
argument_list|()
operator|<<
literal|"Child"
operator|<<
literal|"3"
argument_list|)
expr_stmt|;
block|}
name|treeWidget
operator|.
name|show
argument_list|()
expr_stmt|;
name|treeWidget
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|treeWidget
operator|.
name|scrollToBottom
argument_list|()
expr_stmt|;
name|treeWidget
operator|.
name|collapseAll
argument_list|()
expr_stmt|;
name|treeWidget
operator|.
name|setAnimated
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|treeWidget
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|treeWidget
operator|.
name|scrollToBottom
argument_list|()
expr_stmt|;
name|mainItem
operator|->
name|setExpanded
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|PublicView
modifier|*
name|pview
init|=
operator|(
name|PublicView
operator|*
operator|)
operator|&
name|treeWidget
decl_stmt|;
name|QVERIFY
argument_list|(
name|pview
operator|->
name|sizeHintForColumn
argument_list|(
literal|1
argument_list|)
operator|>=
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|testInitialFocus
name|void
name|tst_QTreeView
operator|::
name|testInitialFocus
parameter_list|()
block|{
name|QTreeWidget
name|treeWidget
decl_stmt|;
name|treeWidget
operator|.
name|setColumnCount
argument_list|(
literal|5
argument_list|)
expr_stmt|;
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|treeWidget
argument_list|,
name|QStringList
argument_list|(
name|QString
argument_list|(
literal|"1;2;3;4;5"
argument_list|)
operator|.
name|split
argument_list|(
literal|";"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|treeWidget
operator|.
name|setTreePosition
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|treeWidget
operator|.
name|header
argument_list|()
operator|->
name|hideSection
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|// make sure we skip hidden section(s)
name|treeWidget
operator|.
name|header
argument_list|()
operator|->
name|swapSections
argument_list|(
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// make sure that we look for first visual index (and not first logical)
name|treeWidget
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|treeWidget
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|treeWidget
operator|.
name|currentIndex
argument_list|()
operator|.
name|column
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_ifndef
ifndef|#
directive|ifndef
name|QT_NO_ANIMATION
end_ifndef
begin_function
DECL|function|quickExpandCollapse
name|void
name|tst_QTreeView
operator|::
name|quickExpandCollapse
parameter_list|()
block|{
comment|//this unit tests makes sure the state after the animation is restored correctly
comment|//after starting a 2nd animation while the first one was still on-going
comment|//this tests that the stateBeforeAnimation is not set to AnimatingState
name|PublicView
name|tree
decl_stmt|;
name|tree
operator|.
name|setAnimated
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QStandardItemModel
name|model
decl_stmt|;
name|QStandardItem
modifier|*
name|root
init|=
operator|new
name|QStandardItem
argument_list|(
literal|"root"
argument_list|)
decl_stmt|;
name|root
operator|->
name|appendRow
argument_list|(
operator|new
name|QStandardItem
argument_list|(
literal|"subnode"
argument_list|)
argument_list|)
expr_stmt|;
name|model
operator|.
name|appendRow
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|tree
operator|.
name|setModel
argument_list|(
operator|&
name|model
argument_list|)
expr_stmt|;
name|QModelIndex
name|rootIndex
init|=
name|root
operator|->
name|index
argument_list|()
decl_stmt|;
name|QVERIFY
argument_list|(
name|rootIndex
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|tree
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|tree
argument_list|)
expr_stmt|;
name|int
name|initialState
init|=
name|tree
operator|.
name|state
argument_list|()
decl_stmt|;
name|tree
operator|.
name|expand
argument_list|(
name|rootIndex
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|state
argument_list|()
argument_list|,
operator|(
name|int
operator|)
name|PublicView
operator|::
name|AnimatingState
argument_list|)
expr_stmt|;
name|tree
operator|.
name|collapse
argument_list|(
name|rootIndex
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|state
argument_list|()
argument_list|,
operator|(
name|int
operator|)
name|PublicView
operator|::
name|AnimatingState
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|500
argument_list|)
expr_stmt|;
comment|//the animation lasts for 250ms max so 500 should be enough
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|state
argument_list|()
argument_list|,
name|initialState
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_function
DECL|function|taskQTBUG_37813_crash
name|void
name|tst_QTreeView
operator|::
name|taskQTBUG_37813_crash
parameter_list|()
block|{
comment|// QTBUG_37813: Crash in visual / logical index mapping in QTreeViewPrivate::adjustViewOptionsForIndex()
comment|// when hiding/moving columns. It is reproduceable with a QTreeWidget only.
ifdef|#
directive|ifdef
name|QT_BUILD_INTERNAL
name|QTreeWidget
name|treeWidget
decl_stmt|;
name|treeWidget
operator|.
name|setDragEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|treeWidget
operator|.
name|setColumnCount
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QTreeWidgetItem
modifier|*
argument_list|>
name|items
decl_stmt|;
for|for
control|(
name|int
name|r
init|=
literal|0
init|;
name|r
operator|<
literal|2
condition|;
operator|++
name|r
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|new
name|QTreeWidgetItem
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|c
init|=
literal|0
init|;
name|c
operator|<
name|treeWidget
operator|.
name|columnCount
argument_list|()
condition|;
operator|++
name|c
control|)
name|item
operator|->
name|setText
argument_list|(
name|c
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"Row %1 Column %2"
argument_list|)
operator|.
name|arg
argument_list|(
name|r
argument_list|)
operator|.
name|arg
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
name|items
operator|.
name|append
argument_list|(
name|item
argument_list|)
expr_stmt|;
block|}
name|treeWidget
operator|.
name|addTopLevelItems
argument_list|(
name|items
argument_list|)
expr_stmt|;
name|treeWidget
operator|.
name|setColumnHidden
argument_list|(
literal|0
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|treeWidget
operator|.
name|header
argument_list|()
operator|->
name|moveSection
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QItemSelection
name|sel
argument_list|(
name|treeWidget
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|treeWidget
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
argument_list|)
decl_stmt|;
name|QRect
name|rect
decl_stmt|;
name|QAbstractItemViewPrivate
modifier|*
name|av
init|=
cast|static_cast
argument_list|<
name|QAbstractItemViewPrivate
operator|*
argument_list|>
argument_list|(
name|qt_widget_private
argument_list|(
operator|&
name|treeWidget
argument_list|)
argument_list|)
decl_stmt|;
specifier|const
name|QPixmap
name|pixmap
init|=
name|av
operator|->
name|renderToPixmap
argument_list|(
name|sel
operator|.
name|indexes
argument_list|()
argument_list|,
operator|&
name|rect
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|pixmap
operator|.
name|size
argument_list|()
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|// QT_BUILD_INTERNAL
block|}
end_function
begin_macro
name|QTEST_MAIN
argument_list|(
argument|tst_QTreeView
argument_list|)
end_macro
begin_include
include|#
directive|include
file|"tst_qtreeview.moc"
end_include
end_unit
