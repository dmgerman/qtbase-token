begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2013 Digia Plc and/or its subsidiary(-ies). ** Contact: http://www.qt-project.org/legal ** ** This file is part of the test suite of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL$ ** Commercial License Usage ** Licensees holding valid commercial Qt licenses may use this file in ** accordance with the commercial license agreement provided with the ** Software or, alternatively, in accordance with the terms contained in ** a written agreement between you and Digia.  For licensing terms and ** conditions see http://qt.digia.com/licensing.  For further information ** use the contact form at http://qt.digia.com/contact-us. ** ** GNU Lesser General Public License Usage ** Alternatively, this file may be used under the terms of the GNU Lesser ** General Public License version 2.1 as published by the Free Software ** Foundation and appearing in the file LICENSE.LGPL included in the ** packaging of this file.  Please review the following information to ** ensure the GNU Lesser General Public License version 2.1 requirements ** will be met: http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html. ** ** In addition, as a special exception, Digia gives you certain additional ** rights.  These rights are described in the Digia Qt LGPL Exception ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package. ** ** GNU General Public License Usage ** Alternatively, this file may be used under the terms of the GNU ** General Public License version 3.0 as published by the Free Software ** Foundation and appearing in the file LICENSE.GPL included in the ** packaging of this file.  Please review the following information to ** ensure the GNU General Public License version 3.0 requirements will be ** met: http://www.gnu.org/copyleft/gpl.html. ** ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<QtTest/QtTest>
end_include
begin_include
include|#
directive|include
file|<qtreewidget.h>
end_include
begin_include
include|#
directive|include
file|<qtreewidgetitemiterator.h>
end_include
begin_include
include|#
directive|include
file|<qapplication.h>
end_include
begin_include
include|#
directive|include
file|<qeventloop.h>
end_include
begin_include
include|#
directive|include
file|<qdebug.h>
end_include
begin_include
include|#
directive|include
file|<qheaderview.h>
end_include
begin_include
include|#
directive|include
file|<qlineedit.h>
end_include
begin_include
include|#
directive|include
file|<QScrollBar>
end_include
begin_include
include|#
directive|include
file|<QStyledItemDelegate>
end_include
begin_class
DECL|class|CustomTreeWidget
class|class
name|CustomTreeWidget
super|:
specifier|public
name|QTreeWidget
block|{
name|Q_OBJECT
public|public:
DECL|function|indexFromItem
name|QModelIndex
name|indexFromItem
parameter_list|(
name|QTreeWidgetItem
modifier|*
name|item
parameter_list|,
name|int
name|column
init|=
literal|0
parameter_list|)
specifier|const
block|{
return|return
name|QTreeWidget
operator|::
name|indexFromItem
argument_list|(
name|item
argument_list|,
name|column
argument_list|)
return|;
block|}
block|}
class|;
end_class
begin_class
DECL|class|tst_QTreeWidget
class|class
name|tst_QTreeWidget
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
public|public:
name|tst_QTreeWidget
parameter_list|()
constructor_decl|;
name|~
name|tst_QTreeWidget
parameter_list|()
destructor_decl|;
public|public
name|slots
public|:
name|void
name|initTestCase
parameter_list|()
function_decl|;
name|void
name|cleanupTestCase
parameter_list|()
function_decl|;
name|void
name|init
parameter_list|()
function_decl|;
name|void
name|cleanup
parameter_list|()
function_decl|;
private|private
name|slots
private|:
name|void
name|getSetCheck
parameter_list|()
function_decl|;
name|void
name|addTopLevelItem
parameter_list|()
function_decl|;
name|void
name|currentItem_data
parameter_list|()
function_decl|;
name|void
name|currentItem
parameter_list|()
function_decl|;
name|void
name|editItem_data
parameter_list|()
function_decl|;
name|void
name|editItem
parameter_list|()
function_decl|;
name|void
name|takeItem_data
parameter_list|()
function_decl|;
name|void
name|takeItem
parameter_list|()
function_decl|;
name|void
name|removeChild_data
parameter_list|()
function_decl|;
name|void
name|removeChild
parameter_list|()
function_decl|;
name|void
name|setItemHidden
parameter_list|()
function_decl|;
name|void
name|setItemHidden2
parameter_list|()
function_decl|;
name|void
name|selectedItems_data
parameter_list|()
function_decl|;
name|void
name|selectedItems
parameter_list|()
function_decl|;
name|void
name|itemAssignment
parameter_list|()
function_decl|;
name|void
name|clone_data
parameter_list|()
function_decl|;
name|void
name|clone
parameter_list|()
function_decl|;
name|void
name|expand_data
parameter_list|()
function_decl|;
name|void
name|expand
parameter_list|()
function_decl|;
name|void
name|checkState_data
parameter_list|()
function_decl|;
name|void
name|checkState
parameter_list|()
function_decl|;
name|void
name|findItems_data
parameter_list|()
function_decl|;
name|void
name|findItems
parameter_list|()
function_decl|;
name|void
name|findItemsInColumn
parameter_list|()
function_decl|;
name|void
name|sortItems_data
parameter_list|()
function_decl|;
name|void
name|sortItems
parameter_list|()
function_decl|;
name|void
name|deleteItems_data
parameter_list|()
function_decl|;
name|void
name|deleteItems
parameter_list|()
function_decl|;
name|void
name|itemAboveOrBelow
parameter_list|()
function_decl|;
name|void
name|itemStreaming_data
parameter_list|()
function_decl|;
name|void
name|itemStreaming
parameter_list|()
function_decl|;
name|void
name|insertTopLevelItems_data
parameter_list|()
function_decl|;
name|void
name|insertTopLevelItems
parameter_list|()
function_decl|;
name|void
name|keyboardNavigation
parameter_list|()
function_decl|;
name|void
name|scrollToItem
parameter_list|()
function_decl|;
name|void
name|setSortingEnabled
parameter_list|()
function_decl|;
name|void
name|match
parameter_list|()
function_decl|;
name|void
name|columnCount
parameter_list|()
function_decl|;
name|void
name|setHeaderLabels
parameter_list|()
function_decl|;
name|void
name|setHeaderItem
parameter_list|()
function_decl|;
name|void
name|itemWidget_data
parameter_list|()
function_decl|;
name|void
name|itemWidget
parameter_list|()
function_decl|;
name|void
name|insertItemsWithSorting_data
parameter_list|()
function_decl|;
name|void
name|insertItemsWithSorting
parameter_list|()
function_decl|;
name|void
name|insertExpandedItemsWithSorting_data
parameter_list|()
function_decl|;
name|void
name|insertExpandedItemsWithSorting
parameter_list|()
function_decl|;
name|void
name|changeDataWithSorting_data
parameter_list|()
function_decl|;
name|void
name|changeDataWithSorting
parameter_list|()
function_decl|;
name|void
name|changeDataWithStableSorting_data
parameter_list|()
function_decl|;
name|void
name|changeDataWithStableSorting
parameter_list|()
function_decl|;
name|void
name|sortedIndexOfChild_data
parameter_list|()
function_decl|;
name|void
name|sortedIndexOfChild
parameter_list|()
function_decl|;
name|void
name|defaultRowSizes
parameter_list|()
function_decl|;
name|void
name|task191552_rtl
parameter_list|()
function_decl|;
name|void
name|task203673_selection
parameter_list|()
function_decl|;
name|void
name|rootItemFlags
parameter_list|()
function_decl|;
name|void
name|task218661_setHeaderData
parameter_list|()
function_decl|;
name|void
name|task245280_sortChildren
parameter_list|()
function_decl|;
name|void
name|task253109_itemHeight
parameter_list|()
function_decl|;
comment|// QTreeWidgetItem
name|void
name|itemOperatorLessThan
parameter_list|()
function_decl|;
name|void
name|addChild
parameter_list|()
function_decl|;
name|void
name|setData
parameter_list|()
function_decl|;
name|void
name|enableDisable
parameter_list|()
function_decl|;
name|void
name|expandAndCallapse
parameter_list|()
function_decl|;
name|void
name|itemData
parameter_list|()
function_decl|;
name|void
name|setDisabled
parameter_list|()
function_decl|;
name|void
name|removeSelectedItem
parameter_list|()
function_decl|;
name|void
name|removeCurrentItem
parameter_list|()
function_decl|;
name|void
name|removeCurrentItem_task186451
parameter_list|()
function_decl|;
name|void
name|randomExpand
parameter_list|()
function_decl|;
name|void
name|crashTest
parameter_list|()
function_decl|;
name|void
name|sortAndSelect
parameter_list|()
function_decl|;
name|void
name|task206367_duplication
parameter_list|()
function_decl|;
name|void
name|selectionOrder
parameter_list|()
function_decl|;
name|void
name|setSelectionModel
parameter_list|()
function_decl|;
name|void
name|task217309
parameter_list|()
function_decl|;
name|void
name|setCurrentItemExpandsParent
parameter_list|()
function_decl|;
name|void
name|task239150_editorWidth
parameter_list|()
function_decl|;
name|void
name|setTextUpdate
parameter_list|()
function_decl|;
name|void
name|taskQTBUG2844_visualItemRect
parameter_list|()
function_decl|;
name|void
name|setChildIndicatorPolicy
parameter_list|()
function_decl|;
name|void
name|task20345_sortChildren
parameter_list|()
function_decl|;
public|public
name|slots
public|:
name|void
name|itemSelectionChanged
parameter_list|()
function_decl|;
name|void
name|emitDataChanged
parameter_list|()
function_decl|;
private|private:
DECL|member|testWidget
name|CustomTreeWidget
modifier|*
name|testWidget
decl_stmt|;
block|}
class|;
end_class
begin_comment
comment|// Testing get/set functions
end_comment
begin_function
DECL|function|getSetCheck
name|void
name|tst_QTreeWidget
operator|::
name|getSetCheck
parameter_list|()
block|{
name|QTreeWidget
name|obj1
decl_stmt|;
comment|// int QTreeWidget::columnCount()
comment|// void QTreeWidget::setColumnCount(int)
name|obj1
operator|.
name|setColumnCount
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|columnCount
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setColumnCount
argument_list|(
name|INT_MIN
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|columnCount
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|//obj1.setColumnCount(INT_MAX);
comment|//QCOMPARE(obj1.columnCount(), INT_MAX);
comment|// Since setColumnCount allocates memory, there is no way this will succeed
name|obj1
operator|.
name|setColumnCount
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|columnCount
argument_list|()
argument_list|,
literal|100
argument_list|)
expr_stmt|;
comment|// QTreeWidgetItem * QTreeWidget::headerItem()
comment|// void QTreeWidget::setHeaderItem(QTreeWidgetItem *)
name|QTreeWidgetItem
modifier|*
name|var2
init|=
operator|new
name|QTreeWidgetItem
argument_list|()
decl_stmt|;
name|obj1
operator|.
name|setHeaderItem
argument_list|(
name|var2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|headerItem
argument_list|()
argument_list|,
name|var2
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setHeaderItem
argument_list|(
operator|(
name|QTreeWidgetItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|//    QCOMPARE(obj1.headerItem(), (QTreeWidgetItem *)0);
comment|// QTreeWidgetItem * QTreeWidget::currentItem()
comment|// void QTreeWidget::setCurrentItem(QTreeWidgetItem *)
name|QTreeWidgetItem
modifier|*
name|var3
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|obj1
argument_list|)
decl_stmt|;
name|obj1
operator|.
name|setCurrentItem
argument_list|(
name|var3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|currentItem
argument_list|()
argument_list|,
name|var3
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setCurrentItem
argument_list|(
operator|(
name|QTreeWidgetItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|currentItem
argument_list|()
argument_list|,
operator|(
name|QTreeWidgetItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_typedef
DECL|typedef|IntList
typedef|typedef
name|QList
argument_list|<
name|int
argument_list|>
name|IntList
typedef|;
end_typedef
begin_typedef
DECL|typedef|ListIntList
typedef|typedef
name|QList
argument_list|<
name|IntList
argument_list|>
name|ListIntList
typedef|;
end_typedef
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|Qt::Orientation
argument_list|)
end_macro
begin_typedef
DECL|typedef|TreeItem
typedef|typedef
name|QTreeWidgetItem
name|TreeItem
typedef|;
end_typedef
begin_typedef
DECL|typedef|TreeItemList
typedef|typedef
name|QList
argument_list|<
name|TreeItem
modifier|*
argument_list|>
name|TreeItemList
typedef|;
end_typedef
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QTreeWidgetItem*
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|TreeItemList
argument_list|)
end_macro
begin_constructor
DECL|function|tst_QTreeWidget
name|tst_QTreeWidget
operator|::
name|tst_QTreeWidget
parameter_list|()
member_init_list|:
name|testWidget
argument_list|(
literal|0
argument_list|)
block|{ }
end_constructor
begin_destructor
DECL|function|~tst_QTreeWidget
name|tst_QTreeWidget
operator|::
name|~
name|tst_QTreeWidget
parameter_list|()
block|{ }
end_destructor
begin_function
DECL|function|initTestCase
name|void
name|tst_QTreeWidget
operator|::
name|initTestCase
parameter_list|()
block|{
name|qMetaTypeId
argument_list|<
name|QModelIndex
argument_list|>
argument_list|()
expr_stmt|;
name|qMetaTypeId
argument_list|<
name|Qt
operator|::
name|Orientation
argument_list|>
argument_list|()
expr_stmt|;
name|qRegisterMetaType
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
literal|"QTreeWidgetItem*"
argument_list|)
expr_stmt|;
name|testWidget
operator|=
operator|new
name|CustomTreeWidget
argument_list|()
expr_stmt|;
name|testWidget
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
name|testWidget
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|cleanupTestCase
name|void
name|tst_QTreeWidget
operator|::
name|cleanupTestCase
parameter_list|()
block|{
name|testWidget
operator|->
name|hide
argument_list|()
expr_stmt|;
operator|delete
name|testWidget
expr_stmt|;
block|}
end_function
begin_function
DECL|function|init
name|void
name|tst_QTreeWidget
operator|::
name|init
parameter_list|()
block|{
name|testWidget
operator|->
name|clear
argument_list|()
expr_stmt|;
name|testWidget
operator|->
name|setColumnCount
argument_list|(
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|cleanup
name|void
name|tst_QTreeWidget
operator|::
name|cleanup
parameter_list|()
block|{ }
end_function
begin_function
DECL|function|operator <<
name|TreeItem
modifier|*
name|operator
name|<<
parameter_list|(
name|TreeItem
modifier|*
name|parent
parameter_list|,
specifier|const
name|TreeItemList
modifier|&
name|children
parameter_list|)
block|{
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|children
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
name|parent
operator|->
name|addChild
argument_list|(
name|children
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|parent
return|;
block|}
end_function
begin_function
DECL|function|populate
specifier|static
name|void
name|populate
parameter_list|(
name|QTreeWidget
modifier|*
name|widget
parameter_list|,
specifier|const
name|TreeItemList
modifier|&
name|topLevelItems
parameter_list|,
name|TreeItem
modifier|*
name|headerItem
init|=
literal|0
parameter_list|)
block|{
name|widget
operator|->
name|clear
argument_list|()
expr_stmt|;
name|widget
operator|->
name|setHeaderItem
argument_list|(
name|headerItem
argument_list|)
expr_stmt|;
foreach|foreach
control|(
name|TreeItem
modifier|*
name|item
decl|,
name|topLevelItems
control|)
name|widget
operator|->
name|addTopLevelItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|addTopLevelItem
name|void
name|tst_QTreeWidget
operator|::
name|addTopLevelItem
parameter_list|()
block|{
name|QTreeWidget
name|tree
decl_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|topLevelItemCount
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// try to add 0
name|tree
operator|.
name|addTopLevelItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|topLevelItemCount
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|indexOfTopLevelItem
argument_list|(
literal|0
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|// add one at a time
name|QList
argument_list|<
name|TreeItem
modifier|*
argument_list|>
name|tops
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
operator|++
name|i
control|)
block|{
name|TreeItem
modifier|*
name|ti
init|=
operator|new
name|TreeItem
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|indexOfTopLevelItem
argument_list|(
name|ti
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|tree
operator|.
name|addTopLevelItem
argument_list|(
name|ti
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|topLevelItemCount
argument_list|()
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|topLevelItem
argument_list|(
name|i
argument_list|)
argument_list|,
name|ti
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|topLevelItem
argument_list|(
operator|-
literal|1
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|TreeItem
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|indexOfTopLevelItem
argument_list|(
name|ti
argument_list|)
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|ti
operator|->
name|parent
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|TreeItem
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|tree
operator|.
name|addTopLevelItem
argument_list|(
name|ti
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|topLevelItemCount
argument_list|()
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
name|tops
operator|.
name|append
argument_list|(
name|ti
argument_list|)
expr_stmt|;
block|}
comment|// delete one at a time
while|while
condition|(
operator|!
name|tops
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|TreeItem
modifier|*
name|ti
init|=
name|tops
operator|.
name|takeFirst
argument_list|()
decl_stmt|;
operator|delete
name|ti
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|topLevelItemCount
argument_list|()
argument_list|,
name|tops
operator|.
name|count
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|tops
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|topLevelItem
argument_list|(
name|i
argument_list|)
argument_list|,
name|tops
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|// add none
block|{
name|int
name|count
init|=
name|tree
operator|.
name|topLevelItemCount
argument_list|()
decl_stmt|;
name|tree
operator|.
name|addTopLevelItems
argument_list|(
name|tops
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|topLevelItemCount
argument_list|()
argument_list|,
name|count
argument_list|)
expr_stmt|;
block|}
comment|// add many at a time
block|{
specifier|const
name|int
name|count
init|=
literal|10
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|100
condition|;
name|i
operator|+=
name|count
control|)
block|{
name|tops
operator|.
name|clear
argument_list|()
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|count
condition|;
operator|++
name|j
control|)
name|tops
operator|<<
operator|new
name|TreeItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
name|QString
argument_list|(
literal|"%0"
argument_list|)
operator|.
name|arg
argument_list|(
name|j
argument_list|)
argument_list|)
expr_stmt|;
name|tree
operator|.
name|addTopLevelItems
argument_list|(
name|tops
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|topLevelItemCount
argument_list|()
argument_list|,
name|count
operator|+
name|i
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|count
condition|;
operator|++
name|j
control|)
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|topLevelItem
argument_list|(
name|i
operator|+
name|j
argument_list|)
argument_list|,
name|tops
operator|.
name|at
argument_list|(
name|j
argument_list|)
argument_list|)
expr_stmt|;
name|tree
operator|.
name|addTopLevelItems
argument_list|(
name|tops
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|topLevelItemCount
argument_list|()
argument_list|,
name|count
operator|+
name|i
argument_list|)
expr_stmt|;
block|}
block|}
comment|// insert
block|{
name|tops
operator|.
name|clear
argument_list|()
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
operator|++
name|i
control|)
name|tops
operator|<<
operator|new
name|TreeItem
argument_list|()
expr_stmt|;
name|int
name|count
init|=
name|tree
operator|.
name|topLevelItemCount
argument_list|()
decl_stmt|;
name|tree
operator|.
name|insertTopLevelItems
argument_list|(
literal|100000
argument_list|,
name|tops
argument_list|)
expr_stmt|;
comment|// ### fixme
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|topLevelItemCount
argument_list|()
argument_list|,
name|count
operator|+
literal|10
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|currentItem_data
name|void
name|tst_QTreeWidget
operator|::
name|currentItem_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|TreeItemList
argument_list|>
argument_list|(
literal|"topLevelItems"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"only top-level items, 2 columns"
argument_list|)
operator|<<
operator|(
name|TreeItemList
argument_list|()
operator|<<
operator|new
name|TreeItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"b"
argument_list|)
operator|<<
operator|new
name|TreeItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
literal|"c"
operator|<<
literal|"d"
argument_list|)
operator|)
expr_stmt|;
name|TreeItemList
name|lst
decl_stmt|;
name|lst
operator|<<
operator|(
operator|new
name|TreeItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"b"
argument_list|)
operator|<<
operator|(
name|TreeItemList
argument_list|()
operator|<<
operator|new
name|TreeItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
literal|"c"
operator|<<
literal|"d"
argument_list|)
operator|<<
operator|new
name|TreeItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
literal|"c"
operator|<<
literal|"d"
argument_list|)
operator|)
operator|)
operator|<<
operator|(
operator|new
name|TreeItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
literal|"e"
operator|<<
literal|"f"
argument_list|)
operator|<<
operator|(
name|TreeItemList
argument_list|()
operator|<<
operator|new
name|TreeItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
literal|"g"
operator|<<
literal|"h"
argument_list|)
operator|<<
operator|new
name|TreeItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
literal|"g"
operator|<<
literal|"h"
argument_list|)
operator|)
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"hierarchy, 2 columns"
argument_list|)
operator|<<
name|lst
expr_stmt|;
block|}
end_function
begin_function
DECL|function|currentItem
name|void
name|tst_QTreeWidget
operator|::
name|currentItem
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|TreeItemList
argument_list|,
name|topLevelItems
argument_list|)
expr_stmt|;
name|QTreeWidget
name|tree
decl_stmt|;
name|tree
operator|.
name|show
argument_list|()
expr_stmt|;
name|populate
argument_list|(
operator|&
name|tree
argument_list|,
name|topLevelItems
argument_list|,
operator|new
name|TreeItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
literal|"1"
operator|<<
literal|"2"
argument_list|)
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|previous
init|=
literal|0
decl_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
literal|2
condition|;
operator|++
name|x
control|)
block|{
name|tree
operator|.
name|setSelectionBehavior
argument_list|(
name|x
condition|?
name|QAbstractItemView
operator|::
name|SelectItems
else|:
name|QAbstractItemView
operator|::
name|SelectRows
argument_list|)
expr_stmt|;
name|QSignalSpy
name|currentItemChangedSpy
argument_list|(
operator|&
name|tree
argument_list|,
name|SIGNAL
argument_list|(
name|currentItemChanged
argument_list|(
name|QTreeWidgetItem
operator|*
argument_list|,
name|QTreeWidgetItem
operator|*
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QSignalSpy
name|itemSelectionChangedSpy
argument_list|(
operator|&
name|tree
argument_list|,
name|SIGNAL
argument_list|(
name|itemSelectionChanged
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|QTreeWidgetItemIterator
name|it
argument_list|(
operator|&
name|tree
argument_list|)
decl_stmt|;
comment|// do all items
while|while
condition|(
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|(
operator|*
name|it
operator|++
operator|)
condition|)
block|{
name|tree
operator|.
name|setCurrentItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|currentItem
argument_list|()
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|currentItemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QVariantList
name|args
init|=
name|currentItemChangedSpy
operator|.
name|takeFirst
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|)
argument_list|,
name|previous
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemSelectionChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|itemSelectionChangedSpy
operator|.
name|clear
argument_list|()
expr_stmt|;
name|previous
operator|=
name|item
expr_stmt|;
comment|// do all columns
for|for
control|(
name|int
name|col
init|=
literal|0
init|;
name|col
operator|<
name|item
operator|->
name|columnCount
argument_list|()
condition|;
operator|++
name|col
control|)
block|{
name|tree
operator|.
name|setCurrentItem
argument_list|(
name|item
argument_list|,
name|col
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|currentItem
argument_list|()
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|currentColumn
argument_list|()
argument_list|,
name|col
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|currentItemChangedSpy
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
comment|// ### we get a currentItemChanged() when what really
comment|// changed was just currentColumn(). Should it be like this?
name|QCOMPARE
argument_list|(
name|currentItemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QVariantList
name|args
init|=
name|currentItemChangedSpy
operator|.
name|takeFirst
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
if|if
condition|(
name|tree
operator|.
name|selectionBehavior
argument_list|()
operator|==
name|QAbstractItemView
operator|::
name|SelectItems
condition|)
block|{
name|QCOMPARE
argument_list|(
name|itemSelectionChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|itemSelectionChangedSpy
operator|.
name|clear
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|QCOMPARE
argument_list|(
name|itemSelectionChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
block|}
comment|// can't set the headerItem to be the current item
name|tree
operator|.
name|setCurrentItem
argument_list|(
name|tree
operator|.
name|headerItem
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|currentItem
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|TreeItem
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|editItem_data
name|void
name|tst_QTreeWidget
operator|::
name|editItem_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|TreeItemList
argument_list|>
argument_list|(
literal|"topLevelItems"
argument_list|)
expr_stmt|;
block|{
name|TreeItemList
name|list
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
name|i
operator|++
control|)
block|{
name|TreeItem
modifier|*
name|item
init|=
operator|new
name|TreeItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
literal|"col1"
operator|<<
literal|"col2"
argument_list|)
decl_stmt|;
if|if
condition|(
operator|(
name|i
operator|&
literal|1
operator|)
operator|==
literal|0
condition|)
name|item
operator|->
name|setFlags
argument_list|(
name|item
operator|->
name|flags
argument_list|()
operator||
name|Qt
operator|::
name|ItemIsEditable
argument_list|)
expr_stmt|;
else|else
name|item
operator|->
name|setFlags
argument_list|(
name|item
operator|->
name|flags
argument_list|()
operator|&
operator|~
name|Qt
operator|::
name|ItemIsEditable
argument_list|)
expr_stmt|;
name|list
operator|<<
name|item
expr_stmt|;
block|}
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2 columns, only even items editable"
argument_list|)
operator|<<
name|list
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|editItem
name|void
name|tst_QTreeWidget
operator|::
name|editItem
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|TreeItemList
argument_list|,
name|topLevelItems
argument_list|)
expr_stmt|;
name|QTreeWidget
name|tree
decl_stmt|;
name|populate
argument_list|(
operator|&
name|tree
argument_list|,
name|topLevelItems
argument_list|,
operator|new
name|TreeItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
literal|"1"
operator|<<
literal|"2"
argument_list|)
argument_list|)
expr_stmt|;
name|tree
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|tree
argument_list|)
argument_list|)
expr_stmt|;
name|QSignalSpy
name|itemChangedSpy
argument_list|(
operator|&
name|tree
argument_list|,
name|SIGNAL
argument_list|(
name|itemChanged
argument_list|(
name|QTreeWidgetItem
operator|*
argument_list|,
name|int
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QTreeWidgetItemIterator
name|it
argument_list|(
operator|&
name|tree
argument_list|)
decl_stmt|;
while|while
condition|(
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|(
operator|*
name|it
operator|++
operator|)
condition|)
block|{
for|for
control|(
name|int
name|col
init|=
literal|0
init|;
name|col
operator|<
name|item
operator|->
name|columnCount
argument_list|()
condition|;
operator|++
name|col
control|)
block|{
if|if
condition|(
operator|!
operator|(
name|item
operator|->
name|flags
argument_list|()
operator|&
name|Qt
operator|::
name|ItemIsEditable
operator|)
condition|)
name|QTest
operator|::
name|ignoreMessage
argument_list|(
name|QtWarningMsg
argument_list|,
literal|"edit: editing failed"
argument_list|)
expr_stmt|;
name|tree
operator|.
name|editItem
argument_list|(
name|item
argument_list|,
name|col
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|instance
argument_list|()
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|instance
argument_list|()
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QLineEdit
modifier|*
name|editor
init|=
name|tree
operator|.
name|findChild
argument_list|<
name|QLineEdit
operator|*
argument_list|>
argument_list|()
decl_stmt|;
if|if
condition|(
name|editor
condition|)
block|{
name|QVERIFY
argument_list|(
name|item
operator|->
name|flags
argument_list|()
operator|&
name|Qt
operator|::
name|ItemIsEditable
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|editor
operator|->
name|selectedText
argument_list|()
argument_list|,
name|editor
operator|->
name|text
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
name|editor
argument_list|,
name|Qt
operator|::
name|Key_A
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
name|editor
argument_list|,
name|Qt
operator|::
name|Key_Enter
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|instance
argument_list|()
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QVariantList
name|args
init|=
name|itemChangedSpy
operator|.
name|takeFirst
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|)
argument_list|,
name|col
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|QVERIFY
argument_list|(
operator|!
operator|(
name|item
operator|->
name|flags
argument_list|()
operator|&
name|Qt
operator|::
name|ItemIsEditable
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
end_function
begin_function
DECL|function|takeItem_data
name|void
name|tst_QTreeWidget
operator|::
name|takeItem_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"index"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"topLevel"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"outOfBounds"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"First, topLevel"
argument_list|)
operator|<<
literal|0
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Last, topLevel"
argument_list|)
operator|<<
literal|2
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Middle, topLevel"
argument_list|)
operator|<<
literal|1
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Out of bounds, toplevel, (index: -1)"
argument_list|)
operator|<<
operator|-
literal|1
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Out of bounds, toplevel, (index: 3)"
argument_list|)
operator|<<
literal|3
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"First, child of topLevel"
argument_list|)
operator|<<
literal|0
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Last, child of topLevel"
argument_list|)
operator|<<
literal|2
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Middle, child of topLevel"
argument_list|)
operator|<<
literal|1
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Out of bounds, child of toplevel, (index: -1)"
argument_list|)
operator|<<
operator|-
literal|1
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Out of bounds, child of toplevel, (index: 3)"
argument_list|)
operator|<<
literal|3
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_function
DECL|function|takeItem
name|void
name|tst_QTreeWidget
operator|::
name|takeItem
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|index
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|topLevel
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|outOfBounds
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
operator|++
name|i
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|top
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|testWidget
argument_list|)
decl_stmt|;
name|top
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
name|QString
argument_list|(
literal|"top%1"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
literal|3
condition|;
operator|++
name|j
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|child
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|top
argument_list|)
decl_stmt|;
name|child
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
name|QString
argument_list|(
literal|"child%1"
argument_list|)
operator|.
name|arg
argument_list|(
name|j
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|topLevelItemCount
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|topLevelItem
argument_list|(
literal|0
argument_list|)
operator|->
name|childCount
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
if|if
condition|(
name|topLevel
condition|)
block|{
name|int
name|count
init|=
name|testWidget
operator|->
name|topLevelItemCount
argument_list|()
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|item
init|=
name|testWidget
operator|->
name|takeTopLevelItem
argument_list|(
name|index
argument_list|)
decl_stmt|;
if|if
condition|(
name|outOfBounds
condition|)
block|{
name|QCOMPARE
argument_list|(
name|item
argument_list|,
operator|(
name|QTreeWidgetItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|count
argument_list|,
name|testWidget
operator|->
name|topLevelItemCount
argument_list|()
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|QCOMPARE
argument_list|(
name|item
operator|->
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QString
argument_list|(
literal|"top%1"
argument_list|)
operator|.
name|arg
argument_list|(
name|index
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|count
operator|-
literal|1
argument_list|,
name|testWidget
operator|->
name|topLevelItemCount
argument_list|()
argument_list|)
expr_stmt|;
operator|delete
name|item
expr_stmt|;
block|}
block|}
else|else
block|{
name|int
name|count
init|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
literal|0
argument_list|)
operator|->
name|childCount
argument_list|()
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|item
init|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
literal|0
argument_list|)
operator|->
name|takeChild
argument_list|(
name|index
argument_list|)
decl_stmt|;
if|if
condition|(
name|outOfBounds
condition|)
block|{
name|QCOMPARE
argument_list|(
name|item
argument_list|,
operator|(
name|QTreeWidgetItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|count
argument_list|,
name|testWidget
operator|->
name|topLevelItem
argument_list|(
literal|0
argument_list|)
operator|->
name|childCount
argument_list|()
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|QCOMPARE
argument_list|(
name|item
operator|->
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QString
argument_list|(
literal|"child%1"
argument_list|)
operator|.
name|arg
argument_list|(
name|index
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|count
operator|-
literal|1
argument_list|,
name|testWidget
operator|->
name|topLevelItem
argument_list|(
literal|0
argument_list|)
operator|->
name|childCount
argument_list|()
argument_list|)
expr_stmt|;
operator|delete
name|item
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function
DECL|function|removeChild_data
name|void
name|tst_QTreeWidget
operator|::
name|removeChild_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"childCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"removeAt"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"10 remove 3"
argument_list|)
operator|<<
literal|10
operator|<<
literal|3
expr_stmt|;
block|}
end_function
begin_function
DECL|function|removeChild
name|void
name|tst_QTreeWidget
operator|::
name|removeChild
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|childCount
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|removeAt
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|root
init|=
operator|new
name|QTreeWidgetItem
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|childCount
condition|;
operator|++
name|i
control|)
operator|new
name|QTreeWidgetItem
argument_list|(
name|root
argument_list|,
name|QStringList
argument_list|(
name|QString
operator|::
name|number
argument_list|(
name|i
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|root
operator|->
name|childCount
argument_list|()
argument_list|,
name|childCount
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|childCount
condition|;
operator|++
name|j
control|)
name|QCOMPARE
argument_list|(
name|root
operator|->
name|child
argument_list|(
name|j
argument_list|)
operator|->
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QString
operator|::
name|number
argument_list|(
name|j
argument_list|)
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|remove
init|=
name|root
operator|->
name|child
argument_list|(
name|removeAt
argument_list|)
decl_stmt|;
name|root
operator|->
name|removeChild
argument_list|(
name|remove
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|root
operator|->
name|childCount
argument_list|()
argument_list|,
name|childCount
operator|-
literal|1
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|k
init|=
literal|0
init|;
name|k
operator|<
name|childCount
condition|;
operator|++
name|k
control|)
block|{
if|if
condition|(
name|k
operator|==
name|removeAt
condition|)
name|QCOMPARE
argument_list|(
name|remove
operator|->
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QString
operator|::
name|number
argument_list|(
name|k
argument_list|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|k
operator|<
name|removeAt
condition|)
name|QCOMPARE
argument_list|(
name|root
operator|->
name|child
argument_list|(
name|k
argument_list|)
operator|->
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QString
operator|::
name|number
argument_list|(
name|k
argument_list|)
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|k
operator|>
name|removeAt
condition|)
name|QCOMPARE
argument_list|(
name|root
operator|->
name|child
argument_list|(
name|k
operator|-
literal|1
argument_list|)
operator|->
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QString
operator|::
name|number
argument_list|(
name|k
argument_list|)
argument_list|)
expr_stmt|;
block|}
operator|delete
name|root
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setItemHidden
name|void
name|tst_QTreeWidget
operator|::
name|setItemHidden
parameter_list|()
block|{
name|QTreeWidgetItem
modifier|*
name|parent
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|testWidget
argument_list|)
decl_stmt|;
name|parent
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"parent"
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|child
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|parent
argument_list|)
decl_stmt|;
name|child
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"child"
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|parent
argument_list|()
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|expandItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|scrollToItem
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|testWidget
operator|->
name|visualItemRect
argument_list|(
name|parent
argument_list|)
operator|.
name|isValid
argument_list|()
operator|&&
name|testWidget
operator|->
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|intersects
argument_list|(
name|testWidget
operator|->
name|visualItemRect
argument_list|(
name|parent
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|testWidget
operator|->
name|visualItemRect
argument_list|(
name|child
argument_list|)
operator|.
name|isValid
argument_list|()
operator|&&
name|testWidget
operator|->
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|intersects
argument_list|(
name|testWidget
operator|->
name|visualItemRect
argument_list|(
name|child
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|testWidget
operator|->
name|isItemHidden
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|testWidget
operator|->
name|isItemHidden
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setItemHidden
argument_list|(
name|parent
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
operator|(
name|testWidget
operator|->
name|visualItemRect
argument_list|(
name|parent
argument_list|)
operator|.
name|isValid
argument_list|()
operator|&&
name|testWidget
operator|->
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|intersects
argument_list|(
name|testWidget
operator|->
name|visualItemRect
argument_list|(
name|parent
argument_list|)
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
operator|(
name|testWidget
operator|->
name|visualItemRect
argument_list|(
name|child
argument_list|)
operator|.
name|isValid
argument_list|()
operator|&&
name|testWidget
operator|->
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|intersects
argument_list|(
name|testWidget
operator|->
name|visualItemRect
argument_list|(
name|child
argument_list|)
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|testWidget
operator|->
name|isItemHidden
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|testWidget
operator|->
name|isItemHidden
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
comment|// From task 78670 (This caused an core dump)
comment|// Check if we can set an item visible if it already is visible.
name|testWidget
operator|->
name|setItemHidden
argument_list|(
name|parent
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setItemHidden
argument_list|(
name|parent
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|testWidget
operator|->
name|isItemHidden
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
comment|// hide, hide and then unhide.
name|testWidget
operator|->
name|setItemHidden
argument_list|(
name|parent
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setItemHidden
argument_list|(
name|parent
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setItemHidden
argument_list|(
name|parent
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|testWidget
operator|->
name|isItemHidden
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setItemHidden2
name|void
name|tst_QTreeWidget
operator|::
name|setItemHidden2
parameter_list|()
block|{
comment|// From Task 78587
name|QStringList
name|hl
decl_stmt|;
name|hl
operator|<<
literal|"ID"
operator|<<
literal|"Desc"
expr_stmt|;
name|testWidget
operator|->
name|setColumnCount
argument_list|(
name|hl
operator|.
name|count
argument_list|()
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setHeaderLabels
argument_list|(
name|hl
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|top
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|testWidget
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|leaf
init|=
literal|0
decl_stmt|;
name|top
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"ItemList"
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|1
init|;
name|i
operator|<=
literal|4
condition|;
name|i
operator|++
control|)
block|{
name|leaf
operator|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|top
argument_list|)
expr_stmt|;
name|leaf
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
name|QString
argument_list|()
operator|.
name|sprintf
argument_list|(
literal|"%d"
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|leaf
operator|->
name|setText
argument_list|(
literal|1
argument_list|,
name|QString
argument_list|()
operator|.
name|sprintf
argument_list|(
literal|"Item %d"
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|testWidget
operator|->
name|topLevelItemCount
argument_list|()
operator|>
literal|0
condition|)
block|{
name|top
operator|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setItemExpanded
argument_list|(
name|top
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|testWidget
operator|->
name|topLevelItemCount
argument_list|()
operator|>
literal|0
condition|)
block|{
name|top
operator|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|top
operator|->
name|childCount
argument_list|()
condition|;
name|i
operator|++
control|)
block|{
name|leaf
operator|=
name|top
operator|->
name|child
argument_list|(
name|i
argument_list|)
expr_stmt|;
if|if
condition|(
name|leaf
operator|->
name|text
argument_list|(
literal|0
argument_list|)
operator|.
name|toInt
argument_list|()
operator|%
literal|2
operator|==
literal|0
condition|)
block|{
if|if
condition|(
operator|!
name|testWidget
operator|->
name|isItemHidden
argument_list|(
name|leaf
argument_list|)
condition|)
block|{
name|testWidget
operator|->
name|setItemHidden
argument_list|(
name|leaf
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
block|}
end_function
begin_function
DECL|function|selectedItems_data
name|void
name|tst_QTreeWidget
operator|::
name|selectedItems_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"topLevel"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"children"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"closeTopLevel"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|ListIntList
argument_list|>
argument_list|(
literal|"selectedItems"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|ListIntList
argument_list|>
argument_list|(
literal|"hiddenItems"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|ListIntList
argument_list|>
argument_list|(
literal|"expectedItems"
argument_list|)
expr_stmt|;
name|ListIntList
name|selectedItems
decl_stmt|;
name|ListIntList
name|hiddenItems
decl_stmt|;
name|ListIntList
name|expectedItems
decl_stmt|;
name|selectedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|hiddenItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|expectedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|selectedItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|)
expr_stmt|;
name|expectedItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2 top with 2 children, closed, top0 selected, no hidden"
argument_list|)
operator|<<
literal|2
operator|<<
literal|2
operator|<<
literal|true
operator|<<
name|selectedItems
operator|<<
name|hiddenItems
operator|<<
name|expectedItems
expr_stmt|;
name|selectedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|hiddenItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|expectedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|selectedItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|0
operator|)
expr_stmt|;
name|expectedItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|0
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2 top with 2 children, closed, top0child0 selected, no hidden"
argument_list|)
operator|<<
literal|2
operator|<<
literal|2
operator|<<
literal|true
operator|<<
name|selectedItems
operator|<<
name|hiddenItems
operator|<<
name|expectedItems
expr_stmt|;
name|selectedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|hiddenItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|expectedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|selectedItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|0
operator|)
expr_stmt|;
name|expectedItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|0
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2 top with 2 children, open, top0child0 selected, no hidden"
argument_list|)
operator|<<
literal|2
operator|<<
literal|2
operator|<<
literal|false
operator|<<
name|selectedItems
operator|<<
name|hiddenItems
operator|<<
name|expectedItems
expr_stmt|;
name|selectedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|hiddenItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|expectedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|selectedItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|)
expr_stmt|;
name|hiddenItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2 top with 2 children, closed, top0 selected, top0 hidden"
argument_list|)
operator|<<
literal|2
operator|<<
literal|2
operator|<<
literal|true
operator|<<
name|selectedItems
operator|<<
name|hiddenItems
operator|<<
name|expectedItems
expr_stmt|;
name|selectedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|hiddenItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|expectedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|selectedItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|0
operator|)
expr_stmt|;
name|hiddenItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|)
expr_stmt|;
name|expectedItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|0
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2 top with 2 children, closed, top0child0 selected, top0 hidden"
argument_list|)
operator|<<
literal|2
operator|<<
literal|2
operator|<<
literal|true
operator|<<
name|selectedItems
operator|<<
name|hiddenItems
operator|<<
name|expectedItems
expr_stmt|;
name|selectedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|hiddenItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|expectedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|selectedItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|0
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|<<
literal|0
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|<<
literal|1
operator|)
expr_stmt|;
name|expectedItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|0
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|<<
literal|0
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|<<
literal|1
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2 top with 2 children, closed, all selected, no hidden"
argument_list|)
operator|<<
literal|2
operator|<<
literal|2
operator|<<
literal|true
operator|<<
name|selectedItems
operator|<<
name|hiddenItems
operator|<<
name|expectedItems
expr_stmt|;
name|selectedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|hiddenItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|expectedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|selectedItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|0
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|<<
literal|0
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|<<
literal|1
operator|)
expr_stmt|;
name|hiddenItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|)
expr_stmt|;
name|expectedItems
comment|//<< (IntList()<< 0)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|0
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|<<
literal|0
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|<<
literal|1
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2 top with 2 children, closed, all selected, top0 hidden"
argument_list|)
operator|<<
literal|2
operator|<<
literal|2
operator|<<
literal|true
operator|<<
name|selectedItems
operator|<<
name|hiddenItems
operator|<<
name|expectedItems
expr_stmt|;
name|selectedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|hiddenItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|expectedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|selectedItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|0
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|<<
literal|0
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|<<
literal|1
operator|)
expr_stmt|;
name|hiddenItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|)
expr_stmt|;
name|expectedItems
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|0
operator|)
comment|//<< (IntList()<< 0<< 1)
comment|//<< (IntList()<< 1)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|<<
literal|0
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|<<
literal|1
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2 top with 2 children, closed, all selected, top0child1 and top1"
argument_list|)
operator|<<
literal|2
operator|<<
literal|2
operator|<<
literal|true
operator|<<
name|selectedItems
operator|<<
name|hiddenItems
operator|<<
name|expectedItems
expr_stmt|;
block|}
end_function
begin_function
DECL|function|selectedItems
name|void
name|tst_QTreeWidget
operator|::
name|selectedItems
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|topLevel
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|children
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|closeTopLevel
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|ListIntList
argument_list|,
name|selectedItems
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|ListIntList
argument_list|,
name|hiddenItems
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|ListIntList
argument_list|,
name|expectedItems
argument_list|)
expr_stmt|;
comment|// create items
for|for
control|(
name|int
name|t
init|=
literal|0
init|;
name|t
operator|<
name|topLevel
condition|;
operator|++
name|t
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|top
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|testWidget
argument_list|)
decl_stmt|;
name|top
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
name|QString
argument_list|(
literal|"top%1"
argument_list|)
operator|.
name|arg
argument_list|(
name|t
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|c
init|=
literal|0
init|;
name|c
operator|<
name|children
condition|;
operator|++
name|c
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|child
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|top
argument_list|)
decl_stmt|;
name|child
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
name|QString
argument_list|(
literal|"top%1child%2"
argument_list|)
operator|.
name|arg
argument_list|(
name|t
argument_list|)
operator|.
name|arg
argument_list|(
name|c
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|// set selected
foreach|foreach
control|(
name|IntList
name|itemPath
decl|,
name|selectedItems
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|item
init|=
literal|0
decl_stmt|;
foreach|foreach
control|(
name|int
name|index
decl|,
name|itemPath
control|)
block|{
if|if
condition|(
operator|!
name|item
condition|)
name|item
operator|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
name|index
argument_list|)
expr_stmt|;
else|else
name|item
operator|=
name|item
operator|->
name|child
argument_list|(
name|index
argument_list|)
expr_stmt|;
block|}
name|testWidget
operator|->
name|setItemSelected
argument_list|(
name|item
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
comment|// hide rows
foreach|foreach
control|(
name|IntList
name|itemPath
decl|,
name|hiddenItems
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|item
init|=
literal|0
decl_stmt|;
foreach|foreach
control|(
name|int
name|index
decl|,
name|itemPath
control|)
block|{
if|if
condition|(
operator|!
name|item
condition|)
name|item
operator|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
name|index
argument_list|)
expr_stmt|;
else|else
name|item
operator|=
name|item
operator|->
name|child
argument_list|(
name|index
argument_list|)
expr_stmt|;
block|}
name|testWidget
operator|->
name|setItemHidden
argument_list|(
name|item
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
comment|// open/close toplevel
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|testWidget
operator|->
name|topLevelItemCount
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
if|if
condition|(
name|closeTopLevel
condition|)
name|testWidget
operator|->
name|collapseItem
argument_list|(
name|testWidget
operator|->
name|topLevelItem
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|testWidget
operator|->
name|expandItem
argument_list|(
name|testWidget
operator|->
name|topLevelItem
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|// check selectedItems
name|QList
argument_list|<
name|QTreeWidgetItem
modifier|*
argument_list|>
name|sel
init|=
name|testWidget
operator|->
name|selectedItems
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|sel
operator|.
name|count
argument_list|()
argument_list|,
name|expectedItems
operator|.
name|count
argument_list|()
argument_list|)
expr_stmt|;
foreach|foreach
control|(
name|IntList
name|itemPath
decl|,
name|expectedItems
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|item
init|=
literal|0
decl_stmt|;
foreach|foreach
control|(
name|int
name|index
decl|,
name|itemPath
control|)
block|{
if|if
condition|(
operator|!
name|item
condition|)
name|item
operator|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
name|index
argument_list|)
expr_stmt|;
else|else
name|item
operator|=
name|item
operator|->
name|child
argument_list|(
name|index
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|item
condition|)
name|QVERIFY
argument_list|(
name|sel
operator|.
name|contains
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|// compare isSelected
for|for
control|(
name|int
name|t
init|=
literal|0
init|;
name|t
operator|<
name|testWidget
operator|->
name|topLevelItemCount
argument_list|()
condition|;
operator|++
name|t
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|top
init|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
name|t
argument_list|)
decl_stmt|;
if|if
condition|(
name|testWidget
operator|->
name|isItemSelected
argument_list|(
name|top
argument_list|)
operator|&&
operator|!
name|testWidget
operator|->
name|isItemHidden
argument_list|(
name|top
argument_list|)
condition|)
name|QVERIFY
argument_list|(
name|sel
operator|.
name|contains
argument_list|(
name|top
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|c
init|=
literal|0
init|;
name|c
operator|<
name|top
operator|->
name|childCount
argument_list|()
condition|;
operator|++
name|c
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|child
init|=
name|top
operator|->
name|child
argument_list|(
name|c
argument_list|)
decl_stmt|;
if|if
condition|(
name|testWidget
operator|->
name|isItemSelected
argument_list|(
name|child
argument_list|)
operator|&&
operator|!
name|testWidget
operator|->
name|isItemHidden
argument_list|(
name|child
argument_list|)
condition|)
name|QVERIFY
argument_list|(
name|sel
operator|.
name|contains
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
comment|// Possible to select null without crashing?
name|testWidget
operator|->
name|setItemSelected
argument_list|(
literal|0
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|testWidget
operator|->
name|isItemSelected
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
comment|// unselect
foreach|foreach
control|(
name|IntList
name|itemPath
decl|,
name|selectedItems
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|item
init|=
literal|0
decl_stmt|;
foreach|foreach
control|(
name|int
name|index
decl|,
name|itemPath
control|)
block|{
if|if
condition|(
operator|!
name|item
condition|)
name|item
operator|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
name|index
argument_list|)
expr_stmt|;
else|else
name|item
operator|=
name|item
operator|->
name|child
argument_list|(
name|index
argument_list|)
expr_stmt|;
block|}
name|testWidget
operator|->
name|setItemSelected
argument_list|(
name|item
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|selectedItems
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemAssignment
name|void
name|tst_QTreeWidget
operator|::
name|itemAssignment
parameter_list|()
block|{
comment|// create item with children and parent but not insert in the view
name|QTreeWidgetItem
name|grandParent
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|parent
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|grandParent
argument_list|)
decl_stmt|;
name|parent
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"foo"
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setText
argument_list|(
literal|1
argument_list|,
literal|"bar"
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
operator|++
name|i
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|child
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|parent
argument_list|)
decl_stmt|;
name|child
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"bingo"
argument_list|)
expr_stmt|;
name|child
operator|->
name|setText
argument_list|(
literal|1
argument_list|,
literal|"bango"
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|parent
argument_list|()
argument_list|,
operator|&
name|grandParent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|treeWidget
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|columnCount
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QString
argument_list|(
literal|"foo"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|childCount
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|child
argument_list|(
literal|0
argument_list|)
operator|->
name|parent
argument_list|()
argument_list|,
name|parent
argument_list|)
expr_stmt|;
comment|// create item which is inserted in the widget
name|QTreeWidgetItem
name|item
argument_list|(
name|testWidget
argument_list|)
decl_stmt|;
name|item
operator|.
name|setText
argument_list|(
literal|0
argument_list|,
literal|"baz"
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|.
name|parent
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|treeWidget
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QTreeWidget
operator|*
argument_list|>
argument_list|(
name|testWidget
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|columnCount
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QString
argument_list|(
literal|"baz"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|childCount
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// assign and test
operator|*
name|parent
operator|=
name|item
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|parent
argument_list|()
argument_list|,
operator|&
name|grandParent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|treeWidget
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|columnCount
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QString
argument_list|(
literal|"baz"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|childCount
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|child
argument_list|(
literal|0
argument_list|)
operator|->
name|parent
argument_list|()
argument_list|,
name|parent
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|clone_data
name|void
name|tst_QTreeWidget
operator|::
name|clone_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"column"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"topLevelIndex"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"childIndex"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"topLevelText"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"childText"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"cloneChild"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"clone parent with child"
argument_list|)
operator|<<
literal|0
operator|<<
literal|0
operator|<<
literal|0
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"some text"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"more text"
operator|)
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"clone child"
argument_list|)
operator|<<
literal|0
operator|<<
literal|0
operator|<<
literal|0
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"some text"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"more text"
operator|)
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_function
DECL|function|clone
name|void
name|tst_QTreeWidget
operator|::
name|clone
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|column
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|topLevelIndex
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|childIndex
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|topLevelText
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|childText
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|cloneChild
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|topLevelText
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|testWidget
argument_list|)
decl_stmt|;
name|item
operator|->
name|setText
argument_list|(
name|column
argument_list|,
name|topLevelText
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|childText
operator|.
name|count
argument_list|()
condition|;
operator|++
name|j
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|child
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|item
argument_list|)
decl_stmt|;
name|child
operator|->
name|setText
argument_list|(
name|column
argument_list|,
name|childText
operator|.
name|at
argument_list|(
name|j
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|QTreeWidgetItem
modifier|*
name|original
init|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
name|topLevelIndex
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|copy
init|=
name|original
operator|->
name|clone
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|copy
operator|->
name|text
argument_list|(
name|column
argument_list|)
argument_list|,
name|original
operator|->
name|text
argument_list|(
name|column
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|copy
operator|->
name|childCount
argument_list|()
argument_list|,
name|original
operator|->
name|childCount
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|copy
operator|->
name|parent
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|copy
operator|->
name|treeWidget
argument_list|()
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|originalChild
init|=
name|original
operator|->
name|child
argument_list|(
name|childIndex
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|copiedChild
init|=
name|cloneChild
condition|?
name|originalChild
operator|->
name|clone
argument_list|()
else|:
name|copy
operator|->
name|child
argument_list|(
name|childIndex
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|copiedChild
operator|!=
name|originalChild
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|copiedChild
operator|->
name|text
argument_list|(
name|column
argument_list|)
argument_list|,
name|originalChild
operator|->
name|text
argument_list|(
name|column
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|copiedChild
operator|->
name|childCount
argument_list|()
argument_list|,
name|originalChild
operator|->
name|childCount
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|copiedChild
operator|->
name|parent
argument_list|()
argument_list|,
name|cloneChild
condition|?
literal|0
else|:
name|copy
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|copiedChild
operator|->
name|treeWidget
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|cloneChild
condition|)
operator|delete
name|copiedChild
expr_stmt|;
operator|delete
name|copy
expr_stmt|;
block|}
end_function
begin_function
DECL|function|expand_data
name|void
name|tst_QTreeWidget
operator|::
name|expand_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"topLevelIndex"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"topLevelCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"childIndex"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"childCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"the only test data for now"
argument_list|)
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|0
operator|<<
literal|1
expr_stmt|;
block|}
end_function
begin_function
DECL|function|expand
name|void
name|tst_QTreeWidget
operator|::
name|expand
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|topLevelIndex
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|topLevelCount
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|childIndex
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|childCount
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|topLevelCount
condition|;
operator|++
name|i
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|testWidget
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|childCount
condition|;
operator|++
name|j
control|)
operator|new
name|QTreeWidgetItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
block|}
name|QTreeWidgetItem
modifier|*
name|topLevelItem
init|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
name|topLevelIndex
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|childItem
init|=
name|topLevelItem
operator|->
name|child
argument_list|(
name|childIndex
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|testWidget
operator|->
name|isItemExpanded
argument_list|(
name|topLevelItem
argument_list|)
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setItemExpanded
argument_list|(
name|topLevelItem
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|testWidget
operator|->
name|isItemExpanded
argument_list|(
name|topLevelItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|testWidget
operator|->
name|isItemExpanded
argument_list|(
name|childItem
argument_list|)
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setItemExpanded
argument_list|(
name|childItem
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|testWidget
operator|->
name|isItemExpanded
argument_list|(
name|childItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|testWidget
operator|->
name|isItemExpanded
argument_list|(
name|topLevelItem
argument_list|)
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setItemExpanded
argument_list|(
name|topLevelItem
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|testWidget
operator|->
name|isItemExpanded
argument_list|(
name|topLevelItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|testWidget
operator|->
name|isItemExpanded
argument_list|(
name|childItem
argument_list|)
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setItemExpanded
argument_list|(
name|childItem
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|testWidget
operator|->
name|isItemExpanded
argument_list|(
name|childItem
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|checkState_data
name|void
name|tst_QTreeWidget
operator|::
name|checkState_data
parameter_list|()
block|{ }
end_function
begin_function
DECL|function|checkState
name|void
name|tst_QTreeWidget
operator|::
name|checkState
parameter_list|()
block|{
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|testWidget
argument_list|)
decl_stmt|;
name|item
operator|->
name|setCheckState
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|firstChild
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|item
argument_list|)
decl_stmt|;
name|firstChild
operator|->
name|setCheckState
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|seccondChild
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|item
argument_list|)
decl_stmt|;
name|seccondChild
operator|->
name|setCheckState
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|checkState
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|firstChild
operator|->
name|checkState
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|seccondChild
operator|->
name|checkState
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
name|firstChild
operator|->
name|setCheckState
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Checked
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|checkState
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|firstChild
operator|->
name|checkState
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Checked
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|seccondChild
operator|->
name|checkState
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlags
argument_list|(
name|item
operator|->
name|flags
argument_list|()
operator||
name|Qt
operator|::
name|ItemIsTristate
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|checkState
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|PartiallyChecked
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|firstChild
operator|->
name|checkState
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Checked
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|seccondChild
operator|->
name|checkState
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
name|seccondChild
operator|->
name|setCheckState
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Checked
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|checkState
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Checked
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|firstChild
operator|->
name|checkState
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Checked
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|seccondChild
operator|->
name|checkState
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Checked
argument_list|)
expr_stmt|;
name|firstChild
operator|->
name|setCheckState
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
name|seccondChild
operator|->
name|setCheckState
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|checkState
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|firstChild
operator|->
name|checkState
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|seccondChild
operator|->
name|checkState
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|findItems_data
name|void
name|tst_QTreeWidget
operator|::
name|findItems_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"column"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"topLevelText"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"childText"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QString
argument_list|>
argument_list|(
literal|"pattern"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"resultCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"resultText"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"find in toplevel"
argument_list|)
operator|<<
literal|0
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"This is a text"
operator|<<
literal|"This is another"
operator|<<
literal|"This is the one"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"A child"
operator|<<
literal|"This is not the one"
operator|<<
literal|"And yet another child"
operator|)
operator|<<
literal|"This is the one"
operator|<<
literal|1
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"This is the one"
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"find child"
argument_list|)
operator|<<
literal|0
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"This is a text"
operator|<<
literal|"This is another"
operator|<<
literal|"This is the one"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"A child"
operator|<<
literal|"This is not the one"
operator|<<
literal|"And yet another child"
operator|)
operator|<<
literal|"A child"
operator|<<
literal|3
comment|// once for each branch
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"A child"
operator|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|findItems
name|void
name|tst_QTreeWidget
operator|::
name|findItems
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|column
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|topLevelText
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|childText
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QString
argument_list|,
name|pattern
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|resultCount
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|resultText
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|topLevelText
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|testWidget
argument_list|)
decl_stmt|;
name|item
operator|->
name|setText
argument_list|(
name|column
argument_list|,
name|topLevelText
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|childText
operator|.
name|count
argument_list|()
condition|;
operator|++
name|j
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|child
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|item
argument_list|)
decl_stmt|;
name|child
operator|->
name|setText
argument_list|(
name|column
argument_list|,
name|childText
operator|.
name|at
argument_list|(
name|j
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|QList
argument_list|<
name|QTreeWidgetItem
modifier|*
argument_list|>
name|result
init|=
name|testWidget
operator|->
name|findItems
argument_list|(
name|pattern
argument_list|,
name|Qt
operator|::
name|MatchExactly
operator||
name|Qt
operator|::
name|MatchRecursive
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|result
operator|.
name|count
argument_list|()
argument_list|,
name|resultCount
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|k
init|=
literal|0
init|;
name|k
operator|<
name|result
operator|.
name|count
argument_list|()
operator|&&
name|k
operator|<
name|resultText
operator|.
name|count
argument_list|()
condition|;
operator|++
name|k
control|)
name|QCOMPARE
argument_list|(
name|result
operator|.
name|at
argument_list|(
name|k
argument_list|)
operator|->
name|text
argument_list|(
name|column
argument_list|)
argument_list|,
name|resultText
operator|.
name|at
argument_list|(
name|k
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|findItemsInColumn
name|void
name|tst_QTreeWidget
operator|::
name|findItemsInColumn
parameter_list|()
block|{
comment|// Create 5 root items.
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
operator|new
name|QTreeWidgetItem
argument_list|(
name|testWidget
argument_list|,
name|QStringList
argument_list|()
operator|<<
name|QString
operator|::
name|number
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
comment|// Create a child with two columns for each root item.
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
name|i
operator|++
control|)
block|{
name|QTreeWidgetItem
modifier|*
specifier|const
name|parent
init|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
name|i
argument_list|)
decl_stmt|;
operator|new
name|QTreeWidgetItem
argument_list|(
name|parent
argument_list|,
name|QStringList
argument_list|()
operator|<<
name|QString
operator|::
name|number
argument_list|(
name|i
operator|*
literal|10
argument_list|)
operator|<<
name|QString
operator|::
name|number
argument_list|(
name|i
operator|*
literal|100
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|// Recursively search column one for 400.
name|QList
argument_list|<
name|QTreeWidgetItem
modifier|*
argument_list|>
name|items
init|=
name|testWidget
operator|->
name|findItems
argument_list|(
literal|"400"
argument_list|,
name|Qt
operator|::
name|MatchExactly
operator||
name|Qt
operator|::
name|MatchRecursive
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sortItems_data
name|void
name|tst_QTreeWidget
operator|::
name|sortItems_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"column"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"order"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"topLevelText"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"childText"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"topLevelResult"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"childResult"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|IntList
argument_list|>
argument_list|(
literal|"expectedTopRows"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|IntList
argument_list|>
argument_list|(
literal|"expectedChildRows"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"ascending order"
argument_list|)
operator|<<
literal|0
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"c"
operator|<<
literal|"d"
operator|<<
literal|"a"
operator|<<
literal|"b"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"e"
operator|<<
literal|"h"
operator|<<
literal|"g"
operator|<<
literal|"f"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"b"
operator|<<
literal|"c"
operator|<<
literal|"d"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"e"
operator|<<
literal|"f"
operator|<<
literal|"g"
operator|<<
literal|"h"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|2
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|1
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|3
operator|<<
literal|2
operator|<<
literal|1
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"descending order"
argument_list|)
operator|<<
literal|0
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|DescendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"c"
operator|<<
literal|"d"
operator|<<
literal|"a"
operator|<<
literal|"b"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"e"
operator|<<
literal|"h"
operator|<<
literal|"g"
operator|<<
literal|"f"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"d"
operator|<<
literal|"c"
operator|<<
literal|"b"
operator|<<
literal|"a"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"h"
operator|<<
literal|"g"
operator|<<
literal|"f"
operator|<<
literal|"e"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|<<
literal|0
operator|<<
literal|3
operator|<<
literal|2
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|2
operator|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sortItems
name|void
name|tst_QTreeWidget
operator|::
name|sortItems
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|column
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|order
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|topLevelText
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|childText
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|topLevelResult
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|childResult
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|IntList
argument_list|,
name|expectedTopRows
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|IntList
argument_list|,
name|expectedChildRows
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setSortingEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|topLevelText
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|testWidget
argument_list|)
decl_stmt|;
name|item
operator|->
name|setText
argument_list|(
name|column
argument_list|,
name|topLevelText
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|childText
operator|.
name|count
argument_list|()
condition|;
operator|++
name|j
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|child
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|item
argument_list|)
decl_stmt|;
name|child
operator|->
name|setText
argument_list|(
name|column
argument_list|,
name|childText
operator|.
name|at
argument_list|(
name|j
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|QAbstractItemModel
modifier|*
name|model
init|=
name|testWidget
operator|->
name|model
argument_list|()
decl_stmt|;
name|QList
argument_list|<
name|QPersistentModelIndex
argument_list|>
name|tops
decl_stmt|;
for|for
control|(
name|int
name|r
init|=
literal|0
init|;
name|r
operator|<
name|model
operator|->
name|rowCount
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
condition|;
operator|++
name|r
control|)
block|{
name|QPersistentModelIndex
name|p
init|=
name|model
operator|->
name|index
argument_list|(
name|r
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
decl_stmt|;
name|tops
operator|<<
name|p
expr_stmt|;
block|}
name|QList
argument_list|<
name|QPersistentModelIndex
argument_list|>
name|children
decl_stmt|;
for|for
control|(
name|int
name|s
init|=
literal|0
init|;
name|s
operator|<
name|model
operator|->
name|rowCount
argument_list|(
name|tops
operator|.
name|first
argument_list|()
argument_list|)
condition|;
operator|++
name|s
control|)
block|{
name|QPersistentModelIndex
name|c
init|=
name|model
operator|->
name|index
argument_list|(
name|s
argument_list|,
literal|0
argument_list|,
name|tops
operator|.
name|first
argument_list|()
argument_list|)
decl_stmt|;
name|children
operator|<<
name|c
expr_stmt|;
block|}
name|testWidget
operator|->
name|sortItems
argument_list|(
name|column
argument_list|,
cast|static_cast
argument_list|<
name|Qt
operator|::
name|SortOrder
argument_list|>
argument_list|(
name|order
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|sortColumn
argument_list|()
argument_list|,
name|column
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|k
init|=
literal|0
init|;
name|k
operator|<
name|topLevelResult
operator|.
name|count
argument_list|()
condition|;
operator|++
name|k
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|item
init|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
name|k
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|text
argument_list|(
name|column
argument_list|)
argument_list|,
name|topLevelResult
operator|.
name|at
argument_list|(
name|k
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|l
init|=
literal|0
init|;
name|l
operator|<
name|childResult
operator|.
name|count
argument_list|()
condition|;
operator|++
name|l
control|)
name|QCOMPARE
argument_list|(
name|item
operator|->
name|child
argument_list|(
name|l
argument_list|)
operator|->
name|text
argument_list|(
name|column
argument_list|)
argument_list|,
name|childResult
operator|.
name|at
argument_list|(
name|l
argument_list|)
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|int
name|m
init|=
literal|0
init|;
name|m
operator|<
name|tops
operator|.
name|count
argument_list|()
condition|;
operator|++
name|m
control|)
name|QCOMPARE
argument_list|(
name|tops
operator|.
name|at
argument_list|(
name|m
argument_list|)
operator|.
name|row
argument_list|()
argument_list|,
name|expectedTopRows
operator|.
name|at
argument_list|(
name|m
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|n
init|=
literal|0
init|;
name|n
operator|<
name|children
operator|.
name|count
argument_list|()
condition|;
operator|++
name|n
control|)
name|QCOMPARE
argument_list|(
name|children
operator|.
name|at
argument_list|(
name|n
argument_list|)
operator|.
name|row
argument_list|()
argument_list|,
name|expectedChildRows
operator|.
name|at
argument_list|(
name|n
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|deleteItems_data
name|void
name|tst_QTreeWidget
operator|::
name|deleteItems_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"topLevelCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"childCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"grandChildCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"deleteTopLevelCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"deleteChildCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"deleteGrandChildCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"expectedTopLevelCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"expectedChildCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"expectedGrandChildCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"persistentRow"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"persistentColumn"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"persistentIsValid"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"start with 10, delete 1"
argument_list|)
operator|<<
literal|10
operator|<<
literal|10
operator|<<
literal|10
operator|<<
literal|1
operator|<<
literal|1
operator|<<
literal|1
operator|<<
literal|9
operator|<<
literal|9
operator|<<
literal|9
operator|<<
literal|0
operator|<<
literal|0
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"start with 10, delete 5"
argument_list|)
operator|<<
literal|10
operator|<<
literal|10
operator|<<
literal|10
operator|<<
literal|5
operator|<<
literal|5
operator|<<
literal|5
operator|<<
literal|5
operator|<<
literal|5
operator|<<
literal|5
operator|<<
literal|0
operator|<<
literal|0
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"mixed"
argument_list|)
operator|<<
literal|10
operator|<<
literal|13
operator|<<
literal|7
operator|<<
literal|3
operator|<<
literal|7
operator|<<
literal|4
operator|<<
literal|7
operator|<<
literal|6
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|0
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"all"
argument_list|)
operator|<<
literal|10
operator|<<
literal|10
operator|<<
literal|10
operator|<<
literal|10
operator|<<
literal|10
operator|<<
literal|10
operator|<<
literal|0
operator|<<
literal|0
operator|<<
literal|0
operator|<<
literal|0
operator|<<
literal|0
operator|<<
literal|false
expr_stmt|;
block|}
end_function
begin_function
DECL|function|deleteItems
name|void
name|tst_QTreeWidget
operator|::
name|deleteItems
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|topLevelCount
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|childCount
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|grandChildCount
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|deleteTopLevelCount
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|deleteChildCount
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|deleteGrandChildCount
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|expectedTopLevelCount
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|expectedChildCount
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|expectedGrandChildCount
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|persistentRow
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|persistentColumn
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|persistentIsValid
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|topLevelCount
condition|;
operator|++
name|i
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|top
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|testWidget
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|childCount
condition|;
operator|++
name|j
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|child
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|top
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|k
init|=
literal|0
init|;
name|k
operator|<
name|grandChildCount
condition|;
operator|++
name|k
control|)
block|{
operator|new
name|QTreeWidgetItem
argument_list|(
name|child
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|QPersistentModelIndex
name|persistent
init|=
name|testWidget
operator|->
name|model
argument_list|()
operator|->
name|index
argument_list|(
name|persistentRow
argument_list|,
name|persistentColumn
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|persistent
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|top
init|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|child
init|=
name|top
operator|->
name|child
argument_list|(
literal|0
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|n
init|=
literal|0
init|;
name|n
operator|<
name|deleteGrandChildCount
condition|;
operator|++
name|n
control|)
operator|delete
name|child
operator|->
name|child
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|childCount
argument_list|()
argument_list|,
name|expectedGrandChildCount
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|m
init|=
literal|0
init|;
name|m
operator|<
name|deleteChildCount
condition|;
operator|++
name|m
control|)
operator|delete
name|top
operator|->
name|child
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|top
operator|->
name|childCount
argument_list|()
argument_list|,
name|expectedChildCount
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|l
init|=
literal|0
init|;
name|l
operator|<
name|deleteTopLevelCount
condition|;
operator|++
name|l
control|)
operator|delete
name|testWidget
operator|->
name|topLevelItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|topLevelItemCount
argument_list|()
argument_list|,
name|expectedTopLevelCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|persistent
operator|.
name|isValid
argument_list|()
argument_list|,
name|persistentIsValid
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemAboveOrBelow
name|void
name|tst_QTreeWidget
operator|::
name|itemAboveOrBelow
parameter_list|()
block|{
name|QTreeWidget
name|tw
decl_stmt|;
name|tw
operator|.
name|setColumnCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|twi
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|tw
argument_list|,
name|QStringList
argument_list|()
operator|<<
literal|"Test"
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|twi2
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|tw
argument_list|,
name|QStringList
argument_list|()
operator|<<
literal|"Test 2"
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|twi3
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|tw
argument_list|,
name|QStringList
argument_list|()
operator|<<
literal|"Test 3"
argument_list|)
decl_stmt|;
name|tw
operator|.
name|show
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tw
operator|.
name|itemAbove
argument_list|(
name|twi2
argument_list|)
argument_list|,
name|twi
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tw
operator|.
name|itemBelow
argument_list|(
name|twi2
argument_list|)
argument_list|,
name|twi3
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemStreaming_data
name|void
name|tst_QTreeWidget
operator|::
name|itemStreaming_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QString
argument_list|>
argument_list|(
literal|"text"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QString
argument_list|>
argument_list|(
literal|"toolTip"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"column"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Data"
argument_list|)
operator|<<
literal|"item text"
operator|<<
literal|"tool tip text"
operator|<<
literal|0
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemStreaming
name|void
name|tst_QTreeWidget
operator|::
name|itemStreaming
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QString
argument_list|,
name|text
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QString
argument_list|,
name|toolTip
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|column
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
name|item
argument_list|(
name|testWidget
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|text
argument_list|(
name|column
argument_list|)
argument_list|,
name|QString
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|toolTip
argument_list|(
name|column
argument_list|)
argument_list|,
name|QString
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|.
name|setText
argument_list|(
name|column
argument_list|,
name|text
argument_list|)
expr_stmt|;
name|item
operator|.
name|setToolTip
argument_list|(
name|column
argument_list|,
name|toolTip
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|text
argument_list|(
name|column
argument_list|)
argument_list|,
name|text
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|toolTip
argument_list|(
name|column
argument_list|)
argument_list|,
name|toolTip
argument_list|)
expr_stmt|;
name|QByteArray
name|buffer
decl_stmt|;
name|QDataStream
name|out
argument_list|(
operator|&
name|buffer
argument_list|,
name|QIODevice
operator|::
name|WriteOnly
argument_list|)
decl_stmt|;
name|out
operator|<<
name|item
expr_stmt|;
name|QTreeWidgetItem
name|item2
argument_list|(
name|testWidget
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|.
name|text
argument_list|(
name|column
argument_list|)
argument_list|,
name|QString
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|.
name|toolTip
argument_list|(
name|column
argument_list|)
argument_list|,
name|QString
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|buffer
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QDataStream
name|in
argument_list|(
operator|&
name|buffer
argument_list|,
name|QIODevice
operator|::
name|ReadOnly
argument_list|)
decl_stmt|;
name|in
operator|>>
name|item2
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|.
name|text
argument_list|(
name|column
argument_list|)
argument_list|,
name|text
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|.
name|toolTip
argument_list|(
name|column
argument_list|)
argument_list|,
name|toolTip
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|insertTopLevelItems_data
name|void
name|tst_QTreeWidget
operator|::
name|insertTopLevelItems_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"initialText"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"insertText"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"insertTopLevelIndex"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"expectedTopLevelIndex"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"insertChildIndex"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"expectedChildIndex"
argument_list|)
expr_stmt|;
name|QStringList
name|initial
init|=
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"foo"
operator|<<
literal|"bar"
operator|)
decl_stmt|;
name|QStringList
name|insert
init|=
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"baz"
operator|)
decl_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Insert at count"
argument_list|)
operator|<<
name|initial
operator|<<
name|insert
operator|<<
name|initial
operator|.
name|count
argument_list|()
operator|<<
name|initial
operator|.
name|count
argument_list|()
operator|<<
name|initial
operator|.
name|count
argument_list|()
operator|<<
name|initial
operator|.
name|count
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Insert in the middle"
argument_list|)
operator|<<
name|initial
operator|<<
name|insert
operator|<<
operator|(
name|initial
operator|.
name|count
argument_list|()
operator|/
literal|2
operator|)
operator|<<
operator|(
name|initial
operator|.
name|count
argument_list|()
operator|/
literal|2
operator|)
operator|<<
operator|(
name|initial
operator|.
name|count
argument_list|()
operator|/
literal|2
operator|)
operator|<<
operator|(
name|initial
operator|.
name|count
argument_list|()
operator|/
literal|2
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Insert less than 0"
argument_list|)
operator|<<
name|initial
operator|<<
name|insert
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
operator|<<
operator|-
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Insert beyond count"
argument_list|)
operator|<<
name|initial
operator|<<
name|insert
operator|<<
name|initial
operator|.
name|count
argument_list|()
operator|+
literal|1
operator|<<
operator|-
literal|1
operator|<<
name|initial
operator|.
name|count
argument_list|()
operator|+
literal|1
operator|<<
operator|-
literal|1
expr_stmt|;
block|}
end_function
begin_function
DECL|function|insertTopLevelItems
name|void
name|tst_QTreeWidget
operator|::
name|insertTopLevelItems
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|initialText
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|insertText
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|insertTopLevelIndex
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|expectedTopLevelIndex
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|insertChildIndex
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|expectedChildIndex
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setSortingEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
block|{
comment|// insert the initial items
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|topLevelItemCount
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|initialText
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|top
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|QStringList
argument_list|(
name|initialText
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|testWidget
operator|->
name|addTopLevelItem
argument_list|(
name|top
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|indexOfTopLevelItem
argument_list|(
name|top
argument_list|)
argument_list|,
name|i
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|topLevelItemCount
argument_list|()
argument_list|,
name|initialText
operator|.
name|count
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
comment|// test adding children
name|QTreeWidgetItem
modifier|*
name|topLevel
init|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
literal|0
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|initialText
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
name|topLevel
operator|->
name|addChild
argument_list|(
operator|new
name|QTreeWidgetItem
argument_list|(
name|QStringList
argument_list|(
name|initialText
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|topLevel
operator|->
name|childCount
argument_list|()
argument_list|,
name|initialText
operator|.
name|count
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
comment|// test adding more top level items
name|QTreeWidgetItem
modifier|*
name|topsy
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|QStringList
argument_list|(
name|insertText
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|testWidget
operator|->
name|insertTopLevelItem
argument_list|(
name|insertTopLevelIndex
argument_list|,
name|topsy
argument_list|)
expr_stmt|;
if|if
condition|(
name|expectedTopLevelIndex
operator|==
operator|-
literal|1
condition|)
block|{
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|topLevelItemCount
argument_list|()
argument_list|,
name|initialText
operator|.
name|count
argument_list|()
argument_list|)
expr_stmt|;
operator|delete
name|topsy
expr_stmt|;
block|}
else|else
block|{
name|QTreeWidgetItem
modifier|*
name|item
init|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
name|expectedTopLevelIndex
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|insertText
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|indexOfTopLevelItem
argument_list|(
name|item
argument_list|)
argument_list|,
name|expectedTopLevelIndex
argument_list|)
expr_stmt|;
block|}
block|}
block|{
comment|// test adding more children
name|QTreeWidgetItem
modifier|*
name|topLevel
init|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|topLevel
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|child
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|QStringList
argument_list|(
name|insertText
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|topLevel
operator|->
name|insertChild
argument_list|(
name|insertChildIndex
argument_list|,
name|child
argument_list|)
expr_stmt|;
if|if
condition|(
name|expectedChildIndex
operator|==
operator|-
literal|1
condition|)
block|{
name|QCOMPARE
argument_list|(
name|topLevel
operator|->
name|childCount
argument_list|()
argument_list|,
name|initialText
operator|.
name|count
argument_list|()
argument_list|)
expr_stmt|;
operator|delete
name|child
expr_stmt|;
block|}
else|else
block|{
name|QTreeWidgetItem
modifier|*
name|item
init|=
name|topLevel
operator|->
name|child
argument_list|(
name|expectedChildIndex
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|insertText
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function
DECL|function|fillTreeWidget
specifier|static
name|void
name|fillTreeWidget
parameter_list|(
name|QTreeWidgetItem
modifier|*
name|parent
parameter_list|,
name|int
name|rows
parameter_list|)
block|{
specifier|const
name|int
name|columns
init|=
name|parent
operator|->
name|treeWidget
argument_list|()
operator|->
name|columnCount
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|r
init|=
literal|0
init|;
name|r
operator|<
name|rows
condition|;
operator|++
name|r
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|w
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|parent
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|c
init|=
literal|0
init|;
name|c
operator|<
name|columns
condition|;
operator|++
name|c
control|)
block|{
name|QString
name|s
init|=
name|QString
argument_list|(
literal|"[r:%1,c:%2]"
argument_list|)
operator|.
name|arg
argument_list|(
name|r
argument_list|)
operator|.
name|arg
argument_list|(
name|c
argument_list|)
decl_stmt|;
name|w
operator|->
name|setText
argument_list|(
name|c
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
name|fillTreeWidget
argument_list|(
name|w
argument_list|,
name|rows
operator|-
name|r
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|fillTreeWidget
specifier|static
name|void
name|fillTreeWidget
parameter_list|(
name|QTreeWidget
modifier|*
name|tree
parameter_list|,
name|int
name|rows
parameter_list|)
block|{
for|for
control|(
name|int
name|r
init|=
literal|0
init|;
name|r
operator|<
name|rows
condition|;
operator|++
name|r
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|w
init|=
operator|new
name|QTreeWidgetItem
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|c
init|=
literal|0
init|;
name|c
operator|<
name|tree
operator|->
name|columnCount
argument_list|()
condition|;
operator|++
name|c
control|)
block|{
name|QString
name|s
init|=
name|QString
argument_list|(
literal|"[r:%1,c:%2]"
argument_list|)
operator|.
name|arg
argument_list|(
name|r
argument_list|)
operator|.
name|arg
argument_list|(
name|c
argument_list|)
decl_stmt|;
name|w
operator|->
name|setText
argument_list|(
name|c
argument_list|,
name|s
argument_list|)
expr_stmt|;
block|}
name|tree
operator|->
name|insertTopLevelItem
argument_list|(
name|r
argument_list|,
name|w
argument_list|)
expr_stmt|;
name|fillTreeWidget
argument_list|(
name|w
argument_list|,
name|rows
operator|-
name|r
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|keyboardNavigation
name|void
name|tst_QTreeWidget
operator|::
name|keyboardNavigation
parameter_list|()
block|{
name|int
name|rows
init|=
literal|8
decl_stmt|;
name|fillTreeWidget
argument_list|(
name|testWidget
argument_list|,
name|rows
argument_list|)
expr_stmt|;
name|QVector
argument_list|<
name|Qt
operator|::
name|Key
argument_list|>
name|keymoves
decl_stmt|;
name|keymoves
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Right
operator|<<
name|Qt
operator|::
name|Key_Left
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Right
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Left
operator|<<
name|Qt
operator|::
name|Key_Left
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Right
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Right
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Left
operator|<<
name|Qt
operator|::
name|Key_Left
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Up
operator|<<
name|Qt
operator|::
name|Key_Left
operator|<<
name|Qt
operator|::
name|Key_Down
operator|<<
name|Qt
operator|::
name|Key_Right
operator|<<
name|Qt
operator|::
name|Key_Right
operator|<<
name|Qt
operator|::
name|Key_Right
operator|<<
name|Qt
operator|::
name|Key_Left
operator|<<
name|Qt
operator|::
name|Key_Left
operator|<<
name|Qt
operator|::
name|Key_Right
operator|<<
name|Qt
operator|::
name|Key_Left
expr_stmt|;
name|int
name|row
init|=
literal|0
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|item
init|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|testWidget
operator|->
name|setCurrentItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|currentItem
argument_list|()
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|instance
argument_list|()
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QScrollBar
modifier|*
name|scrollBar
init|=
name|testWidget
operator|->
name|horizontalScrollBar
argument_list|()
decl_stmt|;
name|bool
name|checkScroll
init|=
literal|false
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|keymoves
operator|.
name|size
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|Qt
operator|::
name|Key
name|key
init|=
name|keymoves
operator|.
name|at
argument_list|(
name|i
argument_list|)
decl_stmt|;
name|int
name|valueBeforeClick
init|=
name|scrollBar
operator|->
name|value
argument_list|()
decl_stmt|;
if|if
condition|(
name|valueBeforeClick
operator|>=
name|scrollBar
operator|->
name|singleStep
argument_list|()
condition|)
name|checkScroll
operator|=
literal|true
expr_stmt|;
else|else
name|checkScroll
operator|=
literal|false
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
name|testWidget
argument_list|,
name|key
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|instance
argument_list|()
operator|->
name|processEvents
argument_list|()
expr_stmt|;
switch|switch
condition|(
name|key
condition|)
block|{
case|case
name|Qt
operator|::
name|Key_Up
case|:
if|if
condition|(
name|row
operator|>
literal|0
condition|)
block|{
if|if
condition|(
name|item
operator|->
name|parent
argument_list|()
condition|)
name|item
operator|=
name|item
operator|->
name|parent
argument_list|()
operator|->
name|child
argument_list|(
name|row
operator|-
literal|1
argument_list|)
expr_stmt|;
else|else
name|item
operator|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
name|row
operator|-
literal|1
argument_list|)
expr_stmt|;
name|row
operator|-=
literal|1
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|item
operator|->
name|parent
argument_list|()
condition|)
block|{
name|item
operator|=
name|item
operator|->
name|parent
argument_list|()
expr_stmt|;
name|row
operator|=
name|item
operator|->
name|parent
argument_list|()
condition|?
name|item
operator|->
name|parent
argument_list|()
operator|->
name|indexOfChild
argument_list|(
name|item
argument_list|)
else|:
name|testWidget
operator|->
name|indexOfTopLevelItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|Qt
operator|::
name|Key_Down
case|:
if|if
condition|(
name|testWidget
operator|->
name|isItemExpanded
argument_list|(
name|item
argument_list|)
condition|)
block|{
name|row
operator|=
literal|0
expr_stmt|;
name|item
operator|=
name|item
operator|->
name|child
argument_list|(
name|row
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|row
operator|=
name|qMin
argument_list|(
name|rows
operator|-
literal|1
argument_list|,
name|row
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|item
operator|->
name|parent
argument_list|()
condition|)
name|item
operator|=
name|item
operator|->
name|parent
argument_list|()
operator|->
name|child
argument_list|(
name|row
argument_list|)
expr_stmt|;
else|else
name|item
operator|=
name|testWidget
operator|->
name|topLevelItem
argument_list|(
name|row
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|Qt
operator|::
name|Key_Left
case|:
if|if
condition|(
name|checkScroll
condition|)
block|{
name|QVERIFY
argument_list|(
name|testWidget
operator|->
name|isItemExpanded
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scrollBar
operator|->
name|value
argument_list|()
argument_list|,
name|valueBeforeClick
operator|-
name|scrollBar
operator|->
name|singleStep
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|// windows style right will walk to the parent
if|if
condition|(
name|testWidget
operator|->
name|currentItem
argument_list|()
operator|!=
name|item
condition|)
block|{
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|currentItem
argument_list|()
argument_list|,
name|item
operator|->
name|parent
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|=
name|testWidget
operator|->
name|currentItem
argument_list|()
expr_stmt|;
name|row
operator|=
name|item
operator|->
name|parent
argument_list|()
condition|?
name|item
operator|->
name|parent
argument_list|()
operator|->
name|indexOfChild
argument_list|(
name|item
argument_list|)
else|:
name|testWidget
operator|->
name|indexOfTopLevelItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
empty_stmt|;
block|}
break|break;
case|case
name|Qt
operator|::
name|Key_Right
case|:
if|if
condition|(
name|checkScroll
condition|)
name|QCOMPARE
argument_list|(
name|scrollBar
operator|->
name|value
argument_list|()
argument_list|,
name|valueBeforeClick
operator|+
name|scrollBar
operator|->
name|singleStep
argument_list|()
argument_list|)
expr_stmt|;
comment|// windows style right will walk to the first child
if|if
condition|(
name|testWidget
operator|->
name|currentItem
argument_list|()
operator|!=
name|item
condition|)
block|{
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|currentItem
argument_list|()
operator|->
name|parent
argument_list|()
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|row
operator|=
name|item
operator|->
name|indexOfChild
argument_list|(
name|testWidget
operator|->
name|currentItem
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|=
name|testWidget
operator|->
name|currentItem
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|row
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
name|QVERIFY
argument_list|(
literal|false
argument_list|)
expr_stmt|;
block|}
name|QTreeWidgetItem
modifier|*
name|current
init|=
name|testWidget
operator|->
name|currentItem
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|current
operator|->
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QString
argument_list|(
literal|"[r:%1,c:0]"
argument_list|)
operator|.
name|arg
argument_list|(
name|row
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|current
operator|->
name|parent
argument_list|()
condition|)
name|QCOMPARE
argument_list|(
name|current
operator|->
name|parent
argument_list|()
operator|->
name|indexOfChild
argument_list|(
name|current
argument_list|)
argument_list|,
name|row
argument_list|)
expr_stmt|;
else|else
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|indexOfTopLevelItem
argument_list|(
name|current
argument_list|)
argument_list|,
name|row
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|scrollToItem
name|void
name|tst_QTreeWidget
operator|::
name|scrollToItem
parameter_list|()
block|{
comment|// Check if all parent nodes of the item found are expanded.
comment|// Reported in task #78761
name|QTreeWidgetItem
modifier|*
name|bar
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|search
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
operator|++
name|i
control|)
block|{
name|bar
operator|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|testWidget
argument_list|)
expr_stmt|;
name|bar
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
name|QString
operator|::
name|number
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
literal|2
condition|;
operator|++
name|j
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|foo
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|bar
argument_list|)
decl_stmt|;
name|foo
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
name|bar
operator|->
name|text
argument_list|(
literal|0
argument_list|)
operator|+
name|QString
operator|::
name|number
argument_list|(
name|j
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|k
init|=
literal|0
init|;
name|k
operator|<
literal|2
condition|;
operator|++
name|k
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|yo
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|foo
argument_list|)
decl_stmt|;
name|yo
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
name|foo
operator|->
name|text
argument_list|(
literal|0
argument_list|)
operator|+
name|QString
operator|::
name|number
argument_list|(
name|k
argument_list|)
argument_list|)
expr_stmt|;
name|search
operator|=
name|yo
expr_stmt|;
block|}
block|}
block|}
name|testWidget
operator|->
name|setHeaderLabels
argument_list|(
name|QStringList
argument_list|()
operator|<<
literal|"foo"
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|scrollToItem
argument_list|(
name|search
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|search
operator|->
name|text
argument_list|(
literal|0
argument_list|)
operator|==
literal|"111"
argument_list|)
expr_stmt|;
name|bar
operator|=
name|search
operator|->
name|parent
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|testWidget
operator|->
name|isItemExpanded
argument_list|(
name|bar
argument_list|)
argument_list|)
expr_stmt|;
name|bar
operator|=
name|bar
operator|->
name|parent
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|testWidget
operator|->
name|isItemExpanded
argument_list|(
name|bar
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// From task #85413
end_comment
begin_function
DECL|function|setSortingEnabled
name|void
name|tst_QTreeWidget
operator|::
name|setSortingEnabled
parameter_list|()
block|{
name|QStringList
name|hl
decl_stmt|;
name|hl
operator|<<
literal|"ID"
expr_stmt|;
name|testWidget
operator|->
name|setColumnCount
argument_list|(
name|hl
operator|.
name|count
argument_list|()
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setHeaderLabels
argument_list|(
name|hl
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|item1
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|testWidget
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|item2
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|testWidget
argument_list|)
decl_stmt|;
name|testWidget
operator|->
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|isSortingEnabled
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|isSortingEnabled
argument_list|()
argument_list|,
name|testWidget
operator|->
name|header
argument_list|()
operator|->
name|isSortIndicatorShown
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|topLevelItem
argument_list|(
literal|0
argument_list|)
argument_list|,
name|item1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|topLevelItem
argument_list|(
literal|1
argument_list|)
argument_list|,
name|item2
argument_list|)
expr_stmt|;
comment|// Make sure we do it twice
name|testWidget
operator|->
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|isSortingEnabled
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|isSortingEnabled
argument_list|()
argument_list|,
name|testWidget
operator|->
name|header
argument_list|()
operator|->
name|isSortIndicatorShown
argument_list|()
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setSortingEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|isSortingEnabled
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|isSortingEnabled
argument_list|()
argument_list|,
name|testWidget
operator|->
name|header
argument_list|()
operator|->
name|isSortIndicatorShown
argument_list|()
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setSortingEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|isSortingEnabled
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|isSortingEnabled
argument_list|()
argument_list|,
name|testWidget
operator|->
name|header
argument_list|()
operator|->
name|isSortIndicatorShown
argument_list|()
argument_list|)
expr_stmt|;
comment|// And back again so that we make sure that we test the transition from false to true
name|testWidget
operator|->
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|isSortingEnabled
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|isSortingEnabled
argument_list|()
argument_list|,
name|testWidget
operator|->
name|header
argument_list|()
operator|->
name|isSortIndicatorShown
argument_list|()
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|isSortingEnabled
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|isSortingEnabled
argument_list|()
argument_list|,
name|testWidget
operator|->
name|header
argument_list|()
operator|->
name|isSortIndicatorShown
argument_list|()
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setSortingEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|addChild
name|void
name|tst_QTreeWidget
operator|::
name|addChild
parameter_list|()
block|{
name|QTreeWidget
name|tree
decl_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
literal|2
condition|;
operator|++
name|x
control|)
block|{
name|QTreeWidget
modifier|*
name|view
init|=
name|x
condition|?
operator|&
name|tree
else|:
cast|static_cast
argument_list|<
name|QTreeWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|(
name|QTreeWidget
operator|*
operator|)
name|view
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|childCount
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// try to add 0
name|item
operator|->
name|addChild
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|childCount
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|indexOfChild
argument_list|(
literal|0
argument_list|)
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|// add one at a time
name|QList
argument_list|<
name|QTreeWidgetItem
modifier|*
argument_list|>
name|children
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
operator|++
name|i
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|child
init|=
operator|new
name|QTreeWidgetItem
argument_list|()
decl_stmt|;
name|item
operator|->
name|addChild
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|childCount
argument_list|()
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|child
argument_list|(
name|i
argument_list|)
argument_list|,
name|child
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|indexOfChild
argument_list|(
name|child
argument_list|)
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|parent
argument_list|()
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|treeWidget
argument_list|()
argument_list|,
name|view
argument_list|)
expr_stmt|;
name|item
operator|->
name|addChild
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|childCount
argument_list|()
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
name|children
operator|.
name|append
argument_list|(
name|child
argument_list|)
expr_stmt|;
block|}
comment|// take them all
name|QList
argument_list|<
name|QTreeWidgetItem
modifier|*
argument_list|>
name|taken
init|=
name|item
operator|->
name|takeChildren
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|taken
argument_list|,
name|children
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|childCount
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|taken
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QCOMPARE
argument_list|(
name|taken
operator|.
name|at
argument_list|(
name|i
argument_list|)
operator|->
name|parent
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|taken
operator|.
name|at
argument_list|(
name|i
argument_list|)
operator|->
name|treeWidget
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QTreeWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|addChild
argument_list|(
name|taken
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
comment|// re-add
block|}
comment|// delete one at a time
while|while
condition|(
operator|!
name|children
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|QTreeWidgetItem
modifier|*
name|ti
init|=
name|children
operator|.
name|takeFirst
argument_list|()
decl_stmt|;
operator|delete
name|ti
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|childCount
argument_list|()
argument_list|,
name|children
operator|.
name|count
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|children
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
name|QCOMPARE
argument_list|(
name|item
operator|->
name|child
argument_list|(
name|i
argument_list|)
argument_list|,
name|children
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
comment|// add none
block|{
name|int
name|count
init|=
name|item
operator|->
name|childCount
argument_list|()
decl_stmt|;
name|item
operator|->
name|addChildren
argument_list|(
name|QList
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|childCount
argument_list|()
argument_list|,
name|count
argument_list|)
expr_stmt|;
block|}
comment|// add many at a time
specifier|const
name|int
name|count
init|=
literal|10
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|100
condition|;
name|i
operator|+=
name|count
control|)
block|{
name|QList
argument_list|<
name|QTreeWidgetItem
modifier|*
argument_list|>
name|list
decl_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|count
condition|;
operator|++
name|j
control|)
name|list
operator|<<
operator|new
name|QTreeWidgetItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
name|QString
argument_list|(
literal|"%0"
argument_list|)
operator|.
name|arg
argument_list|(
name|j
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|addChildren
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|childCount
argument_list|()
argument_list|,
name|count
operator|+
name|i
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|count
condition|;
operator|++
name|j
control|)
block|{
name|QCOMPARE
argument_list|(
name|item
operator|->
name|child
argument_list|(
name|i
operator|+
name|j
argument_list|)
argument_list|,
name|list
operator|.
name|at
argument_list|(
name|j
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|child
argument_list|(
name|i
operator|+
name|j
argument_list|)
operator|->
name|parent
argument_list|()
argument_list|,
name|item
argument_list|)
expr_stmt|;
block|}
name|item
operator|->
name|addChildren
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|childCount
argument_list|()
argument_list|,
name|count
operator|+
name|i
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|view
condition|)
operator|delete
name|item
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|setData
name|void
name|tst_QTreeWidget
operator|::
name|setData
parameter_list|()
block|{
block|{
name|QTreeWidgetItem
modifier|*
name|headerItem
init|=
operator|new
name|QTreeWidgetItem
argument_list|()
decl_stmt|;
name|headerItem
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"Item1"
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setHeaderItem
argument_list|(
name|headerItem
argument_list|)
expr_stmt|;
name|QSignalSpy
name|headerDataChangedSpy
argument_list|(
name|testWidget
operator|->
name|model
argument_list|()
argument_list|,
name|SIGNAL
argument_list|(
name|headerDataChanged
argument_list|(
name|Qt
operator|::
name|Orientation
argument_list|,
name|int
argument_list|,
name|int
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QSignalSpy
name|dataChangedSpy
argument_list|(
name|testWidget
operator|->
name|model
argument_list|()
argument_list|,
name|SIGNAL
argument_list|(
name|dataChanged
argument_list|(
name|QModelIndex
argument_list|,
name|QModelIndex
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QSignalSpy
name|itemChangedSpy
argument_list|(
name|testWidget
argument_list|,
name|SIGNAL
argument_list|(
name|itemChanged
argument_list|(
name|QTreeWidgetItem
operator|*
argument_list|,
name|int
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|headerItem
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"test"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dataChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|headerDataChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// no itemChanged() signal for header item
name|headerItem
operator|->
name|setData
argument_list|(
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
name|QSignalSpy
name|itemChangedSpy
argument_list|(
name|testWidget
argument_list|,
name|SIGNAL
argument_list|(
name|itemChanged
argument_list|(
name|QTreeWidgetItem
operator|*
argument_list|,
name|int
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|new
name|QTreeWidgetItem
argument_list|()
decl_stmt|;
name|testWidget
operator|->
name|addTopLevelItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
literal|2
condition|;
operator|++
name|x
control|)
block|{
for|for
control|(
name|int
name|i
init|=
literal|1
init|;
name|i
operator|<=
literal|2
condition|;
operator|++
name|i
control|)
block|{
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
literal|5
condition|;
operator|++
name|j
control|)
block|{
name|QVariantList
name|args
decl_stmt|;
name|QString
name|text
init|=
name|QString
argument_list|(
literal|"text %0"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
decl_stmt|;
name|item
operator|->
name|setText
argument_list|(
name|j
argument_list|,
name|text
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|text
argument_list|(
name|j
argument_list|)
argument_list|,
name|text
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|args
operator|=
name|itemChangedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|)
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|item
operator|->
name|setText
argument_list|(
name|j
argument_list|,
name|text
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QPixmap
name|pixmap
argument_list|(
literal|32
argument_list|,
literal|32
argument_list|)
decl_stmt|;
name|pixmap
operator|.
name|fill
argument_list|(
operator|(
name|i
operator|==
literal|1
operator|)
condition|?
name|Qt
operator|::
name|red
else|:
name|Qt
operator|::
name|green
argument_list|)
expr_stmt|;
name|QIcon
name|icon
argument_list|(
name|pixmap
argument_list|)
decl_stmt|;
name|item
operator|->
name|setIcon
argument_list|(
name|j
argument_list|,
name|icon
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|icon
argument_list|(
name|j
argument_list|)
argument_list|,
name|icon
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|args
operator|=
name|itemChangedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|)
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|item
operator|->
name|setIcon
argument_list|(
name|j
argument_list|,
name|icon
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QString
name|toolTip
init|=
name|QString
argument_list|(
literal|"toolTip %0"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
decl_stmt|;
name|item
operator|->
name|setToolTip
argument_list|(
name|j
argument_list|,
name|toolTip
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|toolTip
argument_list|(
name|j
argument_list|)
argument_list|,
name|toolTip
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|args
operator|=
name|itemChangedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|)
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|item
operator|->
name|setToolTip
argument_list|(
name|j
argument_list|,
name|toolTip
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QString
name|statusTip
init|=
name|QString
argument_list|(
literal|"statusTip %0"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
decl_stmt|;
name|item
operator|->
name|setStatusTip
argument_list|(
name|j
argument_list|,
name|statusTip
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|statusTip
argument_list|(
name|j
argument_list|)
argument_list|,
name|statusTip
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|args
operator|=
name|itemChangedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|)
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|item
operator|->
name|setStatusTip
argument_list|(
name|j
argument_list|,
name|statusTip
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QString
name|whatsThis
init|=
name|QString
argument_list|(
literal|"whatsThis %0"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
decl_stmt|;
name|item
operator|->
name|setWhatsThis
argument_list|(
name|j
argument_list|,
name|whatsThis
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|whatsThis
argument_list|(
name|j
argument_list|)
argument_list|,
name|whatsThis
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|args
operator|=
name|itemChangedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|)
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|item
operator|->
name|setWhatsThis
argument_list|(
name|j
argument_list|,
name|whatsThis
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QSize
name|sizeHint
argument_list|(
literal|64
operator|*
name|i
argument_list|,
literal|48
operator|*
name|i
argument_list|)
decl_stmt|;
name|item
operator|->
name|setSizeHint
argument_list|(
name|j
argument_list|,
name|sizeHint
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|sizeHint
argument_list|(
name|j
argument_list|)
argument_list|,
name|sizeHint
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|args
operator|=
name|itemChangedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|)
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|item
operator|->
name|setSizeHint
argument_list|(
name|j
argument_list|,
name|sizeHint
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QFont
name|font
decl_stmt|;
name|item
operator|->
name|setFont
argument_list|(
name|j
argument_list|,
name|font
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|font
argument_list|(
name|j
argument_list|)
argument_list|,
name|font
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|args
operator|=
name|itemChangedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|)
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFont
argument_list|(
name|j
argument_list|,
name|font
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Qt
operator|::
name|Alignment
name|textAlignment
argument_list|(
operator|(
name|i
operator|==
literal|1
operator|)
condition|?
name|Qt
operator|::
name|AlignLeft
operator||
name|Qt
operator|::
name|AlignVCenter
else|:
name|Qt
operator|::
name|AlignRight
argument_list|)
decl_stmt|;
name|item
operator|->
name|setTextAlignment
argument_list|(
name|j
argument_list|,
name|textAlignment
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|textAlignment
argument_list|(
name|j
argument_list|)
argument_list|,
name|int
argument_list|(
name|textAlignment
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|args
operator|=
name|itemChangedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|)
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|item
operator|->
name|setTextAlignment
argument_list|(
name|j
argument_list|,
name|textAlignment
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QColor
name|backgroundColor
argument_list|(
operator|(
name|i
operator|==
literal|1
operator|)
condition|?
name|Qt
operator|::
name|blue
else|:
name|Qt
operator|::
name|yellow
argument_list|)
decl_stmt|;
name|item
operator|->
name|setBackground
argument_list|(
name|j
argument_list|,
name|backgroundColor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|background
argument_list|(
name|j
argument_list|)
operator|.
name|color
argument_list|()
argument_list|,
name|backgroundColor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|args
operator|=
name|itemChangedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|)
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|item
operator|->
name|setBackground
argument_list|(
name|j
argument_list|,
name|backgroundColor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QColor
name|textColor
argument_list|(
operator|(
name|i
operator|==
literal|1
operator|)
condition|?
name|Qt
operator|::
name|green
else|:
name|Qt
operator|::
name|cyan
argument_list|)
decl_stmt|;
name|item
operator|->
name|setTextColor
argument_list|(
name|j
argument_list|,
name|textColor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|textColor
argument_list|(
name|j
argument_list|)
argument_list|,
name|textColor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|args
operator|=
name|itemChangedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|)
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|item
operator|->
name|setTextColor
argument_list|(
name|j
argument_list|,
name|textColor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|Qt
operator|::
name|CheckState
name|checkState
argument_list|(
operator|(
name|i
operator|==
literal|1
operator|)
condition|?
name|Qt
operator|::
name|PartiallyChecked
else|:
name|Qt
operator|::
name|Checked
argument_list|)
decl_stmt|;
name|item
operator|->
name|setCheckState
argument_list|(
name|j
argument_list|,
name|checkState
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|checkState
argument_list|(
name|j
argument_list|)
argument_list|,
name|checkState
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|args
operator|=
name|itemChangedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|)
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|item
operator|->
name|setCheckState
argument_list|(
name|j
argument_list|,
name|checkState
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|text
argument_list|(
name|j
argument_list|)
argument_list|,
name|text
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|icon
argument_list|(
name|j
argument_list|)
argument_list|,
name|icon
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|toolTip
argument_list|(
name|j
argument_list|)
argument_list|,
name|toolTip
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|statusTip
argument_list|(
name|j
argument_list|)
argument_list|,
name|statusTip
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|whatsThis
argument_list|(
name|j
argument_list|)
argument_list|,
name|whatsThis
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|sizeHint
argument_list|(
name|j
argument_list|)
argument_list|,
name|sizeHint
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|font
argument_list|(
name|j
argument_list|)
argument_list|,
name|font
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|textAlignment
argument_list|(
name|j
argument_list|)
argument_list|,
name|int
argument_list|(
name|textAlignment
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|background
argument_list|(
name|j
argument_list|)
operator|.
name|color
argument_list|()
argument_list|,
name|backgroundColor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|textColor
argument_list|(
name|j
argument_list|)
argument_list|,
name|textColor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|checkState
argument_list|(
name|j
argument_list|)
argument_list|,
name|checkState
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QString
argument_list|>
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|)
argument_list|)
argument_list|,
name|text
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QIcon
argument_list|>
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|DecorationRole
argument_list|)
argument_list|)
argument_list|,
name|icon
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QString
argument_list|>
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|ToolTipRole
argument_list|)
argument_list|)
argument_list|,
name|toolTip
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QString
argument_list|>
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|StatusTipRole
argument_list|)
argument_list|)
argument_list|,
name|statusTip
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QString
argument_list|>
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|WhatsThisRole
argument_list|)
argument_list|)
argument_list|,
name|whatsThis
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QSize
argument_list|>
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|SizeHintRole
argument_list|)
argument_list|)
argument_list|,
name|sizeHint
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QFont
argument_list|>
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|FontRole
argument_list|)
argument_list|)
argument_list|,
name|font
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|TextAlignmentRole
argument_list|)
argument_list|)
argument_list|,
name|int
argument_list|(
name|textAlignment
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QBrush
argument_list|>
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|BackgroundColorRole
argument_list|)
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|backgroundColor
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QBrush
argument_list|>
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|BackgroundRole
argument_list|)
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|backgroundColor
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QColor
argument_list|>
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|TextColorRole
argument_list|)
argument_list|)
argument_list|,
name|textColor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|CheckStateRole
argument_list|)
argument_list|)
argument_list|,
name|int
argument_list|(
name|checkState
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setBackground
argument_list|(
name|j
argument_list|,
name|pixmap
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|background
argument_list|(
name|j
argument_list|)
operator|.
name|texture
argument_list|()
argument_list|,
name|pixmap
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QBrush
argument_list|>
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|BackgroundRole
argument_list|)
argument_list|)
operator|.
name|texture
argument_list|()
argument_list|,
name|pixmap
argument_list|)
expr_stmt|;
name|args
operator|=
name|itemChangedSpy
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|args
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|)
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|item
operator|->
name|setBackground
argument_list|(
name|j
argument_list|,
name|pixmap
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|item
operator|->
name|setData
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setData
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|DecorationRole
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setData
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|ToolTipRole
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setData
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|StatusTipRole
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setData
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|WhatsThisRole
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setData
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|SizeHintRole
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setData
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|FontRole
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setData
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|TextAlignmentRole
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setData
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|BackgroundColorRole
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setData
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|TextColorRole
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setData
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|CheckStateRole
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|11
argument_list|)
expr_stmt|;
name|itemChangedSpy
operator|.
name|clear
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|DecorationRole
argument_list|)
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|ToolTipRole
argument_list|)
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|StatusTipRole
argument_list|)
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|WhatsThisRole
argument_list|)
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|SizeHintRole
argument_list|)
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|FontRole
argument_list|)
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|TextAlignmentRole
argument_list|)
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|BackgroundColorRole
argument_list|)
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|BackgroundRole
argument_list|)
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|TextColorRole
argument_list|)
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|data
argument_list|(
name|j
argument_list|,
name|Qt
operator|::
name|CheckStateRole
argument_list|)
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
block|}
comment|// ### add more data types here
name|item
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|data
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|)
operator|.
name|type
argument_list|()
argument_list|,
name|QVariant
operator|::
name|Int
argument_list|)
expr_stmt|;
name|item
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|,
literal|"test"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|data
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|)
operator|.
name|type
argument_list|()
argument_list|,
name|QVariant
operator|::
name|String
argument_list|)
expr_stmt|;
name|item
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|,
literal|0.4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|data
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|)
operator|.
name|type
argument_list|()
argument_list|,
name|QVariant
operator|::
name|Double
argument_list|)
expr_stmt|;
operator|delete
name|item
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|itemData
name|void
name|tst_QTreeWidget
operator|::
name|itemData
parameter_list|()
block|{
name|QTreeWidget
name|widget
decl_stmt|;
name|QTreeWidgetItem
name|item
argument_list|(
operator|&
name|widget
argument_list|)
decl_stmt|;
name|widget
operator|.
name|setColumnCount
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|item
operator|.
name|setFlags
argument_list|(
name|item
operator|.
name|flags
argument_list|()
operator||
name|Qt
operator|::
name|ItemIsEditable
argument_list|)
expr_stmt|;
name|item
operator|.
name|setData
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|,
name|QString
argument_list|(
literal|"0"
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|.
name|setData
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|CheckStateRole
argument_list|,
name|Qt
operator|::
name|PartiallyChecked
argument_list|)
expr_stmt|;
name|item
operator|.
name|setData
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|UserRole
operator|+
literal|0
argument_list|,
name|QString
argument_list|(
literal|"1"
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|.
name|setData
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|UserRole
operator|+
literal|1
argument_list|,
name|QString
argument_list|(
literal|"2"
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|.
name|setData
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|UserRole
operator|+
literal|2
argument_list|,
name|QString
argument_list|(
literal|"3"
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|.
name|setData
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|UserRole
operator|+
literal|3
argument_list|,
name|QString
argument_list|(
literal|"4"
argument_list|)
argument_list|)
expr_stmt|;
name|QMap
argument_list|<
name|int
argument_list|,
name|QVariant
argument_list|>
name|flags
init|=
name|widget
operator|.
name|model
argument_list|()
operator|->
name|itemData
argument_list|(
name|widget
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|flags
operator|.
name|count
argument_list|()
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|flags
index|[
name|Qt
operator|::
name|UserRole
operator|+
literal|0
index|]
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"1"
argument_list|)
argument_list|)
expr_stmt|;
name|flags
operator|=
name|widget
operator|.
name|model
argument_list|()
operator|->
name|itemData
argument_list|(
name|widget
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|flags
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|enableDisable
name|void
name|tst_QTreeWidget
operator|::
name|enableDisable
parameter_list|()
block|{
name|QTreeWidgetItem
modifier|*
name|itm
init|=
operator|new
name|QTreeWidgetItem
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
operator|++
name|i
control|)
operator|new
name|QTreeWidgetItem
argument_list|(
name|itm
argument_list|)
expr_stmt|;
comment|// make sure all items are enabled
name|QVERIFY
argument_list|(
name|itm
operator|->
name|flags
argument_list|()
operator|&
name|Qt
operator|::
name|ItemIsEnabled
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|itm
operator|->
name|childCount
argument_list|()
condition|;
operator|++
name|j
control|)
name|QVERIFY
argument_list|(
name|itm
operator|->
name|child
argument_list|(
name|j
argument_list|)
operator|->
name|flags
argument_list|()
operator|&
name|Qt
operator|::
name|ItemIsEnabled
argument_list|)
expr_stmt|;
comment|// disable root and make sure they are all disabled
name|itm
operator|->
name|setFlags
argument_list|(
name|itm
operator|->
name|flags
argument_list|()
operator|&
operator|~
name|Qt
operator|::
name|ItemIsEnabled
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
operator|(
name|itm
operator|->
name|flags
argument_list|()
operator|&
name|Qt
operator|::
name|ItemIsEnabled
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|k
init|=
literal|0
init|;
name|k
operator|<
name|itm
operator|->
name|childCount
argument_list|()
condition|;
operator|++
name|k
control|)
name|QVERIFY
argument_list|(
operator|!
operator|(
name|itm
operator|->
name|child
argument_list|(
name|k
argument_list|)
operator|->
name|flags
argument_list|()
operator|&
name|Qt
operator|::
name|ItemIsEnabled
operator|)
argument_list|)
expr_stmt|;
comment|// disable a child and make sure they are all still disabled
name|itm
operator|->
name|child
argument_list|(
literal|5
argument_list|)
operator|->
name|setFlags
argument_list|(
name|itm
operator|->
name|child
argument_list|(
literal|5
argument_list|)
operator|->
name|flags
argument_list|()
operator|&
operator|~
name|Qt
operator|::
name|ItemIsEnabled
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
operator|(
name|itm
operator|->
name|flags
argument_list|()
operator|&
name|Qt
operator|::
name|ItemIsEnabled
operator|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|l
init|=
literal|0
init|;
name|l
operator|<
name|itm
operator|->
name|childCount
argument_list|()
condition|;
operator|++
name|l
control|)
name|QVERIFY
argument_list|(
operator|!
operator|(
name|itm
operator|->
name|child
argument_list|(
name|l
argument_list|)
operator|->
name|flags
argument_list|()
operator|&
name|Qt
operator|::
name|ItemIsEnabled
operator|)
argument_list|)
expr_stmt|;
comment|// enable root and make sure all items except one are enabled
name|itm
operator|->
name|setFlags
argument_list|(
name|itm
operator|->
name|flags
argument_list|()
operator||
name|Qt
operator|::
name|ItemIsEnabled
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|itm
operator|->
name|flags
argument_list|()
operator|&
name|Qt
operator|::
name|ItemIsEnabled
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|m
init|=
literal|0
init|;
name|m
operator|<
name|itm
operator|->
name|childCount
argument_list|()
condition|;
operator|++
name|m
control|)
if|if
condition|(
name|m
operator|==
literal|5
condition|)
name|QVERIFY
argument_list|(
operator|!
operator|(
name|itm
operator|->
name|child
argument_list|(
name|m
argument_list|)
operator|->
name|flags
argument_list|()
operator|&
name|Qt
operator|::
name|ItemIsEnabled
operator|)
argument_list|)
expr_stmt|;
else|else
name|QVERIFY
argument_list|(
name|itm
operator|->
name|child
argument_list|(
name|m
argument_list|)
operator|->
name|flags
argument_list|()
operator|&
name|Qt
operator|::
name|ItemIsEnabled
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|match
name|void
name|tst_QTreeWidget
operator|::
name|match
parameter_list|()
block|{
name|QTreeWidget
name|tree
decl_stmt|;
name|QModelIndexList
name|list
init|=
name|tree
operator|.
name|model
argument_list|()
operator|->
name|match
argument_list|(
name|QModelIndex
argument_list|()
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|,
name|QString
argument_list|()
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|list
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|columnCount
name|void
name|tst_QTreeWidget
operator|::
name|columnCount
parameter_list|()
block|{
name|int
name|columnCountBefore
init|=
name|testWidget
operator|->
name|columnCount
argument_list|()
decl_stmt|;
name|testWidget
operator|->
name|setColumnCount
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|columnCount
argument_list|()
argument_list|,
name|columnCountBefore
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setHeaderLabels
name|void
name|tst_QTreeWidget
operator|::
name|setHeaderLabels
parameter_list|()
block|{
name|QStringList
name|list
init|=
name|QString
argument_list|(
literal|"a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z"
argument_list|)
operator|.
name|split
argument_list|(
literal|","
argument_list|)
decl_stmt|;
name|testWidget
operator|->
name|setHeaderLabels
argument_list|(
name|list
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|header
argument_list|()
operator|->
name|count
argument_list|()
argument_list|,
name|list
operator|.
name|count
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setHeaderItem
name|void
name|tst_QTreeWidget
operator|::
name|setHeaderItem
parameter_list|()
block|{
name|testWidget
operator|->
name|setHeaderItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|headerItem
init|=
operator|new
name|QTreeWidgetItem
argument_list|()
decl_stmt|;
name|testWidget
operator|->
name|setColumnCount
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|header
argument_list|()
operator|->
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|columnCount
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|headerItem
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"0"
argument_list|)
expr_stmt|;
name|headerItem
operator|->
name|setText
argument_list|(
literal|1
argument_list|,
literal|"1"
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setHeaderItem
argument_list|(
name|headerItem
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|headerItem
argument_list|()
argument_list|,
name|headerItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|headerItem
operator|->
name|treeWidget
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QTreeWidget
operator|*
argument_list|>
argument_list|(
name|testWidget
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|header
argument_list|()
operator|->
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|columnCount
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|headerItem
operator|->
name|setText
argument_list|(
literal|2
argument_list|,
literal|"2"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|header
argument_list|()
operator|->
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|columnCount
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
operator|delete
name|headerItem
expr_stmt|;
name|testWidget
operator|->
name|setColumnCount
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|setColumnCount
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|model
argument_list|()
operator|->
name|headerData
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Horizontal
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"1"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|model
argument_list|()
operator|->
name|headerData
argument_list|(
literal|1
argument_list|,
name|Qt
operator|::
name|Horizontal
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"2"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|model
argument_list|()
operator|->
name|headerData
argument_list|(
literal|2
argument_list|,
name|Qt
operator|::
name|Horizontal
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"3"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|model
argument_list|()
operator|->
name|headerData
argument_list|(
literal|3
argument_list|,
name|Qt
operator|::
name|Horizontal
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"4"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|model
argument_list|()
operator|->
name|headerData
argument_list|(
literal|4
argument_list|,
name|Qt
operator|::
name|Horizontal
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"5"
argument_list|)
argument_list|)
expr_stmt|;
name|headerItem
operator|=
operator|new
name|QTreeWidgetItem
argument_list|()
expr_stmt|;
name|testWidget
operator|->
name|setHeaderItem
argument_list|(
name|headerItem
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|model
argument_list|()
operator|->
name|insertColumns
argument_list|(
literal|0
argument_list|,
literal|5
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|model
argument_list|()
operator|->
name|headerData
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Horizontal
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"1"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|model
argument_list|()
operator|->
name|headerData
argument_list|(
literal|1
argument_list|,
name|Qt
operator|::
name|Horizontal
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"2"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|model
argument_list|()
operator|->
name|headerData
argument_list|(
literal|2
argument_list|,
name|Qt
operator|::
name|Horizontal
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"3"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|model
argument_list|()
operator|->
name|headerData
argument_list|(
literal|3
argument_list|,
name|Qt
operator|::
name|Horizontal
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"4"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testWidget
operator|->
name|model
argument_list|()
operator|->
name|headerData
argument_list|(
literal|4
argument_list|,
name|Qt
operator|::
name|Horizontal
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"5"
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemWidget_data
name|void
name|tst_QTreeWidget
operator|::
name|itemWidget_data
parameter_list|()
block|{
name|editItem_data
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemWidget
name|void
name|tst_QTreeWidget
operator|::
name|itemWidget
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|TreeItemList
argument_list|,
name|topLevelItems
argument_list|)
expr_stmt|;
name|QTreeWidget
name|tree
decl_stmt|;
name|populate
argument_list|(
operator|&
name|tree
argument_list|,
name|topLevelItems
argument_list|,
operator|new
name|TreeItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
literal|"1"
operator|<<
literal|"2"
argument_list|)
argument_list|)
expr_stmt|;
name|tree
operator|.
name|show
argument_list|()
expr_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
literal|2
condition|;
operator|++
name|x
control|)
block|{
name|QTreeWidgetItemIterator
name|it
argument_list|(
operator|&
name|tree
argument_list|)
decl_stmt|;
while|while
condition|(
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|(
operator|*
name|it
operator|++
operator|)
condition|)
block|{
for|for
control|(
name|int
name|col
init|=
literal|0
init|;
name|col
operator|<
name|item
operator|->
name|columnCount
argument_list|()
condition|;
operator|++
name|col
control|)
block|{
if|if
condition|(
name|x
operator|==
literal|0
condition|)
block|{
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|itemWidget
argument_list|(
name|item
argument_list|,
name|col
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QWidget
modifier|*
name|editor
init|=
operator|new
name|QLineEdit
argument_list|()
decl_stmt|;
name|tree
operator|.
name|setItemWidget
argument_list|(
name|item
argument_list|,
name|col
argument_list|,
name|editor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|itemWidget
argument_list|(
name|item
argument_list|,
name|col
argument_list|)
argument_list|,
name|editor
argument_list|)
expr_stmt|;
name|tree
operator|.
name|removeItemWidget
argument_list|(
name|item
argument_list|,
name|col
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|itemWidget
argument_list|(
name|item
argument_list|,
name|col
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|// ### should you really be able to open a persistent
comment|//     editor for an item that isn't editable??
name|tree
operator|.
name|openPersistentEditor
argument_list|(
name|item
argument_list|,
name|col
argument_list|)
expr_stmt|;
name|QWidget
modifier|*
name|editor
init|=
name|tree
operator|.
name|findChild
argument_list|<
name|QLineEdit
operator|*
argument_list|>
argument_list|()
decl_stmt|;
name|QVERIFY
argument_list|(
name|editor
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|tree
operator|.
name|closePersistentEditor
argument_list|(
name|item
argument_list|,
name|col
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
block|}
end_function
begin_function
DECL|function|insertItemsWithSorting_data
name|void
name|tst_QTreeWidget
operator|::
name|insertItemsWithSorting_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"sortOrder"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"initialItems"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"insertItems"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"expectedItems"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|IntList
argument_list|>
argument_list|(
literal|"expectedRows"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"() + (a) = (a)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
name|QStringList
argument_list|()
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|)
operator|<<
name|IntList
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"() + (c, b, a) = (a, b, c)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
name|QStringList
argument_list|()
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"c"
operator|<<
literal|"b"
operator|<<
literal|"a"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"b"
operator|<<
literal|"c"
operator|)
operator|<<
name|IntList
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"() + (a, b, c) = (c, b, a)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|DescendingOrder
argument_list|)
operator|<<
name|QStringList
argument_list|()
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"b"
operator|<<
literal|"c"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"c"
operator|<<
literal|"b"
operator|<<
literal|"a"
operator|)
operator|<<
name|IntList
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(a) + (b) = (a, b)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
name|QStringList
argument_list|(
literal|"a"
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"b"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"b"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(a) + (b) = (b, a)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|DescendingOrder
argument_list|)
operator|<<
name|QStringList
argument_list|(
literal|"a"
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"b"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"b"
operator|<<
literal|"a"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(a, c, b) + (d) = (a, b, c, d)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"b"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"d"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"b"
operator|<<
literal|"c"
operator|<<
literal|"d"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|2
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(b, c, a) + (d) = (d, c, b, a)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|DescendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"b"
operator|<<
literal|"c"
operator|<<
literal|"a"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"d"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"d"
operator|<<
literal|"c"
operator|<<
literal|"b"
operator|<<
literal|"a"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|<<
literal|2
operator|<<
literal|3
operator|)
expr_stmt|;
block|{
name|IntList
name|ascendingRows
decl_stmt|;
name|IntList
name|reverseRows
decl_stmt|;
name|QStringList
name|ascendingItems
decl_stmt|;
name|QStringList
name|reverseItems
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|'a'
init|;
name|i
operator|<=
literal|'z'
condition|;
operator|++
name|i
control|)
block|{
name|ascendingItems
operator|<<
name|QString
argument_list|(
literal|"%0"
argument_list|)
operator|.
name|arg
argument_list|(
name|QLatin1Char
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|reverseItems
operator|<<
name|QString
argument_list|(
literal|"%0"
argument_list|)
operator|.
name|arg
argument_list|(
name|QLatin1Char
argument_list|(
literal|'z'
operator|-
name|i
operator|+
literal|'a'
argument_list|)
argument_list|)
expr_stmt|;
name|ascendingRows
operator|<<
name|i
operator|-
literal|'a'
expr_stmt|;
name|reverseRows
operator|<<
literal|'z'
operator|-
name|i
operator|+
literal|'a'
expr_stmt|;
block|}
name|QTest
operator|::
name|newRow
argument_list|(
literal|"() + (sorted items) = (sorted items)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
name|QStringList
argument_list|()
operator|<<
name|ascendingItems
operator|<<
name|ascendingItems
operator|<<
name|IntList
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(sorted items) + () = (sorted items)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
name|ascendingItems
operator|<<
name|QStringList
argument_list|()
operator|<<
name|ascendingItems
operator|<<
name|ascendingRows
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"() + (ascending items) = (reverse items)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|DescendingOrder
argument_list|)
operator|<<
name|QStringList
argument_list|()
operator|<<
name|ascendingItems
operator|<<
name|reverseItems
operator|<<
name|IntList
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(reverse items) + () = (ascending items)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
name|reverseItems
operator|<<
name|QStringList
argument_list|()
operator|<<
name|ascendingItems
operator|<<
name|ascendingRows
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(reverse items) + () = (reverse items)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|DescendingOrder
argument_list|)
operator|<<
name|reverseItems
operator|<<
name|QStringList
argument_list|()
operator|<<
name|reverseItems
operator|<<
name|ascendingRows
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|insertItemsWithSorting
name|void
name|tst_QTreeWidget
operator|::
name|insertItemsWithSorting
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|sortOrder
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|initialItems
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|insertItems
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|expectedItems
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|IntList
argument_list|,
name|expectedRows
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|method
init|=
literal|0
init|;
name|method
operator|<
literal|5
condition|;
operator|++
name|method
control|)
block|{
name|QTreeWidget
name|w
decl_stmt|;
name|w
operator|.
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|w
operator|.
name|sortItems
argument_list|(
literal|0
argument_list|,
cast|static_cast
argument_list|<
name|Qt
operator|::
name|SortOrder
argument_list|>
argument_list|(
name|sortOrder
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|initialItems
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
name|w
operator|.
name|addTopLevelItem
argument_list|(
operator|new
name|QTreeWidgetItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
name|initialItems
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QAbstractItemModel
modifier|*
name|model
init|=
name|w
operator|.
name|model
argument_list|()
decl_stmt|;
name|QList
argument_list|<
name|QPersistentModelIndex
argument_list|>
name|persistent
decl_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|model
operator|->
name|rowCount
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
condition|;
operator|++
name|j
control|)
name|persistent
operator|<<
name|model
operator|->
name|index
argument_list|(
name|j
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|method
condition|)
block|{
case|case
literal|0
case|:
comment|// insert using item constructor
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|insertItems
operator|.
name|size
argument_list|()
condition|;
operator|++
name|i
control|)
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|w
argument_list|,
name|QStringList
argument_list|()
operator|<<
name|insertItems
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
block|{
comment|// insert using insertTopLevelItems()
name|QList
argument_list|<
name|QTreeWidgetItem
modifier|*
argument_list|>
name|lst
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|insertItems
operator|.
name|size
argument_list|()
condition|;
operator|++
name|i
control|)
name|lst
operator|<<
operator|new
name|QTreeWidgetItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
name|insertItems
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|w
operator|.
name|insertTopLevelItems
argument_list|(
literal|0
argument_list|,
name|lst
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
comment|// insert using insertTopLevelItem()
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|insertItems
operator|.
name|size
argument_list|()
condition|;
operator|++
name|i
control|)
name|w
operator|.
name|insertTopLevelItem
argument_list|(
literal|0
argument_list|,
operator|new
name|QTreeWidgetItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
name|insertItems
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
block|{
comment|// insert using addTopLevelItems()
name|QList
argument_list|<
name|QTreeWidgetItem
modifier|*
argument_list|>
name|lst
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|insertItems
operator|.
name|size
argument_list|()
condition|;
operator|++
name|i
control|)
name|lst
operator|<<
operator|new
name|QTreeWidgetItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
name|insertItems
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|w
operator|.
name|addTopLevelItems
argument_list|(
name|lst
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
comment|// insert using addTopLevelItem()
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|insertItems
operator|.
name|size
argument_list|()
condition|;
operator|++
name|i
control|)
name|w
operator|.
name|addTopLevelItem
argument_list|(
operator|new
name|QTreeWidgetItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
name|insertItems
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|QCOMPARE
argument_list|(
name|w
operator|.
name|topLevelItemCount
argument_list|()
argument_list|,
name|expectedItems
operator|.
name|count
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|w
operator|.
name|topLevelItemCount
argument_list|()
condition|;
operator|++
name|i
control|)
name|QCOMPARE
argument_list|(
name|w
operator|.
name|topLevelItem
argument_list|(
name|i
argument_list|)
operator|->
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|expectedItems
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|k
init|=
literal|0
init|;
name|k
operator|<
name|persistent
operator|.
name|count
argument_list|()
condition|;
operator|++
name|k
control|)
name|QCOMPARE
argument_list|(
name|persistent
operator|.
name|at
argument_list|(
name|k
argument_list|)
operator|.
name|row
argument_list|()
argument_list|,
name|expectedRows
operator|.
name|at
argument_list|(
name|k
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|insertExpandedItemsWithSorting_data
name|void
name|tst_QTreeWidget
operator|::
name|insertExpandedItemsWithSorting_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"parentText"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"childText"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"parentResult"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"childResult"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"test 1"
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"c"
operator|<<
literal|"d"
operator|<<
literal|"a"
operator|<<
literal|"b"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"e"
operator|<<
literal|"h"
operator|<<
literal|"g"
operator|<<
literal|"f"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"d"
operator|<<
literal|"c"
operator|<<
literal|"b"
operator|<<
literal|"a"
operator|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"h"
operator|<<
literal|"g"
operator|<<
literal|"f"
operator|<<
literal|"e"
operator|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// From Task 134978
end_comment
begin_function
DECL|function|insertExpandedItemsWithSorting
name|void
name|tst_QTreeWidget
operator|::
name|insertExpandedItemsWithSorting
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|parentText
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|childText
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|parentResult
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|childResult
argument_list|)
expr_stmt|;
comment|// create a tree with autosorting enabled
name|CustomTreeWidget
name|tree
decl_stmt|;
name|tree
operator|.
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
comment|// insert expanded items in unsorted order
name|QList
argument_list|<
name|QTreeWidgetItem
modifier|*
argument_list|>
name|items
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|parentText
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|parent
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|tree
argument_list|,
name|QStringList
argument_list|(
name|parentText
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|parent
operator|->
name|setExpanded
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isExpanded
argument_list|()
argument_list|)
expr_stmt|;
name|items
operator|<<
name|parent
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|childText
operator|.
name|count
argument_list|()
condition|;
operator|++
name|j
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|child
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|parent
argument_list|,
name|QStringList
argument_list|(
name|childText
operator|.
name|at
argument_list|(
name|j
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|items
operator|<<
name|child
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|childCount
argument_list|()
argument_list|,
name|childText
operator|.
name|count
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isExpanded
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|QVERIFY
argument_list|(
name|tree
operator|.
name|model
argument_list|()
operator|->
name|rowCount
argument_list|()
operator|==
name|parentText
operator|.
name|count
argument_list|()
argument_list|)
expr_stmt|;
comment|// verify that the items are still expanded
foreach|foreach
control|(
name|QTreeWidgetItem
modifier|*
name|item
decl|,
name|items
control|)
block|{
if|if
condition|(
name|item
operator|->
name|childCount
argument_list|()
operator|>
literal|0
condition|)
name|QVERIFY
argument_list|(
name|item
operator|->
name|isExpanded
argument_list|()
argument_list|)
expr_stmt|;
name|QModelIndex
name|idx
init|=
name|tree
operator|.
name|indexFromItem
argument_list|(
cast|const_cast
argument_list|<
name|QTreeWidgetItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|idx
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
comment|//QRect rect = tree.visualRect(idx);
comment|//QVERIFY(rect.isValid());
comment|// ### it is not guarantied that the index is in the viewport
block|}
comment|// verify that the tree is sorted
name|QAbstractItemModel
modifier|*
name|model
init|=
name|tree
operator|.
name|model
argument_list|()
decl_stmt|;
name|QList
argument_list|<
name|QPersistentModelIndex
argument_list|>
name|parents
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|model
operator|->
name|rowCount
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
condition|;
operator|++
name|i
control|)
block|{
name|QPersistentModelIndex
name|parent
init|=
name|model
operator|->
name|index
argument_list|(
name|i
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
decl_stmt|;
name|parents
operator|<<
name|parent
expr_stmt|;
block|}
name|QList
argument_list|<
name|QPersistentModelIndex
argument_list|>
name|children
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|model
operator|->
name|rowCount
argument_list|(
name|parents
operator|.
name|first
argument_list|()
argument_list|)
condition|;
operator|++
name|i
control|)
block|{
name|QPersistentModelIndex
name|child
init|=
name|model
operator|->
name|index
argument_list|(
name|i
argument_list|,
literal|0
argument_list|,
name|parents
operator|.
name|first
argument_list|()
argument_list|)
decl_stmt|;
name|children
operator|<<
name|child
expr_stmt|;
block|}
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|parentResult
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|item
init|=
name|tree
operator|.
name|topLevelItem
argument_list|(
name|i
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|parentResult
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|childResult
operator|.
name|count
argument_list|()
condition|;
operator|++
name|j
control|)
name|QCOMPARE
argument_list|(
name|item
operator|->
name|child
argument_list|(
name|j
argument_list|)
operator|->
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|childResult
operator|.
name|at
argument_list|(
name|j
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|changeDataWithSorting_data
name|void
name|tst_QTreeWidget
operator|::
name|changeDataWithSorting_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"sortOrder"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"initialItems"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"itemIndex"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QString
argument_list|>
argument_list|(
literal|"newValue"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"expectedItems"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|IntList
argument_list|>
argument_list|(
literal|"expectedRows"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"reorderingExpected"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change a to b in (a)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|)
operator|<<
literal|0
operator|<<
literal|"b"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"b"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|)
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change a to b in (a, c)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|)
operator|<<
literal|0
operator|<<
literal|"b"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"b"
operator|<<
literal|"c"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|)
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change a to c in (a, b)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"b"
operator|)
operator|<<
literal|0
operator|<<
literal|"c"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"b"
operator|<<
literal|"c"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|<<
literal|0
operator|)
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change c to a in (c, b)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|DescendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"c"
operator|<<
literal|"b"
operator|)
operator|<<
literal|0
operator|<<
literal|"a"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"b"
operator|<<
literal|"a"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|<<
literal|0
operator|)
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change e to i in (a, c, e, g)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|<<
literal|"g"
operator|)
operator|<<
literal|2
operator|<<
literal|"i"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"g"
operator|<<
literal|"i"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|3
operator|<<
literal|2
operator|)
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change e to a in (c, e, g, i)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|<<
literal|"g"
operator|<<
literal|"i"
operator|)
operator|<<
literal|1
operator|<<
literal|"a"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"g"
operator|<<
literal|"i"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|1
operator|<<
literal|0
operator|<<
literal|2
operator|<<
literal|3
operator|)
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change e to f in (c, e, g, i)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|<<
literal|"g"
operator|<<
literal|"i"
operator|)
operator|<<
literal|1
operator|<<
literal|"f"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"c"
operator|<<
literal|"f"
operator|<<
literal|"g"
operator|<<
literal|"i"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|2
operator|<<
literal|3
operator|)
operator|<<
literal|false
expr_stmt|;
block|}
end_function
begin_function
DECL|function|changeDataWithSorting
name|void
name|tst_QTreeWidget
operator|::
name|changeDataWithSorting
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|sortOrder
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|initialItems
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|itemIndex
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QString
argument_list|,
name|newValue
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|expectedItems
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|IntList
argument_list|,
name|expectedRows
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|reorderingExpected
argument_list|)
expr_stmt|;
name|QTreeWidget
name|w
decl_stmt|;
name|w
operator|.
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|w
operator|.
name|sortItems
argument_list|(
literal|0
argument_list|,
cast|static_cast
argument_list|<
name|Qt
operator|::
name|SortOrder
argument_list|>
argument_list|(
name|sortOrder
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|initialItems
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
name|w
operator|.
name|addTopLevelItem
argument_list|(
operator|new
name|QTreeWidgetItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
name|initialItems
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QAbstractItemModel
modifier|*
name|model
init|=
name|w
operator|.
name|model
argument_list|()
decl_stmt|;
name|QList
argument_list|<
name|QPersistentModelIndex
argument_list|>
name|persistent
decl_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|model
operator|->
name|rowCount
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
condition|;
operator|++
name|j
control|)
name|persistent
operator|<<
name|model
operator|->
name|index
argument_list|(
name|j
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QSignalSpy
name|dataChangedSpy
argument_list|(
name|model
argument_list|,
name|SIGNAL
argument_list|(
name|dataChanged
argument_list|(
name|QModelIndex
argument_list|,
name|QModelIndex
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QSignalSpy
name|layoutChangedSpy
argument_list|(
name|model
argument_list|,
name|SIGNAL
argument_list|(
name|layoutChanged
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|item
init|=
name|w
operator|.
name|topLevelItem
argument_list|(
name|itemIndex
argument_list|)
decl_stmt|;
name|item
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
name|newValue
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|expectedItems
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QCOMPARE
argument_list|(
name|w
operator|.
name|topLevelItem
argument_list|(
name|i
argument_list|)
operator|->
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|expectedItems
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|persistent
operator|.
name|count
argument_list|()
condition|;
operator|++
name|j
control|)
block|{
if|if
condition|(
name|persistent
operator|.
name|at
argument_list|(
name|j
argument_list|)
operator|.
name|row
argument_list|()
operator|==
name|i
condition|)
comment|// the same toplevel row
name|QCOMPARE
argument_list|(
name|persistent
operator|.
name|at
argument_list|(
name|j
argument_list|)
operator|.
name|internalPointer
argument_list|()
argument_list|,
operator|(
name|void
operator|*
operator|)
name|w
operator|.
name|topLevelItem
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|int
name|k
init|=
literal|0
init|;
name|k
operator|<
name|persistent
operator|.
name|count
argument_list|()
condition|;
operator|++
name|k
control|)
name|QCOMPARE
argument_list|(
name|persistent
operator|.
name|at
argument_list|(
name|k
argument_list|)
operator|.
name|row
argument_list|()
argument_list|,
name|expectedRows
operator|.
name|at
argument_list|(
name|k
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dataChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|layoutChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
name|reorderingExpected
condition|?
literal|1
else|:
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|changeDataWithStableSorting_data
name|void
name|tst_QTreeWidget
operator|::
name|changeDataWithStableSorting_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"sortOrder"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"initialItems"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"itemIndex"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QString
argument_list|>
argument_list|(
literal|"newValue"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"expectedItems"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|IntList
argument_list|>
argument_list|(
literal|"expectedRows"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"reorderingExpected"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"forceChange"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change a to c in (a, c, c, c, e)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
literal|0
operator|<<
literal|"c"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|2
operator|<<
literal|3
operator|<<
literal|4
operator|)
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change e to c in (a, c, c, c, e)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
literal|4
operator|<<
literal|"c"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|2
operator|<<
literal|3
operator|<<
literal|4
operator|)
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change 1st c to c in (a, c, c, c, e)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
literal|1
operator|<<
literal|"c"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|2
operator|<<
literal|3
operator|<<
literal|4
operator|)
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change 2nd c to c in (a, c, c, c, e)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
literal|2
operator|<<
literal|"c"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|2
operator|<<
literal|3
operator|<<
literal|4
operator|)
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change 3rd c to c in (a, c, c, c, e)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
literal|3
operator|<<
literal|"c"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|2
operator|<<
literal|3
operator|<<
literal|4
operator|)
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change 1st c to c in (e, c, c, c, a)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|DescendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"e"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"a"
operator|)
operator|<<
literal|1
operator|<<
literal|"c"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"e"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"a"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|2
operator|<<
literal|3
operator|<<
literal|4
operator|)
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change 2nd c to c in (e, c, c, c, a)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|DescendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"e"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"a"
operator|)
operator|<<
literal|2
operator|<<
literal|"c"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"e"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"a"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|2
operator|<<
literal|3
operator|<<
literal|4
operator|)
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change 3rd c to c in (e, c, c, c, a)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|DescendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"e"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"a"
operator|)
operator|<<
literal|3
operator|<<
literal|"c"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"e"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"a"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|2
operator|<<
literal|3
operator|<<
literal|4
operator|)
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change 1st c to b in (a, c, c, c, e)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
literal|1
operator|<<
literal|"b"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"b"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|2
operator|<<
literal|3
operator|<<
literal|4
operator|)
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change 2nd c to b in (a, c, c, c, e)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
literal|2
operator|<<
literal|"b"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"b"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|2
operator|<<
literal|1
operator|<<
literal|3
operator|<<
literal|4
operator|)
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change 3rd c to b in (a, c, c, c, e)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
literal|3
operator|<<
literal|"b"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"b"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|2
operator|<<
literal|3
operator|<<
literal|1
operator|<<
literal|4
operator|)
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change 1st c to d in (a, c, c, c, e)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
literal|1
operator|<<
literal|"d"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"d"
operator|<<
literal|"e"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|3
operator|<<
literal|1
operator|<<
literal|2
operator|<<
literal|4
operator|)
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change 2nd c to d in (a, c, c, c, e)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
literal|2
operator|<<
literal|"d"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"d"
operator|<<
literal|"e"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|3
operator|<<
literal|2
operator|<<
literal|4
operator|)
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"change 3rd c to d in (a, c, c, c, e)"
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"e"
operator|)
operator|<<
literal|3
operator|<<
literal|"d"
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"a"
operator|<<
literal|"c"
operator|<<
literal|"c"
operator|<<
literal|"d"
operator|<<
literal|"e"
operator|)
operator|<<
operator|(
name|IntList
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|2
operator|<<
literal|3
operator|<<
literal|4
operator|)
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
block|}
end_function
begin_function
DECL|function|changeDataWithStableSorting
name|void
name|tst_QTreeWidget
operator|::
name|changeDataWithStableSorting
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|sortOrder
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|initialItems
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|itemIndex
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QString
argument_list|,
name|newValue
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|expectedItems
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|IntList
argument_list|,
name|expectedRows
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|reorderingExpected
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|forceChange
argument_list|)
expr_stmt|;
class|class
name|StableItem
super|:
specifier|public
name|QTreeWidgetItem
block|{
public|public:
name|StableItem
parameter_list|(
specifier|const
name|QStringList
modifier|&
name|strings
parameter_list|)
member_init_list|:
name|QTreeWidgetItem
argument_list|(
name|strings
argument_list|,
name|QTreeWidgetItem
operator|::
name|UserType
argument_list|)
block|{}
name|void
name|forceChangeData
parameter_list|()
block|{
name|emitDataChanged
argument_list|()
expr_stmt|;
block|}
block|}
class|;
name|QTreeWidget
name|w
decl_stmt|;
name|w
operator|.
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|w
operator|.
name|sortItems
argument_list|(
literal|0
argument_list|,
cast|static_cast
argument_list|<
name|Qt
operator|::
name|SortOrder
argument_list|>
argument_list|(
name|sortOrder
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|initialItems
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
name|w
operator|.
name|addTopLevelItem
argument_list|(
operator|new
name|StableItem
argument_list|(
name|QStringList
argument_list|()
operator|<<
name|initialItems
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QAbstractItemModel
modifier|*
name|model
init|=
name|w
operator|.
name|model
argument_list|()
decl_stmt|;
name|QList
argument_list|<
name|QPersistentModelIndex
argument_list|>
name|persistent
decl_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|model
operator|->
name|rowCount
argument_list|(
name|QModelIndex
argument_list|()
argument_list|)
condition|;
operator|++
name|j
control|)
name|persistent
operator|<<
name|model
operator|->
name|index
argument_list|(
name|j
argument_list|,
literal|0
argument_list|,
name|QModelIndex
argument_list|()
argument_list|)
expr_stmt|;
name|QSignalSpy
name|dataChangedSpy
argument_list|(
name|model
argument_list|,
name|SIGNAL
argument_list|(
name|dataChanged
argument_list|(
name|QModelIndex
argument_list|,
name|QModelIndex
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QSignalSpy
name|layoutChangedSpy
argument_list|(
name|model
argument_list|,
name|SIGNAL
argument_list|(
name|layoutChanged
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|StableItem
modifier|*
name|item
init|=
cast|static_cast
argument_list|<
name|StableItem
operator|*
argument_list|>
argument_list|(
name|w
operator|.
name|topLevelItem
argument_list|(
name|itemIndex
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
name|newValue
argument_list|)
expr_stmt|;
if|if
condition|(
name|forceChange
condition|)
name|item
operator|->
name|forceChangeData
argument_list|()
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|expectedItems
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QCOMPARE
argument_list|(
name|w
operator|.
name|topLevelItem
argument_list|(
name|i
argument_list|)
operator|->
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|expectedItems
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|persistent
operator|.
name|count
argument_list|()
condition|;
operator|++
name|j
control|)
block|{
if|if
condition|(
name|persistent
operator|.
name|at
argument_list|(
name|j
argument_list|)
operator|.
name|row
argument_list|()
operator|==
name|i
condition|)
comment|// the same toplevel row
name|QCOMPARE
argument_list|(
name|persistent
operator|.
name|at
argument_list|(
name|j
argument_list|)
operator|.
name|internalPointer
argument_list|()
argument_list|,
operator|(
name|void
operator|*
operator|)
name|w
operator|.
name|topLevelItem
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|int
name|k
init|=
literal|0
init|;
name|k
operator|<
name|persistent
operator|.
name|count
argument_list|()
condition|;
operator|++
name|k
control|)
name|QCOMPARE
argument_list|(
name|persistent
operator|.
name|at
argument_list|(
name|k
argument_list|)
operator|.
name|row
argument_list|()
argument_list|,
name|expectedRows
operator|.
name|at
argument_list|(
name|k
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dataChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|layoutChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
name|reorderingExpected
condition|?
literal|1
else|:
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemOperatorLessThan
name|void
name|tst_QTreeWidget
operator|::
name|itemOperatorLessThan
parameter_list|()
block|{
name|QTreeWidget
name|tw
decl_stmt|;
name|tw
operator|.
name|setColumnCount
argument_list|(
literal|2
argument_list|)
expr_stmt|;
block|{
name|QTreeWidgetItem
name|item1
argument_list|(
operator|&
name|tw
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
name|item2
argument_list|(
operator|&
name|tw
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|<
name|item2
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|item1
operator|.
name|setText
argument_list|(
literal|1
argument_list|,
literal|"a"
argument_list|)
expr_stmt|;
name|item2
operator|.
name|setText
argument_list|(
literal|1
argument_list|,
literal|"b"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|<
name|item2
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|item1
operator|.
name|setText
argument_list|(
literal|0
argument_list|,
literal|"a"
argument_list|)
expr_stmt|;
name|item2
operator|.
name|setText
argument_list|(
literal|0
argument_list|,
literal|"b"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|<
name|item2
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|tw
operator|.
name|sortItems
argument_list|(
literal|1
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
expr_stmt|;
name|item1
operator|.
name|setText
argument_list|(
literal|0
argument_list|,
literal|"b"
argument_list|)
expr_stmt|;
name|item2
operator|.
name|setText
argument_list|(
literal|0
argument_list|,
literal|"a"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|<
name|item2
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|tw
operator|.
name|sortItems
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
expr_stmt|;
name|item1
operator|.
name|setData
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|,
literal|11
argument_list|)
expr_stmt|;
name|item2
operator|.
name|setData
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|DisplayRole
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|<
name|item2
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|sortedIndexOfChild_data
name|void
name|tst_QTreeWidget
operator|::
name|sortedIndexOfChild_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"sortOrder"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QStringList
argument_list|>
argument_list|(
literal|"itemTexts"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QList
argument_list|<
name|int
argument_list|>
argument_list|>
argument_list|(
literal|"expectedIndexes"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"three ascending"
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|AscendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"A"
operator|<<
literal|"B"
operator|<<
literal|"C"
operator|)
operator|<<
operator|(
name|QList
argument_list|<
name|int
argument_list|>
argument_list|()
operator|<<
literal|0
operator|<<
literal|1
operator|<<
literal|2
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"three descending"
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|DescendingOrder
argument_list|)
operator|<<
operator|(
name|QStringList
argument_list|()
operator|<<
literal|"A"
operator|<<
literal|"B"
operator|<<
literal|"C"
operator|)
operator|<<
operator|(
name|QList
argument_list|<
name|int
argument_list|>
argument_list|()
operator|<<
literal|2
operator|<<
literal|1
operator|<<
literal|0
operator|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sortedIndexOfChild
name|void
name|tst_QTreeWidget
operator|::
name|sortedIndexOfChild
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|sortOrder
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QStringList
argument_list|,
name|itemTexts
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QList
argument_list|<
name|int
argument_list|>
argument_list|,
name|expectedIndexes
argument_list|)
expr_stmt|;
name|QTreeWidget
name|tw
decl_stmt|;
name|QList
argument_list|<
name|QTreeWidgetItem
modifier|*
argument_list|>
name|itms
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|top
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|tw
argument_list|,
name|QStringList
argument_list|()
operator|<<
literal|"top"
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|itemTexts
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
name|itms
operator|<<
operator|new
name|QTreeWidgetItem
argument_list|(
name|top
argument_list|,
name|QStringList
argument_list|()
operator|<<
name|itemTexts
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|tw
operator|.
name|sortItems
argument_list|(
literal|0
argument_list|,
operator|(
name|Qt
operator|::
name|SortOrder
operator|)
name|sortOrder
argument_list|)
expr_stmt|;
name|tw
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|itms
operator|.
name|count
argument_list|()
operator|==
name|expectedIndexes
operator|.
name|count
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|expectedIndexes
operator|.
name|count
argument_list|()
condition|;
operator|++
name|j
control|)
name|QCOMPARE
argument_list|(
name|top
operator|->
name|indexOfChild
argument_list|(
name|itms
operator|.
name|at
argument_list|(
name|j
argument_list|)
argument_list|)
argument_list|,
name|expectedIndexes
operator|.
name|at
argument_list|(
name|j
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|expandAndCallapse
name|void
name|tst_QTreeWidget
operator|::
name|expandAndCallapse
parameter_list|()
block|{
name|QTreeWidget
name|tw
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|top
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|tw
argument_list|,
name|QStringList
argument_list|()
operator|<<
literal|"top"
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|p
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
operator|++
name|i
control|)
block|{
name|p
operator|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|top
argument_list|,
name|QStringList
argument_list|()
operator|<<
name|QString
argument_list|(
literal|"%1"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
literal|10
condition|;
operator|++
name|j
control|)
operator|new
name|QTreeWidgetItem
argument_list|(
name|p
argument_list|,
name|QStringList
argument_list|()
operator|<<
name|QString
argument_list|(
literal|"%1"
argument_list|)
operator|.
name|arg
argument_list|(
name|j
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|QSignalSpy
name|spy0
argument_list|(
operator|&
name|tw
argument_list|,
name|SIGNAL
argument_list|(
name|itemExpanded
argument_list|(
name|QTreeWidgetItem
operator|*
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QSignalSpy
name|spy1
argument_list|(
operator|&
name|tw
argument_list|,
name|SIGNAL
argument_list|(
name|itemCollapsed
argument_list|(
name|QTreeWidgetItem
operator|*
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|tw
operator|.
name|expandItem
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|tw
operator|.
name|collapseItem
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|tw
operator|.
name|expandItem
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|tw
operator|.
name|expandItem
argument_list|(
name|top
argument_list|)
expr_stmt|;
name|tw
operator|.
name|collapseItem
argument_list|(
name|top
argument_list|)
expr_stmt|;
name|tw
operator|.
name|collapseItem
argument_list|(
name|top
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy0
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy1
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setDisabled
name|void
name|tst_QTreeWidget
operator|::
name|setDisabled
parameter_list|()
block|{
name|QTreeWidget
name|w
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|i1
init|=
operator|new
name|QTreeWidgetItem
argument_list|()
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|i2
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|i1
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|i3
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|i1
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|top
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|w
argument_list|)
decl_stmt|;
name|top
operator|->
name|setDisabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|top
operator|->
name|addChild
argument_list|(
name|i1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i1
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i2
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i3
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|i1
operator|=
name|top
operator|->
name|takeChild
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i1
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i2
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i3
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|top
operator|->
name|addChild
argument_list|(
name|i1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i1
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i2
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i3
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|top
operator|->
name|setDisabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i1
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i2
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i3
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QTreeWidgetItem
modifier|*
argument_list|>
name|children
decl_stmt|;
name|children
operator|.
name|append
argument_list|(
operator|new
name|QTreeWidgetItem
argument_list|()
argument_list|)
expr_stmt|;
name|children
operator|.
name|append
argument_list|(
operator|new
name|QTreeWidgetItem
argument_list|()
argument_list|)
expr_stmt|;
name|children
operator|.
name|append
argument_list|(
operator|new
name|QTreeWidgetItem
argument_list|()
argument_list|)
expr_stmt|;
name|i1
operator|=
name|top
operator|->
name|takeChild
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|top
operator|->
name|addChildren
argument_list|(
name|children
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|top
operator|->
name|child
argument_list|(
literal|0
argument_list|)
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|top
operator|->
name|child
argument_list|(
literal|1
argument_list|)
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|top
operator|->
name|child
argument_list|(
literal|1
argument_list|)
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|top
operator|->
name|setDisabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|top
operator|->
name|child
argument_list|(
literal|0
argument_list|)
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|top
operator|->
name|child
argument_list|(
literal|1
argument_list|)
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|top
operator|->
name|child
argument_list|(
literal|1
argument_list|)
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|children
operator|=
name|top
operator|->
name|takeChildren
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|children
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|children
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|children
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|->
name|isDisabled
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|removeSelectedItem
name|void
name|tst_QTreeWidget
operator|::
name|removeSelectedItem
parameter_list|()
block|{
name|QTreeWidget
modifier|*
name|w
init|=
operator|new
name|QTreeWidget
argument_list|()
decl_stmt|;
name|w
operator|->
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|first
init|=
operator|new
name|QTreeWidgetItem
argument_list|()
decl_stmt|;
name|first
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
name|QLatin1String
argument_list|(
literal|"D"
argument_list|)
argument_list|)
expr_stmt|;
name|w
operator|->
name|addTopLevelItem
argument_list|(
name|first
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|itm
init|=
operator|new
name|QTreeWidgetItem
argument_list|()
decl_stmt|;
name|itm
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
name|QLatin1String
argument_list|(
literal|"D"
argument_list|)
argument_list|)
expr_stmt|;
name|w
operator|->
name|addTopLevelItem
argument_list|(
name|itm
argument_list|)
expr_stmt|;
name|itm
operator|=
operator|new
name|QTreeWidgetItem
argument_list|()
expr_stmt|;
name|itm
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
name|QLatin1String
argument_list|(
literal|"C"
argument_list|)
argument_list|)
expr_stmt|;
name|w
operator|->
name|addTopLevelItem
argument_list|(
name|itm
argument_list|)
expr_stmt|;
name|itm
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|itm
operator|=
operator|new
name|QTreeWidgetItem
argument_list|()
expr_stmt|;
name|itm
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
name|QLatin1String
argument_list|(
literal|"A"
argument_list|)
argument_list|)
expr_stmt|;
name|w
operator|->
name|addTopLevelItem
argument_list|(
name|itm
argument_list|)
expr_stmt|;
comment|//w->show();
name|QItemSelectionModel
modifier|*
name|selModel
init|=
name|w
operator|->
name|selectionModel
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|selModel
operator|->
name|hasSelection
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|selModel
operator|->
name|selectedRows
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|taken
init|=
name|w
operator|->
name|takeTopLevelItem
argument_list|(
literal|2
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|taken
operator|->
name|text
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QLatin1String
argument_list|(
literal|"C"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|selModel
operator|->
name|hasSelection
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|selModel
operator|->
name|selectedRows
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QItemSelection
name|sel
init|=
name|selModel
operator|->
name|selection
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|selModel
operator|->
name|isSelected
argument_list|(
name|w
operator|->
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
operator|delete
name|w
expr_stmt|;
block|}
end_function
begin_class
DECL|class|AnotherTreeWidget
class|class
name|AnotherTreeWidget
super|:
specifier|public
name|QTreeWidget
block|{
name|Q_OBJECT
public|public:
DECL|function|AnotherTreeWidget
name|AnotherTreeWidget
parameter_list|(
name|QWidget
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QTreeWidget
argument_list|(
name|parent
argument_list|)
block|{}
DECL|function|deleteCurrent
name|void
name|deleteCurrent
parameter_list|()
block|{
if|if
condition|(
name|currentItem
argument_list|()
condition|)
operator|delete
name|currentItem
argument_list|()
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|removeCurrentItem
name|void
name|tst_QTreeWidget
operator|::
name|removeCurrentItem
parameter_list|()
block|{
name|AnotherTreeWidget
name|widget
decl_stmt|;
name|QObject
operator|::
name|connect
argument_list|(
name|widget
operator|.
name|selectionModel
argument_list|()
argument_list|,
name|SIGNAL
argument_list|(
name|currentChanged
argument_list|(
name|QModelIndex
argument_list|,
name|QModelIndex
argument_list|)
argument_list|)
argument_list|,
operator|&
name|widget
argument_list|,
name|SLOT
argument_list|(
name|clear
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|widget
argument_list|)
decl_stmt|;
name|widget
operator|.
name|setCurrentItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|widget
operator|.
name|deleteCurrent
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|removeCurrentItem_task186451
name|void
name|tst_QTreeWidget
operator|::
name|removeCurrentItem_task186451
parameter_list|()
block|{
name|AnotherTreeWidget
name|widget
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|widget
argument_list|,
name|QStringList
argument_list|()
operator|<<
literal|"1"
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|item2
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|widget
argument_list|,
name|QStringList
argument_list|()
operator|<<
literal|"2"
argument_list|)
decl_stmt|;
name|widget
operator|.
name|setCurrentItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|widget
operator|.
name|deleteCurrent
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
argument_list|,
name|widget
operator|.
name|currentItem
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|TreeWidget
class|class
name|TreeWidget
super|:
name|QTreeWidget
block|{
public|public:
DECL|function|indexFromItem
name|QModelIndex
name|indexFromItem
parameter_list|(
name|QTreeWidgetItem
modifier|*
name|item
parameter_list|,
name|int
name|column
init|=
literal|0
parameter_list|)
specifier|const
block|{
return|return
name|QTreeWidget
operator|::
name|indexFromItem
argument_list|(
name|item
argument_list|,
name|column
argument_list|)
return|;
block|}
DECL|function|itemFromIndex
name|QTreeWidgetItem
modifier|*
name|itemFromIndex
parameter_list|(
specifier|const
name|QModelIndex
modifier|&
name|index
parameter_list|)
specifier|const
block|{
return|return
name|QTreeWidget
operator|::
name|itemFromIndex
argument_list|(
name|index
argument_list|)
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|randomExpand
name|void
name|tst_QTreeWidget
operator|::
name|randomExpand
parameter_list|()
block|{
name|QTreeWidget
name|tree
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|item1
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|tree
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|item3
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|tree
argument_list|,
name|item1
argument_list|)
decl_stmt|;
operator|new
name|QTreeWidgetItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
operator|new
name|QTreeWidgetItem
argument_list|(
name|item3
argument_list|)
expr_stmt|;
name|tree
operator|.
name|expandAll
argument_list|()
expr_stmt|;
comment|/*         item1          \- item2         item3          \- item4     */
name|QTreeWidgetItem
modifier|*
name|newItem1
init|=
literal|0
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|100
condition|;
name|i
operator|++
control|)
block|{
name|newItem1
operator|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|tree
argument_list|,
name|item1
argument_list|)
expr_stmt|;
name|tree
operator|.
name|setItemExpanded
argument_list|(
name|newItem1
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|isItemExpanded
argument_list|(
name|newItem1
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|x
init|=
operator|new
name|QTreeWidgetItem
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|isItemExpanded
argument_list|(
name|newItem1
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|newItem1
operator|->
name|addChild
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|isItemExpanded
argument_list|(
name|newItem1
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|crashTest
name|void
name|tst_QTreeWidget
operator|::
name|crashTest
parameter_list|()
block|{
name|QTreeWidget
modifier|*
name|tree
init|=
operator|new
name|QTreeWidget
argument_list|()
decl_stmt|;
name|tree
operator|->
name|setColumnCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|tree
operator|->
name|show
argument_list|()
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|item1
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|tree
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"item1"
argument_list|)
expr_stmt|;
name|tree
operator|->
name|setItemExpanded
argument_list|(
name|item1
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|item2
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|item1
argument_list|)
decl_stmt|;
name|item2
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"item2"
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|item3
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|tree
argument_list|,
name|item1
argument_list|)
decl_stmt|;
name|item3
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"item3"
argument_list|)
expr_stmt|;
name|tree
operator|->
name|setItemExpanded
argument_list|(
name|item3
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|item4
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|item3
argument_list|)
decl_stmt|;
name|item4
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"item4"
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|item5
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|tree
argument_list|,
name|item3
argument_list|)
decl_stmt|;
name|item5
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"item5"
argument_list|)
expr_stmt|;
name|tree
operator|->
name|setItemExpanded
argument_list|(
name|item5
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|item6
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|item5
argument_list|)
decl_stmt|;
name|item6
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"item6"
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|1000
condition|;
name|i
operator|++
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|newItem1
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|tree
argument_list|,
name|item1
argument_list|)
decl_stmt|;
name|newItem1
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"newItem"
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|newItem2
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|newItem1
argument_list|)
decl_stmt|;
name|newItem2
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"subItem1"
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|newItem3
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|newItem1
argument_list|,
name|newItem2
argument_list|)
decl_stmt|;
name|newItem3
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"subItem2"
argument_list|)
expr_stmt|;
operator|delete
name|item3
expr_stmt|;
name|item3
operator|=
name|newItem1
expr_stmt|;
block|}
name|QApplication
operator|::
name|instance
argument_list|()
operator|->
name|processEvents
argument_list|()
expr_stmt|;
operator|delete
name|tree
expr_stmt|;
block|}
end_function
begin_class
DECL|class|CrashWidget
class|class
name|CrashWidget
super|:
specifier|public
name|QTreeWidget
block|{
public|public:
DECL|function|CrashWidget
name|CrashWidget
parameter_list|(
name|QWidget
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QTreeWidget
argument_list|(
name|parent
argument_list|)
member_init_list|,
name|i
argument_list|(
literal|0
argument_list|)
block|{
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|timerId
operator|=
name|startTimer
argument_list|(
literal|10
argument_list|)
expr_stmt|;
block|}
DECL|member|i
name|int
name|i
decl_stmt|;
protected|protected:
DECL|function|timerEvent
name|void
name|timerEvent
parameter_list|(
name|QTimerEvent
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
name|event
operator|->
name|timerId
argument_list|()
operator|==
name|timerId
condition|)
block|{
name|QTreeWidgetItem
modifier|*
name|newItem
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|(
name|QStringList
argument_list|()
operator|<<
name|QString
operator|::
name|number
argument_list|(
name|i
operator|++
argument_list|)
operator|)
argument_list|)
decl_stmt|;
name|m_list
operator|.
name|append
argument_list|(
name|newItem
argument_list|)
expr_stmt|;
name|insertTopLevelItem
argument_list|(
literal|0
argument_list|,
name|newItem
argument_list|)
expr_stmt|;
while|while
condition|(
name|m_list
operator|.
name|count
argument_list|()
operator|>
literal|10
condition|)
operator|delete
name|m_list
operator|.
name|takeFirst
argument_list|()
expr_stmt|;
block|}
name|QTreeWidget
operator|::
name|timerEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
block|}
private|private:
DECL|member|timerId
name|int
name|timerId
decl_stmt|;
DECL|member|m_list
name|QList
argument_list|<
name|QTreeWidgetItem
modifier|*
argument_list|>
name|m_list
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|sortAndSelect
name|void
name|tst_QTreeWidget
operator|::
name|sortAndSelect
parameter_list|()
block|{
name|CrashWidget
name|w
decl_stmt|;
name|w
operator|.
name|resize
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|w
operator|.
name|show
argument_list|()
expr_stmt|;
while|while
condition|(
name|w
operator|.
name|i
operator|<
literal|100
condition|)
block|{
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
if|if
condition|(
name|w
operator|.
name|i
operator|&
literal|16
condition|)
block|{
name|QPoint
name|pt
init|=
name|w
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
decl_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|w
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|,
name|pt
argument_list|)
expr_stmt|;
block|}
block|}
name|QVERIFY
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|defaultRowSizes
name|void
name|tst_QTreeWidget
operator|::
name|defaultRowSizes
parameter_list|()
block|{
name|QTreeWidget
modifier|*
name|tw
init|=
operator|new
name|QTreeWidget
argument_list|()
decl_stmt|;
name|tw
operator|->
name|setIconSize
argument_list|(
name|QSize
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|tw
operator|->
name|setColumnCount
argument_list|(
literal|6
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
operator|++
name|i
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|it
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|tw
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|tw
operator|->
name|columnCount
argument_list|()
operator|-
literal|1
condition|;
operator|++
name|j
control|)
block|{
name|it
operator|->
name|setText
argument_list|(
name|j
argument_list|,
literal|"This is a test"
argument_list|)
expr_stmt|;
block|}
name|QPixmap
name|icon
init|=
name|tw
operator|->
name|style
argument_list|()
operator|->
name|standardPixmap
argument_list|(
call|(
name|QStyle
operator|::
name|StandardPixmap
call|)
argument_list|(
name|i
operator|+
name|QStyle
operator|::
name|SP_TitleBarMenuButton
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|icon
operator|.
name|isNull
argument_list|()
condition|)
name|QSKIP
argument_list|(
literal|"No pixmap found on current style, skipping this test."
argument_list|)
expr_stmt|;
name|it
operator|->
name|setIcon
argument_list|(
name|tw
operator|->
name|columnCount
argument_list|()
operator|-
literal|1
argument_list|,
name|icon
operator|.
name|scaled
argument_list|(
name|tw
operator|->
name|iconSize
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|tw
operator|->
name|resize
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|tw
operator|->
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QRect
name|visualRect
init|=
name|tw
operator|->
name|visualItemRect
argument_list|(
name|tw
operator|->
name|topLevelItem
argument_list|(
literal|0
argument_list|)
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|visualRect
operator|.
name|height
argument_list|()
operator|>=
literal|50
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task191552_rtl
name|void
name|tst_QTreeWidget
operator|::
name|task191552_rtl
parameter_list|()
block|{
name|Qt
operator|::
name|LayoutDirection
name|oldDir
init|=
name|qApp
operator|->
name|layoutDirection
argument_list|()
decl_stmt|;
name|qApp
operator|->
name|setLayoutDirection
argument_list|(
name|Qt
operator|::
name|RightToLeft
argument_list|)
expr_stmt|;
name|QTreeWidget
name|tw
decl_stmt|;
name|tw
operator|.
name|setColumnCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|tw
argument_list|)
decl_stmt|;
name|item
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"item 1"
argument_list|)
expr_stmt|;
name|item
operator|->
name|setCheckState
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Checked
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|checkState
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Checked
argument_list|)
expr_stmt|;
name|tw
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QStyleOptionViewItem
name|opt
decl_stmt|;
name|opt
operator|.
name|initFrom
argument_list|(
operator|&
name|tw
argument_list|)
expr_stmt|;
name|opt
operator|.
name|rect
operator|=
name|tw
operator|.
name|visualItemRect
argument_list|(
name|item
argument_list|)
expr_stmt|;
comment|// mimic QStyledItemDelegate::initStyleOption logic
name|opt
operator|.
name|features
operator|=
name|QStyleOptionViewItem
operator|::
name|HasDisplay
operator||
name|QStyleOptionViewItem
operator|::
name|HasCheckIndicator
expr_stmt|;
name|opt
operator|.
name|checkState
operator|=
name|Qt
operator|::
name|Checked
expr_stmt|;
name|opt
operator|.
name|widget
operator|=
operator|&
name|tw
expr_stmt|;
specifier|const
name|QRect
name|checkRect
init|=
name|tw
operator|.
name|style
argument_list|()
operator|->
name|subElementRect
argument_list|(
name|QStyle
operator|::
name|SE_ViewItemCheckIndicator
argument_list|,
operator|&
name|opt
argument_list|,
operator|&
name|tw
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|tw
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|,
name|checkRect
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|checkState
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|setLayoutDirection
argument_list|(
name|oldDir
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task203673_selection
name|void
name|tst_QTreeWidget
operator|::
name|task203673_selection
parameter_list|()
block|{
comment|//we try to change the selection by rightclick + ctrl
comment|//it should do anything when using ExtendedSelection
name|QTreeWidget
name|tw
decl_stmt|;
name|tw
operator|.
name|setColumnCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|item1
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|tw
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"item 1"
argument_list|)
expr_stmt|;
name|tw
operator|.
name|setSelectionMode
argument_list|(
name|QTreeView
operator|::
name|ExtendedSelection
argument_list|)
expr_stmt|;
name|QPoint
name|center
init|=
name|tw
operator|.
name|visualItemRect
argument_list|(
name|item1
argument_list|)
operator|.
name|center
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|tw
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|RightButton
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|,
name|center
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|tw
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|,
name|center
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|tw
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|RightButton
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|,
name|center
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
comment|//it shouldn't change
name|QTest
operator|::
name|mouseClick
argument_list|(
name|tw
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|,
name|center
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|rootItemFlags
name|void
name|tst_QTreeWidget
operator|::
name|rootItemFlags
parameter_list|()
block|{
name|QTreeWidget
name|tw
decl_stmt|;
name|tw
operator|.
name|setColumnCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|tw
argument_list|)
decl_stmt|;
name|item
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"item 1"
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|tw
operator|.
name|invisibleRootItem
argument_list|()
operator|->
name|flags
argument_list|()
operator|&
name|Qt
operator|::
name|ItemIsDropEnabled
argument_list|)
expr_stmt|;
name|tw
operator|.
name|invisibleRootItem
argument_list|()
operator|->
name|setFlags
argument_list|(
name|tw
operator|.
name|invisibleRootItem
argument_list|()
operator|->
name|flags
argument_list|()
operator|&
operator|~
name|Qt
operator|::
name|ItemIsDropEnabled
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
operator|(
name|tw
operator|.
name|invisibleRootItem
argument_list|()
operator|->
name|flags
argument_list|()
operator|&
name|Qt
operator|::
name|ItemIsDropEnabled
operator|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task218661_setHeaderData
name|void
name|tst_QTreeWidget
operator|::
name|task218661_setHeaderData
parameter_list|()
block|{
comment|//We check that setting header data out of bounds returns false
comment|//and doesn't increase the size of the model
name|QTreeWidget
name|tw
decl_stmt|;
name|tw
operator|.
name|setColumnCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tw
operator|.
name|columnCount
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tw
operator|.
name|model
argument_list|()
operator|->
name|setHeaderData
argument_list|(
literal|99999
argument_list|,
name|Qt
operator|::
name|Horizontal
argument_list|,
name|QVariant
argument_list|()
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tw
operator|.
name|columnCount
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task245280_sortChildren
name|void
name|tst_QTreeWidget
operator|::
name|task245280_sortChildren
parameter_list|()
block|{
name|QTreeWidget
name|tw
decl_stmt|;
name|tw
operator|.
name|setColumnCount
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
name|top
argument_list|(
operator|&
name|tw
argument_list|)
decl_stmt|;
name|top
operator|.
name|setText
argument_list|(
literal|0
argument_list|,
literal|"Col 0"
argument_list|)
expr_stmt|;
name|top
operator|.
name|setText
argument_list|(
literal|1
argument_list|,
literal|"Col 1"
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
name|item1
argument_list|(
operator|&
name|top
argument_list|)
decl_stmt|;
name|item1
operator|.
name|setText
argument_list|(
literal|0
argument_list|,
literal|"X"
argument_list|)
expr_stmt|;
name|item1
operator|.
name|setText
argument_list|(
literal|1
argument_list|,
literal|"0"
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
name|item2
argument_list|(
operator|&
name|top
argument_list|)
decl_stmt|;
name|item2
operator|.
name|setText
argument_list|(
literal|0
argument_list|,
literal|"A"
argument_list|)
expr_stmt|;
name|item2
operator|.
name|setText
argument_list|(
literal|1
argument_list|,
literal|"4"
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
name|item3
argument_list|(
operator|&
name|top
argument_list|)
decl_stmt|;
name|item3
operator|.
name|setText
argument_list|(
literal|0
argument_list|,
literal|"E"
argument_list|)
expr_stmt|;
name|item3
operator|.
name|setText
argument_list|(
literal|1
argument_list|,
literal|"1"
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
name|item4
argument_list|(
operator|&
name|top
argument_list|)
decl_stmt|;
name|item4
operator|.
name|setText
argument_list|(
literal|0
argument_list|,
literal|"Z"
argument_list|)
expr_stmt|;
name|item4
operator|.
name|setText
argument_list|(
literal|1
argument_list|,
literal|"3"
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
name|item5
argument_list|(
operator|&
name|top
argument_list|)
decl_stmt|;
name|item5
operator|.
name|setText
argument_list|(
literal|0
argument_list|,
literal|"U"
argument_list|)
expr_stmt|;
name|item5
operator|.
name|setText
argument_list|(
literal|1
argument_list|,
literal|"2"
argument_list|)
expr_stmt|;
name|tw
operator|.
name|expandAll
argument_list|()
expr_stmt|;
name|tw
operator|.
name|show
argument_list|()
expr_stmt|;
name|top
operator|.
name|sortChildren
argument_list|(
literal|1
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|top
operator|.
name|childCount
argument_list|()
condition|;
operator|++
name|i
control|)
name|QCOMPARE
argument_list|(
name|top
operator|.
name|child
argument_list|(
name|i
argument_list|)
operator|->
name|text
argument_list|(
literal|1
argument_list|)
argument_list|,
name|QString
operator|::
name|number
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task253109_itemHeight
name|void
name|tst_QTreeWidget
operator|::
name|task253109_itemHeight
parameter_list|()
block|{
name|QTreeWidget
name|treeWidget
decl_stmt|;
name|treeWidget
operator|.
name|setColumnCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|treeWidget
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
name|item
argument_list|(
operator|&
name|treeWidget
argument_list|)
decl_stmt|;
class|class
name|MyWidget
super|:
specifier|public
name|QWidget
block|{
specifier|virtual
name|QSize
name|sizeHint
parameter_list|()
specifier|const
block|{
return|return
name|QSize
argument_list|(
literal|200
argument_list|,
literal|100
argument_list|)
return|;
block|}
block|}
name|w
class|;
name|treeWidget
operator|.
name|setItemWidget
argument_list|(
operator|&
name|item
argument_list|,
literal|0
argument_list|,
operator|&
name|w
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|.
name|geometry
argument_list|()
argument_list|,
name|treeWidget
operator|.
name|visualItemRect
argument_list|(
operator|&
name|item
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task206367_duplication
name|void
name|tst_QTreeWidget
operator|::
name|task206367_duplication
parameter_list|()
block|{
name|QWidget
name|topLevel
decl_stmt|;
comment|// Explicitly set the font size because it is dpi dependent on some platforms
name|QFont
name|font
decl_stmt|;
name|font
operator|.
name|setPixelSize
argument_list|(
literal|40
argument_list|)
expr_stmt|;
name|topLevel
operator|.
name|setFont
argument_list|(
name|font
argument_list|)
expr_stmt|;
name|QTreeWidget
name|treeWidget
argument_list|(
operator|&
name|topLevel
argument_list|)
decl_stmt|;
name|topLevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|treeWidget
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|treeWidget
operator|.
name|setHeaderHidden
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|treeWidget
operator|.
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|rootItem
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|treeWidget
argument_list|,
name|QStringList
argument_list|(
literal|"root"
argument_list|)
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|nFile
init|=
literal|0
init|;
name|nFile
operator|<
literal|2
condition|;
name|nFile
operator|++
control|)
block|{
name|QTreeWidgetItem
modifier|*
name|itemFile
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|rootItem
argument_list|,
name|QStringList
argument_list|(
name|QString
operator|::
name|number
argument_list|(
name|nFile
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|nRecord
init|=
literal|0
init|;
name|nRecord
operator|<
literal|2
condition|;
name|nRecord
operator|++
control|)
operator|new
name|QTreeWidgetItem
argument_list|(
name|itemFile
argument_list|,
name|QStringList
argument_list|(
name|QString
operator|::
name|number
argument_list|(
name|nRecord
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|itemFile
operator|->
name|setExpanded
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
name|rootItem
operator|->
name|setExpanded
argument_list|(
literal|true
argument_list|)
expr_stmt|;
comment|//there should be enough room for 2x2 items.  If there is a scrollbar, it means the items are duplicated
name|QTRY_VERIFY
argument_list|(
operator|!
name|treeWidget
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemSelectionChanged
name|void
name|tst_QTreeWidget
operator|::
name|itemSelectionChanged
parameter_list|()
block|{
name|QVERIFY
argument_list|(
name|testWidget
argument_list|)
expr_stmt|;
if|if
condition|(
name|testWidget
operator|->
name|topLevelItem
argument_list|(
literal|0
argument_list|)
condition|)
name|QVERIFY
argument_list|(
name|testWidget
operator|->
name|topLevelItem
argument_list|(
literal|0
argument_list|)
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|selectionOrder
name|void
name|tst_QTreeWidget
operator|::
name|selectionOrder
parameter_list|()
block|{
name|testWidget
operator|->
name|setColumnCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QTreeWidgetItem
modifier|*
argument_list|>
name|items
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
operator|++
name|i
control|)
name|items
operator|.
name|append
argument_list|(
operator|new
name|QTreeWidgetItem
argument_list|(
operator|(
name|QTreeWidget
operator|*
operator|)
literal|0
argument_list|,
name|QStringList
argument_list|(
name|QString
argument_list|(
literal|"item: %1"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|insertTopLevelItems
argument_list|(
literal|0
argument_list|,
name|items
argument_list|)
expr_stmt|;
name|QModelIndex
name|idx
init|=
name|testWidget
operator|->
name|indexFromItem
argument_list|(
name|items
index|[
literal|0
index|]
argument_list|)
decl_stmt|;
name|connect
argument_list|(
name|testWidget
argument_list|,
name|SIGNAL
argument_list|(
name|itemSelectionChanged
argument_list|()
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|itemSelectionChanged
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|testWidget
operator|->
name|selectionModel
argument_list|()
operator|->
name|select
argument_list|(
name|idx
argument_list|,
name|QItemSelectionModel
operator|::
name|SelectCurrent
argument_list|)
expr_stmt|;
name|disconnect
argument_list|(
name|testWidget
argument_list|,
name|SIGNAL
argument_list|(
name|itemSelectionChanged
argument_list|()
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|itemSelectionChanged
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setSelectionModel
name|void
name|tst_QTreeWidget
operator|::
name|setSelectionModel
parameter_list|()
block|{
name|QTreeWidget
name|tree
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
operator|++
name|i
control|)
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|tree
argument_list|,
name|QStringList
argument_list|(
name|QString
operator|::
name|number
argument_list|(
name|i
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QItemSelectionModel
name|selection
argument_list|(
name|tree
operator|.
name|model
argument_list|()
argument_list|)
decl_stmt|;
name|selection
operator|.
name|select
argument_list|(
name|tree
operator|.
name|model
argument_list|()
operator|->
name|index
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QItemSelectionModel
operator|::
name|Select
argument_list|)
expr_stmt|;
name|tree
operator|.
name|setSelectionModel
argument_list|(
operator|&
name|selection
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|topLevelItem
argument_list|(
literal|1
argument_list|)
operator|->
name|isSelected
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task217309
name|void
name|tst_QTreeWidget
operator|::
name|task217309
parameter_list|()
block|{
name|QTreeWidgetItem
name|item
decl_stmt|;
name|item
operator|.
name|setFlags
argument_list|(
name|item
operator|.
name|flags
argument_list|()
operator||
name|Qt
operator|::
name|ItemIsTristate
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
name|subitem1
decl_stmt|;
name|subitem1
operator|.
name|setFlags
argument_list|(
name|subitem1
operator|.
name|flags
argument_list|()
operator||
name|Qt
operator|::
name|ItemIsTristate
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
name|subitem2
decl_stmt|;
name|subitem2
operator|.
name|setFlags
argument_list|(
name|subitem2
operator|.
name|flags
argument_list|()
operator||
name|Qt
operator|::
name|ItemIsTristate
argument_list|)
expr_stmt|;
name|item
operator|.
name|addChild
argument_list|(
operator|&
name|subitem1
argument_list|)
expr_stmt|;
name|item
operator|.
name|addChild
argument_list|(
operator|&
name|subitem2
argument_list|)
expr_stmt|;
name|subitem1
operator|.
name|setCheckState
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Checked
argument_list|)
expr_stmt|;
name|subitem2
operator|.
name|setCheckState
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Unchecked
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|.
name|data
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|CheckStateRole
argument_list|)
operator|==
name|Qt
operator|::
name|PartiallyChecked
argument_list|)
expr_stmt|;
name|subitem2
operator|.
name|setCheckState
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|PartiallyChecked
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|.
name|data
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|CheckStateRole
argument_list|)
operator|==
name|Qt
operator|::
name|PartiallyChecked
argument_list|)
expr_stmt|;
name|subitem2
operator|.
name|setCheckState
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Checked
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|.
name|data
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|CheckStateRole
argument_list|)
operator|==
name|Qt
operator|::
name|Checked
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|TreeWidgetItem
class|class
name|TreeWidgetItem
super|:
specifier|public
name|QTreeWidgetItem
block|{
public|public:
DECL|function|_emitDataChanged
name|void
name|_emitDataChanged
parameter_list|()
block|{
name|emitDataChanged
argument_list|()
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|emitDataChanged
name|void
name|tst_QTreeWidget
operator|::
name|emitDataChanged
parameter_list|()
block|{
name|QTreeWidget
modifier|*
name|tree
init|=
operator|new
name|QTreeWidget
decl_stmt|;
name|QSignalSpy
name|spy
argument_list|(
name|tree
argument_list|,
name|SIGNAL
argument_list|(
name|itemChanged
argument_list|(
name|QTreeWidgetItem
operator|*
argument_list|,
name|int
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|TreeWidgetItem
modifier|*
name|item
init|=
operator|new
name|TreeWidgetItem
argument_list|()
decl_stmt|;
name|tree
operator|->
name|insertTopLevelItem
argument_list|(
literal|0
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|item
operator|->
name|_emitDataChanged
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setCurrentItemExpandsParent
name|void
name|tst_QTreeWidget
operator|::
name|setCurrentItemExpandsParent
parameter_list|()
block|{
name|QTreeWidget
name|w
decl_stmt|;
name|w
operator|.
name|setColumnCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|i1
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|w
argument_list|,
name|QStringList
argument_list|()
operator|<<
literal|"parent"
argument_list|)
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|i2
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|i1
argument_list|,
name|QStringList
argument_list|()
operator|<<
literal|"child"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|i2
operator|->
name|isExpanded
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|w
operator|.
name|currentItem
argument_list|()
operator|==
literal|0
argument_list|)
expr_stmt|;
name|w
operator|.
name|setCurrentItem
argument_list|(
name|i2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|i2
operator|->
name|isExpanded
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|.
name|currentItem
argument_list|()
argument_list|,
name|i2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task239150_editorWidth
name|void
name|tst_QTreeWidget
operator|::
name|task239150_editorWidth
parameter_list|()
block|{
comment|//we check that an item with no text will get an editor with a correct size
name|QTreeWidget
name|tree
decl_stmt|;
name|QStyleOptionFrameV2
name|opt
decl_stmt|;
name|opt
operator|.
name|init
argument_list|(
operator|&
name|tree
argument_list|)
expr_stmt|;
specifier|const
name|int
name|minWidth
init|=
name|tree
operator|.
name|style
argument_list|()
operator|->
name|sizeFromContents
argument_list|(
name|QStyle
operator|::
name|CT_LineEdit
argument_list|,
operator|&
name|opt
argument_list|,
name|QSize
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|.
name|expandedTo
argument_list|(
name|QApplication
operator|::
name|globalStrut
argument_list|()
argument_list|)
argument_list|,
literal|0
argument_list|)
operator|.
name|width
argument_list|()
decl_stmt|;
block|{
name|QTreeWidgetItem
name|item
decl_stmt|;
name|item
operator|.
name|setFlags
argument_list|(
name|Qt
operator|::
name|ItemIsSelectable
operator||
name|Qt
operator|::
name|ItemIsEditable
operator||
name|Qt
operator|::
name|ItemIsEnabled
argument_list|)
expr_stmt|;
name|tree
operator|.
name|addTopLevelItem
argument_list|(
operator|&
name|item
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|tree
operator|.
name|itemWidget
argument_list|(
operator|&
name|item
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|tree
operator|.
name|editItem
argument_list|(
operator|&
name|item
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|tree
operator|.
name|itemWidget
argument_list|(
operator|&
name|item
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|tree
operator|.
name|itemWidget
argument_list|(
operator|&
name|item
argument_list|,
literal|0
argument_list|)
operator|->
name|width
argument_list|()
operator|>=
name|minWidth
argument_list|)
expr_stmt|;
block|}
comment|//now let's test it with an item with a lot of text
block|{
name|QTreeWidgetItem
name|item
decl_stmt|;
name|item
operator|.
name|setText
argument_list|(
literal|0
argument_list|,
literal|"foooooooooooooooooooooooo"
argument_list|)
expr_stmt|;
name|item
operator|.
name|setFlags
argument_list|(
name|Qt
operator|::
name|ItemIsSelectable
operator||
name|Qt
operator|::
name|ItemIsEditable
operator||
name|Qt
operator|::
name|ItemIsEnabled
argument_list|)
expr_stmt|;
name|tree
operator|.
name|addTopLevelItem
argument_list|(
operator|&
name|item
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|tree
operator|.
name|itemWidget
argument_list|(
operator|&
name|item
argument_list|,
literal|0
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|tree
operator|.
name|editItem
argument_list|(
operator|&
name|item
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|tree
operator|.
name|itemWidget
argument_list|(
operator|&
name|item
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|tree
operator|.
name|itemWidget
argument_list|(
operator|&
name|item
argument_list|,
literal|0
argument_list|)
operator|->
name|width
argument_list|()
operator|>=
name|minWidth
operator|+
name|tree
operator|.
name|fontMetrics
argument_list|()
operator|.
name|width
argument_list|(
name|item
operator|.
name|text
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|setTextUpdate
name|void
name|tst_QTreeWidget
operator|::
name|setTextUpdate
parameter_list|()
block|{
name|QTreeWidget
name|treeWidget
decl_stmt|;
name|treeWidget
operator|.
name|setColumnCount
argument_list|(
literal|2
argument_list|)
expr_stmt|;
class|class
name|MyItemDelegate
super|:
specifier|public
name|QStyledItemDelegate
block|{
public|public:
name|MyItemDelegate
parameter_list|()
member_init_list|:
name|numPaints
argument_list|(
literal|0
argument_list|)
block|{ }
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionViewItem
modifier|&
name|option
parameter_list|,
specifier|const
name|QModelIndex
modifier|&
name|index
parameter_list|)
specifier|const
block|{
name|numPaints
operator|++
expr_stmt|;
name|QStyledItemDelegate
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|index
argument_list|)
expr_stmt|;
block|}
specifier|mutable
name|int
name|numPaints
decl_stmt|;
block|}
name|delegate
class|;
name|treeWidget
operator|.
name|setItemDelegate
argument_list|(
operator|&
name|delegate
argument_list|)
expr_stmt|;
name|treeWidget
operator|.
name|show
argument_list|()
expr_stmt|;
name|QStringList
name|strList
decl_stmt|;
name|strList
operator|<<
literal|"variable1"
operator|<<
literal|"0"
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|strList
argument_list|)
decl_stmt|;
name|treeWidget
operator|.
name|insertTopLevelItem
argument_list|(
literal|0
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|numPaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|delegate
operator|.
name|numPaints
operator|=
literal|0
expr_stmt|;
name|item
operator|->
name|setText
argument_list|(
literal|1
argument_list|,
literal|"42"
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|numPaints
operator|>
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|taskQTBUG2844_visualItemRect
name|void
name|tst_QTreeWidget
operator|::
name|taskQTBUG2844_visualItemRect
parameter_list|()
block|{
name|CustomTreeWidget
name|tree
decl_stmt|;
name|tree
operator|.
name|resize
argument_list|(
literal|150
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|tree
operator|.
name|setColumnCount
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
name|item
argument_list|(
operator|&
name|tree
argument_list|)
decl_stmt|;
name|QRect
name|rectCol0
init|=
name|tree
operator|.
name|visualRect
argument_list|(
name|tree
operator|.
name|indexFromItem
argument_list|(
operator|&
name|item
argument_list|,
literal|0
argument_list|)
argument_list|)
decl_stmt|;
name|QRect
name|rectCol1
init|=
name|tree
operator|.
name|visualRect
argument_list|(
name|tree
operator|.
name|indexFromItem
argument_list|(
operator|&
name|item
argument_list|,
literal|1
argument_list|)
argument_list|)
decl_stmt|;
name|QRect
name|rectCol2
init|=
name|tree
operator|.
name|visualRect
argument_list|(
name|tree
operator|.
name|indexFromItem
argument_list|(
operator|&
name|item
argument_list|,
literal|2
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|visualItemRect
argument_list|(
operator|&
name|item
argument_list|)
argument_list|,
name|rectCol0
operator||
name|rectCol2
argument_list|)
expr_stmt|;
name|tree
operator|.
name|setColumnHidden
argument_list|(
literal|2
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tree
operator|.
name|visualItemRect
argument_list|(
operator|&
name|item
argument_list|)
argument_list|,
name|rectCol0
operator||
name|rectCol1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setChildIndicatorPolicy
name|void
name|tst_QTreeWidget
operator|::
name|setChildIndicatorPolicy
parameter_list|()
block|{
name|QTreeWidget
name|treeWidget
decl_stmt|;
name|treeWidget
operator|.
name|setColumnCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
class|class
name|MyItemDelegate
super|:
specifier|public
name|QStyledItemDelegate
block|{
public|public:
name|MyItemDelegate
parameter_list|()
member_init_list|:
name|numPaints
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|expectChildren
argument_list|(
literal|false
argument_list|)
block|{ }
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionViewItem
modifier|&
name|option
parameter_list|,
specifier|const
name|QModelIndex
modifier|&
name|index
parameter_list|)
specifier|const
block|{
name|numPaints
operator|++
expr_stmt|;
name|QCOMPARE
argument_list|(
operator|!
operator|(
name|option
operator|.
name|state
operator|&
name|QStyle
operator|::
name|State_Children
operator|)
argument_list|,
operator|!
name|expectChildren
argument_list|)
expr_stmt|;
name|QStyledItemDelegate
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|index
argument_list|)
expr_stmt|;
block|}
specifier|mutable
name|int
name|numPaints
decl_stmt|;
name|bool
name|expectChildren
decl_stmt|;
block|}
name|delegate
class|;
name|treeWidget
operator|.
name|setItemDelegate
argument_list|(
operator|&
name|delegate
argument_list|)
expr_stmt|;
name|treeWidget
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|item
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|QStringList
argument_list|(
literal|"Hello"
argument_list|)
argument_list|)
decl_stmt|;
name|treeWidget
operator|.
name|insertTopLevelItem
argument_list|(
literal|0
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|delegate
operator|.
name|numPaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|delegate
operator|.
name|numPaints
operator|=
literal|0
expr_stmt|;
name|delegate
operator|.
name|expectChildren
operator|=
literal|true
expr_stmt|;
name|item
operator|->
name|setChildIndicatorPolicy
argument_list|(
name|QTreeWidgetItem
operator|::
name|ShowIndicator
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|delegate
operator|.
name|numPaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|delegate
operator|.
name|numPaints
operator|=
literal|0
expr_stmt|;
name|delegate
operator|.
name|expectChildren
operator|=
literal|false
expr_stmt|;
name|item
operator|->
name|setChildIndicatorPolicy
argument_list|(
name|QTreeWidgetItem
operator|::
name|DontShowIndicatorWhenChildless
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|delegate
operator|.
name|numPaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|delegate
operator|.
name|numPaints
operator|=
literal|0
expr_stmt|;
name|delegate
operator|.
name|expectChildren
operator|=
literal|true
expr_stmt|;
operator|new
name|QTreeWidgetItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|delegate
operator|.
name|numPaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|delegate
operator|.
name|numPaints
operator|=
literal|0
expr_stmt|;
name|delegate
operator|.
name|expectChildren
operator|=
literal|false
expr_stmt|;
name|item
operator|->
name|setChildIndicatorPolicy
argument_list|(
name|QTreeWidgetItem
operator|::
name|DontShowIndicator
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|delegate
operator|.
name|numPaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task20345_sortChildren
name|void
name|tst_QTreeWidget
operator|::
name|task20345_sortChildren
parameter_list|()
block|{
if|if
condition|(
name|qApp
operator|->
name|platformName
argument_list|()
operator|.
name|toLower
argument_list|()
operator|==
name|QLatin1String
argument_list|(
literal|"wayland"
argument_list|)
condition|)
name|QSKIP
argument_list|(
literal|"Wayland: This causes a crash triggered by setVisible(false)"
argument_list|)
expr_stmt|;
comment|// This test case is considered successful if it is executed (no crash in sorting)
name|QTreeWidget
name|tw
decl_stmt|;
name|tw
operator|.
name|setColumnCount
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|tw
operator|.
name|headerItem
argument_list|()
operator|->
name|setText
argument_list|(
literal|0
argument_list|,
literal|"Col 0"
argument_list|)
expr_stmt|;
name|tw
operator|.
name|headerItem
argument_list|()
operator|->
name|setText
argument_list|(
literal|1
argument_list|,
literal|"Col 1"
argument_list|)
expr_stmt|;
name|tw
operator|.
name|header
argument_list|()
operator|->
name|setSortIndicator
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
expr_stmt|;
name|tw
operator|.
name|setSortingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|tw
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|rootItem
init|=
literal|0
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|childItem
init|=
literal|0
decl_stmt|;
name|rootItem
operator|=
operator|new
name|QTreeWidgetItem
argument_list|(
operator|&
name|tw
argument_list|,
name|QStringList
argument_list|(
literal|"a"
argument_list|)
argument_list|)
expr_stmt|;
name|childItem
operator|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|rootItem
argument_list|)
expr_stmt|;
name|childItem
operator|->
name|setText
argument_list|(
literal|1
argument_list|,
literal|"3"
argument_list|)
expr_stmt|;
name|childItem
operator|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|rootItem
argument_list|)
expr_stmt|;
name|childItem
operator|->
name|setText
argument_list|(
literal|1
argument_list|,
literal|"1"
argument_list|)
expr_stmt|;
name|childItem
operator|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|rootItem
argument_list|)
expr_stmt|;
name|childItem
operator|->
name|setText
argument_list|(
literal|1
argument_list|,
literal|"2"
argument_list|)
expr_stmt|;
name|tw
operator|.
name|setCurrentItem
argument_list|(
name|tw
operator|.
name|topLevelItem
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QTreeWidgetItem
modifier|*
name|curItem
init|=
name|tw
operator|.
name|currentItem
argument_list|()
decl_stmt|;
name|int
name|childCount
init|=
name|curItem
operator|->
name|childCount
argument_list|()
operator|+
literal|1
decl_stmt|;
name|QTreeWidgetItem
modifier|*
name|newItem
init|=
operator|new
name|QTreeWidgetItem
argument_list|(
name|curItem
argument_list|)
decl_stmt|;
name|newItem
operator|->
name|setText
argument_list|(
literal|1
argument_list|,
name|QString
operator|::
name|number
argument_list|(
name|childCount
argument_list|)
argument_list|)
expr_stmt|;
name|rootItem
operator|->
name|sortChildren
argument_list|(
literal|1
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_macro
name|QTEST_MAIN
argument_list|(
argument|tst_QTreeWidget
argument_list|)
end_macro
begin_include
include|#
directive|include
file|"tst_qtreewidget.moc"
end_include
end_unit
