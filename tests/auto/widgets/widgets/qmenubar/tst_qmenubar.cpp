begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2015 The Qt Company Ltd. ** Contact: http://www.qt.io/licensing/ ** ** This file is part of the test suite of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL21$ ** Commercial License Usage ** Licensees holding valid commercial Qt licenses may use this file in ** accordance with the commercial license agreement provided with the ** Software or, alternatively, in accordance with the terms contained in ** a written agreement between you and The Qt Company. For licensing terms ** and conditions see http://www.qt.io/terms-conditions. For further ** information use the contact form at http://www.qt.io/contact-us. ** ** GNU Lesser General Public License Usage ** Alternatively, this file may be used under the terms of the GNU Lesser ** General Public License version 2.1 or version 3 as published by the Free ** Software Foundation and appearing in the file LICENSE.LGPLv21 and ** LICENSE.LGPLv3 included in the packaging of this file. Please review the ** following information to ensure the GNU Lesser General Public License ** requirements will be met: https://www.gnu.org/licenses/lgpl.html and ** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html. ** ** As a special exception, The Qt Company gives you certain additional ** rights. These rights are described in The Qt Company LGPL Exception ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package. ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<QtTest/QtTest>
end_include
begin_include
include|#
directive|include
file|<qapplication.h>
end_include
begin_include
include|#
directive|include
file|<qmainwindow.h>
end_include
begin_include
include|#
directive|include
file|<qmenubar.h>
end_include
begin_include
include|#
directive|include
file|<qstyle.h>
end_include
begin_include
include|#
directive|include
file|<qproxystyle.h>
end_include
begin_include
include|#
directive|include
file|<qstylefactory.h>
end_include
begin_include
include|#
directive|include
file|<qdesktopwidget.h>
end_include
begin_include
include|#
directive|include
file|<qaction.h>
end_include
begin_include
include|#
directive|include
file|<qstyleoption.h>
end_include
begin_include
include|#
directive|include
file|<QVBoxLayout>
end_include
begin_include
include|#
directive|include
file|<QLabel>
end_include
begin_include
include|#
directive|include
file|<qscreen.h>
end_include
begin_include
include|#
directive|include
file|<qobject.h>
end_include
begin_macro
name|QT_FORWARD_DECLARE_CLASS
argument_list|(
argument|QMainWindow
argument_list|)
end_macro
begin_include
include|#
directive|include
file|<qmenubar.h>
end_include
begin_class
DECL|class|Menu
class|class
name|Menu
super|:
specifier|public
name|QMenu
block|{
name|Q_OBJECT
public|public
name|slots
public|:
DECL|function|addActions
name|void
name|addActions
parameter_list|()
block|{
comment|//this will change the geometry of the menu
name|addAction
argument_list|(
literal|"action1"
argument_list|)
expr_stmt|;
name|addAction
argument_list|(
literal|"action2"
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|centerOnScreen
specifier|static
specifier|inline
name|void
name|centerOnScreen
parameter_list|(
name|QWidget
modifier|*
name|w
parameter_list|)
block|{
specifier|const
name|QPoint
name|offset
init|=
name|QPoint
argument_list|(
name|w
operator|->
name|width
argument_list|()
operator|/
literal|2
argument_list|,
name|w
operator|->
name|height
argument_list|()
operator|/
literal|2
argument_list|)
decl_stmt|;
name|w
operator|->
name|move
argument_list|(
name|QGuiApplication
operator|::
name|primaryScreen
argument_list|()
operator|->
name|availableGeometry
argument_list|()
operator|.
name|center
argument_list|()
operator|-
name|offset
argument_list|)
expr_stmt|;
block|}
end_function
begin_struct
DECL|struct|TestMenu
struct|struct
name|TestMenu
block|{
DECL|member|menus
name|QList
argument_list|<
name|QMenu
modifier|*
argument_list|>
name|menus
decl_stmt|;
DECL|member|actions
name|QList
argument_list|<
name|QAction
modifier|*
argument_list|>
name|actions
decl_stmt|;
block|}
struct|;
end_struct
begin_class
DECL|class|tst_QMenuBar
class|class
name|tst_QMenuBar
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
public|public:
name|tst_QMenuBar
parameter_list|()
constructor_decl|;
private|private
name|slots
private|:
name|void
name|getSetCheck
parameter_list|()
function_decl|;
name|void
name|cleanup
parameter_list|()
function_decl|;
name|void
name|clear
parameter_list|()
function_decl|;
name|void
name|removeItemAt
parameter_list|()
function_decl|;
name|void
name|removeItemAt_data
parameter_list|()
function_decl|;
name|void
name|removeItem_data
parameter_list|()
function_decl|;
name|void
name|removeItem
parameter_list|()
function_decl|;
name|void
name|count
parameter_list|()
function_decl|;
name|void
name|insertItem_QString_QObject
parameter_list|()
function_decl|;
if|#
directive|if
operator|!
name|defined
argument_list|(
name|Q_OS_MAC
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
name|void
name|accel
parameter_list|()
function_decl|;
name|void
name|activatedCount
parameter_list|()
function_decl|;
name|void
name|allowActiveAndDisabled
parameter_list|()
function_decl|;
name|void
name|check_accelKeys
parameter_list|()
function_decl|;
name|void
name|check_cursorKeys1
parameter_list|()
function_decl|;
name|void
name|check_cursorKeys2
parameter_list|()
function_decl|;
name|void
name|check_cursorKeys3
parameter_list|()
function_decl|;
name|void
name|check_escKey
parameter_list|()
function_decl|;
endif|#
directive|endif
name|void
name|check_endKey
parameter_list|()
function_decl|;
name|void
name|check_homeKey
parameter_list|()
function_decl|;
comment|//     void check_mouse1_data();
comment|//     void check_mouse1();
comment|//     void check_mouse2_data();
comment|//     void check_mouse2();
name|void
name|check_altPress
parameter_list|()
function_decl|;
name|void
name|check_altClosePress
parameter_list|()
function_decl|;
if|#
directive|if
operator|!
name|defined
argument_list|(
name|Q_OS_MAC
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
name|void
name|check_shortcutPress
parameter_list|()
function_decl|;
name|void
name|check_menuPosition
parameter_list|()
function_decl|;
endif|#
directive|endif
name|void
name|task223138_triggered
parameter_list|()
function_decl|;
name|void
name|task256322_highlight
parameter_list|()
function_decl|;
name|void
name|menubarSizeHint
parameter_list|()
function_decl|;
ifndef|#
directive|ifndef
name|Q_OS_MAC
name|void
name|taskQTBUG4965_escapeEaten
parameter_list|()
function_decl|;
endif|#
directive|endif
name|void
name|taskQTBUG11823_crashwithInvisibleActions
parameter_list|()
function_decl|;
name|void
name|closeOnSecondClickAndOpenOnThirdClick
parameter_list|()
function_decl|;
name|void
name|cornerWidgets_data
parameter_list|()
function_decl|;
name|void
name|cornerWidgets
parameter_list|()
function_decl|;
name|void
name|taskQTBUG53205_crashReparentNested
parameter_list|()
function_decl|;
protected|protected
name|slots
protected|:
name|void
name|onSimpleActivated
parameter_list|(
name|QAction
modifier|*
parameter_list|)
function_decl|;
name|void
name|onComplexActionTriggered
parameter_list|()
function_decl|;
name|void
name|slotForTaskQTBUG53205
parameter_list|()
function_decl|;
private|private:
name|TestMenu
name|initSimpleMenuBar
parameter_list|(
name|QMenuBar
modifier|*
name|mb
parameter_list|)
function_decl|;
name|TestMenu
name|initWindowWithSimpleMenuBar
parameter_list|(
name|QMainWindow
modifier|&
name|w
parameter_list|)
function_decl|;
name|QAction
modifier|*
name|createCharacterAction
parameter_list|(
name|QMenu
modifier|*
name|menu
parameter_list|,
name|char
name|lowerAscii
parameter_list|)
function_decl|;
name|QMenu
modifier|*
name|addNumberedMenu
parameter_list|(
name|QMenuBar
modifier|*
name|mb
parameter_list|,
name|int
name|n
parameter_list|)
function_decl|;
name|TestMenu
name|initComplexMenuBar
parameter_list|(
name|QMenuBar
modifier|*
name|mb
parameter_list|)
function_decl|;
name|TestMenu
name|initWindowWithComplexMenuBar
parameter_list|(
name|QMainWindow
modifier|&
name|w
parameter_list|)
function_decl|;
DECL|member|m_lastSimpleAcceleratorId
name|QAction
modifier|*
name|m_lastSimpleAcceleratorId
decl_stmt|;
DECL|member|m_simpleActivatedCount
name|int
name|m_simpleActivatedCount
decl_stmt|;
DECL|member|m_complexTriggerCount
name|int
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'k'
argument_list|)
index|]
decl_stmt|;
DECL|member|taskQTBUG53205MenuBar
name|QMenuBar
modifier|*
name|taskQTBUG53205MenuBar
decl_stmt|;
block|}
class|;
end_class
begin_comment
comment|// Testing get/set functions
end_comment
begin_function
DECL|function|getSetCheck
name|void
name|tst_QMenuBar
operator|::
name|getSetCheck
parameter_list|()
block|{
name|QMenuBar
name|obj1
decl_stmt|;
comment|// QAction * QMenuBar::activeAction()
comment|// void QMenuBar::setActiveAction(QAction *)
name|QAction
modifier|*
name|var1
init|=
operator|new
name|QAction
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|obj1
operator|.
name|setActiveAction
argument_list|(
name|var1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|var1
argument_list|,
name|obj1
operator|.
name|activeAction
argument_list|()
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setActiveAction
argument_list|(
operator|(
name|QAction
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
operator|(
name|QAction
operator|*
operator|)
literal|0
argument_list|,
name|obj1
operator|.
name|activeAction
argument_list|()
argument_list|)
expr_stmt|;
operator|delete
name|var1
expr_stmt|;
block|}
end_function
begin_include
include|#
directive|include
file|<qcursor.h>
end_include
begin_decl_stmt
DECL|variable|RESET
specifier|const
name|int
name|RESET
init|=
literal|0
decl_stmt|;
end_decl_stmt
begin_comment
comment|/*!     Test plan:         insertItem (all flavors and combinations)         removing menu items         clearing the menu          check the common behaviour + emitted signals for:             accelerator keys             navigating tru the menu and then pressing ENTER             mouse clicks             mouse drags             combinations of key + mouse (if possible)             checked / unckecked state of menu options             active / inactive state      Can't test these without pixmap comparison...         show and hide         icons in a menu         pixmaps in a menu  */
end_comment
begin_constructor
DECL|function|tst_QMenuBar
name|tst_QMenuBar
operator|::
name|tst_QMenuBar
parameter_list|()
member_init_list|:
name|m_lastSimpleAcceleratorId
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|m_simpleActivatedCount
argument_list|(
literal|0
argument_list|)
block|{
name|QApplication
operator|::
name|setEffectEnabled
argument_list|(
name|Qt
operator|::
name|UI_AnimateMenu
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
end_constructor
begin_function
DECL|function|onSimpleActivated
name|void
name|tst_QMenuBar
operator|::
name|onSimpleActivated
parameter_list|(
name|QAction
modifier|*
name|action
parameter_list|)
block|{
name|m_lastSimpleAcceleratorId
operator|=
name|action
expr_stmt|;
name|m_simpleActivatedCount
operator|++
expr_stmt|;
block|}
end_function
begin_function
DECL|function|cleanup
name|void
name|tst_QMenuBar
operator|::
name|cleanup
parameter_list|()
block|{
name|QVERIFY
argument_list|(
name|QApplication
operator|::
name|topLevelWidgets
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// Create a simple menu bar and connect its actions to onSimpleActivated().
end_comment
begin_function
DECL|function|initSimpleMenuBar
name|TestMenu
name|tst_QMenuBar
operator|::
name|initSimpleMenuBar
parameter_list|(
name|QMenuBar
modifier|*
name|mb
parameter_list|)
block|{
name|TestMenu
name|result
decl_stmt|;
name|connect
argument_list|(
name|mb
argument_list|,
name|SIGNAL
argument_list|(
name|triggered
argument_list|(
name|QAction
operator|*
argument_list|)
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|onSimpleActivated
argument_list|(
name|QAction
operator|*
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QMenu
modifier|*
name|menu
init|=
name|mb
operator|->
name|addMenu
argument_list|(
name|QStringLiteral
argument_list|(
literal|"&accel"
argument_list|)
argument_list|)
decl_stmt|;
name|QAction
modifier|*
name|action
init|=
name|menu
operator|->
name|addAction
argument_list|(
name|QStringLiteral
argument_list|(
literal|"menu1"
argument_list|)
argument_list|)
decl_stmt|;
name|action
operator|->
name|setShortcut
argument_list|(
name|QKeySequence
argument_list|(
name|Qt
operator|::
name|ALT
operator|+
name|Qt
operator|::
name|Key_A
argument_list|)
argument_list|)
expr_stmt|;
name|action
operator|->
name|setShortcut
argument_list|(
name|QKeySequence
argument_list|(
name|Qt
operator|::
name|CTRL
operator|+
name|Qt
operator|::
name|Key_A
argument_list|)
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|menu
argument_list|,
name|SIGNAL
argument_list|(
name|triggered
argument_list|(
name|QAction
operator|*
argument_list|)
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|onSimpleActivated
argument_list|(
name|QAction
operator|*
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|.
name|menus
operator|<<
name|menu
expr_stmt|;
name|result
operator|.
name|actions
operator|<<
name|action
expr_stmt|;
name|menu
operator|=
name|mb
operator|->
name|addMenu
argument_list|(
name|QStringLiteral
argument_list|(
literal|"accel1"
argument_list|)
argument_list|)
expr_stmt|;
name|action
operator|=
name|menu
operator|->
name|addAction
argument_list|(
name|QStringLiteral
argument_list|(
literal|"&Open..."
argument_list|)
argument_list|)
expr_stmt|;
name|action
operator|->
name|setShortcut
argument_list|(
name|Qt
operator|::
name|Key_O
argument_list|)
expr_stmt|;
name|result
operator|.
name|menus
operator|<<
name|menu
expr_stmt|;
name|connect
argument_list|(
name|menu
argument_list|,
name|SIGNAL
argument_list|(
name|triggered
argument_list|(
name|QAction
operator|*
argument_list|)
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|onSimpleActivated
argument_list|(
name|QAction
operator|*
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|.
name|actions
operator|<<
name|action
expr_stmt|;
name|m_lastSimpleAcceleratorId
operator|=
literal|0
expr_stmt|;
name|m_simpleActivatedCount
operator|=
literal|0
expr_stmt|;
return|return
name|result
return|;
block|}
end_function
begin_function
DECL|function|initWindowWithSimpleMenuBar
specifier|inline
name|TestMenu
name|tst_QMenuBar
operator|::
name|initWindowWithSimpleMenuBar
parameter_list|(
name|QMainWindow
modifier|&
name|w
parameter_list|)
block|{
name|w
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|centerOnScreen
argument_list|(
operator|&
name|w
argument_list|)
expr_stmt|;
return|return
name|initSimpleMenuBar
argument_list|(
name|w
operator|.
name|menuBar
argument_list|()
argument_list|)
return|;
block|}
end_function
begin_comment
comment|// add a menu with number n, set number as data.
end_comment
begin_function
DECL|function|addNumberedMenu
name|QMenu
modifier|*
name|tst_QMenuBar
operator|::
name|addNumberedMenu
parameter_list|(
name|QMenuBar
modifier|*
name|mb
parameter_list|,
name|int
name|n
parameter_list|)
block|{
specifier|const
name|QString
name|text
init|=
name|QStringLiteral
argument_list|(
literal|"Menu&"
argument_list|)
operator|+
name|QString
operator|::
name|number
argument_list|(
name|n
argument_list|)
decl_stmt|;
name|QMenu
modifier|*
name|menu
init|=
name|mb
operator|->
name|addMenu
argument_list|(
name|text
argument_list|)
decl_stmt|;
name|menu
operator|->
name|setObjectName
argument_list|(
name|text
argument_list|)
expr_stmt|;
name|QAction
modifier|*
name|action
init|=
name|menu
operator|->
name|menuAction
argument_list|()
decl_stmt|;
name|action
operator|->
name|setObjectName
argument_list|(
name|text
operator|+
name|QStringLiteral
argument_list|(
literal|"Action"
argument_list|)
argument_list|)
expr_stmt|;
name|action
operator|->
name|setData
argument_list|(
name|QVariant
argument_list|(
name|n
argument_list|)
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|action
argument_list|,
name|SIGNAL
argument_list|(
name|triggered
argument_list|()
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|onComplexActionTriggered
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|menu
return|;
block|}
end_function
begin_comment
comment|// Create an action triggering on Ctrl+character, set number as data.
end_comment
begin_function
DECL|function|createCharacterAction
name|QAction
modifier|*
name|tst_QMenuBar
operator|::
name|createCharacterAction
parameter_list|(
name|QMenu
modifier|*
name|menu
parameter_list|,
name|char
name|lowerAscii
parameter_list|)
block|{
specifier|const
name|QString
name|text
init|=
name|QStringLiteral
argument_list|(
literal|"Item "
argument_list|)
operator|+
name|QChar
argument_list|(
name|QLatin1Char
argument_list|(
name|lowerAscii
argument_list|)
argument_list|)
operator|.
name|toUpper
argument_list|()
decl_stmt|;
name|QAction
modifier|*
name|action
init|=
name|menu
operator|->
name|addAction
argument_list|(
name|text
argument_list|)
decl_stmt|;
name|action
operator|->
name|setObjectName
argument_list|(
name|text
argument_list|)
expr_stmt|;
name|action
operator|->
name|setData
argument_list|(
name|QVariant
argument_list|(
name|int
argument_list|(
name|lowerAscii
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|action
operator|->
name|setShortcut
argument_list|(
name|Qt
operator|::
name|CTRL
operator|+
operator|(
name|lowerAscii
operator|-
literal|'a'
operator|+
name|Qt
operator|::
name|Key_A
operator|)
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|action
argument_list|,
name|SIGNAL
argument_list|(
name|triggered
argument_list|()
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|onComplexActionTriggered
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|action
return|;
block|}
end_function
begin_function
DECL|function|onComplexActionTriggered
name|void
name|tst_QMenuBar
operator|::
name|onComplexActionTriggered
parameter_list|()
block|{
if|if
condition|(
name|QAction
modifier|*
name|a
init|=
name|qobject_cast
argument_list|<
name|QAction
operator|*
argument_list|>
argument_list|(
name|sender
argument_list|()
argument_list|)
condition|)
name|m_complexTriggerCount
index|[
name|a
operator|->
name|data
argument_list|()
operator|.
name|toInt
argument_list|()
index|]
operator|++
expr_stmt|;
block|}
end_function
begin_comment
comment|// Create a complex menu bar and connect its actions to onComplexActionTriggered()
end_comment
begin_comment
comment|// for their invocations to be counted in m_complexTriggerCount. The index is the
end_comment
begin_comment
comment|// menu number (1..n) for the menu bar actions and the ASCII-code of the shortcut
end_comment
begin_comment
comment|// character for the actions in the menus.
end_comment
begin_function
DECL|function|initComplexMenuBar
name|TestMenu
name|tst_QMenuBar
operator|::
name|initComplexMenuBar
parameter_list|(
name|QMenuBar
modifier|*
name|mb
parameter_list|)
block|{
name|TestMenu
name|result
decl_stmt|;
name|QMenu
modifier|*
name|menu
init|=
name|addNumberedMenu
argument_list|(
name|mb
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|result
operator|.
name|menus
operator|<<
name|menu
expr_stmt|;
for|for
control|(
name|char
name|c
init|=
literal|'a'
init|;
name|c
operator|<
literal|'c'
condition|;
operator|++
name|c
control|)
name|result
operator|.
name|actions
operator|<<
name|createCharacterAction
argument_list|(
name|menu
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|menu
operator|=
name|addNumberedMenu
argument_list|(
name|mb
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|menu
operator|->
name|menuAction
argument_list|()
operator|->
name|setData
argument_list|(
name|QVariant
argument_list|(
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|.
name|menus
operator|<<
name|menu
expr_stmt|;
for|for
control|(
name|char
name|c
init|=
literal|'c'
init|;
name|c
operator|<
literal|'g'
condition|;
operator|++
name|c
control|)
name|result
operator|.
name|actions
operator|<<
name|createCharacterAction
argument_list|(
name|menu
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|menu
operator|->
name|addSeparator
argument_list|()
expr_stmt|;
for|for
control|(
name|char
name|c
init|=
literal|'g'
init|;
name|c
operator|<
literal|'i'
condition|;
operator|++
name|c
control|)
name|result
operator|.
name|actions
operator|<<
name|createCharacterAction
argument_list|(
name|menu
argument_list|,
name|c
argument_list|)
expr_stmt|;
name|QAction
modifier|*
name|action
init|=
name|mb
operator|->
name|addAction
argument_list|(
name|QStringLiteral
argument_list|(
literal|"M&enu 3"
argument_list|)
argument_list|)
decl_stmt|;
name|action
operator|->
name|setData
argument_list|(
name|QVariant
argument_list|(
literal|3
argument_list|)
argument_list|)
expr_stmt|;
name|action
operator|->
name|setShortcut
argument_list|(
name|Qt
operator|::
name|ALT
operator|+
name|Qt
operator|::
name|Key_J
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|action
argument_list|,
name|SIGNAL
argument_list|(
name|triggered
argument_list|()
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|onComplexActionTriggered
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|.
name|actions
operator|<<
name|action
expr_stmt|;
name|qFill
argument_list|(
name|m_complexTriggerCount
argument_list|,
name|m_complexTriggerCount
operator|+
sizeof|sizeof
argument_list|(
name|m_complexTriggerCount
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|int
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function
begin_function
DECL|function|initWindowWithComplexMenuBar
specifier|inline
name|TestMenu
name|tst_QMenuBar
operator|::
name|initWindowWithComplexMenuBar
parameter_list|(
name|QMainWindow
modifier|&
name|w
parameter_list|)
block|{
name|w
operator|.
name|resize
argument_list|(
literal|400
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|centerOnScreen
argument_list|(
operator|&
name|w
argument_list|)
expr_stmt|;
return|return
name|initComplexMenuBar
argument_list|(
name|w
operator|.
name|menuBar
argument_list|()
argument_list|)
return|;
block|}
end_function
begin_comment
comment|// On Mac/WinCE, native key events are needed to test menu action activation
end_comment
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|Q_OS_MAC
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
end_if
begin_function
DECL|function|accel
name|void
name|tst_QMenuBar
operator|::
name|accel
parameter_list|()
block|{
comment|// create a popup menu with menu items set the accelerators later...
name|QMainWindow
name|w
decl_stmt|;
specifier|const
name|TestMenu
name|menu
init|=
name|initWindowWithSimpleMenuBar
argument_list|(
name|w
argument_list|)
decl_stmt|;
name|w
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|w
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|w
argument_list|)
argument_list|)
expr_stmt|;
comment|// shortcuts won't work unless the window is active
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_A
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|300
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_lastSimpleAcceleratorId
argument_list|,
name|menu
operator|.
name|actions
operator|.
name|front
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|// On Mac/WinCE, native key events are needed to test menu action activation
end_comment
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|Q_OS_MAC
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
end_if
begin_function
DECL|function|activatedCount
name|void
name|tst_QMenuBar
operator|::
name|activatedCount
parameter_list|()
block|{
comment|// create a popup menu with menu items set the accelerators later...
name|QMainWindow
name|w
decl_stmt|;
name|initWindowWithSimpleMenuBar
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|w
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|w
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|w
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_A
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|)
expr_stmt|;
comment|//wait(5000);
name|QCOMPARE
argument_list|(
name|m_simpleActivatedCount
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|//1 from the popupmenu and 1 from the menubar
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_function
DECL|function|clear
name|void
name|tst_QMenuBar
operator|::
name|clear
parameter_list|()
block|{
name|QMenuBar
name|menuBar
decl_stmt|;
name|initSimpleMenuBar
argument_list|(
operator|&
name|menuBar
argument_list|)
expr_stmt|;
name|menuBar
operator|.
name|clear
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menuBar
operator|.
name|actions
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|menuBar
operator|.
name|clear
argument_list|()
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
name|i
operator|++
control|)
block|{
name|QMenu
modifier|*
name|menu
init|=
name|menuBar
operator|.
name|addMenu
argument_list|(
name|QStringLiteral
argument_list|(
literal|"Menu "
argument_list|)
operator|+
name|QString
operator|::
name|number
argument_list|(
name|i
argument_list|)
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|k
init|=
literal|0
init|;
name|k
operator|<
name|i
condition|;
name|k
operator|++
control|)
name|menu
operator|->
name|addAction
argument_list|(
name|QStringLiteral
argument_list|(
literal|"Item "
argument_list|)
operator|+
name|QString
operator|::
name|number
argument_list|(
name|k
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menuBar
operator|.
name|actions
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|menuBar
operator|.
name|actions
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|menuBar
operator|.
name|clear
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menuBar
operator|.
name|actions
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|count
name|void
name|tst_QMenuBar
operator|::
name|count
parameter_list|()
block|{
name|QMenuBar
name|menuBar
decl_stmt|;
name|QCOMPARE
argument_list|(
name|menuBar
operator|.
name|actions
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
name|i
operator|++
control|)
block|{
name|menuBar
operator|.
name|addAction
argument_list|(
name|QStringLiteral
argument_list|(
literal|"Menu "
argument_list|)
operator|+
name|QString
operator|::
name|number
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menuBar
operator|.
name|actions
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|removeItem_data
name|void
name|tst_QMenuBar
operator|::
name|removeItem_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"removeIndex"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"first"
argument_list|)
operator|<<
literal|0
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"middle"
argument_list|)
operator|<<
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"last"
argument_list|)
operator|<<
literal|2
expr_stmt|;
block|}
end_function
begin_comment
comment|// Basically the same test as removeItemAt, except that we remember and remove id's.
end_comment
begin_function
DECL|function|removeItem
name|void
name|tst_QMenuBar
operator|::
name|removeItem
parameter_list|()
block|{
name|QMenuBar
name|menuBar
decl_stmt|;
name|QMenu
modifier|*
name|pm
init|=
operator|new
name|QMenu
argument_list|(
literal|"stuff"
argument_list|,
operator|&
name|menuBar
argument_list|)
decl_stmt|;
name|pm
operator|->
name|setTitle
argument_list|(
literal|"Menu 1"
argument_list|)
expr_stmt|;
name|pm
operator|->
name|addAction
argument_list|(
name|QString
argument_list|(
literal|"Item 10"
argument_list|)
argument_list|)
expr_stmt|;
name|QAction
modifier|*
name|action1
init|=
name|menuBar
operator|.
name|addMenu
argument_list|(
name|pm
argument_list|)
decl_stmt|;
name|pm
operator|=
operator|new
name|QMenu
argument_list|(
operator|&
name|menuBar
argument_list|)
expr_stmt|;
name|pm
operator|->
name|setTitle
argument_list|(
literal|"Menu 2"
argument_list|)
expr_stmt|;
name|pm
operator|->
name|addAction
argument_list|(
name|QString
argument_list|(
literal|"Item 20"
argument_list|)
argument_list|)
expr_stmt|;
name|pm
operator|->
name|addAction
argument_list|(
name|QString
argument_list|(
literal|"Item 21"
argument_list|)
argument_list|)
expr_stmt|;
name|QAction
modifier|*
name|action2
init|=
name|menuBar
operator|.
name|addMenu
argument_list|(
name|pm
argument_list|)
decl_stmt|;
name|pm
operator|=
operator|new
name|QMenu
argument_list|(
literal|"Menu 3"
argument_list|,
operator|&
name|menuBar
argument_list|)
expr_stmt|;
name|pm
operator|->
name|addAction
argument_list|(
name|QString
argument_list|(
literal|"Item 30"
argument_list|)
argument_list|)
expr_stmt|;
name|pm
operator|->
name|addAction
argument_list|(
name|QString
argument_list|(
literal|"Item 31"
argument_list|)
argument_list|)
expr_stmt|;
name|pm
operator|->
name|addAction
argument_list|(
name|QString
argument_list|(
literal|"Item 32"
argument_list|)
argument_list|)
expr_stmt|;
name|QAction
modifier|*
name|action3
init|=
name|menuBar
operator|.
name|addMenu
argument_list|(
name|pm
argument_list|)
decl_stmt|;
specifier|const
name|QList
argument_list|<
name|QAction
modifier|*
argument_list|>
name|menuBarActions
init|=
name|menuBar
operator|.
name|actions
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|action1
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 1"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|action2
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 2"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|action3
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 3"
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|menuBarActions
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|==
name|action1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|menuBarActions
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|==
name|action2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|menuBarActions
operator|.
name|at
argument_list|(
literal|2
argument_list|)
operator|==
name|action3
argument_list|)
expr_stmt|;
comment|// Ok, now that we know we have created the menu we expect, lets remove an item...
name|QFETCH
argument_list|(
name|int
argument_list|,
name|removeIndex
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|removeIndex
condition|)
block|{
case|case
literal|0
case|:
block|{
name|menuBar
operator|.
name|removeAction
argument_list|(
name|action1
argument_list|)
expr_stmt|;
specifier|const
name|QList
argument_list|<
name|QAction
modifier|*
argument_list|>
name|menuBarActions2
init|=
name|menuBar
operator|.
name|actions
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|menuBarActions2
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 2"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menuBarActions2
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 3"
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|1
case|:
block|{
name|menuBar
operator|.
name|removeAction
argument_list|(
name|action2
argument_list|)
expr_stmt|;
specifier|const
name|QList
argument_list|<
name|QAction
modifier|*
argument_list|>
name|menuBarActions2
init|=
name|menuBar
operator|.
name|actions
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|menuBarActions2
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 1"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menuBarActions2
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 3"
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|2
case|:
block|{
name|menuBar
operator|.
name|removeAction
argument_list|(
name|action3
argument_list|)
expr_stmt|;
specifier|const
name|QList
argument_list|<
name|QAction
modifier|*
argument_list|>
name|menuBarActions2
init|=
name|menuBar
operator|.
name|actions
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|menuBarActions2
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 1"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menuBarActions2
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 2"
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
name|QList
argument_list|<
name|QAction
modifier|*
argument_list|>
name|menuBarActions2
init|=
name|menuBar
operator|.
name|actions
argument_list|()
decl_stmt|;
name|QVERIFY
argument_list|(
name|menuBarActions2
operator|.
name|size
argument_list|()
operator|==
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|removeItemAt_data
name|void
name|tst_QMenuBar
operator|::
name|removeItemAt_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"removeIndex"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"first"
argument_list|)
operator|<<
literal|0
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"middle"
argument_list|)
operator|<<
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"last"
argument_list|)
operator|<<
literal|2
expr_stmt|;
block|}
end_function
begin_function
DECL|function|removeItemAt
name|void
name|tst_QMenuBar
operator|::
name|removeItemAt
parameter_list|()
block|{
name|QMenuBar
name|menuBar
decl_stmt|;
name|QMenu
modifier|*
name|pm
init|=
operator|new
name|QMenu
argument_list|(
literal|"Menu 1"
argument_list|,
operator|&
name|menuBar
argument_list|)
decl_stmt|;
name|pm
operator|->
name|addAction
argument_list|(
name|QString
argument_list|(
literal|"Item 10"
argument_list|)
argument_list|)
expr_stmt|;
name|menuBar
operator|.
name|addMenu
argument_list|(
name|pm
argument_list|)
expr_stmt|;
name|pm
operator|=
operator|new
name|QMenu
argument_list|(
literal|"Menu 2"
argument_list|,
operator|&
name|menuBar
argument_list|)
expr_stmt|;
name|pm
operator|->
name|addAction
argument_list|(
name|QString
argument_list|(
literal|"Item 20"
argument_list|)
argument_list|)
expr_stmt|;
name|pm
operator|->
name|addAction
argument_list|(
name|QString
argument_list|(
literal|"Item 21"
argument_list|)
argument_list|)
expr_stmt|;
name|menuBar
operator|.
name|addMenu
argument_list|(
name|pm
argument_list|)
expr_stmt|;
name|pm
operator|=
operator|new
name|QMenu
argument_list|(
literal|"Menu 3"
argument_list|,
operator|&
name|menuBar
argument_list|)
expr_stmt|;
name|pm
operator|->
name|addAction
argument_list|(
name|QString
argument_list|(
literal|"Item 30"
argument_list|)
argument_list|)
expr_stmt|;
name|pm
operator|->
name|addAction
argument_list|(
name|QString
argument_list|(
literal|"Item 31"
argument_list|)
argument_list|)
expr_stmt|;
name|pm
operator|->
name|addAction
argument_list|(
name|QString
argument_list|(
literal|"Item 32"
argument_list|)
argument_list|)
expr_stmt|;
name|menuBar
operator|.
name|addMenu
argument_list|(
name|pm
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QAction
modifier|*
argument_list|>
name|menuBarActions
init|=
name|menuBar
operator|.
name|actions
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|menuBarActions
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 1"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menuBarActions
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 2"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menuBarActions
operator|.
name|at
argument_list|(
literal|2
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 3"
argument_list|)
argument_list|)
expr_stmt|;
comment|// Ok, now that we know we have created the menu we expect, lets remove an item...
name|QFETCH
argument_list|(
name|int
argument_list|,
name|removeIndex
argument_list|)
expr_stmt|;
name|menuBar
operator|.
name|removeAction
argument_list|(
name|menuBarActions
operator|.
name|at
argument_list|(
name|removeIndex
argument_list|)
argument_list|)
expr_stmt|;
specifier|const
name|QList
argument_list|<
name|QAction
modifier|*
argument_list|>
name|menuBarActions2
init|=
name|menuBar
operator|.
name|actions
argument_list|()
decl_stmt|;
switch|switch
condition|(
name|removeIndex
condition|)
block|{
case|case
literal|0
case|:
name|QCOMPARE
argument_list|(
name|menuBarActions2
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 2"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menuBarActions2
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 3"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|QCOMPARE
argument_list|(
name|menuBarActions2
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 1"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menuBarActions2
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 3"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|QCOMPARE
argument_list|(
name|menuBarActions2
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 1"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menuBarActions2
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu 2"
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
name|QVERIFY
argument_list|(
name|menuBarActions2
operator|.
name|size
argument_list|()
operator|==
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|/*     Check the insert functions that create menu items.     For the moment i only check the strings and pixmaps. The rest are special cases which are     used less frequently. */
end_comment
begin_function
DECL|function|insertItem_QString_QObject
name|void
name|tst_QMenuBar
operator|::
name|insertItem_QString_QObject
parameter_list|()
block|{
name|QMenuBar
name|menuBar
decl_stmt|;
name|initComplexMenuBar
argument_list|(
operator|&
name|menuBar
argument_list|)
expr_stmt|;
specifier|const
name|QList
argument_list|<
name|QAction
modifier|*
argument_list|>
name|actions
init|=
name|menuBar
operator|.
name|actions
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|actions
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu&1"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|actions
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Menu&2"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|actions
operator|.
name|at
argument_list|(
literal|2
argument_list|)
operator|->
name|text
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"M&enu 3"
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|actions
operator|.
name|size
argument_list|()
operator|<
literal|4
argument_list|)
expr_stmt|;
comment|// there is no menu 4!
block|}
end_function
begin_comment
comment|// On Mac/WinCE, native key events are needed to test menu action activation
end_comment
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|Q_OS_MAC
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
end_if
begin_function
DECL|function|check_accelKeys
name|void
name|tst_QMenuBar
operator|::
name|check_accelKeys
parameter_list|()
block|{
name|QMainWindow
name|w
decl_stmt|;
name|initWindowWithComplexMenuBar
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|w
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|w
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|w
argument_list|)
argument_list|)
expr_stmt|;
comment|// start with a bogus key that shouldn't trigger anything
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_I
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|1
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|2
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|3
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|4
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'a'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'b'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'c'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'d'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_A
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|1
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|2
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|3
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|4
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'a'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'b'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'c'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'d'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_C
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|1
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|2
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|3
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|4
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'a'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'b'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'c'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'d'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_B
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|1
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|2
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|3
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|4
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'a'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'b'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'c'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'d'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_D
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|1
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|2
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|3
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|4
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'a'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'b'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'c'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'d'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_J
argument_list|,
name|Qt
operator|::
name|AltModifier
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|1
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|2
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|3
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|4
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'a'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'b'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'c'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'d'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|// On Mac/WinCE, native key events are needed to test menu action activation
end_comment
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|Q_OS_MAC
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
end_if
begin_function
DECL|function|check_cursorKeys1
name|void
name|tst_QMenuBar
operator|::
name|check_cursorKeys1
parameter_list|()
block|{
name|QMainWindow
name|w
decl_stmt|;
name|initWindowWithComplexMenuBar
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|w
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|w
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|w
argument_list|)
argument_list|)
expr_stmt|;
comment|// start with a ALT + 1 that activates the first popupmenu
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_1
argument_list|,
name|Qt
operator|::
name|AltModifier
argument_list|)
expr_stmt|;
comment|// the Popupmenu should be visible now
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|3
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|4
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'a'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'b'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'c'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'d'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Simulate a cursor key down click
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Down
argument_list|)
expr_stmt|;
comment|// and an Enter key
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Enter
argument_list|)
expr_stmt|;
comment|// Let's see if the correct slot is called...
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|3
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|4
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'a'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// this shouldn't have been called
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'b'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// and this should have been called by a signal now
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'c'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'d'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|// Qt/Mac,WinCE does not use the native popups/menubar
end_comment
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|Q_OS_MAC
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
end_if
begin_function
DECL|function|check_cursorKeys2
name|void
name|tst_QMenuBar
operator|::
name|check_cursorKeys2
parameter_list|()
block|{
name|QMainWindow
name|w
decl_stmt|;
name|initWindowWithComplexMenuBar
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|w
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|w
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|w
argument_list|)
argument_list|)
expr_stmt|;
comment|// select popupmenu2
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_2
argument_list|,
name|Qt
operator|::
name|AltModifier
argument_list|)
expr_stmt|;
comment|// Simulate some cursor keys
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Left
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Down
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Right
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Down
argument_list|)
expr_stmt|;
comment|// and an Enter key
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Enter
argument_list|)
expr_stmt|;
comment|// Let's see if the correct slot is called...
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|3
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|4
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'a'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// this shouldn't have been caled
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'b'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// and this should have been called by a signal ow
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'c'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'d'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/*!     If a popupmenu is active you can use Left to move to the menu to the left of it. */
end_comment
begin_comment
comment|// Qt/Mac,WinCE does not use the native popups/menubar
end_comment
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|Q_OS_MAC
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
end_if
begin_function
DECL|function|check_cursorKeys3
name|void
name|tst_QMenuBar
operator|::
name|check_cursorKeys3
parameter_list|()
block|{
name|QMainWindow
name|w
decl_stmt|;
name|initWindowWithComplexMenuBar
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|w
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|w
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|w
argument_list|)
argument_list|)
expr_stmt|;
comment|// select Popupmenu 2
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_2
argument_list|,
name|Qt
operator|::
name|AltModifier
argument_list|)
expr_stmt|;
comment|// Simulate some keys
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Left
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Down
argument_list|)
expr_stmt|;
comment|// and press ENTER
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Enter
argument_list|)
expr_stmt|;
comment|// Let's see if the correct slot is called...
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|3
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|4
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'a'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// this shouldn't have been called
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'b'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// and this should have been called by a signal now
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'c'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'d'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/*!     If a popupmenu is active you can use home to go quickly to the first item in the menu. */
end_comment
begin_function
DECL|function|check_homeKey
name|void
name|tst_QMenuBar
operator|::
name|check_homeKey
parameter_list|()
block|{
comment|// I'm temporarily shutting up this testcase.
comment|// Seems like the behaviour i'm expecting isn't ok.
name|QVERIFY
argument_list|(
literal|true
argument_list|)
expr_stmt|;
return|return;
name|QEXPECT_FAIL
argument_list|(
literal|"0"
argument_list|,
literal|"Popupmenu should respond to a Home key"
argument_list|,
name|Abort
argument_list|)
expr_stmt|;
name|QMainWindow
name|w
decl_stmt|;
name|initWindowWithComplexMenuBar
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|w
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|w
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|w
argument_list|)
argument_list|)
expr_stmt|;
comment|// select Popupmenu 2
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_2
argument_list|,
name|Qt
operator|::
name|AltModifier
argument_list|)
expr_stmt|;
comment|// Simulate some keys
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Down
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Down
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Down
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Home
argument_list|)
expr_stmt|;
comment|// and press ENTER
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Enter
argument_list|)
expr_stmt|;
comment|// Let's see if the correct slot is called...
comment|//    QVERIFY2( m_complexActionTriggerCount[int('c')] == 1, "Popupmenu should respond to a Home key" );
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'c'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|3
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|4
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'a'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'b'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'d'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'e'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'f'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'g'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'h'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|/*!     If a popupmenu is active you can use end to go quickly to the last item in the menu. */
end_comment
begin_function
DECL|function|check_endKey
name|void
name|tst_QMenuBar
operator|::
name|check_endKey
parameter_list|()
block|{
comment|// I'm temporarily silenting this testcase.
comment|// Seems like the behaviour i'm expecting isn't ok.
name|QVERIFY
argument_list|(
literal|true
argument_list|)
expr_stmt|;
return|return;
name|QEXPECT_FAIL
argument_list|(
literal|"0"
argument_list|,
literal|"Popupmenu should respond to an End key"
argument_list|,
name|Abort
argument_list|)
expr_stmt|;
name|QMainWindow
name|w
decl_stmt|;
name|initWindowWithComplexMenuBar
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|w
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|w
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|w
argument_list|)
argument_list|)
expr_stmt|;
comment|// select Popupmenu 2
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_2
argument_list|,
name|Qt
operator|::
name|AltModifier
argument_list|)
expr_stmt|;
comment|// Simulate some keys
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_End
argument_list|)
expr_stmt|;
comment|// and press ENTER
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Enter
argument_list|)
expr_stmt|;
comment|// Let's see if the correct slot is called...
comment|//    QVERIFY2( m_complexActionTriggerCount[int('h')] == 1, "Popupmenu should respond to an End key" );
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'h'
argument_list|)
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//, "Popupmenu should respond to an End key");
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|3
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|4
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'a'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'b'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'c'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'d'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'e'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'f'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'g'
argument_list|)
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|/*!     If a popupmenu is active you can use esc to hide the menu and then the     menubar should become active.     If Down is pressed next the popup is activated again. */
end_comment
begin_comment
comment|// Qt/Mac,WinCE does not use the native popups/menubar
end_comment
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|Q_OS_MAC
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
end_if
begin_function
DECL|function|check_escKey
name|void
name|tst_QMenuBar
operator|::
name|check_escKey
parameter_list|()
block|{
name|QMainWindow
name|w
decl_stmt|;
specifier|const
name|TestMenu
name|menu
init|=
name|initWindowWithComplexMenuBar
argument_list|(
name|w
argument_list|)
decl_stmt|;
name|w
operator|.
name|show
argument_list|()
expr_stmt|;
name|w
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|w
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|w
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|menu
operator|.
name|menus
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|menu
operator|.
name|menus
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
comment|// select Popupmenu 2
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_2
argument_list|,
name|Qt
operator|::
name|AltModifier
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|menu
operator|.
name|menus
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|menu
operator|.
name|menus
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
comment|// If we press ESC, the popup should disappear
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Escape
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|menu
operator|.
name|menus
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|menu
operator|.
name|menus
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|QApplication
operator|::
name|style
argument_list|()
operator|->
name|inherits
argument_list|(
literal|"QWindowsStyle"
argument_list|)
condition|)
return|return;
comment|// If we press Down the popupmenu should be active again
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Down
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|menu
operator|.
name|menus
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|menu
operator|.
name|menus
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
comment|// and press ENTER
name|QTest
operator|::
name|keyClick
argument_list|(
name|menu
operator|.
name|menus
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Enter
argument_list|)
expr_stmt|;
comment|// Let's see if the correct slot is called...
name|QVERIFY2
argument_list|(
name|m_complexTriggerCount
index|[
name|int
argument_list|(
literal|'c'
argument_list|)
index|]
operator|==
literal|1
argument_list|,
literal|"Expected item 2C to be selected"
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|// void tst_QMenuBar::check_mouse1_data()
end_comment
begin_comment
comment|// {
end_comment
begin_comment
comment|//     QTest::addColumn<QString>("popup_item");
end_comment
begin_comment
comment|//     QTest::addColumn<int>("itemA_count");
end_comment
begin_comment
comment|//     QTest::addColumn<int>("itemB_count");
end_comment
begin_comment
comment|//     QTest::newRow( "A" )<< QString( "Item A Ctrl+A" )<< 1<< 0;
end_comment
begin_comment
comment|//     QTest::newRow( "B" )<< QString( "Item B Ctrl+B" )<< 0<< 1;
end_comment
begin_comment
comment|// }
end_comment
begin_comment
comment|// /*!
end_comment
begin_comment
comment|//     Check if the correct signals are emitted if we select a popupmenu.
end_comment
begin_comment
comment|// */
end_comment
begin_comment
comment|// void tst_QMenuBar::check_mouse1()
end_comment
begin_comment
comment|// {
end_comment
begin_comment
comment|//     if (QSystem::curStyle() == "Motif")
end_comment
begin_comment
comment|//         QSKIP("This fails in Motif due to a bug in the testing framework");
end_comment
begin_comment
comment|//     QFETCH( QString, popup_item );
end_comment
begin_comment
comment|//     QFETCH( int, itemA_count );
end_comment
begin_comment
comment|//     QFETCH( int, itemB_count );
end_comment
begin_comment
comment|// //    initComplexMenubar();
end_comment
begin_comment
comment|//     QVERIFY( !pm1->isActiveWindow() );
end_comment
begin_comment
comment|//     QVERIFY( !pm2->isActiveWindow() );
end_comment
begin_comment
comment|//     QTest::qWait(1000);
end_comment
begin_comment
comment|//     QtTestMouse mouse;
end_comment
begin_comment
comment|//     mouse.mouseEvent( QtTestMouse::MouseClick, mb, "Menu&1", Qt::LeftButton );
end_comment
begin_comment
comment|//     QVERIFY( pm1->isActiveWindow() );
end_comment
begin_comment
comment|//     QVERIFY( !pm2->isActiveWindow() );
end_comment
begin_comment
comment|//     QTest::qWait(1000);
end_comment
begin_comment
comment|//     mouse.mouseEvent( QtTestMouse::MouseClick, pm1, popup_item, Qt::LeftButton );
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount[3], 0);
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount[4], 0);
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount['a'], (uint)itemA_count); // this option should have fired
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount['b'], (uint)itemB_count);
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount['c'], 0);
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount['d'], 0);
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount['e'], 0);
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount['f'], 0);
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount['g'], 0);
end_comment
begin_comment
comment|// }
end_comment
begin_comment
comment|// void tst_QMenuBar::check_mouse2_data()
end_comment
begin_comment
comment|// {
end_comment
begin_comment
comment|//     QTest::addColumn<QString>("label");
end_comment
begin_comment
comment|//     QTest::addColumn<int>("itemA_count");
end_comment
begin_comment
comment|//     QTest::addColumn<int>("itemB_count");
end_comment
begin_comment
comment|//     QTest::addColumn<int>("itemC_count");
end_comment
begin_comment
comment|//     QTest::addColumn<int>("itemD_count");
end_comment
begin_comment
comment|//     QTest::addColumn<int>("itemE_count");
end_comment
begin_comment
comment|//     QTest::addColumn<int>("itemF_count");
end_comment
begin_comment
comment|//     QTest::addColumn<int>("itemG_count");
end_comment
begin_comment
comment|//     QTest::addColumn<int>("itemH_count");
end_comment
begin_comment
comment|//     QTest::addColumn<int>("menu3_count");
end_comment
begin_comment
comment|//     QTest::newRow( "A" )<< QString( "Menu&1/Item A Ctrl+A" )<< 1<< 0<< 0<< 0<< 0<< 0<< 0<< 0<< 0;
end_comment
begin_comment
comment|//     QTest::newRow( "B" )<< QString( "Menu&1/Item B Ctrl+B" )<< 0<< 1<< 0<< 0<< 0<< 0<< 0<< 0<< 0;
end_comment
begin_comment
comment|//     QTest::newRow( "C" )<< QString( "Menu&2/Item C Ctrl+C" )<< 0<< 0<< 1<< 0<< 0<< 0<< 0<< 0<< 0;
end_comment
begin_comment
comment|//     QTest::newRow( "D" )<< QString( "Menu&2/Item D Ctrl+D" )<< 0<< 0<< 0<< 1<< 0<< 0<< 0<< 0<< 0;
end_comment
begin_comment
comment|//     QTest::newRow( "E" )<< QString( "Menu&2/Item E Ctrl+E" )<< 0<< 0<< 0<< 0<< 1<< 0<< 0<< 0<< 0;
end_comment
begin_comment
comment|//     QTest::newRow( "F" )<< QString( "Menu&2/Item F Ctrl+F" )<< 0<< 0<< 0<< 0<< 0<< 1<< 0<< 0<< 0;
end_comment
begin_comment
comment|//     QTest::newRow( "G" )<< QString( "Menu&2/Item G Ctrl+G" )<< 0<< 0<< 0<< 0<< 0<< 0<< 1<< 0<< 0;
end_comment
begin_comment
comment|//     QTest::newRow( "H" )<< QString( "Menu&2/Item H Ctrl+H" )<< 0<< 0<< 0<< 0<< 0<< 0<< 0<< 1<< 0;
end_comment
begin_comment
comment|//     QTest::newRow( "menu 3" )<< QString( "M&enu 3" )<< 0<< 0<< 0<< 0<< 0<< 0<< 0<< 0<< 1;
end_comment
begin_comment
comment|// }
end_comment
begin_comment
comment|// /*!
end_comment
begin_comment
comment|//     Check if the correct signals are emitted if we select a popupmenu.
end_comment
begin_comment
comment|//     This time, we use a little bit more magic from the testframework.
end_comment
begin_comment
comment|// */
end_comment
begin_comment
comment|// void tst_QMenuBar::check_mouse2()
end_comment
begin_comment
comment|// {
end_comment
begin_comment
comment|//     if (QSystem::curStyle() == "Motif")
end_comment
begin_comment
comment|//         QSKIP("This fails in Motif due to a bug in the testing framework");
end_comment
begin_comment
comment|//     QFETCH( QString, label );
end_comment
begin_comment
comment|//     QFETCH( int, itemA_count );
end_comment
begin_comment
comment|//     QFETCH( int, itemB_count );
end_comment
begin_comment
comment|//     QFETCH( int, itemC_count );
end_comment
begin_comment
comment|//     QFETCH( int, itemD_count );
end_comment
begin_comment
comment|//     QFETCH( int, itemE_count );
end_comment
begin_comment
comment|//     QFETCH( int, itemF_count );
end_comment
begin_comment
comment|//     QFETCH( int, itemG_count );
end_comment
begin_comment
comment|//     QFETCH( int, itemH_count );
end_comment
begin_comment
comment|//     QFETCH( int, menu3_count );
end_comment
begin_comment
comment|// //    initComplexMenubar();
end_comment
begin_comment
comment|//     QtTestMouse mouse;
end_comment
begin_comment
comment|//     mouse.click( QtTestMouse::Menu, label, Qt::LeftButton );
end_comment
begin_comment
comment|//     // check if the correct signals have fired
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount[3], (uint)menu3_count);
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount[4], 0);
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount['a'], (uint)itemA_count);
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount['b'], (uint)itemB_count);
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount['c'], (uint)itemC_count);
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount['d'], (uint)itemD_count);
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount['e'], (uint)itemE_count);
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount['f'], (uint)itemF_count);
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount['g'], (uint)itemG_count);
end_comment
begin_comment
comment|//     QCOMPARE(m_complexActionTriggerCount['h'], (uint)itemH_count);
end_comment
begin_comment
comment|// }
end_comment
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|Q_OS_MAC
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
end_if
begin_function
DECL|function|allowActiveAndDisabled
name|void
name|tst_QMenuBar
operator|::
name|allowActiveAndDisabled
parameter_list|()
block|{
name|QMenuBar
name|menuBar
decl_stmt|;
comment|// Task 241043 : check that second menu is activated if only
comment|// disabled menu items are added
name|QMenu
name|fileMenu
argument_list|(
literal|"&File"
argument_list|)
decl_stmt|;
comment|// Task 241043 : check that second menu is activated
comment|// if all items are disabled
name|QAction
modifier|*
name|act
init|=
name|fileMenu
operator|.
name|addAction
argument_list|(
literal|"Disabled"
argument_list|)
decl_stmt|;
name|act
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|menuBar
operator|.
name|addMenu
argument_list|(
operator|&
name|fileMenu
argument_list|)
expr_stmt|;
name|QMenu
name|disabledMenu
argument_list|(
literal|"Disabled"
argument_list|)
decl_stmt|;
name|disabledMenu
operator|.
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QMenu
name|activeMenu
argument_list|(
literal|"Active"
argument_list|)
decl_stmt|;
name|menuBar
operator|.
name|addMenu
argument_list|(
operator|&
name|disabledMenu
argument_list|)
expr_stmt|;
name|menuBar
operator|.
name|addMenu
argument_list|(
operator|&
name|activeMenu
argument_list|)
expr_stmt|;
name|centerOnScreen
argument_list|(
operator|&
name|menuBar
argument_list|)
expr_stmt|;
name|menuBar
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|menuBar
argument_list|)
argument_list|)
expr_stmt|;
comment|// Here we verify that AllowActiveAndDisabled correctly skips
comment|// the disabled menu entry
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|menuBar
argument_list|,
name|Qt
operator|::
name|Key_F
argument_list|,
name|Qt
operator|::
name|AltModifier
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|fileMenu
argument_list|,
operator|(
name|Qt
operator|::
name|Key_Right
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|qApp
operator|->
name|style
argument_list|()
operator|->
name|styleHint
argument_list|(
name|QStyle
operator|::
name|SH_Menu_AllowActiveAndDisabled
argument_list|)
condition|)
name|QCOMPARE
argument_list|(
name|menuBar
operator|.
name|activeAction
argument_list|()
operator|->
name|text
argument_list|()
argument_list|,
name|disabledMenu
operator|.
name|title
argument_list|()
argument_list|)
expr_stmt|;
else|else
name|QCOMPARE
argument_list|(
name|menuBar
operator|.
name|activeAction
argument_list|()
operator|->
name|text
argument_list|()
argument_list|,
name|activeMenu
operator|.
name|title
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|menuBar
argument_list|,
operator|(
name|Qt
operator|::
name|Key_Left
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|qApp
operator|->
name|style
argument_list|()
operator|->
name|styleHint
argument_list|(
name|QStyle
operator|::
name|SH_Menu_AllowActiveAndDisabled
argument_list|)
condition|)
name|QCOMPARE
argument_list|(
name|menuBar
operator|.
name|activeAction
argument_list|()
operator|->
name|text
argument_list|()
argument_list|,
name|fileMenu
operator|.
name|title
argument_list|()
argument_list|)
expr_stmt|;
else|else
name|QCOMPARE
argument_list|(
name|menuBar
operator|.
name|activeAction
argument_list|()
operator|->
name|text
argument_list|()
argument_list|,
name|fileMenu
operator|.
name|title
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_function
DECL|function|check_altPress
name|void
name|tst_QMenuBar
operator|::
name|check_altPress
parameter_list|()
block|{
if|if
condition|(
operator|!
name|qApp
operator|->
name|style
argument_list|()
operator|->
name|styleHint
argument_list|(
name|QStyle
operator|::
name|SH_MenuBar_AltKeyNavigation
argument_list|)
condition|)
block|{
name|QSKIP
argument_list|(
name|QString
argument_list|(
literal|"this is not supposed to work in the %1 style. Skipping."
argument_list|)
operator|.
name|arg
argument_list|(
name|qApp
operator|->
name|style
argument_list|()
operator|->
name|objectName
argument_list|()
argument_list|)
operator|.
name|toLatin1
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|QMainWindow
name|w
decl_stmt|;
name|initWindowWithSimpleMenuBar
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|w
operator|.
name|show
argument_list|()
expr_stmt|;
name|w
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|w
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|w
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|w
argument_list|,
name|Qt
operator|::
name|Key_Alt
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|::
name|qobject_cast
argument_list|<
name|QMenuBar
operator|*
argument_list|>
argument_list|(
name|qApp
operator|->
name|focusWidget
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// QTBUG-47377: Pressing 'Alt' after opening a menu by pressing 'Alt+Accelerator'
end_comment
begin_comment
comment|// should close it and QMenuBar::activeAction() should be 0.
end_comment
begin_function
DECL|function|check_altClosePress
name|void
name|tst_QMenuBar
operator|::
name|check_altClosePress
parameter_list|()
block|{
specifier|const
name|QStyle
modifier|*
name|style
init|=
name|QApplication
operator|::
name|style
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|style
operator|->
name|styleHint
argument_list|(
name|QStyle
operator|::
name|SH_MenuBar_AltKeyNavigation
argument_list|)
condition|)
block|{
name|QSKIP
argument_list|(
operator|(
literal|"This test is not supposed to work in the "
operator|+
name|style
operator|->
name|objectName
argument_list|()
operator|.
name|toLatin1
argument_list|()
operator|+
literal|" style. Skipping."
operator|)
operator|.
name|constData
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|QMainWindow
name|w
decl_stmt|;
name|w
operator|.
name|setWindowTitle
argument_list|(
name|QTest
operator|::
name|currentTestFunction
argument_list|()
argument_list|)
expr_stmt|;
name|QMenu
modifier|*
name|menuFile
init|=
name|w
operator|.
name|menuBar
argument_list|()
operator|->
name|addMenu
argument_list|(
name|tr
argument_list|(
literal|"&File"
argument_list|)
argument_list|)
decl_stmt|;
name|menuFile
operator|->
name|addAction
argument_list|(
literal|"Quit"
argument_list|)
expr_stmt|;
name|QMenu
modifier|*
name|menuEdit
init|=
name|w
operator|.
name|menuBar
argument_list|()
operator|->
name|addMenu
argument_list|(
name|tr
argument_list|(
literal|"&Edit"
argument_list|)
argument_list|)
decl_stmt|;
name|menuEdit
operator|->
name|addAction
argument_list|(
literal|"Copy"
argument_list|)
expr_stmt|;
name|w
operator|.
name|show
argument_list|()
expr_stmt|;
name|w
operator|.
name|move
argument_list|(
name|QGuiApplication
operator|::
name|primaryScreen
argument_list|()
operator|->
name|availableGeometry
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|w
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|w
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|w
argument_list|,
name|Qt
operator|::
name|Key_F
argument_list|,
name|Qt
operator|::
name|AltModifier
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|menuFile
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
name|menuFile
argument_list|,
name|Qt
operator|::
name|Key_Alt
argument_list|,
name|Qt
operator|::
name|AltModifier
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|menuFile
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|w
operator|.
name|menuBar
argument_list|()
operator|->
name|activeAction
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// Qt/Mac,WinCE does not use the native popups/menubar
end_comment
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|Q_OS_MAC
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
end_if
begin_function
DECL|function|check_shortcutPress
name|void
name|tst_QMenuBar
operator|::
name|check_shortcutPress
parameter_list|()
block|{
name|QMainWindow
name|w
decl_stmt|;
specifier|const
name|TestMenu
name|menu
init|=
name|initWindowWithComplexMenuBar
argument_list|(
name|w
argument_list|)
decl_stmt|;
name|w
operator|.
name|show
argument_list|()
expr_stmt|;
name|w
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|w
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|w
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|3
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|w
argument_list|,
name|Qt
operator|::
name|Key_E
argument_list|,
name|Qt
operator|::
name|AltModifier
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|m_complexTriggerCount
index|[
literal|3
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|w
operator|.
name|menuBar
argument_list|()
operator|->
name|activeAction
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|w
argument_list|,
name|Qt
operator|::
name|Key_1
argument_list|,
name|Qt
operator|::
name|AltModifier
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|menu
operator|.
name|menus
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|w
argument_list|,
name|Qt
operator|::
name|Key_2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|menu
operator|.
name|menus
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_class
DECL|class|LayoutDirectionSaver
class|class
name|LayoutDirectionSaver
block|{
name|Q_DISABLE_COPY
parameter_list|(
name|LayoutDirectionSaver
parameter_list|)
specifier|public
private|:
DECL|function|LayoutDirectionSaver
specifier|explicit
name|LayoutDirectionSaver
parameter_list|(
name|Qt
operator|::
name|LayoutDirection
name|direction
parameter_list|)
member_init_list|:
name|m_oldDirection
argument_list|(
name|qApp
operator|->
name|layoutDirection
argument_list|()
argument_list|)
block|{
name|qApp
operator|->
name|setLayoutDirection
argument_list|(
name|direction
argument_list|)
expr_stmt|;
block|}
DECL|function|~LayoutDirectionSaver
name|~
name|LayoutDirectionSaver
parameter_list|()
block|{
name|qApp
operator|->
name|setLayoutDirection
argument_list|(
name|m_oldDirection
argument_list|)
expr_stmt|;
block|}
private|private:
DECL|member|m_oldDirection
specifier|const
name|Qt
operator|::
name|LayoutDirection
name|m_oldDirection
decl_stmt|;
block|}
class|;
end_class
begin_comment
comment|// Qt/Mac,WinCE does not use the native popups/menubar
end_comment
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|Q_OS_MAC
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
end_if
begin_function
DECL|function|check_menuPosition
name|void
name|tst_QMenuBar
operator|::
name|check_menuPosition
parameter_list|()
block|{
name|QMainWindow
name|w
decl_stmt|;
name|Menu
name|menu
decl_stmt|;
name|menu
operator|.
name|setTitle
argument_list|(
literal|"&menu"
argument_list|)
expr_stmt|;
name|QRect
name|availRect
init|=
name|QApplication
operator|::
name|desktop
argument_list|()
operator|->
name|availableGeometry
argument_list|(
operator|&
name|w
argument_list|)
decl_stmt|;
name|QRect
name|screenRect
init|=
name|QApplication
operator|::
name|desktop
argument_list|()
operator|->
name|screenGeometry
argument_list|(
operator|&
name|w
argument_list|)
decl_stmt|;
while|while
condition|(
name|menu
operator|.
name|sizeHint
argument_list|()
operator|.
name|height
argument_list|()
operator|<
operator|(
name|screenRect
operator|.
name|height
argument_list|()
operator|*
literal|2
operator|/
literal|3
operator|)
condition|)
block|{
name|menu
operator|.
name|addAction
argument_list|(
literal|"item"
argument_list|)
expr_stmt|;
block|}
name|QAction
modifier|*
name|menu_action
init|=
name|w
operator|.
name|menuBar
argument_list|()
operator|->
name|addMenu
argument_list|(
operator|&
name|menu
argument_list|)
decl_stmt|;
name|centerOnScreen
argument_list|(
operator|&
name|w
argument_list|)
expr_stmt|;
name|w
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|w
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|w
argument_list|)
argument_list|)
expr_stmt|;
comment|//the menu should be below the menubar item
block|{
name|w
operator|.
name|move
argument_list|(
name|availRect
operator|.
name|topLeft
argument_list|()
argument_list|)
expr_stmt|;
name|QRect
name|mbItemRect
init|=
name|w
operator|.
name|menuBar
argument_list|()
operator|->
name|actionGeometry
argument_list|(
name|menu_action
argument_list|)
decl_stmt|;
name|mbItemRect
operator|.
name|moveTo
argument_list|(
name|w
operator|.
name|menuBar
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|mbItemRect
operator|.
name|topLeft
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|w
argument_list|,
name|Qt
operator|::
name|Key_M
argument_list|,
name|Qt
operator|::
name|AltModifier
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|menu
operator|.
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menu
operator|.
name|pos
argument_list|()
argument_list|,
name|QPoint
argument_list|(
name|mbItemRect
operator|.
name|x
argument_list|()
argument_list|,
name|mbItemRect
operator|.
name|bottom
argument_list|()
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|menu
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
comment|//the menu should be above the menubar item
block|{
name|w
operator|.
name|move
argument_list|(
literal|0
argument_list|,
name|screenRect
operator|.
name|bottom
argument_list|()
operator|-
name|screenRect
operator|.
name|height
argument_list|()
operator|/
literal|4
argument_list|)
expr_stmt|;
comment|//just leave some place for the menubar
name|QRect
name|mbItemRect
init|=
name|w
operator|.
name|menuBar
argument_list|()
operator|->
name|actionGeometry
argument_list|(
name|menu_action
argument_list|)
decl_stmt|;
name|mbItemRect
operator|.
name|moveTo
argument_list|(
name|w
operator|.
name|menuBar
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|mbItemRect
operator|.
name|topLeft
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|w
argument_list|,
name|Qt
operator|::
name|Key_M
argument_list|,
name|Qt
operator|::
name|AltModifier
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|menu
operator|.
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menu
operator|.
name|pos
argument_list|()
argument_list|,
name|QPoint
argument_list|(
name|mbItemRect
operator|.
name|x
argument_list|()
argument_list|,
name|mbItemRect
operator|.
name|top
argument_list|()
operator|-
name|menu
operator|.
name|height
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|menu
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
comment|//the menu should be on the side of the menubar item and should be "stuck" to the bottom of the screen
block|{
name|w
operator|.
name|move
argument_list|(
literal|0
argument_list|,
name|screenRect
operator|.
name|y
argument_list|()
operator|+
name|screenRect
operator|.
name|height
argument_list|()
operator|/
literal|2
argument_list|)
expr_stmt|;
comment|//put it in the middle
name|QRect
name|mbItemRect
init|=
name|w
operator|.
name|menuBar
argument_list|()
operator|->
name|actionGeometry
argument_list|(
name|menu_action
argument_list|)
decl_stmt|;
name|mbItemRect
operator|.
name|moveTo
argument_list|(
name|w
operator|.
name|menuBar
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|mbItemRect
operator|.
name|topLeft
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|w
argument_list|,
name|Qt
operator|::
name|Key_M
argument_list|,
name|Qt
operator|::
name|AltModifier
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|menu
operator|.
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QPoint
name|firstPoint
init|=
name|QPoint
argument_list|(
name|mbItemRect
operator|.
name|right
argument_list|()
operator|+
literal|1
argument_list|,
name|screenRect
operator|.
name|bottom
argument_list|()
operator|-
name|menu
operator|.
name|height
argument_list|()
operator|+
literal|1
argument_list|)
decl_stmt|;
name|QPoint
name|secondPoint
init|=
name|QPoint
argument_list|(
name|mbItemRect
operator|.
name|right
argument_list|()
operator|+
literal|1
argument_list|,
name|availRect
operator|.
name|bottom
argument_list|()
operator|-
name|menu
operator|.
name|height
argument_list|()
operator|+
literal|1
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|menu
operator|.
name|pos
argument_list|()
operator|==
name|firstPoint
operator|||
name|menu
operator|.
name|pos
argument_list|()
operator|==
name|secondPoint
argument_list|)
expr_stmt|;
name|menu
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
comment|// QTBUG-2596: in RTL, the menu should be stuck at the right of the action geometry
block|{
name|LayoutDirectionSaver
name|directionSaver
argument_list|(
name|Qt
operator|::
name|RightToLeft
argument_list|)
decl_stmt|;
name|menu
operator|.
name|clear
argument_list|()
expr_stmt|;
name|QObject
operator|::
name|connect
argument_list|(
operator|&
name|menu
argument_list|,
name|SIGNAL
argument_list|(
name|aboutToShow
argument_list|()
argument_list|)
argument_list|,
operator|&
name|menu
argument_list|,
name|SLOT
argument_list|(
name|addActions
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QRect
name|mbItemRect
init|=
name|w
operator|.
name|menuBar
argument_list|()
operator|->
name|actionGeometry
argument_list|(
name|menu_action
argument_list|)
decl_stmt|;
name|mbItemRect
operator|.
name|moveTo
argument_list|(
name|w
operator|.
name|menuBar
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|mbItemRect
operator|.
name|topLeft
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|w
argument_list|,
name|Qt
operator|::
name|Key_M
argument_list|,
name|Qt
operator|::
name|AltModifier
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|menu
operator|.
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menu
operator|.
name|geometry
argument_list|()
operator|.
name|right
argument_list|()
argument_list|,
name|mbItemRect
operator|.
name|right
argument_list|()
argument_list|)
expr_stmt|;
name|menu
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
comment|// QTBUG-28031: Click at bottom-right corner.
block|{
name|w
operator|.
name|move
argument_list|(
literal|400
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|LayoutDirectionSaver
name|directionSaver
argument_list|(
name|Qt
operator|::
name|RightToLeft
argument_list|)
decl_stmt|;
name|QMenuBar
modifier|*
name|mb
init|=
name|w
operator|.
name|menuBar
argument_list|()
decl_stmt|;
specifier|const
name|QPoint
name|localPos
init|=
name|mb
operator|->
name|actionGeometry
argument_list|(
name|menu
operator|.
name|menuAction
argument_list|()
argument_list|)
operator|.
name|bottomRight
argument_list|()
operator|-
name|QPoint
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
decl_stmt|;
specifier|const
name|QPoint
name|globalPos
init|=
name|mb
operator|->
name|mapToGlobal
argument_list|(
name|localPos
argument_list|)
decl_stmt|;
name|QCursor
operator|::
name|setPos
argument_list|(
name|globalPos
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|mb
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|localPos
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|menu
operator|.
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menu
operator|.
name|geometry
argument_list|()
operator|.
name|right
argument_list|()
operator|-
literal|1
argument_list|,
name|globalPos
operator|.
name|x
argument_list|()
argument_list|)
expr_stmt|;
name|menu
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
endif|#
directive|endif
comment|// QTEST_NO_CURSOR
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_function
DECL|function|task223138_triggered
name|void
name|tst_QMenuBar
operator|::
name|task223138_triggered
parameter_list|()
block|{
comment|//we create a window with submenus and we check that both menubar and menus get the triggered signal
name|QMainWindow
name|win
decl_stmt|;
name|centerOnScreen
argument_list|(
operator|&
name|win
argument_list|)
expr_stmt|;
name|QMenu
modifier|*
name|menu
init|=
name|win
operator|.
name|menuBar
argument_list|()
operator|->
name|addMenu
argument_list|(
literal|"test"
argument_list|)
decl_stmt|;
name|QAction
modifier|*
name|top
init|=
name|menu
operator|->
name|addAction
argument_list|(
literal|"toplevelaction"
argument_list|)
decl_stmt|;
name|QMenu
modifier|*
name|submenu
init|=
name|menu
operator|->
name|addMenu
argument_list|(
literal|"nested menu"
argument_list|)
decl_stmt|;
name|QAction
modifier|*
name|action
init|=
name|submenu
operator|->
name|addAction
argument_list|(
literal|"nested action"
argument_list|)
decl_stmt|;
name|QSignalSpy
name|menubarSpy
argument_list|(
name|win
operator|.
name|menuBar
argument_list|()
argument_list|,
name|SIGNAL
argument_list|(
name|triggered
argument_list|(
name|QAction
operator|*
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QSignalSpy
name|menuSpy
argument_list|(
name|menu
argument_list|,
name|SIGNAL
argument_list|(
name|triggered
argument_list|(
name|QAction
operator|*
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QSignalSpy
name|submenuSpy
argument_list|(
name|submenu
argument_list|,
name|SIGNAL
argument_list|(
name|triggered
argument_list|(
name|QAction
operator|*
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
comment|//let's trigger the first action
name|top
operator|->
name|trigger
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menubarSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menuSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|submenuSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|menubarSpy
operator|.
name|clear
argument_list|()
expr_stmt|;
name|menuSpy
operator|.
name|clear
argument_list|()
expr_stmt|;
name|submenuSpy
operator|.
name|clear
argument_list|()
expr_stmt|;
comment|//let's trigger the sub action
name|action
operator|->
name|trigger
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menubarSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menuSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|submenuSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task256322_highlight
name|void
name|tst_QMenuBar
operator|::
name|task256322_highlight
parameter_list|()
block|{
name|QMainWindow
name|win
decl_stmt|;
name|win
operator|.
name|menuBar
argument_list|()
operator|->
name|setNativeMenuBar
argument_list|(
literal|false
argument_list|)
expr_stmt|;
comment|//we can't check the geometry of native menubars
name|QMenu
name|menu
decl_stmt|;
name|QAction
modifier|*
name|file
init|=
name|win
operator|.
name|menuBar
argument_list|()
operator|->
name|addMenu
argument_list|(
operator|&
name|menu
argument_list|)
decl_stmt|;
name|file
operator|->
name|setText
argument_list|(
literal|"file"
argument_list|)
expr_stmt|;
name|QMenu
name|menu2
decl_stmt|;
name|QAction
modifier|*
name|file2
init|=
name|win
operator|.
name|menuBar
argument_list|()
operator|->
name|addMenu
argument_list|(
operator|&
name|menu2
argument_list|)
decl_stmt|;
name|file2
operator|->
name|setText
argument_list|(
literal|"file2"
argument_list|)
expr_stmt|;
name|QAction
modifier|*
name|nothing
init|=
name|win
operator|.
name|menuBar
argument_list|()
operator|->
name|addAction
argument_list|(
literal|"nothing"
argument_list|)
decl_stmt|;
name|centerOnScreen
argument_list|(
operator|&
name|win
argument_list|)
expr_stmt|;
name|win
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|win
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|win
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mousePress
argument_list|(
name|win
operator|.
name|menuBar
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|win
operator|.
name|menuBar
argument_list|()
operator|->
name|actionGeometry
argument_list|(
name|file
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseMove
argument_list|(
name|win
operator|.
name|menuBar
argument_list|()
argument_list|,
name|win
operator|.
name|menuBar
argument_list|()
operator|->
name|actionGeometry
argument_list|(
name|file
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseRelease
argument_list|(
name|win
operator|.
name|menuBar
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|win
operator|.
name|menuBar
argument_list|()
operator|->
name|actionGeometry
argument_list|(
name|file
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|menu
operator|.
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|menu2
operator|.
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|win
operator|.
name|menuBar
argument_list|()
operator|->
name|activeAction
argument_list|()
argument_list|,
name|file
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mousePress
argument_list|(
name|win
operator|.
name|menuBar
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|win
operator|.
name|menuBar
argument_list|()
operator|->
name|actionGeometry
argument_list|(
name|file2
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseMove
argument_list|(
name|win
operator|.
name|menuBar
argument_list|()
argument_list|,
name|win
operator|.
name|menuBar
argument_list|()
operator|->
name|actionGeometry
argument_list|(
name|file2
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|menu
operator|.
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|menu2
operator|.
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|win
operator|.
name|menuBar
argument_list|()
operator|->
name|activeAction
argument_list|()
argument_list|,
name|file2
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseRelease
argument_list|(
name|win
operator|.
name|menuBar
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|win
operator|.
name|menuBar
argument_list|()
operator|->
name|actionGeometry
argument_list|(
name|file2
argument_list|)
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QPoint
name|nothingCenter
init|=
name|win
operator|.
name|menuBar
argument_list|()
operator|->
name|actionGeometry
argument_list|(
name|nothing
argument_list|)
operator|.
name|center
argument_list|()
decl_stmt|;
name|QTest
operator|::
name|mousePress
argument_list|(
name|win
operator|.
name|menuBar
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|nothingCenter
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseMove
argument_list|(
name|win
operator|.
name|menuBar
argument_list|()
argument_list|,
name|nothingCenter
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|menu2
operator|.
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|menu
operator|.
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|Q_OS_MAC
if|if
condition|(
operator|(
name|QSysInfo
operator|::
name|MacintoshVersion
operator|>=
name|QSysInfo
operator|::
name|MV_10_7
operator|)
operator|&&
operator|(
name|win
operator|.
name|menuBar
argument_list|()
operator|->
name|activeAction
argument_list|()
operator|!=
name|nothing
operator|)
condition|)
name|QEXPECT_FAIL
argument_list|(
literal|""
argument_list|,
literal|"QTBUG-30565: Unstable test"
argument_list|,
name|Continue
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QTRY_COMPARE
argument_list|(
name|win
operator|.
name|menuBar
argument_list|()
operator|->
name|activeAction
argument_list|()
argument_list|,
name|nothing
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseRelease
argument_list|(
name|win
operator|.
name|menuBar
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|nothingCenter
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|menubarSizeHint
name|void
name|tst_QMenuBar
operator|::
name|menubarSizeHint
parameter_list|()
block|{
struct|struct
name|MyStyle
super|:
specifier|public
name|QProxyStyle
block|{
name|MyStyle
parameter_list|()
member_init_list|:
name|QProxyStyle
argument_list|(
name|QStyleFactory
operator|::
name|create
argument_list|(
literal|"windows"
argument_list|)
argument_list|)
block|{ }
specifier|virtual
name|int
name|pixelMetric
parameter_list|(
name|PixelMetric
name|metric
parameter_list|,
specifier|const
name|QStyleOption
modifier|*
name|option
init|=
literal|0
parameter_list|,
specifier|const
name|QWidget
modifier|*
name|widget
init|=
literal|0
parameter_list|)
specifier|const
block|{
comment|// I chose strange values (prime numbers to be more sure that the size of the menubar is correct)
switch|switch
condition|(
name|metric
condition|)
block|{
case|case
name|QStyle
operator|::
name|PM_MenuBarItemSpacing
case|:
return|return
literal|7
return|;
case|case
name|PM_MenuBarHMargin
case|:
return|return
literal|13
return|;
case|case
name|PM_MenuBarVMargin
case|:
return|return
literal|11
return|;
case|case
name|PM_MenuBarPanelWidth
case|:
return|return
literal|1
return|;
default|default:
return|return
name|QProxyStyle
operator|::
name|pixelMetric
argument_list|(
name|metric
argument_list|,
name|option
argument_list|,
name|widget
argument_list|)
return|;
block|}
block|}
block|}
name|style
struct|;
name|QMenuBar
name|mb
decl_stmt|;
name|mb
operator|.
name|setNativeMenuBar
argument_list|(
literal|false
argument_list|)
expr_stmt|;
comment|//we can't check the geometry of native menubars
name|mb
operator|.
name|setStyle
argument_list|(
operator|&
name|style
argument_list|)
expr_stmt|;
comment|//this is a list of arbitrary strings so that we check the geometry
name|QStringList
name|list
init|=
name|QStringList
argument_list|()
operator|<<
literal|"trer"
operator|<<
literal|"ezrfgtgvqd"
operator|<<
literal|"sdgzgzerzerzer"
operator|<<
literal|"eerzertz"
operator|<<
literal|"er"
decl_stmt|;
foreach|foreach
control|(
name|QString
name|str
decl|,
name|list
control|)
name|mb
operator|.
name|addAction
argument_list|(
name|str
argument_list|)
expr_stmt|;
specifier|const
name|int
name|panelWidth
init|=
name|style
operator|.
name|pixelMetric
argument_list|(
name|QStyle
operator|::
name|PM_MenuBarPanelWidth
argument_list|)
decl_stmt|;
specifier|const
name|int
name|hmargin
init|=
name|style
operator|.
name|pixelMetric
argument_list|(
name|QStyle
operator|::
name|PM_MenuBarHMargin
argument_list|)
decl_stmt|;
specifier|const
name|int
name|vmargin
init|=
name|style
operator|.
name|pixelMetric
argument_list|(
name|QStyle
operator|::
name|PM_MenuBarVMargin
argument_list|)
decl_stmt|;
specifier|const
name|int
name|spacing
init|=
name|style
operator|.
name|pixelMetric
argument_list|(
name|QStyle
operator|::
name|PM_MenuBarItemSpacing
argument_list|)
decl_stmt|;
name|centerOnScreen
argument_list|(
operator|&
name|mb
argument_list|)
expr_stmt|;
name|mb
operator|.
name|show
argument_list|()
expr_stmt|;
name|QRect
name|result
decl_stmt|;
foreach|foreach
control|(
name|QAction
modifier|*
name|action
decl|,
name|mb
operator|.
name|actions
argument_list|()
control|)
block|{
specifier|const
name|QRect
name|actionRect
init|=
name|mb
operator|.
name|actionGeometry
argument_list|(
name|action
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|result
operator|.
name|isNull
argument_list|()
condition|)
comment|//this is the first item
name|QCOMPARE
argument_list|(
name|actionRect
operator|.
name|left
argument_list|()
operator|-
name|result
operator|.
name|right
argument_list|()
operator|-
literal|1
argument_list|,
name|spacing
argument_list|)
expr_stmt|;
name|result
operator||=
name|actionRect
expr_stmt|;
name|QCOMPARE
argument_list|(
name|result
operator|.
name|x
argument_list|()
argument_list|,
name|panelWidth
operator|+
name|hmargin
operator|+
name|spacing
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|result
operator|.
name|y
argument_list|()
argument_list|,
name|panelWidth
operator|+
name|vmargin
argument_list|)
expr_stmt|;
block|}
comment|//this code is copied from QMenuBar
comment|//there is no public member that allows to initialize a styleoption instance
name|QStyleOptionMenuItem
name|opt
decl_stmt|;
name|opt
operator|.
name|rect
operator|=
name|mb
operator|.
name|rect
argument_list|()
expr_stmt|;
name|opt
operator|.
name|menuRect
operator|=
name|mb
operator|.
name|rect
argument_list|()
expr_stmt|;
name|opt
operator|.
name|state
operator|=
name|QStyle
operator|::
name|State_None
expr_stmt|;
name|opt
operator|.
name|menuItemType
operator|=
name|QStyleOptionMenuItem
operator|::
name|Normal
expr_stmt|;
name|opt
operator|.
name|checkType
operator|=
name|QStyleOptionMenuItem
operator|::
name|NotCheckable
expr_stmt|;
name|opt
operator|.
name|palette
operator|=
name|mb
operator|.
name|palette
argument_list|()
expr_stmt|;
name|QSize
name|resSize
init|=
name|QSize
argument_list|(
name|result
operator|.
name|x
argument_list|()
argument_list|,
name|result
operator|.
name|y
argument_list|()
argument_list|)
operator|+
name|result
operator|.
name|size
argument_list|()
operator|+
name|QSize
argument_list|(
name|panelWidth
operator|+
name|hmargin
argument_list|,
name|panelWidth
operator|+
name|vmargin
argument_list|)
decl_stmt|;
name|resSize
operator|=
name|style
operator|.
name|sizeFromContents
argument_list|(
name|QStyle
operator|::
name|CT_MenuBar
argument_list|,
operator|&
name|opt
argument_list|,
name|resSize
operator|.
name|expandedTo
argument_list|(
name|QApplication
operator|::
name|globalStrut
argument_list|()
argument_list|)
argument_list|,
operator|&
name|mb
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|resSize
argument_list|,
name|mb
operator|.
name|sizeHint
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// On Mac, do not test the menubar with escape key
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|Q_OS_MAC
end_ifndef
begin_function
DECL|function|taskQTBUG4965_escapeEaten
name|void
name|tst_QMenuBar
operator|::
name|taskQTBUG4965_escapeEaten
parameter_list|()
block|{
name|QMenuBar
name|menubar
decl_stmt|;
name|QMenu
name|menu
argument_list|(
literal|"menu1"
argument_list|)
decl_stmt|;
name|QAction
modifier|*
name|first
init|=
name|menubar
operator|.
name|addMenu
argument_list|(
operator|&
name|menu
argument_list|)
decl_stmt|;
name|menu
operator|.
name|addAction
argument_list|(
literal|"quit"
argument_list|,
operator|&
name|menubar
argument_list|,
name|SLOT
argument_list|(
name|close
argument_list|()
argument_list|)
argument_list|,
name|QKeySequence
argument_list|(
literal|"ESC"
argument_list|)
argument_list|)
expr_stmt|;
name|centerOnScreen
argument_list|(
operator|&
name|menubar
argument_list|)
expr_stmt|;
name|menubar
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|menubar
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|menubar
argument_list|)
argument_list|)
expr_stmt|;
name|menubar
operator|.
name|setActiveAction
argument_list|(
name|first
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|menu
operator|.
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menubar
operator|.
name|activeAction
argument_list|()
argument_list|,
name|first
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|menu
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Escape
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|menu
operator|.
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|menubar
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menubar
operator|.
name|activeAction
argument_list|()
argument_list|,
name|first
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Escape
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|menubar
operator|.
name|activeAction
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Escape
argument_list|)
expr_stmt|;
comment|//now the action should be triggered
name|QTRY_VERIFY
argument_list|(
operator|!
name|menubar
operator|.
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_function
DECL|function|taskQTBUG11823_crashwithInvisibleActions
name|void
name|tst_QMenuBar
operator|::
name|taskQTBUG11823_crashwithInvisibleActions
parameter_list|()
block|{
name|QMenuBar
name|menubar
decl_stmt|;
name|menubar
operator|.
name|setNativeMenuBar
argument_list|(
literal|false
argument_list|)
expr_stmt|;
comment|//we can't check the geometry of native menubars
name|QAction
modifier|*
name|m
init|=
name|menubar
operator|.
name|addAction
argument_list|(
literal|"&m"
argument_list|)
decl_stmt|;
name|QAction
modifier|*
name|a
init|=
name|menubar
operator|.
name|addAction
argument_list|(
literal|"&a"
argument_list|)
decl_stmt|;
name|centerOnScreen
argument_list|(
operator|&
name|menubar
argument_list|)
expr_stmt|;
name|menubar
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|menubar
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|menubar
argument_list|)
argument_list|)
expr_stmt|;
name|menubar
operator|.
name|setActiveAction
argument_list|(
name|m
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menubar
operator|.
name|activeAction
argument_list|()
argument_list|,
name|m
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Right
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menubar
operator|.
name|activeAction
argument_list|()
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Right
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menubar
operator|.
name|activeAction
argument_list|()
argument_list|,
name|m
argument_list|)
expr_stmt|;
name|a
operator|->
name|setVisible
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|menubar
operator|.
name|setActiveAction
argument_list|(
name|m
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menubar
operator|.
name|activeAction
argument_list|()
argument_list|,
name|m
argument_list|)
expr_stmt|;
comment|//the active action shouldn't have changed
comment|//it used to crash here because the action is invisible
name|QTest
operator|::
name|keyClick
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|Key_Right
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menubar
operator|.
name|activeAction
argument_list|()
argument_list|,
name|m
argument_list|)
expr_stmt|;
comment|//the active action shouldn't have changed
block|}
end_function
begin_function
DECL|function|closeOnSecondClickAndOpenOnThirdClick
name|void
name|tst_QMenuBar
operator|::
name|closeOnSecondClickAndOpenOnThirdClick
parameter_list|()
comment|// QTBUG-32807, menu should close on 2nd click.
block|{
name|QMainWindow
name|mainWindow
decl_stmt|;
name|mainWindow
operator|.
name|resize
argument_list|(
literal|300
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|centerOnScreen
argument_list|(
operator|&
name|mainWindow
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|QT_NO_CURSOR
name|QCursor
operator|::
name|setPos
argument_list|(
name|mainWindow
operator|.
name|geometry
argument_list|()
operator|.
name|topLeft
argument_list|()
operator|-
name|QPoint
argument_list|(
literal|100
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QMenuBar
modifier|*
name|menuBar
init|=
name|mainWindow
operator|.
name|menuBar
argument_list|()
decl_stmt|;
name|menuBar
operator|->
name|setNativeMenuBar
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QMenu
modifier|*
name|fileMenu
init|=
name|menuBar
operator|->
name|addMenu
argument_list|(
name|QStringLiteral
argument_list|(
literal|"OpenCloseOpen"
argument_list|)
argument_list|)
decl_stmt|;
name|fileMenu
operator|->
name|addAction
argument_list|(
name|QStringLiteral
argument_list|(
literal|"Quit"
argument_list|)
argument_list|)
expr_stmt|;
name|mainWindow
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|mainWindow
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|mainWindow
argument_list|)
argument_list|)
expr_stmt|;
specifier|const
name|QPoint
name|center
init|=
name|menuBar
operator|->
name|actionGeometry
argument_list|(
name|fileMenu
operator|->
name|menuAction
argument_list|()
argument_list|)
operator|.
name|center
argument_list|()
decl_stmt|;
specifier|const
name|QPoint
name|globalPos
init|=
name|menuBar
operator|->
name|mapToGlobal
argument_list|(
name|center
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|mouseMove
argument_list|(
name|menuBar
argument_list|,
name|center
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|menuBar
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|center
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|fileMenu
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|fileMenu
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|fileMenu
operator|->
name|mapFromGlobal
argument_list|(
name|globalPos
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|fileMenu
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|menuBar
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|center
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|fileMenu
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|Qt::Corner
argument_list|)
end_macro
begin_function
DECL|function|cornerWidgets_data
name|void
name|tst_QMenuBar
operator|::
name|cornerWidgets_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|Qt
operator|::
name|Corner
argument_list|>
argument_list|(
literal|"corner"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"left"
argument_list|)
operator|<<
name|Qt
operator|::
name|TopLeftCorner
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"right"
argument_list|)
operator|<<
name|Qt
operator|::
name|TopRightCorner
expr_stmt|;
block|}
end_function
begin_function
DECL|function|msgComparison
specifier|static
name|QByteArray
name|msgComparison
parameter_list|(
name|int
name|v1
parameter_list|,
specifier|const
name|char
modifier|*
name|op
parameter_list|,
name|int
name|v2
parameter_list|)
block|{
name|QString
name|result
decl_stmt|;
name|QDebug
argument_list|(
operator|&
name|result
argument_list|)
operator|<<
name|v1
operator|<<
name|op
operator|<<
name|v2
operator|<<
literal|"failed"
expr_stmt|;
return|return
name|result
operator|.
name|toLocal8Bit
argument_list|()
return|;
block|}
end_function
begin_function
DECL|function|cornerWidgets
name|void
name|tst_QMenuBar
operator|::
name|cornerWidgets
parameter_list|()
block|{
enum|enum
block|{
name|cornerWidgetWidth
init|=
literal|100
block|}
enum|;
name|QFETCH
argument_list|(
name|Qt
operator|::
name|Corner
argument_list|,
name|corner
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|Q_OS_OSX
argument_list|)
operator|||
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
name|QSKIP
argument_list|(
literal|"Test interferes with native menu bars on this platform"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QWidget
name|widget
decl_stmt|;
specifier|const
name|QString
name|dataTag
init|=
name|QLatin1String
argument_list|(
name|QTest
operator|::
name|currentDataTag
argument_list|()
argument_list|)
decl_stmt|;
name|widget
operator|.
name|setWindowTitle
argument_list|(
name|QLatin1String
argument_list|(
name|QTest
operator|::
name|currentTestFunction
argument_list|()
argument_list|)
operator|+
name|dataTag
argument_list|)
expr_stmt|;
name|QVBoxLayout
modifier|*
name|layout
init|=
operator|new
name|QVBoxLayout
argument_list|(
operator|&
name|widget
argument_list|)
decl_stmt|;
name|QMenuBar
modifier|*
name|menuBar
init|=
operator|new
name|QMenuBar
argument_list|(
operator|&
name|widget
argument_list|)
decl_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|menuBar
argument_list|)
expr_stmt|;
name|QMenu
modifier|*
name|fileMenu
init|=
name|menuBar
operator|->
name|addMenu
argument_list|(
literal|"File"
argument_list|)
decl_stmt|;
name|fileMenu
operator|->
name|addAction
argument_list|(
literal|"Quit"
argument_list|)
expr_stmt|;
name|QMenu
modifier|*
name|editMenu
init|=
name|menuBar
operator|->
name|addMenu
argument_list|(
literal|"Edit"
argument_list|)
decl_stmt|;
name|editMenu
operator|->
name|addAction
argument_list|(
literal|"Copy"
argument_list|)
expr_stmt|;
name|centerOnScreen
argument_list|(
operator|&
name|widget
argument_list|)
expr_stmt|;
name|QLabel
modifier|*
name|cornerLabel
init|=
operator|new
name|QLabel
argument_list|(
name|dataTag
argument_list|)
decl_stmt|;
name|cornerLabel
operator|->
name|setFixedWidth
argument_list|(
name|cornerWidgetWidth
argument_list|)
expr_stmt|;
name|menuBar
operator|->
name|setCornerWidget
argument_list|(
name|cornerLabel
argument_list|,
name|corner
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|menuBar
operator|->
name|cornerWidget
argument_list|(
name|corner
argument_list|)
argument_list|,
name|cornerLabel
argument_list|)
expr_stmt|;
name|widget
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|widget
argument_list|)
argument_list|)
expr_stmt|;
specifier|const
name|QRect
name|fileMenuGeometry
init|=
name|menuBar
operator|->
name|actionGeometry
argument_list|(
name|fileMenu
operator|->
name|menuAction
argument_list|()
argument_list|)
decl_stmt|;
specifier|const
name|QRect
name|editMenuGeometry
init|=
name|menuBar
operator|->
name|actionGeometry
argument_list|(
name|editMenu
operator|->
name|menuAction
argument_list|()
argument_list|)
decl_stmt|;
specifier|const
name|int
name|menuBarWidth
init|=
name|menuBar
operator|->
name|width
argument_list|()
decl_stmt|;
switch|switch
condition|(
name|corner
condition|)
block|{
comment|// QTBUG-36010 , verify corner widget geometry is correct
case|case
name|Qt
operator|::
name|TopLeftCorner
case|:
name|QVERIFY2
argument_list|(
name|fileMenuGeometry
operator|.
name|left
argument_list|()
operator|>=
name|cornerWidgetWidth
argument_list|,
name|msgComparison
argument_list|(
name|fileMenuGeometry
operator|.
name|left
argument_list|()
argument_list|,
literal|">="
argument_list|,
name|cornerWidgetWidth
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY2
argument_list|(
name|menuBarWidth
operator|-
name|editMenuGeometry
operator|.
name|right
argument_list|()
operator|<
name|cornerWidgetWidth
argument_list|,
name|msgComparison
argument_list|(
name|menuBarWidth
operator|-
name|editMenuGeometry
operator|.
name|right
argument_list|()
argument_list|,
literal|"<"
argument_list|,
name|cornerWidgetWidth
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|Qt
operator|::
name|TopRightCorner
case|:
name|QVERIFY2
argument_list|(
name|fileMenuGeometry
operator|.
name|left
argument_list|()
operator|<
name|cornerWidgetWidth
argument_list|,
name|msgComparison
argument_list|(
name|fileMenuGeometry
operator|.
name|left
argument_list|()
argument_list|,
literal|"<"
argument_list|,
name|cornerWidgetWidth
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY2
argument_list|(
name|menuBarWidth
operator|-
name|editMenuGeometry
operator|.
name|right
argument_list|()
operator|>=
name|cornerWidgetWidth
argument_list|,
name|msgComparison
argument_list|(
name|menuBarWidth
operator|-
name|editMenuGeometry
operator|.
name|right
argument_list|()
argument_list|,
literal|">="
argument_list|,
name|cornerWidgetWidth
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
break|break;
block|}
name|menuBar
operator|->
name|setCornerWidget
argument_list|(
literal|0
argument_list|,
name|corner
argument_list|)
expr_stmt|;
comment|// Don't crash.
name|QVERIFY
argument_list|(
operator|!
name|menuBar
operator|->
name|cornerWidget
argument_list|(
name|corner
argument_list|)
argument_list|)
expr_stmt|;
operator|delete
name|cornerLabel
expr_stmt|;
block|}
end_function
begin_function
DECL|function|taskQTBUG53205_crashReparentNested
name|void
name|tst_QMenuBar
operator|::
name|taskQTBUG53205_crashReparentNested
parameter_list|()
block|{
comment|// This test was largely inspired by the test case submitted for the bug
name|QMainWindow
name|mainWindow
decl_stmt|;
name|mainWindow
operator|.
name|resize
argument_list|(
literal|300
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|centerOnScreen
argument_list|(
operator|&
name|mainWindow
argument_list|)
expr_stmt|;
specifier|const
name|TestMenu
name|testMenus
init|=
name|initWindowWithComplexMenuBar
argument_list|(
name|mainWindow
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|mainWindow
argument_list|)
expr_stmt|;
comment|// they can't be windows
name|QWidget
name|hiddenParent
argument_list|(
operator|&
name|mainWindow
argument_list|,
literal|0
argument_list|)
decl_stmt|;
comment|//this one is going to be moved around
name|QWidget
name|movingParent
argument_list|(
operator|&
name|hiddenParent
argument_list|,
literal|0
argument_list|)
decl_stmt|;
comment|//set up the container widget
name|QWidget
name|containerWidget
argument_list|(
operator|&
name|movingParent
argument_list|,
literal|0
argument_list|)
decl_stmt|;
comment|//set the new parent, a window
name|QScopedPointer
argument_list|<
name|QWidget
argument_list|>
name|windowedParent
decl_stmt|;
name|windowedParent
operator|.
name|reset
argument_list|(
operator|new
name|QWidget
argument_list|(
name|Q_NULLPTR
argument_list|,
name|Qt
operator|::
name|WindowFlags
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|windowedParent
operator|->
name|setGeometry
argument_list|(
literal|400
argument_list|,
literal|10
argument_list|,
literal|300
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|windowedParent
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
name|windowedParent
operator|.
name|data
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
comment|//set the "container", can't be a window
name|QWidget
name|containedWidget
argument_list|(
operator|&
name|containerWidget
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|taskQTBUG53205MenuBar
operator|=
operator|new
name|QMenuBar
argument_list|(
operator|&
name|containedWidget
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|testMenus
operator|.
name|actions
index|[
literal|0
index|]
argument_list|,
operator|&
name|QAction
operator|::
name|triggered
argument_list|,
name|this
argument_list|,
operator|&
name|tst_QMenuBar
operator|::
name|slotForTaskQTBUG53205
argument_list|)
expr_stmt|;
comment|//now, move things around
comment|//from : QMainWindow<-hiddenParent<-movingParent<-containerWidget<-containedWidget<-menuBar
comment|//to windowedParent<-movingParent<-containerWidget<-containedWidget<-menuBar
name|movingParent
operator|.
name|setParent
argument_list|(
name|windowedParent
operator|.
name|data
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// this resets the parenting and the menu bar's window
name|taskQTBUG53205MenuBar
operator|->
name|setParent
argument_list|(
name|Q_NULLPTR
argument_list|)
expr_stmt|;
name|taskQTBUG53205MenuBar
operator|->
name|setParent
argument_list|(
operator|&
name|containedWidget
argument_list|)
expr_stmt|;
comment|//from windowedParent<-movingParent<-containerWidget<-containedWidget<-menuBar
comment|//to : QMainWindow<-hiddenParent<-movingParent<-containerWidget<-containedWidget<-menuBar
name|movingParent
operator|.
name|setParent
argument_list|(
operator|&
name|hiddenParent
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|windowedParent
operator|.
name|reset
argument_list|()
expr_stmt|;
comment|//make the old window invalid
comment|// trigger the aciton,  reset the menu bar's window, this used to crash here.
name|testMenus
operator|.
name|actions
index|[
literal|0
index|]
operator|->
name|trigger
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|slotForTaskQTBUG53205
name|void
name|tst_QMenuBar
operator|::
name|slotForTaskQTBUG53205
parameter_list|()
block|{
name|QWidget
modifier|*
name|parent
init|=
name|taskQTBUG53205MenuBar
operator|->
name|parentWidget
argument_list|()
decl_stmt|;
name|taskQTBUG53205MenuBar
operator|->
name|setParent
argument_list|(
name|Q_NULLPTR
argument_list|)
expr_stmt|;
name|taskQTBUG53205MenuBar
operator|->
name|setParent
argument_list|(
name|parent
argument_list|)
expr_stmt|;
block|}
end_function
begin_macro
name|QTEST_MAIN
argument_list|(
argument|tst_QMenuBar
argument_list|)
end_macro
begin_include
include|#
directive|include
file|"tst_qmenubar.moc"
end_include
end_unit
