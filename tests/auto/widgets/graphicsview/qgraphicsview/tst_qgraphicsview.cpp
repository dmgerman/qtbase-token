begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2012 Digia Plc and/or its subsidiary(-ies). ** Contact: http://www.qt-project.org/legal ** ** This file is part of the test suite of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL$ ** Commercial License Usage ** Licensees holding valid commercial Qt licenses may use this file in ** accordance with the commercial license agreement provided with the ** Software or, alternatively, in accordance with the terms contained in ** a written agreement between you and Digia.  For licensing terms and ** conditions see http://qt.digia.com/licensing.  For further information ** use the contact form at http://qt.digia.com/contact-us. ** ** GNU Lesser General Public License Usage ** Alternatively, this file may be used under the terms of the GNU Lesser ** General Public License version 2.1 as published by the Free Software ** Foundation and appearing in the file LICENSE.LGPL included in the ** packaging of this file.  Please review the following information to ** ensure the GNU Lesser General Public License version 2.1 requirements ** will be met: http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html. ** ** In addition, as a special exception, Digia gives you certain additional ** rights.  These rights are described in the Digia Qt LGPL Exception ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package. ** ** GNU General Public License Usage ** Alternatively, this file may be used under the terms of the GNU ** General Public License version 3.0 as published by the Free Software ** Foundation and appearing in the file LICENSE.GPL included in the ** packaging of this file.  Please review the following information to ** ensure the GNU General Public License version 3.0 requirements will be ** met: http://www.gnu.org/copyleft/gpl.html. ** ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<QtTest/QtTest>
end_include
begin_include
include|#
directive|include
file|<qgraphicsitem.h>
end_include
begin_include
include|#
directive|include
file|<qgraphicsscene.h>
end_include
begin_include
include|#
directive|include
file|<qgraphicssceneevent.h>
end_include
begin_include
include|#
directive|include
file|<qgraphicsview.h>
end_include
begin_include
include|#
directive|include
file|<qgraphicswidget.h>
end_include
begin_include
include|#
directive|include
file|<qgraphicsproxywidget.h>
end_include
begin_include
include|#
directive|include
file|<math.h>
end_include
begin_include
include|#
directive|include
file|<QtWidgets/QLabel>
end_include
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|QT_NO_STYLE_WINDOWS
argument_list|)
end_if
begin_include
include|#
directive|include
file|<QtWidgets/QWindowsStyle>
end_include
begin_endif
endif|#
directive|endif
end_endif
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|QT_NO_STYLE_PLASTIQUE
argument_list|)
end_if
begin_include
include|#
directive|include
file|<QtWidgets/QPlastiqueStyle>
end_include
begin_endif
endif|#
directive|endif
end_endif
begin_include
include|#
directive|include
file|<QtGui/QPainterPath>
end_include
begin_include
include|#
directive|include
file|<QtWidgets/QRubberBand>
end_include
begin_include
include|#
directive|include
file|<QtWidgets/QScrollBar>
end_include
begin_include
include|#
directive|include
file|<QtWidgets/QStyleOption>
end_include
begin_include
include|#
directive|include
file|<QtWidgets/QBoxLayout>
end_include
begin_include
include|#
directive|include
file|<QtWidgets/QStyle>
end_include
begin_include
include|#
directive|include
file|<QtWidgets/QPushButton>
end_include
begin_include
include|#
directive|include
file|<QtWidgets/QDesktopWidget>
end_include
begin_include
include|#
directive|include
file|<private/qgraphicsscene_p.h>
end_include
begin_include
include|#
directive|include
file|<private/qgraphicsview_p.h>
end_include
begin_include
include|#
directive|include
file|"../../../shared/platforminputcontext.h"
end_include
begin_include
include|#
directive|include
file|<private/qinputmethod_p.h>
end_include
begin_include
include|#
directive|include
file|"../../../qtest-config.h"
end_include
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QList<int>
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QList<QRectF>
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QMatrix
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QPainterPath
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QPointF
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QPolygonF
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QRectF
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|Qt::ScrollBarPolicy
argument_list|)
end_macro
begin_ifdef
ifdef|#
directive|ifdef
name|Q_OS_MAC
end_ifdef
begin_comment
comment|//On mac we get full update. So check that the expected region is contained inside the actual
end_comment
begin_define
DECL|macro|COMPARE_REGIONS
define|#
directive|define
name|COMPARE_REGIONS
parameter_list|(
name|ACTUAL
parameter_list|,
name|EXPECTED
parameter_list|)
value|QVERIFY((EXPECTED).subtracted(ACTUAL).isEmpty())
end_define
begin_else
else|#
directive|else
end_else
begin_define
define|#
directive|define
name|COMPARE_REGIONS
value|QCOMPARE
end_define
begin_endif
endif|#
directive|endif
end_endif
begin_function
DECL|function|sendMousePress
specifier|static
name|void
name|sendMousePress
parameter_list|(
name|QWidget
modifier|*
name|widget
parameter_list|,
specifier|const
name|QPoint
modifier|&
name|point
parameter_list|,
name|Qt
operator|::
name|MouseButton
name|button
init|=
name|Qt
operator|::
name|LeftButton
parameter_list|)
block|{
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseButtonPress
argument_list|,
name|point
argument_list|,
name|widget
operator|->
name|mapToGlobal
argument_list|(
name|point
argument_list|)
argument_list|,
name|button
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|widget
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sendMouseMove
specifier|static
name|void
name|sendMouseMove
parameter_list|(
name|QWidget
modifier|*
name|widget
parameter_list|,
specifier|const
name|QPoint
modifier|&
name|point
parameter_list|,
name|Qt
operator|::
name|MouseButton
name|button
init|=
name|Qt
operator|::
name|NoButton
parameter_list|,
name|Qt
operator|::
name|MouseButtons
name|buttons
init|=
literal|0
parameter_list|)
block|{
name|QTest
operator|::
name|mouseMove
argument_list|(
name|widget
argument_list|,
name|point
argument_list|)
expr_stmt|;
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|point
argument_list|,
name|button
argument_list|,
name|buttons
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|widget
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sendMouseRelease
specifier|static
name|void
name|sendMouseRelease
parameter_list|(
name|QWidget
modifier|*
name|widget
parameter_list|,
specifier|const
name|QPoint
modifier|&
name|point
parameter_list|,
name|Qt
operator|::
name|MouseButton
name|button
init|=
name|Qt
operator|::
name|LeftButton
parameter_list|)
block|{
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseButtonRelease
argument_list|,
name|point
argument_list|,
name|widget
operator|->
name|mapToGlobal
argument_list|(
name|point
argument_list|)
argument_list|,
name|button
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|widget
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|EventSpy
class|class
name|EventSpy
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
public|public:
DECL|function|EventSpy
name|EventSpy
parameter_list|(
name|QObject
modifier|*
name|watched
parameter_list|,
name|QEvent
operator|::
name|Type
name|type
parameter_list|)
member_init_list|:
name|_count
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|spied
argument_list|(
name|type
argument_list|)
block|{
name|watched
operator|->
name|installEventFilter
argument_list|(
name|this
argument_list|)
expr_stmt|;
block|}
DECL|function|count
name|int
name|count
parameter_list|()
specifier|const
block|{
return|return
name|_count
return|;
block|}
DECL|function|reset
name|void
name|reset
parameter_list|()
block|{
name|_count
operator|=
literal|0
expr_stmt|;
block|}
protected|protected:
DECL|function|eventFilter
name|bool
name|eventFilter
parameter_list|(
name|QObject
modifier|*
name|watched
parameter_list|,
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
name|Q_UNUSED
argument_list|(
name|watched
argument_list|)
expr_stmt|;
if|if
condition|(
name|event
operator|->
name|type
argument_list|()
operator|==
name|spied
condition|)
operator|++
name|_count
expr_stmt|;
return|return
literal|false
return|;
block|}
DECL|member|_count
name|int
name|_count
decl_stmt|;
DECL|member|spied
name|QEvent
operator|::
name|Type
name|spied
decl_stmt|;
block|}
class|;
end_class
begin_if
if|#
directive|if
name|defined
name|QT_BUILD_INTERNAL
end_if
begin_class
DECL|class|FriendlyGraphicsScene
class|class
name|FriendlyGraphicsScene
super|:
specifier|public
name|QGraphicsScene
block|{
friend|friend
class_decl|class
name|tst_QGraphicsView
class_decl|;
name|Q_DECLARE_PRIVATE
parameter_list|(
name|QGraphicsScene
parameter_list|)
constructor_decl|;
block|}
class|;
end_class
begin_endif
endif|#
directive|endif
end_endif
begin_class
DECL|class|tst_QGraphicsView
class|class
name|tst_QGraphicsView
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
private|private
name|slots
private|:
name|void
name|initTestCase
parameter_list|()
function_decl|;
name|void
name|cleanup
parameter_list|()
function_decl|;
name|void
name|construction
parameter_list|()
function_decl|;
name|void
name|renderHints
parameter_list|()
function_decl|;
name|void
name|alignment
parameter_list|()
function_decl|;
name|void
name|interactive
parameter_list|()
function_decl|;
name|void
name|scene
parameter_list|()
function_decl|;
name|void
name|setScene
parameter_list|()
function_decl|;
name|void
name|deleteScene
parameter_list|()
function_decl|;
name|void
name|sceneRect
parameter_list|()
function_decl|;
name|void
name|sceneRect_growing
parameter_list|()
function_decl|;
name|void
name|setSceneRect
parameter_list|()
function_decl|;
name|void
name|viewport
parameter_list|()
function_decl|;
name|void
name|dragMode_scrollHand
parameter_list|()
function_decl|;
name|void
name|dragMode_rubberBand
parameter_list|()
function_decl|;
name|void
name|rubberBandSelectionMode
parameter_list|()
function_decl|;
name|void
name|backgroundBrush
parameter_list|()
function_decl|;
name|void
name|foregroundBrush
parameter_list|()
function_decl|;
name|void
name|matrix
parameter_list|()
function_decl|;
name|void
name|matrix_convenience
parameter_list|()
function_decl|;
name|void
name|matrix_combine
parameter_list|()
function_decl|;
name|void
name|centerOnPoint
parameter_list|()
function_decl|;
name|void
name|centerOnItem
parameter_list|()
function_decl|;
name|void
name|ensureVisibleRect
parameter_list|()
function_decl|;
name|void
name|fitInView
parameter_list|()
function_decl|;
name|void
name|itemsAtPoint
parameter_list|()
function_decl|;
if|#
directive|if
name|defined
name|QT_BUILD_INTERNAL
name|void
name|itemsAtPosition_data
parameter_list|()
function_decl|;
name|void
name|itemsAtPosition
parameter_list|()
function_decl|;
endif|#
directive|endif
name|void
name|itemsInRect
parameter_list|()
function_decl|;
name|void
name|itemsInRect_cosmeticAdjust_data
parameter_list|()
function_decl|;
name|void
name|itemsInRect_cosmeticAdjust
parameter_list|()
function_decl|;
name|void
name|itemsInPoly
parameter_list|()
function_decl|;
name|void
name|itemsInPath
parameter_list|()
function_decl|;
name|void
name|itemAt
parameter_list|()
function_decl|;
name|void
name|itemAt2
parameter_list|()
function_decl|;
name|void
name|mapToScene
parameter_list|()
function_decl|;
name|void
name|mapToScenePoint
parameter_list|()
function_decl|;
name|void
name|mapToSceneRect_data
parameter_list|()
function_decl|;
name|void
name|mapToSceneRect
parameter_list|()
function_decl|;
name|void
name|mapToScenePoly
parameter_list|()
function_decl|;
name|void
name|mapToScenePath
parameter_list|()
function_decl|;
name|void
name|mapFromScenePoint
parameter_list|()
function_decl|;
name|void
name|mapFromSceneRect
parameter_list|()
function_decl|;
name|void
name|mapFromScenePoly
parameter_list|()
function_decl|;
name|void
name|mapFromScenePath
parameter_list|()
function_decl|;
name|void
name|sendEvent
parameter_list|()
function_decl|;
name|void
name|wheelEvent
parameter_list|()
function_decl|;
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
name|void
name|cursor
parameter_list|()
function_decl|;
name|void
name|cursor2
parameter_list|()
function_decl|;
endif|#
directive|endif
name|void
name|transformationAnchor
parameter_list|()
function_decl|;
name|void
name|resizeAnchor
parameter_list|()
function_decl|;
name|void
name|viewportUpdateMode
parameter_list|()
function_decl|;
name|void
name|viewportUpdateMode2
parameter_list|()
function_decl|;
ifndef|#
directive|ifndef
name|QT_NO_DRAGANDDROP
name|void
name|acceptDrops
parameter_list|()
function_decl|;
endif|#
directive|endif
name|void
name|optimizationFlags
parameter_list|()
function_decl|;
name|void
name|optimizationFlags_dontSavePainterState
parameter_list|()
function_decl|;
name|void
name|optimizationFlags_dontSavePainterState2_data
parameter_list|()
function_decl|;
name|void
name|optimizationFlags_dontSavePainterState2
parameter_list|()
function_decl|;
name|void
name|levelOfDetail_data
parameter_list|()
function_decl|;
name|void
name|levelOfDetail
parameter_list|()
function_decl|;
name|void
name|scrollBarRanges_data
parameter_list|()
function_decl|;
name|void
name|scrollBarRanges
parameter_list|()
function_decl|;
name|void
name|acceptMousePressEvent
parameter_list|()
function_decl|;
name|void
name|replayMouseMove
parameter_list|()
function_decl|;
name|void
name|itemsUnderMouse
parameter_list|()
function_decl|;
name|void
name|embeddedViews
parameter_list|()
function_decl|;
name|void
name|scrollAfterResize_data
parameter_list|()
function_decl|;
name|void
name|scrollAfterResize
parameter_list|()
function_decl|;
name|void
name|moveItemWhileScrolling_data
parameter_list|()
function_decl|;
name|void
name|moveItemWhileScrolling
parameter_list|()
function_decl|;
name|void
name|centerOnDirtyItem
parameter_list|()
function_decl|;
name|void
name|mouseTracking
parameter_list|()
function_decl|;
name|void
name|mouseTracking2
parameter_list|()
function_decl|;
name|void
name|mouseTracking3
parameter_list|()
function_decl|;
name|void
name|render
parameter_list|()
function_decl|;
name|void
name|exposeRegion
parameter_list|()
function_decl|;
name|void
name|update_data
parameter_list|()
function_decl|;
name|void
name|update
parameter_list|()
function_decl|;
name|void
name|update2_data
parameter_list|()
function_decl|;
name|void
name|update2
parameter_list|()
function_decl|;
name|void
name|update_ancestorClipsChildrenToShape
parameter_list|()
function_decl|;
name|void
name|update_ancestorClipsChildrenToShape2
parameter_list|()
function_decl|;
name|void
name|inputMethodSensitivity
parameter_list|()
function_decl|;
name|void
name|inputContextReset
parameter_list|()
function_decl|;
name|void
name|indirectPainting
parameter_list|()
function_decl|;
name|void
name|compositionModeInDrawBackground
parameter_list|()
function_decl|;
comment|// task specific tests below me
name|void
name|task172231_untransformableItems
parameter_list|()
function_decl|;
name|void
name|task180429_mouseReleaseDragMode
parameter_list|()
function_decl|;
name|void
name|task187791_setSceneCausesUpdate
parameter_list|()
function_decl|;
name|void
name|task186827_deleteReplayedItem
parameter_list|()
function_decl|;
name|void
name|task207546_focusCrash
parameter_list|()
function_decl|;
name|void
name|task210599_unsetDragWhileDragging
parameter_list|()
function_decl|;
name|void
name|task236394_sendShortcutOverrideEvent
parameter_list|()
function_decl|;
name|void
name|task239729_noViewUpdate_data
parameter_list|()
function_decl|;
name|void
name|task239729_noViewUpdate
parameter_list|()
function_decl|;
name|void
name|task239047_fitInViewSmallViewport
parameter_list|()
function_decl|;
name|void
name|task245469_itemsAtPointWithClip
parameter_list|()
function_decl|;
name|void
name|task253415_reconnectUpdateSceneOnSceneChanged
parameter_list|()
function_decl|;
name|void
name|task255529_transformationAnchorMouseAndViewportMargins
parameter_list|()
function_decl|;
name|void
name|task259503_scrollingArtifacts
parameter_list|()
function_decl|;
name|void
name|QTBUG_4151_clipAndIgnore_data
parameter_list|()
function_decl|;
name|void
name|QTBUG_4151_clipAndIgnore
parameter_list|()
function_decl|;
name|void
name|QTBUG_5859_exposedRect
parameter_list|()
function_decl|;
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
name|void
name|QTBUG_7438_cursor
parameter_list|()
function_decl|;
endif|#
directive|endif
name|void
name|hoverLeave
parameter_list|()
function_decl|;
name|void
name|QTBUG_16063_microFocusRect
parameter_list|()
function_decl|;
public|public
name|slots
public|:
DECL|function|dummySlot
name|void
name|dummySlot
parameter_list|()
block|{}
block|}
class|;
end_class
begin_function
DECL|function|initTestCase
name|void
name|tst_QGraphicsView
operator|::
name|initTestCase
parameter_list|()
block|{
ifdef|#
directive|ifdef
name|Q_OS_WINCE_WM
name|qApp
operator|->
name|setAutoMaximizeThreshold
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function
begin_function
DECL|function|cleanup
name|void
name|tst_QGraphicsView
operator|::
name|cleanup
parameter_list|()
block|{
comment|// ensure not even skipped tests with custom input context leave it dangling
name|QInputMethodPrivate
modifier|*
name|inputMethodPrivate
init|=
name|QInputMethodPrivate
operator|::
name|get
argument_list|(
name|qApp
operator|->
name|inputMethod
argument_list|()
argument_list|)
decl_stmt|;
name|inputMethodPrivate
operator|->
name|testContext
operator|=
literal|0
expr_stmt|;
block|}
end_function
begin_function
DECL|function|construction
name|void
name|tst_QGraphicsView
operator|::
name|construction
parameter_list|()
block|{
name|QGraphicsView
name|view
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|renderHints
argument_list|()
argument_list|,
name|QPainter
operator|::
name|TextAntialiasing
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|dragMode
argument_list|()
argument_list|,
name|QGraphicsView
operator|::
name|NoDrag
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isInteractive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|scene
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|metaObject
argument_list|()
operator|->
name|className
argument_list|()
argument_list|,
literal|"QWidget"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|items
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|items
argument_list|(
name|QPoint
argument_list|()
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|items
argument_list|(
name|QRect
argument_list|()
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|items
argument_list|(
name|QPolygon
argument_list|()
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|items
argument_list|(
name|QPainterPath
argument_list|()
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
name|QPoint
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapToScene
argument_list|(
name|QPoint
argument_list|()
argument_list|)
argument_list|,
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapToScene
argument_list|(
name|QRect
argument_list|()
argument_list|)
argument_list|,
name|QPolygonF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapToScene
argument_list|(
name|QPolygon
argument_list|()
argument_list|)
argument_list|,
name|QPolygonF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|QPointF
argument_list|()
argument_list|)
argument_list|,
name|QPoint
argument_list|()
argument_list|)
expr_stmt|;
name|QPolygon
name|poly
decl_stmt|;
name|poly
operator|<<
name|QPoint
argument_list|()
operator|<<
name|QPoint
argument_list|()
operator|<<
name|QPoint
argument_list|()
operator|<<
name|QPoint
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|QRectF
argument_list|()
argument_list|)
argument_list|,
name|poly
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|QPolygonF
argument_list|()
argument_list|)
argument_list|,
name|QPolygon
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|transformationAnchor
argument_list|()
argument_list|,
name|QGraphicsView
operator|::
name|AnchorViewCenter
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|resizeAnchor
argument_list|()
argument_list|,
name|QGraphicsView
operator|::
name|NoAnchor
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|TestItem
class|class
name|TestItem
super|:
specifier|public
name|QGraphicsItem
block|{
public|public:
DECL|function|boundingRect
name|QRectF
name|boundingRect
parameter_list|()
specifier|const
block|{
return|return
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
return|;
block|}
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
name|hints
operator|=
name|painter
operator|->
name|renderHints
argument_list|()
expr_stmt|;
name|painter
operator|->
name|drawRect
argument_list|(
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|function|sceneEvent
name|bool
name|sceneEvent
parameter_list|(
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
name|events
operator|<<
name|event
operator|->
name|type
argument_list|()
expr_stmt|;
return|return
name|QGraphicsItem
operator|::
name|sceneEvent
argument_list|(
name|event
argument_list|)
return|;
block|}
DECL|member|events
name|QList
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|>
name|events
decl_stmt|;
DECL|member|hints
name|QPainter
operator|::
name|RenderHints
name|hints
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|renderHints
name|void
name|tst_QGraphicsView
operator|::
name|renderHints
parameter_list|()
block|{
name|QGraphicsView
name|view
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|renderHints
argument_list|()
argument_list|,
name|QPainter
operator|::
name|TextAntialiasing
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRenderHint
argument_list|(
name|QPainter
operator|::
name|TextAntialiasing
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|renderHints
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRenderHint
argument_list|(
name|QPainter
operator|::
name|Antialiasing
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|renderHints
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRenderHint
argument_list|(
name|QPainter
operator|::
name|TextAntialiasing
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|renderHints
argument_list|()
argument_list|,
name|QPainter
operator|::
name|TextAntialiasing
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRenderHint
argument_list|(
name|QPainter
operator|::
name|Antialiasing
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|renderHints
argument_list|()
argument_list|,
name|QPainter
operator|::
name|TextAntialiasing
operator||
name|QPainter
operator|::
name|Antialiasing
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRenderHints
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|renderHints
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|TestItem
modifier|*
name|item
init|=
operator|new
name|TestItem
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRenderHints
argument_list|(
name|QPainter
operator|::
name|TextAntialiasing
operator||
name|QPainter
operator|::
name|Antialiasing
operator||
name|QPainter
operator|::
name|NonCosmeticDefaultPen
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|renderHints
argument_list|()
argument_list|,
name|QPainter
operator|::
name|TextAntialiasing
operator||
name|QPainter
operator|::
name|Antialiasing
operator||
name|QPainter
operator|::
name|NonCosmeticDefaultPen
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|hints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|repaint
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item
operator|->
name|hints
argument_list|,
name|view
operator|.
name|renderHints
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRenderHints
argument_list|(
name|QPainter
operator|::
name|Antialiasing
operator||
name|QPainter
operator|::
name|NonCosmeticDefaultPen
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|renderHints
argument_list|()
argument_list|,
name|QPainter
operator|::
name|Antialiasing
operator||
name|QPainter
operator|::
name|NonCosmeticDefaultPen
argument_list|)
expr_stmt|;
name|view
operator|.
name|repaint
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item
operator|->
name|hints
argument_list|,
name|view
operator|.
name|renderHints
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|alignment
name|void
name|tst_QGraphicsView
operator|::
name|alignment
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
operator|++
name|i
control|)
block|{
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
literal|3
condition|;
operator|++
name|j
control|)
block|{
name|Qt
operator|::
name|Alignment
name|alignment
init|=
literal|0
decl_stmt|;
switch|switch
condition|(
name|i
condition|)
block|{
case|case
literal|0
case|:
name|alignment
operator||=
name|Qt
operator|::
name|AlignLeft
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|alignment
operator||=
name|Qt
operator|::
name|AlignHCenter
expr_stmt|;
break|break;
case|case
literal|2
case|:
default|default:
name|alignment
operator||=
name|Qt
operator|::
name|AlignRight
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
name|j
condition|)
block|{
case|case
literal|0
case|:
name|alignment
operator||=
name|Qt
operator|::
name|AlignTop
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|alignment
operator||=
name|Qt
operator|::
name|AlignVCenter
expr_stmt|;
break|break;
case|case
literal|2
case|:
default|default:
name|alignment
operator||=
name|Qt
operator|::
name|AlignBottom
expr_stmt|;
break|break;
block|}
name|view
operator|.
name|setAlignment
argument_list|(
name|alignment
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|alignment
argument_list|()
argument_list|,
name|alignment
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|k
init|=
literal|0
init|;
name|k
operator|<
literal|3
condition|;
operator|++
name|k
control|)
block|{
name|view
operator|.
name|resize
argument_list|(
literal|100
operator|+
name|k
operator|*
literal|25
argument_list|,
literal|100
operator|+
name|k
operator|*
literal|25
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|}
block|}
block|}
block|}
end_function
begin_function
DECL|function|interactive
name|void
name|tst_QGraphicsView
operator|::
name|interactive
parameter_list|()
block|{
name|TestItem
modifier|*
name|item
init|=
operator|new
name|TestItem
decl_stmt|;
name|item
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|200
argument_list|,
operator|-
literal|200
argument_list|,
literal|400
argument_list|,
literal|400
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|300
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|view
operator|.
name|activateWindow
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// activate
name|QPoint
name|itemPoint
init|=
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|itemPoint
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|100
condition|;
operator|++
name|i
control|)
block|{
name|sendMousePress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|itemPoint
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
argument_list|,
name|i
operator|*
literal|5
operator|+
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|at
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|at
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
expr_stmt|;
name|sendMouseRelease
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|itemPoint
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
argument_list|,
name|i
operator|*
literal|5
operator|+
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|at
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|at
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
expr_stmt|;
name|QContextMenuEvent
name|contextEvent
argument_list|(
name|QContextMenuEvent
operator|::
name|Mouse
argument_list|,
name|itemPoint
argument_list|,
name|view
operator|.
name|mapToGlobal
argument_list|(
name|itemPoint
argument_list|)
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|contextEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
argument_list|,
name|i
operator|*
literal|5
operator|+
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|last
argument_list|()
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneContextMenu
argument_list|)
expr_stmt|;
block|}
name|view
operator|.
name|setInteractive
argument_list|(
literal|false
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|100
condition|;
operator|++
name|i
control|)
block|{
name|sendMousePress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|itemPoint
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
argument_list|,
literal|501
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|last
argument_list|()
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneContextMenu
argument_list|)
expr_stmt|;
name|sendMouseRelease
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|itemPoint
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
argument_list|,
literal|501
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|last
argument_list|()
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneContextMenu
argument_list|)
expr_stmt|;
name|QContextMenuEvent
name|contextEvent
argument_list|(
name|QContextMenuEvent
operator|::
name|Mouse
argument_list|,
name|itemPoint
argument_list|,
name|view
operator|.
name|mapToGlobal
argument_list|(
name|itemPoint
argument_list|)
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|contextEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
argument_list|,
literal|501
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|last
argument_list|()
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneContextMenu
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|scene
name|void
name|tst_QGraphicsView
operator|::
name|scene
parameter_list|()
block|{
name|QGraphicsView
name|view
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|scene
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|scene
argument_list|()
argument_list|)
expr_stmt|;
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|scene
argument_list|()
argument_list|,
operator|&
name|scene
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|view
operator|.
name|scene
argument_list|()
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setScene
name|void
name|tst_QGraphicsView
operator|::
name|setScene
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|,
literal|2000
argument_list|,
literal|2000
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|isHidden
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|isHidden
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|isHidden
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|isHidden
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|deleteScene
name|void
name|tst_QGraphicsView
operator|::
name|deleteScene
parameter_list|()
block|{
name|QGraphicsScene
modifier|*
name|scene
init|=
operator|new
name|QGraphicsScene
decl_stmt|;
name|QGraphicsView
name|view1
argument_list|(
name|scene
argument_list|)
decl_stmt|;
name|view1
operator|.
name|show
argument_list|()
expr_stmt|;
name|QGraphicsView
name|view2
argument_list|(
name|scene
argument_list|)
decl_stmt|;
name|view2
operator|.
name|show
argument_list|()
expr_stmt|;
name|QGraphicsView
name|view3
argument_list|(
name|scene
argument_list|)
decl_stmt|;
name|view3
operator|.
name|show
argument_list|()
expr_stmt|;
operator|delete
name|scene
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view1
operator|.
name|scene
argument_list|()
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view2
operator|.
name|scene
argument_list|()
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view3
operator|.
name|scene
argument_list|()
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sceneRect
name|void
name|tst_QGraphicsView
operator|::
name|sceneRect
parameter_list|()
block|{
name|QGraphicsView
name|view
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
name|QRectF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|moveBy
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|200
argument_list|,
operator|-
literal|200
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|moveBy
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|200
argument_list|,
operator|-
literal|200
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
name|QRectF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sceneRect_growing
name|void
name|tst_QGraphicsView
operator|::
name|sceneRect_growing
parameter_list|()
block|{
name|QWidget
name|toplevel
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|100
condition|;
operator|++
name|i
control|)
name|scene
operator|.
name|addText
argument_list|(
name|QString
argument_list|(
literal|"(0, %1)"
argument_list|)
operator|.
name|arg
argument_list|(
operator|(
name|i
operator|-
literal|50
operator|)
operator|*
literal|20
argument_list|)
argument_list|)
operator|->
name|setPos
argument_list|(
literal|0
argument_list|,
operator|(
name|i
operator|-
literal|50
operator|)
operator|*
literal|20
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|toplevel
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|toplevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|int
name|size
init|=
literal|200
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
operator|-
name|size
argument_list|,
operator|-
name|size
argument_list|,
name|size
operator|*
literal|2
argument_list|,
name|size
operator|*
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QPointF
name|topLeft
init|=
name|view
operator|.
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
operator|++
name|i
control|)
block|{
name|size
operator|*=
literal|2
expr_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
operator|-
name|size
argument_list|,
operator|-
name|size
argument_list|,
name|size
operator|*
literal|2
argument_list|,
name|size
operator|*
literal|2
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|topLeft
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
name|size
argument_list|,
operator|-
name|size
argument_list|,
name|size
operator|*
literal|2
argument_list|,
name|size
operator|*
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|topLeft
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
name|QRectF
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|setSceneRect
name|void
name|tst_QGraphicsView
operator|::
name|setSceneRect
parameter_list|()
block|{
name|QRectF
name|rect1
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|QRectF
name|rect2
argument_list|(
operator|-
literal|300
argument_list|,
operator|-
literal|300
argument_list|,
literal|150
argument_list|,
literal|150
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
name|rect1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|rect1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|rect1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|rect2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|rect2
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
name|rect1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|rect2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|rect1
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|rect2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|rect2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
name|rect1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|rect1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|rect2
argument_list|)
expr_stmt|;
comment|// extreme transformations will max out the scrollbars' ranges.
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|2000000
argument_list|,
operator|-
literal|2000000
argument_list|,
literal|4000000
argument_list|,
literal|4000000
argument_list|)
expr_stmt|;
name|view
operator|.
name|scale
argument_list|(
literal|9000
argument_list|,
literal|9000
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|minimum
argument_list|()
argument_list|,
name|INT_MIN
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|maximum
argument_list|()
argument_list|,
name|INT_MAX
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|minimum
argument_list|()
argument_list|,
name|INT_MIN
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|maximum
argument_list|()
argument_list|,
name|INT_MAX
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|viewport
name|void
name|tst_QGraphicsView
operator|::
name|viewport
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addText
argument_list|(
literal|"GraphicsView"
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QPointer
argument_list|<
name|QWidget
argument_list|>
name|widget
init|=
operator|new
name|QWidget
decl_stmt|;
name|view
operator|.
name|setViewport
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|(
name|QWidget
operator|*
operator|)
name|widget
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|view
operator|.
name|setViewport
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|widget
operator|.
name|isNull
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|!=
name|widget
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|dragMode_scrollHand
name|void
name|tst_QGraphicsView
operator|::
name|dragMode_scrollHand
parameter_list|()
block|{
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
literal|2
condition|;
operator|++
name|j
control|)
block|{
name|QGraphicsView
name|view
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|dragMode
argument_list|()
argument_list|,
name|QGraphicsView
operator|::
name|NoDrag
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|,
literal|2000
argument_list|,
literal|2000
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|view
operator|.
name|setInteractive
argument_list|(
name|j
condition|?
literal|false
else|:
literal|true
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|95
argument_list|,
operator|-
literal|100
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|95
argument_list|,
literal|95
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
literal|95
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|item
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|scene
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setDragMode
argument_list|(
name|QGraphicsView
operator|::
name|ScrollHandDrag
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
operator|++
name|i
control|)
block|{
comment|// ScrollHandDrag
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
name|Qt
operator|::
name|CursorShape
name|cursorShape
init|=
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
decl_stmt|;
endif|#
directive|endif
name|int
name|horizontalScrollBarValue
init|=
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
decl_stmt|;
name|int
name|verticalScrollBarValue
init|=
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
decl_stmt|;
block|{
comment|// Press
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseButtonPress
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|event
operator|.
name|setAccepted
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|event
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|k
init|=
literal|0
init|;
name|k
operator|<
literal|4
condition|;
operator|++
name|k
control|)
block|{
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|ClosedHandCursor
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|{
comment|// Move
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
operator|+
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|event
operator|.
name|setAccepted
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|event
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|QVERIFY
argument_list|(
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
argument_list|,
name|horizontalScrollBarValue
operator|-
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
argument_list|,
name|verticalScrollBarValue
argument_list|)
expr_stmt|;
block|{
comment|// Move
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
operator|+
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|event
operator|.
name|setAccepted
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|event
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|QVERIFY
argument_list|(
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
argument_list|,
name|horizontalScrollBarValue
operator|-
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
argument_list|,
name|verticalScrollBarValue
operator|-
literal|10
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Release
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseButtonRelease
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
operator|+
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|event
operator|.
name|setAccepted
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|event
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
argument_list|,
name|horizontalScrollBarValue
operator|-
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
argument_list|,
name|verticalScrollBarValue
operator|-
literal|10
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|cursorShape
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|// Check that items are not unselected because of a scroll hand drag.
name|QVERIFY
argument_list|(
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Check that a click will still unselect the item.
block|{
comment|// Press
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseButtonPress
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
operator|+
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Release
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseButtonRelease
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
operator|+
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|view
operator|.
name|isInteractive
argument_list|()
condition|)
block|{
if|if
condition|(
name|view
operator|.
name|scene
argument_list|()
condition|)
block|{
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|QVERIFY
argument_list|(
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|QVERIFY
argument_list|(
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function
DECL|function|dragMode_rubberBand
name|void
name|tst_QGraphicsView
operator|::
name|dragMode_rubberBand
parameter_list|()
block|{
name|QGraphicsView
name|view
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|dragMode
argument_list|()
argument_list|,
name|QGraphicsView
operator|::
name|NoDrag
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|,
literal|2000
argument_list|,
literal|2000
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|)
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|75
argument_list|,
operator|-
literal|100
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|)
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|75
argument_list|,
literal|75
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|)
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
literal|75
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|)
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|view
operator|.
name|setDragMode
argument_list|(
name|QGraphicsView
operator|::
name|RubberBandDrag
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
operator|++
name|i
control|)
block|{
comment|// RubberBandDrag
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
name|Qt
operator|::
name|CursorShape
name|cursorShape
init|=
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
decl_stmt|;
endif|#
directive|endif
name|int
name|horizontalScrollBarValue
init|=
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
decl_stmt|;
name|int
name|verticalScrollBarValue
init|=
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
decl_stmt|;
block|{
comment|// Press
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseButtonPress
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|event
operator|.
name|setAccepted
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|event
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|cursorShape
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|{
comment|// Move
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
operator|+
name|QPoint
argument_list|(
literal|100
argument_list|,
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|event
operator|.
name|setAccepted
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|event
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
argument_list|,
name|horizontalScrollBarValue
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
argument_list|,
name|verticalScrollBarValue
argument_list|)
expr_stmt|;
comment|// We don't use QRubberBand as of 4.3; the band is drawn internally.
name|QVERIFY
argument_list|(
operator|!
name|qFindChild
argument_list|<
name|QRubberBand
operator|*
argument_list|>
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
block|{
comment|// Move
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
operator|+
name|QPoint
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|event
operator|.
name|setAccepted
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|event
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
argument_list|,
name|horizontalScrollBarValue
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
argument_list|,
name|verticalScrollBarValue
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
block|{
comment|// Release
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseButtonRelease
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
operator|+
name|QPoint
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|event
operator|.
name|setAccepted
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|event
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
argument_list|,
name|horizontalScrollBarValue
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
argument_list|,
name|verticalScrollBarValue
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|cursorShape
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
if|if
condition|(
name|view
operator|.
name|scene
argument_list|()
condition|)
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|centerOn
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|rubberBandSelectionMode
name|void
name|tst_QGraphicsView
operator|::
name|rubberBandSelectionMode
parameter_list|()
block|{
name|QWidget
name|toplevel
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|80
argument_list|,
literal|80
argument_list|)
argument_list|)
decl_stmt|;
name|rect
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|toplevel
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|rubberBandSelectionMode
argument_list|()
argument_list|,
name|Qt
operator|::
name|IntersectsItemShape
argument_list|)
expr_stmt|;
name|view
operator|.
name|setDragMode
argument_list|(
name|QGraphicsView
operator|::
name|RubberBandDrag
argument_list|)
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|120
argument_list|,
literal|120
argument_list|)
expr_stmt|;
name|toplevel
operator|.
name|show
argument_list|()
expr_stmt|;
comment|// Disable mouse tracking to prevent the window system from sending mouse
comment|// move events to the viewport while we are synthesizing events. If
comment|// QGraphicsView gets a mouse move event with no buttons down, it'll
comment|// terminate the rubber band.
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|setMouseTracking
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
argument_list|)
expr_stmt|;
name|sendMousePress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|QPoint
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|rect
argument_list|)
expr_stmt|;
name|sendMouseRelease
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|QPoint
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRubberBandSelectionMode
argument_list|(
name|Qt
operator|::
name|ContainsItemShape
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|rubberBandSelectionMode
argument_list|()
argument_list|,
name|Qt
operator|::
name|ContainsItemShape
argument_list|)
expr_stmt|;
name|sendMousePress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|QPoint
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|bottomRight
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|rect
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|backgroundBrush
name|void
name|tst_QGraphicsView
operator|::
name|backgroundBrush
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|scene
operator|.
name|setBackgroundBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|backgroundBrush
argument_list|()
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setBackgroundBrush
argument_list|(
name|QBrush
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|backgroundBrush
argument_list|()
argument_list|,
name|QBrush
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QRadialGradient
name|gradient
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|gradient
operator|.
name|setSpread
argument_list|(
name|QGradient
operator|::
name|RepeatSpread
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setBackgroundBrush
argument_list|(
name|gradient
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|backgroundBrush
argument_list|()
argument_list|,
name|QBrush
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|foregroundBrush
name|void
name|tst_QGraphicsView
operator|::
name|foregroundBrush
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|scene
operator|.
name|setForegroundBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|foregroundBrush
argument_list|()
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setForegroundBrush
argument_list|(
name|QBrush
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|foregroundBrush
argument_list|()
argument_list|,
name|QBrush
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QRadialGradient
name|gradient
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|gradient
operator|.
name|setSpread
argument_list|(
name|QGradient
operator|::
name|RepeatSpread
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setForegroundBrush
argument_list|(
name|gradient
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|foregroundBrush
argument_list|()
argument_list|,
name|QBrush
argument_list|(
name|gradient
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|50
condition|;
operator|++
name|i
control|)
block|{
name|QRadialGradient
name|gradient
argument_list|(
name|view
operator|.
name|rect
argument_list|()
operator|.
name|center
argument_list|()
operator|+
name|QPoint
argument_list|(
name|int
argument_list|(
name|sin
argument_list|(
name|i
operator|/
literal|2.0
argument_list|)
operator|*
literal|10
argument_list|)
argument_list|,
name|int
argument_list|(
name|cos
argument_list|(
name|i
operator|/
literal|2.0
argument_list|)
operator|*
literal|10
argument_list|)
argument_list|)
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|gradient
operator|.
name|setColorAt
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|transparent
argument_list|)
expr_stmt|;
name|gradient
operator|.
name|setColorAt
argument_list|(
literal|0.5
argument_list|,
name|Qt
operator|::
name|black
argument_list|)
expr_stmt|;
name|gradient
operator|.
name|setColorAt
argument_list|(
literal|1
argument_list|,
name|Qt
operator|::
name|transparent
argument_list|)
expr_stmt|;
name|gradient
operator|.
name|setSpread
argument_list|(
name|QGradient
operator|::
name|RepeatSpread
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setForegroundBrush
argument_list|(
name|gradient
argument_list|)
expr_stmt|;
name|QRadialGradient
name|gradient2
argument_list|(
name|view
operator|.
name|rect
argument_list|()
operator|.
name|center
argument_list|()
operator|+
name|QPoint
argument_list|(
name|int
argument_list|(
name|sin
argument_list|(
name|i
operator|/
literal|1.7
argument_list|)
operator|*
literal|10
argument_list|)
argument_list|,
name|int
argument_list|(
name|cos
argument_list|(
name|i
operator|/
literal|1.7
argument_list|)
operator|*
literal|10
argument_list|)
argument_list|)
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|gradient2
operator|.
name|setColorAt
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|transparent
argument_list|)
expr_stmt|;
name|gradient2
operator|.
name|setColorAt
argument_list|(
literal|0.5
argument_list|,
name|Qt
operator|::
name|black
argument_list|)
expr_stmt|;
name|gradient2
operator|.
name|setColorAt
argument_list|(
literal|1
argument_list|,
name|Qt
operator|::
name|transparent
argument_list|)
expr_stmt|;
name|gradient2
operator|.
name|setSpread
argument_list|(
name|QGradient
operator|::
name|RepeatSpread
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setBackgroundBrush
argument_list|(
name|gradient2
argument_list|)
expr_stmt|;
name|QRadialGradient
name|gradient3
argument_list|(
name|view
operator|.
name|rect
argument_list|()
operator|.
name|center
argument_list|()
operator|+
name|QPoint
argument_list|(
name|int
argument_list|(
name|sin
argument_list|(
name|i
operator|/
literal|1.85
argument_list|)
operator|*
literal|10
argument_list|)
argument_list|,
name|int
argument_list|(
name|cos
argument_list|(
name|i
operator|/
literal|1.85
argument_list|)
operator|*
literal|10
argument_list|)
argument_list|)
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|gradient3
operator|.
name|setColorAt
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|transparent
argument_list|)
expr_stmt|;
name|gradient3
operator|.
name|setColorAt
argument_list|(
literal|0.5
argument_list|,
name|Qt
operator|::
name|black
argument_list|)
expr_stmt|;
name|gradient3
operator|.
name|setColorAt
argument_list|(
literal|1
argument_list|,
name|Qt
operator|::
name|transparent
argument_list|)
expr_stmt|;
name|gradient3
operator|.
name|setSpread
argument_list|(
name|QGradient
operator|::
name|RepeatSpread
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setBackgroundBrush
argument_list|(
name|gradient3
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|}
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|,
literal|2000
argument_list|,
literal|2000
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
operator|-
literal|500
init|;
name|i
operator|<
literal|500
condition|;
name|i
operator|+=
literal|10
control|)
block|{
name|view
operator|.
name|centerOn
argument_list|(
name|i
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|}
for|for
control|(
name|int
name|i
init|=
operator|-
literal|500
init|;
name|i
operator|<
literal|500
condition|;
name|i
operator|+=
literal|10
control|)
block|{
name|view
operator|.
name|centerOn
argument_list|(
literal|0
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|matrix
name|void
name|tst_QGraphicsView
operator|::
name|matrix
parameter_list|()
block|{
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
comment|// Show rendering of background with no scene
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|50
condition|;
operator|++
name|i
control|)
block|{
name|view
operator|.
name|rotate
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|QRadialGradient
name|gradient
argument_list|(
name|view
operator|.
name|rect
argument_list|()
operator|.
name|center
argument_list|()
operator|+
name|QPoint
argument_list|(
name|int
argument_list|(
name|sin
argument_list|(
name|i
operator|/
literal|2.0
argument_list|)
operator|*
literal|10
argument_list|)
argument_list|,
name|int
argument_list|(
name|cos
argument_list|(
name|i
operator|/
literal|2.0
argument_list|)
operator|*
literal|10
argument_list|)
argument_list|)
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|gradient
operator|.
name|setColorAt
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|transparent
argument_list|)
expr_stmt|;
name|gradient
operator|.
name|setColorAt
argument_list|(
literal|0.5
argument_list|,
name|Qt
operator|::
name|black
argument_list|)
expr_stmt|;
name|gradient
operator|.
name|setColorAt
argument_list|(
literal|1
argument_list|,
name|Qt
operator|::
name|transparent
argument_list|)
expr_stmt|;
name|gradient
operator|.
name|setSpread
argument_list|(
name|QGradient
operator|::
name|RepeatSpread
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setForegroundBrush
argument_list|(
name|gradient
argument_list|)
expr_stmt|;
name|QRadialGradient
name|gradient2
argument_list|(
name|view
operator|.
name|rect
argument_list|()
operator|.
name|center
argument_list|()
operator|+
name|QPoint
argument_list|(
name|int
argument_list|(
name|sin
argument_list|(
name|i
operator|/
literal|1.7
argument_list|)
operator|*
literal|10
argument_list|)
argument_list|,
name|int
argument_list|(
name|cos
argument_list|(
name|i
operator|/
literal|1.7
argument_list|)
operator|*
literal|10
argument_list|)
argument_list|)
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|gradient2
operator|.
name|setColorAt
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|transparent
argument_list|)
expr_stmt|;
name|gradient2
operator|.
name|setColorAt
argument_list|(
literal|0.5
argument_list|,
name|Qt
operator|::
name|black
argument_list|)
expr_stmt|;
name|gradient2
operator|.
name|setColorAt
argument_list|(
literal|1
argument_list|,
name|Qt
operator|::
name|transparent
argument_list|)
expr_stmt|;
name|gradient2
operator|.
name|setSpread
argument_list|(
name|QGradient
operator|::
name|RepeatSpread
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setBackgroundBrush
argument_list|(
name|gradient2
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|}
block|}
comment|// Test transformation extremes, see if they cause crashes
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addText
argument_list|(
literal|"GraphicsView rotated clockwise"
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|160
condition|;
operator|++
name|i
control|)
block|{
name|view
operator|.
name|rotate
argument_list|(
literal|18
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|}
comment|/*           // These cause a crash         for (int i = 0; i< 40; ++i) {             view.shear(1.2, 1.2);             QTest::qWait(20);         }         for (int i = 0; i< 40; ++i) {             view.shear(-1.2, -1.2);             QTest::qWait(20);         }         */
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|20
condition|;
operator|++
name|i
control|)
block|{
name|view
operator|.
name|scale
argument_list|(
literal|1.2
argument_list|,
literal|1.2
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|}
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|20
condition|;
operator|++
name|i
control|)
block|{
name|view
operator|.
name|scale
argument_list|(
literal|0.6
argument_list|,
literal|0.6
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function
DECL|function|matrix_convenience
name|void
name|tst_QGraphicsView
operator|::
name|matrix_convenience
parameter_list|()
block|{
name|QGraphicsView
name|view
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
argument_list|)
expr_stmt|;
comment|// Check the convenience functions
name|view
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|scale
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|scale
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
operator|*
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|shear
argument_list|(
literal|1.2
argument_list|,
literal|1.2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|shear
argument_list|(
literal|1.2
argument_list|,
literal|1.2
argument_list|)
operator|*
name|QMatrix
argument_list|()
operator|.
name|scale
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
operator|*
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|translate
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|translate
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
operator|*
name|QMatrix
argument_list|()
operator|.
name|shear
argument_list|(
literal|1.2
argument_list|,
literal|1.2
argument_list|)
operator|*
name|QMatrix
argument_list|()
operator|.
name|scale
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
operator|*
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|matrix_combine
name|void
name|tst_QGraphicsView
operator|::
name|matrix_combine
parameter_list|()
block|{
comment|// Check matrix combining
name|QGraphicsView
name|view
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setMatrix
argument_list|(
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setMatrix
argument_list|(
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setMatrix
argument_list|(
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setMatrix
argument_list|(
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|resetMatrix
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setMatrix
argument_list|(
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|view
operator|.
name|setMatrix
argument_list|(
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|view
operator|.
name|setMatrix
argument_list|(
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|view
operator|.
name|setMatrix
argument_list|(
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|centerOnPoint
name|void
name|tst_QGraphicsView
operator|::
name|centerOnPoint
parameter_list|()
block|{
name|QWidget
name|toplevel
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
literal|50
argument_list|,
operator|-
literal|100
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|toplevel
argument_list|)
decl_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|400
argument_list|,
operator|-
literal|400
argument_list|,
literal|800
argument_list|,
literal|800
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|toplevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|int
name|tolerance
init|=
literal|5
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
operator|++
name|i
control|)
block|{
for|for
control|(
name|int
name|y
init|=
operator|-
literal|100
init|;
name|y
operator|<
literal|100
condition|;
name|y
operator|+=
literal|23
control|)
block|{
for|for
control|(
name|int
name|x
init|=
operator|-
literal|100
init|;
name|x
operator|<
literal|100
condition|;
name|x
operator|+=
literal|23
control|)
block|{
name|view
operator|.
name|centerOn
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|QPoint
name|viewCenter
init|=
name|view
operator|.
name|mapToScene
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
operator|.
name|toPoint
argument_list|()
decl_stmt|;
comment|// Fuzzy compare
if|if
condition|(
name|viewCenter
operator|.
name|x
argument_list|()
operator|<
name|x
operator|-
name|tolerance
operator|||
name|viewCenter
operator|.
name|x
argument_list|()
operator|>
name|x
operator|+
name|tolerance
operator|||
name|viewCenter
operator|.
name|y
argument_list|()
operator|<
name|y
operator|-
name|tolerance
operator|||
name|viewCenter
operator|.
name|y
argument_list|()
operator|>
name|y
operator|+
name|tolerance
condition|)
block|{
name|QString
name|error
init|=
name|QString
argument_list|(
literal|"Compared values are not the same\n\tActual: (%1, %2)\n\tExpected: (%3, %4)"
argument_list|)
operator|.
name|arg
argument_list|(
name|viewCenter
operator|.
name|x
argument_list|()
argument_list|)
operator|.
name|arg
argument_list|(
name|viewCenter
operator|.
name|y
argument_list|()
argument_list|)
operator|.
name|arg
argument_list|(
name|x
argument_list|)
operator|.
name|arg
argument_list|(
name|y
argument_list|)
decl_stmt|;
name|QFAIL
argument_list|(
name|qPrintable
argument_list|(
name|error
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|}
block|}
name|view
operator|.
name|rotate
argument_list|(
literal|13
argument_list|)
expr_stmt|;
name|view
operator|.
name|scale
argument_list|(
literal|1.5
argument_list|,
literal|1.5
argument_list|)
expr_stmt|;
name|view
operator|.
name|shear
argument_list|(
literal|1.25
argument_list|,
literal|1.25
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|centerOnItem
name|void
name|tst_QGraphicsView
operator|::
name|centerOnItem
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|items
index|[
literal|4
index|]
decl_stmt|;
name|items
index|[
literal|0
index|]
operator|=
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|items
index|[
literal|1
index|]
operator|=
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|items
index|[
literal|2
index|]
operator|=
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|items
index|[
literal|3
index|]
operator|=
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|items
index|[
literal|0
index|]
operator|->
name|setPos
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
expr_stmt|;
name|items
index|[
literal|1
index|]
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
expr_stmt|;
name|items
index|[
literal|2
index|]
operator|->
name|setPos
argument_list|(
operator|-
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|items
index|[
literal|3
index|]
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|,
literal|2000
argument_list|,
literal|2000
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|int
name|tolerance
init|=
literal|7
decl_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
literal|3
condition|;
operator|++
name|x
control|)
block|{
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
operator|++
name|i
control|)
block|{
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|view
operator|.
name|centerOn
argument_list|(
name|items
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|QPoint
name|viewCenter
init|=
name|view
operator|.
name|mapToScene
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
operator|.
name|toPoint
argument_list|()
decl_stmt|;
name|qreal
name|x
init|=
name|items
index|[
name|i
index|]
operator|->
name|pos
argument_list|()
operator|.
name|x
argument_list|()
decl_stmt|;
name|qreal
name|y
init|=
name|items
index|[
name|i
index|]
operator|->
name|pos
argument_list|()
operator|.
name|y
argument_list|()
decl_stmt|;
comment|// Fuzzy compare
if|if
condition|(
name|viewCenter
operator|.
name|x
argument_list|()
operator|<
name|x
operator|-
name|tolerance
operator|||
name|viewCenter
operator|.
name|x
argument_list|()
operator|>
name|x
operator|+
name|tolerance
operator|||
name|viewCenter
operator|.
name|y
argument_list|()
operator|<
name|y
operator|-
name|tolerance
operator|||
name|viewCenter
operator|.
name|y
argument_list|()
operator|>
name|y
operator|+
name|tolerance
condition|)
block|{
name|QString
name|error
init|=
name|QString
argument_list|(
literal|"Compared values are not the same\n\tActual: (%1, %2)\n\tExpected: (%3, %4)"
argument_list|)
operator|.
name|arg
argument_list|(
name|viewCenter
operator|.
name|x
argument_list|()
argument_list|)
operator|.
name|arg
argument_list|(
name|viewCenter
operator|.
name|y
argument_list|()
argument_list|)
operator|.
name|arg
argument_list|(
name|x
argument_list|)
operator|.
name|arg
argument_list|(
name|y
argument_list|)
decl_stmt|;
name|QFAIL
argument_list|(
name|qPrintable
argument_list|(
name|error
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|}
name|view
operator|.
name|rotate
argument_list|(
literal|13
argument_list|)
expr_stmt|;
name|view
operator|.
name|scale
argument_list|(
literal|1.5
argument_list|,
literal|1.5
argument_list|)
expr_stmt|;
name|view
operator|.
name|shear
argument_list|(
literal|1.25
argument_list|,
literal|1.25
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|ensureVisibleRect
name|void
name|tst_QGraphicsView
operator|::
name|ensureVisibleRect
parameter_list|()
block|{
name|QWidget
name|toplevel
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|items
index|[
literal|4
index|]
decl_stmt|;
name|items
index|[
literal|0
index|]
operator|=
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
argument_list|)
expr_stmt|;
name|items
index|[
literal|1
index|]
operator|=
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
argument_list|)
expr_stmt|;
name|items
index|[
literal|2
index|]
operator|=
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
expr_stmt|;
name|items
index|[
literal|3
index|]
operator|=
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|yellow
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addLine
argument_list|(
name|QLineF
argument_list|(
literal|0
argument_list|,
operator|-
literal|100
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|blue
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addLine
argument_list|(
name|QLineF
argument_list|(
operator|-
literal|100
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|blue
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|items
index|[
literal|0
index|]
operator|->
name|setPos
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
expr_stmt|;
name|items
index|[
literal|1
index|]
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
expr_stmt|;
name|items
index|[
literal|2
index|]
operator|->
name|setPos
argument_list|(
operator|-
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|items
index|[
literal|3
index|]
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|icon
init|=
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|gray
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|toplevel
argument_list|)
decl_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|500
argument_list|,
operator|-
literal|500
argument_list|,
literal|1000
argument_list|,
literal|1000
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|250
argument_list|,
literal|250
argument_list|)
expr_stmt|;
name|toplevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|toplevel
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|y
init|=
operator|-
literal|100
init|;
name|y
operator|<
literal|100
condition|;
name|y
operator|+=
literal|25
control|)
block|{
for|for
control|(
name|int
name|x
init|=
operator|-
literal|100
init|;
name|x
operator|<
literal|100
condition|;
name|x
operator|+=
literal|13
control|)
block|{
name|icon
operator|->
name|setPos
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|x
operator|&
literal|3
condition|)
block|{
case|case
literal|0
case|:
name|view
operator|.
name|centerOn
argument_list|(
operator|-
literal|500
argument_list|,
operator|-
literal|500
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|view
operator|.
name|centerOn
argument_list|(
literal|500
argument_list|,
operator|-
literal|500
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|view
operator|.
name|centerOn
argument_list|(
operator|-
literal|500
argument_list|,
literal|500
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
default|default:
name|view
operator|.
name|centerOn
argument_list|(
literal|500
argument_list|,
literal|500
argument_list|)
expr_stmt|;
break|break;
block|}
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|contains
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|margin
init|=
literal|10
init|;
name|margin
operator|<
literal|60
condition|;
name|margin
operator|+=
literal|15
control|)
block|{
name|view
operator|.
name|ensureVisible
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|margin
argument_list|,
name|margin
argument_list|)
expr_stmt|;
name|QRect
name|viewRect
init|=
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
decl_stmt|;
name|QPoint
name|viewPoint
init|=
name|view
operator|.
name|mapFromScene
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|viewRect
operator|.
name|contains
argument_list|(
name|viewPoint
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|viewPoint
operator|.
name|x
argument_list|()
operator|-
name|viewRect
operator|.
name|left
argument_list|()
argument_list|)
operator|>=
name|margin
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|viewPoint
operator|.
name|x
argument_list|()
operator|-
name|viewRect
operator|.
name|right
argument_list|()
argument_list|)
operator|>=
name|margin
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|viewPoint
operator|.
name|y
argument_list|()
operator|-
name|viewRect
operator|.
name|top
argument_list|()
argument_list|)
operator|>=
name|margin
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|viewPoint
operator|.
name|y
argument_list|()
operator|-
name|viewRect
operator|.
name|bottom
argument_list|()
argument_list|)
operator|>=
name|margin
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|}
block|}
name|view
operator|.
name|rotate
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|view
operator|.
name|scale
argument_list|(
literal|1.05
argument_list|,
literal|1.05
argument_list|)
expr_stmt|;
name|view
operator|.
name|translate
argument_list|(
literal|30
argument_list|,
operator|-
literal|30
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|fitInView
name|void
name|tst_QGraphicsView
operator|::
name|fitInView
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|items
index|[
literal|4
index|]
decl_stmt|;
name|items
index|[
literal|0
index|]
operator|=
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|100
argument_list|,
literal|20
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
argument_list|)
expr_stmt|;
name|items
index|[
literal|1
index|]
operator|=
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|20
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
argument_list|)
expr_stmt|;
name|items
index|[
literal|2
index|]
operator|=
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
expr_stmt|;
name|items
index|[
literal|3
index|]
operator|=
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|yellow
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addLine
argument_list|(
name|QLineF
argument_list|(
literal|0
argument_list|,
operator|-
literal|100
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|blue
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addLine
argument_list|(
name|QLineF
argument_list|(
operator|-
literal|100
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|blue
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|items
index|[
literal|0
index|]
operator|->
name|setPos
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
expr_stmt|;
name|items
index|[
literal|1
index|]
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
expr_stmt|;
name|items
index|[
literal|2
index|]
operator|->
name|setPos
argument_list|(
operator|-
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|items
index|[
literal|3
index|]
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|items
index|[
literal|0
index|]
operator|->
name|rotate
argument_list|(
literal|30
argument_list|)
expr_stmt|;
name|items
index|[
literal|1
index|]
operator|->
name|rotate
argument_list|(
operator|-
literal|30
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
comment|//Is the standard scrollbar size
name|int
name|scrollbarSize
init|=
name|qApp
operator|->
name|style
argument_list|()
operator|->
name|pixelMetric
argument_list|(
name|QStyle
operator|::
name|PM_ScrollBarExtent
argument_list|)
operator|-
literal|13
decl_stmt|;
endif|#
directive|endif
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|400
argument_list|,
operator|-
literal|400
argument_list|,
literal|800
argument_list|,
literal|800
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
comment|//We need to take in account the scrollbar size for the WindowsMobilStyle
name|view
operator|.
name|setFixedSize
argument_list|(
literal|400
operator|+
name|scrollbarSize
argument_list|,
literal|200
operator|+
name|scrollbarSize
argument_list|)
expr_stmt|;
else|#
directive|else
name|view
operator|.
name|setFixedSize
argument_list|(
literal|400
argument_list|,
literal|200
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|view
operator|.
name|fitInView
argument_list|(
name|scene
operator|.
name|itemsBoundingRect
argument_list|()
argument_list|,
name|Qt
operator|::
name|IgnoreAspectRatio
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// Sampled coordinates.
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
literal|45
argument_list|,
literal|41
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
literal|297
argument_list|,
literal|44
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
literal|359
argument_list|,
literal|143
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|79
argument_list|,
literal|22
argument_list|)
argument_list|,
name|items
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|329
argument_list|,
literal|41
argument_list|)
argument_list|,
name|items
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|38
argument_list|,
literal|158
argument_list|)
argument_list|,
name|items
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|332
argument_list|,
literal|160
argument_list|)
argument_list|,
name|items
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
name|view
operator|.
name|fitInView
argument_list|(
name|items
index|[
literal|0
index|]
argument_list|,
name|Qt
operator|::
name|IgnoreAspectRatio
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|19
argument_list|,
literal|13
argument_list|)
argument_list|,
name|items
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|91
argument_list|,
literal|47
argument_list|)
argument_list|,
name|items
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|202
argument_list|,
literal|94
argument_list|)
argument_list|,
name|items
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|344
argument_list|,
literal|161
argument_list|)
argument_list|,
name|items
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
literal|236
argument_list|,
literal|54
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
literal|144
argument_list|,
literal|11
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
literal|29
argument_list|,
literal|69
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
literal|251
argument_list|,
literal|167
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|fitInView
argument_list|(
name|items
index|[
literal|0
index|]
argument_list|,
name|Qt
operator|::
name|KeepAspectRatio
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|325
argument_list|,
literal|170
argument_list|)
argument_list|,
name|items
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|206
argument_list|,
literal|74
argument_list|)
argument_list|,
name|items
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|190
argument_list|,
literal|115
argument_list|)
argument_list|,
name|items
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|55
argument_list|,
literal|14
argument_list|)
argument_list|,
name|items
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
literal|109
argument_list|,
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
literal|244
argument_list|,
literal|68
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
literal|310
argument_list|,
literal|125
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
literal|261
argument_list|,
literal|168
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|fitInView
argument_list|(
name|items
index|[
literal|0
index|]
argument_list|,
name|Qt
operator|::
name|KeepAspectRatioByExpanding
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|18
argument_list|,
literal|10
argument_list|)
argument_list|,
name|items
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|95
argument_list|,
literal|4
argument_list|)
argument_list|,
name|items
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|279
argument_list|,
literal|175
argument_list|)
argument_list|,
name|items
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|359
argument_list|,
literal|170
argument_list|)
argument_list|,
name|items
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
literal|370
argument_list|,
literal|166
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
literal|136
argument_list|,
literal|7
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
literal|31
argument_list|,
literal|44
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
literal|203
argument_list|,
literal|153
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemsAtPoint
name|void
name|tst_QGraphicsView
operator|::
name|itemsAtPoint
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
decl_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|items
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|items
init|=
name|view
operator|.
name|items
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|3
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
operator|-
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_if
if|#
directive|if
name|defined
name|QT_BUILD_INTERNAL
end_if
begin_function
DECL|function|itemsAtPosition_data
name|void
name|tst_QGraphicsView
operator|::
name|itemsAtPosition_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|float
argument_list|>
argument_list|(
literal|"rotation"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|float
argument_list|>
argument_list|(
literal|"scale"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QPoint
argument_list|>
argument_list|(
literal|"viewPos"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"ignoreTransform"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"hit"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"scaled + ignore transform, no hit"
argument_list|)
operator|<<
literal|0.0f
operator|<<
literal|1000.0f
operator|<<
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"scaled + ignore transform, hit"
argument_list|)
operator|<<
literal|0.0f
operator|<<
literal|1000.0f
operator|<<
name|QPoint
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"rotated + scaled, no hit"
argument_list|)
operator|<<
literal|45.0f
operator|<<
literal|2.0f
operator|<<
name|QPoint
argument_list|(
literal|90
argument_list|,
literal|90
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"rotated + scaled, hit"
argument_list|)
operator|<<
literal|45.0f
operator|<<
literal|2.0f
operator|<<
name|QPoint
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemsAtPosition
name|void
name|tst_QGraphicsView
operator|::
name|itemsAtPosition
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|float
argument_list|,
name|rotation
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|float
argument_list|,
name|scale
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QPoint
argument_list|,
name|viewPos
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|ignoreTransform
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|hit
argument_list|)
expr_stmt|;
name|FriendlyGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
name|QRect
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
if|if
condition|(
name|ignoreTransform
condition|)
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIgnoresTransformations
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
decl_stmt|;
name|view
operator|.
name|setFrameStyle
argument_list|(
name|QFrame
operator|::
name|NoFrame
argument_list|)
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|view
operator|.
name|scale
argument_list|(
name|scale
argument_list|,
name|scale
argument_list|)
expr_stmt|;
name|view
operator|.
name|rotate
argument_list|(
name|rotation
argument_list|)
expr_stmt|;
name|view
operator|.
name|setHorizontalScrollBarPolicy
argument_list|(
name|Qt
operator|::
name|ScrollBarAlwaysOff
argument_list|)
expr_stmt|;
name|view
operator|.
name|setVerticalScrollBarPolicy
argument_list|(
name|Qt
operator|::
name|ScrollBarAlwaysOff
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QPoint
name|screenPos
init|=
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|viewPos
argument_list|)
decl_stmt|;
name|QPointF
name|scenePos
init|=
name|view
operator|.
name|mapToScene
argument_list|(
name|viewPos
argument_list|)
decl_stmt|;
name|QGraphicsScenePrivate
modifier|*
name|viewPrivate
init|=
name|scene
operator|.
name|d_func
argument_list|()
decl_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|items
decl_stmt|;
name|items
operator|=
name|viewPrivate
operator|->
name|itemsAtPosition
argument_list|(
name|screenPos
argument_list|,
name|scenePos
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
operator|!
name|items
operator|.
name|empty
argument_list|()
argument_list|,
name|hit
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_function
DECL|function|itemsInRect
name|void
name|tst_QGraphicsView
operator|::
name|itemsInRect
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|6
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|7
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
decl_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|items
argument_list|(
name|QRect
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QRect
name|leftRect
init|=
name|view
operator|.
name|mapFromScene
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
operator|.
name|boundingRect
argument_list|()
decl_stmt|;
name|QRect
name|rightRect
init|=
name|view
operator|.
name|mapFromScene
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
operator|.
name|boundingRect
argument_list|()
decl_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|items
init|=
name|view
operator|.
name|items
argument_list|(
name|leftRect
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|3
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
operator|-
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|items
operator|=
name|view
operator|.
name|items
argument_list|(
name|rightRect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|7
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|6
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|3
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|CountPaintItem
class|class
name|CountPaintItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|member|numPaints
name|int
name|numPaints
decl_stmt|;
DECL|function|CountPaintItem
name|CountPaintItem
parameter_list|(
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|)
member_init_list|,
name|numPaints
argument_list|(
literal|0
argument_list|)
block|{ }
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
name|widget
init|=
literal|0
parameter_list|)
block|{
operator|++
name|numPaints
expr_stmt|;
name|QGraphicsRectItem
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|widget
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|itemsInRect_cosmeticAdjust_data
name|void
name|tst_QGraphicsView
operator|::
name|itemsInRect_cosmeticAdjust_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QRect
argument_list|>
argument_list|(
literal|"updateRect"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"numPaints"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"adjustForAntialiasing"
argument_list|)
expr_stmt|;
comment|// Aliased.
name|QTest
operator|::
name|newRow
argument_list|(
literal|"nil"
argument_list|)
operator|<<
name|QRect
argument_list|()
operator|<<
literal|1
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 0, 300, 100"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|100
argument_list|)
operator|<<
literal|1
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 0, 100, 300"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|300
argument_list|)
operator|<<
literal|1
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"200, 0, 100, 300"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|200
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|300
argument_list|)
operator|<<
literal|1
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 200, 300, 100"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|200
argument_list|,
literal|300
argument_list|,
literal|100
argument_list|)
operator|<<
literal|1
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 0, 300, 99"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|99
argument_list|)
operator|<<
literal|0
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 0, 99, 300"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|99
argument_list|,
literal|300
argument_list|)
operator|<<
literal|0
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"201, 0, 99, 300"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|201
argument_list|,
literal|0
argument_list|,
literal|99
argument_list|,
literal|300
argument_list|)
operator|<<
literal|0
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 201, 300, 99"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|201
argument_list|,
literal|300
argument_list|,
literal|99
argument_list|)
operator|<<
literal|0
operator|<<
literal|false
expr_stmt|;
comment|// Anti-aliased.
name|QTest
operator|::
name|newRow
argument_list|(
literal|"nil"
argument_list|)
operator|<<
name|QRect
argument_list|()
operator|<<
literal|1
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 0, 300, 100"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|100
argument_list|)
operator|<<
literal|1
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 0, 100, 300"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|300
argument_list|)
operator|<<
literal|1
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"200, 0, 100, 300"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|200
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|300
argument_list|)
operator|<<
literal|1
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 200, 300, 100"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|200
argument_list|,
literal|300
argument_list|,
literal|100
argument_list|)
operator|<<
literal|1
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 0, 300, 99"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|99
argument_list|)
operator|<<
literal|1
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 0, 99, 300"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|99
argument_list|,
literal|300
argument_list|)
operator|<<
literal|1
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"201, 0, 99, 300"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|201
argument_list|,
literal|0
argument_list|,
literal|99
argument_list|,
literal|300
argument_list|)
operator|<<
literal|1
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 201, 300, 99"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|201
argument_list|,
literal|300
argument_list|,
literal|99
argument_list|)
operator|<<
literal|1
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 0, 300, 98"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|98
argument_list|)
operator|<<
literal|0
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 0, 98, 300"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|98
argument_list|,
literal|300
argument_list|)
operator|<<
literal|0
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"202, 0, 98, 300"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|202
argument_list|,
literal|0
argument_list|,
literal|98
argument_list|,
literal|300
argument_list|)
operator|<<
literal|0
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 202, 300, 98"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|202
argument_list|,
literal|300
argument_list|,
literal|98
argument_list|)
operator|<<
literal|0
operator|<<
literal|false
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemsInRect_cosmeticAdjust
name|void
name|tst_QGraphicsView
operator|::
name|itemsInRect_cosmeticAdjust
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QRect
argument_list|,
name|updateRect
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|numPaints
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|adjustForAntialiasing
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|CountPaintItem
modifier|*
name|rect
init|=
operator|new
name|CountPaintItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|rect
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setOptimizationFlag
argument_list|(
name|QGraphicsView
operator|::
name|DontAdjustForAntialiasing
argument_list|,
operator|!
name|adjustForAntialiasing
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRenderHint
argument_list|(
name|QPainter
operator|::
name|Antialiasing
argument_list|,
name|adjustForAntialiasing
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFrameStyle
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|300
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|rect
operator|->
name|numPaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|rect
operator|->
name|numPaints
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|updateRect
operator|.
name|isNull
argument_list|()
condition|)
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|update
argument_list|()
expr_stmt|;
else|else
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|update
argument_list|(
name|updateRect
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|rect
operator|->
name|numPaints
argument_list|,
name|numPaints
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemsInPoly
name|void
name|tst_QGraphicsView
operator|::
name|itemsInPoly
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|6
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|7
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
decl_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|items
argument_list|(
name|QPolygon
argument_list|()
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QPolygon
name|leftPoly
init|=
name|view
operator|.
name|mapFromScene
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QPolygon
name|rightPoly
init|=
name|view
operator|.
name|mapFromScene
argument_list|(
name|QRectF
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|items
init|=
name|view
operator|.
name|items
argument_list|(
name|leftPoly
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|3
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
operator|-
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|items
operator|=
name|view
operator|.
name|items
argument_list|(
name|rightPoly
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|7
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|6
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|3
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemsInPath
name|void
name|tst_QGraphicsView
operator|::
name|itemsInPath
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|6
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|7
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
decl_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|items
argument_list|(
name|QPainterPath
argument_list|()
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|translate
argument_list|(
literal|100
argument_list|,
literal|400
argument_list|)
expr_stmt|;
name|view
operator|.
name|rotate
argument_list|(
literal|22.3
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QPainterPath
name|leftPath
decl_stmt|;
name|leftPath
operator|.
name|addEllipse
argument_list|(
name|QRect
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|,
name|QSize
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QPainterPath
name|rightPath
decl_stmt|;
name|rightPath
operator|.
name|addEllipse
argument_list|(
name|QRect
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
literal|30
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|,
name|QSize
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|items
init|=
name|view
operator|.
name|items
argument_list|(
name|leftPath
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|3
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
operator|-
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|items
operator|=
name|view
operator|.
name|items
argument_list|(
name|rightPath
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|7
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|6
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|takeFirst
argument_list|()
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|3
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemAt
name|void
name|tst_QGraphicsView
operator|::
name|itemAt
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item
init|=
name|view
operator|.
name|itemAt
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|3
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemAt2
name|void
name|tst_QGraphicsView
operator|::
name|itemAt2
parameter_list|()
block|{
comment|// test precision of the itemAt() function with items that are smaller
comment|// than 1 pixel.
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
comment|// Add a 0.5x0.5 item at position 0 on the scene, top-left corner at -0.25, -0.25.
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|0.25
argument_list|,
operator|-
literal|0.25
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0.1
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|view
operator|.
name|setTransformationAnchor
argument_list|(
name|QGraphicsView
operator|::
name|NoAnchor
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRenderHint
argument_list|(
name|QPainter
operator|::
name|Antialiasing
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QPoint
name|itemViewPoint
init|=
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
operator|++
name|i
control|)
block|{
name|QVERIFY
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|itemViewPoint
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|items
argument_list|(
name|itemViewPoint
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|itemViewPoint
operator|+
name|QPoint
argument_list|(
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|items
argument_list|(
name|itemViewPoint
operator|+
name|QPoint
argument_list|(
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|itemViewPoint
operator|+
name|QPoint
argument_list|(
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|items
argument_list|(
name|itemViewPoint
operator|+
name|QPoint
argument_list|(
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|itemViewPoint
operator|+
name|QPoint
argument_list|(
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|items
argument_list|(
name|itemViewPoint
operator|+
name|QPoint
argument_list|(
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|moveBy
argument_list|(
literal|0.1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
comment|// Here
name|QVERIFY
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|itemViewPoint
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|items
argument_list|(
name|itemViewPoint
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|itemViewPoint
operator|+
name|QPoint
argument_list|(
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|items
argument_list|(
name|itemViewPoint
operator|+
name|QPoint
argument_list|(
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
sizeof|sizeof
argument_list|(
name|qreal
argument_list|)
operator|!=
sizeof|sizeof
argument_list|(
name|double
argument_list|)
condition|)
name|QSKIP
argument_list|(
literal|"Skipped due to rounding errors"
argument_list|)
expr_stmt|;
comment|// Not here
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
name|itemViewPoint
operator|+
name|QPoint
argument_list|(
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|items
argument_list|(
name|itemViewPoint
operator|+
name|QPoint
argument_list|(
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|itemAt
argument_list|(
name|itemViewPoint
operator|+
name|QPoint
argument_list|(
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|items
argument_list|(
name|itemViewPoint
operator|+
name|QPoint
argument_list|(
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|mapToScene
name|void
name|tst_QGraphicsView
operator|::
name|mapToScene
parameter_list|()
block|{
comment|// Uncomment the commented-out code to see what's going on. It doesn't
comment|// affect the test; it just slows it down.
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addPixmap
argument_list|(
name|QPixmap
argument_list|(
literal|"3D-Qt-1-2.png"
argument_list|)
argument_list|)
expr_stmt|;
name|QWidget
name|topLevel
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|topLevel
argument_list|)
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|500
argument_list|,
operator|-
literal|500
argument_list|,
literal|1000
argument_list|,
literal|1000
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
name|QSize
name|viewSize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
else|#
directive|else
name|QSize
name|viewSize
argument_list|(
literal|300
argument_list|,
literal|300
argument_list|)
decl_stmt|;
endif|#
directive|endif
name|view
operator|.
name|setFixedSize
argument_list|(
name|viewSize
argument_list|)
expr_stmt|;
name|topLevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|size
argument_list|()
argument_list|,
name|viewSize
argument_list|)
expr_stmt|;
comment|// First once without setting the scene rect
ifdef|#
directive|ifdef
name|Q_PROCESSOR_ARM
specifier|const
name|int
name|step
init|=
literal|20
decl_stmt|;
else|#
directive|else
specifier|const
name|int
name|step
init|=
literal|5
decl_stmt|;
endif|#
directive|endif
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
name|view
operator|.
name|width
argument_list|()
condition|;
name|x
operator|+=
name|step
control|)
block|{
for|for
control|(
name|int
name|y
init|=
literal|0
init|;
name|y
operator|<
name|view
operator|.
name|height
argument_list|()
condition|;
name|y
operator|+=
name|step
control|)
block|{
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapToScene
argument_list|(
name|QPoint
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
argument_list|)
argument_list|,
name|QPointF
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
operator|+
name|x
argument_list|,
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
operator|+
name|y
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
for|for
control|(
name|int
name|sceneRectHeight
init|=
literal|250
init|;
name|sceneRectHeight
operator|<
literal|1000
condition|;
name|sceneRectHeight
operator|+=
literal|250
control|)
block|{
for|for
control|(
name|int
name|sceneRectWidth
init|=
literal|250
init|;
name|sceneRectWidth
operator|<
literal|1000
condition|;
name|sceneRectWidth
operator|+=
literal|250
control|)
block|{
name|view
operator|.
name|setSceneRect
argument_list|(
name|QRectF
argument_list|(
operator|-
name|int
argument_list|(
name|sceneRectWidth
operator|/
literal|2
argument_list|)
argument_list|,
operator|-
name|int
argument_list|(
name|sceneRectHeight
operator|/
literal|2
argument_list|)
argument_list|,
name|sceneRectWidth
argument_list|,
name|sceneRectHeight
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|int
name|hmin
init|=
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|minimum
argument_list|()
decl_stmt|;
name|int
name|hmax
init|=
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|maximum
argument_list|()
decl_stmt|;
name|int
name|hstep
init|=
operator|(
name|hmax
operator|-
name|hmin
operator|)
operator|/
literal|3
decl_stmt|;
name|int
name|vmin
init|=
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|minimum
argument_list|()
decl_stmt|;
name|int
name|vmax
init|=
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|maximum
argument_list|()
decl_stmt|;
name|int
name|vstep
init|=
operator|(
name|vmax
operator|-
name|vmin
operator|)
operator|/
literal|3
decl_stmt|;
for|for
control|(
name|int
name|hscrollValue
init|=
name|hmin
init|;
name|hscrollValue
operator|<
name|hmax
condition|;
name|hscrollValue
operator|+=
name|hstep
control|)
block|{
for|for
control|(
name|int
name|vscrollValue
init|=
name|vmin
init|;
name|vscrollValue
operator|<
name|vmax
condition|;
name|vscrollValue
operator|+=
name|vstep
control|)
block|{
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|setValue
argument_list|(
name|hscrollValue
argument_list|)
expr_stmt|;
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|setValue
argument_list|(
name|vscrollValue
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|int
name|h
init|=
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
decl_stmt|;
name|int
name|v
init|=
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
name|view
operator|.
name|width
argument_list|()
condition|;
name|x
operator|+=
name|step
control|)
block|{
for|for
control|(
name|int
name|y
init|=
literal|0
init|;
name|y
operator|<
name|view
operator|.
name|height
argument_list|()
condition|;
name|y
operator|+=
name|step
control|)
block|{
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapToScene
argument_list|(
name|QPoint
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
argument_list|)
argument_list|,
name|QPointF
argument_list|(
name|h
operator|+
name|x
argument_list|,
name|v
operator|+
name|y
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|QPointF
argument_list|(
name|h
operator|+
name|x
argument_list|,
name|v
operator|+
name|y
argument_list|)
argument_list|)
argument_list|,
name|QPoint
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
block|}
block|}
block|}
end_function
begin_function
DECL|function|mapToScenePoint
name|void
name|tst_QGraphicsView
operator|::
name|mapToScenePoint
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|117
argument_list|,
literal|117
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QPoint
name|center
init|=
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapToScene
argument_list|(
name|center
operator|+
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
name|view
operator|.
name|mapToScene
argument_list|(
name|center
argument_list|)
operator|+
name|QPointF
argument_list|(
literal|0
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|mapToSceneRect_data
name|void
name|tst_QGraphicsView
operator|::
name|mapToSceneRect_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QRect
argument_list|>
argument_list|(
literal|"viewRect"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QPolygonF
argument_list|>
argument_list|(
literal|"scenePoly"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"rotation"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"nil"
argument_list|)
operator|<<
name|QRect
argument_list|()
operator|<<
name|QPolygonF
argument_list|()
operator|<<
name|qreal
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 0, 1, 1"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
operator|<<
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 0, 10, 10"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"nil"
argument_list|)
operator|<<
name|QRect
argument_list|()
operator|<<
name|QPolygonF
argument_list|()
operator|<<
name|qreal
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|QPolygonF
name|p
decl_stmt|;
name|p
operator|<<
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|0
argument_list|,
operator|-
literal|1
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 0, 1, 1"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
operator|<<
name|p
operator|<<
name|qreal
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|p
operator|.
name|clear
argument_list|()
expr_stmt|;
name|p
operator|<<
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|0
argument_list|,
operator|-
literal|10
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0, 0, 10, 10"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|p
operator|<<
name|qreal
argument_list|(
literal|90
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|mapToSceneRect
name|void
name|tst_QGraphicsView
operator|::
name|mapToSceneRect
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QRect
argument_list|,
name|viewRect
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QPolygonF
argument_list|,
name|scenePoly
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|rotation
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|,
literal|2000
argument_list|,
literal|2000
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFrameStyle
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|setAlignment
argument_list|(
name|Qt
operator|::
name|AlignTop
operator||
name|Qt
operator|::
name|AlignLeft
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|view
operator|.
name|setTransformationAnchor
argument_list|(
name|QGraphicsView
operator|::
name|NoAnchor
argument_list|)
expr_stmt|;
name|view
operator|.
name|setResizeAnchor
argument_list|(
name|QGraphicsView
operator|::
name|NoAnchor
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|view
operator|.
name|rotate
argument_list|(
name|rotation
argument_list|)
expr_stmt|;
name|QPolygonF
name|poly
init|=
name|view
operator|.
name|mapToScene
argument_list|(
name|viewRect
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|poly
operator|.
name|isEmpty
argument_list|()
condition|)
name|poly
operator|<<
name|poly
index|[
literal|0
index|]
expr_stmt|;
name|QCOMPARE
argument_list|(
name|poly
argument_list|,
name|scenePoly
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|mapToScenePoly
name|void
name|tst_QGraphicsView
operator|::
name|mapToScenePoly
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|translate
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|117
argument_list|,
literal|117
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QPoint
name|center
init|=
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
decl_stmt|;
name|QRect
name|rect
argument_list|(
name|center
operator|+
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QSize
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|QPolygon
name|poly
decl_stmt|;
name|poly
operator|<<
name|rect
operator|.
name|topLeft
argument_list|()
expr_stmt|;
name|poly
operator|<<
name|rect
operator|.
name|topRight
argument_list|()
expr_stmt|;
name|poly
operator|<<
name|rect
operator|.
name|bottomRight
argument_list|()
expr_stmt|;
name|poly
operator|<<
name|rect
operator|.
name|bottomLeft
argument_list|()
expr_stmt|;
name|QPolygonF
name|poly2
decl_stmt|;
name|poly2
operator|<<
name|view
operator|.
name|mapToScene
argument_list|(
name|rect
operator|.
name|topLeft
argument_list|()
argument_list|)
expr_stmt|;
name|poly2
operator|<<
name|view
operator|.
name|mapToScene
argument_list|(
name|rect
operator|.
name|topRight
argument_list|()
argument_list|)
expr_stmt|;
name|poly2
operator|<<
name|view
operator|.
name|mapToScene
argument_list|(
name|rect
operator|.
name|bottomRight
argument_list|()
argument_list|)
expr_stmt|;
name|poly2
operator|<<
name|view
operator|.
name|mapToScene
argument_list|(
name|rect
operator|.
name|bottomLeft
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapToScene
argument_list|(
name|poly
argument_list|)
argument_list|,
name|poly2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|mapToScenePath
name|void
name|tst_QGraphicsView
operator|::
name|mapToScenePath
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|300
argument_list|,
operator|-
literal|300
argument_list|,
literal|600
argument_list|,
literal|600
argument_list|)
expr_stmt|;
name|view
operator|.
name|translate
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|300
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QRect
name|rect
argument_list|(
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QSize
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|QPainterPath
name|path
decl_stmt|;
name|path
operator|.
name|addRect
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|QPainterPath
name|path2
decl_stmt|;
name|path2
operator|.
name|addRect
argument_list|(
name|rect
operator|.
name|translated
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
operator|-
literal|10
argument_list|,
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
operator|-
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapToScene
argument_list|(
name|path
argument_list|)
argument_list|,
name|path2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|mapFromScenePoint
name|void
name|tst_QGraphicsView
operator|::
name|mapFromScenePoint
parameter_list|()
block|{
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|view
operator|.
name|scale
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|view
operator|.
name|setHorizontalScrollBarPolicy
argument_list|(
name|Qt
operator|::
name|ScrollBarAlwaysOff
argument_list|)
expr_stmt|;
name|view
operator|.
name|setVerticalScrollBarPolicy
argument_list|(
name|Qt
operator|::
name|ScrollBarAlwaysOff
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QPoint
name|mapped
init|=
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QPoint
name|center
init|=
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
decl_stmt|;
if|if
condition|(
name|qAbs
argument_list|(
name|mapped
operator|.
name|x
argument_list|()
operator|-
name|center
operator|.
name|x
argument_list|()
argument_list|)
operator|>=
literal|2
operator|||
name|qAbs
argument_list|(
name|mapped
operator|.
name|y
argument_list|()
operator|-
name|center
operator|.
name|y
argument_list|()
argument_list|)
operator|>=
literal|2
condition|)
block|{
name|QString
name|error
init|=
name|QString
argument_list|(
literal|"Compared values are not the same\n\tActual: (%1, %2)\n\tExpected: (%3, %4)"
argument_list|)
operator|.
name|arg
argument_list|(
name|mapped
operator|.
name|x
argument_list|()
argument_list|)
operator|.
name|arg
argument_list|(
name|mapped
operator|.
name|y
argument_list|()
argument_list|)
operator|.
name|arg
argument_list|(
name|center
operator|.
name|x
argument_list|()
argument_list|)
operator|.
name|arg
argument_list|(
name|center
operator|.
name|y
argument_list|()
argument_list|)
decl_stmt|;
name|QFAIL
argument_list|(
name|qPrintable
argument_list|(
name|error
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|{
name|QWidget
name|toplevel
decl_stmt|;
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|toplevel
argument_list|)
decl_stmt|;
name|view
operator|.
name|ensurePolished
argument_list|()
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
name|view
operator|.
name|sizeHint
argument_list|()
argument_list|)
expr_stmt|;
name|toplevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0.4
argument_list|,
literal|0.4
argument_list|)
argument_list|,
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0.5
argument_list|,
literal|0.5
argument_list|)
argument_list|,
name|QPoint
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0.9
argument_list|,
literal|0.9
argument_list|)
argument_list|,
name|QPoint
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
literal|1.0
argument_list|,
literal|1.0
argument_list|)
argument_list|,
name|QPoint
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPoint
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
literal|100.5
argument_list|,
literal|100.5
argument_list|)
argument_list|,
name|QPoint
argument_list|(
literal|101
argument_list|,
literal|101
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapToScene
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapToScene
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|mapFromSceneRect
name|void
name|tst_QGraphicsView
operator|::
name|mapFromSceneRect
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QWidget
name|topLevel
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|topLevel
argument_list|)
decl_stmt|;
name|view
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|view
operator|.
name|setHorizontalScrollBarPolicy
argument_list|(
name|Qt
operator|::
name|ScrollBarAlwaysOff
argument_list|)
expr_stmt|;
name|view
operator|.
name|setVerticalScrollBarPolicy
argument_list|(
name|Qt
operator|::
name|ScrollBarAlwaysOff
argument_list|)
expr_stmt|;
name|topLevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QPolygon
name|polygon
decl_stmt|;
name|polygon
operator|<<
name|QPoint
argument_list|(
literal|98
argument_list|,
literal|98
argument_list|)
expr_stmt|;
name|polygon
operator|<<
name|QPoint
argument_list|(
literal|98
argument_list|,
literal|108
argument_list|)
expr_stmt|;
name|polygon
operator|<<
name|QPoint
argument_list|(
literal|88
argument_list|,
literal|108
argument_list|)
expr_stmt|;
name|polygon
operator|<<
name|QPoint
argument_list|(
literal|88
argument_list|,
literal|98
argument_list|)
expr_stmt|;
name|QPolygon
name|viewPolygon
init|=
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
operator|++
name|i
control|)
block|{
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|viewPolygon
index|[
name|i
index|]
operator|.
name|x
argument_list|()
operator|-
name|polygon
index|[
name|i
index|]
operator|.
name|x
argument_list|()
argument_list|)
operator|<
literal|3
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|viewPolygon
index|[
name|i
index|]
operator|.
name|y
argument_list|()
operator|-
name|polygon
index|[
name|i
index|]
operator|.
name|y
argument_list|()
argument_list|)
operator|<
literal|3
argument_list|)
expr_stmt|;
block|}
name|QPoint
name|pt
init|=
name|view
operator|.
name|mapFromScene
argument_list|(
name|QPointF
argument_list|()
argument_list|)
decl_stmt|;
name|QPolygon
name|p
decl_stmt|;
name|p
operator|<<
name|pt
operator|<<
name|pt
operator|<<
name|pt
operator|<<
name|pt
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|QRectF
argument_list|()
argument_list|)
argument_list|,
name|p
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|mapFromScenePoly
name|void
name|tst_QGraphicsView
operator|::
name|mapFromScenePoly
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|view
operator|.
name|setHorizontalScrollBarPolicy
argument_list|(
name|Qt
operator|::
name|ScrollBarAlwaysOff
argument_list|)
expr_stmt|;
name|view
operator|.
name|setVerticalScrollBarPolicy
argument_list|(
name|Qt
operator|::
name|ScrollBarAlwaysOff
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QPolygonF
name|polygon
decl_stmt|;
name|polygon
operator|<<
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|polygon
operator|<<
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|polygon
operator|<<
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|polygon
operator|<<
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QPolygon
name|polygon2
decl_stmt|;
name|polygon2
operator|<<
name|QPoint
argument_list|(
literal|98
argument_list|,
literal|98
argument_list|)
expr_stmt|;
name|polygon2
operator|<<
name|QPoint
argument_list|(
literal|98
argument_list|,
literal|108
argument_list|)
expr_stmt|;
name|polygon2
operator|<<
name|QPoint
argument_list|(
literal|88
argument_list|,
literal|108
argument_list|)
expr_stmt|;
name|polygon2
operator|<<
name|QPoint
argument_list|(
literal|88
argument_list|,
literal|98
argument_list|)
expr_stmt|;
name|QPolygon
name|viewPolygon
init|=
name|view
operator|.
name|mapFromScene
argument_list|(
name|polygon
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
operator|++
name|i
control|)
block|{
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|viewPolygon
index|[
name|i
index|]
operator|.
name|x
argument_list|()
operator|-
name|polygon2
index|[
name|i
index|]
operator|.
name|x
argument_list|()
argument_list|)
operator|<
literal|3
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|viewPolygon
index|[
name|i
index|]
operator|.
name|y
argument_list|()
operator|-
name|polygon2
index|[
name|i
index|]
operator|.
name|y
argument_list|()
argument_list|)
operator|<
literal|3
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|mapFromScenePath
name|void
name|tst_QGraphicsView
operator|::
name|mapFromScenePath
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|view
operator|.
name|setHorizontalScrollBarPolicy
argument_list|(
name|Qt
operator|::
name|ScrollBarAlwaysOff
argument_list|)
expr_stmt|;
name|view
operator|.
name|setVerticalScrollBarPolicy
argument_list|(
name|Qt
operator|::
name|ScrollBarAlwaysOff
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QPolygonF
name|polygon
decl_stmt|;
name|polygon
operator|<<
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|polygon
operator|<<
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|polygon
operator|<<
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|polygon
operator|<<
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QPainterPath
name|path
decl_stmt|;
name|path
operator|.
name|addPolygon
argument_list|(
name|polygon
argument_list|)
expr_stmt|;
name|QPolygon
name|polygon2
decl_stmt|;
name|polygon2
operator|<<
name|QPoint
argument_list|(
literal|98
argument_list|,
literal|98
argument_list|)
expr_stmt|;
name|polygon2
operator|<<
name|QPoint
argument_list|(
literal|98
argument_list|,
literal|108
argument_list|)
expr_stmt|;
name|polygon2
operator|<<
name|QPoint
argument_list|(
literal|88
argument_list|,
literal|108
argument_list|)
expr_stmt|;
name|polygon2
operator|<<
name|QPoint
argument_list|(
literal|88
argument_list|,
literal|98
argument_list|)
expr_stmt|;
name|QPainterPath
name|path2
decl_stmt|;
name|path2
operator|.
name|addPolygon
argument_list|(
name|polygon2
argument_list|)
expr_stmt|;
name|QPolygonF
name|pathPoly
init|=
name|view
operator|.
name|mapFromScene
argument_list|(
name|path
argument_list|)
operator|.
name|toFillPolygon
argument_list|()
decl_stmt|;
name|QPolygonF
name|path2Poly
init|=
name|path2
operator|.
name|toFillPolygon
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|pathPoly
operator|.
name|size
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|pathPoly
index|[
name|i
index|]
operator|.
name|x
argument_list|()
operator|-
name|path2Poly
index|[
name|i
index|]
operator|.
name|x
argument_list|()
argument_list|)
operator|<
literal|3
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|pathPoly
index|[
name|i
index|]
operator|.
name|y
argument_list|()
operator|-
name|path2Poly
index|[
name|i
index|]
operator|.
name|y
argument_list|()
argument_list|)
operator|<
literal|3
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|sendEvent
name|void
name|tst_QGraphicsView
operator|::
name|sendEvent
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|TestItem
modifier|*
name|item
init|=
operator|new
name|TestItem
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|last
argument_list|()
argument_list|,
name|QEvent
operator|::
name|FocusIn
argument_list|)
expr_stmt|;
name|QPoint
name|itemPoint
init|=
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
argument_list|)
decl_stmt|;
name|sendMousePress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|itemPoint
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|at
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|at
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
expr_stmt|;
name|QMouseEvent
name|mouseMoveEvent
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|itemPoint
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|itemPoint
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|mouseMoveEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|last
argument_list|()
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
expr_stmt|;
name|QMouseEvent
name|mouseReleaseEvent
argument_list|(
name|QEvent
operator|::
name|MouseButtonRelease
argument_list|,
name|itemPoint
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|itemPoint
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|mouseReleaseEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|at
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|at
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
expr_stmt|;
name|QKeyEvent
name|keyPress
argument_list|(
name|QEvent
operator|::
name|KeyPress
argument_list|,
name|Qt
operator|::
name|Key_Space
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|keyPress
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|at
argument_list|(
name|item
operator|->
name|events
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|ShortcutOverride
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|events
operator|.
name|last
argument_list|()
argument_list|,
name|QEvent
operator|::
name|KeyPress
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|MouseWheelScene
class|class
name|MouseWheelScene
super|:
specifier|public
name|QGraphicsScene
block|{
public|public:
DECL|member|orientation
name|Qt
operator|::
name|Orientation
name|orientation
decl_stmt|;
DECL|function|wheelEvent
name|void
name|wheelEvent
parameter_list|(
name|QGraphicsSceneWheelEvent
modifier|*
name|event
parameter_list|)
block|{
name|orientation
operator|=
name|event
operator|->
name|orientation
argument_list|()
expr_stmt|;
name|QGraphicsScene
operator|::
name|wheelEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|wheelEvent
name|void
name|tst_QGraphicsView
operator|::
name|wheelEvent
parameter_list|()
block|{
comment|// Create a scene with an invalid orientation.
name|MouseWheelScene
name|scene
decl_stmt|;
name|scene
operator|.
name|orientation
operator|=
name|Qt
operator|::
name|Orientation
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|widget
operator|->
name|setGeometry
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|400
argument_list|,
literal|400
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|WheelFocus
argument_list|)
expr_stmt|;
name|EventSpy
name|spy
argument_list|(
name|widget
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneWheel
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
comment|// Assign a view.
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
comment|// Send a wheel event with horizontal orientation.
block|{
name|QWheelEvent
name|event
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|widget
operator|->
name|boundingRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
argument_list|,
name|view
operator|.
name|mapToGlobal
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|widget
operator|->
name|boundingRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
argument_list|)
argument_list|,
literal|120
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|Qt
operator|::
name|Horizontal
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|orientation
argument_list|,
name|Qt
operator|::
name|Horizontal
argument_list|)
expr_stmt|;
block|}
comment|// Send a wheel event with vertical orientation.
block|{
name|QWheelEvent
name|event
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|widget
operator|->
name|boundingRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
argument_list|,
name|view
operator|.
name|mapToGlobal
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|widget
operator|->
name|boundingRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
argument_list|)
argument_list|,
literal|120
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|Qt
operator|::
name|Vertical
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|orientation
argument_list|,
name|Qt
operator|::
name|Vertical
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|widget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_ifndef
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
end_ifndef
begin_function
DECL|function|cursor
name|void
name|tst_QGraphicsView
operator|::
name|cursor
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setCursor
argument_list|(
name|Qt
operator|::
name|IBeamCursor
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|400
argument_list|,
literal|400
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|QCursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|setCursor
argument_list|(
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|IBeamCursor
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|QPoint
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_ifndef
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
end_ifndef
begin_function
DECL|function|cursor2
name|void
name|tst_QGraphicsView
operator|::
name|cursor2
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setCursor
argument_list|(
name|Qt
operator|::
name|IBeamCursor
argument_list|)
expr_stmt|;
name|item
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|20
argument_list|,
operator|-
literal|20
argument_list|,
literal|40
argument_list|,
literal|40
argument_list|)
argument_list|)
decl_stmt|;
name|item2
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|setCursor
argument_list|(
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|400
argument_list|,
literal|400
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|30
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|IBeamCursor
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|30
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|IBeamCursor
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
operator|-
literal|15
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
name|view
operator|.
name|setDragMode
argument_list|(
name|QGraphicsView
operator|::
name|ScrollHandDrag
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|30
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|OpenHandCursor
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|IBeamCursor
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
operator|-
literal|15
argument_list|,
operator|-
literal|15
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|OpenHandCursor
argument_list|)
expr_stmt|;
name|view
operator|.
name|setDragMode
argument_list|(
name|QGraphicsView
operator|::
name|NoDrag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|ArrowCursor
argument_list|)
expr_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|setCursor
argument_list|(
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setCursor
argument_list|(
name|Qt
operator|::
name|SizeAllCursor
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|30
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
operator|-
literal|15
argument_list|,
operator|-
literal|15
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|SizeAllCursor
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|IBeamCursor
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
operator|-
literal|15
argument_list|,
operator|-
literal|15
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|SizeAllCursor
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|IBeamCursor
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|30
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
name|view
operator|.
name|setDragMode
argument_list|(
name|QGraphicsView
operator|::
name|ScrollHandDrag
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|30
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|OpenHandCursor
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|IBeamCursor
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
operator|-
literal|15
argument_list|,
operator|-
literal|15
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|SizeAllCursor
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_function
DECL|function|transformationAnchor
name|void
name|tst_QGraphicsView
operator|::
name|transformationAnchor
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|,
literal|2000
argument_list|,
literal|2000
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
operator|++
name|i
control|)
block|{
name|view
operator|.
name|resize
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|0
condition|)
block|{
name|QCOMPARE
argument_list|(
name|view
operator|.
name|transformationAnchor
argument_list|()
argument_list|,
name|QGraphicsView
operator|::
name|AnchorViewCenter
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|view
operator|.
name|setTransformationAnchor
argument_list|(
name|QGraphicsView
operator|::
name|NoAnchor
argument_list|)
expr_stmt|;
block|}
name|view
operator|.
name|centerOn
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|setValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QPointF
name|center
init|=
name|view
operator|.
name|mapToScene
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
decl_stmt|;
name|view
operator|.
name|scale
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QPointF
name|newCenter
init|=
name|view
operator|.
name|mapToScene
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|i
operator|==
literal|0
condition|)
block|{
name|qreal
name|slack
init|=
literal|3
decl_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|newCenter
operator|.
name|x
argument_list|()
operator|-
name|center
operator|.
name|x
argument_list|()
argument_list|)
operator|<
name|slack
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|newCenter
operator|.
name|y
argument_list|()
operator|-
name|center
operator|.
name|y
argument_list|()
argument_list|)
operator|<
name|slack
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|qreal
name|slack
init|=
name|qreal
argument_list|(
literal|0.3
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|newCenter
operator|.
name|x
argument_list|()
operator|-
name|center
operator|.
name|x
argument_list|()
operator|/
literal|10
argument_list|)
operator|<
name|slack
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|newCenter
operator|.
name|y
argument_list|()
operator|-
name|center
operator|.
name|y
argument_list|()
operator|/
literal|10
argument_list|)
operator|<
name|slack
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function
DECL|function|resizeAnchor
name|void
name|tst_QGraphicsView
operator|::
name|resizeAnchor
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|,
literal|2000
argument_list|,
literal|2000
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
operator|++
name|i
control|)
block|{
name|view
operator|.
name|resize
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|0
condition|)
block|{
name|QCOMPARE
argument_list|(
name|view
operator|.
name|resizeAnchor
argument_list|()
argument_list|,
name|QGraphicsView
operator|::
name|NoAnchor
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|view
operator|.
name|setResizeAnchor
argument_list|(
name|QGraphicsView
operator|::
name|AnchorViewCenter
argument_list|)
expr_stmt|;
block|}
name|view
operator|.
name|centerOn
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QPointF
name|f
init|=
name|view
operator|.
name|mapToScene
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|QPointF
name|center
init|=
name|view
operator|.
name|mapToScene
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
for|for
control|(
name|int
name|size
init|=
literal|200
init|;
name|size
operator|<=
literal|400
condition|;
name|size
operator|+=
literal|25
control|)
block|{
name|view
operator|.
name|resize
argument_list|(
name|size
argument_list|,
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|0
condition|)
block|{
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|mapToScene
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|f
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|mapToScene
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
operator|!=
name|center
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|mapToScene
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
operator|!=
name|f
argument_list|)
expr_stmt|;
name|QPointF
name|newCenter
init|=
name|view
operator|.
name|mapToScene
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
decl_stmt|;
name|int
name|slack
init|=
literal|3
decl_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|newCenter
operator|.
name|x
argument_list|()
operator|-
name|center
operator|.
name|x
argument_list|()
argument_list|)
operator|<
name|slack
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|newCenter
operator|.
name|y
argument_list|()
operator|-
name|center
operator|.
name|y
argument_list|()
argument_list|)
operator|<
name|slack
argument_list|)
expr_stmt|;
block|}
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|}
block|}
block|}
end_function
begin_class
DECL|class|CustomView
class|class
name|CustomView
super|:
specifier|public
name|QGraphicsView
block|{
name|Q_OBJECT
public|public:
DECL|function|CustomView
name|CustomView
parameter_list|(
name|QGraphicsScene
modifier|*
name|s
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsView
argument_list|(
name|s
argument_list|)
block|{}
DECL|function|CustomView
name|CustomView
parameter_list|(
name|QGraphicsScene
modifier|*
name|s
parameter_list|,
name|QWidget
modifier|*
name|parent
parameter_list|)
member_init_list|:
name|QGraphicsView
argument_list|(
name|s
argument_list|,
name|parent
argument_list|)
block|{}
DECL|member|lastUpdateRegions
name|QList
argument_list|<
name|QRegion
argument_list|>
name|lastUpdateRegions
decl_stmt|;
DECL|member|painted
name|bool
name|painted
decl_stmt|;
protected|protected:
DECL|function|paintEvent
name|void
name|paintEvent
parameter_list|(
name|QPaintEvent
modifier|*
name|event
parameter_list|)
block|{
name|lastUpdateRegions
operator|<<
name|event
operator|->
name|region
argument_list|()
expr_stmt|;
name|painted
operator|=
literal|true
expr_stmt|;
name|QGraphicsView
operator|::
name|paintEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|viewportUpdateMode
name|void
name|tst_QGraphicsView
operator|::
name|viewportUpdateMode
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|scene
operator|.
name|setBackgroundBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|CustomView
name|view
decl_stmt|;
name|QDesktopWidget
name|desktop
decl_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
name|QSize
argument_list|(
literal|500
argument_list|,
literal|500
argument_list|)
operator|.
name|boundedTo
argument_list|(
name|desktop
operator|.
name|availableGeometry
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
comment|// 500 is too big for all common smartphones
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewportUpdateMode
argument_list|()
argument_list|,
name|QGraphicsView
operator|::
name|MinimalViewportUpdate
argument_list|)
expr_stmt|;
comment|// Show the view, and initialize our test.
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|view
operator|.
name|lastUpdateRegions
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|lastUpdateRegions
operator|.
name|clear
argument_list|()
expr_stmt|;
comment|// Issue two scene updates.
name|scene
operator|.
name|update
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|update
argument_list|(
name|QRectF
argument_list|(
literal|20
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
comment|// The view gets two updates for the update scene updates.
name|QTRY_VERIFY
argument_list|(
operator|!
name|view
operator|.
name|lastUpdateRegions
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|Q_OS_MAC
comment|//cocoa doesn't support drawing regions
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|last
argument_list|()
operator|.
name|rects
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|last
argument_list|()
operator|.
name|rects
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|size
argument_list|()
argument_list|,
name|QSize
argument_list|(
literal|14
argument_list|,
literal|14
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|last
argument_list|()
operator|.
name|rects
argument_list|()
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|.
name|size
argument_list|()
argument_list|,
name|QSize
argument_list|(
literal|14
argument_list|,
literal|14
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|// Set full update mode.
name|view
operator|.
name|setViewportUpdateMode
argument_list|(
name|QGraphicsView
operator|::
name|FullViewportUpdate
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewportUpdateMode
argument_list|()
argument_list|,
name|QGraphicsView
operator|::
name|FullViewportUpdate
argument_list|)
expr_stmt|;
name|view
operator|.
name|lastUpdateRegions
operator|.
name|clear
argument_list|()
expr_stmt|;
comment|// Issue two scene updates.
name|scene
operator|.
name|update
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|update
argument_list|(
name|QRectF
argument_list|(
literal|20
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// The view gets one full viewport update for the update scene updates.
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|last
argument_list|()
operator|.
name|rects
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|last
argument_list|()
operator|.
name|rects
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|size
argument_list|()
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|lastUpdateRegions
operator|.
name|clear
argument_list|()
expr_stmt|;
comment|// Set smart update mode
name|view
operator|.
name|setViewportUpdateMode
argument_list|(
name|QGraphicsView
operator|::
name|SmartViewportUpdate
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewportUpdateMode
argument_list|()
argument_list|,
name|QGraphicsView
operator|::
name|SmartViewportUpdate
argument_list|)
expr_stmt|;
comment|// Issue 100 mini-updates
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
operator|++
name|i
control|)
block|{
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
literal|10
condition|;
operator|++
name|j
control|)
block|{
name|scene
operator|.
name|update
argument_list|(
name|QRectF
argument_list|(
name|i
operator|*
literal|3
argument_list|,
name|j
operator|*
literal|3
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// The view gets one bounding rect update.
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|last
argument_list|()
operator|.
name|rects
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|last
argument_list|()
operator|.
name|rects
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|size
argument_list|()
argument_list|,
name|QSize
argument_list|(
literal|32
argument_list|,
literal|32
argument_list|)
argument_list|)
expr_stmt|;
comment|// Set no update mode
name|view
operator|.
name|setViewportUpdateMode
argument_list|(
name|QGraphicsView
operator|::
name|NoViewportUpdate
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewportUpdateMode
argument_list|()
argument_list|,
name|QGraphicsView
operator|::
name|NoViewportUpdate
argument_list|)
expr_stmt|;
comment|// Issue two scene updates.
name|view
operator|.
name|lastUpdateRegions
operator|.
name|clear
argument_list|()
expr_stmt|;
name|TestItem
name|item
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|item
argument_list|)
expr_stmt|;
name|item
operator|.
name|moveBy
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|scene
operator|.
name|update
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|update
argument_list|(
name|QRectF
argument_list|(
literal|20
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// The view should not get any painting calls from the scene updates
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|viewportUpdateMode2
name|void
name|tst_QGraphicsView
operator|::
name|viewportUpdateMode2
parameter_list|()
block|{
name|QWidget
name|toplevel
decl_stmt|;
comment|// Create a view with viewport rect equal to QRect(0, 0, 200, 200).
name|QGraphicsScene
name|dummyScene
decl_stmt|;
name|CustomView
name|view
argument_list|(
literal|0
argument_list|,
operator|&
name|toplevel
argument_list|)
decl_stmt|;
name|view
operator|.
name|painted
operator|=
literal|false
expr_stmt|;
name|view
operator|.
name|setViewportUpdateMode
argument_list|(
name|QGraphicsView
operator|::
name|BoundingRectViewportUpdate
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|dummyScene
argument_list|)
expr_stmt|;
name|view
operator|.
name|ensurePolished
argument_list|()
expr_stmt|;
comment|// make sure we get the right content margins
name|int
name|left
decl_stmt|,
name|top
decl_stmt|,
name|right
decl_stmt|,
name|bottom
decl_stmt|;
name|view
operator|.
name|getContentsMargins
argument_list|(
operator|&
name|left
argument_list|,
operator|&
name|top
argument_list|,
operator|&
name|right
argument_list|,
operator|&
name|bottom
argument_list|)
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|200
operator|+
name|left
operator|+
name|right
argument_list|,
literal|200
operator|+
name|top
operator|+
name|bottom
argument_list|)
expr_stmt|;
name|toplevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|toplevel
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|toplevel
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|painted
argument_list|)
expr_stmt|;
specifier|const
name|QRect
name|viewportRect
init|=
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|viewportRect
argument_list|,
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
name|QT_BUILD_INTERNAL
name|QGraphicsViewPrivate
modifier|*
name|viewPrivate
init|=
cast|static_cast
argument_list|<
name|QGraphicsViewPrivate
operator|*
argument_list|>
argument_list|(
name|qt_widget_private
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
decl_stmt|;
name|QRect
name|boundingRect
decl_stmt|;
specifier|const
name|QRect
name|rect1
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|viewPrivate
operator|->
name|updateRect
argument_list|(
name|rect1
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|viewPrivate
operator|->
name|fullUpdatePending
argument_list|)
expr_stmt|;
name|boundingRect
operator||=
name|rect1
expr_stmt|;
name|QCOMPARE
argument_list|(
name|viewPrivate
operator|->
name|dirtyBoundingRect
argument_list|,
name|boundingRect
argument_list|)
expr_stmt|;
specifier|const
name|QRect
name|rect2
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|viewPrivate
operator|->
name|updateRect
argument_list|(
name|rect2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|viewPrivate
operator|->
name|fullUpdatePending
argument_list|)
expr_stmt|;
name|boundingRect
operator||=
name|rect2
expr_stmt|;
name|QCOMPARE
argument_list|(
name|viewPrivate
operator|->
name|dirtyBoundingRect
argument_list|,
name|boundingRect
argument_list|)
expr_stmt|;
specifier|const
name|QRect
name|rect3
argument_list|(
literal|190
argument_list|,
literal|190
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|viewPrivate
operator|->
name|updateRect
argument_list|(
name|rect3
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|viewPrivate
operator|->
name|fullUpdatePending
argument_list|)
expr_stmt|;
name|boundingRect
operator||=
name|rect3
expr_stmt|;
name|QCOMPARE
argument_list|(
name|viewPrivate
operator|->
name|dirtyBoundingRect
argument_list|,
name|boundingRect
argument_list|)
expr_stmt|;
name|view
operator|.
name|lastUpdateRegions
operator|.
name|clear
argument_list|()
expr_stmt|;
name|viewPrivate
operator|->
name|processPendingUpdates
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Note that we adjust by 2 for antialiasing.
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QRegion
argument_list|(
name|boundingRect
operator|.
name|adjusted
argument_list|(
operator|-
literal|2
argument_list|,
operator|-
literal|2
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
operator|&
name|viewportRect
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function
begin_ifndef
ifndef|#
directive|ifndef
name|QT_NO_DRAGANDDROP
end_ifndef
begin_function
DECL|function|acceptDrops
name|void
name|tst_QGraphicsView
operator|::
name|acceptDrops
parameter_list|()
block|{
name|QGraphicsView
name|view
decl_stmt|;
comment|// Excepted default behavior.
name|QVERIFY
argument_list|(
name|view
operator|.
name|acceptDrops
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|acceptDrops
argument_list|()
argument_list|)
expr_stmt|;
comment|// Excepted behavior with no drops.
name|view
operator|.
name|setAcceptDrops
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|acceptDrops
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|acceptDrops
argument_list|()
argument_list|)
expr_stmt|;
comment|// Setting a widget with drops on a QGraphicsView without drops.
name|QWidget
modifier|*
name|widget
init|=
operator|new
name|QWidget
decl_stmt|;
name|widget
operator|->
name|setAcceptDrops
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setViewport
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|acceptDrops
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|acceptDrops
argument_list|()
argument_list|)
expr_stmt|;
comment|// Switching the view to accept drops.
name|view
operator|.
name|setAcceptDrops
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|acceptDrops
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|acceptDrops
argument_list|()
argument_list|)
expr_stmt|;
comment|// Setting a widget with no drops on a QGraphicsView with drops.
name|widget
operator|=
operator|new
name|QWidget
expr_stmt|;
name|widget
operator|->
name|setAcceptDrops
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|view
operator|.
name|setViewport
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|acceptDrops
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|acceptDrops
argument_list|()
argument_list|)
expr_stmt|;
comment|// Switching the view to not accept drops.
name|view
operator|.
name|setAcceptDrops
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|acceptDrops
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_function
DECL|function|optimizationFlags
name|void
name|tst_QGraphicsView
operator|::
name|optimizationFlags
parameter_list|()
block|{
name|QGraphicsView
name|view
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|optimizationFlags
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setOptimizationFlag
argument_list|(
name|QGraphicsView
operator|::
name|DontClipPainter
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|optimizationFlags
argument_list|()
operator|&
name|QGraphicsView
operator|::
name|DontClipPainter
argument_list|)
expr_stmt|;
name|view
operator|.
name|setOptimizationFlag
argument_list|(
name|QGraphicsView
operator|::
name|DontClipPainter
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|optimizationFlags
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setOptimizationFlag
argument_list|(
name|QGraphicsView
operator|::
name|DontSavePainterState
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|optimizationFlags
argument_list|()
operator|&
name|QGraphicsView
operator|::
name|DontSavePainterState
argument_list|)
expr_stmt|;
name|view
operator|.
name|setOptimizationFlag
argument_list|(
name|QGraphicsView
operator|::
name|DontSavePainterState
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|optimizationFlags
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setOptimizationFlag
argument_list|(
name|QGraphicsView
operator|::
name|DontAdjustForAntialiasing
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|optimizationFlags
argument_list|()
operator|&
name|QGraphicsView
operator|::
name|DontAdjustForAntialiasing
argument_list|)
expr_stmt|;
name|view
operator|.
name|setOptimizationFlag
argument_list|(
name|QGraphicsView
operator|::
name|DontAdjustForAntialiasing
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|optimizationFlags
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setOptimizationFlags
argument_list|(
name|QGraphicsView
operator|::
name|DontAdjustForAntialiasing
operator||
name|QGraphicsView
operator|::
name|DontClipPainter
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|optimizationFlags
argument_list|()
argument_list|,
name|QGraphicsView
operator|::
name|OptimizationFlags
argument_list|(
name|QGraphicsView
operator|::
name|DontAdjustForAntialiasing
operator||
name|QGraphicsView
operator|::
name|DontClipPainter
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|MessUpPainterItem
class|class
name|MessUpPainterItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|MessUpPainterItem
name|MessUpPainterItem
parameter_list|(
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|)
member_init_list|,
name|dirtyPainter
argument_list|(
literal|false
argument_list|)
block|{ }
DECL|member|dirtyPainter
name|bool
name|dirtyPainter
decl_stmt|;
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
name|dirtyPainter
operator|=
operator|(
name|painter
operator|->
name|pen
argument_list|()
operator|.
name|width
argument_list|()
operator|!=
literal|0
operator|)
expr_stmt|;
name|painter
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|1.0
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_class
DECL|class|MyGraphicsView
class|class
name|MyGraphicsView
super|:
specifier|public
name|QGraphicsView
block|{
public|public:
DECL|function|MyGraphicsView
name|MyGraphicsView
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|)
member_init_list|:
name|QGraphicsView
argument_list|(
name|scene
argument_list|)
block|{ }
DECL|function|drawBackground
name|void
name|drawBackground
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|)
block|{
name|painter
operator|->
name|setCompositionMode
argument_list|(
name|QPainter
operator|::
name|CompositionMode_Source
argument_list|)
expr_stmt|;
name|painter
operator|->
name|drawRect
argument_list|(
name|rect
argument_list|)
expr_stmt|;
block|}
DECL|function|drawItems
name|void
name|drawItems
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
name|int
name|numItems
parameter_list|,
name|QGraphicsItem
modifier|*
name|items
index|[]
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
name|options
index|[]
parameter_list|)
block|{
if|if
condition|(
operator|!
operator|(
name|optimizationFlags
argument_list|()
operator|&
name|QGraphicsView
operator|::
name|DontSavePainterState
operator|)
condition|)
name|QCOMPARE
argument_list|(
name|painter
operator|->
name|compositionMode
argument_list|()
argument_list|,
name|QPainter
operator|::
name|CompositionMode_SourceOver
argument_list|)
expr_stmt|;
else|else
name|QCOMPARE
argument_list|(
name|painter
operator|->
name|compositionMode
argument_list|()
argument_list|,
name|QPainter
operator|::
name|CompositionMode_Source
argument_list|)
expr_stmt|;
name|QGraphicsView
operator|::
name|drawItems
argument_list|(
name|painter
argument_list|,
name|numItems
argument_list|,
name|items
argument_list|,
name|options
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|optimizationFlags_dontSavePainterState
name|void
name|tst_QGraphicsView
operator|::
name|optimizationFlags_dontSavePainterState
parameter_list|()
block|{
name|MessUpPainterItem
modifier|*
name|parent
init|=
operator|new
name|MessUpPainterItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|MessUpPainterItem
modifier|*
name|child
init|=
operator|new
name|MessUpPainterItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|repaint
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|dirtyPainter
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|dirtyPainter
argument_list|)
expr_stmt|;
name|view
operator|.
name|setOptimizationFlags
argument_list|(
name|QGraphicsView
operator|::
name|DontSavePainterState
argument_list|)
expr_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|repaint
argument_list|()
expr_stmt|;
ifdef|#
directive|ifdef
name|Q_OS_MAC
comment|// Repaint on Mac OS X actually does require spinning the event loop.
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|dirtyPainter
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|dirtyPainter
argument_list|)
expr_stmt|;
name|MyGraphicsView
name|painter
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|painter
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|painter
argument_list|)
argument_list|)
expr_stmt|;
name|MyGraphicsView
name|painter2
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|painter2
operator|.
name|setOptimizationFlag
argument_list|(
name|QGraphicsView
operator|::
name|DontSavePainterState
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|painter2
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|painter2
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|optimizationFlags_dontSavePainterState2_data
name|void
name|tst_QGraphicsView
operator|::
name|optimizationFlags_dontSavePainterState2_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"savePainter"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"indirectPainting"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"With painter state protection, without indirect painting"
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Without painter state protection, without indirect painting"
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"With painter state protectionm, with indirect painting"
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Without painter state protection, with indirect painting"
argument_list|)
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_function
DECL|function|optimizationFlags_dontSavePainterState2
name|void
name|tst_QGraphicsView
operator|::
name|optimizationFlags_dontSavePainterState2
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|savePainter
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|indirectPainting
argument_list|)
expr_stmt|;
class|class
name|MyScene
super|:
specifier|public
name|QGraphicsScene
block|{
public|public:
name|void
name|drawBackground
parameter_list|(
name|QPainter
modifier|*
name|p
parameter_list|,
specifier|const
name|QRectF
modifier|&
parameter_list|)
block|{
name|transformInDrawBackground
operator|=
name|p
operator|->
name|worldTransform
argument_list|()
expr_stmt|;
name|opacityInDrawBackground
operator|=
name|p
operator|->
name|opacity
argument_list|()
expr_stmt|;
block|}
name|void
name|drawForeground
parameter_list|(
name|QPainter
modifier|*
name|p
parameter_list|,
specifier|const
name|QRectF
modifier|&
parameter_list|)
block|{
name|transformInDrawForeground
operator|=
name|p
operator|->
name|worldTransform
argument_list|()
expr_stmt|;
name|opacityInDrawForeground
operator|=
name|p
operator|->
name|opacity
argument_list|()
expr_stmt|;
block|}
name|QTransform
name|transformInDrawBackground
decl_stmt|;
name|QTransform
name|transformInDrawForeground
decl_stmt|;
name|qreal
name|opacityInDrawBackground
decl_stmt|;
name|qreal
name|opacityInDrawForeground
decl_stmt|;
block|}
class|;
name|MyScene
name|scene
decl_stmt|;
comment|// Add transformed dummy items to make sure the painter's worldTransform() is changed in drawItems.
name|QGraphicsRectItem
modifier|*
name|rectA
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rectB
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|rectA
operator|->
name|setTransform
argument_list|(
name|QTransform
operator|::
name|fromScale
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|rectA
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|rectB
operator|->
name|setTransform
argument_list|(
name|QTransform
operator|::
name|fromTranslate
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|rectB
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|scene
operator|.
name|items
argument_list|()
control|)
name|item
operator|->
name|setOpacity
argument_list|(
literal|0.6
argument_list|)
expr_stmt|;
name|CustomView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|savePainter
condition|)
name|view
operator|.
name|setOptimizationFlag
argument_list|(
name|QGraphicsView
operator|::
name|DontSavePainterState
argument_list|)
expr_stmt|;
name|view
operator|.
name|setOptimizationFlag
argument_list|(
name|QGraphicsView
operator|::
name|IndirectPainting
argument_list|,
name|indirectPainting
argument_list|)
expr_stmt|;
name|view
operator|.
name|rotate
argument_list|(
literal|45
argument_list|)
expr_stmt|;
name|view
operator|.
name|scale
argument_list|(
literal|1.5
argument_list|,
literal|1.5
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
comment|// Make sure the view is repainted; otherwise the tests below will fail.
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|repaint
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|painted
argument_list|)
expr_stmt|;
comment|// Make sure the painter's world transform is preserved after drawItems.
name|QTransform
name|expectedTransform
init|=
name|view
operator|.
name|viewportTransform
argument_list|()
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|expectedTransform
operator|.
name|isIdentity
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|transformInDrawForeground
argument_list|,
name|expectedTransform
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|transformInDrawBackground
argument_list|,
name|expectedTransform
argument_list|)
expr_stmt|;
name|qreal
name|expectedOpacity
init|=
literal|1.0
decl_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|opacityInDrawBackground
argument_list|,
name|expectedOpacity
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|opacityInDrawForeground
argument_list|,
name|expectedOpacity
argument_list|)
expr_stmt|;
comment|// Trigger more painting, this time from QGraphicsScene::render.
name|QImage
name|image
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
operator|.
name|size
argument_list|()
operator|.
name|toSize
argument_list|()
argument_list|,
name|QImage
operator|::
name|Format_RGB32
argument_list|)
decl_stmt|;
name|QPainter
name|painter
argument_list|(
operator|&
name|image
argument_list|)
decl_stmt|;
name|scene
operator|.
name|render
argument_list|(
operator|&
name|painter
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
name|expectedTransform
operator|=
name|QTransform
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|transformInDrawForeground
argument_list|,
name|expectedTransform
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|transformInDrawBackground
argument_list|,
name|expectedTransform
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|opacityInDrawBackground
argument_list|,
name|expectedOpacity
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|opacityInDrawForeground
argument_list|,
name|expectedOpacity
argument_list|)
expr_stmt|;
comment|// Trigger more painting with another opacity on the painter.
name|painter
operator|.
name|begin
argument_list|(
operator|&
name|image
argument_list|)
expr_stmt|;
name|painter
operator|.
name|setOpacity
argument_list|(
literal|0.4
argument_list|)
expr_stmt|;
name|expectedOpacity
operator|=
literal|0.4
expr_stmt|;
name|scene
operator|.
name|render
argument_list|(
operator|&
name|painter
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|transformInDrawForeground
argument_list|,
name|expectedTransform
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|transformInDrawBackground
argument_list|,
name|expectedTransform
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|opacityInDrawBackground
argument_list|,
name|expectedOpacity
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|opacityInDrawForeground
argument_list|,
name|expectedOpacity
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|LodItem
class|class
name|LodItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|LodItem
name|LodItem
parameter_list|(
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|)
member_init_list|,
name|lastLod
argument_list|(
operator|-
literal|42
argument_list|)
block|{ }
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
name|viewport
parameter_list|)
block|{
name|lastLod
operator|=
name|option
operator|->
name|levelOfDetailFromTransform
argument_list|(
name|painter
operator|->
name|worldTransform
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|viewport
argument_list|)
expr_stmt|;
block|}
DECL|member|lastLod
name|qreal
name|lastLod
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|levelOfDetail_data
name|void
name|tst_QGraphicsView
operator|::
name|levelOfDetail_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QTransform
argument_list|>
argument_list|(
literal|"transform"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"lod"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"1:4, 1:4"
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|scale
argument_list|(
literal|0.25
argument_list|,
literal|0.25
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.25
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"1:2, 1:4"
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|scale
argument_list|(
literal|0.5
argument_list|,
literal|0.25
argument_list|)
operator|<<
name|qreal
argument_list|(
operator|::
name|sqrt
argument_list|(
literal|0.125
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"4:1, 1:2"
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|scale
argument_list|(
literal|0.25
argument_list|,
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
operator|::
name|sqrt
argument_list|(
literal|0.125
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"1:2, 1:2"
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|scale
argument_list|(
literal|0.5
argument_list|,
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"1:1, 1:2"
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|scale
argument_list|(
literal|1
argument_list|,
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
operator|::
name|sqrt
argument_list|(
literal|0.5
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2:1, 1:1"
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|scale
argument_list|(
literal|0.5
argument_list|,
literal|1
argument_list|)
operator|<<
name|qreal
argument_list|(
operator|::
name|sqrt
argument_list|(
literal|0.5
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"1:1, 1:1"
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|scale
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2:1, 1:1"
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|scale
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|)
operator|<<
name|qreal
argument_list|(
operator|::
name|sqrt
argument_list|(
literal|2.0
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"1:1, 2:1"
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|scale
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|)
operator|<<
name|qreal
argument_list|(
operator|::
name|sqrt
argument_list|(
literal|2.0
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2:1, 2:1"
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|scale
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|2.0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2:1, 4:1"
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|scale
argument_list|(
literal|2
argument_list|,
literal|4
argument_list|)
operator|<<
name|qreal
argument_list|(
operator|::
name|sqrt
argument_list|(
literal|8.0
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"4:1, 2:1"
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|scale
argument_list|(
literal|4
argument_list|,
literal|2
argument_list|)
operator|<<
name|qreal
argument_list|(
operator|::
name|sqrt
argument_list|(
literal|8.0
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"4:1, 4:1"
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|scale
argument_list|(
literal|4
argument_list|,
literal|4
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|4.0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|levelOfDetail
name|void
name|tst_QGraphicsView
operator|::
name|levelOfDetail
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QTransform
argument_list|,
name|transform
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|lod
argument_list|)
expr_stmt|;
name|LodItem
modifier|*
name|item
init|=
operator|new
name|LodItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item
operator|->
name|lastLod
argument_list|,
name|qreal
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setTransform
argument_list|(
name|transform
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item
operator|->
name|lastLod
argument_list|,
name|lod
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// Moved to tst_qgraphicsview_2.cpp
end_comment
begin_function_decl
specifier|extern
name|void
name|_scrollBarRanges_data
parameter_list|()
function_decl|;
end_function_decl
begin_function
DECL|function|scrollBarRanges_data
name|void
name|tst_QGraphicsView
operator|::
name|scrollBarRanges_data
parameter_list|()
block|{
name|_scrollBarRanges_data
argument_list|()
expr_stmt|;
block|}
end_function
begin_comment
comment|// Simulates motif scrollbar for range tests
end_comment
begin_class
DECL|class|FauxMotifStyle
class|class
name|FauxMotifStyle
super|:
specifier|public
name|QCommonStyle
block|{
public|public:
DECL|function|styleHint
name|int
name|styleHint
parameter_list|(
name|StyleHint
name|hint
parameter_list|,
specifier|const
name|QStyleOption
modifier|*
name|option
parameter_list|,
specifier|const
name|QWidget
modifier|*
name|widget
parameter_list|,
name|QStyleHintReturn
modifier|*
name|returnData
parameter_list|)
specifier|const
block|{
if|if
condition|(
name|hint
operator|==
name|QStyle
operator|::
name|SH_ScrollView_FrameOnlyAroundContents
condition|)
return|return
literal|true
return|;
return|return
name|QCommonStyle
operator|::
name|styleHint
argument_list|(
name|hint
argument_list|,
name|option
argument_list|,
name|widget
argument_list|,
name|returnData
argument_list|)
return|;
block|}
DECL|function|pixelMetric
name|int
name|pixelMetric
parameter_list|(
name|PixelMetric
name|m
parameter_list|,
specifier|const
name|QStyleOption
modifier|*
name|opt
parameter_list|,
specifier|const
name|QWidget
modifier|*
name|widget
parameter_list|)
specifier|const
block|{
if|if
condition|(
name|m
operator|==
name|QStyle
operator|::
name|PM_ScrollView_ScrollBarSpacing
condition|)
return|return
literal|4
return|;
return|return
name|QCommonStyle
operator|::
name|pixelMetric
argument_list|(
name|m
argument_list|,
name|opt
argument_list|,
name|widget
argument_list|)
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|scrollBarRanges
name|void
name|tst_QGraphicsView
operator|::
name|scrollBarRanges
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QSize
argument_list|,
name|viewportSize
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QRectF
argument_list|,
name|sceneRect
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QTransform
argument_list|,
name|transform
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|Qt
operator|::
name|ScrollBarPolicy
argument_list|,
name|hbarpolicy
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|Qt
operator|::
name|ScrollBarPolicy
argument_list|,
name|vbarpolicy
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|hmin
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|hmax
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|vmin
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|vmax
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|useMotif
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|useStyledPanel
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
argument_list|(
name|sceneRect
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|sceneRect
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|QColor
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setRenderHint
argument_list|(
name|QPainter
operator|::
name|Antialiasing
argument_list|)
expr_stmt|;
name|view
operator|.
name|setTransform
argument_list|(
name|transform
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFrameStyle
argument_list|(
name|useStyledPanel
condition|?
name|QFrame
operator|::
name|StyledPanel
else|:
name|QFrame
operator|::
name|NoFrame
argument_list|)
expr_stmt|;
if|if
condition|(
name|useMotif
condition|)
block|{
if|#
directive|if
operator|!
name|defined
argument_list|(
name|QT_NO_STYLE_WINDOWS
argument_list|)
name|view
operator|.
name|setStyle
argument_list|(
operator|new
name|FauxMotifStyle
argument_list|)
expr_stmt|;
else|#
directive|else
name|QSKIP
argument_list|(
literal|"No Windows style compiled."
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
else|else
block|{
if|#
directive|if
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
name|view
operator|.
name|setStyle
argument_list|(
operator|new
name|QWindowsStyle
argument_list|)
expr_stmt|;
elif|#
directive|elif
operator|!
name|defined
argument_list|(
name|QT_NO_STYLE_PLASTIQUE
argument_list|)
name|view
operator|.
name|setStyle
argument_list|(
operator|new
name|QPlastiqueStyle
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
name|view
operator|.
name|setStyleSheet
argument_list|(
literal|" "
argument_list|)
expr_stmt|;
comment|// enables style propagation ;-)
name|int
name|adjust
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|useStyledPanel
condition|)
name|adjust
operator|=
name|view
operator|.
name|style
argument_list|()
operator|->
name|pixelMetric
argument_list|(
name|QStyle
operator|::
name|PM_DefaultFrameWidth
argument_list|)
operator|*
literal|2
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
name|viewportSize
operator|+
name|QSize
argument_list|(
name|adjust
argument_list|,
name|adjust
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setHorizontalScrollBarPolicy
argument_list|(
name|hbarpolicy
argument_list|)
expr_stmt|;
name|view
operator|.
name|setVerticalScrollBarPolicy
argument_list|(
name|vbarpolicy
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|minimum
argument_list|()
argument_list|,
name|hmin
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|minimum
argument_list|()
argument_list|,
name|vmin
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|maximum
argument_list|()
argument_list|,
name|hmax
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|maximum
argument_list|()
argument_list|,
name|vmax
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|TestView
class|class
name|TestView
super|:
specifier|public
name|QGraphicsView
block|{
public|public:
DECL|function|TestView
name|TestView
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|)
member_init_list|:
name|QGraphicsView
argument_list|(
name|scene
argument_list|)
member_init_list|,
name|accepted
argument_list|(
literal|false
argument_list|)
block|{ }
DECL|member|accepted
name|bool
name|accepted
decl_stmt|;
protected|protected:
DECL|function|mousePressEvent
name|void
name|mousePressEvent
parameter_list|(
name|QMouseEvent
modifier|*
name|event
parameter_list|)
block|{
name|QGraphicsView
operator|::
name|mousePressEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
name|accepted
operator|=
name|event
operator|->
name|isAccepted
argument_list|()
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|acceptMousePressEvent
name|void
name|tst_QGraphicsView
operator|::
name|acceptMousePressEvent
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|TestView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseButtonPress
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|event
operator|.
name|setAccepted
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|accepted
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|2000
argument_list|,
literal|2000
argument_list|)
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// ensure scene rect is updated
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|accepted
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|replayMouseMove
name|void
name|tst_QGraphicsView
operator|::
name|replayMouseMove
parameter_list|()
block|{
comment|// An empty scene in a view. The view will send the events to the scene in
comment|// any case. Note that the view doesn't have to be shown - the mouse event
comment|// sending functions below send the events directly to the viewport.
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|EventSpy
name|sceneSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|EventSpy
name|viewSpy
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|QEvent
operator|::
name|MouseMove
argument_list|)
decl_stmt|;
name|sendMousePress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
comment|// One mouse event should be translated into one scene event.
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
operator|++
name|i
control|)
block|{
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|MouseButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|viewSpy
operator|.
name|count
argument_list|()
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneSpy
operator|.
name|count
argument_list|()
argument_list|,
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
comment|// When the view is transformed, the view should get no more events.  But
comment|// the scene should get replays.
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
operator|++
name|i
control|)
block|{
name|view
operator|.
name|rotate
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|viewSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|3
operator|+
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
comment|// When the view is scrolled, the view should get no more events.  But the
comment|// scene should get replays.
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
operator|++
name|i
control|)
block|{
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|setValue
argument_list|(
operator|(
name|i
operator|+
literal|1
operator|)
operator|*
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|viewSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|6
operator|+
name|i
operator|+
literal|1
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|itemsUnderMouse
name|void
name|tst_QGraphicsView
operator|::
name|itemsUnderMouse
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsProxyWidget
name|w
decl_stmt|;
name|w
operator|.
name|setWidget
argument_list|(
operator|new
name|QPushButton
argument_list|(
literal|"W"
argument_list|)
argument_list|)
expr_stmt|;
name|w
operator|.
name|resize
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|QGraphicsProxyWidget
name|w2
argument_list|(
operator|&
name|w
argument_list|)
decl_stmt|;
name|w2
operator|.
name|setWidget
argument_list|(
operator|new
name|QPushButton
argument_list|(
literal|"W2"
argument_list|)
argument_list|)
expr_stmt|;
name|w2
operator|.
name|resize
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|QGraphicsProxyWidget
name|w3
argument_list|(
operator|&
name|w2
argument_list|)
decl_stmt|;
name|w3
operator|.
name|setWidget
argument_list|(
operator|new
name|QPushButton
argument_list|(
literal|"W3"
argument_list|)
argument_list|)
expr_stmt|;
name|w3
operator|.
name|resize
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|w
operator|.
name|setZValue
argument_list|(
literal|150
argument_list|)
expr_stmt|;
name|w2
operator|.
name|setZValue
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|w3
operator|.
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|w
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|items
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|w3
operator|.
name|boundingRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
operator|&
name|w3
argument_list|)
argument_list|)
expr_stmt|;
name|w2
operator|.
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIgnoresTransformations
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|items
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|w3
operator|.
name|boundingRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
operator|&
name|w3
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|QGraphicsTextItem_task172231
class|class
name|QGraphicsTextItem_task172231
super|:
specifier|public
name|QGraphicsTextItem
block|{
public|public:
DECL|function|QGraphicsTextItem_task172231
name|QGraphicsTextItem_task172231
parameter_list|(
specifier|const
name|QString
modifier|&
name|text
parameter_list|,
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsTextItem
argument_list|(
name|text
argument_list|,
name|parent
argument_list|)
block|{}
DECL|member|exposedRect
name|QRectF
name|exposedRect
decl_stmt|;
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
name|widget
parameter_list|)
block|{
name|exposedRect
operator|=
name|option
operator|->
name|exposedRect
expr_stmt|;
name|QGraphicsTextItem
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|widget
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|task172231_untransformableItems
name|void
name|tst_QGraphicsView
operator|::
name|task172231_untransformableItems
parameter_list|()
block|{
comment|// check fix in QGraphicsView::paintEvent()
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsTextItem_task172231
modifier|*
name|text
init|=
operator|new
name|QGraphicsTextItem_task172231
argument_list|(
literal|"abcdefghijklmnopqrstuvwxyz"
argument_list|)
decl_stmt|;
name|text
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIgnoresTransformations
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|text
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|scale
argument_list|(
literal|2
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QRectF
name|origExposedRect
init|=
name|text
operator|->
name|exposedRect
decl_stmt|;
name|view
operator|.
name|resize
argument_list|(
name|int
argument_list|(
literal|0.75
operator|*
name|view
operator|.
name|width
argument_list|()
argument_list|)
argument_list|,
name|view
operator|.
name|height
argument_list|()
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|->
name|exposedRect
argument_list|,
name|origExposedRect
argument_list|)
expr_stmt|;
comment|// notice that the fix also goes into QGraphicsView::render()
comment|// and QGraphicsScene::render(), but in duplicated code that
comment|// is pending a refactoring, so for now we omit autotesting
comment|// these functions separately
block|}
end_function
begin_class
DECL|class|MousePressReleaseScene
class|class
name|MousePressReleaseScene
super|:
specifier|public
name|QGraphicsScene
block|{
public|public:
DECL|function|MousePressReleaseScene
name|MousePressReleaseScene
parameter_list|()
member_init_list|:
name|presses
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|releases
argument_list|(
literal|0
argument_list|)
block|{ }
DECL|member|presses
name|int
name|presses
decl_stmt|;
DECL|member|releases
name|int
name|releases
decl_stmt|;
protected|protected:
DECL|function|mousePressEvent
name|void
name|mousePressEvent
parameter_list|(
name|QGraphicsSceneMouseEvent
modifier|*
name|event
parameter_list|)
block|{
operator|++
name|presses
expr_stmt|;
name|QGraphicsScene
operator|::
name|mousePressEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
block|}
DECL|function|mouseReleaseEvent
name|void
name|mouseReleaseEvent
parameter_list|(
name|QGraphicsSceneMouseEvent
modifier|*
name|event
parameter_list|)
block|{
operator|++
name|releases
expr_stmt|;
name|QGraphicsScene
operator|::
name|mouseReleaseEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|task180429_mouseReleaseDragMode
name|void
name|tst_QGraphicsView
operator|::
name|task180429_mouseReleaseDragMode
parameter_list|()
block|{
name|MousePressReleaseScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|sendMousePress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|presses
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|releases
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sendMouseRelease
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|presses
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|releases
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|view
operator|.
name|setDragMode
argument_list|(
name|QGraphicsView
operator|::
name|RubberBandDrag
argument_list|)
expr_stmt|;
name|sendMousePress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|presses
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|releases
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sendMouseRelease
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|presses
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|releases
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task187791_setSceneCausesUpdate
name|void
name|tst_QGraphicsView
operator|::
name|task187791_setSceneCausesUpdate
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowShown
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|EventSpy
name|updateSpy
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|QEvent
operator|::
name|Paint
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|updateSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|updateSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|updateSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|MouseMoveCounter
class|class
name|MouseMoveCounter
super|:
specifier|public
name|QGraphicsView
block|{
public|public:
DECL|function|MouseMoveCounter
name|MouseMoveCounter
parameter_list|()
member_init_list|:
name|mouseMoves
argument_list|(
literal|0
argument_list|)
block|{ }
DECL|member|mouseMoves
name|int
name|mouseMoves
decl_stmt|;
protected|protected:
DECL|function|mouseMoveEvent
name|void
name|mouseMoveEvent
parameter_list|(
name|QMouseEvent
modifier|*
name|event
parameter_list|)
block|{
operator|++
name|mouseMoves
expr_stmt|;
name|QGraphicsView
operator|::
name|mouseMoveEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|scene
argument_list|()
operator|->
name|items
argument_list|()
control|)
block|{
name|scene
argument_list|()
operator|->
name|removeItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
operator|delete
name|item
expr_stmt|;
block|}
name|scene
argument_list|()
operator|->
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|scene
argument_list|()
operator|->
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|task186827_deleteReplayedItem
name|void
name|tst_QGraphicsView
operator|::
name|task186827_deleteReplayedItem
parameter_list|()
block|{
comment|// make sure the mouse is not over the window, causing spontaneous mouse moves
name|QCursor
operator|::
name|setPos
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|MouseMoveCounter
name|view
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|setMouseTracking
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mouseMoves
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|{
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|,
name|Qt
operator|::
name|NoButton
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mouseMoves
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|mouseMoves
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
block|{
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|,
name|Qt
operator|::
name|NoButton
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|view
operator|.
name|mouseMoves
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|15
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task207546_focusCrash
name|void
name|tst_QGraphicsView
operator|::
name|task207546_focusCrash
parameter_list|()
block|{
class|class
name|_Widget
super|:
specifier|public
name|QWidget
block|{
public|public:
name|bool
name|focusNextPrevChild
parameter_list|(
name|bool
name|next
parameter_list|)
block|{
return|return
name|QWidget
operator|::
name|focusNextPrevChild
argument_list|(
name|next
argument_list|)
return|;
block|}
block|}
name|widget
class|;
name|widget
operator|.
name|setLayout
argument_list|(
operator|new
name|QVBoxLayout
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsView
modifier|*
name|gr1
init|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|widget
argument_list|)
decl_stmt|;
name|QGraphicsView
modifier|*
name|gr2
init|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|widget
argument_list|)
decl_stmt|;
name|widget
operator|.
name|layout
argument_list|()
operator|->
name|addWidget
argument_list|(
name|gr1
argument_list|)
expr_stmt|;
name|widget
operator|.
name|layout
argument_list|()
operator|->
name|addWidget
argument_list|(
name|gr2
argument_list|)
expr_stmt|;
name|widget
operator|.
name|show
argument_list|()
expr_stmt|;
name|widget
operator|.
name|activateWindow
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|widget
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
operator|&
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|widget
operator|.
name|focusNextPrevChild
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
name|gr2
argument_list|)
argument_list|,
name|widget
operator|.
name|focusWidget
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task210599_unsetDragWhileDragging
name|void
name|tst_QGraphicsView
operator|::
name|task210599_unsetDragWhileDragging
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|400
argument_list|,
literal|400
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setGeometry
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QPoint
name|origPos
init|=
name|QPoint
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|QPoint
name|step1Pos
init|=
name|QPoint
argument_list|(
literal|100
argument_list|,
literal|110
argument_list|)
decl_stmt|;
name|QPoint
name|step2Pos
init|=
name|QPoint
argument_list|(
literal|100
argument_list|,
literal|120
argument_list|)
decl_stmt|;
comment|// Enable and do a drag
block|{
name|view
operator|.
name|setDragMode
argument_list|(
name|QGraphicsView
operator|::
name|ScrollHandDrag
argument_list|)
expr_stmt|;
name|QMouseEvent
name|press
argument_list|(
name|QEvent
operator|::
name|MouseButtonPress
argument_list|,
name|origPos
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QMouseEvent
name|move
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|step1Pos
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|press
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|move
argument_list|)
expr_stmt|;
block|}
comment|// unset drag and release mouse, inverse order
block|{
name|view
operator|.
name|setDragMode
argument_list|(
name|QGraphicsView
operator|::
name|NoDrag
argument_list|)
expr_stmt|;
name|QMouseEvent
name|release
argument_list|(
name|QEvent
operator|::
name|MouseButtonRelease
argument_list|,
name|step1Pos
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|release
argument_list|)
expr_stmt|;
block|}
name|QPoint
name|basePos
init|=
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
comment|// reset drag, and move mouse without holding button down.
block|{
name|view
operator|.
name|setDragMode
argument_list|(
name|QGraphicsView
operator|::
name|ScrollHandDrag
argument_list|)
expr_stmt|;
name|QMouseEvent
name|move
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|step2Pos
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|move
argument_list|)
expr_stmt|;
block|}
comment|// Check that no draggin has occurred...
name|QCOMPARE
argument_list|(
name|basePos
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task236394_sendShortcutOverrideEvent
name|void
name|tst_QGraphicsView
operator|::
name|task236394_sendShortcutOverrideEvent
parameter_list|()
block|{
name|QGraphicsView
name|view
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QKeyEvent
name|event
argument_list|(
name|QEvent
operator|::
name|ShortcutOverride
argument_list|,
name|Qt
operator|::
name|Key_A
argument_list|,
literal|0
argument_list|,
name|QString
argument_list|(
literal|"A"
argument_list|)
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|view
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|ChangedListener
class|class
name|ChangedListener
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
public|public:
DECL|member|changes
name|QList
argument_list|<
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|>
name|changes
decl_stmt|;
public|public
name|slots
public|:
DECL|function|changed
name|void
name|changed
parameter_list|(
specifier|const
name|QList
argument_list|<
name|QRectF
argument_list|>
modifier|&
name|dirty
parameter_list|)
block|{
name|changes
operator|<<
name|dirty
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|task239729_noViewUpdate_data
name|void
name|tst_QGraphicsView
operator|::
name|task239729_noViewUpdate_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"a"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"a"
argument_list|)
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b"
argument_list|)
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task239729_noViewUpdate
name|void
name|tst_QGraphicsView
operator|::
name|task239729_noViewUpdate
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|a
argument_list|)
expr_stmt|;
comment|// The scene's changed signal is connected to something that isn't a view.
name|QGraphicsScene
name|scene
decl_stmt|;
name|ChangedListener
name|cl
decl_stmt|;
name|QGraphicsView
modifier|*
name|view
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|a
condition|)
block|{
name|view
operator|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|connect
argument_list|(
operator|&
name|scene
argument_list|,
name|SIGNAL
argument_list|(
name|changed
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|)
argument_list|)
argument_list|,
operator|&
name|cl
argument_list|,
name|SLOT
argument_list|(
name|changed
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|connect
argument_list|(
operator|&
name|scene
argument_list|,
name|SIGNAL
argument_list|(
name|changed
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|)
argument_list|)
argument_list|,
operator|&
name|cl
argument_list|,
name|SLOT
argument_list|(
name|changed
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
block|}
name|EventSpy
name|spy
argument_list|(
name|view
operator|->
name|viewport
argument_list|()
argument_list|,
name|QEvent
operator|::
name|Paint
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|view
operator|->
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|spy
operator|.
name|count
argument_list|()
operator|>=
literal|1
argument_list|)
expr_stmt|;
name|spy
operator|.
name|reset
argument_list|()
expr_stmt|;
name|scene
operator|.
name|update
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
operator|delete
name|view
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task239047_fitInViewSmallViewport
name|void
name|tst_QGraphicsView
operator|::
name|task239047_fitInViewSmallViewport
parameter_list|()
block|{
comment|// Ensure that with a small viewport, fitInView doesn't mirror the
comment|// scene.
name|QWidget
name|widget
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
modifier|*
name|view
init|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|widget
argument_list|)
decl_stmt|;
name|view
operator|->
name|resize
argument_list|(
literal|3
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|->
name|size
argument_list|()
argument_list|,
name|QSize
argument_list|(
literal|3
argument_list|,
literal|3
argument_list|)
argument_list|)
expr_stmt|;
name|widget
operator|.
name|show
argument_list|()
expr_stmt|;
name|view
operator|->
name|fitInView
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QPointF
name|topLeft
init|=
name|view
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QPointF
name|bottomRight
init|=
name|view
operator|->
name|mapToScene
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|bottomRight
operator|.
name|x
argument_list|()
operator|>
name|topLeft
operator|.
name|x
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|bottomRight
operator|.
name|y
argument_list|()
operator|>
name|topLeft
operator|.
name|y
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|->
name|fitInView
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|)
expr_stmt|;
comment|// Don't crash
name|view
operator|->
name|scale
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|view
operator|->
name|fitInView
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task245469_itemsAtPointWithClip
name|void
name|tst_QGraphicsView
operator|::
name|task245469_itemsAtPointWithClip
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|child
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|,
name|parent
argument_list|)
decl_stmt|;
name|parent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|150
argument_list|,
literal|150
argument_list|)
expr_stmt|;
name|view
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|itemsAtCenter
init|=
name|view
operator|.
name|items
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|itemsAtCenter
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child
operator|<<
name|parent
operator|)
argument_list|)
expr_stmt|;
name|QPolygonF
name|p
init|=
name|view
operator|.
name|mapToScene
argument_list|(
name|QRect
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|,
name|QSize
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|itemsAtCenter2
init|=
name|scene
operator|.
name|items
argument_list|(
name|p
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|itemsAtCenter2
argument_list|,
name|itemsAtCenter
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|createSimpleViewAndScene
specifier|static
name|QGraphicsView
modifier|*
name|createSimpleViewAndScene
parameter_list|()
block|{
name|QGraphicsView
modifier|*
name|view
init|=
operator|new
name|QGraphicsView
decl_stmt|;
name|QGraphicsScene
modifier|*
name|scene
init|=
operator|new
name|QGraphicsScene
decl_stmt|;
name|view
operator|->
name|setScene
argument_list|(
name|scene
argument_list|)
expr_stmt|;
name|view
operator|->
name|setBackgroundBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
name|scene
operator|->
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|rect
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setPen
argument_list|(
name|Qt
operator|::
name|NoPen
argument_list|)
expr_stmt|;
return|return
name|view
return|;
block|}
end_function
begin_class
DECL|class|SpyItem
class|class
name|SpyItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|SpyItem
name|SpyItem
parameter_list|()
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
block|{     }
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
name|transform
operator|=
name|painter
operator|->
name|transform
argument_list|()
expr_stmt|;
block|}
DECL|member|transform
name|QTransform
name|transform
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|embeddedViews
name|void
name|tst_QGraphicsView
operator|::
name|embeddedViews
parameter_list|()
block|{
name|QGraphicsView
modifier|*
name|v1
init|=
name|createSimpleViewAndScene
argument_list|()
decl_stmt|;
name|QGraphicsView
modifier|*
name|v2
init|=
name|createSimpleViewAndScene
argument_list|()
decl_stmt|;
name|QGraphicsProxyWidget
modifier|*
name|proxy
init|=
name|v1
operator|->
name|scene
argument_list|()
operator|->
name|addWidget
argument_list|(
name|v2
argument_list|)
decl_stmt|;
name|SpyItem
modifier|*
name|item
init|=
operator|new
name|SpyItem
decl_stmt|;
name|v2
operator|->
name|scene
argument_list|()
operator|->
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|proxy
operator|->
name|translate
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QImage
name|actual
argument_list|(
literal|64
argument_list|,
literal|64
argument_list|,
name|QImage
operator|::
name|Format_ARGB32_Premultiplied
argument_list|)
decl_stmt|;
name|actual
operator|.
name|fill
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|v1
operator|->
name|QWidget
operator|::
name|render
argument_list|(
operator|&
name|actual
argument_list|)
expr_stmt|;
name|QTransform
name|a
init|=
name|item
operator|->
name|transform
decl_stmt|;
name|v2
operator|->
name|QWidget
operator|::
name|render
argument_list|(
operator|&
name|actual
argument_list|)
expr_stmt|;
name|QTransform
name|b
init|=
name|item
operator|->
name|transform
decl_stmt|;
name|QVERIFY
argument_list|(
name|a
operator|==
name|b
argument_list|)
expr_stmt|;
operator|delete
name|v1
expr_stmt|;
block|}
end_function
begin_function
DECL|function|scrollAfterResize_data
name|void
name|tst_QGraphicsView
operator|::
name|scrollAfterResize_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"reverse"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QTransform
argument_list|>
argument_list|(
literal|"x1"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QTransform
argument_list|>
argument_list|(
literal|"x2"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QTransform
argument_list|>
argument_list|(
literal|"x3"
argument_list|)
expr_stmt|;
if|#
directive|if
operator|!
name|defined
argument_list|(
name|QT_NO_STYLE_PLASTIQUE
argument_list|)
name|QPlastiqueStyle
name|style
decl_stmt|;
elif|#
directive|elif
operator|!
name|defined
argument_list|(
name|QT_NO_STYLE_WINDOWS
argument_list|)
name|QWindowsStyle
name|style
decl_stmt|;
else|#
directive|else
name|QCommonStyle
name|style
decl_stmt|;
endif|#
directive|endif
name|int
name|frameWidth
init|=
name|style
operator|.
name|pixelMetric
argument_list|(
name|QStyle
operator|::
name|PM_DefaultFrameWidth
argument_list|)
decl_stmt|;
name|int
name|extent
init|=
name|style
operator|.
name|pixelMetric
argument_list|(
name|QStyle
operator|::
name|PM_ScrollBarExtent
argument_list|)
decl_stmt|;
name|int
name|inside
init|=
name|style
operator|.
name|styleHint
argument_list|(
name|QStyle
operator|::
name|SH_ScrollView_FrameOnlyAroundContents
argument_list|)
decl_stmt|;
name|int
name|viewportWidth
init|=
literal|300
decl_stmt|;
name|int
name|scrollBarIndent
init|=
name|viewportWidth
operator|-
name|extent
operator|-
operator|(
name|inside
condition|?
literal|4
else|:
literal|2
operator|)
operator|*
name|frameWidth
decl_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"normal"
argument_list|)
operator|<<
literal|false
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QTransform
argument_list|()
operator|.
name|translate
argument_list|(
operator|-
literal|10
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"reverse"
argument_list|)
operator|<<
literal|true
operator|<<
name|QTransform
argument_list|()
operator|.
name|translate
argument_list|(
name|scrollBarIndent
argument_list|,
literal|0
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|translate
argument_list|(
name|scrollBarIndent
operator|+
literal|100
argument_list|,
literal|0
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|translate
argument_list|(
name|scrollBarIndent
operator|+
literal|110
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|scrollAfterResize
name|void
name|tst_QGraphicsView
operator|::
name|scrollAfterResize
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|reverse
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QTransform
argument_list|,
name|x1
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QTransform
argument_list|,
name|x2
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QTransform
argument_list|,
name|x3
argument_list|)
expr_stmt|;
if|#
directive|if
operator|!
name|defined
argument_list|(
name|QT_NO_STYLE_PLASTIQUE
argument_list|)
name|QPlastiqueStyle
name|style
decl_stmt|;
elif|#
directive|elif
operator|!
name|defined
argument_list|(
name|QT_NO_STYLE_WINDOWS
argument_list|)
name|QWindowsStyle
name|style
decl_stmt|;
else|#
directive|else
name|QCommonStyle
name|style
decl_stmt|;
endif|#
directive|endif
name|QWidget
name|toplevel
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|toplevel
argument_list|)
decl_stmt|;
name|view
operator|.
name|setStyle
argument_list|(
operator|&
name|style
argument_list|)
expr_stmt|;
if|if
condition|(
name|reverse
condition|)
name|view
operator|.
name|setLayoutDirection
argument_list|(
name|Qt
operator|::
name|RightToLeft
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|,
literal|2000
argument_list|,
literal|2000
argument_list|)
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|300
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|toplevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|toplevel
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|setValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|setValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewportTransform
argument_list|()
argument_list|,
name|x1
argument_list|)
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|400
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewportTransform
argument_list|()
argument_list|,
name|x2
argument_list|)
expr_stmt|;
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|setValue
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewportTransform
argument_list|()
argument_list|,
name|x3
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|moveItemWhileScrolling_data
name|void
name|tst_QGraphicsView
operator|::
name|moveItemWhileScrolling_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"adjustForAntialiasing"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"changedConnected"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"no adjust"
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"adjust"
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"no adjust changedConnected"
argument_list|)
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"adjust changedConnected"
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_function
DECL|function|moveItemWhileScrolling
name|void
name|tst_QGraphicsView
operator|::
name|moveItemWhileScrolling
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|adjustForAntialiasing
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|changedConnected
argument_list|)
expr_stmt|;
class|class
name|MoveItemScrollView
super|:
specifier|public
name|QGraphicsView
block|{
public|public:
name|MoveItemScrollView
parameter_list|()
block|{
name|setWindowFlags
argument_list|(
name|Qt
operator|::
name|X11BypassWindowManagerHint
argument_list|)
expr_stmt|;
name|setScene
argument_list|(
operator|new
name|QGraphicsScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1000
argument_list|,
literal|1000
argument_list|)
argument_list|)
expr_stmt|;
name|rect
operator|=
name|scene
argument_list|()
operator|->
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|painted
operator|=
literal|false
expr_stmt|;
block|}
name|QRegion
name|lastPaintedRegion
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
decl_stmt|;
name|bool
name|painted
decl_stmt|;
name|void
name|waitForPaintEvent
parameter_list|()
block|{
name|QTimer
operator|::
name|singleShot
argument_list|(
literal|2000
argument_list|,
operator|&
name|eventLoop
argument_list|,
name|SLOT
argument_list|(
name|quit
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|eventLoop
operator|.
name|exec
argument_list|()
expr_stmt|;
block|}
protected|protected:
name|QEventLoop
name|eventLoop
decl_stmt|;
name|void
name|paintEvent
parameter_list|(
name|QPaintEvent
modifier|*
name|event
parameter_list|)
block|{
name|painted
operator|=
literal|true
expr_stmt|;
name|lastPaintedRegion
operator|=
name|event
operator|->
name|region
argument_list|()
expr_stmt|;
name|QGraphicsView
operator|::
name|paintEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
if|if
condition|(
name|eventLoop
operator|.
name|isRunning
argument_list|()
condition|)
name|eventLoop
operator|.
name|quit
argument_list|()
expr_stmt|;
block|}
block|}
class|;
name|MoveItemScrollView
name|view
decl_stmt|;
name|view
operator|.
name|setFrameStyle
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|setHorizontalScrollBarPolicy
argument_list|(
name|Qt
operator|::
name|ScrollBarAlwaysOff
argument_list|)
expr_stmt|;
name|view
operator|.
name|setVerticalScrollBarPolicy
argument_list|(
name|Qt
operator|::
name|ScrollBarAlwaysOff
argument_list|)
expr_stmt|;
name|view
operator|.
name|setResizeAnchor
argument_list|(
name|QGraphicsView
operator|::
name|NoAnchor
argument_list|)
expr_stmt|;
name|view
operator|.
name|setTransformationAnchor
argument_list|(
name|QGraphicsView
operator|::
name|NoAnchor
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|adjustForAntialiasing
condition|)
name|view
operator|.
name|setOptimizationFlag
argument_list|(
name|QGraphicsView
operator|::
name|DontAdjustForAntialiasing
argument_list|)
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|view
operator|.
name|painted
operator|=
literal|false
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
if|if
condition|(
name|changedConnected
condition|)
name|QObject
operator|::
name|connect
argument_list|(
name|view
operator|.
name|scene
argument_list|()
argument_list|,
name|SIGNAL
argument_list|(
name|changed
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|)
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|dummySlot
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|painted
argument_list|)
expr_stmt|;
name|view
operator|.
name|painted
operator|=
literal|false
expr_stmt|;
name|view
operator|.
name|lastPaintedRegion
operator|=
name|QRegion
argument_list|()
expr_stmt|;
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|setValue
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
operator|+
literal|10
argument_list|)
expr_stmt|;
name|view
operator|.
name|rect
operator|->
name|moveBy
argument_list|(
literal|0
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|view
operator|.
name|waitForPaintEvent
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|painted
argument_list|)
expr_stmt|;
name|QRegion
name|expectedRegion
decl_stmt|;
name|expectedRegion
operator|+=
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|expectedRegion
operator|-=
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|190
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|int
name|a
init|=
name|adjustForAntialiasing
condition|?
literal|2
else|:
literal|1
decl_stmt|;
name|expectedRegion
operator|+=
name|QRect
argument_list|(
literal|40
argument_list|,
literal|50
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|.
name|adjusted
argument_list|(
operator|-
name|a
argument_list|,
operator|-
name|a
argument_list|,
name|a
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|expectedRegion
operator|+=
name|QRect
argument_list|(
literal|40
argument_list|,
literal|60
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|.
name|adjusted
argument_list|(
operator|-
name|a
argument_list|,
operator|-
name|a
argument_list|,
name|a
argument_list|,
name|a
argument_list|)
expr_stmt|;
name|COMPARE_REGIONS
argument_list|(
name|view
operator|.
name|lastPaintedRegion
argument_list|,
name|expectedRegion
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|centerOnDirtyItem
name|void
name|tst_QGraphicsView
operator|::
name|centerOnDirtyItem
parameter_list|()
block|{
name|QWidget
name|toplevel
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|toplevel
argument_list|)
decl_stmt|;
name|toplevel
operator|.
name|setWindowFlags
argument_list|(
name|view
operator|.
name|windowFlags
argument_list|()
operator||
name|Qt
operator|::
name|WindowStaysOnTopHint
argument_list|)
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QGraphicsScene
modifier|*
name|scene
init|=
operator|new
name|QGraphicsScene
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|,
literal|2000
argument_list|,
literal|2000
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|item
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|scene
operator|->
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|view
operator|.
name|centerOn
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|toplevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|toplevel
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QImage
name|before
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|size
argument_list|()
argument_list|,
name|QImage
operator|::
name|Format_ARGB32
argument_list|)
decl_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|render
argument_list|(
operator|&
name|before
argument_list|)
expr_stmt|;
name|item
operator|->
name|setPos
argument_list|(
literal|20
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|centerOn
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QImage
name|after
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|size
argument_list|()
argument_list|,
name|QImage
operator|::
name|Format_ARGB32
argument_list|)
decl_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|render
argument_list|(
operator|&
name|after
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|before
argument_list|,
name|after
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|mouseTracking
name|void
name|tst_QGraphicsView
operator|::
name|mouseTracking
parameter_list|()
block|{
comment|// Mouse tracking should only be automatically enabled if items either accept hover events
comment|// or have a cursor set. We never disable mouse tracking if it is already enabled.
block|{
comment|// Make sure mouse tracking is disabled by default.
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Make sure we don't disable mouse tracking in setupViewport/setScene.
name|QGraphicsView
name|view
decl_stmt|;
name|QWidget
modifier|*
name|viewport
init|=
operator|new
name|QWidget
decl_stmt|;
name|viewport
operator|->
name|setMouseTracking
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|view
operator|.
name|setViewport
argument_list|(
name|viewport
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|viewport
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|viewport
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|// Make sure we enable mouse tracking when having items that accept hover events.
block|{
comment|// Adding an item to the scene after the scene is set on the view.
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|item
operator|->
name|setAcceptHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Adding an item to the scene before the scene is set on the view.
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|item
operator|->
name|setAcceptHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
comment|// QGraphicsWidget implicitly accepts hover if it has window decoration.
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
comment|// Enable window decoraton.
name|widget
operator|->
name|setWindowFlags
argument_list|(
name|Qt
operator|::
name|Window
operator||
name|Qt
operator|::
name|WindowTitleHint
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|// Make sure we enable mouse tracking when having items with a cursor set.
block|{
comment|// Adding an item to the scene after the scene is set on the view.
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
name|item
operator|->
name|setCursor
argument_list|(
name|Qt
operator|::
name|CrossCursor
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Adding an item to the scene before the scene is set on the view.
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
name|item
operator|->
name|setCursor
argument_list|(
name|Qt
operator|::
name|CrossCursor
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|// Make sure we propagate mouse tracking to all views.
block|{
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view1
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view2
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view3
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
name|item
operator|->
name|setCursor
argument_list|(
name|Qt
operator|::
name|CrossCursor
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view1
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view2
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view3
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|mouseTracking2
name|void
name|tst_QGraphicsView
operator|::
name|mouseTracking2
parameter_list|()
block|{
comment|// Make sure mouse move events propagates to the scene when
comment|// mouse tracking is explicitly enabled on the view,
comment|// even when all items ignore hover events / use default cursor.
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|setMouseTracking
argument_list|(
literal|true
argument_list|)
expr_stmt|;
comment|// Explicitly enable mouse tracking.
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
name|EventSpy
name|spy
argument_list|(
operator|&
name|scene
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|,
name|Qt
operator|::
name|NoButton
argument_list|,
name|Qt
operator|::
name|MouseButtons
argument_list|(
name|Qt
operator|::
name|NoButton
argument_list|)
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|mouseTracking3
name|void
name|tst_QGraphicsView
operator|::
name|mouseTracking3
parameter_list|()
block|{
comment|// Mouse tracking should be automatically enabled if AnchorUnderMouse is used for
comment|// view transform or resize. We never disable mouse tracking if it is already enabled.
block|{
comment|// Make sure we enable mouse tracking when using AnchorUnderMouse for view transformation.
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setTransformationAnchor
argument_list|(
name|QGraphicsView
operator|::
name|AnchorUnderMouse
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Make sure we enable mouse tracking when using AnchorUnderMouse for view resizing.
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|setResizeAnchor
argument_list|(
name|QGraphicsView
operator|::
name|AnchorUnderMouse
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Make sure we don't disable mouse tracking in setViewport/setScene (transformation anchor).
name|QGraphicsView
name|view
decl_stmt|;
name|view
operator|.
name|setTransformationAnchor
argument_list|(
name|QGraphicsView
operator|::
name|AnchorUnderMouse
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
name|QWidget
modifier|*
name|viewport
init|=
operator|new
name|QWidget
decl_stmt|;
name|view
operator|.
name|setViewport
argument_list|(
name|viewport
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|viewport
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|viewport
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Make sure we don't disable mouse tracking in setViewport/setScene (resize anchor).
name|QGraphicsView
name|view
decl_stmt|;
name|view
operator|.
name|setResizeAnchor
argument_list|(
name|QGraphicsView
operator|::
name|AnchorUnderMouse
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
name|QWidget
modifier|*
name|viewport
init|=
operator|new
name|QWidget
decl_stmt|;
name|view
operator|.
name|setViewport
argument_list|(
name|viewport
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|viewport
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|viewport
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|// Make sure we don't disable mouse tracking when adding an item (transformation anchor).
block|{
comment|// Adding an item to the scene before the scene is set on the view.
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
decl_stmt|;
name|view
operator|.
name|setTransformationAnchor
argument_list|(
name|QGraphicsView
operator|::
name|AnchorUnderMouse
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Adding an item to the scene after the scene is set on the view.
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setTransformationAnchor
argument_list|(
name|QGraphicsView
operator|::
name|AnchorUnderMouse
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|// Make sure we don't disable mouse tracking when adding an item (resize anchor).
block|{
comment|// Adding an item to the scene before the scene is set on the view.
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
decl_stmt|;
name|view
operator|.
name|setResizeAnchor
argument_list|(
name|QGraphicsView
operator|::
name|AnchorUnderMouse
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Adding an item to the scene after the scene is set on the view.
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|10000
argument_list|,
operator|-
literal|10000
argument_list|,
literal|20000
argument_list|,
literal|20000
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setResizeAnchor
argument_list|(
name|QGraphicsView
operator|::
name|AnchorUnderMouse
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasMouseTracking
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_class
DECL|class|RenderTester
class|class
name|RenderTester
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|RenderTester
name|RenderTester
parameter_list|(
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|)
member_init_list|,
name|paints
argument_list|(
literal|0
argument_list|)
block|{ }
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
name|widget
parameter_list|)
block|{
name|QGraphicsRectItem
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|widget
argument_list|)
expr_stmt|;
operator|++
name|paints
expr_stmt|;
block|}
DECL|member|paints
name|int
name|paints
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|render
name|void
name|tst_QGraphicsView
operator|::
name|render
parameter_list|()
block|{
comment|// ### This test can be much more thorough - see QGraphicsScene::render.
name|QGraphicsScene
name|scene
decl_stmt|;
name|CustomView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFrameStyle
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|view
operator|.
name|painted
operator|=
literal|false
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|painted
argument_list|)
expr_stmt|;
name|RenderTester
modifier|*
name|r1
init|=
operator|new
name|RenderTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
decl_stmt|;
name|RenderTester
modifier|*
name|r2
init|=
operator|new
name|RenderTester
argument_list|(
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
decl_stmt|;
name|RenderTester
modifier|*
name|r3
init|=
operator|new
name|RenderTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
decl_stmt|;
name|RenderTester
modifier|*
name|r4
init|=
operator|new
name|RenderTester
argument_list|(
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|r1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|r2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|r3
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|r4
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|r1
operator|->
name|paints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|r2
operator|->
name|paints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|r3
operator|->
name|paints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|r4
operator|->
name|paints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QPixmap
name|pix
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|pix
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|transparent
argument_list|)
expr_stmt|;
name|QPainter
name|painter
argument_list|(
operator|&
name|pix
argument_list|)
decl_stmt|;
name|view
operator|.
name|render
argument_list|(
operator|&
name|painter
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|r1
operator|->
name|paints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|r2
operator|->
name|paints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|r3
operator|->
name|paints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|r4
operator|->
name|paints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|exposeRegion
name|void
name|tst_QGraphicsView
operator|::
name|exposeRegion
parameter_list|()
block|{
name|RenderTester
modifier|*
name|item
init|=
operator|new
name|RenderTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|item
operator|->
name|paints
operator|=
literal|0
expr_stmt|;
name|CustomView
name|view
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|item
operator|->
name|paints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|item
operator|->
name|paints
operator|=
literal|0
expr_stmt|;
name|view
operator|.
name|lastUpdateRegions
operator|.
name|clear
argument_list|()
expr_stmt|;
comment|// Update a small area in the viewport's topLeft() and bottomRight().
comment|// (the boundingRect() of this area covers the entire viewport).
name|QWidget
modifier|*
name|viewport
init|=
name|view
operator|.
name|viewport
argument_list|()
decl_stmt|;
name|QRegion
name|expectedExposeRegion
init|=
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
decl_stmt|;
name|expectedExposeRegion
operator|+=
name|QRect
argument_list|(
name|viewport
operator|->
name|rect
argument_list|()
operator|.
name|bottomRight
argument_list|()
operator|-
name|QPoint
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
name|QSize
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|viewport
operator|->
name|update
argument_list|(
name|expectedExposeRegion
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
comment|// Make sure it triggers correct repaint on the view.
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|COMPARE_REGIONS
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|expectedExposeRegion
argument_list|)
expr_stmt|;
comment|// Make sure the item didn't get any repaints.
ifndef|#
directive|ifndef
name|Q_OS_MAC
name|QCOMPARE
argument_list|(
name|item
operator|->
name|paints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function
begin_function
DECL|function|update_data
name|void
name|tst_QGraphicsView
operator|::
name|update_data
parameter_list|()
block|{
comment|// In view.viewport() coordinates. (viewport rect: QRect(0, 0, 200, 200))
name|QTest
operator|::
name|addColumn
argument_list|<
name|QRect
argument_list|>
argument_list|(
literal|"updateRect"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"empty"
argument_list|)
operator|<<
name|QRect
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"outside left"
argument_list|)
operator|<<
name|QRect
argument_list|(
operator|-
literal|200
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"outside right"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|400
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"outside top"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
operator|-
literal|200
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"outside bottom"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|400
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"partially inside left"
argument_list|)
operator|<<
name|QRect
argument_list|(
operator|-
literal|50
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"partially inside right"
argument_list|)
operator|<<
name|QRect
argument_list|(
operator|-
literal|150
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"partially inside top"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
operator|-
literal|150
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"partially inside bottom"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|150
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"on topLeft edge"
argument_list|)
operator|<<
name|QRect
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"on topRight edge"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|200
argument_list|,
operator|-
literal|100
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"on bottomRight edge"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"on bottomLeft edge"
argument_list|)
operator|<<
name|QRect
argument_list|(
operator|-
literal|200
argument_list|,
literal|200
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"inside topLeft"
argument_list|)
operator|<<
name|QRect
argument_list|(
operator|-
literal|99
argument_list|,
operator|-
literal|99
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"inside topRight"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|199
argument_list|,
operator|-
literal|99
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"inside bottomRight"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|199
argument_list|,
literal|199
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"inside bottomLeft"
argument_list|)
operator|<<
name|QRect
argument_list|(
operator|-
literal|199
argument_list|,
literal|199
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"large1"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|50
argument_list|,
operator|-
literal|100
argument_list|,
literal|100
argument_list|,
literal|400
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"large2"
argument_list|)
operator|<<
name|QRect
argument_list|(
operator|-
literal|100
argument_list|,
literal|50
argument_list|,
literal|400
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"large3"
argument_list|)
operator|<<
name|QRect
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|400
argument_list|,
literal|400
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"viewport rect"
argument_list|)
operator|<<
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|update
name|void
name|tst_QGraphicsView
operator|::
name|update
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QRect
argument_list|,
name|updateRect
argument_list|)
expr_stmt|;
comment|// some window manager resize the toplevel to max screen size
comment|// so we must make our view a child (no layout!) of a dummy toplevel
comment|// to ensure that it's really 200x200 pixels
name|QWidget
name|toplevel
decl_stmt|;
comment|// Create a view with viewport rect equal to QRect(0, 0, 200, 200).
name|QGraphicsScene
name|dummyScene
decl_stmt|;
name|CustomView
name|view
argument_list|(
literal|0
argument_list|,
operator|&
name|toplevel
argument_list|)
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|dummyScene
argument_list|)
expr_stmt|;
name|view
operator|.
name|ensurePolished
argument_list|()
expr_stmt|;
comment|// must ensure polished to get content margins right
name|int
name|left
decl_stmt|,
name|top
decl_stmt|,
name|right
decl_stmt|,
name|bottom
decl_stmt|;
name|view
operator|.
name|getContentsMargins
argument_list|(
operator|&
name|left
argument_list|,
operator|&
name|top
argument_list|,
operator|&
name|right
argument_list|,
operator|&
name|bottom
argument_list|)
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|200
operator|+
name|left
operator|+
name|right
argument_list|,
literal|200
operator|+
name|top
operator|+
name|bottom
argument_list|)
expr_stmt|;
name|toplevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|toplevel
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|toplevel
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
operator|&
name|toplevel
argument_list|)
argument_list|)
expr_stmt|;
specifier|const
name|QRect
name|viewportRect
init|=
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|viewportRect
argument_list|,
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
name|QT_BUILD_INTERNAL
specifier|const
name|bool
name|intersects
init|=
name|updateRect
operator|.
name|intersects
argument_list|(
name|viewportRect
argument_list|)
decl_stmt|;
name|QGraphicsViewPrivate
modifier|*
name|viewPrivate
init|=
cast|static_cast
argument_list|<
name|QGraphicsViewPrivate
operator|*
argument_list|>
argument_list|(
name|qt_widget_private
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
decl_stmt|;
name|QTRY_COMPARE
argument_list|(
name|viewPrivate
operator|->
name|updateRect
argument_list|(
name|updateRect
argument_list|)
argument_list|,
name|intersects
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|view
operator|.
name|lastUpdateRegions
operator|.
name|clear
argument_list|()
expr_stmt|;
name|viewPrivate
operator|->
name|processPendingUpdates
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|viewPrivate
operator|->
name|dirtyRegion
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|viewPrivate
operator|->
name|dirtyBoundingRect
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|intersects
condition|)
block|{
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QRegion
argument_list|(
name|updateRect
argument_list|)
operator|&
name|viewportRect
argument_list|)
expr_stmt|;
block|}
name|QTRY_VERIFY
argument_list|(
operator|!
name|viewPrivate
operator|->
name|fullUpdatePending
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function
begin_function
DECL|function|update2_data
name|void
name|tst_QGraphicsView
operator|::
name|update2_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"penWidth"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"antialiasing"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"changedConnected"
argument_list|)
expr_stmt|;
comment|// Anti-aliased.
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pen width: 0.0, antialiasing: true"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pen width: 1.5, antialiasing: true"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.5
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pen width: 2.0, antialiasing: true"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|2.0
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pen width: 3.0, antialiasing: true"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|3.0
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
comment|// Aliased.
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pen width: 0.0, antialiasing: false"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pen width: 1.5, antialiasing: false"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.5
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pen width: 2.0, antialiasing: false"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|2.0
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pen width: 3.0, antialiasing: false"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|3.0
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
comment|// changed() connected
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pen width: 0.0, antialiasing: false, changed"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pen width: 1.5, antialiasing: true, changed"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.5
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pen width: 2.0, antialiasing: false, changed"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|2.0
argument_list|)
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pen width: 3.0, antialiasing: true, changed"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|3.0
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_function
DECL|function|update2
name|void
name|tst_QGraphicsView
operator|::
name|update2
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|penWidth
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|antialiasing
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|changedConnected
argument_list|)
expr_stmt|;
comment|// Create a rect item.
specifier|const
name|QRectF
name|rawItemRect
argument_list|(
operator|-
literal|50.4
argument_list|,
operator|-
literal|50.3
argument_list|,
literal|100.2
argument_list|,
literal|100.1
argument_list|)
decl_stmt|;
name|CountPaintItem
modifier|*
name|rect
init|=
operator|new
name|CountPaintItem
argument_list|(
name|rawItemRect
argument_list|)
decl_stmt|;
name|QPen
name|pen
decl_stmt|;
name|pen
operator|.
name|setWidthF
argument_list|(
name|penWidth
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setPen
argument_list|(
name|pen
argument_list|)
expr_stmt|;
comment|// Add item to a scene.
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
if|if
condition|(
name|changedConnected
condition|)
name|QObject
operator|::
name|connect
argument_list|(
operator|&
name|scene
argument_list|,
name|SIGNAL
argument_list|(
name|changed
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|)
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|dummySlot
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
comment|// Create a view on the scene.
name|CustomView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setOptimizationFlag
argument_list|(
name|QGraphicsView
operator|::
name|DontAdjustForAntialiasing
argument_list|,
operator|!
name|antialiasing
argument_list|)
expr_stmt|;
name|view
operator|.
name|setRenderHint
argument_list|(
name|QPainter
operator|::
name|Antialiasing
argument_list|,
name|antialiasing
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFrameStyle
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|rect
operator|->
name|numPaints
operator|>
literal|0
argument_list|)
expr_stmt|;
comment|// Calculate expected update region for the rect.
name|QRectF
name|expectedItemBoundingRect
init|=
name|rawItemRect
decl_stmt|;
specifier|const
name|qreal
name|halfPenWidth
init|=
name|penWidth
operator|/
name|qreal
argument_list|(
literal|2.0
argument_list|)
decl_stmt|;
name|expectedItemBoundingRect
operator|.
name|adjust
argument_list|(
operator|-
name|halfPenWidth
argument_list|,
operator|-
name|halfPenWidth
argument_list|,
name|halfPenWidth
argument_list|,
name|halfPenWidth
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|boundingRect
argument_list|()
argument_list|,
name|expectedItemBoundingRect
argument_list|)
expr_stmt|;
name|QRect
name|expectedItemDeviceBoundingRect
init|=
name|rect
operator|->
name|deviceTransform
argument_list|(
name|view
operator|.
name|viewportTransform
argument_list|()
argument_list|)
operator|.
name|mapRect
argument_list|(
name|expectedItemBoundingRect
argument_list|)
operator|.
name|toAlignedRect
argument_list|()
decl_stmt|;
if|if
condition|(
name|antialiasing
condition|)
name|expectedItemDeviceBoundingRect
operator|.
name|adjust
argument_list|(
operator|-
literal|2
argument_list|,
operator|-
literal|2
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
else|else
name|expectedItemDeviceBoundingRect
operator|.
name|adjust
argument_list|(
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
specifier|const
name|QRegion
name|expectedUpdateRegion
argument_list|(
name|expectedItemDeviceBoundingRect
argument_list|)
decl_stmt|;
comment|// Reset.
name|rect
operator|->
name|numPaints
operator|=
literal|0
expr_stmt|;
name|view
operator|.
name|lastUpdateRegions
operator|.
name|clear
argument_list|()
expr_stmt|;
name|view
operator|.
name|painted
operator|=
literal|false
expr_stmt|;
name|rect
operator|->
name|update
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|painted
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|Q_OS_MAC
comment|//cocoa doesn't support drawing regions
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|painted
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|expectedUpdateRegion
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function
begin_function
DECL|function|update_ancestorClipsChildrenToShape
name|void
name|tst_QGraphicsView
operator|::
name|update_ancestorClipsChildrenToShape
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|150
argument_list|,
operator|-
literal|150
argument_list|,
literal|300
argument_list|,
literal|300
argument_list|)
decl_stmt|;
comment|/*     Add three rects:      +------------------+     | child            |     | +--------------+ |     | | parent       | |     | |  +-----------+ |     | |  |grandParent| |     | |  +-----------+ |     | +--------------+ |     +------------------+      ... where both the parent and the grand parent clips children to shape.     */
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
comment|// Get rid of pending update.
name|QGraphicsRectItem
modifier|*
name|grandParent
init|=
cast|static_cast
argument_list|<
name|QGraphicsRectItem
operator|*
argument_list|>
argument_list|(
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
decl_stmt|;
name|grandParent
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
expr_stmt|;
name|grandParent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|parent
init|=
cast|static_cast
argument_list|<
name|QGraphicsRectItem
operator|*
argument_list|>
argument_list|(
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|parent
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|,
literal|125
argument_list|)
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setParentItem
argument_list|(
name|grandParent
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|child
init|=
cast|static_cast
argument_list|<
name|QGraphicsRectItem
operator|*
argument_list|>
argument_list|(
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
decl_stmt|;
name|child
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
literal|255
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|125
argument_list|)
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|CustomView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|painted
argument_list|)
expr_stmt|;
name|view
operator|.
name|lastUpdateRegions
operator|.
name|clear
argument_list|()
expr_stmt|;
name|view
operator|.
name|painted
operator|=
literal|false
expr_stmt|;
comment|// Call child->update() and make sure the updated area is within the ancestors' clip.
name|QRectF
name|expected
init|=
name|child
operator|->
name|deviceTransform
argument_list|(
name|view
operator|.
name|viewportTransform
argument_list|()
argument_list|)
operator|.
name|mapRect
argument_list|(
name|child
operator|->
name|boundingRect
argument_list|()
argument_list|)
decl_stmt|;
name|expected
operator|&=
name|grandParent
operator|->
name|deviceTransform
argument_list|(
name|view
operator|.
name|viewportTransform
argument_list|()
argument_list|)
operator|.
name|mapRect
argument_list|(
name|grandParent
operator|->
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
name|child
operator|->
name|update
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|painted
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|Q_OS_MAC
comment|//cocoa doesn't support drawing regions
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|painted
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QRegion
argument_list|(
name|expected
operator|.
name|toAlignedRect
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function
begin_function
DECL|function|update_ancestorClipsChildrenToShape2
name|void
name|tst_QGraphicsView
operator|::
name|update_ancestorClipsChildrenToShape2
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|150
argument_list|,
operator|-
literal|150
argument_list|,
literal|300
argument_list|,
literal|300
argument_list|)
decl_stmt|;
comment|/*     Add two rects:      +------------------+     | child            |     | +--------------+ |     | | parent       | |     | |              | |     | |              | |     | |              | |     | +--------------+ |     +------------------+      ... where the parent has no contents and clips the child to shape.     */
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
comment|// Get rid of pending update.
name|QGraphicsRectItem
modifier|*
name|parent
init|=
cast|static_cast
argument_list|<
name|QGraphicsRectItem
operator|*
argument_list|>
argument_list|(
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|parent
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|,
literal|125
argument_list|)
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemHasNoContents
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|child
init|=
cast|static_cast
argument_list|<
name|QGraphicsRectItem
operator|*
argument_list|>
argument_list|(
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
decl_stmt|;
name|child
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
literal|255
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|125
argument_list|)
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|CustomView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|painted
argument_list|)
expr_stmt|;
name|view
operator|.
name|lastUpdateRegions
operator|.
name|clear
argument_list|()
expr_stmt|;
name|view
operator|.
name|painted
operator|=
literal|false
expr_stmt|;
comment|// Call child->update() and make sure the updated area is within its parent's clip.
name|QRectF
name|expected
init|=
name|child
operator|->
name|deviceTransform
argument_list|(
name|view
operator|.
name|viewportTransform
argument_list|()
argument_list|)
operator|.
name|mapRect
argument_list|(
name|child
operator|->
name|boundingRect
argument_list|()
argument_list|)
decl_stmt|;
name|expected
operator|&=
name|parent
operator|->
name|deviceTransform
argument_list|(
name|view
operator|.
name|viewportTransform
argument_list|()
argument_list|)
operator|.
name|mapRect
argument_list|(
name|parent
operator|->
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
name|child
operator|->
name|update
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|painted
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|Q_OS_MAC
comment|//cocoa doesn't support drawing regions
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|painted
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QRegion
argument_list|(
name|expected
operator|.
name|toAlignedRect
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|view
operator|.
name|lastUpdateRegions
operator|.
name|clear
argument_list|()
expr_stmt|;
name|view
operator|.
name|painted
operator|=
literal|false
expr_stmt|;
comment|// Invalidate the parent's geometry and trigger an update.
comment|// The update area should be clipped to the parent's bounding rect for 'normal' items,
comment|// but in this case the item has no contents (ItemHasNoContents) and its geometry
comment|// is invalidated, which means we cannot clip the child update. So, the expected
comment|// area is exactly the same as the child's bounding rect (adjusted for antialiasing).
name|parent
operator|->
name|setRect
argument_list|(
name|parent
operator|->
name|rect
argument_list|()
operator|.
name|adjusted
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|expected
operator|=
name|child
operator|->
name|deviceTransform
argument_list|(
name|view
operator|.
name|viewportTransform
argument_list|()
argument_list|)
operator|.
name|mapRect
argument_list|(
name|child
operator|->
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
name|expected
operator|.
name|adjust
argument_list|(
operator|-
literal|2
argument_list|,
operator|-
literal|2
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// Antialiasing
ifndef|#
directive|ifndef
name|Q_OS_MAC
comment|//cocoa doesn't support drawing regions
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|painted
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|lastUpdateRegions
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QRegion
argument_list|(
name|expected
operator|.
name|toAlignedRect
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function
begin_class
DECL|class|FocusItem
class|class
name|FocusItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|FocusItem
name|FocusItem
parameter_list|()
member_init_list|:
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
block|{
name|m_viewHasIMEnabledInFocusInEvent
operator|=
literal|false
expr_stmt|;
block|}
DECL|function|focusInEvent
name|void
name|focusInEvent
parameter_list|(
name|QFocusEvent
modifier|*
comment|/* event */
parameter_list|)
block|{
name|QGraphicsView
modifier|*
name|view
init|=
name|scene
argument_list|()
operator|->
name|views
argument_list|()
operator|.
name|first
argument_list|()
decl_stmt|;
name|m_viewHasIMEnabledInFocusInEvent
operator|=
name|view
operator|->
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
expr_stmt|;
block|}
DECL|member|m_viewHasIMEnabledInFocusInEvent
name|bool
name|m_viewHasIMEnabledInFocusInEvent
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|inputMethodSensitivity
name|void
name|tst_QGraphicsView
operator|::
name|inputMethodSensitivity
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|FocusItem
modifier|*
name|item
init|=
operator|new
name|FocusItem
decl_stmt|;
name|view
operator|.
name|setAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemAcceptsInputMethod
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|m_viewHasIMEnabledInFocusInEvent
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemAcceptsInputMethod
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemAcceptsInputMethod
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
comment|// introduce another item that is focusable but does not accept input methods
name|FocusItem
modifier|*
name|item2
init|=
operator|new
name|FocusItem
decl_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|m_viewHasIMEnabledInFocusInEvent
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|item2
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|m_viewHasIMEnabledInFocusInEvent
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|m_viewHasIMEnabledInFocusInEvent
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|m_viewHasIMEnabledInFocusInEvent
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|item2
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|item2
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|m_viewHasIMEnabledInFocusInEvent
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|inputContextReset
name|void
name|tst_QGraphicsView
operator|::
name|inputContextReset
parameter_list|()
block|{
name|PlatformInputContext
name|inputContext
decl_stmt|;
name|QInputMethodPrivate
modifier|*
name|inputMethodPrivate
init|=
name|QInputMethodPrivate
operator|::
name|get
argument_list|(
name|qApp
operator|->
name|inputMethod
argument_list|()
argument_list|)
decl_stmt|;
name|inputMethodPrivate
operator|->
name|testContext
operator|=
operator|&
name|inputContext
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item1
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|item1
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
operator||
name|QGraphicsItem
operator|::
name|ItemAcceptsInputMethod
argument_list|)
expr_stmt|;
name|inputContext
operator|.
name|m_resetCallCount
operator|=
literal|0
expr_stmt|;
name|inputContext
operator|.
name|m_commitCallCount
operator|=
literal|0
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|inputContext
operator|.
name|m_resetCallCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|inputContext
operator|.
name|m_commitCallCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|item1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_InputMethodEnabled
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|inputContext
operator|.
name|m_resetCallCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|inputContext
operator|.
name|m_commitCallCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|// the input context is reset twice, once because an item has lost focus and again because
comment|// the Qt::WA_InputMethodEnabled flag is cleared because no item has focus.
comment|//    QEXPECT_FAIL("", "QTBUG-22454", Abort);
name|QCOMPARE
argument_list|(
name|inputContext
operator|.
name|m_resetCallCount
operator|+
name|inputContext
operator|.
name|m_commitCallCount
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// introduce another item that is focusable but does not accept input methods
name|QGraphicsItem
modifier|*
name|item2
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|item2
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|inputContext
operator|.
name|m_resetCallCount
operator|=
literal|0
expr_stmt|;
name|inputContext
operator|.
name|m_commitCallCount
operator|=
literal|0
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|inputContext
operator|.
name|m_resetCallCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|inputContext
operator|.
name|m_commitCallCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|inputContext
operator|.
name|m_resetCallCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|inputContext
operator|.
name|m_commitCallCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// test changing between between items that accept input methods.
name|item2
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
operator||
name|QGraphicsItem
operator|::
name|ItemAcceptsInputMethod
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|inputContext
operator|.
name|m_resetCallCount
operator|+
name|inputContext
operator|.
name|m_commitCallCount
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|indirectPainting
name|void
name|tst_QGraphicsView
operator|::
name|indirectPainting
parameter_list|()
block|{
class|class
name|MyScene
super|:
specifier|public
name|QGraphicsScene
block|{
public|public:
name|MyScene
parameter_list|()
member_init_list|:
name|QGraphicsScene
argument_list|()
member_init_list|,
name|drawCount
argument_list|(
literal|0
argument_list|)
block|{}
name|void
name|drawItems
parameter_list|(
name|QPainter
modifier|*
parameter_list|,
name|int
parameter_list|,
name|QGraphicsItem
modifier|*
modifier|*
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
operator|++
name|drawCount
expr_stmt|;
block|}
name|int
name|drawCount
decl_stmt|;
block|}
class|;
name|MyScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setOptimizationFlag
argument_list|(
name|QGraphicsView
operator|::
name|IndirectPainting
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|scene
operator|.
name|drawCount
operator|=
literal|0
expr_stmt|;
name|item
operator|->
name|setPos
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|scene
operator|.
name|drawCount
operator|>
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|compositionModeInDrawBackground
name|void
name|tst_QGraphicsView
operator|::
name|compositionModeInDrawBackground
parameter_list|()
block|{
class|class
name|MyView
super|:
specifier|public
name|QGraphicsView
block|{
public|public:
name|MyView
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|)
member_init_list|:
name|QGraphicsView
argument_list|(
name|scene
argument_list|)
member_init_list|,
name|painted
argument_list|(
literal|false
argument_list|)
member_init_list|,
name|compositionMode
argument_list|(
name|QPainter
operator|::
name|CompositionMode_SourceOver
argument_list|)
block|{}
name|bool
name|painted
decl_stmt|;
name|QPainter
operator|::
name|CompositionMode
name|compositionMode
decl_stmt|;
name|void
name|drawBackground
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QRectF
modifier|&
parameter_list|)
block|{
name|compositionMode
operator|=
name|painter
operator|->
name|compositionMode
argument_list|()
expr_stmt|;
name|painted
operator|=
literal|true
expr_stmt|;
block|}
block|}
class|;
name|QGraphicsScene
name|dummy
decl_stmt|;
name|MyView
name|view
argument_list|(
operator|&
name|dummy
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
comment|// Make sure the painter's composition mode is SourceOver in drawBackground.
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|painted
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|compositionMode
argument_list|,
name|QPainter
operator|::
name|CompositionMode_SourceOver
argument_list|)
expr_stmt|;
name|view
operator|.
name|painted
operator|=
literal|false
expr_stmt|;
name|view
operator|.
name|setCacheMode
argument_list|(
name|QGraphicsView
operator|::
name|CacheBackground
argument_list|)
expr_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|update
argument_list|()
expr_stmt|;
comment|// Make sure the painter's composition mode is SourceOver in drawBackground
comment|// with background cache enabled.
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|painted
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|compositionMode
argument_list|,
name|QPainter
operator|::
name|CompositionMode_SourceOver
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task253415_reconnectUpdateSceneOnSceneChanged
name|void
name|tst_QGraphicsView
operator|::
name|task253415_reconnectUpdateSceneOnSceneChanged
parameter_list|()
block|{
name|QGraphicsView
name|view
decl_stmt|;
name|QGraphicsView
name|dummyView
decl_stmt|;
name|view
operator|.
name|setWindowFlags
argument_list|(
name|view
operator|.
name|windowFlags
argument_list|()
operator||
name|Qt
operator|::
name|WindowStaysOnTopHint
argument_list|)
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene1
decl_stmt|;
name|QObject
operator|::
name|connect
argument_list|(
operator|&
name|scene1
argument_list|,
name|SIGNAL
argument_list|(
name|changed
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|)
argument_list|)
argument_list|,
operator|&
name|dummyView
argument_list|,
name|SLOT
argument_list|(
name|updateScene
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|12
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene2
decl_stmt|;
name|QObject
operator|::
name|connect
argument_list|(
operator|&
name|scene2
argument_list|,
name|SIGNAL
argument_list|(
name|changed
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|)
argument_list|)
argument_list|,
operator|&
name|dummyView
argument_list|,
name|SLOT
argument_list|(
name|updateScene
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene2
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|12
argument_list|)
expr_stmt|;
name|bool
name|wasConnected2
init|=
name|QObject
operator|::
name|disconnect
argument_list|(
operator|&
name|scene2
argument_list|,
name|SIGNAL
argument_list|(
name|changed
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|)
argument_list|)
argument_list|,
operator|&
name|view
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|wasConnected2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task255529_transformationAnchorMouseAndViewportMargins
name|void
name|tst_QGraphicsView
operator|::
name|task255529_transformationAnchorMouseAndViewportMargins
parameter_list|()
block|{
if|#
directive|if
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
name|QSKIP
argument_list|(
literal|"Qt/CE does not implement mouse tracking at this point"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
expr_stmt|;
class|class
name|VpGraphicsView
super|:
specifier|public
name|QGraphicsView
block|{
public|public:
name|VpGraphicsView
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|,
name|QWidget
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsView
argument_list|(
name|scene
argument_list|,
name|parent
argument_list|)
block|{
name|setViewportMargins
argument_list|(
literal|8
argument_list|,
literal|16
argument_list|,
literal|12
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|setTransformationAnchor
argument_list|(
name|QGraphicsView
operator|::
name|AnchorUnderMouse
argument_list|)
expr_stmt|;
name|setMouseTracking
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
block|}
class|;
name|VpGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setWindowFlags
argument_list|(
name|Qt
operator|::
name|X11BypassWindowManagerHint
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
comment|// This is highly unstable (observed to pass on Windows and some Linux configurations).
ifndef|#
directive|ifndef
name|Q_OS_MAC
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
operator|++
name|i
control|)
block|{
name|QPoint
name|mouseViewPos
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|mouseViewPos
argument_list|)
expr_stmt|;
name|QPointF
name|mouseScenePos
init|=
name|view
operator|.
name|mapToScene
argument_list|(
name|mouseViewPos
argument_list|)
decl_stmt|;
name|view
operator|.
name|setTransform
argument_list|(
name|QTransform
argument_list|()
operator|.
name|scale
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
operator|.
name|rotate
argument_list|(
literal|5
argument_list|,
name|Qt
operator|::
name|ZAxis
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|qreal
name|slack
init|=
literal|1
decl_stmt|;
name|QPointF
name|newMouseScenePos
init|=
name|view
operator|.
name|mapToScene
argument_list|(
name|mouseViewPos
argument_list|)
decl_stmt|;
specifier|const
name|qreal
name|dx
init|=
name|qAbs
argument_list|(
name|newMouseScenePos
operator|.
name|x
argument_list|()
operator|-
name|mouseScenePos
operator|.
name|x
argument_list|()
argument_list|)
decl_stmt|;
specifier|const
name|qreal
name|dy
init|=
name|qAbs
argument_list|(
name|newMouseScenePos
operator|.
name|y
argument_list|()
operator|-
name|mouseScenePos
operator|.
name|y
argument_list|()
argument_list|)
decl_stmt|;
specifier|const
name|QByteArray
name|message
init|=
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"QTBUG-22455, distance: dx=%1, dy=%2 slack=%3 (%4)."
argument_list|)
operator|.
name|arg
argument_list|(
name|dx
argument_list|)
operator|.
name|arg
argument_list|(
name|dy
argument_list|)
operator|.
name|arg
argument_list|(
name|slack
argument_list|)
operator|.
name|arg
argument_list|(
name|qApp
operator|->
name|style
argument_list|()
operator|->
name|metaObject
argument_list|()
operator|->
name|className
argument_list|()
argument_list|)
operator|.
name|toLocal8Bit
argument_list|()
decl_stmt|;
if|if
condition|(
name|i
operator|==
literal|9
operator|||
operator|(
name|dx
operator|<
name|slack
operator|&&
name|dy
operator|<
name|slack
operator|)
condition|)
block|{
name|QVERIFY2
argument_list|(
name|dx
operator|<
name|slack
operator|&&
name|dy
operator|<
name|slack
argument_list|,
name|message
operator|.
name|constData
argument_list|()
argument_list|)
expr_stmt|;
break|break;
block|}
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
block|}
end_function
begin_function
DECL|function|task259503_scrollingArtifacts
name|void
name|tst_QGraphicsView
operator|::
name|task259503_scrollingArtifacts
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|800
argument_list|,
literal|600
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
name|card
decl_stmt|;
name|card
operator|.
name|setRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|card
operator|.
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|darkRed
argument_list|)
argument_list|)
expr_stmt|;
name|card
operator|.
name|setBrush
argument_list|(
name|QBrush
argument_list|(
name|Qt
operator|::
name|cyan
argument_list|)
argument_list|)
expr_stmt|;
name|card
operator|.
name|setZValue
argument_list|(
literal|2.0
argument_list|)
expr_stmt|;
name|card
operator|.
name|setPos
argument_list|(
literal|300
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|card
argument_list|)
expr_stmt|;
class|class
name|SAGraphicsView
super|:
specifier|public
name|QGraphicsView
block|{
public|public:
name|SAGraphicsView
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|)
member_init_list|:
name|QGraphicsView
argument_list|(
name|scene
argument_list|)
member_init_list|,
name|itSTimeToTest
argument_list|(
literal|false
argument_list|)
block|{
name|setViewportUpdateMode
argument_list|(
name|QGraphicsView
operator|::
name|MinimalViewportUpdate
argument_list|)
expr_stmt|;
name|resize
argument_list|(
name|QSize
argument_list|(
literal|640
argument_list|,
literal|480
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|QRegion
name|updateRegion
decl_stmt|;
name|bool
name|itSTimeToTest
decl_stmt|;
name|void
name|paintEvent
parameter_list|(
name|QPaintEvent
modifier|*
name|event
parameter_list|)
block|{
name|QGraphicsView
operator|::
name|paintEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
if|if
condition|(
name|itSTimeToTest
condition|)
block|{
name|QEXPECT_FAIL
argument_list|(
literal|""
argument_list|,
literal|"QTBUG-24296"
argument_list|,
name|Continue
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|event
operator|->
name|region
argument_list|()
argument_list|,
name|updateRegion
argument_list|)
expr_stmt|;
block|}
block|}
block|}
class|;
name|SAGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|int
name|hsbValue
init|=
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
decl_stmt|;
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|setValue
argument_list|(
name|hsbValue
operator|/
literal|2
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|setValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QRect
name|itemDeviceBoundingRect
init|=
name|card
operator|.
name|deviceTransform
argument_list|(
name|view
operator|.
name|viewportTransform
argument_list|()
argument_list|)
operator|.
name|mapRect
argument_list|(
name|card
operator|.
name|boundingRect
argument_list|()
argument_list|)
operator|.
name|toRect
argument_list|()
decl_stmt|;
name|itemDeviceBoundingRect
operator|.
name|adjust
argument_list|(
operator|-
literal|2
argument_list|,
operator|-
literal|2
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|view
operator|.
name|updateRegion
operator|=
name|itemDeviceBoundingRect
expr_stmt|;
name|view
operator|.
name|updateRegion
operator|+=
name|itemDeviceBoundingRect
operator|.
name|translated
argument_list|(
operator|-
literal|100
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|itSTimeToTest
operator|=
literal|true
expr_stmt|;
name|card
operator|.
name|setPos
argument_list|(
literal|200
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|QTBUG_4151_clipAndIgnore_data
name|void
name|tst_QGraphicsView
operator|::
name|QTBUG_4151_clipAndIgnore_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"clip"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"ignoreTransformations"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"numItems"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"none"
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
operator|<<
literal|3
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"clip"
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
operator|<<
literal|3
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"ignore"
argument_list|)
operator|<<
literal|false
operator|<<
literal|true
operator|<<
literal|3
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"clip+ignore"
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
operator|<<
literal|3
expr_stmt|;
block|}
end_function
begin_function
DECL|function|QTBUG_4151_clipAndIgnore
name|void
name|tst_QGraphicsView
operator|::
name|QTBUG_4151_clipAndIgnore
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|clip
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|ignoreTransformations
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|numItems
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|child
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|40
argument_list|,
literal|40
argument_list|)
argument_list|,
name|parent
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|ignore
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|60
argument_list|,
literal|60
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
literal|0
argument_list|)
decl_stmt|;
if|if
condition|(
name|clip
condition|)
name|parent
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
if|if
condition|(
name|ignoreTransformations
condition|)
name|ignore
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIgnoresTransformations
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|child
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|,
literal|128
argument_list|)
argument_list|)
expr_stmt|;
name|ignore
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|ignore
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFrameStyle
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|75
argument_list|,
literal|75
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|view
operator|.
name|activateWindow
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
operator|(
name|QWidget
operator|*
operator|)
operator|&
name|view
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|items
argument_list|(
name|view
operator|.
name|rect
argument_list|()
argument_list|)
operator|.
name|size
argument_list|()
argument_list|,
name|numItems
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|QTBUG_5859_exposedRect
name|void
name|tst_QGraphicsView
operator|::
name|QTBUG_5859_exposedRect
parameter_list|()
block|{
class|class
name|CustomScene
super|:
specifier|public
name|QGraphicsScene
block|{
public|public:
name|CustomScene
parameter_list|(
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|)
member_init_list|:
name|QGraphicsScene
argument_list|(
name|rect
argument_list|)
block|{ }
name|void
name|drawBackground
parameter_list|(
name|QPainter
modifier|*
comment|/* painter */
parameter_list|,
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|)
block|{
name|lastBackgroundExposedRect
operator|=
name|rect
expr_stmt|;
block|}
name|QRectF
name|lastBackgroundExposedRect
decl_stmt|;
block|}
class|;
class|class
name|CustomRectItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
name|CustomRectItem
parameter_list|(
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|)
block|{
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemUsesExtendedStyleOption
argument_list|)
expr_stmt|;
block|}
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
comment|/* painter */
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
comment|/* widget */
init|=
literal|0
parameter_list|)
block|{
name|lastExposedRect
operator|=
name|option
operator|->
name|exposedRect
expr_stmt|;
block|}
name|QRectF
name|lastExposedRect
decl_stmt|;
block|}
class|;
name|CustomScene
name|scene
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
decl_stmt|;
name|CustomRectItem
name|item
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|item
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|scale
argument_list|(
literal|4.15
argument_list|,
literal|4.15
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|repaint
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|lastExposedRect
argument_list|,
name|scene
operator|.
name|lastBackgroundExposedRect
argument_list|)
expr_stmt|;
block|}
end_function
begin_ifndef
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
end_ifndef
begin_function
DECL|function|QTBUG_7438_cursor
name|void
name|tst_QGraphicsView
operator|::
name|QTBUG_7438_cursor
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|400
argument_list|,
literal|400
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|QCursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|setCursor
argument_list|(
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
name|sendMousePress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
name|sendMouseRelease
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_class
DECL|class|GraphicsItemWithHover
class|class
name|GraphicsItemWithHover
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|GraphicsItemWithHover
name|GraphicsItemWithHover
parameter_list|()
member_init_list|:
name|receivedEnterEvent
argument_list|(
literal|false
argument_list|)
member_init_list|,
name|receivedLeaveEvent
argument_list|(
literal|false
argument_list|)
member_init_list|,
name|enterWidget
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|leaveWidget
argument_list|(
literal|0
argument_list|)
block|{
name|setRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|setAcceptHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
DECL|function|sceneEvent
name|bool
name|sceneEvent
parameter_list|(
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
name|event
operator|->
name|type
argument_list|()
operator|==
name|QEvent
operator|::
name|GraphicsSceneHoverEnter
condition|)
block|{
name|receivedEnterEvent
operator|=
literal|true
expr_stmt|;
name|enterWidget
operator|=
cast|static_cast
argument_list|<
name|QGraphicsSceneHoverEvent
operator|*
argument_list|>
argument_list|(
name|event
argument_list|)
operator|->
name|widget
argument_list|()
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|event
operator|->
name|type
argument_list|()
operator|==
name|QEvent
operator|::
name|GraphicsSceneHoverLeave
condition|)
block|{
name|receivedLeaveEvent
operator|=
literal|true
expr_stmt|;
name|leaveWidget
operator|=
cast|static_cast
argument_list|<
name|QGraphicsSceneHoverEvent
operator|*
argument_list|>
argument_list|(
name|event
argument_list|)
operator|->
name|widget
argument_list|()
expr_stmt|;
block|}
return|return
name|QGraphicsRectItem
operator|::
name|sceneEvent
argument_list|(
name|event
argument_list|)
return|;
block|}
DECL|member|receivedEnterEvent
name|bool
name|receivedEnterEvent
decl_stmt|;
DECL|member|receivedLeaveEvent
name|bool
name|receivedLeaveEvent
decl_stmt|;
DECL|member|enterWidget
name|QWidget
modifier|*
name|enterWidget
decl_stmt|;
DECL|member|leaveWidget
name|QWidget
modifier|*
name|leaveWidget
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|hoverLeave
name|void
name|tst_QGraphicsView
operator|::
name|hoverLeave
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|GraphicsItemWithHover
modifier|*
name|item
init|=
operator|new
name|GraphicsItemWithHover
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
comment|// move the cursor out of the way
name|QCursor
operator|::
name|setPos
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QPoint
name|pos
init|=
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QCursor
operator|::
name|setPos
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|receivedEnterEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|enterWidget
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
argument_list|)
expr_stmt|;
name|QCursor
operator|::
name|setPos
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|200
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|Q_OS_MAC
name|QEXPECT_FAIL
argument_list|(
literal|""
argument_list|,
literal|"QTBUG-26274 - behaviour regression"
argument_list|,
name|Abort
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QVERIFY
argument_list|(
name|item
operator|->
name|receivedLeaveEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|leaveWidget
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|IMItem
class|class
name|IMItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|IMItem
name|IMItem
parameter_list|(
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|,
name|parent
argument_list|)
block|{
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemAcceptsInputMethod
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
DECL|function|inputMethodQuery
name|QVariant
name|inputMethodQuery
parameter_list|(
name|Qt
operator|::
name|InputMethodQuery
parameter_list|)
specifier|const
block|{
return|return
name|mf
return|;
block|}
DECL|member|mf
specifier|static
name|QRectF
name|mf
decl_stmt|;
block|}
class|;
end_class
begin_decl_stmt
name|QRectF
name|IMItem
operator|::
name|mf
argument_list|(
literal|1.5
argument_list|,
literal|1.6
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
end_decl_stmt
begin_function
DECL|function|QTBUG_16063_microFocusRect
name|void
name|tst_QGraphicsView
operator|::
name|QTBUG_16063_microFocusRect
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|IMItem
modifier|*
name|item
init|=
operator|new
name|IMItem
argument_list|()
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|QRectF
name|mfv
init|=
name|view
operator|.
name|inputMethodQuery
argument_list|(
name|Qt
operator|::
name|ImMicroFocus
argument_list|)
operator|.
name|toRectF
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|mfv
argument_list|,
name|IMItem
operator|::
name|mf
operator|.
name|translated
argument_list|(
operator|-
name|view
operator|.
name|mapToScene
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
operator|.
name|toRect
argument_list|()
argument_list|)
operator|.
name|boundingRect
argument_list|()
operator|.
name|topLeft
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_macro
name|QTEST_MAIN
argument_list|(
argument|tst_QGraphicsView
argument_list|)
end_macro
begin_include
include|#
directive|include
file|"tst_qgraphicsview.moc"
end_include
end_unit
