begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2013 Digia Plc and/or its subsidiary(-ies). ** Contact: http://www.qt-project.org/legal ** ** This file is part of the test suite of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL$ ** Commercial License Usage ** Licensees holding valid commercial Qt licenses may use this file in ** accordance with the commercial license agreement provided with the ** Software or, alternatively, in accordance with the terms contained in ** a written agreement between you and Digia.  For licensing terms and ** conditions see http://qt.digia.com/licensing.  For further information ** use the contact form at http://qt.digia.com/contact-us. ** ** GNU Lesser General Public License Usage ** Alternatively, this file may be used under the terms of the GNU Lesser ** General Public License version 2.1 as published by the Free Software ** Foundation and appearing in the file LICENSE.LGPL included in the ** packaging of this file.  Please review the following information to ** ensure the GNU Lesser General Public License version 2.1 requirements ** will be met: http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html. ** ** In addition, as a special exception, Digia gives you certain additional ** rights.  These rights are described in the Digia Qt LGPL Exception ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package. ** ** GNU General Public License Usage ** Alternatively, this file may be used under the terms of the GNU ** General Public License version 3.0 as published by the Free Software ** Foundation and appearing in the file LICENSE.GPL included in the ** packaging of this file.  Please review the following information to ** ensure the GNU General Public License version 3.0 requirements will be ** met: http://www.gnu.org/copyleft/gpl.html. ** ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<QtTest/QtTest>
end_include
begin_include
include|#
directive|include
file|<qgraphicswidget.h>
end_include
begin_include
include|#
directive|include
file|<qgraphicsscene.h>
end_include
begin_include
include|#
directive|include
file|<qgraphicssceneevent.h>
end_include
begin_include
include|#
directive|include
file|<qgraphicsview.h>
end_include
begin_include
include|#
directive|include
file|<qstyleoption.h>
end_include
begin_include
include|#
directive|include
file|<qgraphicslinearlayout.h>
end_include
begin_include
include|#
directive|include
file|<qlineedit.h>
end_include
begin_include
include|#
directive|include
file|<qboxlayout.h>
end_include
begin_include
include|#
directive|include
file|<qaction.h>
end_include
begin_include
include|#
directive|include
file|<qwidgetaction.h>
end_include
begin_include
include|#
directive|include
file|<qcommonstyle.h>
end_include
begin_include
include|#
directive|include
file|<qstylefactory.h>
end_include
begin_include
include|#
directive|include
file|<qscreen.h>
end_include
begin_include
include|#
directive|include
file|"../../../qtest-config.h"
end_include
begin_class
DECL|class|EventSpy
class|class
name|EventSpy
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
public|public:
DECL|function|EventSpy
name|EventSpy
parameter_list|(
name|QObject
modifier|*
name|watched
parameter_list|,
name|QEvent
operator|::
name|Type
name|type
parameter_list|)
member_init_list|:
name|_count
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|spied
argument_list|(
name|type
argument_list|)
block|{
name|watched
operator|->
name|installEventFilter
argument_list|(
name|this
argument_list|)
expr_stmt|;
block|}
DECL|function|count
name|int
name|count
parameter_list|()
specifier|const
block|{
return|return
name|_count
return|;
block|}
protected|protected:
DECL|function|eventFilter
name|bool
name|eventFilter
parameter_list|(
name|QObject
modifier|*
name|watched
parameter_list|,
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
name|Q_UNUSED
argument_list|(
name|watched
argument_list|)
expr_stmt|;
if|if
condition|(
name|event
operator|->
name|type
argument_list|()
operator|==
name|spied
condition|)
operator|++
name|_count
expr_stmt|;
return|return
literal|false
return|;
block|}
DECL|member|_count
name|int
name|_count
decl_stmt|;
DECL|member|spied
name|QEvent
operator|::
name|Type
name|spied
decl_stmt|;
block|}
class|;
end_class
begin_class
DECL|class|tst_QGraphicsWidget
class|class
name|tst_QGraphicsWidget
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
public|public
name|slots
public|:
name|void
name|initTestCase
parameter_list|()
function_decl|;
name|void
name|cleanupTestCase
parameter_list|()
function_decl|;
name|void
name|init
parameter_list|()
function_decl|;
name|void
name|cleanup
parameter_list|()
function_decl|;
private|private
name|slots
private|:
name|void
name|qgraphicswidget
parameter_list|()
function_decl|;
name|void
name|activation
parameter_list|()
function_decl|;
name|void
name|boundingRect_data
parameter_list|()
function_decl|;
name|void
name|boundingRect
parameter_list|()
function_decl|;
name|void
name|dumpFocusChain_data
parameter_list|()
function_decl|;
name|void
name|dumpFocusChain
parameter_list|()
function_decl|;
name|void
name|focusWidget_data
parameter_list|()
function_decl|;
name|void
name|focusWidget
parameter_list|()
function_decl|;
name|void
name|focusWidget2
parameter_list|()
function_decl|;
name|void
name|focusWidget3
parameter_list|()
function_decl|;
name|void
name|focusPolicy_data
parameter_list|()
function_decl|;
name|void
name|focusPolicy
parameter_list|()
function_decl|;
name|void
name|font_data
parameter_list|()
function_decl|;
name|void
name|font
parameter_list|()
function_decl|;
name|void
name|fontPropagation
parameter_list|()
function_decl|;
name|void
name|fontChangedEvent
parameter_list|()
function_decl|;
name|void
name|fontPropagationWidgetItemWidget
parameter_list|()
function_decl|;
name|void
name|fontPropagationSceneChange
parameter_list|()
function_decl|;
name|void
name|geometry_data
parameter_list|()
function_decl|;
name|void
name|geometry
parameter_list|()
function_decl|;
name|void
name|geometryChanged
parameter_list|()
function_decl|;
name|void
name|width
parameter_list|()
function_decl|;
name|void
name|height
parameter_list|()
function_decl|;
name|void
name|getContentsMargins_data
parameter_list|()
function_decl|;
name|void
name|getContentsMargins
parameter_list|()
function_decl|;
name|void
name|initStyleOption_data
parameter_list|()
function_decl|;
name|void
name|initStyleOption
parameter_list|()
function_decl|;
name|void
name|layout_data
parameter_list|()
function_decl|;
name|void
name|layout
parameter_list|()
function_decl|;
name|void
name|layoutDirection_data
parameter_list|()
function_decl|;
name|void
name|layoutDirection
parameter_list|()
function_decl|;
name|void
name|paint_data
parameter_list|()
function_decl|;
name|void
name|paint
parameter_list|()
function_decl|;
name|void
name|palettePropagation
parameter_list|()
function_decl|;
name|void
name|parentWidget_data
parameter_list|()
function_decl|;
name|void
name|parentWidget
parameter_list|()
function_decl|;
name|void
name|resize_data
parameter_list|()
function_decl|;
name|void
name|resize
parameter_list|()
function_decl|;
name|void
name|setAttribute_data
parameter_list|()
function_decl|;
name|void
name|setAttribute
parameter_list|()
function_decl|;
name|void
name|setStyle_data
parameter_list|()
function_decl|;
name|void
name|setStyle
parameter_list|()
function_decl|;
name|void
name|setTabOrder_data
parameter_list|()
function_decl|;
name|void
name|setTabOrder
parameter_list|()
function_decl|;
name|void
name|setTabOrderAndReparent
parameter_list|()
function_decl|;
name|void
name|topLevelWidget_data
parameter_list|()
function_decl|;
name|void
name|topLevelWidget
parameter_list|()
function_decl|;
name|void
name|unsetLayoutDirection_data
parameter_list|()
function_decl|;
name|void
name|unsetLayoutDirection
parameter_list|()
function_decl|;
name|void
name|focusNextPrevChild_data
parameter_list|()
function_decl|;
name|void
name|focusNextPrevChild
parameter_list|()
function_decl|;
name|void
name|verifyFocusChain
parameter_list|()
function_decl|;
name|void
name|updateFocusChainWhenChildDie
parameter_list|()
function_decl|;
name|void
name|sizeHint_data
parameter_list|()
function_decl|;
name|void
name|sizeHint
parameter_list|()
function_decl|;
name|void
name|consistentPosSizeGeometry_data
parameter_list|()
function_decl|;
name|void
name|consistentPosSizeGeometry
parameter_list|()
function_decl|;
name|void
name|setSizes_data
parameter_list|()
function_decl|;
name|void
name|setSizes
parameter_list|()
function_decl|;
name|void
name|closePopupOnOutsideClick
parameter_list|()
function_decl|;
name|void
name|defaultSize
parameter_list|()
function_decl|;
name|void
name|explicitMouseGrabber
parameter_list|()
function_decl|;
name|void
name|implicitMouseGrabber
parameter_list|()
function_decl|;
name|void
name|doubleClickAfterExplicitMouseGrab
parameter_list|()
function_decl|;
name|void
name|popupMouseGrabber
parameter_list|()
function_decl|;
name|void
name|windowFlags_data
parameter_list|()
function_decl|;
name|void
name|windowFlags
parameter_list|()
function_decl|;
name|void
name|shortcutsDeletion
parameter_list|()
function_decl|;
name|void
name|painterStateProtectionOnWindowFrame
parameter_list|()
function_decl|;
name|void
name|ensureClipping
parameter_list|()
function_decl|;
name|void
name|widgetSendsGeometryChanges
parameter_list|()
function_decl|;
name|void
name|respectHFW
parameter_list|()
function_decl|;
name|void
name|addChildInpolishEvent
parameter_list|()
function_decl|;
name|void
name|polishEvent
parameter_list|()
function_decl|;
name|void
name|polishEvent2
parameter_list|()
function_decl|;
name|void
name|autoFillBackground
parameter_list|()
function_decl|;
name|void
name|initialShow
parameter_list|()
function_decl|;
name|void
name|initialShow2
parameter_list|()
function_decl|;
name|void
name|itemChangeEvents
parameter_list|()
function_decl|;
name|void
name|itemSendGeometryPosChangesDeactivated
parameter_list|()
function_decl|;
name|void
name|fontPropagatesResolveToChildren
parameter_list|()
function_decl|;
name|void
name|fontPropagatesResolveToGrandChildren
parameter_list|()
function_decl|;
name|void
name|fontPropagatesResolveInParentChange
parameter_list|()
function_decl|;
name|void
name|fontPropagatesResolveViaNonWidget
parameter_list|()
function_decl|;
name|void
name|fontPropagatesResolveFromScene
parameter_list|()
function_decl|;
name|void
name|tabFocus
parameter_list|()
function_decl|;
comment|// Task fixes
name|void
name|task236127_bspTreeIndexFails
parameter_list|()
function_decl|;
name|void
name|task243004_setStyleCrash
parameter_list|()
function_decl|;
name|void
name|task250119_shortcutContext
parameter_list|()
function_decl|;
name|void
name|QT_BUG_6544_tabFocusFirstUnsetWhenRemovingItems
parameter_list|()
function_decl|;
name|void
name|QT_BUG_12056_tabFocusFirstUnsetWhenRemovingItems
parameter_list|()
function_decl|;
block|}
class|;
end_class
begin_function
DECL|function|sendMouseMove
specifier|static
name|void
name|sendMouseMove
parameter_list|(
name|QWidget
modifier|*
name|widget
parameter_list|,
specifier|const
name|QPoint
modifier|&
name|point
parameter_list|,
name|Qt
operator|::
name|MouseButton
name|button
init|=
name|Qt
operator|::
name|NoButton
parameter_list|,
name|Qt
operator|::
name|MouseButtons
name|buttons
init|=
literal|0
parameter_list|)
block|{
name|QTest
operator|::
name|mouseMove
argument_list|(
name|widget
argument_list|,
name|point
argument_list|)
expr_stmt|;
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|point
argument_list|,
name|button
argument_list|,
name|buttons
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|widget
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// Subclass that exposes the protected functions.
end_comment
begin_class
DECL|class|SubQGraphicsWidget
class|class
name|SubQGraphicsWidget
super|:
specifier|public
name|QGraphicsWidget
block|{
public|public:
DECL|function|SubQGraphicsWidget
name|SubQGraphicsWidget
parameter_list|(
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|,
name|Qt
operator|::
name|WindowFlags
name|windowFlags
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsWidget
argument_list|(
name|parent
argument_list|,
name|windowFlags
argument_list|)
member_init_list|,
name|eventCount
argument_list|(
literal|0
argument_list|)
block|{ }
DECL|function|initStyleOption
name|void
name|initStyleOption
parameter_list|(
name|QStyleOption
modifier|*
name|option
parameter_list|)
block|{
name|QGraphicsWidget
operator|::
name|initStyleOption
argument_list|(
name|option
argument_list|)
expr_stmt|;
block|}
DECL|function|call_changeEvent
name|void
name|call_changeEvent
parameter_list|(
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
return|return
name|QGraphicsWidget
operator|::
name|changeEvent
argument_list|(
name|event
argument_list|)
return|;
block|}
DECL|function|call_event
name|bool
name|call_event
parameter_list|(
name|QEvent
modifier|*
name|e
parameter_list|)
block|{
return|return
name|event
argument_list|(
name|e
argument_list|)
return|;
block|}
DECL|function|call_focusInEvent
name|void
name|call_focusInEvent
parameter_list|(
name|QFocusEvent
modifier|*
name|event
parameter_list|)
block|{
return|return
name|QGraphicsWidget
operator|::
name|focusInEvent
argument_list|(
name|event
argument_list|)
return|;
block|}
DECL|function|call_focusNextPrevChild
name|bool
name|call_focusNextPrevChild
parameter_list|(
name|bool
name|next
parameter_list|)
block|{
return|return
name|QGraphicsWidget
operator|::
name|focusNextPrevChild
argument_list|(
name|next
argument_list|)
return|;
block|}
DECL|function|call_focusOutEvent
name|void
name|call_focusOutEvent
parameter_list|(
name|QFocusEvent
modifier|*
name|event
parameter_list|)
block|{
return|return
name|QGraphicsWidget
operator|::
name|focusOutEvent
argument_list|(
name|event
argument_list|)
return|;
block|}
DECL|function|call_hideEvent
name|void
name|call_hideEvent
parameter_list|(
name|QHideEvent
modifier|*
name|event
parameter_list|)
block|{
return|return
name|QGraphicsWidget
operator|::
name|hideEvent
argument_list|(
name|event
argument_list|)
return|;
block|}
DECL|function|call_itemChange
name|QVariant
name|call_itemChange
parameter_list|(
name|QGraphicsItem
operator|::
name|GraphicsItemChange
name|change
parameter_list|,
name|QVariant
specifier|const
modifier|&
name|value
parameter_list|)
block|{
return|return
name|QGraphicsWidget
operator|::
name|itemChange
argument_list|(
name|change
argument_list|,
name|value
argument_list|)
return|;
block|}
DECL|function|call_moveEvent
name|void
name|call_moveEvent
parameter_list|(
name|QGraphicsSceneMoveEvent
modifier|*
name|event
parameter_list|)
block|{
return|return
name|QGraphicsWidget
operator|::
name|moveEvent
argument_list|(
name|event
argument_list|)
return|;
block|}
DECL|function|call_polishEvent
name|void
name|call_polishEvent
parameter_list|()
block|{
return|return
name|QGraphicsWidget
operator|::
name|polishEvent
argument_list|()
return|;
block|}
DECL|function|call_propertyChange
name|QVariant
name|call_propertyChange
parameter_list|(
name|QString
specifier|const
modifier|&
name|propertyName
parameter_list|,
name|QVariant
specifier|const
modifier|&
name|value
parameter_list|)
block|{
return|return
name|QGraphicsWidget
operator|::
name|propertyChange
argument_list|(
name|propertyName
argument_list|,
name|value
argument_list|)
return|;
block|}
DECL|function|call_resizeEvent
name|void
name|call_resizeEvent
parameter_list|(
name|QGraphicsSceneResizeEvent
modifier|*
name|event
parameter_list|)
block|{
return|return
name|QGraphicsWidget
operator|::
name|resizeEvent
argument_list|(
name|event
argument_list|)
return|;
block|}
DECL|function|call_sceneEvent
name|bool
name|call_sceneEvent
parameter_list|(
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
return|return
name|QGraphicsWidget
operator|::
name|sceneEvent
argument_list|(
name|event
argument_list|)
return|;
block|}
DECL|function|call_showEvent
name|void
name|call_showEvent
parameter_list|(
name|QShowEvent
modifier|*
name|event
parameter_list|)
block|{
return|return
name|QGraphicsWidget
operator|::
name|showEvent
argument_list|(
name|event
argument_list|)
return|;
block|}
DECL|function|call_sizeHint
name|QSizeF
name|call_sizeHint
parameter_list|(
name|Qt
operator|::
name|SizeHint
name|which
parameter_list|,
name|QSizeF
specifier|const
modifier|&
name|constraint
init|=
name|QSizeF
argument_list|()
parameter_list|)
specifier|const
block|{
return|return
name|QGraphicsWidget
operator|::
name|sizeHint
argument_list|(
name|which
argument_list|,
name|constraint
argument_list|)
return|;
block|}
DECL|function|call_updateGeometry
name|void
name|call_updateGeometry
parameter_list|()
block|{
return|return
name|QGraphicsWidget
operator|::
name|updateGeometry
argument_list|()
return|;
block|}
DECL|member|eventCount
name|int
name|eventCount
decl_stmt|;
DECL|member|m_painterLayoutDirection
name|Qt
operator|::
name|LayoutDirection
name|m_painterLayoutDirection
decl_stmt|;
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
name|widget
parameter_list|)
block|{
name|m_painterLayoutDirection
operator|=
name|painter
operator|->
name|layoutDirection
argument_list|()
expr_stmt|;
name|QGraphicsWidget
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|widget
argument_list|)
expr_stmt|;
if|if
condition|(
name|hasFocus
argument_list|()
condition|)
block|{
name|painter
operator|->
name|setPen
argument_list|(
name|Qt
operator|::
name|DotLine
argument_list|)
expr_stmt|;
name|painter
operator|->
name|drawRect
argument_list|(
name|rect
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|//painter->drawText(QPointF(0,15), data(0).toString());
block|}
protected|protected:
DECL|function|event
name|bool
name|event
parameter_list|(
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
name|eventCount
operator|++
expr_stmt|;
return|return
name|QGraphicsWidget
operator|::
name|event
argument_list|(
name|event
argument_list|)
return|;
block|}
block|}
class|;
end_class
begin_comment
comment|// This will be called before the first test function is executed.
end_comment
begin_comment
comment|// It is only called once.
end_comment
begin_function
DECL|function|initTestCase
name|void
name|tst_QGraphicsWidget
operator|::
name|initTestCase
parameter_list|()
block|{ }
end_function
begin_comment
comment|// This will be called after the last test function is executed.
end_comment
begin_comment
comment|// It is only called once.
end_comment
begin_function
DECL|function|cleanupTestCase
name|void
name|tst_QGraphicsWidget
operator|::
name|cleanupTestCase
parameter_list|()
block|{ }
end_function
begin_comment
comment|// This will be called before each test function is executed.
end_comment
begin_function
DECL|function|init
name|void
name|tst_QGraphicsWidget
operator|::
name|init
parameter_list|()
block|{ }
end_function
begin_comment
comment|// This will be called after every test function.
end_comment
begin_function
DECL|function|cleanup
name|void
name|tst_QGraphicsWidget
operator|::
name|cleanup
parameter_list|()
block|{ }
end_function
begin_class
DECL|class|SizeHinter
class|class
name|SizeHinter
super|:
specifier|public
name|QGraphicsWidget
block|{
public|public:
DECL|function|SizeHinter
name|SizeHinter
parameter_list|(
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|,
name|Qt
operator|::
name|WindowFlags
name|wFlags
init|=
literal|0
parameter_list|,
specifier|const
name|QSizeF
modifier|&
name|min
init|=
name|QSizeF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
parameter_list|,
specifier|const
name|QSizeF
modifier|&
name|pref
init|=
name|QSizeF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
parameter_list|,
specifier|const
name|QSizeF
modifier|&
name|max
init|=
name|QSizeF
argument_list|(
literal|500
argument_list|,
literal|500
argument_list|)
parameter_list|)
member_init_list|:
name|QGraphicsWidget
argument_list|(
name|parent
argument_list|,
name|wFlags
argument_list|)
block|{
name|m_sizes
index|[
name|Qt
operator|::
name|MinimumSize
index|]
operator|=
name|min
expr_stmt|;
name|m_sizes
index|[
name|Qt
operator|::
name|PreferredSize
index|]
operator|=
name|pref
expr_stmt|;
name|m_sizes
index|[
name|Qt
operator|::
name|MaximumSize
index|]
operator|=
name|max
expr_stmt|;
block|}
DECL|function|setSizeHint
name|void
name|setSizeHint
parameter_list|(
name|Qt
operator|::
name|SizeHint
name|which
parameter_list|,
specifier|const
name|QSizeF
modifier|&
name|newSizeHint
parameter_list|)
block|{
name|m_sizes
index|[
name|which
index|]
operator|=
name|newSizeHint
expr_stmt|;
block|}
protected|protected:
DECL|function|sizeHint
name|QSizeF
name|sizeHint
parameter_list|(
name|Qt
operator|::
name|SizeHint
name|which
parameter_list|,
specifier|const
name|QSizeF
modifier|&
name|constraint
init|=
name|QSizeF
argument_list|()
parameter_list|)
specifier|const
block|{
name|Q_UNUSED
argument_list|(
name|constraint
argument_list|)
expr_stmt|;
return|return
name|m_sizes
index|[
name|which
index|]
return|;
block|}
private|private:
DECL|member|m_sizes
name|QSizeF
name|m_sizes
index|[
literal|4
index|]
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|qgraphicswidget
name|void
name|tst_QGraphicsWidget
operator|::
name|qgraphicswidget
parameter_list|()
block|{
name|SubQGraphicsWidget
name|widget
decl_stmt|;
name|QVERIFY
argument_list|(
name|widget
operator|.
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|widget
operator|.
name|isWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|focusWidget
argument_list|()
argument_list|,
operator|(
name|QGraphicsWidget
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|focusPolicy
argument_list|()
argument_list|,
name|Qt
operator|::
name|NoFocus
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|font
argument_list|()
argument_list|,
name|QFont
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|geometry
argument_list|()
argument_list|,
name|QRectF
argument_list|(
name|widget
operator|.
name|pos
argument_list|()
argument_list|,
name|widget
operator|.
name|size
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|layout
argument_list|()
argument_list|,
operator|(
name|QGraphicsLayout
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|layoutDirection
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftToRight
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|palette
argument_list|()
argument_list|,
name|QPalette
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|parentWidget
argument_list|()
argument_list|,
operator|(
name|QGraphicsWidget
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|rect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
name|QPointF
argument_list|()
argument_list|,
name|widget
operator|.
name|size
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|size
argument_list|()
argument_list|,
name|QSizeF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|widget
operator|.
name|style
argument_list|()
operator|!=
operator|(
name|QStyle
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_AcceptDrops
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|topLevelWidget
argument_list|()
argument_list|,
operator|(
name|QGraphicsWidget
operator|*
operator|)
operator|&
name|widget
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|type
argument_list|()
argument_list|,
operator|(
name|int
operator|)
name|QGraphicsWidget
operator|::
name|Type
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|call_propertyChange
argument_list|(
name|QString
argument_list|()
argument_list|,
name|QVariant
argument_list|()
argument_list|)
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|widget
operator|.
name|call_sizeHint
argument_list|(
name|Qt
operator|::
name|PreferredSize
argument_list|,
name|QSizeF
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|parent
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|SizeHinter
modifier|*
name|child
init|=
operator|new
name|SizeHinter
argument_list|(
name|parent
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|minimumSize
argument_list|()
argument_list|,
name|QSizeF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|activation
name|void
name|tst_QGraphicsWidget
operator|::
name|activation
parameter_list|()
block|{
name|QGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|window1
init|=
operator|new
name|QGraphicsWidget
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Window
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|window2
init|=
operator|new
name|QGraphicsWidget
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Window
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|widget
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|window1
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|window2
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|window1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|window2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|widget
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|window1
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|window2
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QEvent
name|activateEvent
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activateEvent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|widget
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|window1
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|window2
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setActiveWindow
argument_list|(
name|window1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|widget
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|window1
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|window2
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QEvent
name|deactivateEvent
argument_list|(
name|QEvent
operator|::
name|WindowDeactivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|deactivateEvent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|widget
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|window1
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|window2
operator|->
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|boundingRect_data
name|void
name|tst_QGraphicsWidget
operator|::
name|boundingRect_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QSizeF
argument_list|>
argument_list|(
literal|"size"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"null"
argument_list|)
operator|<<
name|QSizeF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"avg"
argument_list|)
operator|<<
name|QSizeF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// QRectF boundingRect() const public
end_comment
begin_function
DECL|function|boundingRect
name|void
name|tst_QGraphicsWidget
operator|::
name|boundingRect
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QSizeF
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
name|widget
decl_stmt|;
name|widget
operator|.
name|resize
argument_list|(
name|size
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|rect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
name|QPointF
argument_list|()
argument_list|,
name|size
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|size
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|dumpFocusChain_data
name|void
name|tst_QGraphicsWidget
operator|::
name|dumpFocusChain_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"scene"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"children"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"setFocus"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"empty world"
argument_list|)
operator|<<
literal|false
operator|<<
literal|0
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"one world"
argument_list|)
operator|<<
literal|true
operator|<<
literal|2
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"one world w/focus"
argument_list|)
operator|<<
literal|true
operator|<<
literal|2
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_comment
comment|// void dumpFocusChain(QGraphicsScene* scene) public (static)
end_comment
begin_function
DECL|function|dumpFocusChain
name|void
name|tst_QGraphicsWidget
operator|::
name|dumpFocusChain
parameter_list|()
block|{
comment|// ### this test is very strange...
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|scene
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
modifier|*
name|parent
init|=
operator|new
name|SubQGraphicsWidget
decl_stmt|;
name|QGraphicsScene
modifier|*
name|theScene
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|scene
condition|)
block|{
name|theScene
operator|=
operator|new
name|QGraphicsScene
argument_list|(
name|this
argument_list|)
expr_stmt|;
name|theScene
operator|->
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
block|}
name|QFETCH
argument_list|(
name|int
argument_list|,
name|children
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|setFocus
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|children
condition|;
operator|++
name|i
control|)
block|{
name|SubQGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|SubQGraphicsWidget
argument_list|(
name|parent
argument_list|)
decl_stmt|;
if|if
condition|(
name|setFocus
condition|)
block|{
name|widget
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|,
literal|true
argument_list|)
expr_stmt|;
if|if
condition|(
name|scene
condition|)
name|theScene
operator|->
name|setFocusItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
operator|!
name|scene
condition|)
operator|delete
name|parent
expr_stmt|;
block|}
end_function
begin_function
DECL|function|focusWidget_data
name|void
name|tst_QGraphicsWidget
operator|::
name|focusWidget_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"childCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"childWithFocus"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"none"
argument_list|)
operator|<<
literal|0
operator|<<
literal|0
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"first"
argument_list|)
operator|<<
literal|3
operator|<<
literal|0
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"last"
argument_list|)
operator|<<
literal|3
operator|<<
literal|2
expr_stmt|;
block|}
end_function
begin_comment
comment|// QGraphicsWidget* focusWidget() const public
end_comment
begin_function
DECL|function|focusWidget
name|void
name|tst_QGraphicsWidget
operator|::
name|focusWidget
parameter_list|()
block|{
name|SubQGraphicsWidget
modifier|*
name|parent
init|=
operator|new
name|SubQGraphicsWidget
decl_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|focusWidget
argument_list|()
argument_list|,
operator|(
name|QGraphicsWidget
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|windowActivate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|windowActivate
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|childCount
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|SubQGraphicsWidget
modifier|*
argument_list|>
name|children
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|childCount
condition|;
operator|++
name|i
control|)
block|{
name|SubQGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|SubQGraphicsWidget
argument_list|(
name|parent
argument_list|)
decl_stmt|;
name|widget
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|children
operator|.
name|append
argument_list|(
name|widget
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|childCount
operator|>
literal|0
condition|)
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|childWithFocus
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
modifier|*
name|widget
init|=
name|children
index|[
name|childWithFocus
index|]
decl_stmt|;
name|widget
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|widget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|focusWidget
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|focusWidget2
name|void
name|tst_QGraphicsWidget
operator|::
name|focusWidget2
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|windowActivate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|windowActivate
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|EventSpy
name|focusInSpy
argument_list|(
name|widget
argument_list|,
name|QEvent
operator|::
name|FocusIn
argument_list|)
decl_stmt|;
name|EventSpy
name|focusOutSpy
argument_list|(
name|widget
argument_list|,
name|QEvent
operator|::
name|FocusOut
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|widget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|widget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|subWidget
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|subWidget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|widget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|subWidget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|widget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|focusInSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|subWidget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|otherSubWidget
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|EventSpy
name|otherFocusInSpy
argument_list|(
name|otherSubWidget
argument_list|,
name|QEvent
operator|::
name|FocusIn
argument_list|)
decl_stmt|;
name|EventSpy
name|otherFocusOutSpy
argument_list|(
name|otherSubWidget
argument_list|,
name|QEvent
operator|::
name|FocusOut
argument_list|)
decl_stmt|;
name|otherSubWidget
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|otherSubWidget
operator|->
name|setParentItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|widget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|subWidget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|otherSubWidget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|widget
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|widget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// lose but still has subfocus
name|QCOMPARE
argument_list|(
name|focusInSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusOutSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|widget
operator|->
name|show
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|widget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// no regain
name|QCOMPARE
argument_list|(
name|focusInSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusOutSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|widget
operator|->
name|hide
argument_list|()
expr_stmt|;
comment|// try to setup subFocus on item that can't take focus
name|subWidget
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|subWidget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
comment|// but isn't the scene's focus item
comment|// try to setup subFocus on item that can take focus
name|otherSubWidget
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|otherSubWidget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|->
name|focusWidget
argument_list|()
argument_list|,
name|otherSubWidget
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
comment|// but isn't the scene's focus item
name|widget
operator|->
name|show
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|otherSubWidget
argument_list|)
expr_stmt|;
comment|// but isn't the scene's focus item
name|QCOMPARE
argument_list|(
name|otherFocusInSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|otherFocusOutSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|delete
name|otherSubWidget
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|otherFocusOutSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|widget
operator|->
name|focusWidget
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|FocusWatchWidget
class|class
name|FocusWatchWidget
super|:
specifier|public
name|QGraphicsWidget
block|{
public|public:
DECL|function|FocusWatchWidget
name|FocusWatchWidget
parameter_list|(
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsWidget
argument_list|(
name|parent
argument_list|)
block|{
name|gotFocusInCount
operator|=
literal|0
expr_stmt|;
name|gotFocusOutCount
operator|=
literal|0
expr_stmt|;
block|}
DECL|member|gotFocusInCount
DECL|member|gotFocusOutCount
name|int
name|gotFocusInCount
decl_stmt|,
name|gotFocusOutCount
decl_stmt|;
protected|protected:
DECL|function|focusInEvent
name|void
name|focusInEvent
parameter_list|(
name|QFocusEvent
modifier|*
name|fe
parameter_list|)
block|{
name|gotFocusInCount
operator|++
expr_stmt|;
name|QGraphicsWidget
operator|::
name|focusInEvent
argument_list|(
name|fe
argument_list|)
expr_stmt|;
block|}
DECL|function|focusOutEvent
name|void
name|focusOutEvent
parameter_list|(
name|QFocusEvent
modifier|*
name|fe
parameter_list|)
block|{
name|gotFocusOutCount
operator|++
expr_stmt|;
name|QGraphicsWidget
operator|::
name|focusOutEvent
argument_list|(
name|fe
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|focusWidget3
name|void
name|tst_QGraphicsWidget
operator|::
name|focusWidget3
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|windowActivate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|windowActivate
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|FocusWatchWidget
modifier|*
name|subWidget
init|=
operator|new
name|FocusWatchWidget
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|subWidget
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|widget
operator|->
name|show
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|widget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|subWidget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|subWidget
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subWidget
operator|->
name|gotFocusInCount
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subWidget
operator|->
name|gotFocusOutCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|widget
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subWidget
operator|->
name|gotFocusOutCount
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|Qt::FocusPolicy
argument_list|)
end_macro
begin_function
DECL|function|focusPolicy_data
name|void
name|tst_QGraphicsWidget
operator|::
name|focusPolicy_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|Qt
operator|::
name|FocusPolicy
argument_list|>
argument_list|(
literal|"focusPolicy1"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|Qt
operator|::
name|FocusPolicy
argument_list|>
argument_list|(
literal|"focusPolicy2"
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|25
condition|;
operator|++
name|i
control|)
block|{
name|QTestData
modifier|&
name|data
init|=
name|QTest
operator|::
name|newRow
argument_list|(
name|QString
argument_list|(
literal|"%1"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
operator|.
name|toLatin1
argument_list|()
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|i
operator|%
literal|5
condition|)
block|{
case|case
literal|0
case|:
name|data
operator|<<
name|Qt
operator|::
name|TabFocus
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|data
operator|<<
name|Qt
operator|::
name|ClickFocus
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|data
operator|<<
name|Qt
operator|::
name|StrongFocus
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|data
operator|<<
name|Qt
operator|::
name|WheelFocus
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|data
operator|<<
name|Qt
operator|::
name|NoFocus
expr_stmt|;
break|break;
block|}
switch|switch
condition|(
name|i
operator|/
literal|5
condition|)
block|{
case|case
literal|0
case|:
name|data
operator|<<
name|Qt
operator|::
name|TabFocus
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|data
operator|<<
name|Qt
operator|::
name|ClickFocus
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|data
operator|<<
name|Qt
operator|::
name|StrongFocus
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|data
operator|<<
name|Qt
operator|::
name|WheelFocus
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|data
operator|<<
name|Qt
operator|::
name|NoFocus
expr_stmt|;
break|break;
block|}
block|}
block|}
end_function
begin_comment
comment|// Qt::FocusPolicy focusPolicy() const public
end_comment
begin_function
DECL|function|focusPolicy
name|void
name|tst_QGraphicsWidget
operator|::
name|focusPolicy
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|windowActivate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|windowActivate
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|SubQGraphicsWidget
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|Qt
operator|::
name|NoFocus
argument_list|,
name|widget
operator|->
name|focusPolicy
argument_list|()
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|Qt
operator|::
name|FocusPolicy
argument_list|,
name|focusPolicy1
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setFocusPolicy
argument_list|(
name|focusPolicy1
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|widget
operator|->
name|focusPolicy
argument_list|()
argument_list|,
name|focusPolicy1
argument_list|)
expr_stmt|;
name|bool
name|isFocusable
init|=
name|widget
operator|->
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemIsFocusable
decl_stmt|;
name|bool
name|wasFocusable
init|=
name|isFocusable
decl_stmt|;
name|QTRY_VERIFY
argument_list|(
name|isFocusable
operator|==
operator|(
name|focusPolicy1
operator|!=
name|Qt
operator|::
name|NoFocus
operator|)
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|widget
operator|->
name|hasFocus
argument_list|()
argument_list|,
name|isFocusable
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|Qt
operator|::
name|FocusPolicy
argument_list|,
name|focusPolicy2
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setFocusPolicy
argument_list|(
name|focusPolicy2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|->
name|focusPolicy
argument_list|()
argument_list|,
name|focusPolicy2
argument_list|)
expr_stmt|;
name|isFocusable
operator|=
name|widget
operator|->
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemIsFocusable
expr_stmt|;
name|QVERIFY
argument_list|(
name|isFocusable
operator|==
operator|(
name|focusPolicy2
operator|!=
name|Qt
operator|::
name|NoFocus
operator|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|->
name|hasFocus
argument_list|()
argument_list|,
name|wasFocusable
operator|&&
name|isFocusable
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|font_data
name|void
name|tst_QGraphicsWidget
operator|::
name|font_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QString
argument_list|>
argument_list|(
literal|"fontName"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Helvetica"
argument_list|)
operator|<<
literal|"Helvetica"
expr_stmt|;
block|}
end_function
begin_comment
comment|// QFont font() const public
end_comment
begin_function
DECL|function|font
name|void
name|tst_QGraphicsWidget
operator|::
name|font
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QString
argument_list|,
name|fontName
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
name|widget
decl_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|font
argument_list|()
argument_list|,
name|QFont
argument_list|()
argument_list|)
expr_stmt|;
name|QFont
name|font
argument_list|(
name|fontName
argument_list|)
decl_stmt|;
name|widget
operator|.
name|setFont
argument_list|(
name|font
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|font
argument_list|()
operator|.
name|family
argument_list|()
argument_list|,
name|font
operator|.
name|family
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|fontPropagatesResolveToChildren
name|void
name|tst_QGraphicsWidget
operator|::
name|fontPropagatesResolveToChildren
parameter_list|()
block|{
name|QGraphicsWidget
modifier|*
name|root
init|=
operator|new
name|QGraphicsWidget
argument_list|()
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|child1
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|root
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|QFont
name|font
decl_stmt|;
name|font
operator|.
name|setItalic
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|root
operator|->
name|setFont
argument_list|(
name|font
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|child2
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|root
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|child3
init|=
operator|new
name|QGraphicsWidget
argument_list|()
decl_stmt|;
name|child3
operator|->
name|setParentItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|font
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|root
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child3
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|fontPropagatesResolveToGrandChildren
name|void
name|tst_QGraphicsWidget
operator|::
name|fontPropagatesResolveToGrandChildren
parameter_list|()
block|{
name|QGraphicsWidget
modifier|*
name|root
init|=
operator|new
name|QGraphicsWidget
argument_list|()
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|child1
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|root
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|grandChild1
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child1
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|QFont
name|font
decl_stmt|;
name|font
operator|.
name|setItalic
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|root
operator|->
name|setFont
argument_list|(
name|font
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|child2
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|root
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|grandChild2
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child2
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|grandChild3
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child2
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|child3
init|=
operator|new
name|QGraphicsWidget
argument_list|()
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|grandChild4
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child3
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|grandChild5
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child3
argument_list|)
decl_stmt|;
name|child3
operator|->
name|setParentItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|grandChild5
operator|->
name|setParentItem
argument_list|(
name|child3
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|font
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild1
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild2
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild3
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild4
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild5
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|fontPropagatesResolveViaNonWidget
name|void
name|tst_QGraphicsWidget
operator|::
name|fontPropagatesResolveViaNonWidget
parameter_list|()
block|{
name|QGraphicsWidget
modifier|*
name|root
init|=
operator|new
name|QGraphicsWidget
argument_list|()
decl_stmt|;
name|QGraphicsPixmapItem
modifier|*
name|child1
init|=
operator|new
name|QGraphicsPixmapItem
argument_list|(
name|root
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|grandChild1
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child1
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|QFont
name|font
decl_stmt|;
name|font
operator|.
name|setItalic
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|root
operator|->
name|setFont
argument_list|(
name|font
argument_list|)
expr_stmt|;
name|QGraphicsPixmapItem
modifier|*
name|child2
init|=
operator|new
name|QGraphicsPixmapItem
argument_list|(
name|root
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|grandChild2
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child2
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|grandChild3
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child2
argument_list|)
decl_stmt|;
name|QGraphicsPixmapItem
modifier|*
name|child3
init|=
operator|new
name|QGraphicsPixmapItem
argument_list|()
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|grandChild4
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child3
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|grandChild5
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child3
argument_list|)
decl_stmt|;
name|child3
operator|->
name|setParentItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|grandChild5
operator|->
name|setParentItem
argument_list|(
name|child3
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|font
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild1
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild2
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild3
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild4
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild5
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|fontPropagatesResolveFromScene
name|void
name|tst_QGraphicsWidget
operator|::
name|fontPropagatesResolveFromScene
parameter_list|()
block|{
name|QGraphicsWidget
modifier|*
name|root
init|=
operator|new
name|QGraphicsWidget
argument_list|()
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|child1
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|root
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|grandChild1
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child1
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|QFont
name|font
decl_stmt|;
name|font
operator|.
name|setItalic
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFont
argument_list|(
name|font
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|child2
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|root
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|grandChild2
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child2
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|grandChild3
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child2
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|child3
init|=
operator|new
name|QGraphicsWidget
argument_list|()
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|grandChild4
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child3
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|grandChild5
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child3
argument_list|)
decl_stmt|;
name|child3
operator|->
name|setParentItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|grandChild5
operator|->
name|setParentItem
argument_list|(
name|child3
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|font
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|root
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child3
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild1
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild2
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild3
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild4
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild5
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|fontPropagatesResolveInParentChange
name|void
name|tst_QGraphicsWidget
operator|::
name|fontPropagatesResolveInParentChange
parameter_list|()
block|{
name|QGraphicsWidget
modifier|*
name|root
init|=
operator|new
name|QGraphicsWidget
argument_list|()
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|child1
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|root
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|grandChild1
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child1
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|child2
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|root
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|grandChild2
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child2
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|QFont
name|italicFont
decl_stmt|;
name|italicFont
operator|.
name|setItalic
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|child1
operator|->
name|setFont
argument_list|(
name|italicFont
argument_list|)
expr_stmt|;
name|QFont
name|boldFont
decl_stmt|;
name|boldFont
operator|.
name|setBold
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|child2
operator|->
name|setFont
argument_list|(
name|boldFont
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandChild1
operator|->
name|font
argument_list|()
operator|.
name|italic
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild1
operator|->
name|font
argument_list|()
operator|.
name|bold
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild2
operator|->
name|font
argument_list|()
operator|.
name|italic
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandChild2
operator|->
name|font
argument_list|()
operator|.
name|bold
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild1
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild2
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|WeightResolved
argument_list|)
argument_list|)
expr_stmt|;
name|grandChild2
operator|->
name|setParentItem
argument_list|(
name|child1
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandChild1
operator|->
name|font
argument_list|()
operator|.
name|italic
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild1
operator|->
name|font
argument_list|()
operator|.
name|bold
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandChild2
operator|->
name|font
argument_list|()
operator|.
name|italic
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild2
operator|->
name|font
argument_list|()
operator|.
name|bold
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild1
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild2
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|StyleResolved
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|fontPropagation
name|void
name|tst_QGraphicsWidget
operator|::
name|fontPropagation
parameter_list|()
block|{
name|QGraphicsWidget
modifier|*
name|root
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|child0
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|root
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|child1
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child0
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|child2
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child1
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
comment|// Check that only the application fonts apply.
name|QFont
name|appFont
init|=
name|QApplication
operator|::
name|font
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|font
argument_list|()
argument_list|,
name|appFont
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|root
operator|->
name|font
argument_list|()
argument_list|,
name|appFont
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child0
operator|->
name|font
argument_list|()
argument_list|,
name|appFont
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|font
argument_list|()
argument_list|,
name|appFont
argument_list|)
expr_stmt|;
comment|// Set child0's Text, and set ToolTipBase on child1.
name|QFont
name|boldFont
decl_stmt|;
name|boldFont
operator|.
name|setBold
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|child0
operator|->
name|setFont
argument_list|(
name|boldFont
argument_list|)
expr_stmt|;
name|QFont
name|italicFont
decl_stmt|;
name|italicFont
operator|.
name|setItalic
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|child1
operator|->
name|setFont
argument_list|(
name|italicFont
argument_list|)
expr_stmt|;
comment|// Check that the above settings propagate correctly.
name|QCOMPARE
argument_list|(
name|root
operator|->
name|font
argument_list|()
argument_list|,
name|appFont
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|font
argument_list|()
argument_list|,
name|appFont
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child0
operator|->
name|font
argument_list|()
operator|.
name|bold
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child0
operator|->
name|font
argument_list|()
operator|.
name|italic
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child1
operator|->
name|font
argument_list|()
operator|.
name|bold
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child1
operator|->
name|font
argument_list|()
operator|.
name|italic
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child2
operator|->
name|font
argument_list|()
operator|.
name|bold
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child2
operator|->
name|font
argument_list|()
operator|.
name|italic
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|child3
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child2
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|child3
operator|->
name|font
argument_list|()
operator|.
name|bold
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child3
operator|->
name|font
argument_list|()
operator|.
name|italic
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|child4
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|child4
operator|->
name|setParentItem
argument_list|(
name|child3
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child4
operator|->
name|font
argument_list|()
operator|.
name|bold
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child4
operator|->
name|font
argument_list|()
operator|.
name|italic
argument_list|()
argument_list|)
expr_stmt|;
comment|// Replace the app font for child2. Button should propagate but Text
comment|// should still be ignored. The previous ToolTipBase setting is gone.
name|QFont
name|sizeFont
decl_stmt|;
name|sizeFont
operator|.
name|setPointSize
argument_list|(
literal|43
argument_list|)
expr_stmt|;
name|child1
operator|->
name|setFont
argument_list|(
name|sizeFont
argument_list|)
expr_stmt|;
comment|// Check that the above settings propagate correctly.
name|QCOMPARE
argument_list|(
name|root
operator|->
name|font
argument_list|()
argument_list|,
name|appFont
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|font
argument_list|()
argument_list|,
name|appFont
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child0
operator|->
name|font
argument_list|()
operator|.
name|bold
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child0
operator|->
name|font
argument_list|()
operator|.
name|italic
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child1
operator|->
name|font
argument_list|()
operator|.
name|bold
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child1
operator|->
name|font
argument_list|()
operator|.
name|italic
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|font
argument_list|()
operator|.
name|pointSize
argument_list|()
argument_list|,
literal|43
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child2
operator|->
name|font
argument_list|()
operator|.
name|bold
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child2
operator|->
name|font
argument_list|()
operator|.
name|italic
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|font
argument_list|()
operator|.
name|pointSize
argument_list|()
argument_list|,
literal|43
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|fontChangedEvent
name|void
name|tst_QGraphicsWidget
operator|::
name|fontChangedEvent
parameter_list|()
block|{
name|QGraphicsWidget
modifier|*
name|root
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
comment|// Check that only the application fonts apply.
name|QFont
name|appFont
init|=
name|QApplication
operator|::
name|font
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|font
argument_list|()
argument_list|,
name|appFont
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|root
operator|->
name|font
argument_list|()
argument_list|,
name|appFont
argument_list|)
expr_stmt|;
name|EventSpy
name|rootSpyFont
argument_list|(
name|root
argument_list|,
name|QEvent
operator|::
name|FontChange
argument_list|)
decl_stmt|;
name|EventSpy
name|rootSpyPolish
argument_list|(
name|root
argument_list|,
name|QEvent
operator|::
name|Polish
argument_list|)
decl_stmt|;
name|QTRY_COMPARE
argument_list|(
name|rootSpyFont
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|rootSpyPolish
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//The font is still the same so no fontChangeEvent
name|QTRY_COMPARE
argument_list|(
name|rootSpyFont
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QFont
name|font
decl_stmt|;
name|font
operator|.
name|setPointSize
argument_list|(
literal|43
argument_list|)
expr_stmt|;
name|root
operator|->
name|setFont
argument_list|(
name|font
argument_list|)
expr_stmt|;
comment|//The font changed
name|QTRY_COMPARE
argument_list|(
name|rootSpyFont
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//then roll back to the default one.
name|root
operator|->
name|setFont
argument_list|(
name|appFont
argument_list|)
expr_stmt|;
comment|//The font changed
name|QTRY_COMPARE
argument_list|(
name|rootSpyFont
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|fontPropagationWidgetItemWidget
name|void
name|tst_QGraphicsWidget
operator|::
name|fontPropagationWidgetItemWidget
parameter_list|()
block|{
name|QGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|widget2
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|rect
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QFont
name|font
decl_stmt|;
name|font
operator|.
name|setPointSize
argument_list|(
literal|43
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setFont
argument_list|(
name|font
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2
operator|->
name|font
argument_list|()
operator|.
name|pointSize
argument_list|()
argument_list|,
literal|43
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|uint
argument_list|(
name|QFont
operator|::
name|SizeResolved
argument_list|)
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setFont
argument_list|(
name|QFont
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2
operator|->
name|font
argument_list|()
operator|.
name|pointSize
argument_list|()
argument_list|,
name|qApp
operator|->
name|font
argument_list|()
operator|.
name|pointSize
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2
operator|->
name|font
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|,
name|QFont
argument_list|()
operator|.
name|resolve
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|fontPropagationSceneChange
name|void
name|tst_QGraphicsWidget
operator|::
name|fontPropagationSceneChange
parameter_list|()
block|{
name|QGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|widget2
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|rect
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsScene
name|scene2
decl_stmt|;
name|QFont
name|font
decl_stmt|;
name|font
operator|.
name|setPointSize
argument_list|(
literal|47
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFont
argument_list|(
name|font
argument_list|)
expr_stmt|;
name|QFont
name|font2
decl_stmt|;
name|font2
operator|.
name|setPointSize
argument_list|(
literal|74
argument_list|)
expr_stmt|;
name|scene2
operator|.
name|setFont
argument_list|(
name|font2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2
operator|->
name|font
argument_list|()
operator|.
name|pointSize
argument_list|()
argument_list|,
literal|47
argument_list|)
expr_stmt|;
name|scene2
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2
operator|->
name|font
argument_list|()
operator|.
name|pointSize
argument_list|()
argument_list|,
literal|74
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|geometry_data
name|void
name|tst_QGraphicsWidget
operator|::
name|geometry_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QPointF
argument_list|>
argument_list|(
literal|"pos"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QSizeF
argument_list|>
argument_list|(
literal|"size"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"null, null"
argument_list|)
operator|<<
name|QPointF
argument_list|()
operator|<<
name|QSizeF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"null, normal"
argument_list|)
operator|<<
name|QPointF
argument_list|()
operator|<<
name|QSizeF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"neg, normal"
argument_list|)
operator|<<
name|QPointF
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|)
operator|<<
name|QSizeF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// QRectF geometry() const public
end_comment
begin_function
DECL|function|geometry
name|void
name|tst_QGraphicsWidget
operator|::
name|geometry
parameter_list|()
block|{
name|SubQGraphicsWidget
name|widget
decl_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|geometry
argument_list|()
argument_list|,
name|QRectF
argument_list|(
name|widget
operator|.
name|pos
argument_list|()
argument_list|,
name|widget
operator|.
name|size
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QSignalSpy
name|spy
argument_list|(
operator|&
name|widget
argument_list|,
name|SIGNAL
argument_list|(
name|geometryChanged
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|QFETCH
argument_list|(
name|QPointF
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QSizeF
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|widget
operator|.
name|setPos
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|widget
operator|.
name|resize
argument_list|(
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|size
operator|.
name|isNull
argument_list|()
operator|&&
operator|!
name|pos
operator|.
name|isNull
argument_list|()
condition|)
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|size
operator|.
name|isNull
argument_list|()
operator|&&
name|pos
operator|.
name|isNull
argument_list|()
condition|)
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|geometry
argument_list|()
argument_list|,
name|QRectF
argument_list|(
name|pos
argument_list|,
name|size
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|geometryChanged
name|void
name|tst_QGraphicsWidget
operator|::
name|geometryChanged
parameter_list|()
block|{
name|QGraphicsWidget
name|w
decl_stmt|;
name|w
operator|.
name|setGeometry
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|.
name|geometry
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QSignalSpy
name|spy
argument_list|(
operator|&
name|w
argument_list|,
name|SIGNAL
argument_list|(
name|geometryChanged
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|w
operator|.
name|setGeometry
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|.
name|geometry
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|w
operator|.
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|.
name|geometry
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|width
name|void
name|tst_QGraphicsWidget
operator|::
name|width
parameter_list|()
block|{
name|QGraphicsWidget
name|w
decl_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|.
name|property
argument_list|(
literal|"width"
argument_list|)
operator|.
name|toReal
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QSignalSpy
name|spy
argument_list|(
operator|&
name|w
argument_list|,
name|SIGNAL
argument_list|(
name|widthChanged
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|w
operator|.
name|setProperty
argument_list|(
literal|"width"
argument_list|,
name|qreal
argument_list|(
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|.
name|property
argument_list|(
literal|"width"
argument_list|)
operator|.
name|toReal
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//calling old school setGeometry should work too
name|w
operator|.
name|setGeometry
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|height
name|void
name|tst_QGraphicsWidget
operator|::
name|height
parameter_list|()
block|{
name|QGraphicsWidget
name|w
decl_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|.
name|property
argument_list|(
literal|"height"
argument_list|)
operator|.
name|toReal
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QSignalSpy
name|spy
argument_list|(
operator|&
name|w
argument_list|,
name|SIGNAL
argument_list|(
name|heightChanged
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|w
operator|.
name|setProperty
argument_list|(
literal|"height"
argument_list|,
name|qreal
argument_list|(
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|.
name|property
argument_list|(
literal|"height"
argument_list|)
operator|.
name|toReal
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//calling old school setGeometry should work too
name|w
operator|.
name|setGeometry
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|getContentsMargins_data
name|void
name|tst_QGraphicsWidget
operator|::
name|getContentsMargins_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"left"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"top"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"right"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"bottom"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"null"
argument_list|)
operator|<<
operator|(
name|qreal
operator|)
literal|0
operator|<<
operator|(
name|qreal
operator|)
literal|0
operator|<<
operator|(
name|qreal
operator|)
literal|0
operator|<<
operator|(
name|qreal
operator|)
literal|0
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"something"
argument_list|)
operator|<<
operator|(
name|qreal
operator|)
literal|10
operator|<<
operator|(
name|qreal
operator|)
literal|5
operator|<<
operator|(
name|qreal
operator|)
literal|3
operator|<<
operator|(
name|qreal
operator|)
literal|7
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"real"
argument_list|)
operator|<<
operator|(
name|qreal
operator|)
literal|1.7
operator|<<
operator|(
name|qreal
operator|)
literal|5.9
operator|<<
operator|(
name|qreal
operator|)
literal|3.2
operator|<<
operator|(
name|qreal
operator|)
literal|9.7
expr_stmt|;
block|}
end_function
begin_comment
comment|// void getContentsMargins(qreal* left, qreal* top, qreal* right, qreal* bottom) const public
end_comment
begin_function
DECL|function|getContentsMargins
name|void
name|tst_QGraphicsWidget
operator|::
name|getContentsMargins
parameter_list|()
block|{
name|qreal
name|gleft
decl_stmt|;
name|qreal
name|gtop
decl_stmt|;
name|qreal
name|gright
decl_stmt|;
name|qreal
name|gbottom
decl_stmt|;
name|SubQGraphicsWidget
name|widget
decl_stmt|;
name|widget
operator|.
name|getContentsMargins
argument_list|(
operator|&
name|gleft
argument_list|,
operator|&
name|gtop
argument_list|,
operator|&
name|gright
argument_list|,
operator|&
name|gbottom
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|gleft
argument_list|,
operator|(
name|qreal
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|gtop
argument_list|,
operator|(
name|qreal
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|gright
argument_list|,
operator|(
name|qreal
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|gbottom
argument_list|,
operator|(
name|qreal
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|left
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|top
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|right
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|bottom
argument_list|)
expr_stmt|;
name|int
name|oldEventCounts
init|=
name|widget
operator|.
name|eventCount
decl_stmt|;
name|widget
operator|.
name|setContentsMargins
argument_list|(
name|left
argument_list|,
name|top
argument_list|,
name|right
argument_list|,
name|bottom
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|left
operator|==
literal|0
operator|||
name|oldEventCounts
operator|!=
name|widget
operator|.
name|eventCount
argument_list|)
expr_stmt|;
name|widget
operator|.
name|getContentsMargins
argument_list|(
operator|&
name|gleft
argument_list|,
operator|&
name|gtop
argument_list|,
operator|&
name|gright
argument_list|,
operator|&
name|gbottom
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|gleft
argument_list|,
name|left
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|gtop
argument_list|,
name|top
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|gright
argument_list|,
name|right
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|gbottom
argument_list|,
name|bottom
argument_list|)
expr_stmt|;
block|}
end_function
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|Qt::LayoutDirection
argument_list|)
end_macro
begin_function
DECL|function|initStyleOption_data
name|void
name|tst_QGraphicsWidget
operator|::
name|initStyleOption_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"enabled"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"focus"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"underMouse"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|Qt
operator|::
name|LayoutDirection
argument_list|>
argument_list|(
literal|"layoutDirection"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QSizeF
argument_list|>
argument_list|(
literal|"size"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QPalette
argument_list|>
argument_list|(
literal|"palette"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QString
argument_list|>
argument_list|(
literal|"fontName"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"none"
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
operator|<<
literal|false
operator|<<
name|Qt
operator|::
name|LeftToRight
operator|<<
name|QSizeF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPalette
argument_list|()
operator|<<
name|QString
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"all"
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
operator|<<
literal|true
operator|<<
name|Qt
operator|::
name|RightToLeft
operator|<<
name|QSizeF
argument_list|(
literal|300
argument_list|,
literal|300
argument_list|)
operator|<<
name|QPalette
argument_list|(
name|Qt
operator|::
name|magenta
argument_list|)
operator|<<
literal|"Helvetica"
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"rand"
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
operator|<<
literal|false
operator|<<
name|Qt
operator|::
name|RightToLeft
operator|<<
name|QSizeF
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPalette
argument_list|(
name|Qt
operator|::
name|darkCyan
argument_list|)
operator|<<
literal|"Times"
expr_stmt|;
block|}
end_function
begin_comment
comment|// void initStyleOption(QStyleOption* option) const public
end_comment
begin_function
DECL|function|initStyleOption
name|void
name|tst_QGraphicsWidget
operator|::
name|initStyleOption
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setAlignment
argument_list|(
name|Qt
operator|::
name|AlignTop
operator||
name|Qt
operator|::
name|AlignLeft
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|SubQGraphicsWidget
decl_stmt|;
name|widget
operator|->
name|setAcceptsHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QStyleOption
name|option
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QSizeF
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|widget
operator|->
name|resize
argument_list|(
name|size
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|enabled
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setEnabled
argument_list|(
name|enabled
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|focus
argument_list|)
expr_stmt|;
if|if
condition|(
name|focus
condition|)
block|{
name|widget
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|widget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|underMouse
argument_list|)
expr_stmt|;
if|if
condition|(
name|underMouse
condition|)
block|{
name|view
operator|.
name|resize
argument_list|(
literal|300
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|widget
operator|->
name|mapToScene
argument_list|(
name|widget
operator|->
name|boundingRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|QFETCH
argument_list|(
name|QPalette
argument_list|,
name|palette
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setPalette
argument_list|(
name|palette
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QString
argument_list|,
name|fontName
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setFont
argument_list|(
name|QFont
argument_list|(
name|fontName
argument_list|)
argument_list|)
expr_stmt|;
comment|// The test
name|widget
operator|->
name|initStyleOption
argument_list|(
operator|&
name|option
argument_list|)
expr_stmt|;
name|bool
name|isEnabled
init|=
name|option
operator|.
name|state
operator|&
name|QStyle
operator|::
name|State_Enabled
decl_stmt|;
name|QCOMPARE
argument_list|(
name|isEnabled
argument_list|,
name|enabled
argument_list|)
expr_stmt|;
name|bool
name|hasFocus
init|=
name|option
operator|.
name|state
operator|&
name|QStyle
operator|::
name|State_HasFocus
decl_stmt|;
name|QCOMPARE
argument_list|(
name|hasFocus
argument_list|,
name|focus
argument_list|)
expr_stmt|;
name|bool
name|isUnderMouse
init|=
name|option
operator|.
name|state
operator|&
name|QStyle
operator|::
name|State_MouseOver
decl_stmt|;
ifndef|#
directive|ifndef
name|Q_OS_WINCE
name|QCOMPARE
argument_list|(
name|isUnderMouse
argument_list|,
name|underMouse
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|// if (layoutDirection != Qt::LeftToRight)
comment|//QEXPECT_FAIL("", "QApplicaiton::layoutDirection doesn't propagate to QGraphicsWidget", Continue);
comment|//QCOMPARE(option.direction, layoutDirection);
name|QCOMPARE
argument_list|(
name|option
operator|.
name|rect
argument_list|,
name|QRectF
argument_list|(
name|QPointF
argument_list|()
argument_list|,
name|size
argument_list|)
operator|.
name|toRect
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|option
operator|.
name|palette
argument_list|,
name|palette
operator|.
name|resolve
argument_list|(
name|QApplication
operator|::
name|palette
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|option
operator|.
name|fontMetrics
argument_list|,
name|QFontMetrics
argument_list|(
name|widget
operator|->
name|font
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|layout_data
name|void
name|tst_QGraphicsWidget
operator|::
name|layout_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"childCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"empty"
argument_list|)
operator|<<
literal|0
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"10"
argument_list|)
operator|<<
literal|10
expr_stmt|;
block|}
end_function
begin_comment
comment|// QGraphicsLayout* layout() const public
end_comment
begin_function
DECL|function|layout
name|void
name|tst_QGraphicsWidget
operator|::
name|layout
parameter_list|()
block|{
name|SubQGraphicsWidget
name|widget
decl_stmt|;
name|widget
operator|.
name|setContentsMargins
argument_list|(
literal|10
argument_list|,
literal|5
argument_list|,
literal|50
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|layout
argument_list|()
argument_list|,
operator|(
name|QGraphicsLayout
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|childCount
argument_list|)
expr_stmt|;
name|QGraphicsLinearLayout
modifier|*
name|layout
init|=
operator|new
name|QGraphicsLinearLayout
decl_stmt|;
name|QList
argument_list|<
name|SubQGraphicsWidget
modifier|*
argument_list|>
name|children
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|childCount
condition|;
operator|++
name|i
control|)
block|{
name|SubQGraphicsWidget
modifier|*
name|item
init|=
operator|new
name|SubQGraphicsWidget
decl_stmt|;
name|layout
operator|->
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|children
operator|.
name|append
argument_list|(
name|item
argument_list|)
expr_stmt|;
block|}
name|QSignalSpy
name|spy
argument_list|(
operator|&
name|widget
argument_list|,
name|SIGNAL
argument_list|(
name|layoutChanged
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|widget
operator|.
name|setLayout
argument_list|(
name|layout
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|widget
operator|.
name|layout
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsLayout
operator|*
argument_list|>
argument_list|(
name|layout
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|children
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|SubQGraphicsWidget
modifier|*
name|item
init|=
name|children
index|[
name|i
index|]
decl_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|parentWidget
argument_list|()
argument_list|,
operator|(
name|QGraphicsWidget
operator|*
operator|)
operator|&
name|widget
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|geometry
argument_list|()
operator|!=
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// don't crash
name|widget
operator|.
name|setLayout
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|layoutDirection_data
name|void
name|tst_QGraphicsWidget
operator|::
name|layoutDirection_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|Qt
operator|::
name|LayoutDirection
argument_list|>
argument_list|(
literal|"layoutDirection"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"rtl"
argument_list|)
operator|<<
name|Qt
operator|::
name|RightToLeft
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"ltr"
argument_list|)
operator|<<
name|Qt
operator|::
name|LeftToRight
expr_stmt|;
block|}
end_function
begin_comment
comment|// Qt::LayoutDirection layoutDirection() const public
end_comment
begin_function
DECL|function|layoutDirection
name|void
name|tst_QGraphicsWidget
operator|::
name|layoutDirection
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|Qt
operator|::
name|LayoutDirection
argument_list|,
name|layoutDirection
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QScopedPointer
argument_list|<
name|QGraphicsView
argument_list|>
name|view
argument_list|(
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene
argument_list|)
argument_list|)
decl_stmt|;
name|SubQGraphicsWidget
name|widget
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|widget
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|layoutDirection
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftToRight
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_SetLayoutDirection
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|SubQGraphicsWidget
modifier|*
argument_list|>
name|children
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
operator|++
name|i
control|)
block|{
name|SubQGraphicsWidget
modifier|*
name|item
init|=
operator|new
name|SubQGraphicsWidget
argument_list|(
operator|&
name|widget
argument_list|)
decl_stmt|;
name|children
operator|.
name|append
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_SetLayoutDirection
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
name|widget
operator|.
name|setLayoutDirection
argument_list|(
name|layoutDirection
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_SetLayoutDirection
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|view
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
name|view
operator|.
name|data
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|children
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QTRY_COMPARE
argument_list|(
name|children
index|[
name|i
index|]
operator|->
name|layoutDirection
argument_list|()
argument_list|,
name|layoutDirection
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|children
index|[
name|i
index|]
operator|->
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_SetLayoutDirection
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|view
operator|->
name|repaint
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|children
index|[
name|i
index|]
operator|->
name|m_painterLayoutDirection
argument_list|,
name|layoutDirection
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|paint_data
name|void
name|tst_QGraphicsWidget
operator|::
name|paint_data
parameter_list|()
block|{
comment|// currently QGraphicsWidget doesn't paint or do anything ...
block|}
end_function
begin_comment
comment|// void paint(QPainter* painter, QStyleOptionGraphicsItem const* option, QWidget* widget) public
end_comment
begin_function
DECL|function|paint
name|void
name|tst_QGraphicsWidget
operator|::
name|paint
parameter_list|()
block|{
name|SubQGraphicsWidget
name|widget
decl_stmt|;
name|QPainter
name|painter
decl_stmt|;
name|QStyleOptionGraphicsItem
name|option
decl_stmt|;
name|widget
operator|.
name|paint
argument_list|(
operator|&
name|painter
argument_list|,
operator|&
name|option
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// check that widget = 0 works.
block|}
end_function
begin_function
DECL|function|palettePropagation
name|void
name|tst_QGraphicsWidget
operator|::
name|palettePropagation
parameter_list|()
block|{
name|QGraphicsWidget
modifier|*
name|root
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|child0
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|root
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|child1
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child0
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|child2
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child1
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
comment|// These colors are unlikely to be imposed on the default palette of
comment|// QWidget ;-).
name|QColor
name|sysPalText
argument_list|(
literal|21
argument_list|,
literal|22
argument_list|,
literal|23
argument_list|)
decl_stmt|;
name|QColor
name|sysPalToolTipBase
argument_list|(
literal|12
argument_list|,
literal|13
argument_list|,
literal|14
argument_list|)
decl_stmt|;
name|QColor
name|overridePalText
argument_list|(
literal|42
argument_list|,
literal|43
argument_list|,
literal|44
argument_list|)
decl_stmt|;
name|QColor
name|overridePalToolTipBase
argument_list|(
literal|45
argument_list|,
literal|46
argument_list|,
literal|47
argument_list|)
decl_stmt|;
name|QColor
name|sysPalButton
argument_list|(
literal|99
argument_list|,
literal|98
argument_list|,
literal|97
argument_list|)
decl_stmt|;
comment|// Check that only the application fonts apply.
name|QPalette
name|appPal
init|=
name|QApplication
operator|::
name|palette
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|palette
argument_list|()
argument_list|,
name|appPal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|root
operator|->
name|palette
argument_list|()
argument_list|,
name|appPal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child0
operator|->
name|palette
argument_list|()
argument_list|,
name|appPal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|palette
argument_list|()
argument_list|,
name|appPal
argument_list|)
expr_stmt|;
comment|// Set child0's Text, and set ToolTipBase on child1.
name|QPalette
name|textPalette
decl_stmt|;
name|textPalette
operator|.
name|setColor
argument_list|(
name|QPalette
operator|::
name|Text
argument_list|,
name|overridePalText
argument_list|)
expr_stmt|;
name|child0
operator|->
name|setPalette
argument_list|(
name|textPalette
argument_list|)
expr_stmt|;
name|QPalette
name|toolTipPalette
decl_stmt|;
name|toolTipPalette
operator|.
name|setColor
argument_list|(
name|QPalette
operator|::
name|ToolTipBase
argument_list|,
name|overridePalToolTipBase
argument_list|)
expr_stmt|;
name|child1
operator|->
name|setPalette
argument_list|(
name|toolTipPalette
argument_list|)
expr_stmt|;
comment|// Check that the above settings propagate correctly.
name|QCOMPARE
argument_list|(
name|root
operator|->
name|palette
argument_list|()
argument_list|,
name|appPal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|palette
argument_list|()
argument_list|,
name|appPal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child0
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|Text
argument_list|)
argument_list|,
name|overridePalText
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child0
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|ToolTipBase
argument_list|)
argument_list|,
name|appPal
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|ToolTipBase
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|Text
argument_list|)
argument_list|,
name|overridePalText
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|ToolTipBase
argument_list|)
argument_list|,
name|overridePalToolTipBase
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|Text
argument_list|)
argument_list|,
name|overridePalText
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|ToolTipBase
argument_list|)
argument_list|,
name|overridePalToolTipBase
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|child3
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|child2
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|child3
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|Text
argument_list|)
argument_list|,
name|overridePalText
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child3
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|ToolTipBase
argument_list|)
argument_list|,
name|overridePalToolTipBase
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|child4
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|child4
operator|->
name|setParentItem
argument_list|(
name|child3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child4
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|Text
argument_list|)
argument_list|,
name|overridePalText
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child4
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|ToolTipBase
argument_list|)
argument_list|,
name|overridePalToolTipBase
argument_list|)
expr_stmt|;
comment|// Replace the app palette for child2. Button should propagate but Text
comment|// should still be ignored. The previous ToolTipBase setting is gone.
name|QPalette
name|buttonPalette
decl_stmt|;
name|buttonPalette
operator|.
name|setColor
argument_list|(
name|QPalette
operator|::
name|Button
argument_list|,
name|sysPalButton
argument_list|)
expr_stmt|;
name|child1
operator|->
name|setPalette
argument_list|(
name|buttonPalette
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|root
operator|->
name|palette
argument_list|()
argument_list|,
name|appPal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|palette
argument_list|()
argument_list|,
name|appPal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child0
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|Text
argument_list|)
argument_list|,
name|overridePalText
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child0
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|ToolTipBase
argument_list|)
argument_list|,
name|appPal
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|ToolTipBase
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|Text
argument_list|)
argument_list|,
name|overridePalText
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|ToolTipBase
argument_list|)
argument_list|,
name|appPal
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|ToolTipBase
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|Button
argument_list|)
argument_list|,
name|sysPalButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|Text
argument_list|)
argument_list|,
name|overridePalText
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|ToolTipBase
argument_list|)
argument_list|,
name|appPal
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|ToolTipBase
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|palette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|Button
argument_list|)
argument_list|,
name|sysPalButton
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|parentWidget_data
name|void
name|tst_QGraphicsWidget
operator|::
name|parentWidget_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"childrenCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0"
argument_list|)
operator|<<
literal|0
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"1"
argument_list|)
operator|<<
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"10"
argument_list|)
operator|<<
literal|10
expr_stmt|;
block|}
end_function
begin_comment
comment|// QGraphicsWidget* parentWidget() const public
end_comment
begin_function
DECL|function|parentWidget
name|void
name|tst_QGraphicsWidget
operator|::
name|parentWidget
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|childrenCount
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
name|standAlongWidget
decl_stmt|;
name|QGraphicsLineItem
name|standAlongItem
decl_stmt|;
name|SubQGraphicsWidget
name|widgetChild
argument_list|(
operator|&
name|standAlongWidget
argument_list|)
decl_stmt|;
name|SubQGraphicsWidget
name|itemChild
argument_list|(
operator|&
name|standAlongItem
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|standAlongWidget
operator|.
name|parentWidget
argument_list|()
argument_list|,
operator|(
name|QGraphicsWidget
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetChild
operator|.
name|parentWidget
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|(
operator|&
name|standAlongWidget
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemChild
operator|.
name|parentWidget
argument_list|()
argument_list|,
operator|(
name|QGraphicsWidget
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|childrenCount
condition|;
operator|++
name|i
control|)
block|{
name|SubQGraphicsWidget
modifier|*
name|item
init|=
operator|new
name|SubQGraphicsWidget
argument_list|(
operator|&
name|standAlongWidget
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|parentWidget
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|(
operator|&
name|standAlongWidget
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|resize_data
name|void
name|tst_QGraphicsWidget
operator|::
name|resize_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QSizeF
argument_list|>
argument_list|(
literal|"size"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"null"
argument_list|)
operator|<<
name|QSizeF
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"10x10"
argument_list|)
operator|<<
name|QSizeF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"10x-1"
argument_list|)
operator|<<
name|QSizeF
argument_list|(
literal|10
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// void resize(qreal w, qreal h) public
end_comment
begin_function
DECL|function|resize
name|void
name|tst_QGraphicsWidget
operator|::
name|resize
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QSizeF
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
name|widget
decl_stmt|;
name|int
name|oldEventCounts
init|=
name|widget
operator|.
name|eventCount
decl_stmt|;
name|QSizeF
name|oldSize
init|=
name|widget
operator|.
name|size
argument_list|()
decl_stmt|;
name|widget
operator|.
name|resize
argument_list|(
name|size
argument_list|)
expr_stmt|;
name|QSizeF
name|boundedSize
init|=
name|size
operator|.
name|expandedTo
argument_list|(
name|widget
operator|.
name|minimumSize
argument_list|()
argument_list|)
operator|.
name|boundedTo
argument_list|(
name|widget
operator|.
name|maximumSize
argument_list|()
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|eventCount
argument_list|,
name|oldEventCounts
operator|+
operator|(
operator|(
name|oldSize
operator|==
name|boundedSize
operator|)
condition|?
literal|0
else|:
literal|1
operator|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|size
argument_list|()
argument_list|,
name|boundedSize
argument_list|)
expr_stmt|;
block|}
end_function
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|Qt::WidgetAttribute
argument_list|)
end_macro
begin_function
DECL|function|setAttribute_data
name|void
name|tst_QGraphicsWidget
operator|::
name|setAttribute_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|Qt
operator|::
name|WidgetAttribute
argument_list|>
argument_list|(
literal|"attribute"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"supported"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"WA_SetLayoutDirection"
argument_list|)
operator|<<
name|Qt
operator|::
name|WA_SetLayoutDirection
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"WA_RightToLeft"
argument_list|)
operator|<<
name|Qt
operator|::
name|WA_RightToLeft
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"WA_SetStyle"
argument_list|)
operator|<<
name|Qt
operator|::
name|WA_SetStyle
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"WA_Resized"
argument_list|)
operator|<<
name|Qt
operator|::
name|WA_Resized
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_comment
comment|// void setAttribute(Qt::WidgetAttribute attribute, bool on = true) public
end_comment
begin_function
DECL|function|setAttribute
name|void
name|tst_QGraphicsWidget
operator|::
name|setAttribute
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|Qt
operator|::
name|WidgetAttribute
argument_list|,
name|attribute
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|supported
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
name|widget
decl_stmt|;
name|widget
operator|.
name|setAttribute
argument_list|(
name|attribute
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|testAttribute
argument_list|(
name|attribute
argument_list|)
argument_list|,
name|supported
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setStyle_data
name|void
name|tst_QGraphicsWidget
operator|::
name|setStyle_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QString
argument_list|>
argument_list|(
literal|"style"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"null"
argument_list|)
operator|<<
literal|""
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"fusion"
argument_list|)
operator|<<
literal|"Fusion"
expr_stmt|;
block|}
end_function
begin_comment
comment|// void setStyle(QStyle* style) public
end_comment
begin_function
DECL|function|setStyle
name|void
name|tst_QGraphicsWidget
operator|::
name|setStyle
parameter_list|()
block|{
ifndef|#
directive|ifndef
name|Q_NO_STYLE_FUSION
name|SubQGraphicsWidget
name|widget
decl_stmt|;
name|int
name|oldEventCounts
init|=
name|widget
operator|.
name|eventCount
decl_stmt|;
name|QFETCH
argument_list|(
name|QString
argument_list|,
name|style
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|style
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|QStyle
modifier|*
name|fstyle
init|=
name|QStyleFactory
operator|::
name|create
argument_list|(
name|style
argument_list|)
decl_stmt|;
name|widget
operator|.
name|setStyle
argument_list|(
name|fstyle
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|style
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QStyle
operator|*
argument_list|>
argument_list|(
name|fstyle
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|widget
operator|.
name|setStyle
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|widget
operator|.
name|style
argument_list|()
operator|!=
operator|(
name|QStyle
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|eventCount
argument_list|,
name|oldEventCounts
operator|+
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_SetStyle
argument_list|)
argument_list|,
operator|!
name|style
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
comment|// cleanup
name|widget
operator|.
name|setStyle
argument_list|(
literal|0
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function
begin_function
DECL|function|setTabOrder_data
name|void
name|tst_QGraphicsWidget
operator|::
name|setTabOrder_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"childrenCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0"
argument_list|)
operator|<<
literal|0
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"1"
argument_list|)
operator|<<
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"10"
argument_list|)
operator|<<
literal|10
expr_stmt|;
block|}
end_function
begin_comment
comment|// void setTabOrder(QGraphicsWidget* first, QGraphicsWidget* second) public
end_comment
begin_function
DECL|function|setTabOrder
name|void
name|tst_QGraphicsWidget
operator|::
name|setTabOrder
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|childrenCount
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|lastItem
init|=
literal|0
decl_stmt|;
name|QTest
operator|::
name|ignoreMessage
argument_list|(
name|QtWarningMsg
argument_list|,
literal|"QGraphicsWidget::setTabOrder(0, 0) is undefined"
argument_list|)
expr_stmt|;
name|QGraphicsWidget
operator|::
name|setTabOrder
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|SubQGraphicsWidget
modifier|*
argument_list|>
name|children
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|childrenCount
condition|;
operator|++
name|i
control|)
block|{
name|SubQGraphicsWidget
modifier|*
name|item
init|=
operator|new
name|SubQGraphicsWidget
argument_list|()
decl_stmt|;
name|item
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|TabFocus
argument_list|)
expr_stmt|;
name|children
operator|.
name|append
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
if|if
condition|(
name|lastItem
condition|)
name|QGraphicsWidget
operator|::
name|setTabOrder
argument_list|(
name|lastItem
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|lastItem
operator|=
name|item
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|children
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|QGraphicsWidget
modifier|*
name|first
init|=
name|children
operator|.
name|first
argument_list|()
decl_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|first
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|first
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|int
name|currentItem
init|=
literal|0
decl_stmt|;
while|while
condition|(
name|currentItem
operator|<
name|children
operator|.
name|count
argument_list|()
operator|-
literal|1
condition|)
block|{
name|QTest
operator|::
name|keyPress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
operator|++
name|currentItem
expr_stmt|;
name|QVERIFY
argument_list|(
name|children
index|[
name|currentItem
operator|%
name|children
operator|.
name|size
argument_list|()
index|]
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function
DECL|function|compareFocusChain
specifier|static
name|bool
name|compareFocusChain
parameter_list|(
name|QGraphicsView
modifier|*
name|view
parameter_list|,
specifier|const
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
modifier|&
name|order
parameter_list|)
block|{
name|QGraphicsScene
modifier|*
name|scene
init|=
name|view
operator|->
name|scene
argument_list|()
decl_stmt|;
name|QStringList
name|actual
decl_stmt|;
name|QGraphicsItem
modifier|*
name|oldFocusItem
init|=
name|scene
operator|->
name|focusItem
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|order
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QGraphicsItem
modifier|*
name|focusItem
init|=
name|scene
operator|->
name|focusItem
argument_list|()
decl_stmt|;
name|actual
operator|<<
name|focusItem
operator|->
name|data
argument_list|(
literal|0
argument_list|)
operator|.
name|toString
argument_list|()
expr_stmt|;
comment|//qDebug()<< "i:"<< i<< "expected:"<< QString::number(uint(order.at(i)), 16)<< QString::number(uint(focusItem), 16);
if|if
condition|(
name|focusItem
operator|!=
name|order
operator|.
name|at
argument_list|(
name|i
argument_list|)
condition|)
block|{
name|qDebug
argument_list|()
operator|<<
literal|"actual:"
operator|<<
name|actual
expr_stmt|;
name|scene
operator|->
name|setFocusItem
argument_list|(
name|oldFocusItem
argument_list|)
expr_stmt|;
return|return
literal|false
return|;
block|}
if|if
condition|(
name|i
operator|<
name|order
operator|.
name|count
argument_list|()
operator|-
literal|1
condition|)
name|QTest
operator|::
name|keyPress
argument_list|(
name|view
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
block|}
name|scene
operator|->
name|setFocusItem
argument_list|(
name|oldFocusItem
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
end_function
begin_function
DECL|function|setTabOrderAndReparent
name|void
name|tst_QGraphicsWidget
operator|::
name|setTabOrderAndReparent
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
operator|(
name|QWidget
operator|*
operator|)
operator|&
name|view
argument_list|)
expr_stmt|;
name|int
name|i
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|w1
decl_stmt|,
modifier|*
name|w2
decl_stmt|,
modifier|*
name|w3
decl_stmt|,
modifier|*
name|w4
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
literal|4
condition|;
operator|++
name|i
control|)
block|{
name|QGraphicsWidget
modifier|*
name|wid
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|wid
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|wid
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"w%1"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|wid
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|1
condition|)
name|w1
operator|=
name|wid
expr_stmt|;
elseif|else
if|if
condition|(
name|i
operator|==
literal|2
condition|)
name|w2
operator|=
name|wid
expr_stmt|;
elseif|else
if|if
condition|(
name|i
operator|==
literal|3
condition|)
name|w3
operator|=
name|wid
expr_stmt|;
block|}
name|w1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|w1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|compareFocusChain
argument_list|(
operator|&
name|view
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|w1
operator|<<
name|w2
operator|<<
name|w3
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|p
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|p
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
name|QLatin1String
argument_list|(
literal|"parent"
argument_list|)
argument_list|)
expr_stmt|;
name|p
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|w1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|compareFocusChain
argument_list|(
operator|&
name|view
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|w1
operator|<<
name|w2
operator|<<
name|w3
argument_list|)
argument_list|)
expr_stmt|;
name|w1
operator|->
name|setParentItem
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|w2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|compareFocusChain
argument_list|(
operator|&
name|view
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|w2
operator|<<
name|w3
argument_list|)
argument_list|)
expr_stmt|;
name|w2
operator|->
name|setParentItem
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|w3
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|compareFocusChain
argument_list|(
operator|&
name|view
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|w3
argument_list|)
argument_list|)
expr_stmt|;
name|w3
operator|->
name|setParentItem
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|p
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|compareFocusChain
argument_list|(
operator|&
name|view
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|p
operator|<<
name|w1
operator|<<
name|w2
operator|<<
name|w3
argument_list|)
argument_list|)
expr_stmt|;
operator|delete
name|p
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
literal|5
condition|;
operator|++
name|i
control|)
block|{
name|QGraphicsWidget
modifier|*
name|wid
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|wid
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|wid
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"w%1"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|wid
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|1
condition|)
name|w1
operator|=
name|wid
expr_stmt|;
elseif|else
if|if
condition|(
name|i
operator|==
literal|2
condition|)
name|w2
operator|=
name|wid
expr_stmt|;
elseif|else
if|if
condition|(
name|i
operator|==
literal|3
condition|)
name|w3
operator|=
name|wid
expr_stmt|;
elseif|else
if|if
condition|(
name|i
operator|==
literal|4
condition|)
name|w4
operator|=
name|wid
expr_stmt|;
block|}
name|w4
operator|->
name|setParentItem
argument_list|(
name|w1
argument_list|)
expr_stmt|;
name|QGraphicsWidget
operator|::
name|setTabOrder
argument_list|(
name|w1
argument_list|,
name|w4
argument_list|)
expr_stmt|;
name|w1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|compareFocusChain
argument_list|(
operator|&
name|view
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|w1
operator|<<
name|w4
operator|<<
name|w2
operator|<<
name|w3
argument_list|)
argument_list|)
expr_stmt|;
name|p
operator|=
operator|new
name|QGraphicsWidget
expr_stmt|;
name|p
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
name|QLatin1String
argument_list|(
literal|"parent"
argument_list|)
argument_list|)
expr_stmt|;
name|p
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|w1
operator|->
name|setParentItem
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|w2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|compareFocusChain
argument_list|(
operator|&
name|view
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|w2
operator|<<
name|w3
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|w2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|compareFocusChain
argument_list|(
operator|&
name|view
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|w2
operator|<<
name|w3
operator|<<
name|p
operator|<<
name|w1
operator|<<
name|w4
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|topLevelWidget_data
name|void
name|tst_QGraphicsWidget
operator|::
name|topLevelWidget_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QString
argument_list|>
argument_list|(
literal|"str"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"test one"
argument_list|)
operator|<<
literal|"foo"
expr_stmt|;
block|}
end_function
begin_comment
comment|// QGraphicsWidget* topLevelWidget() const public
end_comment
begin_function
DECL|function|topLevelWidget
name|void
name|tst_QGraphicsWidget
operator|::
name|topLevelWidget
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QString
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
name|widget
decl_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|topLevelWidget
argument_list|()
argument_list|,
operator|(
name|QGraphicsWidget
operator|*
operator|)
operator|&
name|widget
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|unsetLayoutDirection_data
name|void
name|tst_QGraphicsWidget
operator|::
name|unsetLayoutDirection_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|Qt
operator|::
name|LayoutDirection
argument_list|>
argument_list|(
literal|"layoutDirection"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"rtl"
argument_list|)
operator|<<
name|Qt
operator|::
name|RightToLeft
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"ltr"
argument_list|)
operator|<<
name|Qt
operator|::
name|LeftToRight
expr_stmt|;
block|}
end_function
begin_comment
comment|// void unsetLayoutDirection() public
end_comment
begin_function
DECL|function|unsetLayoutDirection
name|void
name|tst_QGraphicsWidget
operator|::
name|unsetLayoutDirection
parameter_list|()
block|{
name|QApplication
operator|::
name|setLayoutDirection
argument_list|(
name|Qt
operator|::
name|LeftToRight
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|Qt
operator|::
name|LayoutDirection
argument_list|,
name|layoutDirection
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
name|widget
decl_stmt|;
name|QCOMPARE
argument_list|(
name|Qt
operator|::
name|LeftToRight
argument_list|,
name|widget
operator|.
name|layoutDirection
argument_list|()
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|SubQGraphicsWidget
modifier|*
argument_list|>
name|children
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
operator|++
name|i
control|)
block|{
name|SubQGraphicsWidget
modifier|*
name|item
init|=
operator|new
name|SubQGraphicsWidget
argument_list|(
operator|&
name|widget
argument_list|)
decl_stmt|;
name|children
operator|.
name|append
argument_list|(
name|item
argument_list|)
expr_stmt|;
block|}
name|widget
operator|.
name|setLayoutDirection
argument_list|(
name|layoutDirection
argument_list|)
expr_stmt|;
name|widget
operator|.
name|unsetLayoutDirection
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|testAttribute
argument_list|(
name|Qt
operator|::
name|WA_SetLayoutDirection
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|children
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QCOMPARE
argument_list|(
name|children
index|[
name|i
index|]
operator|->
name|layoutDirection
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftToRight
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|focusNextPrevChild_data
name|void
name|tst_QGraphicsWidget
operator|::
name|focusNextPrevChild_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QString
argument_list|>
argument_list|(
literal|"str"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"test one"
argument_list|)
operator|<<
literal|"foo"
expr_stmt|;
block|}
end_function
begin_comment
comment|// bool focusNextPrevChild(bool next) protected
end_comment
begin_function
DECL|function|focusNextPrevChild
name|void
name|tst_QGraphicsWidget
operator|::
name|focusNextPrevChild
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QString
argument_list|,
name|str
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
name|widget
decl_stmt|;
comment|// ### write test after just calling it stops crashing :)
name|widget
operator|.
name|call_focusNextPrevChild
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|verifyFocusChain
name|void
name|tst_QGraphicsWidget
operator|::
name|verifyFocusChain
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
block|{
comment|// parent/child focus
name|SubQGraphicsWidget
modifier|*
name|w
init|=
operator|new
name|SubQGraphicsWidget
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Window
argument_list|)
decl_stmt|;
name|w
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
modifier|*
name|w1_1
init|=
operator|new
name|SubQGraphicsWidget
argument_list|(
name|w
argument_list|)
decl_stmt|;
name|w1_1
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|w
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|w
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|w
operator|->
name|call_focusNextPrevChild
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|w1_1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
operator|delete
name|w
expr_stmt|;
block|}
block|{
comment|// delete item in focus chain and verify chain
name|SubQGraphicsWidget
modifier|*
name|w
init|=
operator|new
name|SubQGraphicsWidget
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Window
argument_list|)
decl_stmt|;
name|SubQGraphicsWidget
modifier|*
name|w1_1
init|=
operator|new
name|SubQGraphicsWidget
argument_list|(
name|w
argument_list|)
decl_stmt|;
name|SubQGraphicsWidget
modifier|*
name|w1_2
init|=
operator|new
name|SubQGraphicsWidget
argument_list|(
name|w
argument_list|)
decl_stmt|;
name|SubQGraphicsWidget
modifier|*
name|w1_3
init|=
operator|new
name|SubQGraphicsWidget
argument_list|(
name|w
argument_list|)
decl_stmt|;
name|w1_1
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|w1_2
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|w1_3
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|w1_1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|w1_1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|->
name|call_focusNextPrevChild
argument_list|(
literal|true
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|w1_2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|->
name|call_focusNextPrevChild
argument_list|(
literal|true
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|w1_3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|w1_1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
operator|delete
name|w1_2
expr_stmt|;
name|w
operator|->
name|call_focusNextPrevChild
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|w1_3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
operator|delete
name|w
expr_stmt|;
block|}
block|{
comment|// parent/child focus
name|SubQGraphicsWidget
modifier|*
name|w
init|=
operator|new
name|SubQGraphicsWidget
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Window
argument_list|)
decl_stmt|;
name|w
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
modifier|*
name|w1_1
init|=
operator|new
name|SubQGraphicsWidget
argument_list|(
name|w
argument_list|)
decl_stmt|;
name|w1_1
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|w
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|w
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|w
operator|->
name|call_focusNextPrevChild
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|w1_1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
operator|delete
name|w
expr_stmt|;
block|}
block|{
comment|// QTBUG-30923:
comment|// Child QGraphicsWidget with tabFocusFirst gets removed& deleted should not crash.
comment|// This case simulates what QtQuick1 does when you have QGraphicsObject based
comment|// item in different qml views that are loaded one after another.
name|QGraphicsItem
modifier|*
name|parent1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|)
decl_stmt|;
comment|// root item
name|scene
operator|.
name|addItem
argument_list|(
name|parent1
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
name|i
operator|++
control|)
block|{
name|SubQGraphicsWidget
modifier|*
name|w1
init|=
operator|new
name|SubQGraphicsWidget
argument_list|(
name|parent1
argument_list|)
decl_stmt|;
name|w1
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|w1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|w1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|w1
argument_list|)
expr_stmt|;
operator|delete
name|w1
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|}
operator|delete
name|parent1
expr_stmt|;
block|}
block|{
comment|// remove the tabFocusFirst widget from the scene.
name|QScopedPointer
argument_list|<
name|QWidget
argument_list|>
name|window
argument_list|(
operator|new
name|QWidget
argument_list|)
decl_stmt|;
name|QVBoxLayout
modifier|*
name|layout
init|=
operator|new
name|QVBoxLayout
decl_stmt|;
name|window
operator|->
name|setLayout
argument_list|(
name|layout
argument_list|)
expr_stmt|;
name|QLineEdit
modifier|*
name|lineEdit
init|=
operator|new
name|QLineEdit
decl_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|lineEdit
argument_list|)
expr_stmt|;
name|QGraphicsView
modifier|*
name|view
init|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|20
argument_list|,
operator|-
literal|20
argument_list|,
literal|200
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|view
argument_list|)
expr_stmt|;
name|view
operator|->
name|setMinimumSize
argument_list|(
literal|150
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
modifier|*
name|w1_1
init|=
operator|new
name|SubQGraphicsWidget
decl_stmt|;
name|w1_1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"w1_1"
argument_list|)
expr_stmt|;
name|w1_1
operator|->
name|setGeometry
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|w1_1
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|w1_1
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
modifier|*
name|w1_2
init|=
operator|new
name|SubQGraphicsWidget
decl_stmt|;
name|w1_2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"w1_2"
argument_list|)
expr_stmt|;
name|w1_2
operator|->
name|setGeometry
argument_list|(
literal|25
argument_list|,
literal|0
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|w1_2
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|w1_2
argument_list|)
expr_stmt|;
name|window
operator|->
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
name|window
operator|.
name|data
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
name|window
operator|.
name|data
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|lineEdit
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|lineEdit
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|w1_1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|w1_2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// remove the tabFocusFirst and insert new item
operator|delete
name|w1_1
expr_stmt|;
comment|// calls _q_removeItemLater
name|SubQGraphicsWidget
modifier|*
name|w1_3
init|=
operator|new
name|SubQGraphicsWidget
decl_stmt|;
name|w1_3
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|w1_3
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"w1_3"
argument_list|)
expr_stmt|;
name|w1_3
operator|->
name|setGeometry
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|w1_3
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|w1_2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Backtab
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|lineEdit
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// tabFocusFirst should now point to w1_2
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|w1_2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|w1_3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|w1_2
argument_list|)
expr_stmt|;
comment|// does not call _q_removeItemLater
operator|delete
name|w1_2
expr_stmt|;
comment|// calls _q_removeItemLater
name|SubQGraphicsWidget
modifier|*
name|w1_4
init|=
operator|new
name|SubQGraphicsWidget
decl_stmt|;
name|w1_4
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|w1_4
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"w1_4"
argument_list|)
expr_stmt|;
name|w1_4
operator|->
name|setGeometry
argument_list|(
literal|75
argument_list|,
literal|0
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|w1_4
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|w1_3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|compareFocusChain
argument_list|(
name|view
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|w1_3
operator|<<
name|w1_4
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Backtab
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|lineEdit
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// tabFocusFirst should now point to w1_3
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|w1_3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|compareFocusChain
argument_list|(
name|view
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|w1_3
operator|<<
name|w1_4
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|updateFocusChainWhenChildDie
name|void
name|tst_QGraphicsWidget
operator|::
name|updateFocusChainWhenChildDie
parameter_list|()
block|{
specifier|const
name|QRect
name|availableGeometry
init|=
name|QGuiApplication
operator|::
name|primaryScreen
argument_list|()
operator|->
name|availableGeometry
argument_list|()
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
literal|150
argument_list|)
expr_stmt|;
name|view
operator|.
name|move
argument_list|(
name|availableGeometry
operator|.
name|topLeft
argument_list|()
operator|+
name|QPoint
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
comment|// delete item in focus chain with no focus and verify chain
name|SubQGraphicsWidget
modifier|*
name|parent
init|=
operator|new
name|SubQGraphicsWidget
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Window
argument_list|)
decl_stmt|;
name|SubQGraphicsWidget
modifier|*
name|w
init|=
operator|new
name|SubQGraphicsWidget
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Window
argument_list|)
decl_stmt|;
name|w
operator|->
name|resize
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|w
operator|->
name|resize
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
modifier|*
name|w1_1
init|=
operator|new
name|SubQGraphicsWidget
argument_list|(
name|w
argument_list|)
decl_stmt|;
name|w1_1
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|w
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|w1_1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|w1_1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QWidget
name|myWidget
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|QLineEdit
name|edit
argument_list|(
operator|&
name|myWidget
argument_list|)
decl_stmt|;
operator|(
operator|new
name|QHBoxLayout
argument_list|(
operator|&
name|myWidget
argument_list|)
operator|)
operator|->
name|addWidget
argument_list|(
operator|&
name|edit
argument_list|)
expr_stmt|;
name|edit
operator|.
name|setMinimumWidth
argument_list|(
literal|160
argument_list|)
expr_stmt|;
comment|// Windows
name|myWidget
operator|.
name|move
argument_list|(
name|availableGeometry
operator|.
name|topLeft
argument_list|()
operator|+
name|QPoint
argument_list|(
literal|350
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|myWidget
operator|.
name|show
argument_list|()
expr_stmt|;
name|edit
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|edit
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
operator|delete
name|w1_1
expr_stmt|;
name|myWidget
operator|.
name|hide
argument_list|()
expr_stmt|;
name|w
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
comment|//We don't crash perfect
name|QVERIFY
argument_list|(
name|w
argument_list|)
expr_stmt|;
specifier|const
name|QPoint
name|center
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|width
argument_list|()
operator|/
literal|2
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|height
argument_list|()
operator|/
literal|2
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|mouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|center
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|center
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|Q_OS_MAC
name|QEXPECT_FAIL
argument_list|(
literal|""
argument_list|,
literal|"QTBUG-23699"
argument_list|,
name|Continue
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QTRY_COMPARE
argument_list|(
name|qApp
operator|->
name|activeWindow
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|w
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sizeHint_data
name|void
name|tst_QGraphicsWidget
operator|::
name|sizeHint_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"layout"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"no layout"
argument_list|)
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"layout"
argument_list|)
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_comment
comment|// QSizeF sizeHint(Qt::SizeHint which, QSizeF const& constraint = QSizeF()) const protected
end_comment
begin_function
DECL|function|sizeHint
name|void
name|tst_QGraphicsWidget
operator|::
name|sizeHint
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|layout
argument_list|)
expr_stmt|;
name|SubQGraphicsWidget
name|widget
decl_stmt|;
if|if
condition|(
name|layout
condition|)
block|{
name|QGraphicsLinearLayout
modifier|*
name|layout
init|=
operator|new
name|QGraphicsLinearLayout
decl_stmt|;
name|widget
operator|.
name|setLayout
argument_list|(
name|layout
argument_list|)
expr_stmt|;
block|}
name|widget
operator|.
name|call_sizeHint
argument_list|(
name|Qt
operator|::
name|MinimumSize
argument_list|,
name|QSizeF
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|consistentPosSizeGeometry_data
name|void
name|tst_QGraphicsWidget
operator|::
name|consistentPosSizeGeometry_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QSizeF
argument_list|>
argument_list|(
literal|"minSize"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QSizeF
argument_list|>
argument_list|(
literal|"maxSize"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QRectF
argument_list|>
argument_list|(
literal|"geometry"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QRectF
argument_list|>
argument_list|(
literal|"expectedGeometry"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"size is valid"
argument_list|)
operator|<<
name|QSizeF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
name|QSizeF
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"size is larger than max"
argument_list|)
operator|<<
name|QSizeF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
name|QSizeF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"size is smaller than min"
argument_list|)
operator|<<
name|QSizeF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
operator|<<
name|QSizeF
argument_list|(
literal|150
argument_list|,
literal|150
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|consistentPosSizeGeometry
name|void
name|tst_QGraphicsWidget
operator|::
name|consistentPosSizeGeometry
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QSizeF
argument_list|,
name|minSize
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QSizeF
argument_list|,
name|maxSize
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QRectF
argument_list|,
name|geometry
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QRectF
argument_list|,
name|expectedGeometry
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|w
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|w
argument_list|)
expr_stmt|;
name|w
operator|->
name|setMinimumSize
argument_list|(
name|minSize
argument_list|)
expr_stmt|;
name|w
operator|->
name|setMaximumSize
argument_list|(
name|maxSize
argument_list|)
expr_stmt|;
name|w
operator|->
name|setGeometry
argument_list|(
name|geometry
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|->
name|geometry
argument_list|()
argument_list|,
name|expectedGeometry
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|->
name|pos
argument_list|()
argument_list|,
name|expectedGeometry
operator|.
name|topLeft
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|->
name|size
argument_list|()
argument_list|,
name|expectedGeometry
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|QRectF
name|otherGeom
init|=
name|QRectF
argument_list|(
name|QPointF
argument_list|(
literal|12.34
argument_list|,
literal|12.34
argument_list|)
argument_list|,
name|minSize
argument_list|)
decl_stmt|;
name|w
operator|->
name|setGeometry
argument_list|(
name|otherGeom
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|->
name|geometry
argument_list|()
argument_list|,
name|otherGeom
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|->
name|pos
argument_list|()
argument_list|,
name|otherGeom
operator|.
name|topLeft
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|->
name|size
argument_list|()
argument_list|,
name|otherGeom
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|w
operator|->
name|setPos
argument_list|(
name|geometry
operator|.
name|topLeft
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|->
name|geometry
argument_list|()
operator|.
name|topLeft
argument_list|()
argument_list|,
name|expectedGeometry
operator|.
name|topLeft
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|->
name|pos
argument_list|()
argument_list|,
name|expectedGeometry
operator|.
name|topLeft
argument_list|()
argument_list|)
expr_stmt|;
name|w
operator|->
name|resize
argument_list|(
name|geometry
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|->
name|geometry
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
name|expectedGeometry
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w
operator|->
name|geometry
argument_list|()
argument_list|,
name|expectedGeometry
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
block|}
end_function
begin_enum
DECL|enum|WhichSize
enum|enum
name|WhichSize
block|{
DECL|enumerator|MinimumWidth
name|MinimumWidth
block|,
DECL|enumerator|PreferredWidth
name|PreferredWidth
block|,
DECL|enumerator|MaximumWidth
name|MaximumWidth
block|,
DECL|enumerator|MinimumHeight
name|MinimumHeight
block|,
DECL|enumerator|PreferredHeight
name|PreferredHeight
block|,
DECL|enumerator|MaximumHeight
name|MaximumHeight
block|,
DECL|enumerator|MinimumSize
name|MinimumSize
block|,
DECL|enumerator|PreferredSize
name|PreferredSize
block|,
DECL|enumerator|MaximumSize
name|MaximumSize
block|,
DECL|enumerator|MinimumSizeHint
name|MinimumSizeHint
block|,
DECL|enumerator|PreferredSizeHint
name|PreferredSizeHint
block|,
DECL|enumerator|MaximumSizeHint
name|MaximumSizeHint
block|,
DECL|enumerator|Size
name|Size
block|,
DECL|enumerator|None
name|None
block|, }
enum|;
end_enum
begin_typedef
DECL|typedef|Inst
typedef|typedef
name|QPair
argument_list|<
name|int
argument_list|,
name|QVariant
argument_list|>
name|Inst
typedef|;
end_typedef
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|Inst
argument_list|)
end_macro
begin_function
DECL|function|setSizes_data
name|void
name|tst_QGraphicsWidget
operator|::
name|setSizes_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|>
argument_list|(
literal|"inputInstructions"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|>
argument_list|(
literal|"compareInstructions"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"minSize1"
argument_list|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSize
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|)
operator|<<
name|Inst
argument_list|(
name|MinimumSize
argument_list|,
name|QSize
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
operator|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSize
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|)
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"minSize2"
argument_list|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|<<
name|Inst
argument_list|(
name|MinimumSize
argument_list|,
name|QSizeF
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|)
operator|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|)
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"minWidth1"
argument_list|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|<<
name|Inst
argument_list|(
name|MinimumWidth
argument_list|,
literal|5.0
argument_list|)
operator|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"minWidth2"
argument_list|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|<<
name|Inst
argument_list|(
name|MinimumWidth
argument_list|,
literal|25.0
argument_list|)
operator|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|25
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"minHeight1"
argument_list|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|<<
name|Inst
argument_list|(
name|MinimumHeight
argument_list|,
literal|5.0
argument_list|)
operator|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"minHeight2"
argument_list|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|<<
name|Inst
argument_list|(
name|MinimumHeight
argument_list|,
literal|25.0
argument_list|)
operator|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|20
argument_list|,
literal|25
argument_list|)
argument_list|)
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"maxSize1"
argument_list|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|)
argument_list|)
operator|<<
name|Inst
argument_list|(
name|MaximumSize
argument_list|,
name|QSizeF
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|)
argument_list|)
operator|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|)
argument_list|)
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"maxSize2"
argument_list|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|)
argument_list|)
operator|<<
name|Inst
argument_list|(
name|MaximumSize
argument_list|,
name|QSizeF
argument_list|(
literal|30
argument_list|,
operator|-
literal|1
argument_list|)
argument_list|)
operator|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|30
argument_list|,
literal|40
argument_list|)
argument_list|)
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"maxSize3"
argument_list|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|)
argument_list|)
operator|<<
name|Inst
argument_list|(
name|MaximumSize
argument_list|,
name|QSizeF
argument_list|(
operator|-
literal|1
argument_list|,
literal|30
argument_list|)
argument_list|)
operator|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|40
argument_list|,
literal|30
argument_list|)
argument_list|)
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"maxWidth1"
argument_list|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|)
argument_list|)
operator|<<
name|Inst
argument_list|(
name|MaximumWidth
argument_list|,
literal|30
argument_list|)
operator|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|30
argument_list|,
literal|40
argument_list|)
argument_list|)
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"maxHeight"
argument_list|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|)
argument_list|)
operator|<<
name|Inst
argument_list|(
name|MaximumHeight
argument_list|,
literal|20
argument_list|)
operator|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|40
argument_list|,
literal|20
argument_list|)
argument_list|)
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"unsetMinSize"
argument_list|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|)
argument_list|)
operator|<<
name|Inst
argument_list|(
name|MinimumSize
argument_list|,
name|QSizeF
argument_list|(
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
argument_list|)
operator|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|MinimumSize
argument_list|,
name|QSizeF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"unsetMaxSize"
argument_list|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSizeF
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|)
argument_list|)
operator|<<
name|Inst
argument_list|(
name|MaximumSize
argument_list|,
name|QSizeF
argument_list|(
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
argument_list|)
operator|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|MaximumSize
argument_list|,
name|QSizeF
argument_list|(
literal|500
argument_list|,
literal|500
argument_list|)
argument_list|)
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"unsetMinSize, expand size to minimumSizeHint"
argument_list|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|MinimumSize
argument_list|,
name|QSize
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSize
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
operator|<<
name|Inst
argument_list|(
name|MinimumSize
argument_list|,
name|QSize
argument_list|(
operator|-
literal|1.0
argument_list|,
operator|-
literal|1.0
argument_list|)
argument_list|)
operator|)
operator|<<
operator|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|()
operator|<<
name|Inst
argument_list|(
name|Size
argument_list|,
name|QSize
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
operator|<<
name|Inst
argument_list|(
name|MinimumSize
argument_list|,
name|QSize
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
operator|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setSizes
name|void
name|tst_QGraphicsWidget
operator|::
name|setSizes
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|,
name|inputInstructions
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QVector
argument_list|<
name|Inst
argument_list|>
argument_list|,
name|compareInstructions
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|SizeHinter
modifier|*
name|widget
init|=
operator|new
name|SizeHinter
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Window
argument_list|)
decl_stmt|;
name|QSizeF
name|min
init|=
name|QSizeF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|QSizeF
name|pref
init|=
name|QSizeF
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
decl_stmt|;
name|QSizeF
name|max
init|=
name|QSizeF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|inputInstructions
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|Inst
name|input
init|=
name|inputInstructions
operator|.
name|at
argument_list|(
name|i
argument_list|)
decl_stmt|;
comment|// defaults
switch|switch
condition|(
name|input
operator|.
name|first
condition|)
block|{
case|case
name|MinimumSize
case|:
name|min
operator|=
name|input
operator|.
name|second
operator|.
name|toSizeF
argument_list|()
expr_stmt|;
break|break;
case|case
name|PreferredSize
case|:
name|pref
operator|=
name|input
operator|.
name|second
operator|.
name|toSizeF
argument_list|()
expr_stmt|;
break|break;
case|case
name|MaximumSize
case|:
name|max
operator|=
name|input
operator|.
name|second
operator|.
name|toSizeF
argument_list|()
expr_stmt|;
break|break;
case|case
name|Size
case|:
name|widget
operator|->
name|resize
argument_list|(
name|input
operator|.
name|second
operator|.
name|toSizeF
argument_list|()
argument_list|)
expr_stmt|;
break|break;
case|case
name|MinimumWidth
case|:
name|widget
operator|->
name|setMinimumWidth
argument_list|(
name|qreal
argument_list|(
name|input
operator|.
name|second
operator|.
name|toDouble
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PreferredWidth
case|:
name|widget
operator|->
name|setPreferredWidth
argument_list|(
name|qreal
argument_list|(
name|input
operator|.
name|second
operator|.
name|toDouble
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|MaximumWidth
case|:
name|widget
operator|->
name|setMaximumWidth
argument_list|(
name|qreal
argument_list|(
name|input
operator|.
name|second
operator|.
name|toDouble
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|MinimumHeight
case|:
name|widget
operator|->
name|setMinimumHeight
argument_list|(
name|qreal
argument_list|(
name|input
operator|.
name|second
operator|.
name|toDouble
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PreferredHeight
case|:
name|widget
operator|->
name|setPreferredHeight
argument_list|(
name|qreal
argument_list|(
name|input
operator|.
name|second
operator|.
name|toDouble
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|MaximumHeight
case|:
name|widget
operator|->
name|setMaximumHeight
argument_list|(
name|qreal
argument_list|(
name|input
operator|.
name|second
operator|.
name|toDouble
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|MinimumSizeHint
case|:
name|widget
operator|->
name|setSizeHint
argument_list|(
name|Qt
operator|::
name|MinimumSize
argument_list|,
name|input
operator|.
name|second
operator|.
name|toSizeF
argument_list|()
argument_list|)
expr_stmt|;
break|break;
case|case
name|PreferredSizeHint
case|:
name|widget
operator|->
name|setSizeHint
argument_list|(
name|Qt
operator|::
name|PreferredSize
argument_list|,
name|input
operator|.
name|second
operator|.
name|toSizeF
argument_list|()
argument_list|)
expr_stmt|;
break|break;
case|case
name|MaximumSizeHint
case|:
name|widget
operator|->
name|setSizeHint
argument_list|(
name|Qt
operator|::
name|MaximumSize
argument_list|,
name|input
operator|.
name|second
operator|.
name|toSizeF
argument_list|()
argument_list|)
expr_stmt|;
break|break;
default|default:
name|qWarning
argument_list|(
literal|"instruction not implemented"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|widget
operator|->
name|setMinimumSize
argument_list|(
name|min
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setPreferredSize
argument_list|(
name|pref
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setMaximumSize
argument_list|(
name|max
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|compareInstructions
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|Inst
name|input
init|=
name|compareInstructions
operator|.
name|at
argument_list|(
name|i
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|input
operator|.
name|first
condition|)
block|{
case|case
name|MinimumSize
case|:
name|QTRY_COMPARE
argument_list|(
name|widget
operator|->
name|minimumSize
argument_list|()
argument_list|,
name|input
operator|.
name|second
operator|.
name|toSizeF
argument_list|()
argument_list|)
expr_stmt|;
break|break;
case|case
name|PreferredSize
case|:
name|QTRY_COMPARE
argument_list|(
name|widget
operator|->
name|preferredSize
argument_list|()
argument_list|,
name|input
operator|.
name|second
operator|.
name|toSizeF
argument_list|()
argument_list|)
expr_stmt|;
break|break;
case|case
name|MaximumSize
case|:
name|QTRY_COMPARE
argument_list|(
name|widget
operator|->
name|maximumSize
argument_list|()
argument_list|,
name|input
operator|.
name|second
operator|.
name|toSizeF
argument_list|()
argument_list|)
expr_stmt|;
break|break;
case|case
name|Size
case|:
name|QTRY_COMPARE
argument_list|(
name|widget
operator|->
name|size
argument_list|()
argument_list|,
name|input
operator|.
name|second
operator|.
name|toSizeF
argument_list|()
argument_list|)
expr_stmt|;
break|break;
case|case
name|MinimumWidth
case|:
name|QTRY_COMPARE
argument_list|(
name|widget
operator|->
name|minimumWidth
argument_list|()
argument_list|,
name|qreal
argument_list|(
name|input
operator|.
name|second
operator|.
name|toDouble
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|PreferredWidth
case|:
name|QTRY_COMPARE
argument_list|(
name|widget
operator|->
name|preferredWidth
argument_list|()
argument_list|,
name|qreal
argument_list|(
name|input
operator|.
name|second
operator|.
name|toDouble
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|MaximumWidth
case|:
name|QTRY_COMPARE
argument_list|(
name|widget
operator|->
name|maximumWidth
argument_list|()
argument_list|,
name|qreal
argument_list|(
name|input
operator|.
name|second
operator|.
name|toDouble
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|qWarning
argument_list|(
literal|"instruction not implemented"
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
operator|delete
name|widget
expr_stmt|;
block|}
end_function
begin_function
DECL|function|closePopupOnOutsideClick
name|void
name|tst_QGraphicsWidget
operator|::
name|closePopupOnOutsideClick
parameter_list|()
block|{
name|QGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|QGraphicsWidget
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Popup
argument_list|)
decl_stmt|;
name|widget
operator|->
name|resize
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|widget
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|event
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|150
argument_list|,
literal|150
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|widget
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|event
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task236127_bspTreeIndexFails
name|void
name|tst_QGraphicsWidget
operator|::
name|task236127_bspTreeIndexFails
parameter_list|()
block|{
name|QGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|widget2
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|widget
operator|->
name|resize
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|widget2
operator|->
name|resize
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|widget2
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"widget"
argument_list|)
expr_stmt|;
name|widget2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"widget2"
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget2
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|scene
operator|.
name|itemAt
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setGeometry
argument_list|(
literal|0
argument_list|,
literal|112
argument_list|,
literal|360
argument_list|,
literal|528
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|15
argument_list|,
literal|120
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget
argument_list|)
expr_stmt|;
name|widget2
operator|->
name|setGeometry
argument_list|(
literal|0
argument_list|,
literal|573
argument_list|,
literal|360
argument_list|,
literal|67
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|15
argument_list|,
literal|120
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|50
argument_list|,
literal|585
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|defaultSize
name|void
name|tst_QGraphicsWidget
operator|::
name|defaultSize
parameter_list|()
block|{
name|SubQGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|SubQGraphicsWidget
decl_stmt|;
name|widget
operator|->
name|setMinimumSize
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QSizeF
name|initialSize
init|=
name|widget
operator|->
name|size
argument_list|()
decl_stmt|;
name|widget
operator|->
name|resize
argument_list|(
name|initialSize
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|->
name|geometry
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
name|initialSize
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setVisible
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setMinimumSize
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setPreferredSize
argument_list|(
literal|60
argument_list|,
literal|60
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setMaximumSize
argument_list|(
literal|110
argument_list|,
literal|110
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setVisible
argument_list|(
literal|true
argument_list|)
expr_stmt|;
comment|// should still have its size set to initialsize
name|QTRY_COMPARE
argument_list|(
name|widget
operator|->
name|geometry
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
name|initialSize
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|explicitMouseGrabber
name|void
name|tst_QGraphicsWidget
operator|::
name|explicitMouseGrabber
parameter_list|()
block|{
name|QGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|EventSpy
name|widgetGrabEventSpy
argument_list|(
name|widget
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
decl_stmt|;
name|EventSpy
name|widgetUngrabEventSpy
argument_list|(
name|widget
argument_list|,
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
decl_stmt|;
comment|// Grab without scene
name|QTest
operator|::
name|ignoreMessage
argument_list|(
name|QtWarningMsg
argument_list|,
literal|"QGraphicsItem::grabMouse: cannot grab mouse without scene"
argument_list|)
expr_stmt|;
name|widget
operator|->
name|grabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|ignoreMessage
argument_list|(
name|QtWarningMsg
argument_list|,
literal|"QGraphicsItem::ungrabMouse: cannot ungrab mouse without scene"
argument_list|)
expr_stmt|;
name|widget
operator|->
name|ungrabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetUngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Add to scene
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
comment|// Ungrab while not grabber
name|QTest
operator|::
name|ignoreMessage
argument_list|(
name|QtWarningMsg
argument_list|,
literal|"QGraphicsItem::ungrabMouse: not a mouse grabber"
argument_list|)
expr_stmt|;
name|widget
operator|->
name|ungrabMouse
argument_list|()
expr_stmt|;
comment|// Simple grab with scene
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|)
expr_stmt|;
name|widget
operator|->
name|grabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|widget
operator|->
name|ungrabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetUngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Grab while grabbing
name|widget
operator|->
name|grabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|ignoreMessage
argument_list|(
name|QtWarningMsg
argument_list|,
literal|"QGraphicsItem::grabMouse: already a mouse grabber"
argument_list|)
expr_stmt|;
name|widget
operator|->
name|grabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetUngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|widget
operator|->
name|ungrabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetUngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// Add two more widgets to the scene
name|QGraphicsWidget
modifier|*
name|widget2
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget2
argument_list|)
expr_stmt|;
name|EventSpy
name|widget2GrabEventSpy
argument_list|(
name|widget2
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
decl_stmt|;
name|EventSpy
name|widget2UngrabEventSpy
argument_list|(
name|widget2
argument_list|,
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|widget3
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget3
argument_list|)
expr_stmt|;
name|EventSpy
name|widget3GrabEventSpy
argument_list|(
name|widget3
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
decl_stmt|;
name|EventSpy
name|widget3UngrabEventSpy
argument_list|(
name|widget3
argument_list|,
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
decl_stmt|;
name|widget
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"widget"
argument_list|)
expr_stmt|;
name|widget2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"widget2"
argument_list|)
expr_stmt|;
name|widget3
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"widget3"
argument_list|)
expr_stmt|;
comment|// Simple nested grabbing
name|widget
operator|->
name|grabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget
argument_list|)
expr_stmt|;
name|widget2
operator|->
name|grabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetUngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2GrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget2
argument_list|)
expr_stmt|;
name|widget3
operator|->
name|grabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2UngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget3GrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget3
argument_list|)
expr_stmt|;
name|widget3
operator|->
name|ungrabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget3UngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2GrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget2
argument_list|)
expr_stmt|;
name|widget2
operator|->
name|ungrabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2UngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget
argument_list|)
expr_stmt|;
name|widget
operator|->
name|ungrabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// Out of order ungrab
name|widget
operator|->
name|grabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|widget2
operator|->
name|grabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2GrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|widget3
operator|->
name|grabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget3GrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|widget2
operator|->
name|ungrabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget3UngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2UngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|implicitMouseGrabber
name|void
name|tst_QGraphicsWidget
operator|::
name|implicitMouseGrabber
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|widget
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
comment|// can grab mouse
name|widget
operator|->
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|EventSpy
name|widgetGrabEventSpy
argument_list|(
name|widget
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
decl_stmt|;
name|EventSpy
name|widgetUngrabEventSpy
argument_list|(
name|widget
argument_list|,
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|)
expr_stmt|;
comment|// Click on an item, see if gain and lose implicit mouse grab.
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetUngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Click on an item that already grabs the mouse. Shouldn't have any effect.
name|widget
operator|->
name|grabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetUngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|widget
operator|->
name|ungrabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetUngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// Implicit mouse grabber tries to explicitly grab the mouse
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|widget
operator|->
name|grabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetUngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetUngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|widget
operator|->
name|ungrabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetUngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|// Arrival of a new widget
name|QGraphicsWidget
modifier|*
name|widget2
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|widget2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
comment|// can grab mouse
name|widget2
operator|->
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|widget2
operator|->
name|setPos
argument_list|(
literal|205
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|EventSpy
name|widget2GrabEventSpy
argument_list|(
name|widget2
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
decl_stmt|;
name|EventSpy
name|widget2UngrabEventSpy
argument_list|(
name|widget2
argument_list|,
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget2
argument_list|)
expr_stmt|;
comment|// Implicit grab while there's an explicit grab is not possible.
name|widget
operator|->
name|grabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|250
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2GrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2UngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetUngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|GrabOnPressItem
class|class
name|GrabOnPressItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|GrabOnPressItem
name|GrabOnPressItem
parameter_list|(
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|)
member_init_list|,
name|npress
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|nrelease
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|ndoubleClick
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|ngrab
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|nungrab
argument_list|(
literal|0
argument_list|)
block|{     }
DECL|member|npress
name|int
name|npress
decl_stmt|;
DECL|member|nrelease
name|int
name|nrelease
decl_stmt|;
DECL|member|ndoubleClick
name|int
name|ndoubleClick
decl_stmt|;
DECL|member|ngrab
name|int
name|ngrab
decl_stmt|;
DECL|member|nungrab
name|int
name|nungrab
decl_stmt|;
protected|protected:
DECL|function|sceneEvent
name|bool
name|sceneEvent
parameter_list|(
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
switch|switch
condition|(
name|event
operator|->
name|type
argument_list|()
condition|)
block|{
case|case
name|QEvent
operator|::
name|GrabMouse
case|:
operator|++
name|ngrab
expr_stmt|;
break|break;
case|case
name|QEvent
operator|::
name|UngrabMouse
case|:
operator|++
name|nungrab
expr_stmt|;
break|break;
default|default:
break|break;
block|}
return|return
name|QGraphicsRectItem
operator|::
name|sceneEvent
argument_list|(
name|event
argument_list|)
return|;
block|}
DECL|function|mousePressEvent
name|void
name|mousePressEvent
parameter_list|(
name|QGraphicsSceneMouseEvent
modifier|*
parameter_list|)
block|{
name|grabMouse
argument_list|()
expr_stmt|;
operator|++
name|npress
expr_stmt|;
block|}
DECL|function|mouseReleaseEvent
name|void
name|mouseReleaseEvent
parameter_list|(
name|QGraphicsSceneMouseEvent
modifier|*
parameter_list|)
block|{
name|ungrabMouse
argument_list|()
expr_stmt|;
operator|++
name|nrelease
expr_stmt|;
block|}
DECL|function|mouseDoubleClickEvent
name|void
name|mouseDoubleClickEvent
parameter_list|(
name|QGraphicsSceneMouseEvent
modifier|*
parameter_list|)
block|{
operator|++
name|ndoubleClick
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|doubleClickAfterExplicitMouseGrab
name|void
name|tst_QGraphicsWidget
operator|::
name|doubleClickAfterExplicitMouseGrab
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|GrabOnPressItem
modifier|*
name|item
init|=
operator|new
name|GrabOnPressItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|npress
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|ngrab
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButtons
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|nrelease
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|nungrab
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseDoubleClick
argument_list|)
decl_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|ndoubleClick
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|ngrab
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButtons
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|nrelease
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|nungrab
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|popupMouseGrabber
name|void
name|tst_QGraphicsWidget
operator|::
name|popupMouseGrabber
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|QGraphicsWidget
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Popup
argument_list|)
decl_stmt|;
name|widget
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
comment|// can grab mouse
name|widget
operator|->
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|EventSpy
name|widgetGrabEventSpy
argument_list|(
name|widget
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
decl_stmt|;
name|EventSpy
name|widgetUngrabEventSpy
argument_list|(
name|widget
argument_list|,
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
decl_stmt|;
comment|// Simply adding a visible popup to the scene immediately grabs the mouse.
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget
argument_list|)
expr_stmt|;
comment|// Hiding it loses the grab again.
name|widget
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetUngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// Showing it grabs the mouse again
name|widget
operator|->
name|show
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetGrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget
argument_list|)
expr_stmt|;
comment|// Add two popups
name|QGraphicsWidget
modifier|*
name|widget2
init|=
operator|new
name|QGraphicsWidget
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Popup
argument_list|)
decl_stmt|;
name|widget2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
comment|// can grab mouse
name|widget2
operator|->
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|EventSpy
name|widget2GrabEventSpy
argument_list|(
name|widget2
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
decl_stmt|;
name|EventSpy
name|widget2UngrabEventSpy
argument_list|(
name|widget2
argument_list|,
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|widget3
init|=
operator|new
name|QGraphicsWidget
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Popup
argument_list|)
decl_stmt|;
name|widget3
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
comment|// can grab mouse
name|widget3
operator|->
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|EventSpy
name|widget3GrabEventSpy
argument_list|(
name|widget3
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
decl_stmt|;
name|EventSpy
name|widget3UngrabEventSpy
argument_list|(
name|widget3
argument_list|,
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
decl_stmt|;
comment|// Adding to the scene grabs
name|scene
operator|.
name|addItem
argument_list|(
name|widget2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widgetUngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2GrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget2
argument_list|)
expr_stmt|;
comment|// Adding to the scene grabs again
name|scene
operator|.
name|addItem
argument_list|(
name|widget3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2UngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget3GrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget3
argument_list|)
expr_stmt|;
comment|// Hiding the topmost widget causes widget 2 to regain grab.
name|widget3
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2GrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget3UngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget2
argument_list|)
expr_stmt|;
name|widget3
operator|->
name|show
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2UngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget3GrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget3
argument_list|)
expr_stmt|;
comment|// Clicking outside the popup still causes it to close (despite that it's
comment|// an explicit mouse grabber).
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|500
argument_list|,
literal|500
argument_list|)
argument_list|)
expr_stmt|;
comment|// outside
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QVERIFY
argument_list|(
operator|!
name|widget3
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget3UngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2GrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|widget2
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|widget
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|widget3
operator|->
name|show
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget3GrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2UngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget3
argument_list|)
expr_stmt|;
comment|// This is something of a curiosity. What happens if you call
comment|// ungrabMouse() on a popup? The answer is - it loses the grab. If you
comment|// hide and show the popup again, it will regain the grab.
name|widget3
operator|->
name|ungrabMouse
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget3UngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2GrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget2
argument_list|)
expr_stmt|;
name|widget3
operator|->
name|hide
argument_list|()
expr_stmt|;
name|widget3
operator|->
name|show
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget3GrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2UngrabEventSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget3
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|windowFlags_data
name|void
name|tst_QGraphicsWidget
operator|::
name|windowFlags_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"inputFlags"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"outputFlags"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"nil"
argument_list|)
operator|<<
literal|0
operator|<<
literal|0
expr_stmt|;
comment|// Window types
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Qt::Window"
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|Window
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|Window
operator||
name|Qt
operator|::
name|WindowTitleHint
operator||
name|Qt
operator|::
name|WindowSystemMenuHint
operator||
name|Qt
operator|::
name|WindowMinimizeButtonHint
operator||
name|Qt
operator|::
name|WindowMaximizeButtonHint
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Qt::SubWindow"
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|SubWindow
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|SubWindow
operator||
name|Qt
operator|::
name|WindowTitleHint
operator||
name|Qt
operator|::
name|WindowSystemMenuHint
operator||
name|Qt
operator|::
name|WindowMinimizeButtonHint
operator||
name|Qt
operator|::
name|WindowMaximizeButtonHint
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Qt::Dialog"
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|Dialog
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|Dialog
operator||
name|Qt
operator|::
name|WindowTitleHint
operator||
name|Qt
operator|::
name|WindowSystemMenuHint
operator||
name|Qt
operator|::
name|WindowContextHelpButtonHint
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Qt::Sheet"
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|Sheet
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|Sheet
operator||
name|Qt
operator|::
name|WindowTitleHint
operator||
name|Qt
operator|::
name|WindowSystemMenuHint
operator||
name|Qt
operator|::
name|WindowContextHelpButtonHint
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Qt::Tool"
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|Tool
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|Tool
operator||
name|Qt
operator|::
name|WindowTitleHint
operator||
name|Qt
operator|::
name|WindowSystemMenuHint
argument_list|)
expr_stmt|;
comment|// Custom window flags
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Qt::FramelessWindowHint"
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|FramelessWindowHint
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|FramelessWindowHint
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Qt::CustomizeWindowHint"
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|CustomizeWindowHint
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|CustomizeWindowHint
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|windowFlags
name|void
name|tst_QGraphicsWidget
operator|::
name|windowFlags
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|inputFlags
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|outputFlags
argument_list|)
expr_stmt|;
comment|// Construct with flags set already
name|QGraphicsWidget
name|widget
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|WindowFlags
argument_list|(
name|inputFlags
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|windowFlags
argument_list|()
argument_list|,
name|Qt
operator|::
name|WindowFlags
argument_list|(
name|outputFlags
argument_list|)
argument_list|)
expr_stmt|;
comment|// Set flags after construction
name|QGraphicsWidget
name|widget2
decl_stmt|;
name|widget2
operator|.
name|setWindowFlags
argument_list|(
name|Qt
operator|::
name|WindowFlags
argument_list|(
name|inputFlags
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2
operator|.
name|windowFlags
argument_list|()
argument_list|,
name|Qt
operator|::
name|WindowFlags
argument_list|(
name|outputFlags
argument_list|)
argument_list|)
expr_stmt|;
comment|// Reset flags
name|widget2
operator|.
name|setWindowFlags
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|widget2
operator|.
name|windowFlags
argument_list|()
argument_list|)
expr_stmt|;
comment|// Set flags back again
name|widget2
operator|.
name|setWindowFlags
argument_list|(
name|Qt
operator|::
name|WindowFlags
argument_list|(
name|inputFlags
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget2
operator|.
name|windowFlags
argument_list|()
argument_list|,
name|Qt
operator|::
name|WindowFlags
argument_list|(
name|outputFlags
argument_list|)
argument_list|)
expr_stmt|;
comment|// Construct with custom flags set already
name|QGraphicsWidget
name|widget3
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|WindowFlags
argument_list|(
name|inputFlags
operator||
name|Qt
operator|::
name|FramelessWindowHint
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|widget3
operator|.
name|windowFlags
argument_list|()
argument_list|,
name|Qt
operator|::
name|WindowFlags
argument_list|(
name|inputFlags
operator||
name|Qt
operator|::
name|FramelessWindowHint
argument_list|)
argument_list|)
expr_stmt|;
comment|// Set custom flags after construction
name|QGraphicsWidget
name|widget4
decl_stmt|;
name|widget4
operator|.
name|setWindowFlags
argument_list|(
name|Qt
operator|::
name|WindowFlags
argument_list|(
name|inputFlags
operator||
name|Qt
operator|::
name|FramelessWindowHint
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget4
operator|.
name|windowFlags
argument_list|()
argument_list|,
name|Qt
operator|::
name|WindowFlags
argument_list|(
name|inputFlags
operator||
name|Qt
operator|::
name|FramelessWindowHint
argument_list|)
argument_list|)
expr_stmt|;
comment|// Reset flags
name|widget4
operator|.
name|setWindowFlags
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|widget4
operator|.
name|windowFlags
argument_list|()
argument_list|)
expr_stmt|;
comment|// Set custom flags back again
name|widget4
operator|.
name|setWindowFlags
argument_list|(
name|Qt
operator|::
name|WindowFlags
argument_list|(
name|inputFlags
operator||
name|Qt
operator|::
name|FramelessWindowHint
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget4
operator|.
name|windowFlags
argument_list|()
argument_list|,
name|Qt
operator|::
name|WindowFlags
argument_list|(
name|inputFlags
operator||
name|Qt
operator|::
name|FramelessWindowHint
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|widget5
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|widget5
operator|->
name|setWindowFlags
argument_list|(
name|Qt
operator|::
name|WindowFlags
argument_list|(
name|inputFlags
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget5
operator|->
name|windowFlags
argument_list|()
argument_list|,
name|Qt
operator|::
name|WindowFlags
argument_list|(
name|outputFlags
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsWidget
name|window
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Window
argument_list|)
decl_stmt|;
name|widget5
operator|->
name|setParentItem
argument_list|(
operator|&
name|window
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget5
operator|->
name|windowFlags
argument_list|()
argument_list|,
name|Qt
operator|::
name|WindowFlags
argument_list|(
name|outputFlags
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|shortcutsDeletion
name|void
name|tst_QGraphicsWidget
operator|::
name|shortcutsDeletion
parameter_list|()
block|{
name|QGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|widget2
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|widget
operator|->
name|setMinimumSize
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|)
expr_stmt|;
name|QWidgetAction
modifier|*
name|del
init|=
operator|new
name|QWidgetAction
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|del
operator|->
name|setIcon
argument_list|(
name|QIcon
argument_list|(
literal|"edit-delete"
argument_list|)
argument_list|)
expr_stmt|;
name|del
operator|->
name|setShortcut
argument_list|(
name|Qt
operator|::
name|Key_Delete
argument_list|)
expr_stmt|;
name|del
operator|->
name|setShortcutContext
argument_list|(
name|Qt
operator|::
name|WidgetShortcut
argument_list|)
expr_stmt|;
name|widget2
operator|->
name|addAction
argument_list|(
name|del
argument_list|)
expr_stmt|;
name|widget2
operator|->
name|addAction
argument_list|(
name|del
argument_list|)
expr_stmt|;
operator|delete
name|widget
expr_stmt|;
block|}
end_function
begin_class
DECL|class|MessUpPainterWidget
class|class
name|MessUpPainterWidget
super|:
specifier|public
name|QGraphicsWidget
block|{
public|public:
DECL|function|MessUpPainterWidget
name|MessUpPainterWidget
parameter_list|(
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|,
name|Qt
operator|::
name|WindowFlags
name|wFlags
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsWidget
argument_list|(
name|parent
argument_list|,
name|wFlags
argument_list|)
block|{}
DECL|function|paintWindowFrame
name|void
name|paintWindowFrame
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
name|widget
parameter_list|)
block|{
name|QCOMPARE
argument_list|(
name|painter
operator|->
name|opacity
argument_list|()
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|painter
operator|->
name|setOpacity
argument_list|(
literal|0.0
argument_list|)
expr_stmt|;
name|QGraphicsWidget
operator|::
name|paintWindowFrame
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|widget
argument_list|)
expr_stmt|;
block|}
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
name|widget
parameter_list|)
block|{
name|QCOMPARE
argument_list|(
name|painter
operator|->
name|opacity
argument_list|()
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|painter
operator|->
name|drawRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsWidget
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|widget
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|painterStateProtectionOnWindowFrame
name|void
name|tst_QGraphicsWidget
operator|::
name|painterStateProtectionOnWindowFrame
parameter_list|()
block|{
name|MessUpPainterWidget
modifier|*
name|widget
init|=
operator|new
name|MessUpPainterWidget
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Window
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|300
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|ProxyStyle
class|class
name|ProxyStyle
super|:
specifier|public
name|QCommonStyle
block|{
public|public:
DECL|function|ProxyStyle
name|ProxyStyle
parameter_list|(
name|QStyle
modifier|*
name|proxyStyle
parameter_list|)
member_init_list|:
name|QCommonStyle
argument_list|()
block|{
name|m_proxyStyle
operator|=
name|proxyStyle
expr_stmt|;
block|}
DECL|function|pixelMetric
name|int
name|pixelMetric
parameter_list|(
name|QStyle
operator|::
name|PixelMetric
name|metric
parameter_list|,
specifier|const
name|QStyleOption
modifier|*
name|option
init|=
literal|0
parameter_list|,
specifier|const
name|QWidget
modifier|*
name|widget
init|=
literal|0
parameter_list|)
specifier|const
block|{
return|return
name|m_proxyStyle
operator|->
name|pixelMetric
argument_list|(
name|metric
argument_list|,
name|option
argument_list|,
name|widget
argument_list|)
return|;
block|}
private|private:
DECL|member|m_proxyStyle
name|QStyle
modifier|*
name|m_proxyStyle
decl_stmt|;
block|}
class|;
end_class
begin_class
DECL|class|StyledGraphicsWidget
class|class
name|StyledGraphicsWidget
super|:
specifier|public
name|QGraphicsWidget
block|{
public|public:
DECL|function|StyledGraphicsWidget
name|StyledGraphicsWidget
parameter_list|(
name|bool
name|useOwnStyle
parameter_list|)
member_init_list|:
name|QGraphicsWidget
argument_list|()
member_init_list|,
name|m_style
argument_list|(
literal|0
argument_list|)
block|{
if|if
condition|(
name|useOwnStyle
condition|)
block|{
name|QStyle
modifier|*
name|oldStyle
init|=
name|style
argument_list|()
decl_stmt|;
name|m_style
operator|=
operator|new
name|ProxyStyle
argument_list|(
name|oldStyle
argument_list|)
expr_stmt|;
name|setStyle
argument_list|(
name|m_style
argument_list|)
expr_stmt|;
block|}
name|style
argument_list|()
operator|->
name|pixelMetric
argument_list|(
name|QStyle
operator|::
name|PM_SmallIconSize
argument_list|)
expr_stmt|;
comment|// crash when style() is still in widgetStyles
block|}
DECL|function|~StyledGraphicsWidget
name|~
name|StyledGraphicsWidget
parameter_list|()
block|{
operator|delete
name|m_style
expr_stmt|;
block|}
private|private:
DECL|member|m_style
name|QStyle
modifier|*
name|m_style
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|task243004_setStyleCrash
name|void
name|tst_QGraphicsWidget
operator|::
name|task243004_setStyleCrash
parameter_list|()
block|{
name|QGraphicsItem
modifier|*
name|item1
init|=
operator|new
name|StyledGraphicsWidget
argument_list|(
literal|true
argument_list|)
decl_stmt|;
operator|delete
name|item1
expr_stmt|;
comment|// item1 not removed from widgetStyles
name|QGraphicsItem
modifier|*
name|item2
init|=
operator|new
name|StyledGraphicsWidget
argument_list|(
literal|false
argument_list|)
decl_stmt|;
operator|delete
name|item2
expr_stmt|;
block|}
end_function
begin_class
DECL|class|GraphicsWidget_task250119
class|class
name|GraphicsWidget_task250119
super|:
specifier|public
name|QGraphicsWidget
block|{
public|public:
DECL|function|GraphicsWidget_task250119
name|GraphicsWidget_task250119
parameter_list|()
member_init_list|:
name|shortcutEvents
argument_list|(
literal|0
argument_list|)
block|{
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|resize
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
block|}
DECL|member|shortcutEvents
name|int
name|shortcutEvents
decl_stmt|;
private|private:
DECL|function|event
name|bool
name|event
parameter_list|(
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
name|event
operator|->
name|type
argument_list|()
operator|==
name|QEvent
operator|::
name|Shortcut
condition|)
name|shortcutEvents
operator|++
expr_stmt|;
return|return
name|QGraphicsWidget
operator|::
name|event
argument_list|(
name|event
argument_list|)
return|;
block|}
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
if|if
condition|(
name|hasFocus
argument_list|()
condition|)
block|{
name|painter
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|,
name|Qt
operator|::
name|DashLine
argument_list|)
argument_list|)
expr_stmt|;
name|painter
operator|->
name|drawRect
argument_list|(
name|rect
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|painter
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|,
name|Qt
operator|::
name|SolidLine
argument_list|)
argument_list|)
expr_stmt|;
name|painter
operator|->
name|fillRect
argument_list|(
name|rect
argument_list|()
operator|.
name|adjusted
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|,
operator|-
literal|2
argument_list|,
operator|-
literal|2
argument_list|)
argument_list|,
name|Qt
operator|::
name|yellow
argument_list|)
expr_stmt|;
name|painter
operator|->
name|drawRect
argument_list|(
name|rect
argument_list|()
operator|.
name|adjusted
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|,
operator|-
literal|2
argument_list|,
operator|-
literal|2
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|task250119_shortcutContext
name|void
name|tst_QGraphicsWidget
operator|::
name|task250119_shortcutContext
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
operator|(
name|QWidget
operator|*
operator|)
operator|&
name|view
argument_list|)
expr_stmt|;
comment|// *** Event: ***
name|GraphicsWidget_task250119
name|w_event
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|w_event
argument_list|)
expr_stmt|;
specifier|const
name|int
name|id
init|=
name|w_event
operator|.
name|grabShortcut
argument_list|(
name|Qt
operator|::
name|Key_A
argument_list|,
name|Qt
operator|::
name|WidgetWithChildrenShortcut
argument_list|)
decl_stmt|;
name|w_event
operator|.
name|setShortcutEnabled
argument_list|(
name|id
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|w_event
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
operator|&
name|view
argument_list|,
name|Qt
operator|::
name|Key_A
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w_event
operator|.
name|shortcutEvents
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|w_event
operator|.
name|clearFocus
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
operator|&
name|view
argument_list|,
name|Qt
operator|::
name|Key_A
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|w_event
operator|.
name|shortcutEvents
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
operator|&
name|w_event
argument_list|)
expr_stmt|;
comment|// *** Signal: ***
name|GraphicsWidget_task250119
name|w_signal
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|w_signal
argument_list|)
expr_stmt|;
name|QAction
name|action
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|action
operator|.
name|setShortcut
argument_list|(
name|Qt
operator|::
name|Key_B
argument_list|)
expr_stmt|;
name|action
operator|.
name|setShortcutContext
argument_list|(
name|Qt
operator|::
name|WidgetWithChildrenShortcut
argument_list|)
expr_stmt|;
name|QSignalSpy
name|spy
argument_list|(
operator|&
name|action
argument_list|,
name|SIGNAL
argument_list|(
name|triggered
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|w_signal
operator|.
name|addAction
argument_list|(
operator|&
name|action
argument_list|)
expr_stmt|;
name|w_signal
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
operator|&
name|view
argument_list|,
name|Qt
operator|::
name|Key_B
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|w_signal
operator|.
name|clearFocus
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
operator|&
name|view
argument_list|,
name|Qt
operator|::
name|Key_B
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
operator|&
name|w_signal
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|ClippingAndTransformsScene
class|class
name|ClippingAndTransformsScene
super|:
specifier|public
name|QGraphicsScene
block|{
public|public:
DECL|member|drawnItems
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|drawnItems
decl_stmt|;
protected|protected:
DECL|function|drawItems
name|void
name|drawItems
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
name|int
name|numItems
parameter_list|,
name|QGraphicsItem
modifier|*
name|items
index|[]
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
name|options
index|[]
parameter_list|,
name|QWidget
modifier|*
name|widget
init|=
literal|0
parameter_list|)
block|{
name|drawnItems
operator|.
name|clear
argument_list|()
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|numItems
condition|;
operator|++
name|i
control|)
name|drawnItems
operator|<<
name|items
index|[
name|i
index|]
expr_stmt|;
name|QGraphicsScene
operator|::
name|drawItems
argument_list|(
name|painter
argument_list|,
name|numItems
argument_list|,
name|items
argument_list|,
name|options
argument_list|,
name|widget
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_class
DECL|class|RectWidget
class|class
name|RectWidget
super|:
specifier|public
name|QGraphicsWidget
block|{
public|public:
DECL|function|RectWidget
name|RectWidget
parameter_list|(
name|Qt
operator|::
name|GlobalColor
name|color
parameter_list|,
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsWidget
argument_list|(
name|parent
argument_list|)
member_init_list|,
name|mColor
argument_list|(
name|color
argument_list|)
block|{}
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
name|painter
operator|->
name|setBrush
argument_list|(
name|QBrush
argument_list|(
name|mColor
argument_list|)
argument_list|)
expr_stmt|;
name|painter
operator|->
name|drawRect
argument_list|(
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|member|mColor
name|Qt
operator|::
name|GlobalColor
name|mColor
decl_stmt|;
block|}
class|;
end_class
begin_class
DECL|class|RectItem
class|class
name|RectItem
super|:
specifier|public
name|QGraphicsItem
block|{
public|public:
DECL|function|RectItem
name|RectItem
parameter_list|(
name|Qt
operator|::
name|GlobalColor
name|color
parameter_list|,
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsItem
argument_list|(
name|parent
argument_list|)
member_init_list|,
name|mColor
argument_list|(
name|color
argument_list|)
block|{}
DECL|function|boundingRect
name|QRectF
name|boundingRect
parameter_list|()
specifier|const
block|{
return|return
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
return|;
block|}
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
name|painter
operator|->
name|setBrush
argument_list|(
name|QBrush
argument_list|(
name|mColor
argument_list|)
argument_list|)
expr_stmt|;
name|painter
operator|->
name|drawRect
argument_list|(
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|member|mColor
name|Qt
operator|::
name|GlobalColor
name|mColor
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|ensureClipping
name|void
name|tst_QGraphicsWidget
operator|::
name|ensureClipping
parameter_list|()
block|{
name|ClippingAndTransformsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
comment|//A root that clip children
name|RectWidget
modifier|*
name|clipWidget
init|=
operator|new
name|RectWidget
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|clipWidget
argument_list|)
expr_stmt|;
name|clipWidget
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
comment|//a child
name|RectWidget
modifier|*
name|childWidget
init|=
operator|new
name|RectWidget
argument_list|(
name|Qt
operator|::
name|red
argument_list|,
name|clipWidget
argument_list|)
decl_stmt|;
name|clipWidget
operator|->
name|setGeometry
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|childWidget
operator|->
name|setGeometry
argument_list|(
name|QRectF
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
comment|//We put a QGraphicsItem to be sure this one is also paint
name|RectItem
modifier|*
name|childitem
init|=
operator|new
name|RectItem
argument_list|(
name|Qt
operator|::
name|blue
argument_list|,
name|clipWidget
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setOptimizationFlag
argument_list|(
name|QGraphicsView
operator|::
name|IndirectPainting
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|expected
decl_stmt|;
name|expected
operator|<<
name|clipWidget
operator|<<
name|childWidget
operator|<<
name|childitem
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|scene
operator|.
name|drawnItems
operator|.
name|contains
argument_list|(
name|clipWidget
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|drawnItems
operator|.
name|contains
argument_list|(
name|childWidget
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|drawnItems
operator|.
name|contains
argument_list|(
name|childitem
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|ItemChangeTester
class|class
name|ItemChangeTester
super|:
specifier|public
name|QGraphicsWidget
block|{
public|public:
DECL|function|ItemChangeTester
name|ItemChangeTester
parameter_list|()
block|{
name|setFlag
argument_list|(
name|ItemSendsGeometryChanges
argument_list|)
expr_stmt|;
name|clear
argument_list|()
expr_stmt|;
block|}
DECL|function|ItemChangeTester
name|ItemChangeTester
parameter_list|(
name|QGraphicsItem
modifier|*
name|parent
parameter_list|)
member_init_list|:
name|QGraphicsWidget
argument_list|(
name|parent
argument_list|)
block|{
name|setFlag
argument_list|(
name|ItemSendsGeometryChanges
argument_list|)
expr_stmt|;
name|clear
argument_list|()
expr_stmt|;
block|}
DECL|function|clear
name|void
name|clear
parameter_list|()
block|{
name|changes
operator|.
name|clear
argument_list|()
expr_stmt|;
name|values
operator|.
name|clear
argument_list|()
expr_stmt|;
name|oldValues
operator|.
name|clear
argument_list|()
expr_stmt|;
block|}
DECL|member|changes
name|QList
argument_list|<
name|GraphicsItemChange
argument_list|>
name|changes
decl_stmt|;
DECL|member|values
name|QList
argument_list|<
name|QVariant
argument_list|>
name|values
decl_stmt|;
DECL|member|oldValues
name|QList
argument_list|<
name|QVariant
argument_list|>
name|oldValues
decl_stmt|;
protected|protected:
DECL|function|itemChange
name|QVariant
name|itemChange
parameter_list|(
name|GraphicsItemChange
name|change
parameter_list|,
specifier|const
name|QVariant
modifier|&
name|value
parameter_list|)
block|{
name|changes
operator|<<
name|change
expr_stmt|;
name|values
operator|<<
name|value
expr_stmt|;
switch|switch
condition|(
name|change
condition|)
block|{
case|case
name|QGraphicsItem
operator|::
name|ItemPositionChange
case|:
name|oldValues
operator|<<
name|pos
argument_list|()
expr_stmt|;
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemPositionHasChanged
case|:
break|break;
default|default:
break|break;
block|}
return|return
name|value
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|widgetSendsGeometryChanges
name|void
name|tst_QGraphicsWidget
operator|::
name|widgetSendsGeometryChanges
parameter_list|()
block|{
name|ItemChangeTester
name|widget
decl_stmt|;
name|widget
operator|.
name|setFlags
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|widget
operator|.
name|clear
argument_list|()
expr_stmt|;
name|QPointF
name|pos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|widget
operator|.
name|setPos
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|pos
argument_list|()
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|widget
operator|.
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemSendsGeometryChanges
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|widget
operator|.
name|setPos
argument_list|(
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|QRectF
name|geometry
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|widget
operator|.
name|setGeometry
argument_list|(
name|geometry
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|geometry
argument_list|()
argument_list|,
name|geometry
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|.
name|changes
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|::
name|GraphicsItemChange
argument_list|>
argument_list|()
operator|<<
name|QGraphicsItem
operator|::
name|ItemFlagsChange
operator|<<
name|QGraphicsItem
operator|::
name|ItemFlagsHaveChanged
operator|<<
name|QGraphicsItem
operator|::
name|ItemPositionChange
operator|<<
name|QGraphicsItem
operator|::
name|ItemPositionHasChanged
operator|<<
name|QGraphicsItem
operator|::
name|ItemPositionChange
operator|<<
name|QGraphicsItem
operator|::
name|ItemPositionHasChanged
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|HFWWidget
class|class
name|HFWWidget
super|:
specifier|public
name|QGraphicsWidget
block|{
public|public:
DECL|function|HFWWidget
name|HFWWidget
parameter_list|()
member_init_list|:
name|QGraphicsWidget
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Window
argument_list|)
block|{
name|QSizePolicy
name|sp
decl_stmt|;
name|sp
operator|.
name|setHeightForWidth
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|setSizePolicy
argument_list|(
name|sp
argument_list|)
expr_stmt|;
block|}
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
name|widget
parameter_list|)
block|{
name|Q_UNUSED
argument_list|(
name|option
argument_list|)
expr_stmt|;
name|Q_UNUSED
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|qreal
name|w
init|=
name|rect
argument_list|()
operator|.
name|width
argument_list|()
decl_stmt|;
name|QRectF
name|box
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|w
argument_list|,
literal|2400
operator|/
name|w
argument_list|)
decl_stmt|;
name|painter
operator|->
name|drawRoundRect
argument_list|(
name|box
argument_list|)
expr_stmt|;
name|painter
operator|->
name|drawLine
argument_list|(
name|box
operator|.
name|topLeft
argument_list|()
argument_list|,
name|box
operator|.
name|bottomRight
argument_list|()
argument_list|)
expr_stmt|;
name|painter
operator|->
name|drawLine
argument_list|(
name|box
operator|.
name|bottomLeft
argument_list|()
argument_list|,
name|box
operator|.
name|topRight
argument_list|()
argument_list|)
expr_stmt|;
block|}
protected|protected:
DECL|function|sizeHint
name|QSizeF
name|sizeHint
parameter_list|(
name|Qt
operator|::
name|SizeHint
name|which
parameter_list|,
specifier|const
name|QSizeF
modifier|&
name|constraint
init|=
name|QSizeF
argument_list|()
parameter_list|)
specifier|const
block|{
name|qreal
name|w
init|=
name|constraint
operator|.
name|width
argument_list|()
decl_stmt|;
switch|switch
condition|(
name|which
condition|)
block|{
case|case
name|Qt
operator|::
name|MinimumSize
case|:
if|if
condition|(
name|w
operator|>=
literal|0
operator|&&
name|constraint
operator|.
name|height
argument_list|()
operator|<
literal|0
condition|)
block|{
comment|// keep the same area of 60x40 = 2400
return|return
name|QSizeF
argument_list|(
name|w
argument_list|,
literal|2400.0
operator|/
name|w
argument_list|)
return|;
block|}
else|else
block|{
return|return
name|QSizeF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
return|;
block|}
break|break;
case|case
name|Qt
operator|::
name|PreferredSize
case|:
return|return
name|QSizeF
argument_list|(
literal|48.989794
argument_list|,
literal|48.989794
argument_list|)
return|;
default|default:
break|break;
block|}
return|return
name|QGraphicsWidget
operator|::
name|sizeHint
argument_list|(
name|which
argument_list|,
name|constraint
argument_list|)
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|respectHFW
name|void
name|tst_QGraphicsWidget
operator|::
name|respectHFW
parameter_list|()
block|{
if|#
directive|if
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
operator|||
name|defined
argument_list|(
name|Q_OS_MAC
argument_list|)
name|QSKIP
argument_list|(
literal|"This test is platform dependent, it fails on wince and mac. Please fix."
argument_list|)
expr_stmt|;
else|#
directive|else
name|QGraphicsScene
name|scene
decl_stmt|;
name|HFWWidget
modifier|*
name|window
init|=
operator|new
name|HFWWidget
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|window
argument_list|)
expr_stmt|;
name|QScopedPointer
argument_list|<
name|QGraphicsView
argument_list|>
name|view
argument_list|(
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene
argument_list|)
argument_list|)
decl_stmt|;
name|view
operator|->
name|resize
argument_list|(
literal|400
argument_list|,
literal|400
argument_list|)
expr_stmt|;
name|view
operator|->
name|setSceneRect
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|300
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|view
operator|->
name|show
argument_list|()
expr_stmt|;
name|window
operator|->
name|setGeometry
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|70
argument_list|,
literal|70
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
name|view
operator|.
name|data
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|{
comment|// here we go - simulate a interactive resize of the window
name|QTest
operator|::
name|mouseMove
argument_list|(
name|view
operator|.
name|data
argument_list|()
argument_list|,
name|view
operator|->
name|mapFromScene
argument_list|(
literal|71
argument_list|,
literal|71
argument_list|)
argument_list|)
expr_stmt|;
comment|// bottom right corner
name|QTest
operator|::
name|mousePress
argument_list|(
name|view
operator|->
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|->
name|mapFromScene
argument_list|(
literal|71
argument_list|,
literal|71
argument_list|)
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|view
operator|->
name|grabMouse
argument_list|()
expr_stmt|;
comment|// move both mouse cursor and set correct event in order to emulate resize
name|QTest
operator|::
name|mouseMove
argument_list|(
name|view
operator|->
name|viewport
argument_list|()
argument_list|,
name|view
operator|->
name|mapFromScene
argument_list|(
literal|60
argument_list|,
literal|30
argument_list|)
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QMouseEvent
name|e
init|=
name|QMouseEvent
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|view
operator|->
name|mapFromScene
argument_list|(
literal|60
argument_list|,
literal|20
argument_list|)
argument_list|,
name|Qt
operator|::
name|NoButton
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|->
name|viewport
argument_list|()
argument_list|,
operator|&
name|e
argument_list|)
expr_stmt|;
name|view
operator|->
name|releaseMouse
argument_list|()
expr_stmt|;
block|}
specifier|const
name|QSizeF
name|winSize
init|=
name|window
operator|->
name|size
argument_list|()
decl_stmt|;
name|qreal
name|minHFW
init|=
name|window
operator|->
name|effectiveSizeHint
argument_list|(
name|Qt
operator|::
name|MinimumSize
argument_list|,
name|QSizeF
argument_list|(
name|winSize
operator|.
name|width
argument_list|()
argument_list|,
operator|-
literal|1
argument_list|)
argument_list|)
operator|.
name|height
argument_list|()
decl_stmt|;
name|QTRY_VERIFY
argument_list|(
name|qAbs
argument_list|(
name|minHFW
operator|-
name|winSize
operator|.
name|height
argument_list|()
argument_list|)
operator|<
literal|1
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function
begin_class
DECL|class|PolishWidget
class|class
name|PolishWidget
super|:
specifier|public
name|QGraphicsWidget
block|{
public|public:
DECL|function|PolishWidget
name|PolishWidget
parameter_list|(
name|Qt
operator|::
name|GlobalColor
name|color
parameter_list|,
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsWidget
argument_list|(
name|parent
argument_list|)
member_init_list|,
name|mColor
argument_list|(
name|color
argument_list|)
block|{     }
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
name|painter
operator|->
name|setBrush
argument_list|(
name|QBrush
argument_list|(
name|mColor
argument_list|)
argument_list|)
expr_stmt|;
name|painter
operator|->
name|drawRect
argument_list|(
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|function|polishEvent
name|void
name|polishEvent
parameter_list|()
block|{
if|if
condition|(
operator|!
name|parentWidget
argument_list|()
condition|)
block|{
comment|//We add a child in the polish event for the parent
name|PolishWidget
modifier|*
name|childWidget
init|=
operator|new
name|PolishWidget
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
name|this
argument_list|)
decl_stmt|;
name|childWidget
operator|->
name|setGeometry
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|30
argument_list|,
literal|30
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|QGraphicsWidget
operator|::
name|polishEvent
argument_list|()
expr_stmt|;
name|mColor
operator|=
name|Qt
operator|::
name|red
expr_stmt|;
name|update
argument_list|()
expr_stmt|;
name|numberOfPolish
operator|++
expr_stmt|;
block|}
DECL|member|numberOfPolish
specifier|static
name|int
name|numberOfPolish
decl_stmt|;
private|private:
DECL|member|mColor
name|Qt
operator|::
name|GlobalColor
name|mColor
decl_stmt|;
block|}
class|;
end_class
begin_decl_stmt
DECL|member|numberOfPolish
name|int
name|PolishWidget
operator|::
name|numberOfPolish
init|=
literal|0
decl_stmt|;
end_decl_stmt
begin_function
DECL|function|addChildInpolishEvent
name|void
name|tst_QGraphicsWidget
operator|::
name|addChildInpolishEvent
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|PolishWidget
modifier|*
name|parentWidget
init|=
operator|new
name|PolishWidget
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parentWidget
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|PolishWidget
operator|::
name|numberOfPolish
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|polishEvent
name|void
name|tst_QGraphicsWidget
operator|::
name|polishEvent
parameter_list|()
block|{
class|class
name|MyGraphicsWidget
super|:
specifier|public
name|QGraphicsWidget
block|{
public|public:
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
name|events
operator|<<
name|QEvent
operator|::
name|Paint
expr_stmt|;
block|}
name|void
name|polishEvent
parameter_list|()
block|{
name|events
operator|<<
name|QEvent
operator|::
name|Polish
expr_stmt|;
block|}
name|QList
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|>
name|events
decl_stmt|;
block|}
class|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|MyGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|MyGraphicsWidget
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
comment|// Make sure the item is painted.
name|QTRY_VERIFY
argument_list|(
name|widget
operator|->
name|events
operator|.
name|contains
argument_list|(
name|QEvent
operator|::
name|Paint
argument_list|)
argument_list|)
expr_stmt|;
comment|// Make sure the item got polish before paint.
name|QCOMPARE
argument_list|(
name|widget
operator|->
name|events
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QEvent
operator|::
name|Polish
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|polishEvent2
name|void
name|tst_QGraphicsWidget
operator|::
name|polishEvent2
parameter_list|()
block|{
class|class
name|MyGraphicsWidget
super|:
specifier|public
name|QGraphicsWidget
block|{
public|public:
name|void
name|polishEvent
parameter_list|()
block|{
name|events
operator|<<
name|QEvent
operator|::
name|Polish
expr_stmt|;
block|}
name|QList
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|>
name|events
decl_stmt|;
block|}
class|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|MyGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|MyGraphicsWidget
decl_stmt|;
name|widget
operator|->
name|hide
argument_list|()
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|widget
operator|->
name|events
operator|.
name|clear
argument_list|()
expr_stmt|;
comment|// Make sure the item got polish event.
name|QTRY_VERIFY
argument_list|(
name|widget
operator|->
name|events
operator|.
name|contains
argument_list|(
name|QEvent
operator|::
name|Polish
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|autoFillBackground
name|void
name|tst_QGraphicsWidget
operator|::
name|autoFillBackground
parameter_list|()
block|{
name|QGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|->
name|autoFillBackground
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setAutoFillBackground
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget
operator|->
name|autoFillBackground
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
specifier|const
name|QColor
name|color
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
decl_stmt|;
specifier|const
name|QRect
name|rect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setGeometry
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|QPalette
name|palette
init|=
name|widget
operator|->
name|palette
argument_list|()
decl_stmt|;
name|palette
operator|.
name|setColor
argument_list|(
name|QPalette
operator|::
name|Window
argument_list|,
name|color
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setPalette
argument_list|(
name|palette
argument_list|)
expr_stmt|;
name|QImage
name|image
argument_list|(
name|rect
operator|.
name|size
argument_list|()
argument_list|,
name|QImage
operator|::
name|Format_RGB32
argument_list|)
decl_stmt|;
name|QPainter
name|painter
decl_stmt|;
name|painter
operator|.
name|begin
argument_list|(
operator|&
name|image
argument_list|)
expr_stmt|;
name|scene
operator|.
name|render
argument_list|(
operator|&
name|painter
argument_list|,
name|rect
argument_list|,
name|rect
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|color
operator|.
name|rgb
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|initialShow
name|void
name|tst_QGraphicsWidget
operator|::
name|initialShow
parameter_list|()
block|{
class|class
name|MyGraphicsWidget
super|:
specifier|public
name|QGraphicsWidget
block|{
public|public:
name|MyGraphicsWidget
parameter_list|()
member_init_list|:
name|repaints
argument_list|(
literal|0
argument_list|)
block|{}
name|int
name|repaints
decl_stmt|;
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
operator|++
name|repaints
expr_stmt|;
block|}
name|void
name|polishEvent
parameter_list|()
block|{
name|update
argument_list|()
expr_stmt|;
block|}
block|}
class|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|MyGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|MyGraphicsWidget
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|widget
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|initialShow2
name|void
name|tst_QGraphicsWidget
operator|::
name|initialShow2
parameter_list|()
block|{
class|class
name|MyGraphicsWidget
super|:
specifier|public
name|QGraphicsWidget
block|{
public|public:
name|MyGraphicsWidget
parameter_list|()
member_init_list|:
name|repaints
argument_list|(
literal|0
argument_list|)
block|{}
name|int
name|repaints
decl_stmt|;
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
operator|++
name|repaints
expr_stmt|;
block|}
name|void
name|polishEvent
parameter_list|()
block|{
name|update
argument_list|()
expr_stmt|;
block|}
block|}
class|;
comment|// Don't let paint events triggered by the windowing system
comment|// influence our test case. We're only interested in knowing
comment|// whether a QGraphicsWidget generates an additional repaint
comment|// on the initial show. Hence create a dummy scenario to find out
comment|// how many repaints we should expect.
name|QGraphicsScene
name|dummyScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|dummyScene
operator|.
name|addItem
argument_list|(
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QScopedPointer
argument_list|<
name|QGraphicsView
argument_list|>
name|dummyView
argument_list|(
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|dummyScene
argument_list|)
argument_list|)
decl_stmt|;
name|dummyView
operator|->
name|setWindowFlags
argument_list|(
name|Qt
operator|::
name|X11BypassWindowManagerHint
argument_list|)
expr_stmt|;
name|EventSpy
name|paintSpy
argument_list|(
name|dummyView
operator|->
name|viewport
argument_list|()
argument_list|,
name|QEvent
operator|::
name|Paint
argument_list|)
decl_stmt|;
name|dummyView
operator|->
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
name|dummyView
operator|.
name|data
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
name|dummyView
operator|.
name|data
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
specifier|const
name|int
name|expectedRepaintCount
init|=
name|paintSpy
operator|.
name|count
argument_list|()
decl_stmt|;
name|dummyView
operator|.
name|reset
argument_list|()
expr_stmt|;
name|MyGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|MyGraphicsWidget
decl_stmt|;
name|widget
operator|->
name|resize
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setWindowFlags
argument_list|(
name|view
operator|.
name|windowFlags
argument_list|()
operator||
name|Qt
operator|::
name|X11BypassWindowManagerHint
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|widget
operator|->
name|repaints
argument_list|,
name|expectedRepaintCount
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemChangeEvents
name|void
name|tst_QGraphicsWidget
operator|::
name|itemChangeEvents
parameter_list|()
block|{
class|class
name|TestGraphicsWidget
super|:
specifier|public
name|QGraphicsWidget
block|{
public|public:
name|TestGraphicsWidget
parameter_list|()
member_init_list|:
name|QGraphicsWidget
argument_list|()
block|{}
name|QHash
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|,
name|QVariant
argument_list|>
name|valueDuringEvents
decl_stmt|;
name|bool
name|event
parameter_list|(
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
name|Q_UNUSED
argument_list|(
name|event
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
argument_list|()
condition|)
block|{
case|case
name|QEvent
operator|::
name|EnabledChange
case|:
block|{
name|valueDuringEvents
operator|.
name|insert
argument_list|(
name|QEvent
operator|::
name|EnabledChange
argument_list|,
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|QEvent
operator|::
name|ParentAboutToChange
case|:
block|{
name|valueDuringEvents
operator|.
name|insert
argument_list|(
name|QEvent
operator|::
name|ParentAboutToChange
argument_list|,
name|QVariant
operator|::
name|fromValue
argument_list|(
name|parentItem
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|QEvent
operator|::
name|ParentChange
case|:
block|{
name|valueDuringEvents
operator|.
name|insert
argument_list|(
name|QEvent
operator|::
name|ParentChange
argument_list|,
name|QVariant
operator|::
name|fromValue
argument_list|(
name|parentItem
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
case|case
name|QEvent
operator|::
name|CursorChange
case|:
block|{
name|valueDuringEvents
operator|.
name|insert
argument_list|(
name|QEvent
operator|::
name|CursorChange
argument_list|,
name|int
argument_list|(
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
break|break;
block|}
endif|#
directive|endif
case|case
name|QEvent
operator|::
name|ToolTipChange
case|:
block|{
name|valueDuringEvents
operator|.
name|insert
argument_list|(
name|QEvent
operator|::
name|ToolTipChange
argument_list|,
name|toolTip
argument_list|()
argument_list|)
expr_stmt|;
break|break;
block|}
default|default:
block|{
break|break;
block|}
block|}
return|return
literal|true
return|;
block|}
name|void
name|showEvent
parameter_list|(
name|QShowEvent
modifier|*
name|event
parameter_list|)
block|{
name|Q_UNUSED
argument_list|(
name|event
argument_list|)
expr_stmt|;
name|valueDuringEvents
operator|.
name|insert
argument_list|(
name|QEvent
operator|::
name|Show
argument_list|,
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|void
name|hideEvent
parameter_list|(
name|QHideEvent
modifier|*
name|event
parameter_list|)
block|{
name|Q_UNUSED
argument_list|(
name|event
argument_list|)
expr_stmt|;
name|valueDuringEvents
operator|.
name|insert
argument_list|(
name|QEvent
operator|::
name|Hide
argument_list|,
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
class|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|parent
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|TestGraphicsWidget
modifier|*
name|item
init|=
operator|new
name|TestGraphicsWidget
decl_stmt|;
name|item
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
comment|// ParentAboutToChange should be triggered before the parent has changed
name|QTRY_COMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|item
operator|->
name|valueDuringEvents
operator|.
name|value
argument_list|(
name|QEvent
operator|::
name|ParentAboutToChange
argument_list|)
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
comment|// ParentChange should be triggered after the parent has changed
name|QTRY_COMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|item
operator|->
name|valueDuringEvents
operator|.
name|value
argument_list|(
name|QEvent
operator|::
name|ParentChange
argument_list|)
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
comment|// ShowEvent should be triggered before the item is shown
name|QTRY_VERIFY
argument_list|(
operator|!
name|item
operator|->
name|valueDuringEvents
operator|.
name|value
argument_list|(
name|QEvent
operator|::
name|Show
argument_list|)
operator|.
name|toBool
argument_list|()
argument_list|)
expr_stmt|;
comment|// HideEvent should be triggered after the item is hidden
name|QVERIFY
argument_list|(
name|item
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setVisible
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|item
operator|->
name|valueDuringEvents
operator|.
name|value
argument_list|(
name|QEvent
operator|::
name|Hide
argument_list|)
operator|.
name|toBool
argument_list|()
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
comment|// CursorChange should be triggered after the cursor has changed
name|item
operator|->
name|setCursor
argument_list|(
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item
operator|->
name|valueDuringEvents
operator|.
name|value
argument_list|(
name|QEvent
operator|::
name|CursorChange
argument_list|)
operator|.
name|toInt
argument_list|()
argument_list|,
name|int
argument_list|(
name|item
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|// ToolTipChange should be triggered after the tooltip has changed
name|item
operator|->
name|setToolTip
argument_list|(
literal|"tooltipText"
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item
operator|->
name|valueDuringEvents
operator|.
name|value
argument_list|(
name|QEvent
operator|::
name|ToolTipChange
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|item
operator|->
name|toolTip
argument_list|()
argument_list|)
expr_stmt|;
comment|// EnabledChange should be triggered after the enabled state has changed
name|QVERIFY
argument_list|(
name|item
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|item
operator|->
name|valueDuringEvents
operator|.
name|value
argument_list|(
name|QEvent
operator|::
name|EnabledChange
argument_list|)
operator|.
name|toBool
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemSendGeometryPosChangesDeactivated
name|void
name|tst_QGraphicsWidget
operator|::
name|itemSendGeometryPosChangesDeactivated
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|item
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setGeometry
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item
operator|->
name|geometry
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemSendsGeometryChanges
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|item
operator|->
name|setGeometry
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|60
argument_list|,
literal|60
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|geometry
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|60
argument_list|,
literal|60
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setPos
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|geometry
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|60
argument_list|,
literal|60
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemSendsScenePositionChanges
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|item
operator|->
name|setGeometry
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|60
argument_list|,
literal|60
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|geometry
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|60
argument_list|,
literal|60
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setPos
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|geometry
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|60
argument_list|,
literal|60
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|TabFocusWidget
class|class
name|TabFocusWidget
super|:
specifier|public
name|QGraphicsWidget
block|{
name|Q_OBJECT
public|public:
DECL|function|TabFocusWidget
name|TabFocusWidget
parameter_list|(
specifier|const
name|QString
modifier|&
name|name
parameter_list|,
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsWidget
argument_list|(
name|parent
argument_list|)
block|{
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|TabFocus
argument_list|)
expr_stmt|;
name|setData
argument_list|(
literal|0
argument_list|,
name|name
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|verifyTabFocus
name|void
name|verifyTabFocus
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|,
specifier|const
name|QList
argument_list|<
name|QGraphicsWidget
modifier|*
argument_list|>
modifier|&
name|chain
parameter_list|,
name|bool
name|wrapsAround
parameter_list|)
block|{
name|QKeyEvent
name|tabEvent
argument_list|(
name|QEvent
operator|::
name|KeyPress
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QKeyEvent
name|backtabEvent
argument_list|(
name|QEvent
operator|::
name|KeyPress
argument_list|,
name|Qt
operator|::
name|Key_Backtab
argument_list|,
literal|0
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|chain
operator|.
name|size
argument_list|()
condition|;
operator|++
name|i
control|)
name|chain
operator|.
name|at
argument_list|(
name|i
argument_list|)
operator|->
name|clearFocus
argument_list|()
expr_stmt|;
name|int
name|n
init|=
name|chain
operator|.
name|size
argument_list|()
operator|*
operator|(
name|wrapsAround
condition|?
literal|3
else|:
literal|1
operator|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|n
condition|;
operator|++
name|i
control|)
block|{
name|qApp
operator|->
name|sendEvent
argument_list|(
name|scene
argument_list|,
operator|&
name|tabEvent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|chain
operator|.
name|at
argument_list|(
name|i
operator|%
name|chain
operator|.
name|size
argument_list|()
argument_list|)
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|->
name|focusItem
argument_list|()
argument_list|,
name|chain
operator|.
name|at
argument_list|(
name|i
operator|%
name|chain
operator|.
name|size
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|int
name|i
init|=
name|n
operator|-
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
operator|--
name|i
control|)
block|{
name|qApp
operator|->
name|sendEvent
argument_list|(
name|scene
argument_list|,
operator|&
name|backtabEvent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|chain
operator|.
name|at
argument_list|(
name|i
operator|%
name|chain
operator|.
name|size
argument_list|()
argument_list|)
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|->
name|focusItem
argument_list|()
argument_list|,
name|chain
operator|.
name|at
argument_list|(
name|i
operator|%
name|chain
operator|.
name|size
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|tabFocus
name|void
name|tst_QGraphicsWidget
operator|::
name|tabFocus
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|TabFocusWidget
modifier|*
name|widget
init|=
operator|new
name|TabFocusWidget
argument_list|(
literal|"1"
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|verifyTabFocus
argument_list|(
operator|&
name|scene
argument_list|,
name|QList
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|()
operator|<<
name|widget
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|TabFocusWidget
modifier|*
name|widget2
init|=
operator|new
name|TabFocusWidget
argument_list|(
literal|"2"
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|verifyTabFocus
argument_list|(
operator|&
name|scene
argument_list|,
name|QList
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|()
operator|<<
name|widget
operator|<<
name|widget2
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|TabFocusWidget
modifier|*
name|widget3
init|=
operator|new
name|TabFocusWidget
argument_list|(
literal|"3"
argument_list|)
decl_stmt|;
name|widget3
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|activePanel
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget3
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setActivePanel
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|verifyTabFocus
argument_list|(
operator|&
name|scene
argument_list|,
name|QList
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|()
operator|<<
name|widget
operator|<<
name|widget2
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setActivePanel
argument_list|(
name|widget3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget3
argument_list|)
expr_stmt|;
name|verifyTabFocus
argument_list|(
operator|&
name|scene
argument_list|,
name|QList
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|()
operator|<<
name|widget3
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|TabFocusWidget
modifier|*
name|widget4
init|=
operator|new
name|TabFocusWidget
argument_list|(
literal|"4"
argument_list|)
decl_stmt|;
name|widget4
operator|->
name|setParentItem
argument_list|(
name|widget3
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|widget3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|widget3
operator|->
name|clearFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|widget3
operator|->
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|activePanel
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|widget3
argument_list|)
expr_stmt|;
name|verifyTabFocus
argument_list|(
operator|&
name|scene
argument_list|,
name|QList
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|()
operator|<<
name|widget3
operator|<<
name|widget4
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|widget5
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|widget5
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
name|QLatin1String
argument_list|(
literal|"5"
argument_list|)
argument_list|)
expr_stmt|;
name|widget5
operator|->
name|setParentItem
argument_list|(
name|widget3
argument_list|)
expr_stmt|;
name|verifyTabFocus
argument_list|(
operator|&
name|scene
argument_list|,
name|QList
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|()
operator|<<
name|widget3
operator|<<
name|widget4
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|widget5
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|TabFocus
argument_list|)
expr_stmt|;
name|verifyTabFocus
argument_list|(
operator|&
name|scene
argument_list|,
name|QList
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|()
operator|<<
name|widget3
operator|<<
name|widget4
operator|<<
name|widget5
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|TabFocusWidget
modifier|*
name|widget6
init|=
operator|new
name|TabFocusWidget
argument_list|(
literal|"6"
argument_list|)
decl_stmt|;
name|widget6
operator|->
name|setParentItem
argument_list|(
name|widget4
argument_list|)
expr_stmt|;
name|verifyTabFocus
argument_list|(
operator|&
name|scene
argument_list|,
name|QList
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|()
operator|<<
name|widget3
operator|<<
name|widget4
operator|<<
name|widget6
operator|<<
name|widget5
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|TabFocusWidget
modifier|*
name|widget7
init|=
operator|new
name|TabFocusWidget
argument_list|(
literal|"7"
argument_list|,
name|widget6
argument_list|)
decl_stmt|;
name|verifyTabFocus
argument_list|(
operator|&
name|scene
argument_list|,
name|QList
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|()
operator|<<
name|widget3
operator|<<
name|widget4
operator|<<
name|widget6
operator|<<
name|widget7
operator|<<
name|widget5
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|TabFocusWidget
modifier|*
name|widget8
init|=
operator|new
name|TabFocusWidget
argument_list|(
literal|"8"
argument_list|,
name|widget6
argument_list|)
decl_stmt|;
name|verifyTabFocus
argument_list|(
operator|&
name|scene
argument_list|,
name|QList
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|()
operator|<<
name|widget3
operator|<<
name|widget4
operator|<<
name|widget6
operator|<<
name|widget7
operator|<<
name|widget8
operator|<<
name|widget5
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|widget6
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|widget6
operator|->
name|setActive
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|verifyTabFocus
argument_list|(
operator|&
name|scene
argument_list|,
name|QList
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|()
operator|<<
name|widget6
operator|<<
name|widget7
operator|<<
name|widget8
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|widget3
operator|->
name|setActive
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|verifyTabFocus
argument_list|(
operator|&
name|scene
argument_list|,
name|QList
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|()
operator|<<
name|widget3
operator|<<
name|widget4
operator|<<
name|widget5
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|widget6
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|verifyTabFocus
argument_list|(
operator|&
name|scene
argument_list|,
name|QList
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|()
operator|<<
name|widget3
operator|<<
name|widget4
operator|<<
name|widget6
operator|<<
name|widget7
operator|<<
name|widget8
operator|<<
name|widget5
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|widget6
argument_list|)
expr_stmt|;
name|verifyTabFocus
argument_list|(
operator|&
name|scene
argument_list|,
name|QList
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|()
operator|<<
name|widget3
operator|<<
name|widget4
operator|<<
name|widget5
argument_list|,
literal|true
argument_list|)
expr_stmt|;
operator|delete
name|widget6
expr_stmt|;
block|}
end_function
begin_function
DECL|function|QT_BUG_6544_tabFocusFirstUnsetWhenRemovingItems
name|void
name|tst_QGraphicsWidget
operator|::
name|QT_BUG_6544_tabFocusFirstUnsetWhenRemovingItems
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|parent1
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|child1_0
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|child1_1
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|parent2
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
comment|// Add the parent and child to the scene.
name|scene
operator|.
name|addItem
argument_list|(
name|parent1
argument_list|)
expr_stmt|;
name|child1_0
operator|->
name|setParentItem
argument_list|(
name|parent1
argument_list|)
expr_stmt|;
name|child1_1
operator|->
name|setParentItem
argument_list|(
name|parent1
argument_list|)
expr_stmt|;
comment|// Hide and show the child.
name|child1_0
operator|->
name|setParentItem
argument_list|(
name|NULL
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|child1_0
argument_list|)
expr_stmt|;
comment|// Remove parent from the scene.
name|scene
operator|.
name|removeItem
argument_list|(
name|parent1
argument_list|)
expr_stmt|;
operator|delete
name|child1_0
expr_stmt|;
operator|delete
name|child1_1
expr_stmt|;
operator|delete
name|parent1
expr_stmt|;
comment|// Add an item into the scene.
name|scene
operator|.
name|addItem
argument_list|(
name|parent2
argument_list|)
expr_stmt|;
comment|//This should not crash
block|}
end_function
begin_function
DECL|function|QT_BUG_12056_tabFocusFirstUnsetWhenRemovingItems
name|void
name|tst_QGraphicsWidget
operator|::
name|QT_BUG_12056_tabFocusFirstUnsetWhenRemovingItems
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|item1
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|item2
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|item3
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
operator|delete
name|item2
expr_stmt|;
operator|delete
name|item1
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item3
argument_list|)
expr_stmt|;
comment|//This should not crash
block|}
end_function
begin_macro
name|QTEST_MAIN
argument_list|(
argument|tst_QGraphicsWidget
argument_list|)
end_macro
begin_include
include|#
directive|include
file|"tst_qgraphicswidget.moc"
end_include
end_unit
