begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2012 Digia Plc and/or its subsidiary(-ies). ** Contact: http://www.qt-project.org/legal ** ** This file is part of the test suite of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL$ ** Commercial License Usage ** Licensees holding valid commercial Qt licenses may use this file in ** accordance with the commercial license agreement provided with the ** Software or, alternatively, in accordance with the terms contained in ** a written agreement between you and Digia.  For licensing terms and ** conditions see http://qt.digia.com/licensing.  For further information ** use the contact form at http://qt.digia.com/contact-us. ** ** GNU Lesser General Public License Usage ** Alternatively, this file may be used under the terms of the GNU Lesser ** General Public License version 2.1 as published by the Free Software ** Foundation and appearing in the file LICENSE.LGPL included in the ** packaging of this file.  Please review the following information to ** ensure the GNU Lesser General Public License version 2.1 requirements ** will be met: http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html. ** ** In addition, as a special exception, Digia gives you certain additional ** rights.  These rights are described in the Digia Qt LGPL Exception ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package. ** ** GNU General Public License Usage ** Alternatively, this file may be used under the terms of the GNU ** General Public License version 3.0 as published by the Free Software ** Foundation and appearing in the file LICENSE.GPL included in the ** packaging of this file.  Please review the following information to ** ensure the GNU General Public License version 3.0 requirements will be ** met: http://www.gnu.org/copyleft/gpl.html. ** ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<QtTest/QtTest>
end_include
begin_if
if|#
directive|if
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
end_if
begin_include
include|#
directive|include
file|<ceconfig.h>
end_include
begin_endif
endif|#
directive|endif
end_endif
begin_include
include|#
directive|include
file|<QtGui>
end_include
begin_include
include|#
directive|include
file|<QtWidgets>
end_include
begin_include
include|#
directive|include
file|<private/qgraphicsscene_p.h>
end_include
begin_include
include|#
directive|include
file|<private/qgraphicssceneindex_p.h>
end_include
begin_include
include|#
directive|include
file|<math.h>
end_include
begin_include
include|#
directive|include
file|"../../../gui/painting/qpathclipper/pathcompare.h"
end_include
begin_include
include|#
directive|include
file|"../../../shared/platforminputcontext.h"
end_include
begin_include
include|#
directive|include
file|<private/qinputmethod_p.h>
end_include
begin_if
if|#
directive|if
name|defined
argument_list|(
name|Q_OS_WIN
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
end_if
begin_include
include|#
directive|include
file|<windows.h>
end_include
begin_define
DECL|macro|Q_CHECK_PAINTEVENTS
define|#
directive|define
name|Q_CHECK_PAINTEVENTS
define|\
value|if (::SwitchDesktop(::GetThreadDesktop(::GetCurrentThreadId())) == 0) \         QSKIP("The Graphics View doesn't get the paint events");
end_define
begin_else
else|#
directive|else
end_else
begin_define
DECL|macro|Q_CHECK_PAINTEVENTS
define|#
directive|define
name|Q_CHECK_PAINTEVENTS
end_define
begin_endif
endif|#
directive|endif
end_endif
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QList<int>
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QList<QRectF>
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QMatrix
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QPainterPath
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QPointF
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QRectF
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|Qt::AspectRatioMode
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|Qt::ItemSelectionMode
argument_list|)
end_macro
begin_decl_stmt
DECL|variable|randomX
specifier|static
specifier|const
name|int
name|randomX
index|[]
init|=
block|{
literal|276
block|,
literal|40
block|,
literal|250
block|,
literal|864
block|,
operator|-
literal|56
block|,
literal|426
block|,
literal|855
block|,
literal|825
block|,
literal|184
block|,
literal|955
block|,
operator|-
literal|798
block|,
operator|-
literal|804
block|,
literal|773
block|,
literal|282
block|,
literal|489
block|,
literal|686
block|,
literal|780
block|,
operator|-
literal|220
block|,
literal|50
block|,
literal|749
block|,
operator|-
literal|856
block|,
operator|-
literal|205
block|,
literal|81
block|,
literal|492
block|,
operator|-
literal|819
block|,
literal|518
block|,
literal|895
block|,
literal|57
block|,
operator|-
literal|559
block|,
literal|788
block|,
operator|-
literal|965
block|,
literal|68
block|,
operator|-
literal|442
block|,
operator|-
literal|247
block|,
operator|-
literal|339
block|,
operator|-
literal|648
block|,
literal|292
block|,
literal|891
block|,
operator|-
literal|865
block|,
literal|462
block|,
literal|864
block|,
literal|673
block|,
literal|640
block|,
literal|523
block|,
literal|194
block|,
literal|500
block|,
operator|-
literal|727
block|,
literal|307
block|,
operator|-
literal|243
block|,
literal|320
block|,
operator|-
literal|545
block|,
literal|415
block|,
literal|448
block|,
literal|341
block|,
operator|-
literal|619
block|,
literal|652
block|,
literal|892
block|,
operator|-
literal|16
block|,
operator|-
literal|14
block|,
operator|-
literal|659
block|,
operator|-
literal|101
block|,
operator|-
literal|934
block|,
literal|532
block|,
literal|356
block|,
literal|824
block|,
literal|132
block|,
literal|160
block|,
literal|130
block|,
literal|104
block|,
literal|886
block|,
operator|-
literal|179
block|,
operator|-
literal|174
block|,
literal|543
block|,
operator|-
literal|644
block|,
literal|60
block|,
operator|-
literal|470
block|,
operator|-
literal|354
block|,
operator|-
literal|728
block|,
literal|689
block|,
literal|682
block|,
operator|-
literal|587
block|,
operator|-
literal|694
block|,
operator|-
literal|221
block|,
operator|-
literal|741
block|,
literal|37
block|,
literal|372
block|,
operator|-
literal|289
block|,
literal|741
block|,
operator|-
literal|300
block|,
literal|858
block|,
operator|-
literal|320
block|,
literal|729
block|,
operator|-
literal|602
block|,
operator|-
literal|956
block|,
operator|-
literal|544
block|,
operator|-
literal|403
block|,
literal|203
block|,
literal|398
block|,
literal|284
block|,
operator|-
literal|972
block|,
operator|-
literal|572
block|,
operator|-
literal|946
block|,
literal|81
block|,
literal|51
block|,
operator|-
literal|403
block|,
operator|-
literal|580
block|,
literal|867
block|,
literal|546
block|,
literal|565
block|,
operator|-
literal|580
block|,
operator|-
literal|484
block|,
literal|659
block|,
literal|982
block|,
operator|-
literal|518
block|,
operator|-
literal|976
block|,
literal|423
block|,
operator|-
literal|800
block|,
literal|659
block|,
operator|-
literal|297
block|,
literal|712
block|,
literal|938
block|,
operator|-
literal|19
block|,
operator|-
literal|16
block|,
literal|824
block|,
operator|-
literal|252
block|,
literal|197
block|,
literal|321
block|,
operator|-
literal|837
block|,
literal|824
block|,
literal|136
block|,
literal|226
block|,
operator|-
literal|980
block|,
operator|-
literal|909
block|,
operator|-
literal|826
block|,
operator|-
literal|479
block|,
operator|-
literal|835
block|,
operator|-
literal|503
block|,
operator|-
literal|828
block|,
operator|-
literal|901
block|,
operator|-
literal|810
block|,
operator|-
literal|641
block|,
operator|-
literal|548
block|,
operator|-
literal|179
block|,
literal|194
block|,
literal|749
block|,
operator|-
literal|296
block|,
literal|539
block|,
operator|-
literal|37
block|,
operator|-
literal|599
block|,
operator|-
literal|235
block|,
literal|121
block|,
literal|35
block|,
operator|-
literal|230
block|,
operator|-
literal|915
block|,
literal|789
block|,
literal|764
block|,
operator|-
literal|622
block|,
operator|-
literal|382
block|,
operator|-
literal|90
block|,
operator|-
literal|701
block|,
literal|676
block|,
operator|-
literal|407
block|,
literal|998
block|,
literal|267
block|,
literal|913
block|,
literal|817
block|,
operator|-
literal|748
block|,
operator|-
literal|370
block|,
operator|-
literal|162
block|,
operator|-
literal|797
block|,
literal|19
block|,
operator|-
literal|556
block|,
literal|933
block|,
operator|-
literal|670
block|,
operator|-
literal|101
block|,
operator|-
literal|765
block|,
operator|-
literal|941
block|,
operator|-
literal|17
block|,
literal|360
block|,
literal|31
block|,
literal|960
block|,
literal|509
block|,
literal|933
block|,
operator|-
literal|35
block|,
literal|974
block|,
operator|-
literal|924
block|,
operator|-
literal|734
block|,
literal|589
block|,
literal|963
block|,
literal|724
block|,
literal|794
block|,
literal|843
block|,
literal|16
block|,
operator|-
literal|272
block|,
operator|-
literal|811
block|,
literal|721
block|,
literal|99
block|,
operator|-
literal|122
block|,
literal|216
block|,
operator|-
literal|404
block|,
literal|158
block|,
literal|787
block|,
operator|-
literal|443
block|,
operator|-
literal|437
block|,
operator|-
literal|337
block|,
literal|383
block|,
operator|-
literal|342
block|,
literal|538
block|,
operator|-
literal|641
block|,
literal|791
block|,
literal|637
block|,
operator|-
literal|848
block|,
literal|397
block|,
literal|820
block|,
literal|109
block|,
literal|11
block|,
literal|45
block|,
literal|809
block|,
literal|591
block|,
literal|933
block|,
literal|961
block|,
literal|625
block|,
operator|-
literal|140
block|,
operator|-
literal|592
block|,
operator|-
literal|694
block|,
operator|-
literal|969
block|,
literal|317
block|,
literal|293
block|,
literal|777
block|,
operator|-
literal|18
block|,
operator|-
literal|282
block|,
literal|835
block|,
operator|-
literal|455
block|,
operator|-
literal|708
block|,
operator|-
literal|407
block|,
operator|-
literal|204
block|,
literal|748
block|,
literal|347
block|,
operator|-
literal|501
block|,
operator|-
literal|545
block|,
literal|292
block|,
operator|-
literal|362
block|,
literal|176
block|,
literal|546
block|,
operator|-
literal|573
block|,
operator|-
literal|38
block|,
operator|-
literal|854
block|,
operator|-
literal|395
block|,
literal|560
block|,
operator|-
literal|624
block|,
operator|-
literal|940
block|,
operator|-
literal|971
block|,
literal|66
block|,
operator|-
literal|910
block|,
literal|782
block|,
literal|985
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|variable|randomY
specifier|static
specifier|const
name|int
name|randomY
index|[]
init|=
block|{
literal|603
block|,
literal|70
block|,
operator|-
literal|318
block|,
literal|843
block|,
literal|450
block|,
operator|-
literal|637
block|,
literal|199
block|,
operator|-
literal|527
block|,
literal|407
block|,
literal|964
block|,
operator|-
literal|54
block|,
literal|620
block|,
operator|-
literal|207
block|,
operator|-
literal|736
block|,
operator|-
literal|700
block|,
operator|-
literal|476
block|,
operator|-
literal|706
block|,
operator|-
literal|142
block|,
literal|837
block|,
literal|621
block|,
literal|522
block|,
operator|-
literal|98
block|,
literal|232
block|,
literal|292
block|,
operator|-
literal|267
block|,
literal|900
block|,
literal|615
block|,
operator|-
literal|356
block|,
operator|-
literal|415
block|,
literal|783
block|,
literal|290
block|,
literal|462
block|,
operator|-
literal|857
block|,
operator|-
literal|314
block|,
literal|677
block|,
literal|36
block|,
literal|772
block|,
literal|424
block|,
operator|-
literal|72
block|,
operator|-
literal|121
block|,
literal|547
block|,
operator|-
literal|533
block|,
literal|537
block|,
operator|-
literal|656
block|,
literal|289
block|,
literal|508
block|,
literal|914
block|,
literal|601
block|,
literal|434
block|,
literal|588
block|,
operator|-
literal|779
block|,
operator|-
literal|714
block|,
operator|-
literal|368
block|,
literal|628
block|,
operator|-
literal|276
block|,
literal|432
block|,
operator|-
literal|1
block|,
operator|-
literal|929
block|,
literal|638
block|,
operator|-
literal|36
block|,
literal|253
block|,
operator|-
literal|922
block|,
operator|-
literal|943
block|,
literal|979
block|,
operator|-
literal|34
block|,
operator|-
literal|268
block|,
operator|-
literal|193
block|,
literal|601
block|,
literal|686
block|,
operator|-
literal|330
block|,
literal|165
block|,
literal|98
block|,
literal|75
block|,
operator|-
literal|691
block|,
operator|-
literal|605
block|,
literal|617
block|,
literal|773
block|,
literal|617
block|,
literal|619
block|,
literal|238
block|,
operator|-
literal|42
block|,
operator|-
literal|405
block|,
literal|17
block|,
literal|384
block|,
operator|-
literal|472
block|,
operator|-
literal|846
block|,
literal|520
block|,
literal|110
block|,
literal|591
block|,
operator|-
literal|217
block|,
literal|936
block|,
operator|-
literal|373
block|,
literal|731
block|,
literal|734
block|,
literal|810
block|,
literal|961
block|,
literal|881
block|,
literal|939
block|,
literal|379
block|,
operator|-
literal|905
block|,
operator|-
literal|137
block|,
literal|437
block|,
literal|298
block|,
literal|688
block|,
operator|-
literal|71
block|,
operator|-
literal|204
block|,
literal|573
block|,
operator|-
literal|120
block|,
operator|-
literal|821
block|,
literal|489
block|,
operator|-
literal|722
block|,
operator|-
literal|926
block|,
literal|529
block|,
operator|-
literal|113
block|,
operator|-
literal|243
block|,
literal|543
block|,
literal|868
block|,
operator|-
literal|301
block|,
operator|-
literal|781
block|,
operator|-
literal|549
block|,
operator|-
literal|842
block|,
operator|-
literal|489
block|,
operator|-
literal|80
block|,
operator|-
literal|910
block|,
operator|-
literal|928
block|,
literal|51
block|,
operator|-
literal|91
block|,
literal|324
block|,
literal|204
block|,
operator|-
literal|92
block|,
literal|867
block|,
literal|723
block|,
literal|248
block|,
literal|709
block|,
operator|-
literal|357
block|,
literal|591
block|,
operator|-
literal|365
block|,
operator|-
literal|379
block|,
literal|266
block|,
operator|-
literal|649
block|,
operator|-
literal|95
block|,
literal|205
block|,
literal|551
block|,
literal|355
block|,
operator|-
literal|631
block|,
literal|79
block|,
operator|-
literal|186
block|,
literal|795
block|,
operator|-
literal|7
block|,
operator|-
literal|225
block|,
literal|46
block|,
operator|-
literal|410
block|,
literal|665
block|,
operator|-
literal|874
block|,
operator|-
literal|618
block|,
literal|845
block|,
operator|-
literal|548
block|,
literal|443
block|,
literal|471
block|,
operator|-
literal|644
block|,
literal|606
block|,
operator|-
literal|607
block|,
literal|59
block|,
operator|-
literal|619
block|,
literal|288
block|,
operator|-
literal|244
block|,
literal|529
block|,
literal|690
block|,
literal|349
block|,
operator|-
literal|738
block|,
operator|-
literal|611
block|,
operator|-
literal|879
block|,
operator|-
literal|642
block|,
literal|801
block|,
operator|-
literal|178
block|,
literal|823
block|,
operator|-
literal|748
block|,
operator|-
literal|552
block|,
operator|-
literal|247
block|,
operator|-
literal|223
block|,
operator|-
literal|408
block|,
literal|651
block|,
operator|-
literal|62
block|,
literal|949
block|,
operator|-
literal|795
block|,
literal|171
block|,
operator|-
literal|107
block|,
operator|-
literal|210
block|,
operator|-
literal|207
block|,
operator|-
literal|842
block|,
operator|-
literal|86
block|,
literal|436
block|,
literal|528
block|,
literal|366
block|,
operator|-
literal|178
block|,
literal|245
block|,
operator|-
literal|695
block|,
literal|665
block|,
literal|613
block|,
operator|-
literal|948
block|,
literal|667
block|,
operator|-
literal|620
block|,
operator|-
literal|979
block|,
operator|-
literal|949
block|,
literal|905
block|,
literal|181
block|,
operator|-
literal|412
block|,
operator|-
literal|467
block|,
operator|-
literal|437
block|,
operator|-
literal|774
block|,
literal|750
block|,
operator|-
literal|10
block|,
literal|54
block|,
literal|205
block|,
operator|-
literal|674
block|,
operator|-
literal|290
block|,
operator|-
literal|924
block|,
operator|-
literal|361
block|,
operator|-
literal|463
block|,
literal|912
block|,
operator|-
literal|702
block|,
literal|622
block|,
operator|-
literal|542
block|,
literal|220
block|,
literal|115
block|,
literal|832
block|,
literal|451
block|,
operator|-
literal|38
block|,
operator|-
literal|952
block|,
operator|-
literal|230
block|,
operator|-
literal|588
block|,
literal|864
block|,
literal|234
block|,
literal|225
block|,
operator|-
literal|303
block|,
literal|493
block|,
literal|246
block|,
literal|153
block|,
literal|338
block|,
operator|-
literal|378
block|,
literal|377
block|,
operator|-
literal|819
block|,
literal|140
block|,
literal|136
block|,
literal|467
block|,
operator|-
literal|849
block|,
operator|-
literal|326
block|,
operator|-
literal|533
block|,
literal|166
block|,
literal|252
block|,
operator|-
literal|994
block|,
operator|-
literal|699
block|,
literal|904
block|,
operator|-
literal|566
block|,
literal|621
block|,
operator|-
literal|752
block|}
decl_stmt|;
end_decl_stmt
begin_class
DECL|class|HoverItem
class|class
name|HoverItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|HoverItem
name|HoverItem
parameter_list|()
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
member_init_list|,
name|isHovered
argument_list|(
literal|false
argument_list|)
block|{
name|setAcceptsHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
DECL|member|isHovered
name|bool
name|isHovered
decl_stmt|;
protected|protected:
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
name|isHovered
operator|=
operator|(
name|option
operator|->
name|state
operator|&
name|QStyle
operator|::
name|State_MouseOver
operator|)
expr_stmt|;
name|painter
operator|->
name|setOpacity
argument_list|(
literal|0.75
argument_list|)
expr_stmt|;
name|painter
operator|->
name|setPen
argument_list|(
name|Qt
operator|::
name|NoPen
argument_list|)
expr_stmt|;
name|painter
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|darkGray
argument_list|)
expr_stmt|;
name|painter
operator|->
name|drawRoundRect
argument_list|(
name|boundingRect
argument_list|()
operator|.
name|adjusted
argument_list|(
literal|3
argument_list|,
literal|3
argument_list|,
operator|-
literal|3
argument_list|,
operator|-
literal|3
argument_list|)
argument_list|,
name|Qt
operator|::
name|darkGray
argument_list|)
expr_stmt|;
name|painter
operator|->
name|setPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
expr_stmt|;
if|if
condition|(
name|isHovered
condition|)
block|{
name|painter
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
operator|.
name|light
argument_list|(
literal|120
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|painter
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|gray
argument_list|)
expr_stmt|;
block|}
name|painter
operator|->
name|drawRoundRect
argument_list|(
name|boundingRect
argument_list|()
operator|.
name|adjusted
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_class
DECL|class|EventSpy
class|class
name|EventSpy
super|:
specifier|public
name|QGraphicsWidget
block|{
name|Q_OBJECT
public|public:
DECL|function|EventSpy
name|EventSpy
parameter_list|(
name|QObject
modifier|*
name|watched
parameter_list|,
name|QEvent
operator|::
name|Type
name|type
parameter_list|)
member_init_list|:
name|_count
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|spied
argument_list|(
name|type
argument_list|)
block|{
name|watched
operator|->
name|installEventFilter
argument_list|(
name|this
argument_list|)
expr_stmt|;
block|}
DECL|function|EventSpy
name|EventSpy
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|,
name|QGraphicsItem
modifier|*
name|watched
parameter_list|,
name|QEvent
operator|::
name|Type
name|type
parameter_list|)
member_init_list|:
name|_count
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|spied
argument_list|(
name|type
argument_list|)
block|{
name|scene
operator|->
name|addItem
argument_list|(
name|this
argument_list|)
expr_stmt|;
name|watched
operator|->
name|installSceneEventFilter
argument_list|(
name|this
argument_list|)
expr_stmt|;
block|}
DECL|function|count
name|int
name|count
parameter_list|()
specifier|const
block|{
return|return
name|_count
return|;
block|}
protected|protected:
DECL|function|eventFilter
name|bool
name|eventFilter
parameter_list|(
name|QObject
modifier|*
name|watched
parameter_list|,
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
name|Q_UNUSED
argument_list|(
name|watched
argument_list|)
expr_stmt|;
if|if
condition|(
name|event
operator|->
name|type
argument_list|()
operator|==
name|spied
condition|)
operator|++
name|_count
expr_stmt|;
return|return
literal|false
return|;
block|}
DECL|function|sceneEventFilter
name|bool
name|sceneEventFilter
parameter_list|(
name|QGraphicsItem
modifier|*
name|watched
parameter_list|,
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
name|Q_UNUSED
argument_list|(
name|watched
argument_list|)
expr_stmt|;
if|if
condition|(
name|event
operator|->
name|type
argument_list|()
operator|==
name|spied
condition|)
operator|++
name|_count
expr_stmt|;
return|return
literal|false
return|;
block|}
DECL|member|_count
name|int
name|_count
decl_stmt|;
DECL|member|spied
name|QEvent
operator|::
name|Type
name|spied
decl_stmt|;
block|}
class|;
end_class
begin_class
DECL|class|tst_QGraphicsScene
class|class
name|tst_QGraphicsScene
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
public|public
name|slots
public|:
name|void
name|initTestCase
parameter_list|()
function_decl|;
name|void
name|cleanup
parameter_list|()
function_decl|;
private|private
name|slots
private|:
name|void
name|construction
parameter_list|()
function_decl|;
name|void
name|sceneRect
parameter_list|()
function_decl|;
name|void
name|itemIndexMethod
parameter_list|()
function_decl|;
name|void
name|bspTreeDepth
parameter_list|()
function_decl|;
name|void
name|itemsBoundingRect_data
parameter_list|()
function_decl|;
name|void
name|itemsBoundingRect
parameter_list|()
function_decl|;
name|void
name|items
parameter_list|()
function_decl|;
name|void
name|items_QPointF_data
parameter_list|()
function_decl|;
name|void
name|items_QPointF
parameter_list|()
function_decl|;
name|void
name|items_QRectF
parameter_list|()
function_decl|;
name|void
name|items_QRectF_2_data
parameter_list|()
function_decl|;
name|void
name|items_QRectF_2
parameter_list|()
function_decl|;
name|void
name|items_QPolygonF
parameter_list|()
function_decl|;
name|void
name|items_QPolygonF_2
parameter_list|()
function_decl|;
name|void
name|items_QPainterPath
parameter_list|()
function_decl|;
name|void
name|items_QPainterPath_2
parameter_list|()
function_decl|;
name|void
name|selectionChanged
parameter_list|()
function_decl|;
name|void
name|selectionChanged2
parameter_list|()
function_decl|;
name|void
name|addItem
parameter_list|()
function_decl|;
name|void
name|addEllipse
parameter_list|()
function_decl|;
name|void
name|addLine
parameter_list|()
function_decl|;
name|void
name|addPath
parameter_list|()
function_decl|;
name|void
name|addPixmap
parameter_list|()
function_decl|;
name|void
name|addRect
parameter_list|()
function_decl|;
name|void
name|addText
parameter_list|()
function_decl|;
name|void
name|removeItem
parameter_list|()
function_decl|;
name|void
name|clear
parameter_list|()
function_decl|;
name|void
name|focusItem
parameter_list|()
function_decl|;
name|void
name|focusItemLostFocus
parameter_list|()
function_decl|;
name|void
name|setFocusItem
parameter_list|()
function_decl|;
name|void
name|setFocusItem_inactive
parameter_list|()
function_decl|;
name|void
name|mouseGrabberItem
parameter_list|()
function_decl|;
name|void
name|hoverEvents_siblings
parameter_list|()
function_decl|;
name|void
name|hoverEvents_parentChild
parameter_list|()
function_decl|;
name|void
name|createItemGroup
parameter_list|()
function_decl|;
name|void
name|mouseEventPropagation
parameter_list|()
function_decl|;
name|void
name|mouseEventPropagation_ignore
parameter_list|()
function_decl|;
name|void
name|mouseEventPropagation_focus
parameter_list|()
function_decl|;
name|void
name|mouseEventPropagation_doubleclick
parameter_list|()
function_decl|;
name|void
name|mouseEventPropagation_mouseMove
parameter_list|()
function_decl|;
ifndef|#
directive|ifndef
name|QT_NO_DRAGANDDROP
name|void
name|dragAndDrop_simple
parameter_list|()
function_decl|;
name|void
name|dragAndDrop_disabledOrInvisible
parameter_list|()
function_decl|;
name|void
name|dragAndDrop_propagate
parameter_list|()
function_decl|;
endif|#
directive|endif
name|void
name|render_data
parameter_list|()
function_decl|;
name|void
name|render
parameter_list|()
function_decl|;
name|void
name|renderItemsWithNegativeWidthOrHeight
parameter_list|()
function_decl|;
name|void
name|contextMenuEvent
parameter_list|()
function_decl|;
name|void
name|contextMenuEvent_ItemIgnoresTransformations
parameter_list|()
function_decl|;
name|void
name|update
parameter_list|()
function_decl|;
name|void
name|update2
parameter_list|()
function_decl|;
name|void
name|views
parameter_list|()
function_decl|;
name|void
name|event
parameter_list|()
function_decl|;
name|void
name|eventsToDisabledItems
parameter_list|()
function_decl|;
name|void
name|exposedRect
parameter_list|()
function_decl|;
name|void
name|tabFocus_emptyScene
parameter_list|()
function_decl|;
name|void
name|tabFocus_sceneWithFocusableItems
parameter_list|()
function_decl|;
name|void
name|tabFocus_sceneWithFocusWidgets
parameter_list|()
function_decl|;
name|void
name|tabFocus_sceneWithNestedFocusWidgets
parameter_list|()
function_decl|;
name|void
name|style
parameter_list|()
function_decl|;
name|void
name|sorting_data
parameter_list|()
function_decl|;
name|void
name|sorting
parameter_list|()
function_decl|;
name|void
name|changedSignal_data
parameter_list|()
function_decl|;
name|void
name|changedSignal
parameter_list|()
function_decl|;
name|void
name|stickyFocus_data
parameter_list|()
function_decl|;
name|void
name|stickyFocus
parameter_list|()
function_decl|;
name|void
name|sendEvent
parameter_list|()
function_decl|;
name|void
name|inputMethod_data
parameter_list|()
function_decl|;
name|void
name|inputMethod
parameter_list|()
function_decl|;
name|void
name|dispatchHoverOnPress
parameter_list|()
function_decl|;
name|void
name|initialFocus_data
parameter_list|()
function_decl|;
name|void
name|initialFocus
parameter_list|()
function_decl|;
name|void
name|polishItems
parameter_list|()
function_decl|;
name|void
name|polishItems2
parameter_list|()
function_decl|;
name|void
name|isActive
parameter_list|()
function_decl|;
name|void
name|siblingIndexAlwaysValid
parameter_list|()
function_decl|;
name|void
name|removeFullyTransparentItem
parameter_list|()
function_decl|;
name|void
name|zeroScale
parameter_list|()
function_decl|;
comment|// task specific tests below me
name|void
name|task139710_bspTreeCrash
parameter_list|()
function_decl|;
name|void
name|task139782_containsItemBoundingRect
parameter_list|()
function_decl|;
name|void
name|task176178_itemIndexMethodBreaksSceneRect
parameter_list|()
function_decl|;
name|void
name|task160653_selectionChanged
parameter_list|()
function_decl|;
name|void
name|task250680_childClip
parameter_list|()
function_decl|;
name|void
name|taskQTBUG_5904_crashWithDeviceCoordinateCache
parameter_list|()
function_decl|;
name|void
name|taskQT657_paintIntoCacheWithTransparentParts
parameter_list|()
function_decl|;
name|void
name|taskQTBUG_7863_paintIntoCacheWithTransparentParts
parameter_list|()
function_decl|;
name|void
name|taskQT_3674_doNotCrash
parameter_list|()
function_decl|;
name|void
name|taskQTBUG_15977_renderWithDeviceCoordinateCache
parameter_list|()
function_decl|;
name|void
name|taskQTBUG_16401_focusItem
parameter_list|()
function_decl|;
block|}
class|;
end_class
begin_function
DECL|function|initTestCase
name|void
name|tst_QGraphicsScene
operator|::
name|initTestCase
parameter_list|()
block|{
ifdef|#
directive|ifdef
name|Q_OS_WINCE
comment|//disable magic for WindowsCE
name|qApp
operator|->
name|setAutoMaximizeThreshold
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function
begin_function
DECL|function|cleanup
name|void
name|tst_QGraphicsScene
operator|::
name|cleanup
parameter_list|()
block|{
comment|// ensure not even skipped tests with custom input context leave it dangling
name|QInputMethodPrivate
modifier|*
name|inputMethodPrivate
init|=
name|QInputMethodPrivate
operator|::
name|get
argument_list|(
name|qApp
operator|->
name|inputMethod
argument_list|()
argument_list|)
decl_stmt|;
name|inputMethodPrivate
operator|->
name|testContext
operator|=
literal|0
expr_stmt|;
block|}
end_function
begin_function
DECL|function|construction
name|void
name|tst_QGraphicsScene
operator|::
name|construction
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemsBoundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|()
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|()
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|()
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPainterPath
argument_list|()
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|ignoreMessage
argument_list|(
name|QtWarningMsg
argument_list|,
literal|"QGraphicsScene::collidingItems: cannot find collisions for null item"
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|collidingItems
argument_list|(
literal|0
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|itemAt
argument_list|(
name|QPointF
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sceneRect
name|void
name|tst_QGraphicsScene
operator|::
name|sceneRect
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QSignalSpy
name|sceneRectChanged
argument_list|(
operator|&
name|scene
argument_list|,
name|SIGNAL
argument_list|(
name|sceneRectChanged
argument_list|(
name|QRectF
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneRectChanged
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setPos
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneRectChanged
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneRectChanged
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneRectChanged
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneRectChanged
operator|.
name|last
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|toRectF
argument_list|()
argument_list|,
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setPos
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|,
literal|15
argument_list|,
literal|15
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneRectChanged
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneRectChanged
operator|.
name|last
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|toRectF
argument_list|()
argument_list|,
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneRectChanged
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneRectChanged
operator|.
name|last
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|toRectF
argument_list|()
argument_list|,
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneRectChanged
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneRectChanged
operator|.
name|last
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|toRectF
argument_list|()
argument_list|,
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
name|QRectF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneRectChanged
operator|.
name|count
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneRectChanged
operator|.
name|count
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneRectChanged
operator|.
name|last
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|toRectF
argument_list|()
argument_list|,
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemIndexMethod
name|void
name|tst_QGraphicsScene
operator|::
name|itemIndexMethod
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemIndexMethod
argument_list|()
argument_list|,
name|QGraphicsScene
operator|::
name|BspTreeIndex
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|Q_PROCESSOR_ARM
specifier|const
name|int
name|minY
init|=
operator|-
literal|500
decl_stmt|;
specifier|const
name|int
name|maxY
init|=
literal|500
decl_stmt|;
specifier|const
name|int
name|minX
init|=
operator|-
literal|500
decl_stmt|;
specifier|const
name|int
name|maxX
init|=
literal|500
decl_stmt|;
else|#
directive|else
specifier|const
name|int
name|minY
init|=
operator|-
literal|1000
decl_stmt|;
specifier|const
name|int
name|maxY
init|=
literal|2000
decl_stmt|;
specifier|const
name|int
name|minX
init|=
operator|-
literal|1000
decl_stmt|;
specifier|const
name|int
name|maxX
init|=
literal|2000
decl_stmt|;
endif|#
directive|endif
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|items
decl_stmt|;
for|for
control|(
name|int
name|y
init|=
name|minY
init|;
name|y
operator|<
name|maxY
condition|;
name|y
operator|+=
literal|100
control|)
block|{
for|for
control|(
name|int
name|x
init|=
name|minX
init|;
name|x
operator|<
name|maxX
condition|;
name|x
operator|+=
literal|100
control|)
block|{
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setPos
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|items
operator|<<
name|item
expr_stmt|;
block|}
block|}
name|int
name|n
init|=
literal|0
decl_stmt|;
for|for
control|(
name|int
name|y
init|=
name|minY
init|;
name|y
operator|<
name|maxY
condition|;
name|y
operator|+=
literal|100
control|)
block|{
for|for
control|(
name|int
name|x
init|=
name|minX
init|;
name|x
operator|<
name|maxX
condition|;
name|x
operator|+=
literal|100
control|)
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
argument_list|,
name|items
operator|.
name|at
argument_list|(
name|n
operator|++
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|scene
operator|.
name|setItemIndexMethod
argument_list|(
name|QGraphicsScene
operator|::
name|NoIndex
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemIndexMethod
argument_list|()
argument_list|,
name|QGraphicsScene
operator|::
name|NoIndex
argument_list|)
expr_stmt|;
name|n
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|int
name|y
init|=
name|minY
init|;
name|y
operator|<
name|maxY
condition|;
name|y
operator|+=
literal|100
control|)
block|{
for|for
control|(
name|int
name|x
init|=
name|minX
init|;
name|x
operator|<
name|maxX
condition|;
name|x
operator|+=
literal|100
control|)
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
argument_list|,
name|items
operator|.
name|at
argument_list|(
name|n
operator|++
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|scene
operator|.
name|setItemIndexMethod
argument_list|(
name|QGraphicsScene
operator|::
name|BspTreeIndex
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemIndexMethod
argument_list|()
argument_list|,
name|QGraphicsScene
operator|::
name|BspTreeIndex
argument_list|)
expr_stmt|;
name|n
operator|=
literal|0
expr_stmt|;
for|for
control|(
name|int
name|y
init|=
name|minY
init|;
name|y
operator|<
name|maxY
condition|;
name|y
operator|+=
literal|100
control|)
block|{
for|for
control|(
name|int
name|x
init|=
name|minX
init|;
name|x
operator|<
name|maxX
condition|;
name|x
operator|+=
literal|100
control|)
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
argument_list|,
name|items
operator|.
name|at
argument_list|(
name|n
operator|++
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|bspTreeDepth
name|void
name|tst_QGraphicsScene
operator|::
name|bspTreeDepth
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemIndexMethod
argument_list|()
argument_list|,
name|QGraphicsScene
operator|::
name|BspTreeIndex
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|bspTreeDepth
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setBspTreeDepth
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|bspTreeDepth
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|ignoreMessage
argument_list|(
name|QtWarningMsg
argument_list|,
literal|"QGraphicsScene::setBspTreeDepth: invalid depth -1 ignored; must be>= 0"
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setBspTreeDepth
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|bspTreeDepth
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|items
name|void
name|tst_QGraphicsScene
operator|::
name|items
parameter_list|()
block|{
ifdef|#
directive|ifdef
name|Q_PROCESSOR_ARM
specifier|const
name|int
name|minY
init|=
operator|-
literal|500
decl_stmt|;
specifier|const
name|int
name|maxY
init|=
literal|500
decl_stmt|;
specifier|const
name|int
name|minX
init|=
operator|-
literal|500
decl_stmt|;
specifier|const
name|int
name|maxX
init|=
literal|500
decl_stmt|;
else|#
directive|else
specifier|const
name|int
name|minY
init|=
operator|-
literal|1000
decl_stmt|;
specifier|const
name|int
name|maxY
init|=
literal|2000
decl_stmt|;
specifier|const
name|int
name|minX
init|=
operator|-
literal|1000
decl_stmt|;
specifier|const
name|int
name|maxX
init|=
literal|2000
decl_stmt|;
endif|#
directive|endif
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|items
decl_stmt|;
for|for
control|(
name|int
name|y
init|=
name|minY
init|;
name|y
operator|<
name|maxY
condition|;
name|y
operator|+=
literal|100
control|)
block|{
for|for
control|(
name|int
name|x
init|=
name|minX
init|;
name|x
operator|<
name|maxX
condition|;
name|x
operator|+=
literal|100
control|)
name|items
operator|<<
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
name|items
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// trigger indexing
name|scene
operator|.
name|removeItem
argument_list|(
name|items
operator|.
name|at
argument_list|(
literal|5
argument_list|)
argument_list|)
expr_stmt|;
operator|delete
name|items
operator|.
name|at
argument_list|(
literal|5
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|items
argument_list|()
operator|.
name|contains
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
operator|delete
name|items
operator|.
name|at
argument_list|(
literal|7
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|items
argument_list|()
operator|.
name|contains
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsLineItem
modifier|*
name|l1
init|=
name|scene
operator|.
name|addLine
argument_list|(
operator|-
literal|5
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|l1
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsLineItem
modifier|*
name|l2
init|=
name|scene
operator|.
name|addLine
argument_list|(
literal|0
argument_list|,
operator|-
literal|5
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|)
decl_stmt|;
name|l2
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|l1
operator|->
name|sceneBoundingRect
argument_list|()
operator|.
name|intersects
argument_list|(
name|l2
operator|->
name|sceneBoundingRect
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|l2
operator|->
name|sceneBoundingRect
argument_list|()
operator|.
name|intersects
argument_list|(
name|l1
operator|->
name|sceneBoundingRect
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|items
decl_stmt|;
name|items
operator|<<
name|l1
operator|<<
name|l2
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
name|items
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
operator|.
name|contains
argument_list|(
name|l1
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
operator|.
name|contains
argument_list|(
name|l2
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|itemsBoundingRect_data
name|void
name|tst_QGraphicsScene
operator|::
name|itemsBoundingRect_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|>
argument_list|(
literal|"rects"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QMatrix
argument_list|>
argument_list|(
literal|"matrix"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QRectF
argument_list|>
argument_list|(
literal|"boundingRect"
argument_list|)
expr_stmt|;
name|QMatrix
name|transformationMatrix
decl_stmt|;
name|transformationMatrix
operator|.
name|translate
argument_list|(
literal|50
argument_list|,
operator|-
literal|50
argument_list|)
expr_stmt|;
name|transformationMatrix
operator|.
name|scale
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|transformationMatrix
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"none"
argument_list|)
operator|<<
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|()
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QRectF
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"{{0, 0, 10, 10}}"
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|)
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"{{-10, -10, 10, 10}}"
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|()
operator|<<
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|)
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"{{-1000, -1000, 1, 1}, {-10, -10, 10, 10}}"
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|()
operator|<<
name|QRectF
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|)
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QRectF
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|,
literal|1000
argument_list|,
literal|1000
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"transformed {{0, 0, 10, 10}}"
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|)
operator|<<
name|transformationMatrix
operator|<<
name|QRectF
argument_list|(
literal|30
argument_list|,
operator|-
literal|50
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"transformed {{-10, -10, 10, 10}}"
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|()
operator|<<
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|)
operator|<<
name|transformationMatrix
operator|<<
name|QRectF
argument_list|(
literal|50
argument_list|,
operator|-
literal|70
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"transformed {{-1000, -1000, 1, 1}, {-10, -10, 10, 10}}"
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|()
operator|<<
name|QRectF
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|)
operator|<<
name|transformationMatrix
operator|<<
name|QRectF
argument_list|(
literal|50
argument_list|,
operator|-
literal|2050
argument_list|,
literal|2000
argument_list|,
literal|2000
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QRectF
argument_list|>
name|all
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|256
condition|;
operator|++
name|i
control|)
name|all
operator|<<
name|QRectF
argument_list|(
name|randomX
index|[
name|i
index|]
argument_list|,
name|randomY
index|[
name|i
index|]
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"all"
argument_list|)
operator|<<
name|all
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QRectF
argument_list|(
operator|-
literal|980
argument_list|,
operator|-
literal|994
argument_list|,
literal|1988
argument_list|,
literal|1983
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"transformed all"
argument_list|)
operator|<<
name|all
operator|<<
name|transformationMatrix
operator|<<
name|QRectF
argument_list|(
operator|-
literal|1928
argument_list|,
operator|-
literal|2010
argument_list|,
literal|3966
argument_list|,
literal|3976
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemsBoundingRect
name|void
name|tst_QGraphicsScene
operator|::
name|itemsBoundingRect
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|,
name|rects
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QMatrix
argument_list|,
name|matrix
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QRectF
argument_list|,
name|boundingRect
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
foreach|foreach
control|(
name|QRectF
name|rect
decl|,
name|rects
control|)
block|{
name|QPainterPath
name|path
decl_stmt|;
name|path
operator|.
name|addRect
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|QGraphicsPathItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addPath
argument_list|(
name|path
argument_list|)
decl_stmt|;
name|item
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setMatrix
argument_list|(
name|matrix
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemsBoundingRect
argument_list|()
argument_list|,
name|boundingRect
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|items_QPointF_data
name|void
name|tst_QGraphicsScene
operator|::
name|items_QPointF_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|>
argument_list|(
literal|"items"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QPointF
argument_list|>
argument_list|(
literal|"point"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QList
argument_list|<
name|int
argument_list|>
argument_list|>
argument_list|(
literal|"itemsAtPoint"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"empty"
argument_list|)
operator|<<
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|()
operator|<<
name|QPointF
argument_list|()
operator|<<
name|QList
argument_list|<
name|int
argument_list|>
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"1"
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|)
operator|<<
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|int
argument_list|>
argument_list|()
operator|<<
literal|0
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2"
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|)
operator|<<
name|QPointF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|int
argument_list|>
argument_list|()
operator|<<
literal|0
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"3"
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|)
operator|<<
name|QPointF
argument_list|(
literal|9.9
argument_list|,
literal|9.9
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|int
argument_list|>
argument_list|()
operator|<<
literal|0
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"3.5"
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|)
operator|<<
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|QList
argument_list|<
name|int
argument_list|>
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"4"
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|9.9
argument_list|,
literal|9.9
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|)
operator|<<
name|QPointF
argument_list|(
literal|9.9
argument_list|,
literal|9.9
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|int
argument_list|>
argument_list|()
operator|<<
literal|1
operator|<<
literal|0
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"4.5"
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|)
operator|<<
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|int
argument_list|>
argument_list|()
operator|<<
literal|1
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"5"
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|)
operator|<<
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|int
argument_list|>
argument_list|()
operator|<<
literal|1
operator|<<
literal|0
operator|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"6"
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|30
argument_list|)
operator|)
operator|<<
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
operator|(
name|QList
argument_list|<
name|int
argument_list|>
argument_list|()
operator|<<
literal|2
operator|<<
literal|1
operator|<<
literal|0
operator|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|items_QPointF
name|void
name|tst_QGraphicsScene
operator|::
name|items_QPointF
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|,
name|items
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QPointF
argument_list|,
name|point
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QList
argument_list|<
name|int
argument_list|>
argument_list|,
name|itemsAtPoint
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|int
name|n
init|=
literal|0
decl_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|addedItems
decl_stmt|;
foreach|foreach
control|(
name|QRectF
name|rect
decl|,
name|items
control|)
block|{
name|QPainterPath
name|path
decl_stmt|;
name|path
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|rect
operator|.
name|width
argument_list|()
argument_list|,
name|rect
operator|.
name|height
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsPathItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addPath
argument_list|(
name|path
argument_list|)
decl_stmt|;
name|item
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setZValue
argument_list|(
name|n
operator|++
argument_list|)
expr_stmt|;
name|item
operator|->
name|setPos
argument_list|(
name|rect
operator|.
name|topLeft
argument_list|()
argument_list|)
expr_stmt|;
name|addedItems
operator|<<
name|item
expr_stmt|;
block|}
name|QList
argument_list|<
name|int
argument_list|>
name|itemIndexes
decl_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|scene
operator|.
name|items
argument_list|(
name|point
argument_list|)
control|)
name|itemIndexes
operator|<<
name|addedItems
operator|.
name|indexOf
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemIndexes
argument_list|,
name|itemsAtPoint
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|items_QRectF
name|void
name|tst_QGraphicsScene
operator|::
name|items_QRectF
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item1
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item3
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item4
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|item3
operator|->
name|setZValue
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|item4
operator|->
name|setZValue
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|40
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item2
operator|<<
name|item1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|40
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item4
operator|<<
name|item3
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setZValue
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setZValue
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|item3
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|item4
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|40
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item1
operator|<<
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|40
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item3
operator|<<
name|item4
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|items_QRectF_2_data
name|void
name|tst_QGraphicsScene
operator|::
name|items_QRectF_2_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QRectF
argument_list|>
argument_list|(
literal|"ellipseRect"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QRectF
argument_list|>
argument_list|(
literal|"sceneRect"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|Qt
operator|::
name|ItemSelectionMode
argument_list|>
argument_list|(
literal|"selectionMode"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"contained"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"containedRotated"
argument_list|)
expr_stmt|;
comment|// None of the rects contain the ellipse's shape nor bounding rect
name|QTest
operator|::
name|newRow
argument_list|(
literal|"1"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemShape
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemShape
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"3"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemShape
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"4"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemShape
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"5"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemBoundingRect
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"6"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemBoundingRect
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"7"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemBoundingRect
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"8"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemBoundingRect
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"9"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemShape
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"10"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemShape
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"11"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemShape
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"12"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemShape
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"13"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemBoundingRect
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"14"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemBoundingRect
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"15"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemBoundingRect
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"16"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemBoundingRect
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"17"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemShape
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"18"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemShape
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"19"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|50
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemShape
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"20"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemShape
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"21"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemBoundingRect
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"22"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemBoundingRect
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"23"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|50
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemBoundingRect
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
comment|// The rect is the same as the ellipse's bounding rect
name|QTest
operator|::
name|newRow
argument_list|(
literal|"24"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemBoundingRect
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
comment|// None intersects with the item's shape, but they all intersects with the
comment|// item's bounding rect.
name|QTest
operator|::
name|newRow
argument_list|(
literal|"25"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IntersectsItemShape
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"26"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IntersectsItemShape
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"27"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IntersectsItemShape
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"28"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IntersectsItemShape
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"29"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IntersectsItemBoundingRect
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"30"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IntersectsItemBoundingRect
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"31"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IntersectsItemBoundingRect
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"32"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IntersectsItemBoundingRect
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
comment|// This rect does not contain the shape nor the bounding rect
name|QTest
operator|::
name|newRow
argument_list|(
literal|"33"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|,
literal|90
argument_list|,
literal|90
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemShape
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"34"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|,
literal|90
argument_list|,
literal|90
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemBoundingRect
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
comment|// It will, however, intersect with both
name|QTest
operator|::
name|newRow
argument_list|(
literal|"35"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|,
literal|90
argument_list|,
literal|90
argument_list|)
operator|<<
name|Qt
operator|::
name|IntersectsItemShape
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"36"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|,
literal|90
argument_list|,
literal|90
argument_list|)
operator|<<
name|Qt
operator|::
name|IntersectsItemBoundingRect
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
comment|// A rect that contains the whole ellipse will both contain and intersect
comment|// with both the ellipse's shape and bounding rect.
name|QTest
operator|::
name|newRow
argument_list|(
literal|"37"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|,
literal|110
argument_list|,
literal|110
argument_list|)
operator|<<
name|Qt
operator|::
name|IntersectsItemBoundingRect
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"38"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|,
literal|110
argument_list|,
literal|110
argument_list|)
operator|<<
name|Qt
operator|::
name|IntersectsItemShape
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"39"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|,
literal|110
argument_list|,
literal|110
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemBoundingRect
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"40"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|,
literal|110
argument_list|,
literal|110
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemShape
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
comment|// A rect that is fully contained within the ellipse will intersect only
name|QTest
operator|::
name|newRow
argument_list|(
literal|"41"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemShape
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"42"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
operator|<<
name|Qt
operator|::
name|ContainsItemBoundingRect
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"43"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
operator|<<
name|Qt
operator|::
name|IntersectsItemShape
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"44"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
operator|<<
name|Qt
operator|::
name|IntersectsItemBoundingRect
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_function
DECL|function|items_QRectF_2
name|void
name|tst_QGraphicsScene
operator|::
name|items_QRectF_2
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QRectF
argument_list|,
name|ellipseRect
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QRectF
argument_list|,
name|sceneRect
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|Qt
operator|::
name|ItemSelectionMode
argument_list|,
name|selectionMode
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|contained
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|containedRotated
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addEllipse
argument_list|(
name|ellipseRect
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
operator|!
name|scene
operator|.
name|items
argument_list|(
name|sceneRect
argument_list|,
name|selectionMode
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|,
name|contained
argument_list|)
expr_stmt|;
name|item
operator|->
name|rotate
argument_list|(
literal|45
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
operator|!
name|scene
operator|.
name|items
argument_list|(
name|sceneRect
argument_list|,
name|selectionMode
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|,
name|containedRotated
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|items_QPolygonF
name|void
name|tst_QGraphicsScene
operator|::
name|items_QPolygonF
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item1
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item3
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item4
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|item3
operator|->
name|setZValue
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|item4
operator|->
name|setZValue
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|QPolygonF
name|poly1
argument_list|(
name|item1
operator|->
name|boundingRect
argument_list|()
argument_list|)
decl_stmt|;
name|QPolygonF
name|poly2
argument_list|(
name|item2
operator|->
name|boundingRect
argument_list|()
argument_list|)
decl_stmt|;
name|QPolygonF
name|poly3
argument_list|(
name|item3
operator|->
name|boundingRect
argument_list|()
argument_list|)
decl_stmt|;
name|QPolygonF
name|poly4
argument_list|(
name|item4
operator|->
name|boundingRect
argument_list|()
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|poly1
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|poly2
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|poly3
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|poly4
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item4
argument_list|)
expr_stmt|;
name|poly1
operator|=
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|poly2
operator|=
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|poly3
operator|=
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|poly4
operator|=
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|poly1
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|poly2
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|poly3
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|poly4
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item4
argument_list|)
expr_stmt|;
name|poly1
operator|=
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|40
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|poly2
operator|=
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|40
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|poly1
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item2
operator|<<
name|item1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|poly2
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item4
operator|<<
name|item3
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setZValue
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setZValue
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|item3
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|item4
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|poly1
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item1
operator|<<
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|poly2
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item3
operator|<<
name|item4
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|items_QPolygonF_2
name|void
name|tst_QGraphicsScene
operator|::
name|items_QPolygonF_2
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|ellipse
init|=
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
comment|// None of the rects contain the ellipse's shape nor bounding rect
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|ContainsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|ContainsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|ContainsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|ContainsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|ContainsItemBoundingRect
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|ContainsItemBoundingRect
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|ContainsItemBoundingRect
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|ContainsItemBoundingRect
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
comment|// None intersects with the item's shape, but they all intersects with the
comment|// item's bounding rect.
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
comment|// This rect does not contain the shape nor the bounding rect
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|,
literal|90
argument_list|,
literal|90
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|ContainsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|,
literal|90
argument_list|,
literal|90
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|ContainsItemBoundingRect
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
comment|// It will, however, intersect with both
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|,
literal|90
argument_list|,
literal|90
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemShape
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|,
literal|90
argument_list|,
literal|90
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
comment|// A rect that contains the whole ellipse will both contain and intersect
comment|// with both the ellipse's shape and bounding rect.
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|,
literal|110
argument_list|,
literal|110
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemShape
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|,
literal|110
argument_list|,
literal|110
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|ContainsItemShape
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|,
literal|110
argument_list|,
literal|110
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPolygonF
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|,
literal|110
argument_list|,
literal|110
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|ContainsItemBoundingRect
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|items_QPainterPath
name|void
name|tst_QGraphicsScene
operator|::
name|items_QPainterPath
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item1
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item3
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item4
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|item3
operator|->
name|setZValue
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|item4
operator|->
name|setZValue
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|QPainterPath
name|path1
decl_stmt|;
name|path1
operator|.
name|addEllipse
argument_list|(
name|item1
operator|->
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
name|QPainterPath
name|path2
decl_stmt|;
name|path2
operator|.
name|addEllipse
argument_list|(
name|item2
operator|->
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
name|QPainterPath
name|path3
decl_stmt|;
name|path3
operator|.
name|addEllipse
argument_list|(
name|item3
operator|->
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
name|QPainterPath
name|path4
decl_stmt|;
name|path4
operator|.
name|addEllipse
argument_list|(
name|item4
operator|->
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|path1
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|path2
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|path3
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|path4
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item4
argument_list|)
expr_stmt|;
name|path1
operator|=
name|QPainterPath
argument_list|()
expr_stmt|;
name|path1
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|path2
operator|=
name|QPainterPath
argument_list|()
expr_stmt|;
name|path2
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|path3
operator|=
name|QPainterPath
argument_list|()
expr_stmt|;
name|path3
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|path4
operator|=
name|QPainterPath
argument_list|()
expr_stmt|;
name|path4
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|path1
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|path2
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|path3
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|path4
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item4
argument_list|)
expr_stmt|;
name|path1
operator|=
name|QPainterPath
argument_list|()
expr_stmt|;
name|path1
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|40
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|path2
operator|=
name|QPainterPath
argument_list|()
expr_stmt|;
name|path2
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|40
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|path1
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item2
operator|<<
name|item1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|path2
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item4
operator|<<
name|item3
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setZValue
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setZValue
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|item3
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|item4
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|path1
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item1
operator|<<
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|path2
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item3
operator|<<
name|item4
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|items_QPainterPath_2
name|void
name|tst_QGraphicsScene
operator|::
name|items_QPainterPath_2
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|ellipse
init|=
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QPainterPath
name|p1
decl_stmt|;
name|p1
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QPainterPath
name|p2
decl_stmt|;
name|p2
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|1
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QPainterPath
name|p3
decl_stmt|;
name|p3
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QPainterPath
name|p4
decl_stmt|;
name|p4
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|89
argument_list|,
literal|89
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
comment|// None of the rects contain the ellipse's shape nor bounding rect
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p1
argument_list|,
name|Qt
operator|::
name|ContainsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p2
argument_list|,
name|Qt
operator|::
name|ContainsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p3
argument_list|,
name|Qt
operator|::
name|ContainsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p4
argument_list|,
name|Qt
operator|::
name|ContainsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p1
argument_list|,
name|Qt
operator|::
name|ContainsItemBoundingRect
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p2
argument_list|,
name|Qt
operator|::
name|ContainsItemBoundingRect
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p3
argument_list|,
name|Qt
operator|::
name|ContainsItemBoundingRect
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p4
argument_list|,
name|Qt
operator|::
name|ContainsItemBoundingRect
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
comment|// None intersects with the item's shape, but they all intersects with the
comment|// item's bounding rect.
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p1
argument_list|,
name|Qt
operator|::
name|IntersectsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p2
argument_list|,
name|Qt
operator|::
name|IntersectsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p3
argument_list|,
name|Qt
operator|::
name|IntersectsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p4
argument_list|,
name|Qt
operator|::
name|IntersectsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p1
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p2
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p3
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p4
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
name|QPainterPath
name|p5
decl_stmt|;
name|p5
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|,
literal|90
argument_list|,
literal|90
argument_list|)
argument_list|)
expr_stmt|;
comment|// This rect does not contain the shape nor the bounding rect
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p5
argument_list|,
name|Qt
operator|::
name|ContainsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p5
argument_list|,
name|Qt
operator|::
name|ContainsItemBoundingRect
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
comment|// It will, however, intersect with both
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p5
argument_list|,
name|Qt
operator|::
name|IntersectsItemShape
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p5
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
name|QPainterPath
name|p6
decl_stmt|;
name|p6
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|,
literal|110
argument_list|,
literal|110
argument_list|)
argument_list|)
expr_stmt|;
comment|// A rect that contains the whole ellipse will both contain and intersect
comment|// with both the ellipse's shape and bounding rect.
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p6
argument_list|,
name|Qt
operator|::
name|IntersectsItemShape
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p6
argument_list|,
name|Qt
operator|::
name|ContainsItemShape
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p6
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|p6
argument_list|,
name|Qt
operator|::
name|ContainsItemBoundingRect
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|ellipse
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|CustomView
class|class
name|CustomView
super|:
specifier|public
name|QGraphicsView
block|{
public|public:
DECL|function|CustomView
name|CustomView
parameter_list|()
member_init_list|:
name|repaints
argument_list|(
literal|0
argument_list|)
block|{ }
DECL|member|repaints
name|int
name|repaints
decl_stmt|;
protected|protected:
DECL|function|paintEvent
name|void
name|paintEvent
parameter_list|(
name|QPaintEvent
modifier|*
name|event
parameter_list|)
block|{
operator|++
name|repaints
expr_stmt|;
name|QGraphicsView
operator|::
name|paintEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|selectionChanged
name|void
name|tst_QGraphicsScene
operator|::
name|selectionChanged
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
name|QSignalSpy
name|spy
argument_list|(
operator|&
name|scene
argument_list|,
name|SIGNAL
argument_list|(
name|selectionChanged
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QPainterPath
name|path
decl_stmt|;
name|path
operator|.
name|addRect
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|selectionArea
argument_list|()
argument_list|,
name|QPainterPath
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setSelectionArea
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|selectionArea
argument_list|()
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// selection didn't change
name|QVERIFY
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|rect
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// selection didn't change
name|rect
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// selection didn't change, item isn't selectable
name|rect
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// selection changed
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|rect
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setSelected
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// selection changed
name|QVERIFY
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsEllipseItem
modifier|*
name|parentItem
init|=
operator|new
name|QGraphicsEllipseItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsEllipseItem
modifier|*
name|childItem
init|=
operator|new
name|QGraphicsEllipseItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|parentItem
argument_list|)
decl_stmt|;
name|QGraphicsEllipseItem
modifier|*
name|grandChildItem
init|=
operator|new
name|QGraphicsEllipseItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|childItem
argument_list|)
decl_stmt|;
name|grandChildItem
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|grandChildItem
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|grandChildItem
operator|->
name|setSelected
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|grandChildItem
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parentItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|// the grandchild was added, so the selection changed once
name|scene
operator|.
name|removeItem
argument_list|(
name|parentItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
comment|// the grandchild was removed, so the selection changed
name|rect
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|// the rect was reselected, so the selection changed
name|scene
operator|.
name|clearSelection
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|6
argument_list|)
expr_stmt|;
comment|// the scene selection was cleared
name|rect
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|7
argument_list|)
expr_stmt|;
comment|// the rect was reselected, so the selection changed
name|rect
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|// the rect was unselected, so the selection changed
name|rect
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|// the rect is not longer selectable, so the selection does not change
name|rect
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|9
argument_list|)
expr_stmt|;
comment|// the rect is again selectable, so the selection changed
operator|delete
name|rect
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|10
argument_list|)
expr_stmt|;
comment|// a selected item was deleted; selection changed
block|}
end_function
begin_function
DECL|function|selectionChanged2
name|void
name|tst_QGraphicsScene
operator|::
name|selectionChanged2
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QSignalSpy
name|spy
argument_list|(
operator|&
name|scene
argument_list|,
name|SIGNAL
argument_list|(
name|selectionChanged
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item1
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item2
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|150
argument_list|,
literal|150
argument_list|)
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|150
argument_list|,
literal|150
argument_list|)
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setModifiers
argument_list|(
name|Qt
operator|::
name|ControlModifier
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|addItem
name|void
name|tst_QGraphicsScene
operator|::
name|addItem
parameter_list|()
block|{
name|Q_CHECK_PAINTEVENTS
block|{
comment|// 1) Create item, then scene, then add item
name|QGraphicsItem
modifier|*
name|path
init|=
operator|new
name|QGraphicsEllipseItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|CustomView
name|view
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|view
operator|.
name|repaints
operator|=
literal|0
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|path
argument_list|)
expr_stmt|;
comment|// Adding an item should always issue a repaint.
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|repaints
operator|=
literal|0
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|path2
init|=
operator|new
name|QGraphicsEllipseItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|path2
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|path2
argument_list|)
expr_stmt|;
comment|// Adding an item should always issue a repaint.
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|path2
argument_list|)
expr_stmt|;
block|}
block|{
comment|// 2) Create scene, then item, then add item
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|path
init|=
operator|new
name|QGraphicsEllipseItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|path2
init|=
operator|new
name|QGraphicsEllipseItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|path2
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|path2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|path2
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|addEllipse
name|void
name|tst_QGraphicsScene
operator|::
name|addEllipse
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsEllipseItem
modifier|*
name|ellipse
init|=
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|ellipse
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|ellipse
operator|->
name|pen
argument_list|()
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|ellipse
operator|->
name|brush
argument_list|()
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|ellipse
operator|->
name|rect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
operator|-
literal|9.9
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
operator|-
literal|9.9
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|9.9
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|9.9
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|ellipse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|addLine
name|void
name|tst_QGraphicsScene
operator|::
name|addLine
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QPen
name|pen
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
decl_stmt|;
name|pen
operator|.
name|setWidthF
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|QGraphicsLineItem
modifier|*
name|line
init|=
name|scene
operator|.
name|addLine
argument_list|(
name|QLineF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|,
name|pen
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|->
name|pen
argument_list|()
argument_list|,
name|pen
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|->
name|line
argument_list|()
argument_list|,
name|QLineF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|line
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|line
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
operator|-
literal|9.9
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
operator|-
literal|9.9
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|9.9
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|9.9
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|line
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|addPath
name|void
name|tst_QGraphicsScene
operator|::
name|addPath
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QPainterPath
name|p
decl_stmt|;
name|p
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|p
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsPathItem
modifier|*
name|path
init|=
name|scene
operator|.
name|addPath
argument_list|(
name|p
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|path
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|path
operator|->
name|pen
argument_list|()
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|path
operator|->
name|path
argument_list|()
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|path
operator|->
name|brush
argument_list|()
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
expr_stmt|;
name|path
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|red
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
operator|-
literal|9.9
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|9.9
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
operator|-
literal|9.9
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|9.9
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|30
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
operator|-
literal|9.9
argument_list|,
literal|30
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|9.9
argument_list|,
literal|30
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|20.1
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|39.9
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
operator|-
literal|10
argument_list|,
literal|20
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|10
argument_list|,
literal|20
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
sizeof|sizeof
argument_list|(
name|qreal
argument_list|)
operator|!=
sizeof|sizeof
argument_list|(
name|double
argument_list|)
condition|)
name|QWARN
argument_list|(
literal|"Skipping test because of rounding errors when qreal != double"
argument_list|)
expr_stmt|;
else|else
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
operator|-
literal|10
argument_list|,
literal|30
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|10.1
argument_list|,
literal|30
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|addPixmap
name|void
name|tst_QGraphicsScene
operator|::
name|addPixmap
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QPixmap
name|pix
argument_list|(
literal|":/Ash_European.jpg"
argument_list|)
decl_stmt|;
name|QGraphicsPixmapItem
modifier|*
name|pixmap
init|=
name|scene
operator|.
name|addPixmap
argument_list|(
name|pix
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|pixmap
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|pixmap
operator|->
name|pixmap
argument_list|()
argument_list|,
name|pix
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|pixmap
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
name|pix
operator|.
name|width
argument_list|()
operator|-
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|pixmap
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
name|pix
operator|.
name|height
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|pixmap
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
name|pix
operator|.
name|width
argument_list|()
operator|-
literal|1
argument_list|,
name|pix
operator|.
name|height
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|pixmap
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
name|pix
operator|.
name|width
argument_list|()
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
operator|-
literal|1
argument_list|,
name|pix
operator|.
name|height
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
name|pix
operator|.
name|width
argument_list|()
argument_list|,
name|pix
operator|.
name|height
argument_list|()
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
name|pix
operator|.
name|height
argument_list|()
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
name|pix
operator|.
name|width
argument_list|()
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|addRect
name|void
name|tst_QGraphicsScene
operator|::
name|addRect
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|pen
argument_list|()
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|brush
argument_list|()
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|rect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|red
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
operator|-
literal|9.9
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
operator|-
literal|9.9
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|9.9
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|9.9
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|addText
name|void
name|tst_QGraphicsScene
operator|::
name|addText
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsTextItem
modifier|*
name|text
init|=
name|scene
operator|.
name|addText
argument_list|(
literal|"Qt"
argument_list|,
name|QFont
argument_list|()
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|->
name|toPlainText
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"Qt"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|->
name|font
argument_list|()
argument_list|,
name|QFont
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|removeItem
name|void
name|tst_QGraphicsScene
operator|::
name|removeItem
parameter_list|()
block|{
if|#
directive|if
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|GWES_ICONCURS
argument_list|)
name|QSKIP
argument_list|(
literal|"No mouse cursor support"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
comment|// forces indexing
name|scene
operator|.
name|removeItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
operator|delete
name|item
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|item2
argument_list|)
expr_stmt|;
comment|// Removing a selected item
name|QVERIFY
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
operator|.
name|contains
argument_list|(
name|item2
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
comment|// Check that we are in a state that can receive paint events
comment|// (i.e., not logged out on Windows).
name|Q_CHECK_PAINTEVENTS
comment|// Removing a hovered item
name|HoverItem
modifier|*
name|hoverItem
init|=
operator|new
name|HoverItem
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|hoverItem
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|150
argument_list|,
literal|150
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|QPoint
argument_list|(
operator|-
literal|1
argument_list|,
operator|-
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|{
name|QMouseEvent
name|moveEvent
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|hoverItem
operator|->
name|scenePos
argument_list|()
operator|+
name|QPointF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|NoButton
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|moveEvent
argument_list|)
expr_stmt|;
block|}
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// update
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// draw
name|QVERIFY
argument_list|(
operator|!
name|hoverItem
operator|->
name|isHovered
argument_list|)
expr_stmt|;
block|{
name|QTest
operator|::
name|qWait
argument_list|(
literal|250
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|hoverItem
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|,
name|Qt
operator|::
name|NoButton
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QMouseEvent
name|moveEvent
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|hoverItem
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|,
name|Qt
operator|::
name|NoButton
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|moveEvent
argument_list|)
expr_stmt|;
block|}
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// update
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// draw
name|QVERIFY
argument_list|(
name|hoverItem
operator|->
name|isHovered
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|hoverItem
argument_list|)
expr_stmt|;
name|hoverItem
operator|->
name|setAcceptsHoverEvents
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|hoverItem
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|//<- delayed update is called
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|//<- scene schedules pending update
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|//<- pending update is sent to view
name|QVERIFY
argument_list|(
operator|!
name|hoverItem
operator|->
name|isHovered
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|focusItem
name|void
name|tst_QGraphicsScene
operator|::
name|focusItem
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addText
argument_list|(
literal|"Qt"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QFocusEvent
name|focusOut
argument_list|(
name|QEvent
operator|::
name|FocusOut
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|focusOut
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|QFocusEvent
name|focusIn
argument_list|(
name|QEvent
operator|::
name|FocusIn
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|focusIn
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item2
init|=
name|scene
operator|.
name|addText
argument_list|(
literal|"Qt"
argument_list|)
decl_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
name|item2
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
name|item2
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|focusOut
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|focusIn
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
name|item2
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|focusOut
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
operator|delete
name|item2
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|focusIn
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|FocusItem
class|class
name|FocusItem
super|:
specifier|public
name|QGraphicsTextItem
block|{
protected|protected:
DECL|function|focusOutEvent
name|void
name|focusOutEvent
parameter_list|(
name|QFocusEvent
modifier|*
parameter_list|)
block|{
name|QVERIFY
argument_list|(
operator|!
name|scene
argument_list|()
operator|->
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|focusItemLostFocus
name|void
name|tst_QGraphicsScene
operator|::
name|focusItemLostFocus
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|FocusItem
modifier|*
name|item
init|=
operator|new
name|FocusItem
decl_stmt|;
name|item
operator|->
name|setTextInteractionFlags
argument_list|(
name|Qt
operator|::
name|TextEditorInteraction
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|item
argument_list|)
expr_stmt|;
name|item
operator|->
name|clearFocus
argument_list|()
expr_stmt|;
block|}
end_function
begin_class
DECL|class|ClearTestItem
class|class
name|ClearTestItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|ClearTestItem
name|ClearTestItem
parameter_list|(
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|parent
argument_list|)
block|{}
DECL|function|~ClearTestItem
name|~
name|ClearTestItem
parameter_list|()
block|{
name|qDeleteAll
argument_list|(
name|items
argument_list|)
expr_stmt|;
block|}
DECL|member|items
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|items
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|clear
name|void
name|tst_QGraphicsScene
operator|::
name|clear
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|clear
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|clear
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|ClearTestItem
modifier|*
name|firstItem
init|=
operator|new
name|ClearTestItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|secondItem
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|firstItem
operator|->
name|items
operator|+=
name|secondItem
expr_stmt|;
name|scene
operator|.
name|setItemIndexMethod
argument_list|(
name|QGraphicsScene
operator|::
name|NoIndex
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|firstItem
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|secondItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|firstItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|()
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|secondItem
argument_list|)
expr_stmt|;
name|ClearTestItem
modifier|*
name|thirdItem
init|=
operator|new
name|ClearTestItem
argument_list|(
name|firstItem
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|forthItem
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|firstItem
argument_list|)
decl_stmt|;
name|thirdItem
operator|->
name|items
operator|+=
name|forthItem
expr_stmt|;
comment|// must not crash even if firstItem deletes secondItem
name|scene
operator|.
name|clear
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setFocusItem
name|void
name|tst_QGraphicsScene
operator|::
name|setFocusItem
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addText
argument_list|(
literal|"Qt"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
operator|++
name|i
control|)
block|{
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|QGraphicsItem
modifier|*
name|item2
init|=
name|scene
operator|.
name|addText
argument_list|(
literal|"Qt"
argument_list|)
decl_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|clearFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setFocusItem_inactive
name|void
name|tst_QGraphicsScene
operator|::
name|setFocusItem_inactive
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addText
argument_list|(
literal|"Qt"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
operator|++
name|i
control|)
block|{
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|mouseGrabberItem
name|void
name|tst_QGraphicsScene
operator|::
name|mouseGrabberItem
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|item
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
operator|++
name|i
control|)
block|{
name|item
operator|->
name|setPos
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setPos
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|item
operator|->
name|setZValue
argument_list|(
operator|(
name|i
operator|&
literal|1
operator|)
condition|?
literal|0
else|:
literal|1
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setZValue
argument_list|(
operator|(
name|i
operator|&
literal|1
operator|)
condition|?
literal|1
else|:
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|topMostItem
init|=
operator|(
name|i
operator|&
literal|1
operator|)
condition|?
name|item2
else|:
name|item
decl_stmt|;
name|QGraphicsSceneMouseEvent
name|pressEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|pressEvent
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setScreenPos
argument_list|(
name|QPoint
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
name|topMostItem
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|1000
condition|;
operator|++
name|i
control|)
block|{
name|QGraphicsSceneMouseEvent
name|moveEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|moveEvent
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|moveEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
name|i
operator|*
literal|10
argument_list|,
name|i
operator|*
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|moveEvent
operator|.
name|setScreenPos
argument_list|(
name|QPoint
argument_list|(
literal|100
operator|+
name|i
operator|*
literal|10
argument_list|,
literal|100
operator|+
name|i
operator|*
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|moveEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
name|topMostItem
argument_list|)
expr_stmt|;
comment|// Geometrical changes should not affect the mouse grabber.
name|item
operator|->
name|setZValue
argument_list|(
name|rand
argument_list|()
operator|%
literal|500
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setZValue
argument_list|(
name|rand
argument_list|()
operator|%
literal|500
argument_list|)
expr_stmt|;
name|item
operator|->
name|setPos
argument_list|(
name|rand
argument_list|()
operator|%
literal|50000
argument_list|,
name|rand
argument_list|()
operator|%
literal|50000
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setPos
argument_list|(
name|rand
argument_list|()
operator|%
literal|50000
argument_list|,
name|rand
argument_list|()
operator|%
literal|50000
argument_list|)
expr_stmt|;
block|}
name|QGraphicsSceneMouseEvent
name|releaseEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|releaseEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|10000
argument_list|,
literal|10000
argument_list|)
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScreenPos
argument_list|(
name|QPoint
argument_list|(
literal|1000000
argument_list|,
literal|1000000
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|releaseEvent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|// Structural change: deleting the mouse grabber
name|item
operator|->
name|setPos
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|item
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setPos
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|pressEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|pressEvent
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setScreenPos
argument_list|(
name|QPoint
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|moveEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|moveEvent
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|moveEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|moveEvent
operator|.
name|setScreenPos
argument_list|(
name|QPoint
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|moveEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|item
operator|->
name|setVisible
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
name|item2
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setVisible
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|moveEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setVisible
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|moveEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|moveEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
name|item2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
operator|delete
name|item2
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|hoverEvents_siblings
name|void
name|tst_QGraphicsScene
operator|::
name|hoverEvents_siblings
parameter_list|()
block|{
name|Q_CHECK_PAINTEVENTS
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|lastItem
init|=
literal|0
decl_stmt|;
name|QList
argument_list|<
name|HoverItem
modifier|*
argument_list|>
name|items
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|15
condition|;
operator|++
name|i
control|)
block|{
name|QGraphicsItem
modifier|*
name|item
init|=
operator|new
name|HoverItem
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|items
operator|<<
operator|(
name|HoverItem
operator|*
operator|)
name|item
expr_stmt|;
if|if
condition|(
name|lastItem
condition|)
block|{
name|item
operator|->
name|setPos
argument_list|(
name|lastItem
operator|->
name|pos
argument_list|()
operator|+
name|QPointF
argument_list|(
name|sin
argument_list|(
name|i
operator|/
literal|3.0
argument_list|)
operator|*
literal|17
argument_list|,
name|cos
argument_list|(
name|i
operator|/
literal|3.0
argument_list|)
operator|*
literal|17
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|item
operator|->
name|setZValue
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|lastItem
operator|=
name|item
expr_stmt|;
block|}
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setRenderHint
argument_list|(
name|QPainter
operator|::
name|Antialiasing
argument_list|,
literal|true
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
name|view
operator|.
name|setMinimumSize
argument_list|(
literal|230
argument_list|,
literal|200
argument_list|)
expr_stmt|;
else|#
directive|else
name|view
operator|.
name|setMinimumSize
argument_list|(
literal|400
argument_list|,
literal|300
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|view
operator|.
name|rotate
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|view
operator|.
name|scale
argument_list|(
literal|1.7
argument_list|,
literal|1.7
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|view
operator|.
name|activateWindow
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCursor
operator|::
name|setPos
argument_list|(
name|view
operator|.
name|mapToGlobal
argument_list|(
name|QPoint
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|mouseEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|mouseEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|mouseEvent
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|1
init|;
name|j
operator|>=
literal|0
condition|;
operator|--
name|j
control|)
block|{
name|int
name|i
init|=
name|j
condition|?
literal|0
else|:
literal|14
decl_stmt|;
forever|forever
block|{
if|if
condition|(
name|j
condition|)
name|QVERIFY
argument_list|(
operator|!
name|items
operator|.
name|at
argument_list|(
name|i
argument_list|)
operator|->
name|isHovered
argument_list|)
expr_stmt|;
else|else
name|QVERIFY
argument_list|(
operator|!
name|items
operator|.
name|at
argument_list|(
name|i
argument_list|)
operator|->
name|isHovered
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|mouseEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|mouseEvent
operator|.
name|setScenePos
argument_list|(
name|items
operator|.
name|at
argument_list|(
name|i
argument_list|)
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|mouseEvent
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// this posts updates from the scene to the view
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// which trigger a repaint here
name|QTRY_VERIFY
argument_list|(
name|items
operator|.
name|at
argument_list|(
name|i
argument_list|)
operator|->
name|isHovered
argument_list|)
expr_stmt|;
if|if
condition|(
name|j
operator|&&
name|i
operator|>
literal|0
condition|)
name|QVERIFY
argument_list|(
operator|!
name|items
operator|.
name|at
argument_list|(
name|i
operator|-
literal|1
argument_list|)
operator|->
name|isHovered
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|j
operator|&&
name|i
operator|<
literal|14
condition|)
name|QVERIFY
argument_list|(
operator|!
name|items
operator|.
name|at
argument_list|(
name|i
operator|+
literal|1
argument_list|)
operator|->
name|isHovered
argument_list|)
expr_stmt|;
name|i
operator|+=
name|j
condition|?
literal|1
else|:
operator|-
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|j
operator|&&
name|i
operator|==
literal|15
operator|)
operator|||
operator|(
operator|!
name|j
operator|&&
name|i
operator|==
operator|-
literal|1
operator|)
condition|)
break|break;
block|}
name|QGraphicsSceneMouseEvent
name|mouseEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|mouseEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|mouseEvent
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// this posts updates from the scene to the view
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// which trigger a repaint here
block|}
block|}
end_function
begin_function
DECL|function|hoverEvents_parentChild
name|void
name|tst_QGraphicsScene
operator|::
name|hoverEvents_parentChild
parameter_list|()
block|{
name|Q_CHECK_PAINTEVENTS
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|lastItem
init|=
literal|0
decl_stmt|;
name|QList
argument_list|<
name|HoverItem
modifier|*
argument_list|>
name|items
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|15
condition|;
operator|++
name|i
control|)
block|{
name|QGraphicsItem
modifier|*
name|item
init|=
operator|new
name|HoverItem
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|items
operator|<<
operator|(
name|HoverItem
operator|*
operator|)
name|item
expr_stmt|;
if|if
condition|(
name|lastItem
condition|)
block|{
name|item
operator|->
name|setParentItem
argument_list|(
name|lastItem
argument_list|)
expr_stmt|;
name|item
operator|->
name|setPos
argument_list|(
name|sin
argument_list|(
name|i
operator|/
literal|3.0
argument_list|)
operator|*
literal|17
argument_list|,
name|cos
argument_list|(
name|i
operator|/
literal|3.0
argument_list|)
operator|*
literal|17
argument_list|)
expr_stmt|;
block|}
name|lastItem
operator|=
name|item
expr_stmt|;
block|}
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setRenderHint
argument_list|(
name|QPainter
operator|::
name|Antialiasing
argument_list|,
literal|true
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
name|view
operator|.
name|setMinimumSize
argument_list|(
literal|230
argument_list|,
literal|200
argument_list|)
expr_stmt|;
else|#
directive|else
name|view
operator|.
name|setMinimumSize
argument_list|(
literal|400
argument_list|,
literal|300
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|view
operator|.
name|rotate
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|view
operator|.
name|scale
argument_list|(
literal|1.7
argument_list|,
literal|1.7
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|mouseEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|mouseEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|mouseEvent
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|1
init|;
name|j
operator|>=
literal|0
condition|;
operator|--
name|j
control|)
block|{
name|int
name|i
init|=
name|j
condition|?
literal|0
else|:
literal|14
decl_stmt|;
forever|forever
block|{
if|if
condition|(
name|j
condition|)
block|{
name|QVERIFY
argument_list|(
operator|!
name|items
operator|.
name|at
argument_list|(
name|i
argument_list|)
operator|->
name|isHovered
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|i
operator|==
literal|14
condition|)
name|QVERIFY
argument_list|(
operator|!
name|items
operator|.
name|at
argument_list|(
literal|13
argument_list|)
operator|->
name|isHovered
argument_list|)
expr_stmt|;
block|}
name|mouseEvent
operator|.
name|setScenePos
argument_list|(
name|items
operator|.
name|at
argument_list|(
name|i
argument_list|)
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|mouseEvent
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// this posts updates from the scene to the view
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// which trigger a repaint here
name|QTRY_VERIFY
argument_list|(
name|items
operator|.
name|at
argument_list|(
name|i
argument_list|)
operator|->
name|isHovered
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|<
literal|14
condition|)
name|QVERIFY
argument_list|(
operator|!
name|items
operator|.
name|at
argument_list|(
name|i
operator|+
literal|1
argument_list|)
operator|->
name|isHovered
argument_list|)
expr_stmt|;
name|i
operator|+=
name|j
condition|?
literal|1
else|:
operator|-
literal|1
expr_stmt|;
if|if
condition|(
operator|(
name|j
operator|&&
name|i
operator|==
literal|15
operator|)
operator|||
operator|(
operator|!
name|j
operator|&&
name|i
operator|==
operator|-
literal|1
operator|)
condition|)
break|break;
block|}
name|mouseEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|mouseEvent
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// this posts updates from the scene to the view
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// which trigger a repaint here
block|}
block|}
end_function
begin_function
DECL|function|createItemGroup
name|void
name|tst_QGraphicsScene
operator|::
name|createItemGroup
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|children1
decl_stmt|;
name|children1
operator|<<
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|children1
operator|<<
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|children1
operator|<<
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|children1
operator|<<
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|children2
decl_stmt|;
name|children2
operator|<<
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|children2
operator|<<
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|children2
operator|<<
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|children2
operator|<<
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|children3
decl_stmt|;
name|children3
operator|<<
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|children3
operator|<<
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|children3
operator|<<
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|children3
operator|<<
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
comment|// All items in children1 are children of parent1
name|QGraphicsItem
modifier|*
name|parent1
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|children1
control|)
name|item
operator|->
name|setParentItem
argument_list|(
name|parent1
argument_list|)
expr_stmt|;
name|QGraphicsItemGroup
modifier|*
name|group
init|=
name|scene
operator|.
name|createItemGroup
argument_list|(
name|children1
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|->
name|parentItem
argument_list|()
argument_list|,
name|parent1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|children1
operator|.
name|first
argument_list|()
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|group
argument_list|)
expr_stmt|;
name|scene
operator|.
name|destroyItemGroup
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|children1
operator|.
name|first
argument_list|()
operator|->
name|parentItem
argument_list|()
argument_list|,
name|parent1
argument_list|)
expr_stmt|;
name|group
operator|=
name|scene
operator|.
name|createItemGroup
argument_list|(
name|children1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|->
name|parentItem
argument_list|()
argument_list|,
name|parent1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|children1
operator|.
name|first
argument_list|()
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|group
argument_list|)
expr_stmt|;
name|scene
operator|.
name|destroyItemGroup
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|children1
operator|.
name|first
argument_list|()
operator|->
name|parentItem
argument_list|()
argument_list|,
name|parent1
argument_list|)
expr_stmt|;
comment|// All items in children2 are children of parent2
name|QGraphicsItem
modifier|*
name|parent2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|children2
control|)
name|item
operator|->
name|setParentItem
argument_list|(
name|parent2
argument_list|)
expr_stmt|;
comment|// Now make parent2 a child of parent1, so all children2 are also children
comment|// of parent1.
name|parent2
operator|->
name|setParentItem
argument_list|(
name|parent1
argument_list|)
expr_stmt|;
comment|// The children2 group should still have parent2 as their common ancestor.
name|group
operator|=
name|scene
operator|.
name|createItemGroup
argument_list|(
name|children2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|->
name|parentItem
argument_list|()
argument_list|,
name|parent2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|children2
operator|.
name|first
argument_list|()
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|group
argument_list|)
expr_stmt|;
name|scene
operator|.
name|destroyItemGroup
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|children2
operator|.
name|first
argument_list|()
operator|->
name|parentItem
argument_list|()
argument_list|,
name|parent2
argument_list|)
expr_stmt|;
comment|// But the set of both children2 and children1 share only parent1.
name|group
operator|=
name|scene
operator|.
name|createItemGroup
argument_list|(
name|children2
operator|+
name|children1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|->
name|parentItem
argument_list|()
argument_list|,
name|parent1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|children1
operator|.
name|first
argument_list|()
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|group
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|children2
operator|.
name|first
argument_list|()
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|group
argument_list|)
expr_stmt|;
name|scene
operator|.
name|destroyItemGroup
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|children1
operator|.
name|first
argument_list|()
operator|->
name|parentItem
argument_list|()
argument_list|,
name|parent1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|children2
operator|.
name|first
argument_list|()
operator|->
name|parentItem
argument_list|()
argument_list|,
name|parent1
argument_list|)
expr_stmt|;
comment|// Fixup the parent-child chain
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|children2
control|)
name|item
operator|->
name|setParentItem
argument_list|(
name|parent2
argument_list|)
expr_stmt|;
comment|// These share no common parent
name|group
operator|=
name|scene
operator|.
name|createItemGroup
argument_list|(
name|children3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|destroyItemGroup
argument_list|(
name|group
argument_list|)
expr_stmt|;
comment|// Make children3 children of parent3
name|QGraphicsItem
modifier|*
name|parent3
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|children3
control|)
name|item
operator|->
name|setParentItem
argument_list|(
name|parent3
argument_list|)
expr_stmt|;
comment|// These should have parent3 as a parent
name|group
operator|=
name|scene
operator|.
name|createItemGroup
argument_list|(
name|children3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|->
name|parentItem
argument_list|()
argument_list|,
name|parent3
argument_list|)
expr_stmt|;
name|scene
operator|.
name|destroyItemGroup
argument_list|(
name|group
argument_list|)
expr_stmt|;
comment|// Now make them all children of parent1
name|parent3
operator|->
name|setParentItem
argument_list|(
name|parent1
argument_list|)
expr_stmt|;
name|group
operator|=
name|scene
operator|.
name|createItemGroup
argument_list|(
name|children3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|->
name|parentItem
argument_list|()
argument_list|,
name|parent3
argument_list|)
expr_stmt|;
name|scene
operator|.
name|destroyItemGroup
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|group
operator|=
name|scene
operator|.
name|createItemGroup
argument_list|(
name|children2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|->
name|parentItem
argument_list|()
argument_list|,
name|parent2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|destroyItemGroup
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|group
operator|=
name|scene
operator|.
name|createItemGroup
argument_list|(
name|children1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|->
name|parentItem
argument_list|()
argument_list|,
name|parent1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|destroyItemGroup
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|QGraphicsItemGroup
modifier|*
name|emptyGroup
init|=
name|scene
operator|.
name|createItemGroup
argument_list|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|emptyGroup
operator|->
name|children
argument_list|()
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|emptyGroup
operator|->
name|parentItem
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|emptyGroup
operator|->
name|scene
argument_list|()
argument_list|,
operator|&
name|scene
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|EventTester
class|class
name|EventTester
super|:
specifier|public
name|QGraphicsEllipseItem
block|{
public|public:
DECL|function|EventTester
name|EventTester
parameter_list|()
member_init_list|:
name|QGraphicsEllipseItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
member_init_list|,
name|ignoreMouse
argument_list|(
literal|false
argument_list|)
block|{ }
DECL|member|ignoreMouse
name|bool
name|ignoreMouse
decl_stmt|;
DECL|member|eventTypes
name|QList
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|>
name|eventTypes
decl_stmt|;
protected|protected:
DECL|function|sceneEvent
name|bool
name|sceneEvent
parameter_list|(
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
name|eventTypes
operator|<<
name|QEvent
operator|::
name|Type
argument_list|(
name|event
operator|->
name|type
argument_list|()
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|event
operator|->
name|type
argument_list|()
condition|)
block|{
case|case
name|QEvent
operator|::
name|GraphicsSceneMousePress
case|:
case|case
name|QEvent
operator|::
name|GraphicsSceneMouseMove
case|:
case|case
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
case|:
if|if
condition|(
name|ignoreMouse
condition|)
block|{
name|event
operator|->
name|ignore
argument_list|()
expr_stmt|;
return|return
literal|true
return|;
block|}
default|default:
break|break;
block|}
return|return
name|QGraphicsEllipseItem
operator|::
name|sceneEvent
argument_list|(
name|event
argument_list|)
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|mouseEventPropagation
name|void
name|tst_QGraphicsScene
operator|::
name|mouseEventPropagation
parameter_list|()
block|{
name|EventTester
modifier|*
name|a
init|=
operator|new
name|EventTester
decl_stmt|;
name|EventTester
modifier|*
name|b
init|=
operator|new
name|EventTester
decl_stmt|;
name|EventTester
modifier|*
name|c
init|=
operator|new
name|EventTester
decl_stmt|;
name|EventTester
modifier|*
name|d
init|=
operator|new
name|EventTester
decl_stmt|;
name|b
operator|->
name|setParentItem
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|c
operator|->
name|setParentItem
argument_list|(
name|b
argument_list|)
expr_stmt|;
name|d
operator|->
name|setParentItem
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|a
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|b
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|c
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|d
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|a
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"A"
argument_list|)
expr_stmt|;
name|b
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"B"
argument_list|)
expr_stmt|;
name|c
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"C"
argument_list|)
expr_stmt|;
name|d
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"D"
argument_list|)
expr_stmt|;
comment|// scene -> a -> b -> c -> d
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|a
argument_list|)
expr_stmt|;
comment|// Prepare some events
name|QGraphicsSceneMouseEvent
name|pressEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|pressEvent
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|moveEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|moveEvent
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|moveEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|releaseEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|releaseEvent
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
comment|// Send a press
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|d
argument_list|)
expr_stmt|;
comment|// Send a move
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|moveEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|d
argument_list|)
expr_stmt|;
comment|// Send a release
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|releaseEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|3
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|4
argument_list|)
argument_list|,
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|d
operator|->
name|setAcceptedMouseButtons
argument_list|(
name|Qt
operator|::
name|RightButton
argument_list|)
expr_stmt|;
comment|// Send a press
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|c
argument_list|)
expr_stmt|;
comment|// Send another press, with a button that isn't actually accepted
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|RightButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|c
argument_list|)
expr_stmt|;
comment|// Send a move
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|moveEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|3
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|c
argument_list|)
expr_stmt|;
comment|// Send a release
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|releaseEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|4
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|5
argument_list|)
argument_list|,
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// Disabled items eat events. c should not get this.
name|d
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|d
operator|->
name|setAcceptedMouseButtons
argument_list|(
name|Qt
operator|::
name|RightButton
argument_list|)
expr_stmt|;
comment|// Send a right press. This disappears in d.
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// Send a left press. This goes to c.
name|pressEvent
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|6
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|7
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|c
argument_list|)
expr_stmt|;
comment|// Clicking outside the items removes the mouse grabber
block|}
end_function
begin_function
DECL|function|mouseEventPropagation_ignore
name|void
name|tst_QGraphicsScene
operator|::
name|mouseEventPropagation_ignore
parameter_list|()
block|{
name|EventTester
modifier|*
name|a
init|=
operator|new
name|EventTester
decl_stmt|;
name|EventTester
modifier|*
name|b
init|=
operator|new
name|EventTester
decl_stmt|;
name|EventTester
modifier|*
name|c
init|=
operator|new
name|EventTester
decl_stmt|;
name|EventTester
modifier|*
name|d
init|=
operator|new
name|EventTester
decl_stmt|;
name|b
operator|->
name|setParentItem
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|c
operator|->
name|setParentItem
argument_list|(
name|b
argument_list|)
expr_stmt|;
name|d
operator|->
name|setParentItem
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|a
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|b
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|c
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|d
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
comment|// scene -> a -> b -> c -> d
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|a
argument_list|)
expr_stmt|;
comment|// Prepare some events
name|QGraphicsSceneMouseEvent
name|pressEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|pressEvent
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|b
operator|->
name|ignoreMouse
operator|=
literal|true
expr_stmt|;
name|c
operator|->
name|ignoreMouse
operator|=
literal|true
expr_stmt|;
name|d
operator|->
name|ignoreMouse
operator|=
literal|true
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|a
argument_list|)
expr_stmt|;
name|a
operator|->
name|ignoreMouse
operator|=
literal|true
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|pressEvent
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|mouseEventPropagation_focus
name|void
name|tst_QGraphicsScene
operator|::
name|mouseEventPropagation_focus
parameter_list|()
block|{
name|EventTester
modifier|*
name|a
init|=
operator|new
name|EventTester
decl_stmt|;
name|EventTester
modifier|*
name|b
init|=
operator|new
name|EventTester
decl_stmt|;
name|EventTester
modifier|*
name|c
init|=
operator|new
name|EventTester
decl_stmt|;
name|EventTester
modifier|*
name|d
init|=
operator|new
name|EventTester
decl_stmt|;
name|b
operator|->
name|setParentItem
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|c
operator|->
name|setParentItem
argument_list|(
name|b
argument_list|)
expr_stmt|;
name|d
operator|->
name|setParentItem
argument_list|(
name|c
argument_list|)
expr_stmt|;
name|a
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|b
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|c
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|d
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
comment|// scene -> a -> b -> c -> d
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|a
argument_list|)
expr_stmt|;
comment|// Prepare some events
name|QGraphicsSceneMouseEvent
name|pressEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|pressEvent
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|a
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|a
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|a
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|first
argument_list|()
argument_list|,
name|QEvent
operator|::
name|FocusIn
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|d
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|mouseEventPropagation_doubleclick
name|void
name|tst_QGraphicsScene
operator|::
name|mouseEventPropagation_doubleclick
parameter_list|()
block|{
name|EventTester
modifier|*
name|a
init|=
operator|new
name|EventTester
decl_stmt|;
name|EventTester
modifier|*
name|b
init|=
operator|new
name|EventTester
decl_stmt|;
name|a
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|b
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|a
operator|->
name|setPos
argument_list|(
operator|-
literal|50
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|b
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|b
argument_list|)
expr_stmt|;
comment|// Prepare some events
name|QGraphicsSceneMouseEvent
name|pressEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|pressEvent
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|doubleClickEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseDoubleClick
argument_list|)
decl_stmt|;
name|doubleClickEvent
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|doubleClickEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|releaseEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|releaseEvent
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
comment|// Send press to A
name|pressEvent
operator|.
name|setScenePos
argument_list|(
name|a
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
expr_stmt|;
comment|// Send release to A
name|releaseEvent
operator|.
name|setScenePos
argument_list|(
name|a
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|releaseEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|3
argument_list|)
argument_list|,
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
expr_stmt|;
comment|// Send doubleclick to B
name|doubleClickEvent
operator|.
name|setScenePos
argument_list|(
name|b
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|doubleClickEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GrabMouse
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
expr_stmt|;
comment|// Send release to B
name|releaseEvent
operator|.
name|setScenePos
argument_list|(
name|b
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|releaseEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|b
operator|->
name|eventTypes
operator|.
name|at
argument_list|(
literal|3
argument_list|)
argument_list|,
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|Scene
class|class
name|Scene
super|:
specifier|public
name|QGraphicsScene
block|{
public|public:
DECL|member|mouseMovePoints
name|QVector
argument_list|<
name|QPointF
argument_list|>
name|mouseMovePoints
decl_stmt|;
protected|protected:
DECL|function|mouseMoveEvent
name|void
name|mouseMoveEvent
parameter_list|(
name|QGraphicsSceneMouseEvent
modifier|*
name|event
parameter_list|)
block|{
name|mouseMovePoints
operator|<<
name|event
operator|->
name|scenePos
argument_list|()
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|mouseEventPropagation_mouseMove
name|void
name|tst_QGraphicsScene
operator|::
name|mouseEventPropagation_mouseMove
parameter_list|()
block|{
name|Scene
name|scene
decl_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|5
argument_list|,
literal|0
argument_list|,
literal|12
argument_list|,
literal|12
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|15
argument_list|,
literal|0
argument_list|,
literal|12
argument_list|,
literal|12
argument_list|)
argument_list|)
operator|->
name|setAcceptsHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|30
condition|;
operator|++
name|i
control|)
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
name|i
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseMovePoints
operator|.
name|size
argument_list|()
argument_list|,
literal|30
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|30
condition|;
operator|++
name|i
control|)
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseMovePoints
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|,
name|QPointF
argument_list|(
name|i
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|DndTester
class|class
name|DndTester
super|:
specifier|public
name|QGraphicsEllipseItem
block|{
public|public:
DECL|function|DndTester
name|DndTester
parameter_list|(
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|)
member_init_list|:
name|QGraphicsEllipseItem
argument_list|(
name|rect
argument_list|)
member_init_list|,
name|lastEvent
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|ignoresDragEnter
argument_list|(
literal|false
argument_list|)
member_init_list|,
name|ignoresDragMove
argument_list|(
literal|false
argument_list|)
block|{     }
DECL|function|~DndTester
name|~
name|DndTester
parameter_list|()
block|{
operator|delete
name|lastEvent
expr_stmt|;
block|}
DECL|member|lastEvent
name|QGraphicsSceneDragDropEvent
modifier|*
name|lastEvent
decl_stmt|;
DECL|member|eventList
name|QList
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|>
name|eventList
decl_stmt|;
DECL|member|ignoresDragEnter
name|bool
name|ignoresDragEnter
decl_stmt|;
DECL|member|ignoresDragMove
name|bool
name|ignoresDragMove
decl_stmt|;
protected|protected:
DECL|function|dragEnterEvent
name|void
name|dragEnterEvent
parameter_list|(
name|QGraphicsSceneDragDropEvent
modifier|*
name|event
parameter_list|)
block|{
name|storeLastEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
name|event
operator|->
name|setAccepted
argument_list|(
operator|!
name|ignoresDragEnter
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|ignoresDragEnter
condition|)
name|event
operator|->
name|setDropAction
argument_list|(
name|Qt
operator|::
name|IgnoreAction
argument_list|)
expr_stmt|;
name|eventList
operator|<<
name|event
operator|->
name|type
argument_list|()
expr_stmt|;
block|}
DECL|function|dragMoveEvent
name|void
name|dragMoveEvent
parameter_list|(
name|QGraphicsSceneDragDropEvent
modifier|*
name|event
parameter_list|)
block|{
name|storeLastEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
name|event
operator|->
name|setAccepted
argument_list|(
operator|!
name|ignoresDragMove
argument_list|)
expr_stmt|;
name|eventList
operator|<<
name|event
operator|->
name|type
argument_list|()
expr_stmt|;
block|}
DECL|function|dragLeaveEvent
name|void
name|dragLeaveEvent
parameter_list|(
name|QGraphicsSceneDragDropEvent
modifier|*
name|event
parameter_list|)
block|{
name|storeLastEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
name|eventList
operator|<<
name|event
operator|->
name|type
argument_list|()
expr_stmt|;
block|}
DECL|function|dropEvent
name|void
name|dropEvent
parameter_list|(
name|QGraphicsSceneDragDropEvent
modifier|*
name|event
parameter_list|)
block|{
name|storeLastEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
name|eventList
operator|<<
name|event
operator|->
name|type
argument_list|()
expr_stmt|;
block|}
private|private:
DECL|function|storeLastEvent
name|void
name|storeLastEvent
parameter_list|(
name|QGraphicsSceneDragDropEvent
modifier|*
name|event
parameter_list|)
block|{
operator|delete
name|lastEvent
expr_stmt|;
name|lastEvent
operator|=
operator|new
name|QGraphicsSceneDragDropEvent
argument_list|(
name|event
operator|->
name|type
argument_list|()
argument_list|)
expr_stmt|;
name|lastEvent
operator|->
name|setScenePos
argument_list|(
name|event
operator|->
name|scenePos
argument_list|()
argument_list|)
expr_stmt|;
name|lastEvent
operator|->
name|setScreenPos
argument_list|(
name|event
operator|->
name|screenPos
argument_list|()
argument_list|)
expr_stmt|;
name|lastEvent
operator|->
name|setButtons
argument_list|(
name|event
operator|->
name|buttons
argument_list|()
argument_list|)
expr_stmt|;
name|lastEvent
operator|->
name|setModifiers
argument_list|(
name|event
operator|->
name|modifiers
argument_list|()
argument_list|)
expr_stmt|;
name|lastEvent
operator|->
name|setPossibleActions
argument_list|(
name|event
operator|->
name|possibleActions
argument_list|()
argument_list|)
expr_stmt|;
name|lastEvent
operator|->
name|setProposedAction
argument_list|(
name|event
operator|->
name|proposedAction
argument_list|()
argument_list|)
expr_stmt|;
name|lastEvent
operator|->
name|setDropAction
argument_list|(
name|event
operator|->
name|dropAction
argument_list|()
argument_list|)
expr_stmt|;
name|lastEvent
operator|->
name|setMimeData
argument_list|(
name|event
operator|->
name|mimeData
argument_list|()
argument_list|)
expr_stmt|;
name|lastEvent
operator|->
name|setWidget
argument_list|(
name|event
operator|->
name|widget
argument_list|()
argument_list|)
expr_stmt|;
name|lastEvent
operator|->
name|setSource
argument_list|(
name|event
operator|->
name|source
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_ifndef
ifndef|#
directive|ifndef
name|QT_NO_DRAGANDDROP
end_ifndef
begin_function
DECL|function|dragAndDrop_simple
name|void
name|tst_QGraphicsScene
operator|::
name|dragAndDrop_simple
parameter_list|()
block|{
name|DndTester
modifier|*
name|item
init|=
operator|new
name|DndTester
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QMimeData
name|mimeData
decl_stmt|;
comment|// Initial drag enter for the scene
name|QDragEnterEvent
name|dragEnter
argument_list|(
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragEnter
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|dragEnter
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dragEnter
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|)
expr_stmt|;
block|{
comment|// Move outside the item
name|QDragMoveEvent
name|dragMove
argument_list|(
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragMove
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|dragMove
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dragMove
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Move inside the item without setAcceptDrops
name|QDragMoveEvent
name|dragMove
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragMove
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|dragMove
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dragMove
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
name|item
operator|->
name|setAcceptDrops
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|{
comment|// Move inside the item with setAcceptDrops
name|QDragMoveEvent
name|dragMove
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragMove
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|dragMove
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dragMove
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|IgnoreAction
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragEnter
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragMove
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|screenPos
argument_list|()
argument_list|,
name|view
operator|.
name|mapToGlobal
argument_list|(
name|dragMove
operator|.
name|pos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|scenePos
argument_list|()
argument_list|,
name|view
operator|.
name|mapToScene
argument_list|(
name|dragMove
operator|.
name|pos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|IgnoreAction
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Another move inside the item
name|QDragMoveEvent
name|dragMove
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|mapToScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragMove
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|dragMove
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dragMove
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|IgnoreAction
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragMove
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|screenPos
argument_list|()
argument_list|,
name|view
operator|.
name|mapToGlobal
argument_list|(
name|dragMove
operator|.
name|pos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|scenePos
argument_list|()
argument_list|,
name|view
operator|.
name|mapToScene
argument_list|(
name|dragMove
operator|.
name|pos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|IgnoreAction
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Move outside the item
name|QDragMoveEvent
name|dragMove
argument_list|(
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragMove
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|dragMove
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dragMove
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|3
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragLeave
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|screenPos
argument_list|()
argument_list|,
name|view
operator|.
name|mapToGlobal
argument_list|(
name|dragMove
operator|.
name|pos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|scenePos
argument_list|()
argument_list|,
name|view
operator|.
name|mapToScene
argument_list|(
name|dragMove
operator|.
name|pos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Move inside the item again
name|QDragMoveEvent
name|dragMove
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragMove
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|dragMove
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dragMove
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|IgnoreAction
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|4
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragEnter
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|5
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragMove
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|screenPos
argument_list|()
argument_list|,
name|view
operator|.
name|mapToGlobal
argument_list|(
name|dragMove
operator|.
name|pos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|scenePos
argument_list|()
argument_list|,
name|view
operator|.
name|mapToScene
argument_list|(
name|dragMove
operator|.
name|pos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|IgnoreAction
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Drop inside the item
name|QDropEvent
name|drop
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|drop
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|drop
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|drop
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|6
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDrop
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|screenPos
argument_list|()
argument_list|,
name|view
operator|.
name|mapToGlobal
argument_list|(
name|drop
operator|.
name|pos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|scenePos
argument_list|()
argument_list|,
name|view
operator|.
name|mapToScene
argument_list|(
name|drop
operator|.
name|pos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|lastEvent
operator|->
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|dragAndDrop_disabledOrInvisible
name|void
name|tst_QGraphicsScene
operator|::
name|dragAndDrop_disabledOrInvisible
parameter_list|()
block|{
name|DndTester
modifier|*
name|item
init|=
operator|new
name|DndTester
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setAcceptDrops
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QMimeData
name|mimeData
decl_stmt|;
comment|// Initial drag enter for the scene
name|QDragEnterEvent
name|dragEnter
argument_list|(
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragEnter
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|dragEnter
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dragEnter
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|)
expr_stmt|;
block|{
comment|// Move inside the item
name|QDragMoveEvent
name|dragMove
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragMove
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|dragMove
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dragMove
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|IgnoreAction
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragEnter
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragMove
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Move outside the item
name|QDragMoveEvent
name|dragMove
argument_list|(
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragMove
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|dragMove
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dragMove
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragLeave
argument_list|)
expr_stmt|;
block|}
comment|// Now disable the item
name|item
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
block|{
comment|// Move inside the item
name|QDragMoveEvent
name|dragMove
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragMove
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|dragMove
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dragMove
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragLeave
argument_list|)
expr_stmt|;
block|}
comment|// Reenable it, and make it invisible
name|item
operator|->
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|item
operator|->
name|setVisible
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
block|{
comment|// Move inside the item
name|QDragMoveEvent
name|dragMove
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragMove
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|dragMove
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dragMove
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragLeave
argument_list|)
expr_stmt|;
block|}
comment|// Dummy drop event to keep the Mac from crashing.
name|QDropEvent
name|dropEvent
argument_list|(
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dropEvent
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|dragAndDrop_propagate
name|void
name|tst_QGraphicsScene
operator|::
name|dragAndDrop_propagate
parameter_list|()
block|{
name|DndTester
modifier|*
name|item1
init|=
operator|new
name|DndTester
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|DndTester
modifier|*
name|item2
init|=
operator|new
name|DndTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setAcceptDrops
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setAcceptDrops
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|item2
operator|->
name|ignoresDragMove
operator|=
literal|true
expr_stmt|;
name|item2
operator|->
name|ignoresDragEnter
operator|=
literal|false
expr_stmt|;
name|item2
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"item1"
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"item2"
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QMimeData
name|mimeData
decl_stmt|;
comment|// Initial drag enter for the scene
name|QDragEnterEvent
name|dragEnter
argument_list|(
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragEnter
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|dragEnter
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dragEnter
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|)
expr_stmt|;
block|{
comment|// Move outside the items
name|QDragMoveEvent
name|dragMove
argument_list|(
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragMove
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|dragMove
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dragMove
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|eventList
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|eventList
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Move inside item1
name|QDragMoveEvent
name|dragMove
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragMove
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|dragMove
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dragMove
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|IgnoreAction
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragEnter
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragMove
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Move into the intersection item1-item2
name|QDragMoveEvent
name|dragMove
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragMove
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|dragMove
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
comment|// move does not propagate, (ignoresDragMove = true)
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragLeave
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragEnter
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragMove
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Move into the item2
name|QDragMoveEvent
name|dragMove
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
literal|15
argument_list|,
literal|15
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragMove
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|dragMove
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dragMove
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragMove
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Move inside item1
name|QDragMoveEvent
name|dragMove
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragMove
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|dragMove
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dragMove
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|IgnoreAction
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|3
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragEnter
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|4
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragMove
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|3
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragLeave
argument_list|)
expr_stmt|;
block|}
block|{
name|item2
operator|->
name|ignoresDragEnter
operator|=
literal|true
expr_stmt|;
comment|// Move into the intersection item1-item2
name|QDragMoveEvent
name|dragMove
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dragMove
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|dragMove
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
comment|// dragEnter propagates down to item1, which then accepts the move event.
name|QCOMPARE
argument_list|(
name|dragMove
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|IgnoreAction
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|5
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragMove
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|4
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDragEnter
argument_list|)
expr_stmt|;
block|}
block|{
name|item2
operator|->
name|ignoresDragEnter
operator|=
literal|false
expr_stmt|;
comment|// Drop on the intersection item1-item2
name|QDropEvent
name|drop
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|drop
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|drop
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|drop
operator|.
name|dropAction
argument_list|()
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|eventList
operator|.
name|at
argument_list|(
literal|6
argument_list|)
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneDrop
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|eventList
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
comment|// Dummy drop event to keep the Mac from crashing.
name|QDropEvent
name|dropEvent
argument_list|(
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|CopyAction
argument_list|,
operator|&
name|mimeData
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|dropEvent
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_function
DECL|function|render_data
name|void
name|tst_QGraphicsScene
operator|::
name|render_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QRectF
argument_list|>
argument_list|(
literal|"targetRect"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QRectF
argument_list|>
argument_list|(
literal|"sourceRect"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|Qt
operator|::
name|AspectRatioMode
argument_list|>
argument_list|(
literal|"aspectRatioMode"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QMatrix
argument_list|>
argument_list|(
literal|"matrix"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QPainterPath
argument_list|>
argument_list|(
literal|"clip"
argument_list|)
expr_stmt|;
name|QPainterPath
name|clip_rect
decl_stmt|;
name|clip_rect
operator|.
name|addRect
argument_list|(
literal|50
argument_list|,
literal|100
argument_list|,
literal|200
argument_list|,
literal|150
argument_list|)
expr_stmt|;
name|QPainterPath
name|clip_ellipse
decl_stmt|;
name|clip_ellipse
operator|.
name|addEllipse
argument_list|(
literal|100
argument_list|,
literal|50
argument_list|,
literal|150
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"all-all-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|()
operator|<<
name|QRectF
argument_list|()
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"all-topleft-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|150
argument_list|,
literal|150
argument_list|)
operator|<<
name|QRectF
argument_list|()
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"all-topright-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|150
argument_list|,
literal|0
argument_list|,
literal|150
argument_list|,
literal|150
argument_list|)
operator|<<
name|QRectF
argument_list|()
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"all-bottomleft-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|150
argument_list|,
literal|150
argument_list|,
literal|150
argument_list|)
operator|<<
name|QRectF
argument_list|()
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"all-bottomright-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|150
argument_list|,
literal|150
argument_list|,
literal|150
argument_list|,
literal|150
argument_list|)
operator|<<
name|QRectF
argument_list|()
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"topleft-all-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|()
operator|<<
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"topright-all-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"bottomleft-all-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|()
operator|<<
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"bottomright-all-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"topleft-topleft-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|150
argument_list|,
literal|150
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"topright-topleft-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|150
argument_list|,
literal|0
argument_list|,
literal|150
argument_list|,
literal|150
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"bottomleft-topleft-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|150
argument_list|,
literal|150
argument_list|,
literal|150
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"bottomright-topleft-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|150
argument_list|,
literal|150
argument_list|,
literal|150
argument_list|,
literal|150
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"top-topleft-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|150
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"bottom-topleft-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|150
argument_list|,
literal|300
argument_list|,
literal|150
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"left-topleft-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|150
argument_list|,
literal|300
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"right-topleft-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|150
argument_list|,
literal|0
argument_list|,
literal|150
argument_list|,
literal|300
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"top-bottomright-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|150
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"bottom-bottomright-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|150
argument_list|,
literal|300
argument_list|,
literal|150
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"left-bottomright-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|150
argument_list|,
literal|300
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"right-bottomright-untransformed"
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|150
argument_list|,
literal|0
argument_list|,
literal|150
argument_list|,
literal|300
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"all-all-45-deg-right"
argument_list|)
operator|<<
name|QRectF
argument_list|()
operator|<<
name|QRectF
argument_list|()
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
operator|-
literal|45
argument_list|)
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"all-all-45-deg-left"
argument_list|)
operator|<<
name|QRectF
argument_list|()
operator|<<
name|QRectF
argument_list|()
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|45
argument_list|)
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"all-all-scale-2x"
argument_list|)
operator|<<
name|QRectF
argument_list|()
operator|<<
name|QRectF
argument_list|()
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|.
name|scale
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"all-all-translate-50-0"
argument_list|)
operator|<<
name|QRectF
argument_list|()
operator|<<
name|QRectF
argument_list|()
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|.
name|translate
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"all-all-translate-0-50"
argument_list|)
operator|<<
name|QRectF
argument_list|()
operator|<<
name|QRectF
argument_list|()
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|.
name|translate
argument_list|(
literal|0
argument_list|,
literal|50
argument_list|)
operator|<<
name|QPainterPath
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"all-all-untransformed-clip-rect"
argument_list|)
operator|<<
name|QRectF
argument_list|()
operator|<<
name|QRectF
argument_list|()
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|clip_rect
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"all-all-untransformed-clip-ellipse"
argument_list|)
operator|<<
name|QRectF
argument_list|()
operator|<<
name|QRectF
argument_list|()
operator|<<
name|Qt
operator|::
name|IgnoreAspectRatio
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|clip_ellipse
expr_stmt|;
block|}
end_function
begin_function
DECL|function|render
name|void
name|tst_QGraphicsScene
operator|::
name|render
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QRectF
argument_list|,
name|targetRect
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QRectF
argument_list|,
name|sourceRect
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|Qt
operator|::
name|AspectRatioMode
argument_list|,
name|aspectRatioMode
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QMatrix
argument_list|,
name|matrix
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QPainterPath
argument_list|,
name|clip
argument_list|)
expr_stmt|;
name|QPixmap
name|pix
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|)
decl_stmt|;
name|pix
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
decl_stmt|;
name|QGraphicsScene
name|scene
argument_list|(
operator|&
name|view
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addEllipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|2
argument_list|,
operator|-
literal|7
argument_list|,
literal|4
argument_list|,
literal|4
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|yellow
argument_list|)
argument_list|)
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QGraphicsPixmapItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addPixmap
argument_list|(
name|pix
argument_list|)
decl_stmt|;
name|item
operator|->
name|setZValue
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|item
operator|->
name|setOffset
argument_list|(
name|QPointF
argument_list|(
literal|3
argument_list|,
literal|3
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
name|scene
operator|.
name|itemsBoundingRect
argument_list|()
argument_list|)
expr_stmt|;
name|QImage
name|bigImage
argument_list|(
literal|300
argument_list|,
literal|300
argument_list|,
name|QImage
operator|::
name|Format_RGB32
argument_list|)
decl_stmt|;
name|bigImage
operator|.
name|fill
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QPainter
name|painter
argument_list|(
operator|&
name|bigImage
argument_list|)
decl_stmt|;
name|painter
operator|.
name|setPen
argument_list|(
name|Qt
operator|::
name|lightGray
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<=
literal|300
condition|;
name|i
operator|+=
literal|25
control|)
block|{
name|painter
operator|.
name|drawLine
argument_list|(
literal|0
argument_list|,
name|i
argument_list|,
literal|300
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|painter
operator|.
name|drawLine
argument_list|(
name|i
argument_list|,
literal|0
argument_list|,
name|i
argument_list|,
literal|300
argument_list|)
expr_stmt|;
block|}
name|painter
operator|.
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|darkGray
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|painter
operator|.
name|drawLine
argument_list|(
literal|0
argument_list|,
literal|150
argument_list|,
literal|300
argument_list|,
literal|150
argument_list|)
expr_stmt|;
name|painter
operator|.
name|drawLine
argument_list|(
literal|150
argument_list|,
literal|0
argument_list|,
literal|150
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|painter
operator|.
name|setMatrix
argument_list|(
name|matrix
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|clip
operator|.
name|isEmpty
argument_list|()
condition|)
name|painter
operator|.
name|setClipPath
argument_list|(
name|clip
argument_list|)
expr_stmt|;
name|scene
operator|.
name|render
argument_list|(
operator|&
name|painter
argument_list|,
name|targetRect
argument_list|,
name|sourceRect
argument_list|,
name|aspectRatioMode
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
specifier|const
name|QString
name|renderPath
init|=
name|QLatin1String
argument_list|(
name|SRCDIR
argument_list|)
operator|+
literal|"/testData/render"
decl_stmt|;
name|QString
name|fileName
init|=
name|renderPath
operator|+
name|QString
argument_list|(
literal|"/%1.png"
argument_list|)
operator|.
name|arg
argument_list|(
name|QTest
operator|::
name|currentDataTag
argument_list|()
argument_list|)
decl_stmt|;
name|QImage
name|original
argument_list|(
name|fileName
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|original
operator|.
name|isNull
argument_list|()
argument_list|)
expr_stmt|;
comment|// Compare
name|int
name|wrongPixels
init|=
literal|0
decl_stmt|;
for|for
control|(
name|int
name|y
init|=
literal|0
init|;
name|y
operator|<
name|original
operator|.
name|height
argument_list|()
condition|;
operator|++
name|y
control|)
block|{
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
name|original
operator|.
name|width
argument_list|()
condition|;
operator|++
name|x
control|)
block|{
if|if
condition|(
name|bigImage
operator|.
name|pixel
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
operator|!=
name|original
operator|.
name|pixel
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
condition|)
operator|++
name|wrongPixels
expr_stmt|;
block|}
block|}
comment|// This is a pixmap compare test - because of rounding errors on diverse
comment|// platforms, and especially because tests are compiled in release mode,
comment|// we set a 95% acceptance threshold for comparing images. This number may
comment|// have to be adjusted if this test fails.
name|qreal
name|threshold
init|=
literal|0.95
decl_stmt|;
name|qreal
name|similarity
init|=
operator|(
literal|1
operator|-
operator|(
name|wrongPixels
operator|/
name|qreal
argument_list|(
name|original
operator|.
name|width
argument_list|()
operator|*
name|original
operator|.
name|height
argument_list|()
argument_list|)
operator|)
operator|)
decl_stmt|;
if|if
condition|(
name|similarity
operator|<
name|threshold
condition|)
block|{
if|#
directive|if
literal|1
comment|// fail
name|QLabel
modifier|*
name|expectedLabel
init|=
operator|new
name|QLabel
decl_stmt|;
name|expectedLabel
operator|->
name|setPixmap
argument_list|(
name|QPixmap
operator|::
name|fromImage
argument_list|(
name|original
argument_list|)
argument_list|)
expr_stmt|;
name|QLabel
modifier|*
name|newLabel
init|=
operator|new
name|QLabel
decl_stmt|;
name|newLabel
operator|->
name|setPixmap
argument_list|(
name|QPixmap
operator|::
name|fromImage
argument_list|(
name|bigImage
argument_list|)
argument_list|)
expr_stmt|;
name|QGridLayout
modifier|*
name|gridLayout
init|=
operator|new
name|QGridLayout
decl_stmt|;
name|gridLayout
operator|->
name|addWidget
argument_list|(
operator|new
name|QLabel
argument_list|(
name|tr
argument_list|(
literal|"MISMATCH: %1"
argument_list|)
operator|.
name|arg
argument_list|(
name|QTest
operator|::
name|currentDataTag
argument_list|()
argument_list|)
argument_list|)
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|gridLayout
operator|->
name|addWidget
argument_list|(
operator|new
name|QLabel
argument_list|(
name|tr
argument_list|(
literal|"Current"
argument_list|)
argument_list|)
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gridLayout
operator|->
name|addWidget
argument_list|(
operator|new
name|QLabel
argument_list|(
name|tr
argument_list|(
literal|"Expected"
argument_list|)
argument_list|)
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gridLayout
operator|->
name|addWidget
argument_list|(
name|expectedLabel
argument_list|,
literal|2
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|gridLayout
operator|->
name|addWidget
argument_list|(
name|newLabel
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QWidget
name|widget
decl_stmt|;
name|widget
operator|.
name|setLayout
argument_list|(
name|gridLayout
argument_list|)
expr_stmt|;
name|widget
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTestEventLoop
operator|::
name|instance
argument_list|()
operator|.
name|enterLoop
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QFAIL
argument_list|(
literal|"Images are not identical."
argument_list|)
expr_stmt|;
else|#
directive|else
comment|// generate
name|qDebug
argument_list|()
operator|<<
literal|"Updating"
operator|<<
name|QTest
operator|::
name|currentDataTag
argument_list|()
operator|<<
literal|":"
operator|<<
name|bigImage
operator|.
name|save
argument_list|(
name|fileName
argument_list|,
literal|"png"
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
end_function
begin_function
DECL|function|renderItemsWithNegativeWidthOrHeight
name|void
name|tst_QGraphicsScene
operator|::
name|renderItemsWithNegativeWidthOrHeight
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|150
argument_list|,
literal|150
argument_list|)
decl_stmt|;
comment|// Add item with negative width.
name|QGraphicsRectItem
modifier|*
name|item1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
operator|-
literal|150
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setPos
argument_list|(
literal|150
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
comment|// Add item with negative height.
name|QGraphicsRectItem
modifier|*
name|item2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
operator|-
literal|150
argument_list|)
decl_stmt|;
name|item2
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|150
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFrameStyle
argument_list|(
name|QFrame
operator|::
name|NoFrame
argument_list|)
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|150
argument_list|,
literal|150
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|size
argument_list|()
argument_list|,
name|QSize
argument_list|(
literal|150
argument_list|,
literal|150
argument_list|)
argument_list|)
expr_stmt|;
name|QImage
name|expected
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|size
argument_list|()
argument_list|,
name|QImage
operator|::
name|Format_RGB32
argument_list|)
decl_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|render
argument_list|(
operator|&
name|expected
argument_list|)
expr_stmt|;
comment|// Make sure the scene background is the same as the viewport background.
name|scene
operator|.
name|setBackgroundBrush
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|palette
argument_list|()
operator|.
name|brush
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|backgroundRole
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QImage
name|actual
argument_list|(
literal|150
argument_list|,
literal|150
argument_list|,
name|QImage
operator|::
name|Format_RGB32
argument_list|)
decl_stmt|;
name|QPainter
name|painter
argument_list|(
operator|&
name|actual
argument_list|)
decl_stmt|;
name|scene
operator|.
name|render
argument_list|(
operator|&
name|painter
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|actual
argument_list|,
name|expected
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|contextMenuEvent
name|void
name|tst_QGraphicsScene
operator|::
name|contextMenuEvent
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|EventTester
modifier|*
name|item
init|=
operator|new
name|EventTester
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|view
operator|.
name|activateWindow
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|centerOn
argument_list|(
name|item
argument_list|)
expr_stmt|;
block|{
name|QContextMenuEvent
name|event
argument_list|(
name|QContextMenuEvent
operator|::
name|Keyboard
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|,
name|view
operator|.
name|mapToGlobal
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventTypes
operator|.
name|last
argument_list|()
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneContextMenu
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_class
DECL|class|ContextMenuItem
class|class
name|ContextMenuItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|ContextMenuItem
name|ContextMenuItem
parameter_list|()
member_init_list|:
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
block|{
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
block|}
protected|protected:
DECL|function|contextMenuEvent
name|void
name|contextMenuEvent
parameter_list|(
name|QGraphicsSceneContextMenuEvent
modifier|*
parameter_list|)
block|{
comment|/* just accept */
block|}
block|}
class|;
end_class
begin_function
DECL|function|contextMenuEvent_ItemIgnoresTransformations
name|void
name|tst_QGraphicsScene
operator|::
name|contextMenuEvent_ItemIgnoresTransformations
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|ContextMenuItem
modifier|*
name|item
init|=
operator|new
name|ContextMenuItem
decl_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIgnoresTransformations
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QWidget
name|topLevel
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|topLevel
argument_list|)
decl_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|topLevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|topLevel
argument_list|)
argument_list|)
expr_stmt|;
block|{
name|QPoint
name|pos
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|QContextMenuEvent
name|event
argument_list|(
name|QContextMenuEvent
operator|::
name|Keyboard
argument_list|,
name|pos
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|pos
argument_list|)
argument_list|)
decl_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|event
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
name|QPoint
name|pos
argument_list|(
literal|150
argument_list|,
literal|150
argument_list|)
decl_stmt|;
name|QContextMenuEvent
name|event
argument_list|(
name|QContextMenuEvent
operator|::
name|Keyboard
argument_list|,
name|pos
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|pos
argument_list|)
argument_list|)
decl_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|event
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|view
operator|.
name|scale
argument_list|(
literal|1.5
argument_list|,
literal|1.5
argument_list|)
expr_stmt|;
block|{
name|QPoint
name|pos
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
decl_stmt|;
name|QContextMenuEvent
name|event
argument_list|(
name|QContextMenuEvent
operator|::
name|Keyboard
argument_list|,
name|pos
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|pos
argument_list|)
argument_list|)
decl_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|event
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
name|QPoint
name|pos
argument_list|(
literal|55
argument_list|,
literal|55
argument_list|)
decl_stmt|;
name|QContextMenuEvent
name|event
argument_list|(
name|QContextMenuEvent
operator|::
name|Keyboard
argument_list|,
name|pos
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|pos
argument_list|)
argument_list|)
decl_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|event
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|update
name|void
name|tst_QGraphicsScene
operator|::
name|update
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rect
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|rect
operator|->
name|setPos
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
expr_stmt|;
comment|// This function forces indexing
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|qRegisterMetaType
argument_list|<
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|>
argument_list|(
literal|"QList<QRectF>"
argument_list|)
expr_stmt|;
name|QSignalSpy
name|spy
argument_list|(
operator|&
name|scene
argument_list|,
name|SIGNAL
argument_list|(
name|changed
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
comment|// We update the scene.
name|scene
operator|.
name|update
argument_list|()
expr_stmt|;
comment|// This function forces a purge, which will post an update signal
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// This will process the pending update
name|QApplication
operator|::
name|instance
argument_list|()
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// Check that the update region is correct
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QRectF
name|region
decl_stmt|;
foreach|foreach
control|(
name|QRectF
name|rectF
decl|,
name|qvariant_cast
argument_list|<
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|>
argument_list|(
name|spy
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
control|)
name|region
operator||=
name|rectF
expr_stmt|;
name|QCOMPARE
argument_list|(
name|region
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|update2
name|void
name|tst_QGraphicsScene
operator|::
name|update2
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|200
argument_list|,
operator|-
literal|200
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|CustomView
name|view
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>=
literal|1
argument_list|)
expr_stmt|;
name|view
operator|.
name|repaints
operator|=
literal|0
expr_stmt|;
comment|// Make sure QGraphicsScene::update only requires one event-loop iteration
comment|// before the view is updated.
name|scene
operator|.
name|update
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|view
operator|.
name|repaints
operator|=
literal|0
expr_stmt|;
comment|// The same for partial scene updates.
name|scene
operator|.
name|update
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|views
name|void
name|tst_QGraphicsScene
operator|::
name|views
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|views
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|views
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
operator|&
name|view
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view1
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|views
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|views
argument_list|()
operator|.
name|contains
argument_list|(
operator|&
name|view1
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|setScene
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|views
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|views
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
operator|&
name|view1
argument_list|)
expr_stmt|;
name|QGraphicsView
modifier|*
name|view2
init|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|views
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|views
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
operator|&
name|view1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|views
argument_list|()
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|view2
argument_list|)
expr_stmt|;
operator|delete
name|view2
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|views
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|views
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
operator|&
name|view1
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|CustomScene
class|class
name|CustomScene
super|:
specifier|public
name|QGraphicsScene
block|{
public|public:
DECL|function|CustomScene
name|CustomScene
parameter_list|()
member_init_list|:
name|gotTimerEvent
argument_list|(
literal|false
argument_list|)
block|{
name|startTimer
argument_list|(
literal|10
argument_list|)
expr_stmt|;
block|}
DECL|member|gotTimerEvent
name|bool
name|gotTimerEvent
decl_stmt|;
protected|protected:
DECL|function|timerEvent
name|void
name|timerEvent
parameter_list|(
name|QTimerEvent
modifier|*
parameter_list|)
block|{
name|gotTimerEvent
operator|=
literal|true
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|event
name|void
name|tst_QGraphicsScene
operator|::
name|event
parameter_list|()
block|{
comment|// Test that QGraphicsScene properly propagates events to QObject.
name|CustomScene
name|scene
decl_stmt|;
name|QTestEventLoop
operator|::
name|instance
argument_list|()
operator|.
name|enterLoop
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|gotTimerEvent
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|DisabledItemTester
class|class
name|DisabledItemTester
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|DisabledItemTester
name|DisabledItemTester
parameter_list|(
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|,
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|,
name|parent
argument_list|)
block|{ }
DECL|member|receivedSceneEvents
name|QList
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|>
name|receivedSceneEvents
decl_stmt|;
DECL|member|receivedSceneEventFilters
name|QList
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|>
name|receivedSceneEventFilters
decl_stmt|;
protected|protected:
DECL|function|sceneEventFilter
name|bool
name|sceneEventFilter
parameter_list|(
name|QGraphicsItem
modifier|*
name|watched
parameter_list|,
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
name|receivedSceneEventFilters
operator|<<
name|event
operator|->
name|type
argument_list|()
expr_stmt|;
return|return
name|QGraphicsRectItem
operator|::
name|sceneEventFilter
argument_list|(
name|watched
argument_list|,
name|event
argument_list|)
return|;
block|}
DECL|function|sceneEvent
name|bool
name|sceneEvent
parameter_list|(
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
name|receivedSceneEvents
operator|<<
name|event
operator|->
name|type
argument_list|()
expr_stmt|;
return|return
name|QGraphicsRectItem
operator|::
name|sceneEvent
argument_list|(
name|event
argument_list|)
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|eventsToDisabledItems
name|void
name|tst_QGraphicsScene
operator|::
name|eventsToDisabledItems
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|DisabledItemTester
modifier|*
name|item1
init|=
operator|new
name|DisabledItemTester
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|DisabledItemTester
modifier|*
name|item2
init|=
operator|new
name|DisabledItemTester
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|// on top
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|item1
operator|->
name|installSceneEventFilter
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|receivedSceneEvents
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|receivedSceneEvents
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|receivedSceneEventFilters
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|receivedSceneEventFilters
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
comment|// First item2 receives a scene event filter. Then item1 receives the
comment|// actual event. Finally the event propagates to item2. So both items
comment|// should have received the event, and item1 also got the filter.
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|receivedSceneEvents
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|receivedSceneEvents
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|receivedSceneEventFilters
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|receivedSceneEventFilters
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|item1
operator|->
name|receivedSceneEvents
operator|.
name|clear
argument_list|()
expr_stmt|;
name|item1
operator|->
name|receivedSceneEventFilters
operator|.
name|clear
argument_list|()
expr_stmt|;
name|item2
operator|->
name|receivedSceneEvents
operator|.
name|clear
argument_list|()
expr_stmt|;
name|item2
operator|->
name|receivedSceneEventFilters
operator|.
name|clear
argument_list|()
expr_stmt|;
name|item1
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
comment|// disable the topmost item, eat mouse events
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setAccepted
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
comment|// Check that only item1 received anything - it only got the filter.
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|receivedSceneEvents
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|receivedSceneEvents
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|receivedSceneEventFilters
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|receivedSceneEventFilters
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|ExposedPixmapItem
class|class
name|ExposedPixmapItem
super|:
specifier|public
name|QGraphicsPixmapItem
block|{
public|public:
DECL|function|ExposedPixmapItem
name|ExposedPixmapItem
parameter_list|(
name|QGraphicsItem
modifier|*
name|item
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsPixmapItem
argument_list|(
name|item
argument_list|)
block|{ }
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
name|exposed
operator|=
name|option
operator|->
name|exposedRect
expr_stmt|;
block|}
DECL|member|exposed
name|QRectF
name|exposed
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|exposedRect
name|void
name|tst_QGraphicsScene
operator|::
name|exposedRect
parameter_list|()
block|{
name|ExposedPixmapItem
modifier|*
name|item
init|=
operator|new
name|ExposedPixmapItem
decl_stmt|;
name|item
operator|->
name|setPixmap
argument_list|(
name|QPixmap
argument_list|(
literal|":/Ash_European.jpg"
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|exposed
argument_list|,
name|QRectF
argument_list|()
argument_list|)
expr_stmt|;
name|QImage
name|image
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|,
name|QImage
operator|::
name|Format_ARGB32_Premultiplied
argument_list|)
decl_stmt|;
name|QPainter
name|painter
argument_list|(
operator|&
name|image
argument_list|)
decl_stmt|;
name|scene
operator|.
name|render
argument_list|(
operator|&
name|painter
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|exposed
argument_list|,
name|item
operator|->
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
name|painter
operator|.
name|rotate
argument_list|(
literal|180
argument_list|)
expr_stmt|;
name|painter
operator|.
name|translate
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|scene
operator|.
name|render
argument_list|(
operator|&
name|painter
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|exposed
argument_list|,
name|item
operator|->
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|tabFocus_emptyScene
name|void
name|tst_QGraphicsScene
operator|::
name|tabFocus_emptyScene
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QDial
modifier|*
name|dial1
init|=
operator|new
name|QDial
decl_stmt|;
name|QGraphicsView
modifier|*
name|view
init|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QDial
modifier|*
name|dial2
init|=
operator|new
name|QDial
decl_stmt|;
name|QHBoxLayout
modifier|*
name|layout
init|=
operator|new
name|QHBoxLayout
decl_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|dial1
argument_list|)
expr_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|view
argument_list|)
expr_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|dial2
argument_list|)
expr_stmt|;
name|QWidget
name|widget
decl_stmt|;
name|widget
operator|.
name|setLayout
argument_list|(
name|layout
argument_list|)
expr_stmt|;
name|widget
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|widget
argument_list|)
expr_stmt|;
name|widget
operator|.
name|activateWindow
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|dial1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|dial1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|dial1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|dial2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Backtab
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|dial2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Backtab
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|dial1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|dial2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|tabFocus_sceneWithFocusableItems
name|void
name|tst_QGraphicsScene
operator|::
name|tabFocus_sceneWithFocusableItems
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsTextItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addText
argument_list|(
literal|"Qt rocks!"
argument_list|)
decl_stmt|;
name|item
operator|->
name|setTabChangesFocus
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|item
operator|->
name|setTextInteractionFlags
argument_list|(
name|Qt
operator|::
name|TextEditorInteraction
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|item
operator|->
name|clearFocus
argument_list|()
expr_stmt|;
name|QGraphicsTextItem
modifier|*
name|item2
init|=
name|scene
operator|.
name|addText
argument_list|(
literal|"Qt rocks!"
argument_list|)
decl_stmt|;
name|item2
operator|->
name|setTabChangesFocus
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setTextInteractionFlags
argument_list|(
name|Qt
operator|::
name|TextEditorInteraction
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setPos
argument_list|(
literal|0
argument_list|,
name|item
operator|->
name|boundingRect
argument_list|()
operator|.
name|bottom
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|QDial
modifier|*
name|dial1
init|=
operator|new
name|QDial
decl_stmt|;
name|QGraphicsView
modifier|*
name|view
init|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QDial
modifier|*
name|dial2
init|=
operator|new
name|QDial
decl_stmt|;
name|QHBoxLayout
modifier|*
name|layout
init|=
operator|new
name|QHBoxLayout
decl_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|dial1
argument_list|)
expr_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|view
argument_list|)
expr_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|dial2
argument_list|)
expr_stmt|;
name|QWidget
name|widget
decl_stmt|;
name|widget
operator|.
name|setLayout
argument_list|(
name|layout
argument_list|)
expr_stmt|;
name|widget
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|widget
argument_list|)
expr_stmt|;
name|widget
operator|.
name|activateWindow
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|dial1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|dial1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|->
name|viewport
argument_list|()
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|dial2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Backtab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|->
name|viewport
argument_list|()
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|scene
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Backtab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|dial1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// If the item requests input focus, it can only ensure that the scene
comment|// sets focus on itself, but the scene cannot request focus from any view.
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|view
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|->
name|viewport
argument_list|()
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|scene
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|->
name|viewport
argument_list|()
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|scene
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// Check that everyone loses focus when the widget is hidden.
name|widget
operator|.
name|hide
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|15
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|view
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|view
operator|->
name|viewport
argument_list|()
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
comment|// Check that the correct item regains focus.
name|widget
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|widget
argument_list|)
expr_stmt|;
name|widget
operator|.
name|activateWindow
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|scene
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|view
operator|->
name|viewport
argument_list|()
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|FocusWidget
class|class
name|FocusWidget
super|:
specifier|public
name|QGraphicsWidget
block|{
name|Q_OBJECT
public|public:
DECL|function|FocusWidget
name|FocusWidget
parameter_list|(
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsWidget
argument_list|(
name|parent
argument_list|)
member_init_list|,
name|tabs
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|backTabs
argument_list|(
literal|0
argument_list|)
block|{
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|resize
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
block|}
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
if|if
condition|(
name|option
operator|->
name|state
operator|&
name|QStyle
operator|::
name|State_HasFocus
condition|)
block|{
name|painter
operator|->
name|fillRect
argument_list|(
name|rect
argument_list|()
argument_list|,
name|Qt
operator|::
name|blue
argument_list|)
expr_stmt|;
block|}
name|painter
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
expr_stmt|;
name|painter
operator|->
name|drawEllipse
argument_list|(
name|rect
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|option
operator|->
name|state
operator|&
name|QStyle
operator|::
name|State_HasFocus
condition|)
block|{
name|painter
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|1
argument_list|,
name|Qt
operator|::
name|DashLine
argument_list|)
argument_list|)
expr_stmt|;
name|painter
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|NoBrush
argument_list|)
expr_stmt|;
name|painter
operator|->
name|drawEllipse
argument_list|(
name|rect
argument_list|()
operator|.
name|adjusted
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|,
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
DECL|member|tabs
name|int
name|tabs
decl_stmt|;
DECL|member|backTabs
name|int
name|backTabs
decl_stmt|;
protected|protected:
DECL|function|sceneEvent
name|bool
name|sceneEvent
parameter_list|(
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
name|event
operator|->
name|type
argument_list|()
operator|==
name|QEvent
operator|::
name|KeyPress
condition|)
block|{
name|QKeyEvent
modifier|*
name|k
init|=
cast|static_cast
argument_list|<
name|QKeyEvent
operator|*
argument_list|>
argument_list|(
name|event
argument_list|)
decl_stmt|;
if|if
condition|(
name|k
operator|->
name|key
argument_list|()
operator|==
name|Qt
operator|::
name|Key_Tab
condition|)
operator|++
name|tabs
expr_stmt|;
if|if
condition|(
name|k
operator|->
name|key
argument_list|()
operator|==
name|Qt
operator|::
name|Key_Backtab
condition|)
operator|++
name|backTabs
expr_stmt|;
block|}
return|return
name|QGraphicsWidget
operator|::
name|sceneEvent
argument_list|(
name|event
argument_list|)
return|;
block|}
DECL|function|focusInEvent
name|void
name|focusInEvent
parameter_list|(
name|QFocusEvent
modifier|*
parameter_list|)
block|{
name|update
argument_list|()
expr_stmt|;
block|}
DECL|function|focusOutEvent
name|void
name|focusOutEvent
parameter_list|(
name|QFocusEvent
modifier|*
parameter_list|)
block|{
name|update
argument_list|()
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|tabFocus_sceneWithFocusWidgets
name|void
name|tst_QGraphicsScene
operator|::
name|tabFocus_sceneWithFocusWidgets
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|FocusWidget
modifier|*
name|widget1
init|=
operator|new
name|FocusWidget
decl_stmt|;
name|FocusWidget
modifier|*
name|widget2
init|=
operator|new
name|FocusWidget
decl_stmt|;
name|widget2
operator|->
name|setPos
argument_list|(
name|widget1
operator|->
name|boundingRect
argument_list|()
operator|.
name|right
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget2
argument_list|)
expr_stmt|;
name|QDial
modifier|*
name|dial1
init|=
operator|new
name|QDial
decl_stmt|;
name|QGraphicsView
modifier|*
name|view
init|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|->
name|setRenderHint
argument_list|(
name|QPainter
operator|::
name|Antialiasing
argument_list|)
expr_stmt|;
name|QDial
modifier|*
name|dial2
init|=
operator|new
name|QDial
decl_stmt|;
name|QHBoxLayout
modifier|*
name|layout
init|=
operator|new
name|QHBoxLayout
decl_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|dial1
argument_list|)
expr_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|view
argument_list|)
expr_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|dial2
argument_list|)
expr_stmt|;
name|QWidget
name|widget
decl_stmt|;
name|widget
operator|.
name|setLayout
argument_list|(
name|layout
argument_list|)
expr_stmt|;
name|widget
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|widget
argument_list|)
expr_stmt|;
name|widget
operator|.
name|activateWindow
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|dial1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|dial1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|->
name|viewport
argument_list|()
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|scene
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|widget1
operator|->
name|tabs
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|widget1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|widget1
operator|->
name|tabs
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|widget2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|widget2
operator|->
name|tabs
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|dial2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Backtab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|widget2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Backtab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|widget2
operator|->
name|backTabs
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|widget1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Backtab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|widget1
operator|->
name|backTabs
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|dial1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|widget1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|view
operator|->
name|viewport
argument_list|()
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|widget
operator|.
name|hide
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|15
argument_list|)
expr_stmt|;
name|widget
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|widget
argument_list|)
expr_stmt|;
name|widget
operator|.
name|activateWindow
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|widget1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|tabFocus_sceneWithNestedFocusWidgets
name|void
name|tst_QGraphicsScene
operator|::
name|tabFocus_sceneWithNestedFocusWidgets
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|FocusWidget
modifier|*
name|widget1
init|=
operator|new
name|FocusWidget
decl_stmt|;
name|FocusWidget
modifier|*
name|widget1_1
init|=
operator|new
name|FocusWidget
decl_stmt|;
name|FocusWidget
modifier|*
name|widget1_2
init|=
operator|new
name|FocusWidget
decl_stmt|;
name|widget1_1
operator|->
name|setParentItem
argument_list|(
name|widget1
argument_list|)
expr_stmt|;
name|widget1_1
operator|->
name|scale
argument_list|(
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|widget1_1
operator|->
name|setPos
argument_list|(
literal|0
argument_list|,
name|widget1
operator|->
name|boundingRect
argument_list|()
operator|.
name|height
argument_list|()
operator|/
literal|2
argument_list|)
expr_stmt|;
name|widget1_2
operator|->
name|setParentItem
argument_list|(
name|widget1
argument_list|)
expr_stmt|;
name|widget1_2
operator|->
name|scale
argument_list|(
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|widget1_2
operator|->
name|setPos
argument_list|(
name|widget1
operator|->
name|boundingRect
argument_list|()
operator|.
name|width
argument_list|()
operator|/
literal|2
argument_list|,
name|widget1
operator|->
name|boundingRect
argument_list|()
operator|.
name|height
argument_list|()
operator|/
literal|2
argument_list|)
expr_stmt|;
name|FocusWidget
modifier|*
name|widget2
init|=
operator|new
name|FocusWidget
decl_stmt|;
name|widget2
operator|->
name|setPos
argument_list|(
name|widget1
operator|->
name|boundingRect
argument_list|()
operator|.
name|right
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|widget1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"widget1"
argument_list|)
expr_stmt|;
name|widget1_1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"widget1_1"
argument_list|)
expr_stmt|;
name|widget1_2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"widget1_2"
argument_list|)
expr_stmt|;
name|widget2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"widget2"
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget2
argument_list|)
expr_stmt|;
name|QDial
modifier|*
name|dial1
init|=
operator|new
name|QDial
decl_stmt|;
name|QGraphicsView
modifier|*
name|view
init|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|->
name|setRenderHint
argument_list|(
name|QPainter
operator|::
name|Antialiasing
argument_list|)
expr_stmt|;
name|QDial
modifier|*
name|dial2
init|=
operator|new
name|QDial
decl_stmt|;
name|QHBoxLayout
modifier|*
name|layout
init|=
operator|new
name|QHBoxLayout
decl_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|dial1
argument_list|)
expr_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|view
argument_list|)
expr_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|dial2
argument_list|)
expr_stmt|;
name|QWidget
name|widget
decl_stmt|;
name|widget
operator|.
name|setLayout
argument_list|(
name|layout
argument_list|)
expr_stmt|;
name|widget
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|widget
argument_list|)
expr_stmt|;
name|widget
operator|.
name|activateWindow
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|dial1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|dial1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|EventSpy
name|focusInSpy_1
argument_list|(
name|widget1
argument_list|,
name|QEvent
operator|::
name|FocusIn
argument_list|)
decl_stmt|;
name|EventSpy
name|focusOutSpy_1
argument_list|(
name|widget1
argument_list|,
name|QEvent
operator|::
name|FocusOut
argument_list|)
decl_stmt|;
name|EventSpy
name|focusInSpy_1_1
argument_list|(
name|widget1_1
argument_list|,
name|QEvent
operator|::
name|FocusIn
argument_list|)
decl_stmt|;
name|EventSpy
name|focusOutSpy_1_1
argument_list|(
name|widget1_1
argument_list|,
name|QEvent
operator|::
name|FocusOut
argument_list|)
decl_stmt|;
name|EventSpy
name|focusInSpy_1_2
argument_list|(
name|widget1_2
argument_list|,
name|QEvent
operator|::
name|FocusIn
argument_list|)
decl_stmt|;
name|EventSpy
name|focusOutSpy_1_2
argument_list|(
name|widget1_2
argument_list|,
name|QEvent
operator|::
name|FocusOut
argument_list|)
decl_stmt|;
name|EventSpy
name|focusInSpy_2
argument_list|(
name|widget2
argument_list|,
name|QEvent
operator|::
name|FocusIn
argument_list|)
decl_stmt|;
name|EventSpy
name|focusOutSpy_2
argument_list|(
name|widget2
argument_list|,
name|QEvent
operator|::
name|FocusOut
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|widget1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusInSpy_1
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|widget1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|widget1_1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusOutSpy_1
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusInSpy_1_1
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|widget1_1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|widget1_2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusOutSpy_1_1
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusInSpy_1_2
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|widget1_2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|widget2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusOutSpy_1_2
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusInSpy_2
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|widget2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|dial2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusOutSpy_2
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Backtab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|widget2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusInSpy_2
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Backtab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|widget2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|widget1_2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusOutSpy_2
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusInSpy_1_2
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Backtab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|widget1_2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|widget1_1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusOutSpy_1_2
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusInSpy_1_1
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Backtab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|widget1_1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|widget1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusOutSpy_1_1
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusInSpy_1
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Backtab
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|widget1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|dial1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusOutSpy_1
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|widget1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|view
operator|->
name|viewport
argument_list|()
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|widget
operator|.
name|hide
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|12
argument_list|)
expr_stmt|;
name|widget
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|widget
argument_list|)
expr_stmt|;
name|widget
operator|.
name|activateWindow
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|widget1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|style
name|void
name|tst_QGraphicsScene
operator|::
name|style
parameter_list|()
block|{
name|QPointer
argument_list|<
name|QWindowsStyle
argument_list|>
name|windowsStyle
init|=
operator|new
name|QWindowsStyle
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QLineEdit
modifier|*
name|edit
init|=
operator|new
name|QLineEdit
decl_stmt|;
name|QGraphicsProxyWidget
modifier|*
name|proxy
init|=
name|scene
operator|.
name|addWidget
argument_list|(
name|edit
argument_list|)
decl_stmt|;
name|EventSpy
name|sceneSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|QEvent
operator|::
name|StyleChange
argument_list|)
decl_stmt|;
name|EventSpy
name|proxySpy
argument_list|(
name|proxy
argument_list|,
name|QEvent
operator|::
name|StyleChange
argument_list|)
decl_stmt|;
name|EventSpy
name|editSpy
argument_list|(
name|edit
argument_list|,
name|QEvent
operator|::
name|StyleChange
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|style
argument_list|()
argument_list|,
name|QApplication
operator|::
name|style
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setStyle
argument_list|(
name|windowsStyle
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|proxySpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|editSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|style
argument_list|()
argument_list|,
operator|(
name|QStyle
operator|*
operator|)
name|windowsStyle
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|proxy
operator|->
name|style
argument_list|()
argument_list|,
operator|(
name|QStyle
operator|*
operator|)
name|windowsStyle
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|edit
operator|->
name|style
argument_list|()
argument_list|,
operator|(
name|QStyle
operator|*
operator|)
name|windowsStyle
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setStyle
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|proxySpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|editSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|style
argument_list|()
argument_list|,
name|QApplication
operator|::
name|style
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|proxy
operator|->
name|style
argument_list|()
argument_list|,
name|QApplication
operator|::
name|style
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|edit
operator|->
name|style
argument_list|()
argument_list|,
name|QApplication
operator|::
name|style
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|windowsStyle
argument_list|)
expr_stmt|;
comment|// deleted
block|}
end_function
begin_function
DECL|function|task139710_bspTreeCrash
name|void
name|tst_QGraphicsScene
operator|::
name|task139710_bspTreeCrash
parameter_list|()
block|{
comment|// create a scene with 2000 items
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
operator|++
name|i
control|)
block|{
comment|// trigger delayed item indexing
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10000
argument_list|,
literal|10000
argument_list|)
expr_stmt|;
comment|// delete all items in the scene - pointers are now likely to be recycled
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|scene
operator|.
name|items
argument_list|()
control|)
block|{
name|scene
operator|.
name|removeItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
operator|delete
name|item
expr_stmt|;
block|}
comment|// add 1000 more items - the BSP tree is now resized
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|1000
condition|;
operator|++
name|i
control|)
block|{
name|QGraphicsRectItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setPos
argument_list|(
name|qrand
argument_list|()
operator|%
literal|10000
argument_list|,
name|qrand
argument_list|()
operator|%
literal|10000
argument_list|)
expr_stmt|;
block|}
comment|// trigger delayed item indexing for the first 1000 items
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// add 1000 more items - the BSP tree is now resized
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|1000
condition|;
operator|++
name|i
control|)
block|{
name|QGraphicsRectItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setPos
argument_list|(
name|qrand
argument_list|()
operator|%
literal|10000
argument_list|,
name|qrand
argument_list|()
operator|%
literal|10000
argument_list|)
expr_stmt|;
block|}
comment|// get items from the BSP tree and use them. there was junk in the tree
comment|// the second time this happened.
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1000
argument_list|,
literal|1000
argument_list|)
argument_list|)
control|)
name|item
operator|->
name|moveBy
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|task139782_containsItemBoundingRect
name|void
name|tst_QGraphicsScene
operator|::
name|task139782_containsItemBoundingRect
parameter_list|()
block|{
comment|// The item in question has a scene bounding rect of (10, 10, 50, 50)
name|QGraphicsScene
name|scene
argument_list|(
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|200.0
argument_list|,
literal|200.0
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|50.0
argument_list|,
literal|50.0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|item
operator|->
name|setPos
argument_list|(
literal|10.0
argument_list|,
literal|10.0
argument_list|)
expr_stmt|;
comment|// The (0, 0, 50, 50) scene rect should not include the item's bounding rect
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
literal|0.0
argument_list|,
literal|0.0
argument_list|,
literal|50.0
argument_list|,
literal|50.0
argument_list|)
argument_list|,
name|Qt
operator|::
name|ContainsItemBoundingRect
argument_list|)
operator|.
name|contains
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
comment|// The (9, 9, 500, 500) scene rect _should_ include the item's bounding rect
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
literal|9.0
argument_list|,
literal|9.0
argument_list|,
literal|500.0
argument_list|,
literal|500.0
argument_list|)
argument_list|,
name|Qt
operator|::
name|ContainsItemBoundingRect
argument_list|)
operator|.
name|contains
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
comment|// The (25, 25, 5, 5) scene rect should not include the item's bounding rect
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
literal|25.0
argument_list|,
literal|25.0
argument_list|,
literal|5.0
argument_list|,
literal|5.0
argument_list|)
argument_list|,
name|Qt
operator|::
name|ContainsItemBoundingRect
argument_list|)
operator|.
name|contains
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task176178_itemIndexMethodBreaksSceneRect
name|void
name|tst_QGraphicsScene
operator|::
name|task176178_itemIndexMethodBreaksSceneRect
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setItemIndexMethod
argument_list|(
name|QGraphicsScene
operator|::
name|NoIndex
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|rect
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|rect
operator|->
name|rect
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task160653_selectionChanged
name|void
name|tst_QGraphicsScene
operator|::
name|task160653_selectionChanged
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|new
name|QGraphicsRectItem
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|scene
operator|.
name|items
argument_list|()
control|)
block|{
name|item
operator|->
name|setFlags
argument_list|(
name|item
operator|->
name|flags
argument_list|()
operator||
name|QGraphicsItem
operator|::
name|ItemIsSelectable
operator||
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|item
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|()
operator|.
name|size
argument_list|()
operator|>
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
name|scene
operator|.
name|selectedItems
argument_list|()
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|QSignalSpy
name|spy
argument_list|(
operator|&
name|scene
argument_list|,
name|SIGNAL
argument_list|(
name|selectionChanged
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|scene
operator|.
name|items
argument_list|()
operator|.
name|first
argument_list|()
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task250680_childClip
name|void
name|tst_QGraphicsScene
operator|::
name|task250680_childClip
parameter_list|()
block|{
name|QGraphicsRectItem
modifier|*
name|clipper
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|clipper
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|clipper
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|green
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|clipper
operator|->
name|setRect
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|,
literal|640
argument_list|,
literal|480
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|clipper
argument_list|)
decl_stmt|;
name|rect
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|red
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setBrush
argument_list|(
name|QBrush
argument_list|(
name|QColor
argument_list|(
literal|255
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|75
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setPos
argument_list|(
literal|320
argument_list|,
literal|240
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setRect
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|clipper
argument_list|)
expr_stmt|;
name|QPainterPath
name|path
decl_stmt|;
name|path
operator|.
name|addRect
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QPathCompare
operator|::
name|comparePaths
argument_list|(
name|rect
operator|->
name|clipPath
argument_list|()
operator|.
name|simplified
argument_list|()
argument_list|,
name|path
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
literal|320
argument_list|,
literal|240
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|rect
operator|->
name|rotate
argument_list|(
literal|45
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
literal|320
argument_list|,
literal|240
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sorting_data
name|void
name|tst_QGraphicsScene
operator|::
name|sorting_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"cache"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Normal sorting"
argument_list|)
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Cached sorting"
argument_list|)
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sorting
name|void
name|tst_QGraphicsScene
operator|::
name|sorting
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|cache
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setSortCacheEnabled
argument_list|(
name|cache
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|t_1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|c_1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|40
argument_list|,
literal|40
argument_list|,
name|t_1
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|c_1_1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|30
argument_list|,
literal|30
argument_list|,
name|c_1
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|c_1_1_1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|,
name|c_1_1
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|c_1_2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|30
argument_list|,
literal|30
argument_list|,
name|c_1
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|c_2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|40
argument_list|,
literal|40
argument_list|,
name|t_1
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|c_2_1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|30
argument_list|,
literal|30
argument_list|,
name|c_2
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|c_2_1_1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|,
name|c_2_1
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|c_2_2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|30
argument_list|,
literal|30
argument_list|,
name|c_2
argument_list|)
decl_stmt|;
name|t_1
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|)
argument_list|)
expr_stmt|;
name|c_1
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|)
argument_list|)
expr_stmt|;
name|c_1_1
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|)
argument_list|)
expr_stmt|;
name|c_1_1_1
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|)
argument_list|)
expr_stmt|;
name|c_1_2
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|)
argument_list|)
expr_stmt|;
name|c_2
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|)
argument_list|)
expr_stmt|;
name|c_2_1
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|)
argument_list|)
expr_stmt|;
name|c_2_1_1
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|)
argument_list|)
expr_stmt|;
name|c_2_2
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|)
argument_list|)
expr_stmt|;
name|c_1
operator|->
name|setPos
argument_list|(
literal|23
argument_list|,
literal|18
argument_list|)
expr_stmt|;
name|c_1_1
operator|->
name|setPos
argument_list|(
literal|24
argument_list|,
literal|28
argument_list|)
expr_stmt|;
name|c_1_1_1
operator|->
name|setPos
argument_list|(
operator|-
literal|16
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|c_1_2
operator|->
name|setPos
argument_list|(
operator|-
literal|16
argument_list|,
literal|28
argument_list|)
expr_stmt|;
name|c_1_2
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|c_2
operator|->
name|setPos
argument_list|(
operator|-
literal|23
argument_list|,
literal|18
argument_list|)
expr_stmt|;
name|c_2
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|c_2_1
operator|->
name|setPos
argument_list|(
literal|24
argument_list|,
literal|28
argument_list|)
expr_stmt|;
name|c_2_1_1
operator|->
name|setPos
argument_list|(
operator|-
literal|16
argument_list|,
literal|16
argument_list|)
expr_stmt|;
name|c_2_2
operator|->
name|setPos
argument_list|(
operator|-
literal|16
argument_list|,
literal|28
argument_list|)
expr_stmt|;
name|c_2_2
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|c_1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|c_1_1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|c_1_1_1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|c_1_2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|c_2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|c_2_1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|c_2_1_1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|c_2_2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|t_1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"t_1"
argument_list|)
expr_stmt|;
name|c_1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"c_1"
argument_list|)
expr_stmt|;
name|c_1_1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"c_1_1"
argument_list|)
expr_stmt|;
name|c_1_1_1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"c_1_1_1"
argument_list|)
expr_stmt|;
name|c_1_2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"c_1_2"
argument_list|)
expr_stmt|;
name|c_2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"c_2"
argument_list|)
expr_stmt|;
name|c_2_1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"c_2_1"
argument_list|)
expr_stmt|;
name|c_2_1_1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"c_2_1_1"
argument_list|)
expr_stmt|;
name|c_2_2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"c_2_2"
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|t_1
argument_list|)
expr_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|scene
operator|.
name|items
argument_list|()
control|)
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
comment|// QGraphicsView view(&scene);
comment|// view.setDragMode(QGraphicsView::RubberBandDrag);
comment|// view.show();
name|qDebug
argument_list|()
operator|<<
literal|"items: {"
expr_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|scene
operator|.
name|items
argument_list|(
literal|32
argument_list|,
literal|31
argument_list|,
literal|4
argument_list|,
literal|55
argument_list|)
control|)
name|qDebug
argument_list|()
operator|<<
literal|"\t"
operator|<<
name|item
operator|->
name|data
argument_list|(
literal|0
argument_list|)
operator|.
name|toString
argument_list|()
expr_stmt|;
name|qDebug
argument_list|()
operator|<<
literal|"}"
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
literal|32
argument_list|,
literal|31
argument_list|,
literal|4
argument_list|,
literal|55
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|c_1_2
operator|<<
name|c_1_1_1
operator|<<
name|c_1
operator|<<
name|t_1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
operator|-
literal|53
argument_list|,
literal|47
argument_list|,
literal|136
argument_list|,
literal|3
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|c_2_2
operator|<<
name|c_2_1
operator|<<
name|c_2
operator|<<
name|c_1_2
operator|<<
name|c_1_1
operator|<<
name|c_1
operator|<<
name|t_1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
operator|-
literal|23
argument_list|,
literal|79
argument_list|,
literal|104
argument_list|,
literal|3
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|c_2_1_1
operator|<<
name|c_1_1_1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
operator|-
literal|26
argument_list|,
operator|-
literal|3
argument_list|,
literal|92
argument_list|,
literal|79
argument_list|)
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|c_2_2
operator|<<
name|c_2_1_1
operator|<<
name|c_2_1
operator|<<
name|c_2
operator|<<
name|c_1_2
operator|<<
name|c_1_1_1
operator|<<
name|c_1_1
operator|<<
name|c_1
operator|<<
name|t_1
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|ChangedListener
class|class
name|ChangedListener
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
public|public:
DECL|member|changes
name|QList
argument_list|<
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|>
name|changes
decl_stmt|;
public|public
name|slots
public|:
DECL|function|changed
name|void
name|changed
parameter_list|(
specifier|const
name|QList
argument_list|<
name|QRectF
argument_list|>
modifier|&
name|dirty
parameter_list|)
block|{
name|changes
operator|<<
name|dirty
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|changedSignal_data
name|void
name|tst_QGraphicsScene
operator|::
name|changedSignal_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"withView"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"without view"
argument_list|)
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"with view"
argument_list|)
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_function
DECL|function|changedSignal
name|void
name|tst_QGraphicsScene
operator|::
name|changedSignal
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|withView
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|ChangedListener
name|cl
decl_stmt|;
name|connect
argument_list|(
operator|&
name|scene
argument_list|,
name|SIGNAL
argument_list|(
name|changed
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|)
argument_list|)
argument_list|,
operator|&
name|cl
argument_list|,
name|SLOT
argument_list|(
name|changed
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsView
modifier|*
name|view
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|withView
condition|)
name|view
operator|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|rect
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|cl
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|cl
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|cl
operator|.
name|changes
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|cl
operator|.
name|changes
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setPos
argument_list|(
literal|20
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|cl
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|cl
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|cl
operator|.
name|changes
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|cl
operator|.
name|changes
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|.
name|first
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|cl
operator|.
name|changes
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|.
name|last
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|20
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|30
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|withView
condition|)
operator|delete
name|view
expr_stmt|;
block|}
end_function
begin_function
DECL|function|stickyFocus_data
name|void
name|tst_QGraphicsScene
operator|::
name|stickyFocus_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"sticky"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"sticky"
argument_list|)
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"not sticky"
argument_list|)
operator|<<
literal|false
expr_stmt|;
block|}
end_function
begin_function
DECL|function|stickyFocus
name|void
name|tst_QGraphicsScene
operator|::
name|stickyFocus
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|sticky
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|QGraphicsTextItem
modifier|*
name|text
init|=
name|scene
operator|.
name|addText
argument_list|(
literal|"Hei"
argument_list|)
decl_stmt|;
name|text
operator|->
name|setTextInteractionFlags
argument_list|(
name|Qt
operator|::
name|TextEditorInteraction
argument_list|)
expr_stmt|;
name|text
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|scene
operator|.
name|setStickyFocus
argument_list|(
name|sticky
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
expr_stmt|;
comment|// outside item
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|->
name|hasFocus
argument_list|()
argument_list|,
name|sticky
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sendEvent
name|void
name|tst_QGraphicsScene
operator|::
name|sendEvent
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsTextItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addText
argument_list|(
name|QString
argument_list|()
argument_list|)
decl_stmt|;
name|EventSpy
modifier|*
name|spy
init|=
operator|new
name|EventSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|item
argument_list|,
name|QEvent
operator|::
name|User
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|->
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QEvent
name|event
argument_list|(
name|QEvent
operator|::
name|User
argument_list|)
decl_stmt|;
name|scene
operator|.
name|sendEvent
argument_list|(
name|item
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|->
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|inputMethod_data
name|void
name|tst_QGraphicsScene
operator|::
name|inputMethod_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"flags"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"callFocusItem"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"0"
argument_list|)
operator|<<
literal|0
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"1"
argument_list|)
operator|<<
operator|(
name|int
operator|)
name|QGraphicsItem
operator|::
name|ItemAcceptsInputMethod
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"2"
argument_list|)
operator|<<
operator|(
name|int
operator|)
name|QGraphicsItem
operator|::
name|ItemIsFocusable
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"3"
argument_list|)
operator|<<
call|(
name|int
call|)
argument_list|(
name|QGraphicsItem
operator|::
name|ItemAcceptsInputMethod
operator||
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_class
DECL|class|InputMethodTester
class|class
name|InputMethodTester
super|:
specifier|public
name|QGraphicsRectItem
block|{
DECL|function|inputMethodEvent
name|void
name|inputMethodEvent
parameter_list|(
name|QInputMethodEvent
modifier|*
parameter_list|)
block|{
operator|++
name|eventCalls
expr_stmt|;
block|}
DECL|function|inputMethodQuery
name|QVariant
name|inputMethodQuery
parameter_list|(
name|Qt
operator|::
name|InputMethodQuery
parameter_list|)
specifier|const
block|{
operator|++
name|queryCalls
expr_stmt|;
return|return
name|QVariant
argument_list|()
return|;
block|}
public|public:
DECL|member|eventCalls
name|int
name|eventCalls
decl_stmt|;
DECL|member|queryCalls
specifier|mutable
name|int
name|queryCalls
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|inputMethod
name|void
name|tst_QGraphicsScene
operator|::
name|inputMethod
parameter_list|()
block|{
name|PlatformInputContext
name|inputContext
decl_stmt|;
name|QInputMethodPrivate
modifier|*
name|inputMethodPrivate
init|=
name|QInputMethodPrivate
operator|::
name|get
argument_list|(
name|qApp
operator|->
name|inputMethod
argument_list|()
argument_list|)
decl_stmt|;
name|inputMethodPrivate
operator|->
name|testContext
operator|=
operator|&
name|inputContext
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|flags
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|callFocusItem
argument_list|)
expr_stmt|;
name|InputMethodTester
modifier|*
name|item
init|=
operator|new
name|InputMethodTester
decl_stmt|;
name|item
operator|->
name|setFlags
argument_list|(
operator|(
name|QGraphicsItem
operator|::
name|GraphicsItemFlags
operator|)
name|flags
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|inputContext
operator|.
name|m_resetCallCount
operator|=
literal|0
expr_stmt|;
name|inputContext
operator|.
name|m_commitCallCount
operator|=
literal|0
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QInputMethodEvent
name|event
decl_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
operator|!
operator|!
operator|(
name|item
operator|->
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemIsFocusable
operator|)
argument_list|,
name|scene
operator|.
name|focusItem
argument_list|()
operator|==
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|inputContext
operator|.
name|m_resetCallCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|item
operator|->
name|eventCalls
operator|=
literal|0
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventCalls
argument_list|,
name|callFocusItem
condition|?
literal|1
else|:
literal|0
argument_list|)
expr_stmt|;
name|item
operator|->
name|queryCalls
operator|=
literal|0
expr_stmt|;
name|scene
operator|.
name|inputMethodQuery
argument_list|(
operator|(
name|Qt
operator|::
name|InputMethodQuery
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|queryCalls
argument_list|,
name|callFocusItem
condition|?
literal|1
else|:
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocusItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|// the input context is reset twice, once because an item has lost focus and again because
comment|// the Qt::WA_InputMethodEnabled flag is cleared because no item has focus.
name|QCOMPARE
argument_list|(
name|inputContext
operator|.
name|m_resetCallCount
operator|+
name|inputContext
operator|.
name|m_commitCallCount
argument_list|,
name|callFocusItem
condition|?
literal|2
else|:
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|queryCalls
argument_list|,
name|callFocusItem
condition|?
literal|1
else|:
literal|0
argument_list|)
expr_stmt|;
comment|// verify that value is unaffected
name|item
operator|->
name|eventCalls
operator|=
literal|0
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|eventCalls
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|item
operator|->
name|queryCalls
operator|=
literal|0
expr_stmt|;
name|scene
operator|.
name|inputMethodQuery
argument_list|(
operator|(
name|Qt
operator|::
name|InputMethodQuery
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|queryCalls
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|dispatchHoverOnPress
name|void
name|tst_QGraphicsScene
operator|::
name|dispatchHoverOnPress
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|EventTester
modifier|*
name|tester1
init|=
operator|new
name|EventTester
decl_stmt|;
name|tester1
operator|->
name|setAcceptHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|EventTester
modifier|*
name|tester2
init|=
operator|new
name|EventTester
decl_stmt|;
name|tester2
operator|->
name|setAcceptHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|tester2
operator|->
name|setPos
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|tester1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|tester2
argument_list|)
expr_stmt|;
name|tester1
operator|->
name|eventTypes
operator|.
name|clear
argument_list|()
expr_stmt|;
name|tester2
operator|->
name|eventTypes
operator|.
name|clear
argument_list|()
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|me
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|me
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|me
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|me2
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|me2
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|me
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|me2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester1
operator|->
name|eventTypes
argument_list|,
name|QList
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|>
argument_list|()
operator|<<
name|QEvent
operator|::
name|GraphicsSceneHoverEnter
operator|<<
name|QEvent
operator|::
name|GraphicsSceneHoverMove
operator|<<
name|QEvent
operator|::
name|GrabMouse
operator|<<
name|QEvent
operator|::
name|GraphicsSceneMousePress
operator|<<
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
expr_stmt|;
name|tester1
operator|->
name|eventTypes
operator|.
name|clear
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|me
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|me2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester1
operator|->
name|eventTypes
argument_list|,
name|QList
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|>
argument_list|()
operator|<<
name|QEvent
operator|::
name|GraphicsSceneHoverMove
operator|<<
name|QEvent
operator|::
name|GrabMouse
operator|<<
name|QEvent
operator|::
name|GraphicsSceneMousePress
operator|<<
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
expr_stmt|;
block|}
block|{
name|QGraphicsSceneMouseEvent
name|me
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|me
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|)
argument_list|)
expr_stmt|;
name|me
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|me
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|me2
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|me2
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|)
argument_list|)
expr_stmt|;
name|me2
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|tester1
operator|->
name|eventTypes
operator|.
name|clear
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|me
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|me2
argument_list|)
expr_stmt|;
name|qDebug
argument_list|()
operator|<<
name|tester1
operator|->
name|eventTypes
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester1
operator|->
name|eventTypes
argument_list|,
name|QList
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|>
argument_list|()
operator|<<
name|QEvent
operator|::
name|GraphicsSceneHoverLeave
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester2
operator|->
name|eventTypes
argument_list|,
name|QList
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|>
argument_list|()
operator|<<
name|QEvent
operator|::
name|GraphicsSceneHoverEnter
operator|<<
name|QEvent
operator|::
name|GraphicsSceneHoverMove
operator|<<
name|QEvent
operator|::
name|GrabMouse
operator|<<
name|QEvent
operator|::
name|GraphicsSceneMousePress
operator|<<
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
expr_stmt|;
name|tester2
operator|->
name|eventTypes
operator|.
name|clear
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|me
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|me2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester2
operator|->
name|eventTypes
argument_list|,
name|QList
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|>
argument_list|()
operator|<<
name|QEvent
operator|::
name|GraphicsSceneHoverMove
operator|<<
name|QEvent
operator|::
name|GrabMouse
operator|<<
name|QEvent
operator|::
name|GraphicsSceneMousePress
operator|<<
name|QEvent
operator|::
name|UngrabMouse
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|initialFocus_data
name|void
name|tst_QGraphicsScene
operator|::
name|initialFocus_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"activeScene"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"explicitSetFocus"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"isPanel"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"shouldHaveFocus"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"inactive scene, normal item"
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"inactive scene, panel item"
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"inactive scene, normal item, explicit focus"
argument_list|)
operator|<<
literal|false
operator|<<
literal|true
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"inactive scene, panel, explicit focus"
argument_list|)
operator|<<
literal|false
operator|<<
literal|true
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"active scene, normal item"
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"active scene, panel item"
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
operator|<<
literal|true
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"active scene, normal item, explicit focus"
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
operator|<<
literal|false
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"active scene, panel, explicit focus"
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_function
DECL|function|initialFocus
name|void
name|tst_QGraphicsScene
operator|::
name|initialFocus
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|activeScene
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|explicitSetFocus
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|isPanel
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|shouldHaveFocus
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|rect
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|isPanel
condition|)
name|rect
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
comment|// Setting focus on an item before adding to the scene will ensure
comment|// it gets focus when the scene is activated.
if|if
condition|(
name|explicitSetFocus
condition|)
name|rect
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|activeScene
condition|)
block|{
name|QEvent
name|windowActivate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|windowActivate
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocus
argument_list|()
expr_stmt|;
block|}
name|scene
operator|.
name|addItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|activeScene
condition|)
block|{
name|QEvent
name|windowActivate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|windowActivate
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocus
argument_list|()
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|hasFocus
argument_list|()
argument_list|,
name|shouldHaveFocus
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|PolishItem
class|class
name|PolishItem
super|:
specifier|public
name|QGraphicsTextItem
block|{
public|public:
DECL|function|PolishItem
name|PolishItem
parameter_list|(
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsTextItem
argument_list|(
name|parent
argument_list|)
member_init_list|,
name|polished
argument_list|(
literal|false
argument_list|)
member_init_list|,
name|deleteChildrenInPolish
argument_list|(
literal|true
argument_list|)
member_init_list|,
name|addChildrenInPolish
argument_list|(
literal|false
argument_list|)
block|{ }
DECL|member|polished
name|bool
name|polished
decl_stmt|;
DECL|member|deleteChildrenInPolish
name|bool
name|deleteChildrenInPolish
decl_stmt|;
DECL|member|addChildrenInPolish
name|bool
name|addChildrenInPolish
decl_stmt|;
protected|protected:
DECL|function|itemChange
name|QVariant
name|itemChange
parameter_list|(
name|GraphicsItemChange
name|change
parameter_list|,
specifier|const
name|QVariant
modifier|&
name|value
parameter_list|)
block|{
if|if
condition|(
name|change
operator|==
name|ItemVisibleChange
condition|)
block|{
name|polished
operator|=
literal|true
expr_stmt|;
if|if
condition|(
name|deleteChildrenInPolish
condition|)
name|qDeleteAll
argument_list|(
name|childItems
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|addChildrenInPolish
condition|)
block|{
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
operator|++
name|i
control|)
operator|new
name|PolishItem
argument_list|(
name|this
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|QGraphicsItem
operator|::
name|itemChange
argument_list|(
name|change
argument_list|,
name|value
argument_list|)
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|polishItems
name|void
name|tst_QGraphicsScene
operator|::
name|polishItems
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|PolishItem
modifier|*
name|parent
init|=
operator|new
name|PolishItem
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|PolishItem
modifier|*
name|child
init|=
operator|new
name|PolishItem
argument_list|(
name|parent
argument_list|)
decl_stmt|;
name|Q_UNUSED
argument_list|(
argument|child
argument_list|)
comment|// test that QGraphicsScenePrivate::_q_polishItems() doesn't crash
name|QMetaObject
operator|::
name|invokeMethod
argument_list|(
operator|&
name|scene
argument_list|,
literal|"_q_polishItems"
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|polishItems2
name|void
name|tst_QGraphicsScene
operator|::
name|polishItems2
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|PolishItem
modifier|*
name|item
init|=
operator|new
name|PolishItem
decl_stmt|;
name|item
operator|->
name|addChildrenInPolish
operator|=
literal|true
expr_stmt|;
name|item
operator|->
name|deleteChildrenInPolish
operator|=
literal|true
expr_stmt|;
comment|// These children should be deleted in the polish.
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|20
condition|;
operator|++
name|i
control|)
operator|new
name|PolishItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
comment|// Wait for the polish event to be delivered.
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|polished
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendPostedEvents
argument_list|(
operator|&
name|scene
argument_list|,
name|QEvent
operator|::
name|MetaCall
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|polished
argument_list|)
expr_stmt|;
comment|// We deleted the children we added above, but we also
comment|// added 10 new children. These should be polished in the next
comment|// event loop iteration.
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|children
init|=
name|item
operator|->
name|childItems
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|children
operator|.
name|count
argument_list|()
argument_list|,
literal|10
argument_list|)
expr_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|child
decl|,
name|children
control|)
name|QVERIFY
argument_list|(
operator|!
cast|static_cast
argument_list|<
name|PolishItem
operator|*
argument_list|>
argument_list|(
name|child
argument_list|)
operator|->
name|polished
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendPostedEvents
argument_list|(
operator|&
name|scene
argument_list|,
name|QEvent
operator|::
name|MetaCall
argument_list|)
expr_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|child
decl|,
name|children
control|)
name|QVERIFY
argument_list|(
cast|static_cast
argument_list|<
name|PolishItem
operator|*
argument_list|>
argument_list|(
name|child
argument_list|)
operator|->
name|polished
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|isActive
name|void
name|tst_QGraphicsScene
operator|::
name|isActive
parameter_list|()
block|{
name|QGraphicsScene
name|scene1
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene2
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
block|{
name|QWidget
name|toplevel1
decl_stmt|;
name|QHBoxLayout
modifier|*
name|layout
init|=
operator|new
name|QHBoxLayout
decl_stmt|;
name|toplevel1
operator|.
name|setLayout
argument_list|(
name|layout
argument_list|)
expr_stmt|;
name|QGraphicsView
modifier|*
name|view1
init|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene1
argument_list|)
decl_stmt|;
name|QGraphicsView
modifier|*
name|view2
init|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene2
argument_list|)
decl_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|view1
argument_list|)
expr_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|view2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|view1
operator|->
name|setVisible
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|toplevel1
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|toplevel1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|toplevel1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
operator|&
name|toplevel1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
comment|//it is hidden;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|view1
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|view2
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|toplevel1
operator|.
name|hide
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|toplevel1
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|toplevel1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|toplevel1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
operator|&
name|toplevel1
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|view2
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|{
name|QWidget
name|toplevel2
decl_stmt|;
name|QHBoxLayout
modifier|*
name|layout
init|=
operator|new
name|QHBoxLayout
decl_stmt|;
name|toplevel2
operator|.
name|setLayout
argument_list|(
name|layout
argument_list|)
expr_stmt|;
name|QGraphicsView
modifier|*
name|view1
init|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene1
argument_list|)
decl_stmt|;
name|QGraphicsView
modifier|*
name|view2
init|=
operator|new
name|QGraphicsView
argument_list|()
decl_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|view1
argument_list|)
expr_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|view2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|toplevel2
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|toplevel2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|toplevel2
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
operator|&
name|toplevel2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|view2
operator|->
name|setScene
argument_list|(
operator|&
name|scene2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|view1
operator|->
name|setScene
argument_list|(
operator|&
name|scene2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|view1
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|view1
operator|->
name|setScene
argument_list|(
operator|&
name|scene1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|view1
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|view2
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsView
name|topLevelView
decl_stmt|;
name|topLevelView
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|topLevelView
argument_list|)
expr_stmt|;
name|topLevelView
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|topLevelView
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
operator|&
name|topLevelView
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|topLevelView
operator|.
name|setScene
argument_list|(
operator|&
name|scene1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|view2
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|view1
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|toplevel2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|toplevel2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|{
name|QWidget
name|toplevel3
decl_stmt|;
name|QHBoxLayout
modifier|*
name|layout
init|=
operator|new
name|QHBoxLayout
decl_stmt|;
name|toplevel3
operator|.
name|setLayout
argument_list|(
name|layout
argument_list|)
expr_stmt|;
name|QGraphicsView
modifier|*
name|view1
init|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene1
argument_list|)
decl_stmt|;
name|QGraphicsView
modifier|*
name|view2
init|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene2
argument_list|)
decl_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|view1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|toplevel3
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|toplevel3
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|toplevel3
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
operator|&
name|toplevel3
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|view2
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|view1
operator|->
name|setParent
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
operator|delete
name|view1
expr_stmt|;
block|}
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene1
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene2
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|siblingIndexAlwaysValid
name|void
name|tst_QGraphicsScene
operator|::
name|siblingIndexAlwaysValid
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|parent
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|parent
operator|->
name|setZValue
argument_list|(
literal|350
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setGeometry
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|parent2
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|parent2
operator|->
name|setGeometry
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|QGraphicsWidget
modifier|*
name|child
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|parent2
argument_list|)
decl_stmt|;
name|child
operator|->
name|setGeometry
argument_list|(
literal|15
argument_list|,
literal|15
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|child
operator|->
name|setZValue
argument_list|(
literal|150
argument_list|)
expr_stmt|;
comment|//Both are top level
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent2
argument_list|)
expr_stmt|;
comment|//Then we make the child a top level
name|child
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|//This is trigerred by a repaint...
name|QGraphicsScenePrivate
operator|::
name|get
argument_list|(
operator|&
name|scene
argument_list|)
operator|->
name|index
operator|->
name|estimateTopLevelItems
argument_list|(
name|QRectF
argument_list|()
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
expr_stmt|;
operator|delete
name|child
expr_stmt|;
comment|//If there are in the list that's bad, we crash...
name|QVERIFY
argument_list|(
operator|!
name|QGraphicsScenePrivate
operator|::
name|get
argument_list|(
operator|&
name|scene
argument_list|)
operator|->
name|topLevelItems
operator|.
name|contains
argument_list|(
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|child
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|//Other case
name|QGraphicsScene
name|scene2
decl_stmt|;
comment|// works with bsp tree index
name|scene2
operator|.
name|setItemIndexMethod
argument_list|(
name|QGraphicsScene
operator|::
name|NoIndex
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view2
argument_list|(
operator|&
name|scene2
argument_list|)
decl_stmt|;
comment|// first add the blue rect
name|QGraphicsRectItem
modifier|*
specifier|const
name|item1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRect
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|blue
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
expr_stmt|;
name|scene2
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
comment|// then add the red rect
name|QGraphicsRectItem
modifier|*
specifier|const
name|item2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|item2
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|red
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|scene2
operator|.
name|addItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
comment|// now the blue one is visible on top of the red one -> swap them (important for the bug)
name|item1
operator|->
name|setZValue
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setZValue
argument_list|(
literal|0.0
argument_list|)
expr_stmt|;
name|view2
operator|.
name|show
argument_list|()
expr_stmt|;
comment|// handle events as a real life app would do
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
comment|// now delete the red rect
operator|delete
name|item2
expr_stmt|;
comment|// handle events as a real life app would do
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
comment|//We should not crash
block|}
end_function
begin_function
DECL|function|removeFullyTransparentItem
name|void
name|tst_QGraphicsScene
operator|::
name|removeFullyTransparentItem
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|parent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemHasNoContents
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|child
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|CustomView
name|view
decl_stmt|;
name|view
operator|.
name|setScene
argument_list|(
operator|&
name|scene
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
comment|// NB! The parent has the ItemHasNoContents flag set, which means
comment|// the parent itself doesn't generate any update requests, only the
comment|// child can possibly trigger an update. Also note that the child
comment|// is removed before processing events.
name|view
operator|.
name|repaints
operator|=
literal|0
expr_stmt|;
name|parent
operator|->
name|setOpacity
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qFuzzyIsNull
argument_list|(
name|child
operator|->
name|effectiveOpacity
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|items
argument_list|()
operator|.
name|contains
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
comment|// Re-add child. There's nothing new to display (child is still
comment|// effectively hidden), so it shouldn't trigger an update.
name|view
operator|.
name|repaints
operator|=
literal|0
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|()
operator|.
name|contains
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qFuzzyIsNull
argument_list|(
name|child
operator|->
name|effectiveOpacity
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Nothing is visible on the screen, removing child item shouldn't trigger an update.
name|scene
operator|.
name|removeItem
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|delete
name|child
expr_stmt|;
block|}
end_function
begin_function
DECL|function|taskQTBUG_5904_crashWithDeviceCoordinateCache
name|void
name|tst_QGraphicsScene
operator|::
name|taskQTBUG_5904_crashWithDeviceCoordinateCache
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rectItem
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|200
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
argument_list|)
decl_stmt|;
name|rectItem
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|DeviceCoordinateCache
argument_list|)
expr_stmt|;
name|QPixmap
name|pixmap
argument_list|(
literal|100
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|QPainter
name|painter
argument_list|(
operator|&
name|pixmap
argument_list|)
decl_stmt|;
name|painter
operator|.
name|setRenderHint
argument_list|(
name|QPainter
operator|::
name|Antialiasing
argument_list|)
expr_stmt|;
name|scene
operator|.
name|render
argument_list|(
operator|&
name|painter
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
comment|// No crash, then it passed!
block|}
end_function
begin_function
DECL|function|taskQT657_paintIntoCacheWithTransparentParts
name|void
name|tst_QGraphicsScene
operator|::
name|taskQT657_paintIntoCacheWithTransparentParts
parameter_list|()
block|{
comment|// Test using DeviceCoordinateCache and opaque item
name|QWidget
modifier|*
name|w
init|=
operator|new
name|QWidget
argument_list|()
decl_stmt|;
name|w
operator|->
name|setPalette
argument_list|(
name|QColor
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
argument_list|)
expr_stmt|;
name|w
operator|->
name|setGeometry
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|QGraphicsScene
modifier|*
name|scene
init|=
operator|new
name|QGraphicsScene
argument_list|()
decl_stmt|;
name|CustomView
modifier|*
name|view
init|=
operator|new
name|CustomView
decl_stmt|;
name|view
operator|->
name|setScene
argument_list|(
name|scene
argument_list|)
expr_stmt|;
name|QGraphicsProxyWidget
modifier|*
name|proxy
init|=
name|scene
operator|->
name|addWidget
argument_list|(
name|w
argument_list|)
decl_stmt|;
name|proxy
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|DeviceCoordinateCache
argument_list|)
expr_stmt|;
name|proxy
operator|->
name|rotate
argument_list|(
literal|15
argument_list|)
expr_stmt|;
name|view
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
name|proxy
operator|->
name|update
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|->
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|QPixmap
name|pix
decl_stmt|;
name|QGraphicsItemPrivate
modifier|*
name|itemp
init|=
name|QGraphicsItemPrivate
operator|::
name|get
argument_list|(
name|proxy
argument_list|)
decl_stmt|;
name|QTRY_VERIFY
argument_list|(
name|QPixmapCache
operator|::
name|find
argument_list|(
name|itemp
operator|->
name|extraItemCache
argument_list|()
operator|->
name|deviceData
operator|.
name|value
argument_list|(
name|view
operator|->
name|viewport
argument_list|()
argument_list|)
operator|.
name|key
argument_list|,
operator|&
name|pix
argument_list|)
argument_list|)
expr_stmt|;
name|QTransform
name|t
init|=
name|proxy
operator|->
name|sceneTransform
argument_list|()
decl_stmt|;
comment|// Map from scene coordinates to pixmap coordinates.
comment|// X origin in the pixmap is the most-left point
comment|// of the item's boundingRect in the scene.
name|qreal
name|adjust
init|=
name|t
operator|.
name|mapRect
argument_list|(
name|proxy
operator|->
name|boundingRect
argument_list|()
operator|.
name|toRect
argument_list|()
argument_list|)
operator|.
name|left
argument_list|()
decl_stmt|;
name|QRect
name|rect
init|=
name|t
operator|.
name|mapRect
argument_list|(
name|QRect
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
operator|.
name|adjusted
argument_list|(
operator|-
name|adjust
argument_list|,
literal|0
argument_list|,
operator|-
name|adjust
operator|+
literal|1
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|QPixmap
name|subpix
init|=
name|pix
operator|.
name|copy
argument_list|(
name|rect
argument_list|)
decl_stmt|;
name|QImage
name|im
init|=
name|subpix
operator|.
name|toImage
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|im
operator|.
name|width
argument_list|()
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|im
operator|.
name|height
argument_list|()
condition|;
name|j
operator|++
control|)
name|QCOMPARE
argument_list|(
name|qAlpha
argument_list|(
name|im
operator|.
name|pixel
argument_list|(
name|i
argument_list|,
name|j
argument_list|)
argument_list|)
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
operator|delete
name|w
expr_stmt|;
block|}
end_function
begin_function
DECL|function|taskQTBUG_7863_paintIntoCacheWithTransparentParts
name|void
name|tst_QGraphicsScene
operator|::
name|taskQTBUG_7863_paintIntoCacheWithTransparentParts
parameter_list|()
block|{
comment|// Test using DeviceCoordinateCache and semi-transparent item
block|{
name|QGraphicsRectItem
modifier|*
name|backItem
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|backItem
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
literal|255
argument_list|,
literal|255
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rectItem
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|rectItem
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|,
literal|125
argument_list|)
argument_list|)
expr_stmt|;
name|rectItem
operator|->
name|setParentItem
argument_list|(
name|backItem
argument_list|)
expr_stmt|;
name|QGraphicsScene
modifier|*
name|scene
init|=
operator|new
name|QGraphicsScene
argument_list|()
decl_stmt|;
name|CustomView
modifier|*
name|view
init|=
operator|new
name|CustomView
decl_stmt|;
name|view
operator|->
name|setScene
argument_list|(
name|scene
argument_list|)
expr_stmt|;
name|scene
operator|->
name|addItem
argument_list|(
name|backItem
argument_list|)
expr_stmt|;
name|rectItem
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|DeviceCoordinateCache
argument_list|)
expr_stmt|;
name|backItem
operator|->
name|rotate
argument_list|(
literal|15
argument_list|)
expr_stmt|;
name|view
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
name|rectItem
operator|->
name|update
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|->
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|QPixmap
name|pix
decl_stmt|;
name|QGraphicsItemPrivate
modifier|*
name|itemp
init|=
name|QGraphicsItemPrivate
operator|::
name|get
argument_list|(
name|rectItem
argument_list|)
decl_stmt|;
name|QTRY_VERIFY
argument_list|(
name|QPixmapCache
operator|::
name|find
argument_list|(
name|itemp
operator|->
name|extraItemCache
argument_list|()
operator|->
name|deviceData
operator|.
name|value
argument_list|(
name|view
operator|->
name|viewport
argument_list|()
argument_list|)
operator|.
name|key
argument_list|,
operator|&
name|pix
argument_list|)
argument_list|)
expr_stmt|;
name|QTransform
name|t
init|=
name|rectItem
operator|->
name|sceneTransform
argument_list|()
decl_stmt|;
comment|// Map from scene coordinates to pixmap coordinates.
comment|// X origin in the pixmap is the most-left point
comment|// of the item's boundingRect in the scene.
name|qreal
name|adjust
init|=
name|t
operator|.
name|mapRect
argument_list|(
name|rectItem
operator|->
name|boundingRect
argument_list|()
operator|.
name|toRect
argument_list|()
argument_list|)
operator|.
name|left
argument_list|()
decl_stmt|;
name|QRect
name|rect
init|=
name|t
operator|.
name|mapRect
argument_list|(
name|QRect
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
operator|.
name|adjusted
argument_list|(
operator|-
name|adjust
argument_list|,
literal|0
argument_list|,
operator|-
name|adjust
operator|+
literal|1
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|QPixmap
name|subpix
init|=
name|pix
operator|.
name|copy
argument_list|(
name|rect
argument_list|)
decl_stmt|;
name|QImage
name|im
init|=
name|subpix
operator|.
name|toImage
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|im
operator|.
name|width
argument_list|()
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|im
operator|.
name|height
argument_list|()
condition|;
name|j
operator|++
control|)
block|{
name|QCOMPARE
argument_list|(
name|qAlpha
argument_list|(
name|im
operator|.
name|pixel
argument_list|(
name|i
argument_list|,
name|j
argument_list|)
argument_list|)
argument_list|,
literal|125
argument_list|)
expr_stmt|;
block|}
block|}
operator|delete
name|view
expr_stmt|;
block|}
comment|// Test using ItemCoordinateCache and opaque item
block|{
name|QGraphicsRectItem
modifier|*
name|rectItem
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|rectItem
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsScene
modifier|*
name|scene
init|=
operator|new
name|QGraphicsScene
argument_list|()
decl_stmt|;
name|CustomView
modifier|*
name|view
init|=
operator|new
name|CustomView
decl_stmt|;
name|view
operator|->
name|setScene
argument_list|(
name|scene
argument_list|)
expr_stmt|;
name|scene
operator|->
name|addItem
argument_list|(
name|rectItem
argument_list|)
expr_stmt|;
name|rectItem
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|ItemCoordinateCache
argument_list|)
expr_stmt|;
name|rectItem
operator|->
name|rotate
argument_list|(
literal|15
argument_list|)
expr_stmt|;
name|view
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
name|rectItem
operator|->
name|update
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|->
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|QPixmap
name|pix
decl_stmt|;
name|QGraphicsItemPrivate
modifier|*
name|itemp
init|=
name|QGraphicsItemPrivate
operator|::
name|get
argument_list|(
name|rectItem
argument_list|)
decl_stmt|;
name|QTRY_VERIFY
argument_list|(
name|QPixmapCache
operator|::
name|find
argument_list|(
name|itemp
operator|->
name|extraItemCache
argument_list|()
operator|->
name|key
argument_list|,
operator|&
name|pix
argument_list|)
argument_list|)
expr_stmt|;
name|QTransform
name|t
init|=
name|rectItem
operator|->
name|sceneTransform
argument_list|()
decl_stmt|;
comment|// Map from scene coordinates to pixmap coordinates.
comment|// X origin in the pixmap is the most-left point
comment|// of the item's boundingRect in the scene.
name|qreal
name|adjust
init|=
name|t
operator|.
name|mapRect
argument_list|(
name|rectItem
operator|->
name|boundingRect
argument_list|()
operator|.
name|toRect
argument_list|()
argument_list|)
operator|.
name|left
argument_list|()
decl_stmt|;
name|QRect
name|rect
init|=
name|t
operator|.
name|mapRect
argument_list|(
name|QRect
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
operator|.
name|adjusted
argument_list|(
operator|-
name|adjust
argument_list|,
literal|0
argument_list|,
operator|-
name|adjust
operator|+
literal|1
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|QPixmap
name|subpix
init|=
name|pix
operator|.
name|copy
argument_list|(
name|rect
argument_list|)
decl_stmt|;
name|QImage
name|im
init|=
name|subpix
operator|.
name|toImage
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|im
operator|.
name|width
argument_list|()
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|im
operator|.
name|height
argument_list|()
condition|;
name|j
operator|++
control|)
name|QCOMPARE
argument_list|(
name|qAlpha
argument_list|(
name|im
operator|.
name|pixel
argument_list|(
name|i
argument_list|,
name|j
argument_list|)
argument_list|)
argument_list|,
literal|255
argument_list|)
expr_stmt|;
block|}
operator|delete
name|view
expr_stmt|;
block|}
comment|// Test using ItemCoordinateCache and semi-transparent item
block|{
name|QGraphicsRectItem
modifier|*
name|rectItem
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|rectItem
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|,
literal|125
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsScene
modifier|*
name|scene
init|=
operator|new
name|QGraphicsScene
argument_list|()
decl_stmt|;
name|CustomView
modifier|*
name|view
init|=
operator|new
name|CustomView
decl_stmt|;
name|view
operator|->
name|setScene
argument_list|(
name|scene
argument_list|)
expr_stmt|;
name|scene
operator|->
name|addItem
argument_list|(
name|rectItem
argument_list|)
expr_stmt|;
name|rectItem
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|ItemCoordinateCache
argument_list|)
expr_stmt|;
name|rectItem
operator|->
name|rotate
argument_list|(
literal|15
argument_list|)
expr_stmt|;
name|view
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
name|rectItem
operator|->
name|update
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|->
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|QPixmap
name|pix
decl_stmt|;
name|QGraphicsItemPrivate
modifier|*
name|itemp
init|=
name|QGraphicsItemPrivate
operator|::
name|get
argument_list|(
name|rectItem
argument_list|)
decl_stmt|;
name|QTRY_VERIFY
argument_list|(
name|QPixmapCache
operator|::
name|find
argument_list|(
name|itemp
operator|->
name|extraItemCache
argument_list|()
operator|->
name|key
argument_list|,
operator|&
name|pix
argument_list|)
argument_list|)
expr_stmt|;
name|QTransform
name|t
init|=
name|rectItem
operator|->
name|sceneTransform
argument_list|()
decl_stmt|;
comment|// Map from scene coordinates to pixmap coordinates.
comment|// X origin in the pixmap is the most-left point
comment|// of the item's boundingRect in the scene.
name|qreal
name|adjust
init|=
name|t
operator|.
name|mapRect
argument_list|(
name|rectItem
operator|->
name|boundingRect
argument_list|()
operator|.
name|toRect
argument_list|()
argument_list|)
operator|.
name|left
argument_list|()
decl_stmt|;
name|QRect
name|rect
init|=
name|t
operator|.
name|mapRect
argument_list|(
name|QRect
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
operator|.
name|adjusted
argument_list|(
operator|-
name|adjust
argument_list|,
literal|0
argument_list|,
operator|-
name|adjust
operator|+
literal|1
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|QPixmap
name|subpix
init|=
name|pix
operator|.
name|copy
argument_list|(
name|rect
argument_list|)
decl_stmt|;
name|QImage
name|im
init|=
name|subpix
operator|.
name|toImage
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|im
operator|.
name|width
argument_list|()
condition|;
name|i
operator|++
control|)
block|{
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|im
operator|.
name|height
argument_list|()
condition|;
name|j
operator|++
control|)
name|QCOMPARE
argument_list|(
name|qAlpha
argument_list|(
name|im
operator|.
name|pixel
argument_list|(
name|i
argument_list|,
name|j
argument_list|)
argument_list|)
argument_list|,
literal|125
argument_list|)
expr_stmt|;
block|}
operator|delete
name|view
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|taskQT_3674_doNotCrash
name|void
name|tst_QGraphicsScene
operator|::
name|taskQT_3674_doNotCrash
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QPixmap
name|pixmap
argument_list|(
name|view
operator|.
name|size
argument_list|()
argument_list|)
decl_stmt|;
name|QPainter
name|painter
argument_list|(
operator|&
name|pixmap
argument_list|)
decl_stmt|;
name|view
operator|.
name|render
argument_list|(
operator|&
name|painter
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|new
name|QGraphicsWidget
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setBackgroundBrush
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|zeroScale
name|void
name|tst_QGraphicsScene
operator|::
name|zeroScale
parameter_list|()
block|{
comment|//should not crash
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|ChangedListener
name|cl
decl_stmt|;
name|connect
argument_list|(
operator|&
name|scene
argument_list|,
name|SIGNAL
argument_list|(
name|changed
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|)
argument_list|)
argument_list|,
operator|&
name|cl
argument_list|,
name|SLOT
argument_list|(
name|changed
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|0.0000001
argument_list|,
literal|0.00000001
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect1
argument_list|)
expr_stmt|;
name|rect1
operator|->
name|setRotation
argument_list|(
literal|82
argument_list|)
expr_stmt|;
name|rect1
operator|->
name|setScale
argument_list|(
literal|0.00000001
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|cl
operator|.
name|changes
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
operator|-
literal|0.0000001
argument_list|,
operator|-
literal|0.0000001
argument_list|,
literal|0.0000001
argument_list|,
literal|0.0000001
argument_list|)
decl_stmt|;
name|rect2
operator|->
name|setScale
argument_list|(
literal|0.00000001
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|rect1
operator|->
name|setPos
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|cl
operator|.
name|changes
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|taskQTBUG_15977_renderWithDeviceCoordinateCache
name|void
name|tst_QGraphicsScene
operator|::
name|taskQTBUG_15977_renderWithDeviceCoordinateCache
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rect
operator|->
name|setPen
argument_list|(
name|Qt
operator|::
name|NoPen
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|DeviceCoordinateCache
argument_list|)
expr_stmt|;
name|QImage
name|image
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|,
name|QImage
operator|::
name|Format_RGB32
argument_list|)
decl_stmt|;
name|QPainter
name|p
argument_list|(
operator|&
name|image
argument_list|)
decl_stmt|;
name|scene
operator|.
name|render
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|p
operator|.
name|end
argument_list|()
expr_stmt|;
name|QImage
name|expected
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|,
name|QImage
operator|::
name|Format_RGB32
argument_list|)
decl_stmt|;
name|p
operator|.
name|begin
argument_list|(
operator|&
name|expected
argument_list|)
expr_stmt|;
name|p
operator|.
name|fillRect
argument_list|(
name|expected
operator|.
name|rect
argument_list|()
argument_list|,
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|p
operator|.
name|end
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
argument_list|,
name|expected
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|taskQTBUG_16401_focusItem
name|void
name|tst_QGraphicsScene
operator|::
name|taskQTBUG_16401_focusItem
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rect
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
name|rect
argument_list|)
expr_stmt|;
name|QFocusEvent
name|focusOut
argument_list|(
name|QEvent
operator|::
name|FocusOut
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|view
argument_list|,
operator|&
name|focusOut
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|QFocusEvent
name|focusIn
argument_list|(
name|QEvent
operator|::
name|FocusIn
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|view
argument_list|,
operator|&
name|focusIn
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
name|rect
argument_list|)
expr_stmt|;
name|rect
operator|->
name|clearFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|view
argument_list|,
operator|&
name|focusOut
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|view
argument_list|,
operator|&
name|focusIn
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_macro
name|QTEST_MAIN
argument_list|(
argument|tst_QGraphicsScene
argument_list|)
end_macro
begin_include
include|#
directive|include
file|"tst_qgraphicsscene.moc"
end_include
end_unit
