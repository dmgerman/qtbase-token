begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2012 Digia Plc and/or its subsidiary(-ies). ** Contact: http://www.qt-project.org/legal ** ** This file is part of the test suite of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL$ ** Commercial License Usage ** Licensees holding valid commercial Qt licenses may use this file in ** accordance with the commercial license agreement provided with the ** Software or, alternatively, in accordance with the terms contained in ** a written agreement between you and Digia.  For licensing terms and ** conditions see http://qt.digia.com/licensing.  For further information ** use the contact form at http://qt.digia.com/contact-us. ** ** GNU Lesser General Public License Usage ** Alternatively, this file may be used under the terms of the GNU Lesser ** General Public License version 2.1 as published by the Free Software ** Foundation and appearing in the file LICENSE.LGPL included in the ** packaging of this file.  Please review the following information to ** ensure the GNU Lesser General Public License version 2.1 requirements ** will be met: http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html. ** ** In addition, as a special exception, Digia gives you certain additional ** rights.  These rights are described in the Digia Qt LGPL Exception ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package. ** ** GNU General Public License Usage ** Alternatively, this file may be used under the terms of the GNU ** General Public License version 3.0 as published by the Free Software ** Foundation and appearing in the file LICENSE.GPL included in the ** packaging of this file.  Please review the following information to ** ensure the GNU General Public License version 3.0 requirements will be ** met: http://www.gnu.org/copyleft/gpl.html. ** ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<QtTest/QtTest>
end_include
begin_include
include|#
directive|include
file|<private/qgraphicsitem_p.h>
end_include
begin_include
include|#
directive|include
file|<private/qgraphicsview_p.h>
end_include
begin_include
include|#
directive|include
file|<private/qgraphicsscene_p.h>
end_include
begin_include
include|#
directive|include
file|<QStyleOptionGraphicsItem>
end_include
begin_include
include|#
directive|include
file|<QAbstractTextDocumentLayout>
end_include
begin_include
include|#
directive|include
file|<QBitmap>
end_include
begin_include
include|#
directive|include
file|<QCursor>
end_include
begin_include
include|#
directive|include
file|<QLabel>
end_include
begin_include
include|#
directive|include
file|<QDial>
end_include
begin_include
include|#
directive|include
file|<QGraphicsItem>
end_include
begin_include
include|#
directive|include
file|<QGraphicsScene>
end_include
begin_include
include|#
directive|include
file|<QGraphicsSceneEvent>
end_include
begin_include
include|#
directive|include
file|<QGraphicsView>
end_include
begin_include
include|#
directive|include
file|<QGraphicsWidget>
end_include
begin_include
include|#
directive|include
file|<QGraphicsProxyWidget>
end_include
begin_include
include|#
directive|include
file|<QPainter>
end_include
begin_include
include|#
directive|include
file|<QScrollBar>
end_include
begin_include
include|#
directive|include
file|<QVBoxLayout>
end_include
begin_include
include|#
directive|include
file|<QGraphicsEffect>
end_include
begin_include
include|#
directive|include
file|<QPushButton>
end_include
begin_include
include|#
directive|include
file|<QLineEdit>
end_include
begin_include
include|#
directive|include
file|<QGraphicsLinearLayout>
end_include
begin_include
include|#
directive|include
file|<float.h>
end_include
begin_include
include|#
directive|include
file|<QStyleHints>
end_include
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QList<int>
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QList<QRectF>
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QPainterPath
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QPointF
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QRectF
argument_list|)
end_macro
begin_include
include|#
directive|include
file|"../../../qtest-config.h"
end_include
begin_if
if|#
directive|if
name|defined
argument_list|(
name|Q_OS_WIN
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
end_if
begin_include
include|#
directive|include
file|<windows.h>
end_include
begin_define
DECL|macro|Q_CHECK_PAINTEVENTS
define|#
directive|define
name|Q_CHECK_PAINTEVENTS
define|\
value|if (::SwitchDesktop(::GetThreadDesktop(::GetCurrentThreadId())) == 0) \         QSKIP("The Graphics View doesn't get the paint events");
end_define
begin_else
else|#
directive|else
end_else
begin_define
define|#
directive|define
name|Q_CHECK_PAINTEVENTS
end_define
begin_endif
endif|#
directive|endif
end_endif
begin_if
if|#
directive|if
name|defined
argument_list|(
name|Q_OS_MAC
argument_list|)
end_if
begin_comment
comment|// On mac (cocoa) we always get full update.
end_comment
begin_comment
comment|// So check that the expected region is contained inside the actual
end_comment
begin_define
DECL|macro|COMPARE_REGIONS
define|#
directive|define
name|COMPARE_REGIONS
parameter_list|(
name|ACTUAL
parameter_list|,
name|EXPECTED
parameter_list|)
value|QVERIFY((EXPECTED).subtracted(ACTUAL).isEmpty())
end_define
begin_else
else|#
directive|else
end_else
begin_define
define|#
directive|define
name|COMPARE_REGIONS
value|QTRY_COMPARE
end_define
begin_endif
endif|#
directive|endif
end_endif
begin_decl_stmt
DECL|variable|staticItem
specifier|static
name|QGraphicsRectItem
name|staticItem
decl_stmt|;
end_decl_stmt
begin_comment
DECL|variable|staticItem
comment|//QTBUG-7629, we should not crash at exit.
end_comment
begin_function
DECL|function|sendMousePress
specifier|static
name|void
name|sendMousePress
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|,
specifier|const
name|QPointF
modifier|&
name|point
parameter_list|,
name|Qt
operator|::
name|MouseButton
name|button
init|=
name|Qt
operator|::
name|LeftButton
parameter_list|)
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|point
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButtons
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sendMouseMove
specifier|static
name|void
name|sendMouseMove
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|,
specifier|const
name|QPointF
modifier|&
name|point
parameter_list|,
name|Qt
operator|::
name|MouseButton
name|button
init|=
name|Qt
operator|::
name|NoButton
parameter_list|,
name|Qt
operator|::
name|MouseButtons
comment|/* buttons */
init|=
literal|0
parameter_list|)
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|point
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButtons
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sendMouseRelease
specifier|static
name|void
name|sendMouseRelease
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|,
specifier|const
name|QPointF
modifier|&
name|point
parameter_list|,
name|Qt
operator|::
name|MouseButton
name|button
init|=
name|Qt
operator|::
name|LeftButton
parameter_list|)
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|point
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|button
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sendMouseClick
specifier|static
name|void
name|sendMouseClick
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|,
specifier|const
name|QPointF
modifier|&
name|point
parameter_list|,
name|Qt
operator|::
name|MouseButton
name|button
init|=
name|Qt
operator|::
name|LeftButton
parameter_list|)
block|{
name|sendMousePress
argument_list|(
name|scene
argument_list|,
name|point
argument_list|,
name|button
argument_list|)
expr_stmt|;
name|sendMouseRelease
argument_list|(
name|scene
argument_list|,
name|point
argument_list|,
name|button
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sendKeyPress
specifier|static
name|void
name|sendKeyPress
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|,
name|Qt
operator|::
name|Key
name|key
parameter_list|)
block|{
name|QKeyEvent
name|keyEvent
argument_list|(
name|QEvent
operator|::
name|KeyPress
argument_list|,
name|key
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|scene
argument_list|,
operator|&
name|keyEvent
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sendKeyRelease
specifier|static
name|void
name|sendKeyRelease
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|,
name|Qt
operator|::
name|Key
name|key
parameter_list|)
block|{
name|QKeyEvent
name|keyEvent
argument_list|(
name|QEvent
operator|::
name|KeyRelease
argument_list|,
name|key
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|scene
argument_list|,
operator|&
name|keyEvent
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sendKeyClick
specifier|static
name|void
name|sendKeyClick
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|,
name|Qt
operator|::
name|Key
name|key
parameter_list|)
block|{
name|sendKeyPress
argument_list|(
name|scene
argument_list|,
name|key
argument_list|)
expr_stmt|;
name|sendKeyRelease
argument_list|(
name|scene
argument_list|,
name|key
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|EventSpy
class|class
name|EventSpy
super|:
specifier|public
name|QGraphicsWidget
block|{
name|Q_OBJECT
public|public:
DECL|function|EventSpy
name|EventSpy
parameter_list|(
name|QObject
modifier|*
name|watched
parameter_list|,
name|QEvent
operator|::
name|Type
name|type
parameter_list|)
member_init_list|:
name|_count
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|spied
argument_list|(
name|type
argument_list|)
block|{
name|watched
operator|->
name|installEventFilter
argument_list|(
name|this
argument_list|)
expr_stmt|;
block|}
DECL|function|EventSpy
name|EventSpy
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|,
name|QGraphicsItem
modifier|*
name|watched
parameter_list|,
name|QEvent
operator|::
name|Type
name|type
parameter_list|)
member_init_list|:
name|_count
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|spied
argument_list|(
name|type
argument_list|)
block|{
name|scene
operator|->
name|addItem
argument_list|(
name|this
argument_list|)
expr_stmt|;
name|watched
operator|->
name|installSceneEventFilter
argument_list|(
name|this
argument_list|)
expr_stmt|;
block|}
DECL|function|count
name|int
name|count
parameter_list|()
specifier|const
block|{
return|return
name|_count
return|;
block|}
protected|protected:
DECL|function|eventFilter
name|bool
name|eventFilter
parameter_list|(
name|QObject
modifier|*
name|watched
parameter_list|,
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
name|Q_UNUSED
argument_list|(
name|watched
argument_list|)
expr_stmt|;
if|if
condition|(
name|event
operator|->
name|type
argument_list|()
operator|==
name|spied
condition|)
operator|++
name|_count
expr_stmt|;
return|return
literal|false
return|;
block|}
DECL|function|sceneEventFilter
name|bool
name|sceneEventFilter
parameter_list|(
name|QGraphicsItem
modifier|*
name|watched
parameter_list|,
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
name|Q_UNUSED
argument_list|(
name|watched
argument_list|)
expr_stmt|;
if|if
condition|(
name|event
operator|->
name|type
argument_list|()
operator|==
name|spied
condition|)
operator|++
name|_count
expr_stmt|;
return|return
literal|false
return|;
block|}
DECL|member|_count
name|int
name|_count
decl_stmt|;
DECL|member|spied
name|QEvent
operator|::
name|Type
name|spied
decl_stmt|;
block|}
class|;
end_class
begin_class
DECL|class|EventSpy2
class|class
name|EventSpy2
super|:
specifier|public
name|QGraphicsWidget
block|{
name|Q_OBJECT
public|public:
DECL|function|EventSpy2
name|EventSpy2
parameter_list|(
name|QObject
modifier|*
name|watched
parameter_list|)
block|{
name|watched
operator|->
name|installEventFilter
argument_list|(
name|this
argument_list|)
expr_stmt|;
block|}
DECL|function|EventSpy2
name|EventSpy2
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|,
name|QGraphicsItem
modifier|*
name|watched
parameter_list|)
block|{
name|scene
operator|->
name|addItem
argument_list|(
name|this
argument_list|)
expr_stmt|;
name|watched
operator|->
name|installSceneEventFilter
argument_list|(
name|this
argument_list|)
expr_stmt|;
block|}
DECL|member|counts
name|QMap
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|,
name|int
argument_list|>
name|counts
decl_stmt|;
protected|protected:
DECL|function|eventFilter
name|bool
name|eventFilter
parameter_list|(
name|QObject
modifier|*
name|watched
parameter_list|,
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
name|Q_UNUSED
argument_list|(
name|watched
argument_list|)
expr_stmt|;
operator|++
name|counts
index|[
name|event
operator|->
name|type
argument_list|()
index|]
expr_stmt|;
return|return
literal|false
return|;
block|}
DECL|function|sceneEventFilter
name|bool
name|sceneEventFilter
parameter_list|(
name|QGraphicsItem
modifier|*
name|watched
parameter_list|,
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
name|Q_UNUSED
argument_list|(
name|watched
argument_list|)
expr_stmt|;
operator|++
name|counts
index|[
name|event
operator|->
name|type
argument_list|()
index|]
expr_stmt|;
return|return
literal|false
return|;
block|}
block|}
class|;
end_class
begin_class
DECL|class|EventTester
class|class
name|EventTester
super|:
specifier|public
name|QGraphicsItem
block|{
public|public:
DECL|function|EventTester
name|EventTester
parameter_list|(
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsItem
argument_list|(
name|parent
argument_list|)
member_init_list|,
name|repaints
argument_list|(
literal|0
argument_list|)
block|{
name|br
operator|=
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
block|}
DECL|function|setGeometry
name|void
name|setGeometry
parameter_list|(
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|)
block|{
name|prepareGeometryChange
argument_list|()
expr_stmt|;
name|br
operator|=
name|rect
expr_stmt|;
name|update
argument_list|()
expr_stmt|;
block|}
DECL|function|boundingRect
name|QRectF
name|boundingRect
parameter_list|()
specifier|const
block|{
return|return
name|br
return|;
block|}
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|o
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
name|hints
operator|=
name|painter
operator|->
name|renderHints
argument_list|()
expr_stmt|;
name|painter
operator|->
name|setBrush
argument_list|(
name|brush
argument_list|)
expr_stmt|;
name|painter
operator|->
name|drawRect
argument_list|(
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
name|lastExposedRect
operator|=
name|o
operator|->
name|exposedRect
expr_stmt|;
operator|++
name|repaints
expr_stmt|;
block|}
DECL|function|sceneEvent
name|bool
name|sceneEvent
parameter_list|(
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
name|events
operator|<<
name|event
operator|->
name|type
argument_list|()
expr_stmt|;
return|return
name|QGraphicsItem
operator|::
name|sceneEvent
argument_list|(
name|event
argument_list|)
return|;
block|}
DECL|function|reset
name|void
name|reset
parameter_list|()
block|{
name|events
operator|.
name|clear
argument_list|()
expr_stmt|;
name|hints
operator|=
name|QPainter
operator|::
name|RenderHints
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|repaints
operator|=
literal|0
expr_stmt|;
name|lastExposedRect
operator|=
name|QRectF
argument_list|()
expr_stmt|;
block|}
DECL|member|events
name|QList
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|>
name|events
decl_stmt|;
DECL|member|hints
name|QPainter
operator|::
name|RenderHints
name|hints
decl_stmt|;
DECL|member|repaints
name|int
name|repaints
decl_stmt|;
DECL|member|br
name|QRectF
name|br
decl_stmt|;
DECL|member|lastExposedRect
name|QRectF
name|lastExposedRect
decl_stmt|;
DECL|member|brush
name|QBrush
name|brush
decl_stmt|;
block|}
class|;
end_class
begin_class
DECL|class|MyGraphicsView
class|class
name|MyGraphicsView
super|:
specifier|public
name|QGraphicsView
block|{
public|public:
DECL|member|repaints
name|int
name|repaints
decl_stmt|;
DECL|member|paintedRegion
name|QRegion
name|paintedRegion
decl_stmt|;
DECL|function|MyGraphicsView
name|MyGraphicsView
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|,
name|QWidget
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsView
argument_list|(
name|scene
argument_list|,
name|parent
argument_list|)
member_init_list|,
name|repaints
argument_list|(
literal|0
argument_list|)
block|{}
DECL|function|paintEvent
name|void
name|paintEvent
parameter_list|(
name|QPaintEvent
modifier|*
name|e
parameter_list|)
block|{
name|paintedRegion
operator|+=
name|e
operator|->
name|region
argument_list|()
expr_stmt|;
operator|++
name|repaints
expr_stmt|;
name|QGraphicsView
operator|::
name|paintEvent
argument_list|(
name|e
argument_list|)
expr_stmt|;
block|}
DECL|function|reset
name|void
name|reset
parameter_list|()
block|{
name|repaints
operator|=
literal|0
expr_stmt|;
name|paintedRegion
operator|=
name|QRegion
argument_list|()
expr_stmt|;
block|}
block|}
class|;
end_class
begin_class
DECL|class|tst_QGraphicsItem
class|class
name|tst_QGraphicsItem
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
public|public
name|slots
public|:
name|void
name|init
parameter_list|()
function_decl|;
private|private
name|slots
private|:
name|void
name|construction
parameter_list|()
function_decl|;
name|void
name|constructionWithParent
parameter_list|()
function_decl|;
name|void
name|destruction
parameter_list|()
function_decl|;
name|void
name|deleteChildItem
parameter_list|()
function_decl|;
name|void
name|scene
parameter_list|()
function_decl|;
name|void
name|parentItem
parameter_list|()
function_decl|;
name|void
name|setParentItem
parameter_list|()
function_decl|;
name|void
name|children
parameter_list|()
function_decl|;
name|void
name|flags
parameter_list|()
function_decl|;
name|void
name|inputMethodHints
parameter_list|()
function_decl|;
name|void
name|toolTip
parameter_list|()
function_decl|;
name|void
name|visible
parameter_list|()
function_decl|;
name|void
name|isVisibleTo
parameter_list|()
function_decl|;
name|void
name|explicitlyVisible
parameter_list|()
function_decl|;
name|void
name|enabled
parameter_list|()
function_decl|;
name|void
name|explicitlyEnabled
parameter_list|()
function_decl|;
name|void
name|selected
parameter_list|()
function_decl|;
name|void
name|selected2
parameter_list|()
function_decl|;
name|void
name|selected_group
parameter_list|()
function_decl|;
name|void
name|selected_textItem
parameter_list|()
function_decl|;
name|void
name|selected_multi
parameter_list|()
function_decl|;
name|void
name|acceptedMouseButtons
parameter_list|()
function_decl|;
name|void
name|acceptsHoverEvents
parameter_list|()
function_decl|;
name|void
name|childAcceptsHoverEvents
parameter_list|()
function_decl|;
name|void
name|hasFocus
parameter_list|()
function_decl|;
name|void
name|pos
parameter_list|()
function_decl|;
name|void
name|scenePos
parameter_list|()
function_decl|;
name|void
name|matrix
parameter_list|()
function_decl|;
name|void
name|sceneMatrix
parameter_list|()
function_decl|;
name|void
name|setMatrix
parameter_list|()
function_decl|;
name|void
name|zValue
parameter_list|()
function_decl|;
name|void
name|shape
parameter_list|()
function_decl|;
name|void
name|contains
parameter_list|()
function_decl|;
name|void
name|collidesWith_item
parameter_list|()
function_decl|;
name|void
name|collidesWith_path_data
parameter_list|()
function_decl|;
name|void
name|collidesWith_path
parameter_list|()
function_decl|;
name|void
name|collidesWithItemWithClip
parameter_list|()
function_decl|;
name|void
name|isObscuredBy
parameter_list|()
function_decl|;
name|void
name|isObscured
parameter_list|()
function_decl|;
name|void
name|mapFromToParent
parameter_list|()
function_decl|;
name|void
name|mapFromToScene
parameter_list|()
function_decl|;
name|void
name|mapFromToItem
parameter_list|()
function_decl|;
name|void
name|mapRectFromToParent_data
parameter_list|()
function_decl|;
name|void
name|mapRectFromToParent
parameter_list|()
function_decl|;
name|void
name|isAncestorOf
parameter_list|()
function_decl|;
name|void
name|commonAncestorItem
parameter_list|()
function_decl|;
name|void
name|data
parameter_list|()
function_decl|;
name|void
name|type
parameter_list|()
function_decl|;
name|void
name|graphicsitem_cast
parameter_list|()
function_decl|;
name|void
name|hoverEventsGenerateRepaints
parameter_list|()
function_decl|;
name|void
name|boundingRects_data
parameter_list|()
function_decl|;
name|void
name|boundingRects
parameter_list|()
function_decl|;
name|void
name|boundingRects2
parameter_list|()
function_decl|;
name|void
name|sceneBoundingRect
parameter_list|()
function_decl|;
name|void
name|childrenBoundingRect
parameter_list|()
function_decl|;
name|void
name|childrenBoundingRectTransformed
parameter_list|()
function_decl|;
name|void
name|childrenBoundingRect2
parameter_list|()
function_decl|;
name|void
name|childrenBoundingRect3
parameter_list|()
function_decl|;
name|void
name|childrenBoundingRect4
parameter_list|()
function_decl|;
name|void
name|childrenBoundingRect5
parameter_list|()
function_decl|;
name|void
name|group
parameter_list|()
function_decl|;
name|void
name|setGroup
parameter_list|()
function_decl|;
name|void
name|setGroup2
parameter_list|()
function_decl|;
name|void
name|nestedGroups
parameter_list|()
function_decl|;
name|void
name|warpChildrenIntoGroup
parameter_list|()
function_decl|;
name|void
name|removeFromGroup
parameter_list|()
function_decl|;
name|void
name|handlesChildEvents
parameter_list|()
function_decl|;
name|void
name|handlesChildEvents2
parameter_list|()
function_decl|;
name|void
name|handlesChildEvents3
parameter_list|()
function_decl|;
name|void
name|filtersChildEvents
parameter_list|()
function_decl|;
name|void
name|filtersChildEvents2
parameter_list|()
function_decl|;
name|void
name|ensureVisible
parameter_list|()
function_decl|;
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
name|void
name|cursor
parameter_list|()
function_decl|;
endif|#
directive|endif
comment|//void textControlGetterSetter();
name|void
name|defaultItemTest_QGraphicsLineItem
parameter_list|()
function_decl|;
name|void
name|defaultItemTest_QGraphicsPixmapItem
parameter_list|()
function_decl|;
name|void
name|defaultItemTest_QGraphicsTextItem
parameter_list|()
function_decl|;
name|void
name|defaultItemTest_QGraphicsEllipseItem
parameter_list|()
function_decl|;
name|void
name|itemChange
parameter_list|()
function_decl|;
name|void
name|sceneEventFilter
parameter_list|()
function_decl|;
name|void
name|prepareGeometryChange
parameter_list|()
function_decl|;
name|void
name|paint
parameter_list|()
function_decl|;
name|void
name|deleteItemInEventHandlers
parameter_list|()
function_decl|;
name|void
name|itemClipsToShape
parameter_list|()
function_decl|;
name|void
name|itemClipsChildrenToShape
parameter_list|()
function_decl|;
name|void
name|itemClipsChildrenToShape2
parameter_list|()
function_decl|;
name|void
name|itemClipsChildrenToShape3
parameter_list|()
function_decl|;
name|void
name|itemClipsChildrenToShape4
parameter_list|()
function_decl|;
name|void
name|itemClipsChildrenToShape5
parameter_list|()
function_decl|;
name|void
name|itemClipsTextChildToShape
parameter_list|()
function_decl|;
name|void
name|itemClippingDiscovery
parameter_list|()
function_decl|;
name|void
name|ancestorFlags
parameter_list|()
function_decl|;
name|void
name|untransformable
parameter_list|()
function_decl|;
name|void
name|contextMenuEventPropagation
parameter_list|()
function_decl|;
name|void
name|itemIsMovable
parameter_list|()
function_decl|;
name|void
name|boundingRegion_data
parameter_list|()
function_decl|;
name|void
name|boundingRegion
parameter_list|()
function_decl|;
name|void
name|itemTransform_parentChild
parameter_list|()
function_decl|;
name|void
name|itemTransform_siblings
parameter_list|()
function_decl|;
name|void
name|itemTransform_unrelated
parameter_list|()
function_decl|;
name|void
name|opacity_data
parameter_list|()
function_decl|;
name|void
name|opacity
parameter_list|()
function_decl|;
name|void
name|opacity2
parameter_list|()
function_decl|;
name|void
name|opacityZeroUpdates
parameter_list|()
function_decl|;
name|void
name|itemStacksBehindParent
parameter_list|()
function_decl|;
name|void
name|nestedClipping
parameter_list|()
function_decl|;
name|void
name|nestedClippingTransforms
parameter_list|()
function_decl|;
name|void
name|sceneTransformCache
parameter_list|()
function_decl|;
name|void
name|tabChangesFocus
parameter_list|()
function_decl|;
name|void
name|tabChangesFocus_data
parameter_list|()
function_decl|;
name|void
name|cacheMode
parameter_list|()
function_decl|;
name|void
name|cacheMode2
parameter_list|()
function_decl|;
name|void
name|updateCachedItemAfterMove
parameter_list|()
function_decl|;
name|void
name|deviceTransform_data
parameter_list|()
function_decl|;
name|void
name|deviceTransform
parameter_list|()
function_decl|;
name|void
name|update
parameter_list|()
function_decl|;
name|void
name|setTransformProperties_data
parameter_list|()
function_decl|;
name|void
name|setTransformProperties
parameter_list|()
function_decl|;
name|void
name|itemUsesExtendedStyleOption
parameter_list|()
function_decl|;
name|void
name|itemSendsGeometryChanges
parameter_list|()
function_decl|;
name|void
name|moveItem
parameter_list|()
function_decl|;
name|void
name|moveLineItem
parameter_list|()
function_decl|;
name|void
name|sorting_data
parameter_list|()
function_decl|;
name|void
name|sorting
parameter_list|()
function_decl|;
name|void
name|itemHasNoContents
parameter_list|()
function_decl|;
name|void
name|hitTestUntransformableItem
parameter_list|()
function_decl|;
name|void
name|hitTestGraphicsEffectItem
parameter_list|()
function_decl|;
name|void
name|focusProxy
parameter_list|()
function_decl|;
name|void
name|subFocus
parameter_list|()
function_decl|;
name|void
name|focusProxyDeletion
parameter_list|()
function_decl|;
name|void
name|negativeZStacksBehindParent
parameter_list|()
function_decl|;
name|void
name|setGraphicsEffect
parameter_list|()
function_decl|;
name|void
name|panel
parameter_list|()
function_decl|;
name|void
name|addPanelToActiveScene
parameter_list|()
function_decl|;
name|void
name|panelWithFocusItems
parameter_list|()
function_decl|;
name|void
name|activate
parameter_list|()
function_decl|;
name|void
name|setActivePanelOnInactiveScene
parameter_list|()
function_decl|;
name|void
name|activationOnShowHide
parameter_list|()
function_decl|;
name|void
name|moveWhileDeleting
parameter_list|()
function_decl|;
name|void
name|ensureDirtySceneTransform
parameter_list|()
function_decl|;
name|void
name|focusScope
parameter_list|()
function_decl|;
name|void
name|focusScope2
parameter_list|()
function_decl|;
name|void
name|stackBefore
parameter_list|()
function_decl|;
name|void
name|sceneModality
parameter_list|()
function_decl|;
name|void
name|panelModality
parameter_list|()
function_decl|;
name|void
name|mixedModality
parameter_list|()
function_decl|;
name|void
name|modality_hover
parameter_list|()
function_decl|;
name|void
name|modality_mouseGrabber
parameter_list|()
function_decl|;
name|void
name|modality_clickFocus
parameter_list|()
function_decl|;
name|void
name|modality_keyEvents
parameter_list|()
function_decl|;
name|void
name|itemIsInFront
parameter_list|()
function_decl|;
name|void
name|scenePosChange
parameter_list|()
function_decl|;
name|void
name|textItem_shortcuts
parameter_list|()
function_decl|;
name|void
name|scroll
parameter_list|()
function_decl|;
name|void
name|focusHandling_data
parameter_list|()
function_decl|;
name|void
name|focusHandling
parameter_list|()
function_decl|;
name|void
name|touchEventPropagation_data
parameter_list|()
function_decl|;
name|void
name|touchEventPropagation
parameter_list|()
function_decl|;
name|void
name|deviceCoordinateCache_simpleRotations
parameter_list|()
function_decl|;
comment|// task specific tests below me
name|void
name|task141694_textItemEnsureVisible
parameter_list|()
function_decl|;
name|void
name|task128696_textItemEnsureMovable
parameter_list|()
function_decl|;
name|void
name|ensureUpdateOnTextItem
parameter_list|()
function_decl|;
name|void
name|task177918_lineItemUndetected
parameter_list|()
function_decl|;
name|void
name|task240400_clickOnTextItem_data
parameter_list|()
function_decl|;
name|void
name|task240400_clickOnTextItem
parameter_list|()
function_decl|;
name|void
name|task243707_addChildBeforeParent
parameter_list|()
function_decl|;
name|void
name|task197802_childrenVisibility
parameter_list|()
function_decl|;
name|void
name|QTBUG_4233_updateCachedWithSceneRect
parameter_list|()
function_decl|;
name|void
name|QTBUG_5418_textItemSetDefaultColor
parameter_list|()
function_decl|;
name|void
name|QTBUG_6738_missingUpdateWithSetParent
parameter_list|()
function_decl|;
name|void
name|QTBUG_7714_fullUpdateDiscardingOpacityUpdate2
parameter_list|()
function_decl|;
name|void
name|QT_2653_fullUpdateDiscardingOpacityUpdate
parameter_list|()
function_decl|;
name|void
name|QT_2649_focusScope
parameter_list|()
function_decl|;
name|void
name|sortItemsWhileAdding
parameter_list|()
function_decl|;
name|void
name|doNotMarkFullUpdateIfNotInScene
parameter_list|()
function_decl|;
name|void
name|itemDiesDuringDraggingOperation
parameter_list|()
function_decl|;
name|void
name|QTBUG_12112_focusItem
parameter_list|()
function_decl|;
name|void
name|QTBUG_13473_sceneposchange
parameter_list|()
function_decl|;
name|void
name|QTBUG_16374_crashInDestructor
parameter_list|()
function_decl|;
name|void
name|QTBUG_20699_focusScopeCrash
parameter_list|()
function_decl|;
private|private:
DECL|member|paintedItems
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|paintedItems
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|init
name|void
name|tst_QGraphicsItem
operator|::
name|init
parameter_list|()
block|{
ifdef|#
directive|ifdef
name|Q_OS_WINCE
comment|//disable magic for WindowsCE
name|qApp
operator|->
name|setAutoMaximizeThreshold
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function
begin_function
DECL|function|construction
name|void
name|tst_QGraphicsItem
operator|::
name|construction
parameter_list|()
block|{
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|7
condition|;
operator|++
name|i
control|)
block|{
name|QGraphicsItem
modifier|*
name|item
decl_stmt|;
switch|switch
condition|(
name|i
condition|)
block|{
case|case
literal|0
case|:
name|item
operator|=
operator|new
name|QGraphicsEllipseItem
expr_stmt|;
operator|(
operator|(
name|QGraphicsEllipseItem
operator|*
operator|)
name|item
operator|)
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|item
operator|->
name|type
argument_list|()
argument_list|)
argument_list|,
name|int
argument_list|(
name|QGraphicsEllipseItem
operator|::
name|Type
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsEllipseItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|,
operator|(
name|QGraphicsEllipseItem
operator|*
operator|)
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsRectItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|,
operator|(
name|QGraphicsRectItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|flags
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|item
operator|=
operator|new
name|QGraphicsLineItem
expr_stmt|;
operator|(
operator|(
name|QGraphicsLineItem
operator|*
operator|)
name|item
operator|)
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|item
operator|->
name|type
argument_list|()
argument_list|)
argument_list|,
name|int
argument_list|(
name|QGraphicsLineItem
operator|::
name|Type
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsLineItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|,
operator|(
name|QGraphicsLineItem
operator|*
operator|)
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsRectItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|,
operator|(
name|QGraphicsRectItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|flags
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|item
operator|=
operator|new
name|QGraphicsPathItem
expr_stmt|;
operator|(
operator|(
name|QGraphicsPathItem
operator|*
operator|)
name|item
operator|)
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|item
operator|->
name|type
argument_list|()
argument_list|)
argument_list|,
name|int
argument_list|(
name|QGraphicsPathItem
operator|::
name|Type
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsPathItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|,
operator|(
name|QGraphicsPathItem
operator|*
operator|)
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsRectItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|,
operator|(
name|QGraphicsRectItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|flags
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|item
operator|=
operator|new
name|QGraphicsPixmapItem
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|item
operator|->
name|type
argument_list|()
argument_list|)
argument_list|,
name|int
argument_list|(
name|QGraphicsPixmapItem
operator|::
name|Type
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsPixmapItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|,
operator|(
name|QGraphicsPixmapItem
operator|*
operator|)
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsRectItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|,
operator|(
name|QGraphicsRectItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|flags
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
literal|4
case|:
name|item
operator|=
operator|new
name|QGraphicsPolygonItem
expr_stmt|;
operator|(
operator|(
name|QGraphicsPolygonItem
operator|*
operator|)
name|item
operator|)
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|item
operator|->
name|type
argument_list|()
argument_list|)
argument_list|,
name|int
argument_list|(
name|QGraphicsPolygonItem
operator|::
name|Type
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsPolygonItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|,
operator|(
name|QGraphicsPolygonItem
operator|*
operator|)
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsRectItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|,
operator|(
name|QGraphicsRectItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|flags
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
literal|5
case|:
name|item
operator|=
operator|new
name|QGraphicsRectItem
expr_stmt|;
operator|(
operator|(
name|QGraphicsRectItem
operator|*
operator|)
name|item
operator|)
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|item
operator|->
name|type
argument_list|()
argument_list|)
argument_list|,
name|int
argument_list|(
name|QGraphicsRectItem
operator|::
name|Type
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsRectItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|,
operator|(
name|QGraphicsRectItem
operator|*
operator|)
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsLineItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|,
operator|(
name|QGraphicsLineItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|flags
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
break|break;
case|case
literal|6
case|:
name|item
operator|=
operator|new
name|QGraphicsTextItem
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|item
operator|->
name|type
argument_list|()
argument_list|)
argument_list|,
name|int
argument_list|(
name|QGraphicsTextItem
operator|::
name|Type
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsTextItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|,
operator|(
name|QGraphicsTextItem
operator|*
operator|)
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsRectItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
argument_list|,
operator|(
name|QGraphicsRectItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// This is the only item that uses an extended style option.
name|QCOMPARE
argument_list|(
name|item
operator|->
name|flags
argument_list|()
argument_list|,
name|QGraphicsItem
operator|::
name|GraphicsItemFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemUsesExtendedStyleOption
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
name|qFatal
argument_list|(
literal|"You broke the logic, please fix!"
argument_list|)
expr_stmt|;
break|break;
block|}
name|QCOMPARE
argument_list|(
name|item
operator|->
name|scene
argument_list|()
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|children
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|acceptedMouseButtons
argument_list|()
argument_list|,
name|Qt
operator|::
name|MouseButtons
argument_list|(
literal|0x1f
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|item
operator|->
name|type
argument_list|()
operator|==
name|QGraphicsTextItem
operator|::
name|Type
condition|)
name|QVERIFY
argument_list|(
name|item
operator|->
name|acceptsHoverEvents
argument_list|()
argument_list|)
expr_stmt|;
else|else
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|acceptsHoverEvents
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|sceneMatrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|sceneBoundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|shape
argument_list|()
argument_list|,
name|QPainterPath
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|collidesWithItem
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|collidesWithItem
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|collidesWithPath
argument_list|(
name|QPainterPath
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isAncestorOf
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isAncestorOf
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|data
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
operator|delete
name|item
expr_stmt|;
block|}
block|}
end_function
begin_class
DECL|class|BoundingRectItem
class|class
name|BoundingRectItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|BoundingRectItem
name|BoundingRectItem
parameter_list|(
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
name|parent
condition|?
literal|200
else|:
literal|100
argument_list|,
name|parent
condition|?
literal|200
else|:
literal|100
argument_list|,
name|parent
argument_list|)
block|{
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|function|boundingRect
name|QRectF
name|boundingRect
parameter_list|()
specifier|const
block|{
name|QRectF
name|tmp
init|=
name|QGraphicsRectItem
operator|::
name|boundingRect
argument_list|()
decl_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|child
decl|,
name|children
argument_list|()
control|)
name|tmp
operator||=
name|child
operator|->
name|boundingRect
argument_list|()
expr_stmt|;
comment|//<- might be pure virtual
return|return
name|tmp
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|constructionWithParent
name|void
name|tst_QGraphicsItem
operator|::
name|constructionWithParent
parameter_list|()
block|{
comment|// This test causes a crash if item1 calls item2's pure virtuals before the
comment|// object has been constructed.
name|QGraphicsItem
modifier|*
name|item0
init|=
operator|new
name|BoundingRectItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item1
init|=
operator|new
name|BoundingRectItem
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item2
init|=
operator|new
name|BoundingRectItem
argument_list|(
name|item1
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|children
argument_list|()
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|boundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setParentItem
argument_list|(
name|item0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item0
operator|->
name|children
argument_list|()
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item0
operator|->
name|boundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_decl_stmt
DECL|variable|itemDeleted
specifier|static
name|int
name|itemDeleted
init|=
literal|0
decl_stmt|;
end_decl_stmt
begin_class
DECL|class|Item
class|class
name|Item
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|~Item
name|~
name|Item
parameter_list|()
block|{
operator|++
name|itemDeleted
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|destruction
name|void
name|tst_QGraphicsItem
operator|::
name|destruction
parameter_list|()
block|{
name|QCOMPARE
argument_list|(
name|itemDeleted
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|{
name|QGraphicsItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|Item
modifier|*
name|child
init|=
operator|new
name|Item
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|parentItem
argument_list|()
argument_list|,
name|parent
argument_list|)
expr_stmt|;
operator|delete
name|parent
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemDeleted
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
block|{
name|QGraphicsItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|Item
modifier|*
name|child
init|=
operator|new
name|Item
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|children
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
operator|delete
name|child
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|children
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|delete
name|parent
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemDeleted
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|Item
modifier|*
name|child
init|=
operator|new
name|Item
decl_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|parentItem
argument_list|()
argument_list|,
name|parent
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|parentItem
argument_list|()
argument_list|,
name|parent
argument_list|)
expr_stmt|;
operator|delete
name|parent
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemDeleted
argument_list|,
literal|3
argument_list|)
expr_stmt|;
block|}
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|Item
modifier|*
name|child
init|=
operator|new
name|Item
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scene
argument_list|()
argument_list|,
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|children
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
operator|delete
name|child
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|children
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|delete
name|parent
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemDeleted
argument_list|,
literal|4
argument_list|)
expr_stmt|;
block|}
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|Item
modifier|*
name|child
init|=
operator|new
name|Item
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scene
argument_list|()
argument_list|,
operator|&
name|scene
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scene
argument_list|()
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
operator|delete
name|parent
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemDeleted
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|Item
modifier|*
name|child
init|=
operator|new
name|Item
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scene
argument_list|()
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|scene
argument_list|()
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scene
argument_list|()
argument_list|,
operator|&
name|scene
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scene
argument_list|()
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|scene
argument_list|()
argument_list|,
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|children
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
operator|delete
name|parent
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemDeleted
argument_list|,
literal|5
argument_list|)
expr_stmt|;
operator|delete
name|child
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemDeleted
argument_list|,
literal|6
argument_list|)
expr_stmt|;
block|}
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|Item
modifier|*
name|child
init|=
operator|new
name|Item
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
operator|delete
name|child
expr_stmt|;
operator|delete
name|parent
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemDeleted
argument_list|,
literal|7
argument_list|)
expr_stmt|;
block|}
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|Item
modifier|*
name|child
init|=
operator|new
name|Item
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene2
decl_stmt|;
name|scene2
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
operator|delete
name|parent
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemDeleted
argument_list|,
literal|8
argument_list|)
expr_stmt|;
block|}
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|Item
modifier|*
name|child
init|=
operator|new
name|Item
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scene
argument_list|()
argument_list|,
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene2
decl_stmt|;
name|scene2
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scene
argument_list|()
argument_list|,
operator|&
name|scene2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scene
argument_list|()
argument_list|,
operator|&
name|scene
argument_list|)
expr_stmt|;
name|scene2
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scene
argument_list|()
argument_list|,
operator|&
name|scene2
argument_list|)
expr_stmt|;
operator|delete
name|parent
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemDeleted
argument_list|,
literal|9
argument_list|)
expr_stmt|;
block|}
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|Item
modifier|*
name|child
init|=
operator|new
name|Item
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scene
argument_list|()
argument_list|,
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene2
decl_stmt|;
name|scene2
operator|.
name|addItem
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scene
argument_list|()
argument_list|,
operator|&
name|scene2
argument_list|)
expr_stmt|;
operator|delete
name|parent
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemDeleted
argument_list|,
literal|9
argument_list|)
expr_stmt|;
operator|delete
name|child
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemDeleted
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|root
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
name|root
decl_stmt|;
name|QGraphicsItem
modifier|*
name|middleItem
init|=
literal|0
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|99
condition|;
operator|++
name|i
control|)
block|{
name|Item
modifier|*
name|child
init|=
operator|new
name|Item
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|parent
operator|=
name|child
expr_stmt|;
if|if
condition|(
name|i
operator|==
literal|50
condition|)
name|middleItem
operator|=
name|parent
expr_stmt|;
block|}
name|scene
operator|.
name|addItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene2
decl_stmt|;
name|scene2
operator|.
name|addItem
argument_list|(
name|middleItem
argument_list|)
expr_stmt|;
operator|delete
name|middleItem
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemDeleted
argument_list|,
literal|59
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|itemDeleted
argument_list|,
literal|109
argument_list|)
expr_stmt|;
block|{
name|QGraphicsScene
modifier|*
name|scene
init|=
operator|new
name|QGraphicsScene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|Item
modifier|*
name|child
init|=
operator|new
name|Item
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setVisible
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|scene
operator|->
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|parentItem
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
operator|delete
name|scene
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemDeleted
argument_list|,
literal|110
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|deleteChildItem
name|void
name|tst_QGraphicsItem
operator|::
name|deleteChildItem
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|rect
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|()
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|child1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|child2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|child3
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|)
decl_stmt|;
name|Q_UNUSED
argument_list|(
name|child3
argument_list|)
expr_stmt|;
operator|delete
name|child1
expr_stmt|;
name|child2
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
operator|delete
name|child2
expr_stmt|;
block|}
end_function
begin_function
DECL|function|scene
name|void
name|tst_QGraphicsItem
operator|::
name|scene
parameter_list|()
block|{
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|scene
argument_list|()
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|scene
argument_list|()
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene2
decl_stmt|;
name|scene2
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|scene
argument_list|()
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
operator|&
name|scene2
argument_list|)
expr_stmt|;
name|scene2
operator|.
name|removeItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|scene
argument_list|()
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
operator|delete
name|item
expr_stmt|;
block|}
end_function
begin_function
DECL|function|parentItem
name|void
name|tst_QGraphicsItem
operator|::
name|parentItem
parameter_list|()
block|{
name|QGraphicsRectItem
name|item
decl_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|item2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|()
argument_list|,
operator|&
name|item
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|&
name|item
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setParentItem
argument_list|(
operator|&
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|&
name|item
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
operator|delete
name|item2
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setParentItem
name|void
name|tst_QGraphicsItem
operator|::
name|setParentItem
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|scene
argument_list|()
argument_list|,
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|child
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scene
argument_list|()
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// This implicitly adds the item to the parent's scene
name|child
operator|->
name|setParentItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scene
argument_list|()
argument_list|,
operator|&
name|scene
argument_list|)
expr_stmt|;
comment|// This just makes it a toplevel
name|child
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scene
argument_list|()
argument_list|,
operator|&
name|scene
argument_list|)
expr_stmt|;
comment|// Add the child back to the parent, then remove the parent from the scene
name|child
operator|->
name|setParentItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scene
argument_list|()
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|children
name|void
name|tst_QGraphicsItem
operator|::
name|children
parameter_list|()
block|{
name|QGraphicsRectItem
name|item
decl_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|.
name|children
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|item2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|()
argument_list|,
operator|&
name|item
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|children
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|children
argument_list|()
operator|.
name|first
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|item2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|children
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
operator|delete
name|item2
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|.
name|children
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|flags
name|void
name|tst_QGraphicsItem
operator|::
name|flags
parameter_list|()
block|{
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|flags
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
block|{
comment|// Focus
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Selectable
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Movable
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// mouse grabber is reset
name|QGraphicsSceneMouseEvent
name|event2
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|event2
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|event2
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event2
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|event3
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|event3
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|event3
operator|.
name|setButtons
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|event4
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event4
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|event4
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event4
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|item
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|event5
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|event5
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|event5
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event5
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|{
name|QGraphicsItem
modifier|*
name|clippingParent
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|clippingParent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|nonClippingParent
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|nonClippingParent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|child
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|nonClippingParent
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isClipped
argument_list|()
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|clippingParent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isClipped
argument_list|()
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|nonClippingParent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isClipped
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_class
DECL|class|ImhTester
class|class
name|ImhTester
super|:
specifier|public
name|QGraphicsItem
block|{
DECL|function|boundingRect
name|QRectF
name|boundingRect
parameter_list|()
specifier|const
block|{
return|return
name|QRectF
argument_list|()
return|;
block|}
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{}
block|}
class|;
end_class
begin_function
DECL|function|inputMethodHints
name|void
name|tst_QGraphicsItem
operator|::
name|inputMethodHints
parameter_list|()
block|{
name|ImhTester
modifier|*
name|item
init|=
operator|new
name|ImhTester
decl_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemAcceptsInputMethod
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|inputMethodHints
argument_list|()
argument_list|,
name|Qt
operator|::
name|ImhNone
argument_list|)
expr_stmt|;
name|ImhTester
modifier|*
name|item2
init|=
operator|new
name|ImhTester
decl_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemAcceptsInputMethod
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|Qt
operator|::
name|InputMethodHints
name|imHints
init|=
name|item2
operator|->
name|inputMethodHints
argument_list|()
decl_stmt|;
name|imHints
operator||=
name|Qt
operator|::
name|ImhHiddenText
expr_stmt|;
name|item2
operator|->
name|setInputMethodHints
argument_list|(
name|imHints
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|inputMethodHints
argument_list|()
argument_list|,
name|item
operator|->
name|inputMethodHints
argument_list|()
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|item2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|inputMethodHints
argument_list|()
argument_list|,
name|item2
operator|->
name|inputMethodHints
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemAcceptsInputMethod
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|//Focus has changed but the new item doesn't accept input method, no hints.
name|QCOMPARE
argument_list|(
name|view
operator|.
name|inputMethodHints
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|item2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|inputMethodHints
argument_list|()
argument_list|,
name|item2
operator|->
name|inputMethodHints
argument_list|()
argument_list|)
expr_stmt|;
name|imHints
operator|=
name|item2
operator|->
name|inputMethodHints
argument_list|()
expr_stmt|;
name|imHints
operator||=
operator|(
name|Qt
operator|::
name|ImhNoAutoUppercase
operator||
name|Qt
operator|::
name|ImhNoPredictiveText
operator|)
expr_stmt|;
name|item2
operator|->
name|setInputMethodHints
argument_list|(
name|imHints
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|inputMethodHints
argument_list|()
argument_list|,
name|item2
operator|->
name|inputMethodHints
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsProxyWidget
modifier|*
name|widget
init|=
operator|new
name|QGraphicsProxyWidget
decl_stmt|;
name|QLineEdit
modifier|*
name|edit
init|=
operator|new
name|QLineEdit
decl_stmt|;
name|edit
operator|->
name|setEchoMode
argument_list|(
name|QLineEdit
operator|::
name|Password
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|widget
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|//No widget on the proxy, so no hints
name|QCOMPARE
argument_list|(
name|view
operator|.
name|inputMethodHints
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|widget
operator|->
name|setWidget
argument_list|(
name|edit
argument_list|)
expr_stmt|;
comment|//View should match with the line edit
name|QCOMPARE
argument_list|(
name|view
operator|.
name|inputMethodHints
argument_list|()
argument_list|,
name|edit
operator|->
name|inputMethodHints
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|toolTip
name|void
name|tst_QGraphicsItem
operator|::
name|toolTip
parameter_list|()
block|{
name|QString
name|toolTip
init|=
literal|"Qt rocks!"
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|red
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setBrush
argument_list|(
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|toolTip
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setToolTip
argument_list|(
name|toolTip
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|toolTip
argument_list|()
argument_list|,
name|toolTip
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
block|{
name|QHelpEvent
name|helpEvent
argument_list|(
name|QEvent
operator|::
name|ToolTip
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|topLeft
argument_list|()
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|topLeft
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|helpEvent
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|250
argument_list|)
expr_stmt|;
name|bool
name|foundView
init|=
literal|false
decl_stmt|;
name|bool
name|foundTipLabel
init|=
literal|false
decl_stmt|;
foreach|foreach
control|(
name|QWidget
modifier|*
name|widget
decl|,
name|QApplication
operator|::
name|topLevelWidgets
argument_list|()
control|)
block|{
if|if
condition|(
name|widget
operator|==
operator|&
name|view
condition|)
name|foundView
operator|=
literal|true
expr_stmt|;
if|if
condition|(
name|widget
operator|->
name|inherits
argument_list|(
literal|"QTipLabel"
argument_list|)
condition|)
name|foundTipLabel
operator|=
literal|true
expr_stmt|;
block|}
name|QVERIFY
argument_list|(
name|foundView
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|foundTipLabel
argument_list|)
expr_stmt|;
block|}
block|{
name|QHelpEvent
name|helpEvent
argument_list|(
name|QEvent
operator|::
name|ToolTip
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|helpEvent
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|250
argument_list|)
expr_stmt|;
name|bool
name|foundView
init|=
literal|false
decl_stmt|;
name|bool
name|foundTipLabel
init|=
literal|false
decl_stmt|;
foreach|foreach
control|(
name|QWidget
modifier|*
name|widget
decl|,
name|QApplication
operator|::
name|topLevelWidgets
argument_list|()
control|)
block|{
if|if
condition|(
name|widget
operator|==
operator|&
name|view
condition|)
name|foundView
operator|=
literal|true
expr_stmt|;
if|if
condition|(
name|widget
operator|->
name|inherits
argument_list|(
literal|"QTipLabel"
argument_list|)
condition|)
name|foundTipLabel
operator|=
literal|true
expr_stmt|;
block|}
name|QVERIFY
argument_list|(
name|foundView
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|foundTipLabel
argument_list|)
expr_stmt|;
block|}
block|{
name|QHelpEvent
name|helpEvent
argument_list|(
name|QEvent
operator|::
name|ToolTip
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|topLeft
argument_list|()
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|topLeft
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|helpEvent
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|1000
argument_list|)
expr_stmt|;
name|bool
name|foundView
init|=
literal|false
decl_stmt|;
name|bool
name|foundTipLabel
init|=
literal|false
decl_stmt|;
foreach|foreach
control|(
name|QWidget
modifier|*
name|widget
decl|,
name|QApplication
operator|::
name|topLevelWidgets
argument_list|()
control|)
block|{
if|if
condition|(
name|widget
operator|==
operator|&
name|view
condition|)
name|foundView
operator|=
literal|true
expr_stmt|;
if|if
condition|(
name|widget
operator|->
name|inherits
argument_list|(
literal|"QTipLabel"
argument_list|)
operator|&&
name|widget
operator|->
name|isVisible
argument_list|()
condition|)
name|foundTipLabel
operator|=
literal|true
expr_stmt|;
block|}
name|QVERIFY
argument_list|(
name|foundView
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|foundTipLabel
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|visible
name|void
name|tst_QGraphicsItem
operator|::
name|visible
parameter_list|()
block|{
name|QGraphicsItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setVisible
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setVisible
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|item
operator|->
name|setVisible
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|item
operator|->
name|setVisible
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|item
operator|->
name|setVisible
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|item
operator|->
name|setVisible
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setVisible
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setVisible
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|isVisibleTo
name|void
name|tst_QGraphicsItem
operator|::
name|isVisibleTo
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|child
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|grandChild
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|stranger
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|grandChild
operator|->
name|setParentItem
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandChild
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
name|grandChild
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isVisibleTo
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isVisibleTo
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isVisibleTo
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isVisibleTo
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isVisibleTo
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isVisibleTo
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisibleTo
argument_list|(
name|grandChild
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
name|stranger
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisibleTo
argument_list|(
name|stranger
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isVisibleTo
argument_list|(
name|stranger
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|stranger
operator|->
name|isVisibleTo
argument_list|(
name|grandChild
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|stranger
operator|->
name|isVisibleTo
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|stranger
operator|->
name|isVisibleTo
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
comment|// Case 1: only parent is explicitly hidden
name|parent
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
name|grandChild
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isVisibleTo
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isVisibleTo
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisibleTo
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isVisibleTo
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isVisibleTo
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isVisibleTo
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisibleTo
argument_list|(
name|grandChild
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
name|stranger
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisibleTo
argument_list|(
name|stranger
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isVisibleTo
argument_list|(
name|stranger
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|stranger
operator|->
name|isVisibleTo
argument_list|(
name|grandChild
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|stranger
operator|->
name|isVisibleTo
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|stranger
operator|->
name|isVisibleTo
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
comment|// Case 2: only child is hidden
name|parent
operator|->
name|show
argument_list|()
expr_stmt|;
name|child
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
name|grandChild
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisibleTo
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisibleTo
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisibleTo
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isVisibleTo
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isVisibleTo
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isVisibleTo
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisibleTo
argument_list|(
name|grandChild
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
name|stranger
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisibleTo
argument_list|(
name|stranger
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isVisibleTo
argument_list|(
name|stranger
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|stranger
operator|->
name|isVisibleTo
argument_list|(
name|grandChild
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|stranger
operator|->
name|isVisibleTo
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|stranger
operator|->
name|isVisibleTo
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
comment|// Case 3: only grand child is hidden
name|child
operator|->
name|show
argument_list|()
expr_stmt|;
name|grandChild
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
name|grandChild
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isVisibleTo
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isVisibleTo
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isVisibleTo
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isVisibleTo
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isVisibleTo
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isVisibleTo
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisibleTo
argument_list|(
name|grandChild
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChild
operator|->
name|isVisibleTo
argument_list|(
name|stranger
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisibleTo
argument_list|(
name|stranger
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isVisibleTo
argument_list|(
name|stranger
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|stranger
operator|->
name|isVisibleTo
argument_list|(
name|grandChild
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|stranger
operator|->
name|isVisibleTo
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|stranger
operator|->
name|isVisibleTo
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|explicitlyVisible
name|void
name|tst_QGraphicsItem
operator|::
name|explicitlyVisible
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|child
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|parent
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|parent
operator|->
name|show
argument_list|()
expr_stmt|;
name|child
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|parent
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|parent
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
comment|//<- explicitly hidden
name|child
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|parent
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
comment|//<- explicit show doesn't work
name|parent
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
comment|//<- no longer explicitly hidden
comment|// ------------------- Reparenting ------------------------------
name|QGraphicsItem
modifier|*
name|parent2
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|parent2
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
comment|// Reparent implicitly hidden item to a visible parent.
name|parent
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent2
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
comment|// Reparent implicitly hidden item to a hidden parent.
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|parent2
operator|->
name|hide
argument_list|()
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent2
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
comment|// Reparent explicitly hidden item to a visible parent.
name|child
operator|->
name|hide
argument_list|()
expr_stmt|;
name|parent
operator|->
name|show
argument_list|()
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
comment|// Reparent explicitly hidden item to a hidden parent.
name|child
operator|->
name|setParentItem
argument_list|(
name|parent2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent2
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
comment|// Reparent explicitly hidden item to a visible parent.
name|parent
operator|->
name|show
argument_list|()
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
comment|// Reparent visible item to a hidden parent.
name|child
operator|->
name|show
argument_list|()
expr_stmt|;
name|parent2
operator|->
name|hide
argument_list|()
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent2
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|parent2
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent2
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
comment|// Reparent implicitly hidden child to root.
name|parent2
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
comment|// Reparent an explicitly hidden child to root.
name|child
operator|->
name|hide
argument_list|()
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent2
argument_list|)
expr_stmt|;
name|parent2
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|enabled
name|void
name|tst_QGraphicsItem
operator|::
name|enabled
parameter_list|()
block|{
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|item
operator|->
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|item
argument_list|)
expr_stmt|;
name|item
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|explicitlyEnabled
name|void
name|tst_QGraphicsItem
operator|::
name|explicitlyEnabled
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|child
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|child
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
comment|//<- explicitly disabled
name|child
operator|->
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
comment|//<- explicit enabled doesn't work
name|parent
operator|->
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
comment|//<- no longer explicitly disabled
comment|// ------------------- Reparenting ------------------------------
name|QGraphicsItem
modifier|*
name|parent2
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|parent2
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
comment|// Reparent implicitly hidden item to a enabled parent.
name|parent
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent2
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
comment|// Reparent implicitly hidden item to a hidden parent.
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|parent2
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent2
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
comment|// Reparent explicitly hidden item to a enabled parent.
name|child
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
comment|// Reparent explicitly hidden item to a hidden parent.
name|child
operator|->
name|setParentItem
argument_list|(
name|parent2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent2
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
comment|// Reparent explicitly hidden item to a enabled parent.
name|parent
operator|->
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
comment|// Reparent enabled item to a hidden parent.
name|child
operator|->
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|parent2
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent2
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|parent2
operator|->
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent2
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
comment|// Reparent implicitly hidden child to root.
name|parent2
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
comment|// Reparent an explicitly hidden child to root.
name|child
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent2
argument_list|)
expr_stmt|;
name|parent2
operator|->
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isEnabled
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|SelectChangeItem
class|class
name|SelectChangeItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|SelectChangeItem
name|SelectChangeItem
parameter_list|()
member_init_list|:
name|QGraphicsRectItem
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
block|{
name|setBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
expr_stmt|;
block|}
DECL|member|values
name|QList
argument_list|<
name|bool
argument_list|>
name|values
decl_stmt|;
protected|protected:
DECL|function|itemChange
name|QVariant
name|itemChange
parameter_list|(
name|GraphicsItemChange
name|change
parameter_list|,
specifier|const
name|QVariant
modifier|&
name|value
parameter_list|)
block|{
if|if
condition|(
name|change
operator|==
name|ItemSelectedChange
condition|)
name|values
operator|<<
name|value
operator|.
name|toBool
argument_list|()
expr_stmt|;
return|return
name|QGraphicsRectItem
operator|::
name|itemChange
argument_list|(
name|change
argument_list|,
name|value
argument_list|)
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|selected
name|void
name|tst_QGraphicsItem
operator|::
name|selected
parameter_list|()
block|{
name|SelectChangeItem
modifier|*
name|item
init|=
operator|new
name|SelectChangeItem
decl_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|values
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|last
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setSelected
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|last
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|item
operator|->
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|last
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|item
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|last
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setVisible
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|size
argument_list|()
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|last
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setVisible
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|size
argument_list|()
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|item
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|size
argument_list|()
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|last
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item
argument_list|)
expr_stmt|;
name|item
operator|->
name|setSelected
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item
argument_list|)
expr_stmt|;
name|item
operator|->
name|setSelected
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
comment|// Interactive selection
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|250
argument_list|,
literal|250
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|scene
operator|.
name|clearSelection
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|size
argument_list|()
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|last
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Click inside and check that it's selected
name|QTest
operator|::
name|mouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|size
argument_list|()
argument_list|,
literal|11
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|last
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Click outside and check that it's not selected
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
operator|+
name|QPointF
argument_list|(
name|item
operator|->
name|boundingRect
argument_list|()
operator|.
name|width
argument_list|()
argument_list|,
name|item
operator|->
name|boundingRect
argument_list|()
operator|.
name|height
argument_list|()
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|size
argument_list|()
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|last
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|SelectChangeItem
modifier|*
name|item2
init|=
operator|new
name|SelectChangeItem
decl_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
comment|// Click inside and check that it's selected
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|size
argument_list|()
argument_list|,
literal|13
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|last
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Click inside item2 and check that it's selected, and item is not
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item2
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|size
argument_list|()
argument_list|,
literal|14
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|values
operator|.
name|last
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|values
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|values
operator|.
name|last
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|selected2
name|void
name|tst_QGraphicsItem
operator|::
name|selected2
parameter_list|()
block|{
comment|// Selecting an item, then moving another previously caused a crash.
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|line1
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|line1
operator|->
name|setPos
argument_list|(
operator|-
literal|105
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|line1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|line2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|line2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|line1
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|mousePress
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|mousePress
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|mousePress
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|mousePress
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|mousePress
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
name|QGraphicsSceneMouseEvent
name|mouseMove
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|mouseMove
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|60
argument_list|,
literal|60
argument_list|)
argument_list|)
expr_stmt|;
name|mouseMove
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|mouseMove
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|mouseMove
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|mouseMove
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|selected_group
name|void
name|tst_QGraphicsItem
operator|::
name|selected_group
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item1
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|()
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|()
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|()
argument_list|)
operator|->
name|setParentItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|leaf
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|()
argument_list|)
decl_stmt|;
name|leaf
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|leaf
operator|->
name|setParentItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|QGraphicsItemGroup
modifier|*
name|group
init|=
name|scene
operator|.
name|createItemGroup
argument_list|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item1
operator|<<
name|item2
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|->
name|scene
argument_list|()
argument_list|,
operator|&
name|scene
argument_list|)
expr_stmt|;
name|group
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|scene
operator|.
name|items
argument_list|()
control|)
block|{
if|if
condition|(
name|item
operator|==
name|group
condition|)
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|group
argument_list|()
argument_list|)
expr_stmt|;
else|else
name|QCOMPARE
argument_list|(
name|item
operator|->
name|group
argument_list|()
argument_list|,
name|group
argument_list|)
expr_stmt|;
block|}
name|QVERIFY
argument_list|(
name|group
operator|->
name|handlesChildEvents
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|group
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|group
operator|->
name|setSelected
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|group
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|group
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|group
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|scene
operator|.
name|items
argument_list|()
control|)
name|QVERIFY
argument_list|(
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|group
operator|->
name|setSelected
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|group
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|scene
operator|.
name|items
argument_list|()
control|)
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|leaf
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|scene
operator|.
name|items
argument_list|()
control|)
name|QVERIFY
argument_list|(
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|leaf
operator|->
name|setSelected
argument_list|(
literal|false
argument_list|)
expr_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|scene
operator|.
name|items
argument_list|()
control|)
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|leaf
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene2
decl_stmt|;
name|scene2
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|selected_textItem
name|void
name|tst_QGraphicsItem
operator|::
name|selected_textItem
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsTextItem
modifier|*
name|text
init|=
name|scene
operator|.
name|addText
argument_list|(
name|QLatin1String
argument_list|(
literal|"Text"
argument_list|)
argument_list|)
decl_stmt|;
name|text
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|text
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|text
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|text
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|text
operator|->
name|setSelected
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|text
operator|->
name|setTextInteractionFlags
argument_list|(
name|Qt
operator|::
name|TextEditorInteraction
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|text
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|text
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|selected_multi
name|void
name|tst_QGraphicsItem
operator|::
name|selected_multi
parameter_list|()
block|{
comment|// Test multiselection behavior
name|QGraphicsScene
name|scene
decl_stmt|;
comment|// Create two disjoint items
name|QGraphicsItem
modifier|*
name|item1
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setPos
argument_list|(
operator|-
literal|15
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setPos
argument_list|(
literal|15
argument_list|,
literal|20
argument_list|)
expr_stmt|;
comment|// Make both items selectable
name|item1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
comment|// Create and show a view
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|view
operator|.
name|fitInView
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Start clicking
name|QTest
operator|::
name|qWait
argument_list|(
literal|200
argument_list|)
expr_stmt|;
comment|// Click on item1
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item1
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Click on item2
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item2
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Ctrl-click on item1
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item1
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Ctrl-click on item1 again
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item1
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Ctrl-click on item2
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item2
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Click on item1
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item1
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Click on scene
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Click on item1
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item1
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Ctrl-click on scene
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Click on item1
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item1
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Press on item2
name|QTest
operator|::
name|mousePress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item2
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Release on item2
name|QTest
operator|::
name|mouseRelease
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item2
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Click on item1
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item1
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Ctrl-click on item1
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item1
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Ctrl-press on item1
name|QTest
operator|::
name|mousePress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item1
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
block|{
comment|// Ctrl-move on item1
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item1
operator|->
name|scenePos
argument_list|()
argument_list|)
operator|+
name|QPoint
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|// Release on item1
name|QTest
operator|::
name|mouseRelease
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item1
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setSelected
argument_list|(
literal|false
argument_list|)
expr_stmt|;
comment|// Ctrl-press on item1
name|QTest
operator|::
name|mousePress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item1
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
block|{
comment|// Ctrl-move on item1
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item1
operator|->
name|scenePos
argument_list|()
argument_list|)
operator|+
name|QPoint
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|// Release on item1
name|QTest
operator|::
name|mouseRelease
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item1
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|acceptedMouseButtons
name|void
name|tst_QGraphicsItem
operator|::
name|acceptedMouseButtons
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item1
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|item2
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|acceptedMouseButtons
argument_list|()
argument_list|,
name|Qt
operator|::
name|MouseButtons
argument_list|(
literal|0x1f
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|acceptedMouseButtons
argument_list|()
argument_list|,
name|Qt
operator|::
name|MouseButtons
argument_list|(
literal|0x1f
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|item2
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setAcceptedMouseButtons
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|item1
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|HoverItem
class|class
name|HoverItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|HoverItem
name|HoverItem
parameter_list|(
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|)
member_init_list|,
name|hoverInCount
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|hoverMoveCount
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|hoverOutCount
argument_list|(
literal|0
argument_list|)
block|{ }
DECL|member|hoverInCount
name|int
name|hoverInCount
decl_stmt|;
DECL|member|hoverMoveCount
name|int
name|hoverMoveCount
decl_stmt|;
DECL|member|hoverOutCount
name|int
name|hoverOutCount
decl_stmt|;
protected|protected:
DECL|function|hoverEnterEvent
name|void
name|hoverEnterEvent
parameter_list|(
name|QGraphicsSceneHoverEvent
modifier|*
parameter_list|)
block|{
operator|++
name|hoverInCount
expr_stmt|;
block|}
DECL|function|hoverMoveEvent
name|void
name|hoverMoveEvent
parameter_list|(
name|QGraphicsSceneHoverEvent
modifier|*
parameter_list|)
block|{
operator|++
name|hoverMoveCount
expr_stmt|;
block|}
DECL|function|hoverLeaveEvent
name|void
name|hoverLeaveEvent
parameter_list|(
name|QGraphicsSceneHoverEvent
modifier|*
parameter_list|)
block|{
operator|++
name|hoverOutCount
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|acceptsHoverEvents
name|void
name|tst_QGraphicsItem
operator|::
name|acceptsHoverEvents
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|HoverItem
modifier|*
name|item1
init|=
operator|new
name|HoverItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|HoverItem
modifier|*
name|item2
init|=
operator|new
name|HoverItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|acceptsHoverEvents
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|acceptsHoverEvents
argument_list|()
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setAcceptsHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setAcceptsHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|2.5
argument_list|,
operator|-
literal|2.5
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverInCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverInCount
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setAcceptsHoverEvents
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setAcceptsHoverEvents
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|2.5
argument_list|,
operator|-
literal|2.5
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverInCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverInCount
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setAcceptsHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setAcceptsHoverEvents
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|2.5
argument_list|,
operator|-
literal|2.5
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverInCount
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverInCount
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|childAcceptsHoverEvents
name|void
name|tst_QGraphicsItem
operator|::
name|childAcceptsHoverEvents
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|HoverItem
modifier|*
name|item1
init|=
operator|new
name|HoverItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|HoverItem
modifier|*
name|item2
init|=
operator|new
name|HoverItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|5
argument_list|,
operator|-
literal|5
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setParentItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setAcceptHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverInCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverMoveCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverOutCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverInCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverMoveCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverOutCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|2.5
argument_list|,
operator|-
literal|2.5
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverInCount
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverMoveCount
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverOutCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverInCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverMoveCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverOutCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverInCount
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverMoveCount
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverOutCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverInCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverMoveCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverOutCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|7
argument_list|,
operator|-
literal|7
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverInCount
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverMoveCount
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverOutCount
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverInCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverMoveCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverOutCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverInCount
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverMoveCount
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverOutCount
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverInCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverMoveCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverOutCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|HoverItem
modifier|*
name|item0
init|=
operator|new
name|HoverItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|20
argument_list|,
operator|-
literal|20
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item0
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setParentItem
argument_list|(
name|item0
argument_list|)
expr_stmt|;
name|item0
operator|->
name|setAcceptHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|15
argument_list|,
operator|-
literal|15
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverInCount
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverMoveCount
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|hoverOutCount
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverInCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverMoveCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|hoverOutCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item0
operator|->
name|hoverInCount
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item0
operator|->
name|hoverMoveCount
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item0
operator|->
name|hoverOutCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|hasFocus
name|void
name|tst_QGraphicsItem
operator|::
name|hasFocus
parameter_list|()
block|{
name|QGraphicsLineItem
modifier|*
name|line
init|=
operator|new
name|QGraphicsLineItem
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|line
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|line
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|line
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|line
argument_list|)
expr_stmt|;
name|line
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|line
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|line
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|line
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|line
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene2
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene2
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|scene2
operator|.
name|addItem
argument_list|(
name|line
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|line
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene2
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|line
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|line
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|line
operator|->
name|clearFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|line
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsLineItem
modifier|*
name|line2
init|=
operator|new
name|QGraphicsLineItem
decl_stmt|;
name|line2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|scene2
operator|.
name|addItem
argument_list|(
name|line2
argument_list|)
expr_stmt|;
name|line2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|line
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|line2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|line
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|line
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|line2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|pos
name|void
name|tst_QGraphicsItem
operator|::
name|pos
parameter_list|()
block|{
name|QGraphicsItem
modifier|*
name|child
init|=
operator|new
name|QGraphicsLineItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsLineItem
decl_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|child
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
operator|delete
name|child
expr_stmt|;
operator|delete
name|parent
expr_stmt|;
block|}
end_function
begin_function
DECL|function|scenePos
name|void
name|tst_QGraphicsItem
operator|::
name|scenePos
parameter_list|()
block|{
name|QGraphicsItem
modifier|*
name|child
init|=
operator|new
name|QGraphicsLineItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsLineItem
decl_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scenePos
argument_list|()
argument_list|,
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|scenePos
argument_list|()
argument_list|,
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|child
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scenePos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|scenePos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scenePos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setPos
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|scenePos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|scenePos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|)
argument_list|)
expr_stmt|;
operator|delete
name|child
expr_stmt|;
operator|delete
name|parent
expr_stmt|;
block|}
end_function
begin_function
DECL|function|matrix
name|void
name|tst_QGraphicsItem
operator|::
name|matrix
parameter_list|()
block|{
name|QGraphicsLineItem
name|line
decl_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
argument_list|)
expr_stmt|;
name|line
operator|.
name|setMatrix
argument_list|(
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
name|line
operator|.
name|setMatrix
argument_list|(
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
name|line
operator|.
name|setMatrix
argument_list|(
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|180
argument_list|)
argument_list|)
expr_stmt|;
name|line
operator|.
name|setMatrix
argument_list|(
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
operator|-
literal|90
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
name|line
operator|.
name|resetMatrix
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
argument_list|)
expr_stmt|;
name|line
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
name|line
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
name|line
operator|.
name|resetMatrix
argument_list|()
expr_stmt|;
name|line
operator|.
name|scale
argument_list|(
literal|2
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|scale
argument_list|(
literal|2
argument_list|,
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|line
operator|.
name|scale
argument_list|(
literal|2
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|scale
argument_list|(
literal|2
argument_list|,
literal|4
argument_list|)
operator|.
name|scale
argument_list|(
literal|2
argument_list|,
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|line
operator|.
name|resetMatrix
argument_list|()
expr_stmt|;
name|line
operator|.
name|shear
argument_list|(
literal|2
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|shear
argument_list|(
literal|2
argument_list|,
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|line
operator|.
name|shear
argument_list|(
literal|2
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|shear
argument_list|(
literal|2
argument_list|,
literal|4
argument_list|)
operator|.
name|shear
argument_list|(
literal|2
argument_list|,
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|line
operator|.
name|resetMatrix
argument_list|()
expr_stmt|;
name|line
operator|.
name|translate
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|translate
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|line
operator|.
name|translate
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|translate
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
operator|.
name|translate
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|line
operator|.
name|resetMatrix
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sceneMatrix
name|void
name|tst_QGraphicsItem
operator|::
name|sceneMatrix
parameter_list|()
block|{
name|QGraphicsLineItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsLineItem
decl_stmt|;
name|QGraphicsLineItem
modifier|*
name|child
init|=
operator|new
name|QGraphicsLineItem
argument_list|(
name|QLineF
argument_list|()
argument_list|,
name|parent
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|sceneMatrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|sceneMatrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
argument_list|)
expr_stmt|;
name|parent
operator|->
name|translate
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|sceneMatrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|translate
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|sceneMatrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|translate
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|child
operator|->
name|translate
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|sceneMatrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|translate
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|sceneMatrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|translate
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|parent
operator|->
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|sceneMatrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|translate
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|sceneMatrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|translate
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
operator|.
name|translate
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
operator|delete
name|child
expr_stmt|;
operator|delete
name|parent
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setMatrix
name|void
name|tst_QGraphicsItem
operator|::
name|setMatrix
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|qRegisterMetaType
argument_list|<
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|>
argument_list|(
literal|"QList<QRectF>"
argument_list|)
expr_stmt|;
name|QSignalSpy
name|spy
argument_list|(
operator|&
name|scene
argument_list|,
name|SIGNAL
argument_list|(
name|changed
argument_list|(
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QRectF
name|unrotatedRect
argument_list|(
operator|-
literal|12
argument_list|,
operator|-
literal|34
argument_list|,
literal|56
argument_list|,
literal|78
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
name|item
argument_list|(
name|unrotatedRect
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|item
operator|.
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|item
argument_list|)
expr_stmt|;
name|scene
operator|.
name|update
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|instance
argument_list|()
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|item
operator|.
name|setMatrix
argument_list|(
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
name|qreal
argument_list|(
literal|12.34
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QRectF
name|rotatedRect
init|=
name|scene
operator|.
name|sceneRect
argument_list|()
decl_stmt|;
name|QVERIFY
argument_list|(
name|unrotatedRect
operator|!=
name|rotatedRect
argument_list|)
expr_stmt|;
name|scene
operator|.
name|update
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|instance
argument_list|()
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|item
operator|.
name|setMatrix
argument_list|(
name|QMatrix
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|update
argument_list|(
name|scene
operator|.
name|sceneRect
argument_list|()
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|instance
argument_list|()
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QRectF
argument_list|>
name|rlist
init|=
name|qvariant_cast
argument_list|<
name|QList
argument_list|<
name|QRectF
argument_list|>
argument_list|>
argument_list|(
name|spy
operator|.
name|last
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|rlist
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rlist
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|rotatedRect
argument_list|)
expr_stmt|;
comment|// From item.setMatrix() (clearing rotated rect)
name|QCOMPARE
argument_list|(
name|rlist
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|rotatedRect
argument_list|)
expr_stmt|;
comment|// From scene.update()   (updating scene rect)
name|QCOMPARE
argument_list|(
name|rlist
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
name|unrotatedRect
argument_list|)
expr_stmt|;
comment|// From post-update      (update current state)
block|}
end_function
begin_decl_stmt
DECL|variable|_paintedItems
specifier|static
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|_paintedItems
decl_stmt|;
end_decl_stmt
begin_class
DECL|class|PainterItem
class|class
name|PainterItem
super|:
specifier|public
name|QGraphicsItem
block|{
protected|protected:
DECL|function|boundingRect
name|QRectF
name|boundingRect
parameter_list|()
specifier|const
block|{
return|return
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
return|;
block|}
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
name|_paintedItems
operator|<<
name|this
expr_stmt|;
name|painter
operator|->
name|fillRect
argument_list|(
name|boundingRect
argument_list|()
argument_list|,
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|zValue
name|void
name|tst_QGraphicsItem
operator|::
name|zValue
parameter_list|()
block|{
name|Q_CHECK_PAINTEVENTS
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item1
init|=
operator|new
name|PainterItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item2
init|=
operator|new
name|PainterItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item3
init|=
operator|new
name|PainterItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item4
init|=
operator|new
name|PainterItem
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item3
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item4
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setZValue
argument_list|(
operator|-
literal|3
argument_list|)
expr_stmt|;
name|item4
operator|->
name|setZValue
argument_list|(
operator|-
literal|2
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setZValue
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|item3
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|_paintedItems
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|(
name|_paintedItems
operator|.
name|size
argument_list|()
operator|%
literal|4
operator|)
operator|==
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|3
condition|;
operator|++
name|i
control|)
name|QVERIFY
argument_list|(
name|_paintedItems
operator|.
name|at
argument_list|(
name|i
argument_list|)
operator|->
name|zValue
argument_list|()
operator|<
name|_paintedItems
operator|.
name|at
argument_list|(
name|i
operator|+
literal|1
argument_list|)
operator|->
name|zValue
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|shape
name|void
name|tst_QGraphicsItem
operator|::
name|shape
parameter_list|()
block|{
name|QGraphicsLineItem
name|line
argument_list|(
name|QLineF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|line
operator|.
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
comment|// We unfortunately need this hack as QPainterPathStroker will set a width of 1.0
comment|// if we pass a value of 0.0 to QPainterPathStroker::setWidth()
specifier|const
name|qreal
name|penWidthZero
init|=
name|qreal
argument_list|(
literal|0.00000001
argument_list|)
decl_stmt|;
name|QPainterPathStroker
name|ps
decl_stmt|;
name|ps
operator|.
name|setWidth
argument_list|(
name|penWidthZero
argument_list|)
expr_stmt|;
name|QPainterPath
name|path
argument_list|(
name|line
operator|.
name|line
argument_list|()
operator|.
name|p1
argument_list|()
argument_list|)
decl_stmt|;
name|path
operator|.
name|lineTo
argument_list|(
name|line
operator|.
name|line
argument_list|()
operator|.
name|p2
argument_list|()
argument_list|)
expr_stmt|;
name|QPainterPath
name|p
init|=
name|ps
operator|.
name|createStroke
argument_list|(
name|path
argument_list|)
decl_stmt|;
name|p
operator|.
name|addPath
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|shape
argument_list|()
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QPen
name|linePen
decl_stmt|;
name|linePen
operator|.
name|setWidthF
argument_list|(
literal|5.0
argument_list|)
expr_stmt|;
name|linePen
operator|.
name|setCapStyle
argument_list|(
name|Qt
operator|::
name|RoundCap
argument_list|)
expr_stmt|;
name|line
operator|.
name|setPen
argument_list|(
name|linePen
argument_list|)
expr_stmt|;
name|ps
operator|.
name|setCapStyle
argument_list|(
name|line
operator|.
name|pen
argument_list|()
operator|.
name|capStyle
argument_list|()
argument_list|)
expr_stmt|;
name|ps
operator|.
name|setWidth
argument_list|(
name|line
operator|.
name|pen
argument_list|()
operator|.
name|widthF
argument_list|()
argument_list|)
expr_stmt|;
name|p
operator|=
name|ps
operator|.
name|createStroke
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|p
operator|.
name|addPath
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|shape
argument_list|()
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|linePen
operator|.
name|setCapStyle
argument_list|(
name|Qt
operator|::
name|FlatCap
argument_list|)
expr_stmt|;
name|line
operator|.
name|setPen
argument_list|(
name|linePen
argument_list|)
expr_stmt|;
name|ps
operator|.
name|setCapStyle
argument_list|(
name|line
operator|.
name|pen
argument_list|()
operator|.
name|capStyle
argument_list|()
argument_list|)
expr_stmt|;
name|p
operator|=
name|ps
operator|.
name|createStroke
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|p
operator|.
name|addPath
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|shape
argument_list|()
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|linePen
operator|.
name|setCapStyle
argument_list|(
name|Qt
operator|::
name|SquareCap
argument_list|)
expr_stmt|;
name|line
operator|.
name|setPen
argument_list|(
name|linePen
argument_list|)
expr_stmt|;
name|ps
operator|.
name|setCapStyle
argument_list|(
name|line
operator|.
name|pen
argument_list|()
operator|.
name|capStyle
argument_list|()
argument_list|)
expr_stmt|;
name|p
operator|=
name|ps
operator|.
name|createStroke
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|p
operator|.
name|addPath
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|shape
argument_list|()
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
name|rect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|rect
operator|.
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QPainterPathStroker
name|ps1
decl_stmt|;
name|ps1
operator|.
name|setWidth
argument_list|(
name|penWidthZero
argument_list|)
expr_stmt|;
name|path
operator|=
name|QPainterPath
argument_list|()
expr_stmt|;
name|path
operator|.
name|addRect
argument_list|(
name|rect
operator|.
name|rect
argument_list|()
argument_list|)
expr_stmt|;
name|p
operator|=
name|ps1
operator|.
name|createStroke
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|p
operator|.
name|addPath
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|.
name|shape
argument_list|()
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QGraphicsEllipseItem
name|ellipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|ellipse
operator|.
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QPainterPathStroker
name|ps2
decl_stmt|;
name|ps2
operator|.
name|setWidth
argument_list|(
name|ellipse
operator|.
name|pen
argument_list|()
operator|.
name|widthF
argument_list|()
operator|<=
literal|0.0
condition|?
name|penWidthZero
else|:
name|ellipse
operator|.
name|pen
argument_list|()
operator|.
name|widthF
argument_list|()
argument_list|)
expr_stmt|;
name|path
operator|=
name|QPainterPath
argument_list|()
expr_stmt|;
name|path
operator|.
name|addEllipse
argument_list|(
name|ellipse
operator|.
name|rect
argument_list|()
argument_list|)
expr_stmt|;
name|p
operator|=
name|ps2
operator|.
name|createStroke
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|p
operator|.
name|addPath
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|ellipse
operator|.
name|shape
argument_list|()
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QPainterPathStroker
name|ps3
decl_stmt|;
name|ps3
operator|.
name|setWidth
argument_list|(
name|penWidthZero
argument_list|)
expr_stmt|;
name|p
operator|=
name|ps3
operator|.
name|createStroke
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|p
operator|.
name|addPath
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|QGraphicsPathItem
name|pathItem
argument_list|(
name|path
argument_list|)
decl_stmt|;
name|pathItem
operator|.
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|pathItem
operator|.
name|shape
argument_list|()
argument_list|,
name|p
argument_list|)
expr_stmt|;
name|QRegion
name|region
argument_list|(
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|200
argument_list|)
argument_list|)
decl_stmt|;
name|region
operator|=
name|region
operator|.
name|subtracted
argument_list|(
name|QRect
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|200
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QImage
name|image
argument_list|(
literal|300
argument_list|,
literal|200
argument_list|,
name|QImage
operator|::
name|Format_ARGB32_Premultiplied
argument_list|)
decl_stmt|;
name|image
operator|.
name|fill
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QPainter
name|painter
argument_list|(
operator|&
name|image
argument_list|)
decl_stmt|;
name|painter
operator|.
name|setClipRegion
argument_list|(
name|region
argument_list|)
expr_stmt|;
name|painter
operator|.
name|fillRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|200
argument_list|,
name|Qt
operator|::
name|green
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
name|QPixmap
name|pixmap
init|=
name|QPixmap
operator|::
name|fromImage
argument_list|(
name|image
argument_list|)
decl_stmt|;
name|QGraphicsPixmapItem
name|pixmapItem
argument_list|(
name|pixmap
argument_list|)
decl_stmt|;
name|path
operator|=
name|QPainterPath
argument_list|()
expr_stmt|;
name|path
operator|.
name|addRegion
argument_list|(
name|region
argument_list|)
expr_stmt|;
block|{
name|QBitmap
name|bitmap
argument_list|(
literal|300
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|bitmap
operator|.
name|clear
argument_list|()
expr_stmt|;
name|QPainter
name|painter
argument_list|(
operator|&
name|bitmap
argument_list|)
decl_stmt|;
name|painter
operator|.
name|setClipRegion
argument_list|(
name|region
argument_list|)
expr_stmt|;
name|painter
operator|.
name|fillRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|200
argument_list|,
name|Qt
operator|::
name|color1
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
name|QBitmap
name|bitmap2
argument_list|(
literal|300
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|bitmap2
operator|.
name|clear
argument_list|()
expr_stmt|;
name|painter
operator|.
name|begin
argument_list|(
operator|&
name|bitmap2
argument_list|)
expr_stmt|;
name|painter
operator|.
name|setClipPath
argument_list|(
name|pixmapItem
operator|.
name|shape
argument_list|()
argument_list|)
expr_stmt|;
name|painter
operator|.
name|fillRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|200
argument_list|,
name|Qt
operator|::
name|color1
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|bitmap
operator|.
name|toImage
argument_list|()
argument_list|,
name|bitmap2
operator|.
name|toImage
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|QPolygonF
name|poly
decl_stmt|;
name|poly
operator|<<
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QGraphicsPolygonItem
name|polygon
argument_list|(
name|poly
argument_list|)
decl_stmt|;
name|polygon
operator|.
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|path
operator|=
name|QPainterPath
argument_list|()
expr_stmt|;
name|path
operator|.
name|addPolygon
argument_list|(
name|poly
argument_list|)
expr_stmt|;
name|QPainterPathStroker
name|ps4
decl_stmt|;
name|ps4
operator|.
name|setWidth
argument_list|(
name|penWidthZero
argument_list|)
expr_stmt|;
name|p
operator|=
name|ps4
operator|.
name|createStroke
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|p
operator|.
name|addPath
argument_list|(
name|path
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|polygon
operator|.
name|shape
argument_list|()
argument_list|,
name|p
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|contains
name|void
name|tst_QGraphicsItem
operator|::
name|contains
parameter_list|()
block|{
if|if
condition|(
sizeof|sizeof
argument_list|(
name|qreal
argument_list|)
operator|!=
sizeof|sizeof
argument_list|(
name|double
argument_list|)
condition|)
name|QSKIP
argument_list|(
literal|"Skipped due to rounding errors"
argument_list|)
expr_stmt|;
comment|// Rect
name|QGraphicsRectItem
name|rect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|11
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|11
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|9
argument_list|,
literal|9
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// Ellipse
name|QGraphicsEllipseItem
name|ellipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|ellipse
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|ellipse
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|9
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|ellipse
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
operator|-
literal|9
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|ellipse
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|ellipse
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|9
argument_list|,
literal|9
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// Line
name|QGraphicsLineItem
name|line
argument_list|(
name|QLineF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|line
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|line
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|line
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|line
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|line
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|line
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|9
argument_list|,
operator|-
literal|9
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|line
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|9
argument_list|,
literal|9
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// Polygon
name|QGraphicsPolygonItem
name|polygon
argument_list|(
name|QPolygonF
argument_list|()
operator|<<
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|polygon
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|polygon
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|4
argument_list|,
literal|4
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|polygon
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|1
argument_list|,
literal|4
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|polygon
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|4
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|polygon
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|8
argument_list|,
literal|8
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|polygon
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|1
argument_list|,
literal|8
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|polygon
operator|.
name|contains
argument_list|(
name|QPointF
argument_list|(
literal|8
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|collidesWith_item
name|void
name|tst_QGraphicsItem
operator|::
name|collidesWith_item
parameter_list|()
block|{
comment|// Rectangle
name|QGraphicsRectItem
name|rect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
name|rect2
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rect
operator|.
name|collidesWithItem
argument_list|(
operator|&
name|rect2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect2
operator|.
name|collidesWithItem
argument_list|(
operator|&
name|rect
argument_list|)
argument_list|)
expr_stmt|;
name|rect2
operator|.
name|setPos
argument_list|(
literal|21
argument_list|,
literal|21
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect
operator|.
name|collidesWithItem
argument_list|(
operator|&
name|rect2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect2
operator|.
name|collidesWithItem
argument_list|(
operator|&
name|rect
argument_list|)
argument_list|)
expr_stmt|;
name|rect2
operator|.
name|setPos
argument_list|(
operator|-
literal|21
argument_list|,
operator|-
literal|21
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect
operator|.
name|collidesWithItem
argument_list|(
operator|&
name|rect2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect2
operator|.
name|collidesWithItem
argument_list|(
operator|&
name|rect
argument_list|)
argument_list|)
expr_stmt|;
name|rect2
operator|.
name|setPos
argument_list|(
operator|-
literal|17
argument_list|,
operator|-
literal|17
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect
operator|.
name|collidesWithItem
argument_list|(
operator|&
name|rect2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect2
operator|.
name|collidesWithItem
argument_list|(
operator|&
name|rect
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsEllipseItem
name|ellipse
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsEllipseItem
name|ellipse2
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|ellipse
operator|.
name|collidesWithItem
argument_list|(
operator|&
name|ellipse2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|ellipse2
operator|.
name|collidesWithItem
argument_list|(
operator|&
name|ellipse
argument_list|)
argument_list|)
expr_stmt|;
name|ellipse2
operator|.
name|setPos
argument_list|(
literal|21
argument_list|,
literal|21
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|ellipse
operator|.
name|collidesWithItem
argument_list|(
operator|&
name|ellipse2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|ellipse2
operator|.
name|collidesWithItem
argument_list|(
operator|&
name|ellipse
argument_list|)
argument_list|)
expr_stmt|;
name|ellipse2
operator|.
name|setPos
argument_list|(
operator|-
literal|21
argument_list|,
operator|-
literal|21
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|ellipse
operator|.
name|collidesWithItem
argument_list|(
operator|&
name|ellipse2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|ellipse2
operator|.
name|collidesWithItem
argument_list|(
operator|&
name|ellipse
argument_list|)
argument_list|)
expr_stmt|;
name|ellipse2
operator|.
name|setPos
argument_list|(
operator|-
literal|17
argument_list|,
operator|-
literal|17
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|ellipse
operator|.
name|collidesWithItem
argument_list|(
operator|&
name|ellipse2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|ellipse2
operator|.
name|collidesWithItem
argument_list|(
operator|&
name|ellipse
argument_list|)
argument_list|)
expr_stmt|;
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
name|rect
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|rect
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
name|rect2
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|rect2
argument_list|)
expr_stmt|;
name|rect2
operator|.
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QGraphicsLineItem
name|line
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|line
argument_list|)
expr_stmt|;
name|line
operator|.
name|setZValue
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|col1
init|=
name|rect
operator|.
name|collidingItems
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|col1
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|col1
operator|.
name|first
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
operator|&
name|line
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|col1
operator|.
name|last
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
operator|&
name|rect2
argument_list|)
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|col2
init|=
name|rect2
operator|.
name|collidingItems
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|col2
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|col2
operator|.
name|first
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
operator|&
name|line
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|col2
operator|.
name|last
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
operator|&
name|rect
argument_list|)
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|col3
init|=
name|line
operator|.
name|collidingItems
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|col3
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|col3
operator|.
name|first
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
operator|&
name|rect2
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|col3
operator|.
name|last
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
operator|&
name|rect
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|collidesWith_path_data
name|void
name|tst_QGraphicsItem
operator|::
name|collidesWith_path_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QPointF
argument_list|>
argument_list|(
literal|"pos"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QMatrix
argument_list|>
argument_list|(
literal|"matrix"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QPainterPath
argument_list|>
argument_list|(
literal|"shape"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"rectCollides"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"ellipseCollides"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"nothing"
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|QPainterPath
argument_list|()
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QPainterPath
name|rect
decl_stmt|;
name|rect
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"rect1"
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|rect
operator|<<
literal|true
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"rect2"
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
name|QMatrix
argument_list|()
operator|.
name|translate
argument_list|(
literal|21
argument_list|,
literal|21
argument_list|)
operator|<<
name|rect
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"rect3"
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|21
argument_list|,
literal|21
argument_list|)
operator|<<
name|QMatrix
argument_list|()
operator|<<
name|rect
operator|<<
literal|false
operator|<<
literal|false
expr_stmt|;
block|}
end_function
begin_function
DECL|function|collidesWith_path
name|void
name|tst_QGraphicsItem
operator|::
name|collidesWith_path
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QPointF
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QMatrix
argument_list|,
name|matrix
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QPainterPath
argument_list|,
name|shape
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|rectCollides
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|ellipseCollides
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
name|rect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsEllipseItem
name|ellipse
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|rect
operator|.
name|setPos
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|rect
operator|.
name|setMatrix
argument_list|(
name|matrix
argument_list|)
expr_stmt|;
name|ellipse
operator|.
name|setPos
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|ellipse
operator|.
name|setMatrix
argument_list|(
name|matrix
argument_list|)
expr_stmt|;
name|QPainterPath
name|mappedShape
init|=
name|rect
operator|.
name|sceneMatrix
argument_list|()
operator|.
name|inverted
argument_list|()
operator|.
name|map
argument_list|(
name|shape
argument_list|)
decl_stmt|;
if|if
condition|(
name|rectCollides
condition|)
name|QVERIFY
argument_list|(
name|rect
operator|.
name|collidesWithPath
argument_list|(
name|mappedShape
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|QVERIFY
argument_list|(
operator|!
name|rect
operator|.
name|collidesWithPath
argument_list|(
name|mappedShape
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ellipseCollides
condition|)
name|QVERIFY
argument_list|(
name|ellipse
operator|.
name|collidesWithPath
argument_list|(
name|mappedShape
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|QVERIFY
argument_list|(
operator|!
name|ellipse
operator|.
name|collidesWithPath
argument_list|(
name|mappedShape
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|collidesWithItemWithClip
name|void
name|tst_QGraphicsItem
operator|::
name|collidesWithItemWithClip
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsEllipseItem
modifier|*
name|ellipse
init|=
name|scene
operator|.
name|addEllipse
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|ellipse
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|QGraphicsEllipseItem
modifier|*
name|ellipse2
init|=
name|scene
operator|.
name|addEllipse
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|ellipse2
operator|->
name|setParentItem
argument_list|(
name|ellipse
argument_list|)
expr_stmt|;
name|QGraphicsEllipseItem
modifier|*
name|ellipse3
init|=
name|scene
operator|.
name|addEllipse
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|ellipse3
operator|->
name|setParentItem
argument_list|(
name|ellipse
argument_list|)
expr_stmt|;
name|QGraphicsEllipseItem
modifier|*
name|ellipse5
init|=
name|scene
operator|.
name|addEllipse
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|ellipse5
operator|->
name|setParentItem
argument_list|(
name|ellipse
argument_list|)
expr_stmt|;
name|QGraphicsEllipseItem
modifier|*
name|ellipse4
init|=
name|scene
operator|.
name|addEllipse
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|ellipse2
operator|->
name|collidesWithItem
argument_list|(
name|ellipse3
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|ellipse3
operator|->
name|collidesWithItem
argument_list|(
name|ellipse2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|ellipse2
operator|->
name|collidesWithItem
argument_list|(
name|ellipse
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|ellipse
operator|->
name|collidesWithItem
argument_list|(
name|ellipse2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|ellipse4
operator|->
name|collidesWithItem
argument_list|(
name|ellipse
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|ellipse4
operator|->
name|collidesWithItem
argument_list|(
name|ellipse2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|ellipse4
operator|->
name|collidesWithItem
argument_list|(
name|ellipse3
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|ellipse
operator|->
name|collidesWithItem
argument_list|(
name|ellipse4
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|ellipse2
operator|->
name|collidesWithItem
argument_list|(
name|ellipse4
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|ellipse3
operator|->
name|collidesWithItem
argument_list|(
name|ellipse4
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|ellipse
operator|->
name|collidesWithItem
argument_list|(
name|ellipse5
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|ellipse5
operator|->
name|collidesWithItem
argument_list|(
name|ellipse
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|MyItem
class|class
name|MyItem
super|:
specifier|public
name|QGraphicsEllipseItem
block|{
public|public:
DECL|function|isObscuredBy
name|bool
name|isObscuredBy
parameter_list|(
specifier|const
name|QGraphicsItem
modifier|*
name|item
parameter_list|)
specifier|const
block|{
specifier|const
name|MyItem
modifier|*
name|myItem
init|=
name|qgraphicsitem_cast
argument_list|<
specifier|const
name|MyItem
operator|*
argument_list|>
argument_list|(
name|item
argument_list|)
decl_stmt|;
if|if
condition|(
name|myItem
condition|)
block|{
if|if
condition|(
name|item
operator|->
name|zValue
argument_list|()
operator|>
name|zValue
argument_list|()
condition|)
block|{
name|QRectF
name|r
init|=
name|rect
argument_list|()
decl_stmt|;
name|QPointF
name|topMid
init|=
operator|(
name|r
operator|.
name|topRight
argument_list|()
operator|+
name|r
operator|.
name|topLeft
argument_list|()
operator|)
operator|/
literal|2
decl_stmt|;
name|QPointF
name|botMid
init|=
operator|(
name|r
operator|.
name|bottomRight
argument_list|()
operator|+
name|r
operator|.
name|bottomLeft
argument_list|()
operator|)
operator|/
literal|2
decl_stmt|;
name|QPointF
name|leftMid
init|=
operator|(
name|r
operator|.
name|topLeft
argument_list|()
operator|+
name|r
operator|.
name|bottomLeft
argument_list|()
operator|)
operator|/
literal|2
decl_stmt|;
name|QPointF
name|rightMid
init|=
operator|(
name|r
operator|.
name|topRight
argument_list|()
operator|+
name|r
operator|.
name|bottomRight
argument_list|()
operator|)
operator|/
literal|2
decl_stmt|;
name|QPainterPath
name|mappedShape
init|=
name|item
operator|->
name|mapToItem
argument_list|(
name|this
argument_list|,
name|item
operator|->
name|opaqueArea
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|mappedShape
operator|.
name|contains
argument_list|(
name|topMid
argument_list|)
operator|&&
name|mappedShape
operator|.
name|contains
argument_list|(
name|botMid
argument_list|)
operator|&&
name|mappedShape
operator|.
name|contains
argument_list|(
name|leftMid
argument_list|)
operator|&&
name|mappedShape
operator|.
name|contains
argument_list|(
name|rightMid
argument_list|)
condition|)
return|return
literal|true
return|;
else|else
return|return
literal|false
return|;
block|}
else|else
return|return
literal|false
return|;
block|}
else|else
return|return
name|QGraphicsItem
operator|::
name|isObscuredBy
argument_list|(
name|item
argument_list|)
return|;
block|}
DECL|function|opaqueArea
name|QPainterPath
name|opaqueArea
parameter_list|()
specifier|const
block|{
return|return
name|shape
argument_list|()
return|;
block|}
enum|enum
block|{
DECL|enumerator|Type
name|Type
init|=
name|UserType
operator|+
literal|1
block|}
enum|;
DECL|function|type
name|int
name|type
parameter_list|()
specifier|const
block|{
return|return
name|Type
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|isObscuredBy
name|void
name|tst_QGraphicsItem
operator|::
name|isObscuredBy
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|MyItem
name|myitem1
decl_stmt|,
name|myitem2
decl_stmt|;
name|myitem1
operator|.
name|setRect
argument_list|(
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|40
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|myitem1
operator|.
name|rotate
argument_list|(
literal|67
argument_list|)
expr_stmt|;
name|myitem2
operator|.
name|setRect
argument_list|(
name|QRectF
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|myitem2
operator|.
name|setZValue
argument_list|(
operator|-
literal|1.0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|myitem1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|myitem2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|myitem2
operator|.
name|isObscuredBy
argument_list|(
operator|&
name|myitem1
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|myitem1
operator|.
name|isObscuredBy
argument_list|(
operator|&
name|myitem2
argument_list|)
argument_list|)
expr_stmt|;
name|myitem2
operator|.
name|setRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|50
argument_list|,
literal|85
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|myitem2
operator|.
name|isObscuredBy
argument_list|(
operator|&
name|myitem1
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|myitem1
operator|.
name|isObscuredBy
argument_list|(
operator|&
name|myitem2
argument_list|)
argument_list|)
expr_stmt|;
name|myitem2
operator|.
name|setRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
literal|70
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|myitem2
operator|.
name|isObscuredBy
argument_list|(
operator|&
name|myitem1
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|myitem1
operator|.
name|isObscuredBy
argument_list|(
operator|&
name|myitem2
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
name|rect1
decl_stmt|,
name|rect2
decl_stmt|;
name|rect1
operator|.
name|setRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|40
argument_list|,
operator|-
literal|40
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|rect1
operator|.
name|setBrush
argument_list|(
name|QBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
argument_list|)
expr_stmt|;
name|rect2
operator|.
name|setRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|20
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|rect2
operator|.
name|setZValue
argument_list|(
operator|-
literal|1.0
argument_list|)
expr_stmt|;
name|rect2
operator|.
name|setBrush
argument_list|(
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect2
operator|.
name|isObscuredBy
argument_list|(
operator|&
name|rect1
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect1
operator|.
name|isObscuredBy
argument_list|(
operator|&
name|rect2
argument_list|)
argument_list|)
expr_stmt|;
name|rect2
operator|.
name|setPos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|20
argument_list|,
operator|-
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect2
operator|.
name|isObscuredBy
argument_list|(
operator|&
name|rect1
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect1
operator|.
name|isObscuredBy
argument_list|(
operator|&
name|rect2
argument_list|)
argument_list|)
expr_stmt|;
name|rect2
operator|.
name|setPos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect2
operator|.
name|isObscuredBy
argument_list|(
operator|&
name|rect1
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect1
operator|.
name|isObscuredBy
argument_list|(
operator|&
name|rect2
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|OpaqueItem
class|class
name|OpaqueItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
protected|protected:
DECL|function|opaqueArea
name|QPainterPath
name|opaqueArea
parameter_list|()
specifier|const
block|{
return|return
name|shape
argument_list|()
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|isObscured
name|void
name|tst_QGraphicsItem
operator|::
name|isObscured
parameter_list|()
block|{
if|if
condition|(
sizeof|sizeof
argument_list|(
name|qreal
argument_list|)
operator|!=
sizeof|sizeof
argument_list|(
name|double
argument_list|)
condition|)
name|QSKIP
argument_list|(
literal|"Skipped due to rounding errors"
argument_list|)
expr_stmt|;
name|OpaqueItem
modifier|*
name|item1
init|=
operator|new
name|OpaqueItem
decl_stmt|;
name|item1
operator|->
name|setRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|OpaqueItem
modifier|*
name|item2
init|=
operator|new
name|OpaqueItem
decl_stmt|;
name|item2
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isObscured
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isObscuredBy
argument_list|(
name|item2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isObscured
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isObscured
argument_list|(
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isObscured
argument_list|(
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isObscured
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isObscured
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isObscured
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isObscured
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isObscured
argument_list|(
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscuredBy
argument_list|(
name|item1
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|(
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|(
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|(
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|item2
operator|->
name|moveBy
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isObscured
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isObscuredBy
argument_list|(
name|item2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isObscured
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isObscured
argument_list|(
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isObscured
argument_list|(
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isObscured
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isObscured
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isObscured
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|isObscured
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|isObscured
argument_list|(
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscuredBy
argument_list|(
name|item1
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|(
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|(
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isObscured
argument_list|(
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|mapFromToParent
name|void
name|tst_QGraphicsItem
operator|::
name|mapFromToParent
parameter_list|()
block|{
name|QPainterPath
name|path1
decl_stmt|;
name|path1
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QPainterPath
name|path2
decl_stmt|;
name|path2
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QPainterPath
name|path3
decl_stmt|;
name|path3
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|QPainterPath
name|path4
decl_stmt|;
name|path4
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item1
init|=
operator|new
name|QGraphicsPathItem
argument_list|(
name|path1
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item2
init|=
operator|new
name|QGraphicsPathItem
argument_list|(
name|path2
argument_list|,
name|item1
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item3
init|=
operator|new
name|QGraphicsPathItem
argument_list|(
name|path3
argument_list|,
name|item2
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item4
init|=
operator|new
name|QGraphicsPathItem
argument_list|(
name|path4
argument_list|,
name|item3
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|item3
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|item4
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|4
condition|;
operator|++
name|i
control|)
block|{
name|QMatrix
name|matrix
decl_stmt|;
name|matrix
operator|.
name|rotate
argument_list|(
name|i
operator|*
literal|90
argument_list|)
expr_stmt|;
name|matrix
operator|.
name|translate
argument_list|(
name|i
operator|*
literal|100
argument_list|,
operator|-
name|i
operator|*
literal|100
argument_list|)
expr_stmt|;
name|matrix
operator|.
name|scale
argument_list|(
literal|2
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setMatrix
argument_list|(
name|matrix
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapToParent
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item1
operator|->
name|pos
argument_list|()
operator|+
name|matrix
operator|.
name|map
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapToParent
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item2
operator|->
name|pos
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapToParent
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item3
operator|->
name|pos
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapToParent
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item4
operator|->
name|pos
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapToParent
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
argument_list|,
name|item1
operator|->
name|pos
argument_list|()
operator|+
name|matrix
operator|.
name|map
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapToParent
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
argument_list|,
name|item2
operator|->
name|pos
argument_list|()
operator|+
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapToParent
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
argument_list|,
name|item3
operator|->
name|pos
argument_list|()
operator|+
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapToParent
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
argument_list|,
name|item4
operator|->
name|pos
argument_list|()
operator|+
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapToParent
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|item1
operator|->
name|pos
argument_list|()
operator|+
name|matrix
operator|.
name|map
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapToParent
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|item2
operator|->
name|pos
argument_list|()
operator|+
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapToParent
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|item3
operator|->
name|pos
argument_list|()
operator|+
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapToParent
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|item4
operator|->
name|pos
argument_list|()
operator|+
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromParent
argument_list|(
name|item1
operator|->
name|pos
argument_list|()
argument_list|)
argument_list|,
name|matrix
operator|.
name|inverted
argument_list|()
operator|.
name|map
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromParent
argument_list|(
name|item2
operator|->
name|pos
argument_list|()
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromParent
argument_list|(
name|item3
operator|->
name|pos
argument_list|()
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromParent
argument_list|(
name|item4
operator|->
name|pos
argument_list|()
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromParent
argument_list|(
name|item1
operator|->
name|pos
argument_list|()
operator|+
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
argument_list|,
name|matrix
operator|.
name|inverted
argument_list|()
operator|.
name|map
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromParent
argument_list|(
name|item2
operator|->
name|pos
argument_list|()
operator|+
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromParent
argument_list|(
name|item3
operator|->
name|pos
argument_list|()
operator|+
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromParent
argument_list|(
name|item4
operator|->
name|pos
argument_list|()
operator|+
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromParent
argument_list|(
name|item1
operator|->
name|pos
argument_list|()
operator|+
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|matrix
operator|.
name|inverted
argument_list|()
operator|.
name|map
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromParent
argument_list|(
name|item2
operator|->
name|pos
argument_list|()
operator|+
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromParent
argument_list|(
name|item3
operator|->
name|pos
argument_list|()
operator|+
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromParent
argument_list|(
name|item4
operator|->
name|pos
argument_list|()
operator|+
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
block|}
operator|delete
name|item1
expr_stmt|;
block|}
end_function
begin_function
DECL|function|mapFromToScene
name|void
name|tst_QGraphicsItem
operator|::
name|mapFromToScene
parameter_list|()
block|{
name|QGraphicsItem
modifier|*
name|item1
init|=
operator|new
name|QGraphicsPathItem
argument_list|(
name|QPainterPath
argument_list|()
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item2
init|=
operator|new
name|QGraphicsPathItem
argument_list|(
name|QPainterPath
argument_list|()
argument_list|,
name|item1
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item3
init|=
operator|new
name|QGraphicsPathItem
argument_list|(
name|QPainterPath
argument_list|()
argument_list|,
name|item2
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item4
init|=
operator|new
name|QGraphicsPathItem
argument_list|(
name|QPainterPath
argument_list|()
argument_list|,
name|item3
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|item3
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|item4
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|pos
argument_list|()
argument_list|,
name|item1
operator|->
name|mapToParent
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|pos
argument_list|()
argument_list|,
name|item2
operator|->
name|mapToParent
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|pos
argument_list|()
argument_list|,
name|item3
operator|->
name|mapToParent
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|pos
argument_list|()
argument_list|,
name|item4
operator|->
name|mapToParent
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapToParent
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|110
argument_list|,
literal|110
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapToParent
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|110
argument_list|,
literal|110
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapToParent
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|110
argument_list|,
literal|110
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapToParent
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|110
argument_list|,
literal|110
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|300
argument_list|,
literal|300
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|400
argument_list|,
literal|400
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|110
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|210
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|310
argument_list|,
literal|300
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|410
argument_list|,
literal|400
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromScene
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromScene
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromScene
argument_list|(
literal|300
argument_list|,
literal|300
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromScene
argument_list|(
literal|400
argument_list|,
literal|400
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromScene
argument_list|(
literal|110
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromScene
argument_list|(
literal|210
argument_list|,
literal|200
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromScene
argument_list|(
literal|310
argument_list|,
literal|300
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromScene
argument_list|(
literal|410
argument_list|,
literal|400
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
comment|// Rotate item1 90 degrees clockwise
name|QMatrix
name|matrix
decl_stmt|;
name|matrix
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setMatrix
argument_list|(
name|matrix
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|pos
argument_list|()
argument_list|,
name|item1
operator|->
name|mapToParent
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|pos
argument_list|()
argument_list|,
name|item2
operator|->
name|mapToParent
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|pos
argument_list|()
argument_list|,
name|item3
operator|->
name|mapToParent
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|pos
argument_list|()
argument_list|,
name|item4
operator|->
name|mapToParent
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapToParent
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
literal|110
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapToParent
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|110
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapToParent
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|110
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapToParent
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|110
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|100
argument_list|,
literal|300
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|200
argument_list|,
literal|400
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
literal|110
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|210
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|100
argument_list|,
literal|310
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|200
argument_list|,
literal|410
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromScene
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|200
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromScene
argument_list|(
operator|-
literal|100
argument_list|,
literal|300
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromScene
argument_list|(
operator|-
literal|200
argument_list|,
literal|400
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromScene
argument_list|(
literal|100
argument_list|,
literal|110
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|210
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromScene
argument_list|(
operator|-
literal|100
argument_list|,
literal|310
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromScene
argument_list|(
operator|-
literal|200
argument_list|,
literal|410
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
comment|// Rotate item2 90 degrees clockwise
name|item2
operator|->
name|setMatrix
argument_list|(
name|matrix
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|pos
argument_list|()
argument_list|,
name|item1
operator|->
name|mapToParent
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|pos
argument_list|()
argument_list|,
name|item2
operator|->
name|mapToParent
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|pos
argument_list|()
argument_list|,
name|item3
operator|->
name|mapToParent
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|pos
argument_list|()
argument_list|,
name|item4
operator|->
name|mapToParent
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapToParent
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
literal|110
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapToParent
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
literal|110
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapToParent
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|110
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapToParent
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|110
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|200
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
literal|110
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|110
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|210
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromScene
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|200
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromScene
argument_list|(
operator|-
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromScene
argument_list|(
operator|-
literal|200
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromScene
argument_list|(
literal|100
argument_list|,
literal|110
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromScene
argument_list|(
operator|-
literal|10
argument_list|,
literal|200
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromScene
argument_list|(
operator|-
literal|110
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromScene
argument_list|(
operator|-
literal|210
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
comment|// Translate item3 50 points, then rotate 90 degrees counterclockwise
name|QMatrix
name|matrix2
decl_stmt|;
name|matrix2
operator|.
name|translate
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|matrix2
operator|.
name|rotate
argument_list|(
operator|-
literal|90
argument_list|)
expr_stmt|;
name|item3
operator|->
name|setMatrix
argument_list|(
name|matrix2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|pos
argument_list|()
argument_list|,
name|item1
operator|->
name|mapToParent
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|pos
argument_list|()
argument_list|,
name|item2
operator|->
name|mapToParent
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|pos
argument_list|()
argument_list|,
name|item3
operator|->
name|mapToParent
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|-
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|pos
argument_list|()
argument_list|,
name|item4
operator|->
name|mapToParent
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapToParent
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
literal|110
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapToParent
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
literal|110
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapToParent
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|150
argument_list|,
literal|90
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapToParent
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|110
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|150
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapToScene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|250
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
literal|110
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|150
argument_list|,
literal|110
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|250
argument_list|,
literal|210
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromScene
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromScene
argument_list|(
literal|0
argument_list|,
literal|200
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromScene
argument_list|(
operator|-
literal|150
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromScene
argument_list|(
operator|-
literal|250
argument_list|,
literal|200
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromScene
argument_list|(
literal|100
argument_list|,
literal|110
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromScene
argument_list|(
operator|-
literal|10
argument_list|,
literal|200
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromScene
argument_list|(
operator|-
literal|150
argument_list|,
literal|110
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromScene
argument_list|(
operator|-
literal|250
argument_list|,
literal|210
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
operator|delete
name|item1
expr_stmt|;
block|}
end_function
begin_function
DECL|function|mapFromToItem
name|void
name|tst_QGraphicsItem
operator|::
name|mapFromToItem
parameter_list|()
block|{
name|QGraphicsItem
modifier|*
name|item1
init|=
operator|new
name|QGraphicsPathItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item2
init|=
operator|new
name|QGraphicsPathItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item3
init|=
operator|new
name|QGraphicsPathItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item4
init|=
operator|new
name|QGraphicsPathItem
decl_stmt|;
name|item1
operator|->
name|setPos
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
expr_stmt|;
name|item3
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|item4
operator|->
name|setPos
argument_list|(
operator|-
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromItem
argument_list|(
name|item2
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|200
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromItem
argument_list|(
name|item3
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromItem
argument_list|(
name|item4
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|200
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromItem
argument_list|(
name|item1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
operator|-
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromItem
argument_list|(
name|item4
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromItem
argument_list|(
name|item1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|200
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromItem
argument_list|(
name|item2
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
operator|-
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromItem
argument_list|(
name|item3
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|200
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QMatrix
name|matrix
decl_stmt|;
name|matrix
operator|.
name|translate
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setMatrix
argument_list|(
name|matrix
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromItem
argument_list|(
name|item2
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromItem
argument_list|(
name|item3
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromItem
argument_list|(
name|item4
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|200
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromItem
argument_list|(
name|item1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromItem
argument_list|(
name|item4
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromItem
argument_list|(
name|item1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromItem
argument_list|(
name|item2
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
operator|-
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromItem
argument_list|(
name|item3
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|200
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|matrix
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setMatrix
argument_list|(
name|matrix
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setMatrix
argument_list|(
name|matrix
argument_list|)
expr_stmt|;
name|item3
operator|->
name|setMatrix
argument_list|(
name|matrix
argument_list|)
expr_stmt|;
name|item4
operator|->
name|setMatrix
argument_list|(
name|matrix
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromItem
argument_list|(
name|item2
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
operator|-
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromItem
argument_list|(
name|item3
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|200
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromItem
argument_list|(
name|item4
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromItem
argument_list|(
name|item1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|200
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromItem
argument_list|(
name|item4
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|200
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromItem
argument_list|(
name|item1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromItem
argument_list|(
name|item2
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|200
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromItem
argument_list|(
name|item3
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
operator|-
literal|200
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromItem
argument_list|(
name|item2
argument_list|,
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|205
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromItem
argument_list|(
name|item3
argument_list|,
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|210
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromItem
argument_list|(
name|item4
argument_list|,
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|195
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromItem
argument_list|(
name|item1
argument_list|,
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|190
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromItem
argument_list|(
name|item4
argument_list|,
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|210
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromItem
argument_list|(
name|item1
argument_list|,
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|195
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromItem
argument_list|(
name|item2
argument_list|,
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|190
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromItem
argument_list|(
name|item3
argument_list|,
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
operator|-
literal|205
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapFromItem
argument_list|(
literal|0
argument_list|,
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|item1
operator|->
name|mapFromScene
argument_list|(
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapFromItem
argument_list|(
literal|0
argument_list|,
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|item2
operator|->
name|mapFromScene
argument_list|(
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapFromItem
argument_list|(
literal|0
argument_list|,
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|item3
operator|->
name|mapFromScene
argument_list|(
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapFromItem
argument_list|(
literal|0
argument_list|,
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|item4
operator|->
name|mapFromScene
argument_list|(
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|mapToItem
argument_list|(
literal|0
argument_list|,
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|item1
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|mapToItem
argument_list|(
literal|0
argument_list|,
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|item2
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|mapToItem
argument_list|(
literal|0
argument_list|,
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|item3
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item4
operator|->
name|mapToItem
argument_list|(
literal|0
argument_list|,
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|,
name|item4
operator|->
name|mapToScene
argument_list|(
literal|10
argument_list|,
operator|-
literal|5
argument_list|)
argument_list|)
expr_stmt|;
operator|delete
name|item1
expr_stmt|;
operator|delete
name|item2
expr_stmt|;
operator|delete
name|item3
expr_stmt|;
operator|delete
name|item4
expr_stmt|;
block|}
end_function
begin_function
DECL|function|mapRectFromToParent_data
name|void
name|tst_QGraphicsItem
operator|::
name|mapRectFromToParent_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"parent"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QPointF
argument_list|>
argument_list|(
literal|"parentPos"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QTransform
argument_list|>
argument_list|(
literal|"parentTransform"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QPointF
argument_list|>
argument_list|(
literal|"pos"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QTransform
argument_list|>
argument_list|(
literal|"transform"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QRectF
argument_list|>
argument_list|(
literal|"inputRect"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QRectF
argument_list|>
argument_list|(
literal|"outputRect"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"nil"
argument_list|)
operator|<<
literal|false
operator|<<
name|QPointF
argument_list|()
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QPointF
argument_list|()
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QRectF
argument_list|()
operator|<<
name|QRectF
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"simple"
argument_list|)
operator|<<
literal|false
operator|<<
name|QPointF
argument_list|()
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QPointF
argument_list|()
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"simple w/parent"
argument_list|)
operator|<<
literal|true
operator|<<
name|QPointF
argument_list|()
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QPointF
argument_list|()
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"simple w/parent parentPos"
argument_list|)
operator|<<
literal|true
operator|<<
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QPointF
argument_list|()
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"simple w/parent parentPos parentRotation"
argument_list|)
operator|<<
literal|true
operator|<<
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|rotate
argument_list|(
literal|45
argument_list|)
operator|<<
name|QPointF
argument_list|()
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pos w/parent"
argument_list|)
operator|<<
literal|true
operator|<<
name|QPointF
argument_list|()
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"rotation w/parent"
argument_list|)
operator|<<
literal|true
operator|<<
name|QPointF
argument_list|()
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QPointF
argument_list|()
operator|<<
name|QTransform
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pos rotation w/parent"
argument_list|)
operator|<<
literal|true
operator|<<
name|QPointF
argument_list|()
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|40
argument_list|,
literal|50
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pos rotation w/parent parentPos parentRotation"
argument_list|)
operator|<<
literal|true
operator|<<
name|QPointF
argument_list|(
operator|-
literal|170
argument_list|,
operator|-
literal|190
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|QRectF
argument_list|(
literal|40
argument_list|,
literal|50
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|mapRectFromToParent
name|void
name|tst_QGraphicsItem
operator|::
name|mapRectFromToParent
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|parent
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QPointF
argument_list|,
name|parentPos
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QTransform
argument_list|,
name|parentTransform
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QPointF
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QTransform
argument_list|,
name|transform
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QRectF
argument_list|,
name|inputRect
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QRectF
argument_list|,
name|outputRect
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|rect
operator|->
name|setPos
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setTransform
argument_list|(
name|transform
argument_list|)
expr_stmt|;
if|if
condition|(
name|parent
condition|)
block|{
name|QGraphicsRectItem
modifier|*
name|rectParent
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|rect
operator|->
name|setParentItem
argument_list|(
name|rectParent
argument_list|)
expr_stmt|;
name|rectParent
operator|->
name|setPos
argument_list|(
name|parentPos
argument_list|)
expr_stmt|;
name|rectParent
operator|->
name|setTransform
argument_list|(
name|parentTransform
argument_list|)
expr_stmt|;
block|}
comment|// Make sure we use non-destructive transform operations (e.g., 90 degree
comment|// rotations).
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|mapRectToParent
argument_list|(
name|inputRect
argument_list|)
argument_list|,
name|outputRect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|mapRectFromParent
argument_list|(
name|outputRect
argument_list|)
argument_list|,
name|inputRect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|itemTransform
argument_list|(
name|rect
operator|->
name|parentItem
argument_list|()
argument_list|)
operator|.
name|mapRect
argument_list|(
name|inputRect
argument_list|)
argument_list|,
name|outputRect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|mapToParent
argument_list|(
name|inputRect
argument_list|)
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|outputRect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|mapToParent
argument_list|(
name|QPolygonF
argument_list|(
name|inputRect
argument_list|)
argument_list|)
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|outputRect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|mapFromParent
argument_list|(
name|outputRect
argument_list|)
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|inputRect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|mapFromParent
argument_list|(
name|QPolygonF
argument_list|(
name|outputRect
argument_list|)
argument_list|)
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|inputRect
argument_list|)
expr_stmt|;
name|QPainterPath
name|inputPath
decl_stmt|;
name|inputPath
operator|.
name|addRect
argument_list|(
name|inputRect
argument_list|)
expr_stmt|;
name|QPainterPath
name|outputPath
decl_stmt|;
name|outputPath
operator|.
name|addRect
argument_list|(
name|outputRect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|mapToParent
argument_list|(
name|inputPath
argument_list|)
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|outputPath
operator|.
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|mapFromParent
argument_list|(
name|outputPath
argument_list|)
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|inputPath
operator|.
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|isAncestorOf
name|void
name|tst_QGraphicsItem
operator|::
name|isAncestorOf
parameter_list|()
block|{
name|QGraphicsItem
modifier|*
name|grandPa
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|child
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isAncestorOf
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isAncestorOf
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isAncestorOf
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isAncestorOf
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isAncestorOf
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setParentItem
argument_list|(
name|grandPa
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|isAncestorOf
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandPa
operator|->
name|isAncestorOf
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandPa
operator|->
name|isAncestorOf
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isAncestorOf
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isAncestorOf
argument_list|(
name|grandPa
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isAncestorOf
argument_list|(
name|grandPa
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|isAncestorOf
argument_list|(
name|child
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parent
operator|->
name|isAncestorOf
argument_list|(
name|parent
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandPa
operator|->
name|isAncestorOf
argument_list|(
name|grandPa
argument_list|)
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
operator|delete
name|child
expr_stmt|;
operator|delete
name|parent
expr_stmt|;
operator|delete
name|grandPa
expr_stmt|;
block|}
end_function
begin_function
DECL|function|commonAncestorItem
name|void
name|tst_QGraphicsItem
operator|::
name|commonAncestorItem
parameter_list|()
block|{
name|QGraphicsItem
modifier|*
name|ancestor
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|grandMa
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|grandPa
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|brotherInLaw
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|cousin
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|husband
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|child
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|wife
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|husband
argument_list|)
expr_stmt|;
name|husband
operator|->
name|setParentItem
argument_list|(
name|grandPa
argument_list|)
expr_stmt|;
name|brotherInLaw
operator|->
name|setParentItem
argument_list|(
name|grandPa
argument_list|)
expr_stmt|;
name|cousin
operator|->
name|setParentItem
argument_list|(
name|brotherInLaw
argument_list|)
expr_stmt|;
name|wife
operator|->
name|setParentItem
argument_list|(
name|grandMa
argument_list|)
expr_stmt|;
name|grandMa
operator|->
name|setParentItem
argument_list|(
name|ancestor
argument_list|)
expr_stmt|;
name|grandPa
operator|->
name|setParentItem
argument_list|(
name|ancestor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandMa
operator|->
name|commonAncestorItem
argument_list|(
name|grandMa
argument_list|)
argument_list|,
name|grandMa
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandMa
operator|->
name|commonAncestorItem
argument_list|(
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandMa
operator|->
name|commonAncestorItem
argument_list|(
name|grandPa
argument_list|)
argument_list|,
name|ancestor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandPa
operator|->
name|commonAncestorItem
argument_list|(
name|grandMa
argument_list|)
argument_list|,
name|ancestor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandPa
operator|->
name|commonAncestorItem
argument_list|(
name|husband
argument_list|)
argument_list|,
name|grandPa
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandPa
operator|->
name|commonAncestorItem
argument_list|(
name|wife
argument_list|)
argument_list|,
name|ancestor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandMa
operator|->
name|commonAncestorItem
argument_list|(
name|husband
argument_list|)
argument_list|,
name|ancestor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandMa
operator|->
name|commonAncestorItem
argument_list|(
name|wife
argument_list|)
argument_list|,
name|grandMa
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|wife
operator|->
name|commonAncestorItem
argument_list|(
name|grandMa
argument_list|)
argument_list|,
name|grandMa
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|commonAncestorItem
argument_list|(
name|cousin
argument_list|)
argument_list|,
name|grandPa
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|cousin
operator|->
name|commonAncestorItem
argument_list|(
name|child
argument_list|)
argument_list|,
name|grandPa
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|wife
operator|->
name|commonAncestorItem
argument_list|(
name|child
argument_list|)
argument_list|,
name|ancestor
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|commonAncestorItem
argument_list|(
name|wife
argument_list|)
argument_list|,
name|ancestor
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|data
name|void
name|tst_QGraphicsItem
operator|::
name|data
parameter_list|()
block|{
name|QGraphicsTextItem
name|text
decl_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|.
name|data
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|text
operator|.
name|setData
argument_list|(
literal|0
argument_list|,
literal|"TextItem"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|.
name|data
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QVariant
argument_list|(
name|QString
argument_list|(
literal|"TextItem"
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|text
operator|.
name|setData
argument_list|(
literal|0
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|.
name|data
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QVariant
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|type
name|void
name|tst_QGraphicsItem
operator|::
name|type
parameter_list|()
block|{
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|QGraphicsItem
operator|::
name|Type
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|QGraphicsPathItem
operator|::
name|Type
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|QGraphicsRectItem
operator|::
name|Type
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|QGraphicsEllipseItem
operator|::
name|Type
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|QGraphicsPolygonItem
operator|::
name|Type
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|QGraphicsLineItem
operator|::
name|Type
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|QGraphicsPixmapItem
operator|::
name|Type
argument_list|)
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|QGraphicsTextItem
operator|::
name|Type
argument_list|)
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QGraphicsPathItem
argument_list|()
operator|.
name|type
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QGraphicsRectItem
argument_list|()
operator|.
name|type
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QGraphicsEllipseItem
argument_list|()
operator|.
name|type
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QGraphicsPolygonItem
argument_list|()
operator|.
name|type
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QGraphicsLineItem
argument_list|()
operator|.
name|type
argument_list|()
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QGraphicsPixmapItem
argument_list|()
operator|.
name|type
argument_list|()
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QGraphicsTextItem
argument_list|()
operator|.
name|type
argument_list|()
argument_list|,
literal|8
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|graphicsitem_cast
name|void
name|tst_QGraphicsItem
operator|::
name|graphicsitem_cast
parameter_list|()
block|{
name|QGraphicsPathItem
name|pathItem
decl_stmt|;
specifier|const
name|QGraphicsPathItem
modifier|*
name|pPathItem
init|=
operator|&
name|pathItem
decl_stmt|;
name|QGraphicsRectItem
name|rectItem
decl_stmt|;
specifier|const
name|QGraphicsRectItem
modifier|*
name|pRectItem
init|=
operator|&
name|rectItem
decl_stmt|;
name|QGraphicsEllipseItem
name|ellipseItem
decl_stmt|;
specifier|const
name|QGraphicsEllipseItem
modifier|*
name|pEllipseItem
init|=
operator|&
name|ellipseItem
decl_stmt|;
name|QGraphicsPolygonItem
name|polygonItem
decl_stmt|;
specifier|const
name|QGraphicsPolygonItem
modifier|*
name|pPolygonItem
init|=
operator|&
name|polygonItem
decl_stmt|;
name|QGraphicsLineItem
name|lineItem
decl_stmt|;
specifier|const
name|QGraphicsLineItem
modifier|*
name|pLineItem
init|=
operator|&
name|lineItem
decl_stmt|;
name|QGraphicsPixmapItem
name|pixmapItem
decl_stmt|;
specifier|const
name|QGraphicsPixmapItem
modifier|*
name|pPixmapItem
init|=
operator|&
name|pixmapItem
decl_stmt|;
name|QGraphicsTextItem
name|textItem
decl_stmt|;
specifier|const
name|QGraphicsTextItem
modifier|*
name|pTextItem
init|=
operator|&
name|textItem
decl_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsPathItem
operator|*
argument_list|>
argument_list|(
operator|&
name|pathItem
argument_list|)
argument_list|)
expr_stmt|;
comment|//QVERIFY(qgraphicsitem_cast<QAbstractGraphicsPathItem *>(&pathItem));
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
operator|&
name|pathItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
specifier|const
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|pPathItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
specifier|const
name|QGraphicsPathItem
operator|*
argument_list|>
argument_list|(
name|pPathItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsRectItem
operator|*
argument_list|>
argument_list|(
operator|&
name|rectItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
operator|&
name|rectItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
specifier|const
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|pRectItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
specifier|const
name|QGraphicsRectItem
operator|*
argument_list|>
argument_list|(
name|pRectItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsEllipseItem
operator|*
argument_list|>
argument_list|(
operator|&
name|ellipseItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
operator|&
name|ellipseItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
specifier|const
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|pEllipseItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
specifier|const
name|QGraphicsEllipseItem
operator|*
argument_list|>
argument_list|(
name|pEllipseItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsPolygonItem
operator|*
argument_list|>
argument_list|(
operator|&
name|polygonItem
argument_list|)
argument_list|)
expr_stmt|;
comment|//QVERIFY(qgraphicsitem_cast<QAbstractGraphicsPathItem *>(&polygonItem));
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
operator|&
name|polygonItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
specifier|const
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|pPolygonItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
specifier|const
name|QGraphicsPolygonItem
operator|*
argument_list|>
argument_list|(
name|pPolygonItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsLineItem
operator|*
argument_list|>
argument_list|(
operator|&
name|lineItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
operator|&
name|lineItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
specifier|const
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|pLineItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
specifier|const
name|QGraphicsLineItem
operator|*
argument_list|>
argument_list|(
name|pLineItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsPixmapItem
operator|*
argument_list|>
argument_list|(
operator|&
name|pixmapItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
operator|&
name|pixmapItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
specifier|const
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|pPixmapItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
specifier|const
name|QGraphicsPixmapItem
operator|*
argument_list|>
argument_list|(
name|pPixmapItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsTextItem
operator|*
argument_list|>
argument_list|(
operator|&
name|textItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
operator|&
name|textItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
specifier|const
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|pTextItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qgraphicsitem_cast
argument_list|<
specifier|const
name|QGraphicsTextItem
operator|*
argument_list|>
argument_list|(
name|pTextItem
argument_list|)
argument_list|)
expr_stmt|;
comment|// and some casts that _should_ fail:
name|QVERIFY
argument_list|(
operator|!
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsEllipseItem
operator|*
argument_list|>
argument_list|(
operator|&
name|pathItem
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|qgraphicsitem_cast
argument_list|<
specifier|const
name|QGraphicsTextItem
operator|*
argument_list|>
argument_list|(
name|pPolygonItem
argument_list|)
argument_list|)
expr_stmt|;
comment|// and this shouldn't crash
name|QGraphicsItem
modifier|*
name|ptr
init|=
literal|0
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsTextItem
operator|*
argument_list|>
argument_list|(
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|qgraphicsitem_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|ptr
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|hoverEventsGenerateRepaints
name|void
name|tst_QGraphicsItem
operator|::
name|hoverEventsGenerateRepaints
parameter_list|()
block|{
name|Q_CHECK_PAINTEVENTS
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|EventTester
modifier|*
name|tester
init|=
operator|new
name|EventTester
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|tester
argument_list|)
expr_stmt|;
name|tester
operator|->
name|setAcceptsHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Send a hover enter event
name|QGraphicsSceneHoverEvent
name|hoverEnterEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneHoverEnter
argument_list|)
decl_stmt|;
name|hoverEnterEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|hoverEnterEvent
operator|.
name|setPos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|hoverEnterEvent
argument_list|)
expr_stmt|;
comment|// Check that we get a repaint
name|int
name|npaints
init|=
name|tester
operator|->
name|repaints
decl_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|events
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|//  enter + move
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
name|npaints
operator|+
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|events
operator|.
name|last
argument_list|()
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneHoverMove
argument_list|)
expr_stmt|;
comment|// Send a hover move event
name|QGraphicsSceneHoverEvent
name|hoverMoveEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneHoverMove
argument_list|)
decl_stmt|;
name|hoverMoveEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|hoverMoveEvent
operator|.
name|setPos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|hoverMoveEvent
argument_list|)
expr_stmt|;
comment|// Check that we don't get a repaint
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|events
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
name|npaints
operator|+
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|events
operator|.
name|last
argument_list|()
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneHoverMove
argument_list|)
expr_stmt|;
comment|// Send a hover leave event
name|QGraphicsSceneHoverEvent
name|hoverLeaveEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneHoverLeave
argument_list|)
decl_stmt|;
name|hoverLeaveEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|hoverLeaveEvent
operator|.
name|setPos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|hoverLeaveEvent
argument_list|)
expr_stmt|;
comment|// Check that we get a repaint
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|events
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
name|npaints
operator|+
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|events
operator|.
name|last
argument_list|()
argument_list|,
name|QEvent
operator|::
name|GraphicsSceneHoverLeave
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|boundingRects_data
name|void
name|tst_QGraphicsItem
operator|::
name|boundingRects_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
literal|"item"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QRectF
argument_list|>
argument_list|(
literal|"boundingRect"
argument_list|)
expr_stmt|;
name|QRectF
name|rect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|QPainterPath
name|path
decl_stmt|;
name|path
operator|.
name|addRect
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|QRectF
name|adjustedRect
argument_list|(
operator|-
literal|0.5
argument_list|,
operator|-
literal|0.5
argument_list|,
literal|101
argument_list|,
literal|101
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"path"
argument_list|)
operator|<<
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsPathItem
argument_list|(
name|path
argument_list|)
operator|<<
name|adjustedRect
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"rect"
argument_list|)
operator|<<
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|)
operator|<<
name|adjustedRect
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"ellipse"
argument_list|)
operator|<<
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsEllipseItem
argument_list|(
name|rect
argument_list|)
operator|<<
name|adjustedRect
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"polygon"
argument_list|)
operator|<<
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsPolygonItem
argument_list|(
name|rect
argument_list|)
operator|<<
name|adjustedRect
expr_stmt|;
block|}
end_function
begin_function
DECL|function|boundingRects
name|void
name|tst_QGraphicsItem
operator|::
name|boundingRects
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QGraphicsItem
operator|*
argument_list|,
name|item
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QRectF
argument_list|,
name|boundingRect
argument_list|)
expr_stmt|;
operator|(
operator|(
name|QAbstractGraphicsShapeItem
operator|*
operator|)
name|item
operator|)
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|boundingRect
argument_list|()
argument_list|,
name|boundingRect
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|boundingRects2
name|void
name|tst_QGraphicsItem
operator|::
name|boundingRects2
parameter_list|()
block|{
name|QGraphicsPixmapItem
name|pixmap
argument_list|(
name|QPixmap
operator|::
name|fromImage
argument_list|(
name|QImage
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|,
name|QImage
operator|::
name|Format_ARGB32_Premultiplied
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|pixmap
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsLineItem
name|line
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|line
operator|.
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|0.5
argument_list|,
operator|-
literal|0.5
argument_list|,
literal|101
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sceneBoundingRect
name|void
name|tst_QGraphicsItem
operator|::
name|sceneBoundingRect
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|boundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|sceneBoundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|boundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|sceneBoundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|childrenBoundingRect
name|void
name|tst_QGraphicsItem
operator|::
name|childrenBoundingRect
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|parent
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|child
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|child
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|boundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|boundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|childrenBoundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|childrenBoundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|child2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
decl_stmt|;
name|child2
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|child2
operator|->
name|setPos
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|childrenBoundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|300
argument_list|,
literal|300
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|childChild
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
decl_stmt|;
name|childChild
operator|->
name|setParentItem
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|childChild
operator|->
name|setPos
argument_list|(
literal|500
argument_list|,
literal|500
argument_list|)
expr_stmt|;
name|child
operator|->
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addPolygon
argument_list|(
name|parent
operator|->
name|mapToScene
argument_list|(
name|parent
operator|->
name|boundingRect
argument_list|()
operator||
name|parent
operator|->
name|childrenBoundingRect
argument_list|()
argument_list|)
argument_list|)
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
argument_list|)
expr_stmt|;
empty_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|30
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|childrenBoundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|500
argument_list|,
operator|-
literal|100
argument_list|,
literal|600
argument_list|,
literal|800
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|childrenBoundingRectTransformed
name|void
name|tst_QGraphicsItem
operator|::
name|childrenBoundingRectTransformed
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect3
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect4
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect5
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|rect2
operator|->
name|setParentItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setParentItem
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|rect4
operator|->
name|setParentItem
argument_list|(
name|rect3
argument_list|)
expr_stmt|;
name|rect5
operator|->
name|setParentItem
argument_list|(
name|rect4
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|rect4
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|rect5
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setTransform
argument_list|(
name|QTransform
argument_list|()
operator|.
name|translate
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
operator|.
name|rotate
argument_list|(
literal|45
argument_list|)
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setPos
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setTransform
argument_list|(
name|QTransform
argument_list|()
operator|.
name|translate
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
operator|.
name|rotate
argument_list|(
literal|45
argument_list|)
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setPos
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|rect4
operator|->
name|setTransform
argument_list|(
name|QTransform
argument_list|()
operator|.
name|translate
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
operator|.
name|rotate
argument_list|(
literal|45
argument_list|)
argument_list|)
expr_stmt|;
name|rect4
operator|->
name|setPos
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|rect5
operator|->
name|setTransform
argument_list|(
name|QTransform
argument_list|()
operator|.
name|translate
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
operator|.
name|rotate
argument_list|(
literal|45
argument_list|)
argument_list|)
expr_stmt|;
name|rect5
operator|->
name|setPos
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|QRectF
name|subTreeRect
init|=
name|rect
operator|->
name|childrenBoundingRect
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|subTreeRect
operator|.
name|left
argument_list|()
argument_list|,
name|qreal
argument_list|(
operator|-
literal|206.0660171779821
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subTreeRect
operator|.
name|top
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|75.0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subTreeRect
operator|.
name|width
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|351.7766952966369
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subTreeRect
operator|.
name|height
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|251.7766952966369
argument_list|)
argument_list|)
expr_stmt|;
name|rect
operator|->
name|rotate
argument_list|(
literal|45
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|rotate
argument_list|(
operator|-
literal|45
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|rotate
argument_list|(
literal|45
argument_list|)
expr_stmt|;
name|rect4
operator|->
name|rotate
argument_list|(
operator|-
literal|45
argument_list|)
expr_stmt|;
name|rect5
operator|->
name|rotate
argument_list|(
literal|45
argument_list|)
expr_stmt|;
name|subTreeRect
operator|=
name|rect
operator|->
name|childrenBoundingRect
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|childrenBoundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
literal|75
argument_list|,
literal|275
argument_list|,
literal|250
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|childrenBoundingRect2
name|void
name|tst_QGraphicsItem
operator|::
name|childrenBoundingRect2
parameter_list|()
block|{
name|QGraphicsItemGroup
name|box
decl_stmt|;
name|QGraphicsLineItem
name|l1
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|0
argument_list|,
operator|&
name|box
argument_list|)
decl_stmt|;
name|QGraphicsLineItem
name|l2
argument_list|(
literal|100
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|,
operator|&
name|box
argument_list|)
decl_stmt|;
name|QGraphicsLineItem
name|l3
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
operator|&
name|box
argument_list|)
decl_stmt|;
comment|// Make sure lines (zero with/height) are included in the childrenBoundingRect.
name|l1
operator|.
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|l2
operator|.
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|l3
operator|.
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|box
operator|.
name|childrenBoundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|childrenBoundingRect3
name|void
name|tst_QGraphicsItem
operator|::
name|childrenBoundingRect3
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect3
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect4
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect5
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|rect2
operator|->
name|setParentItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setParentItem
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|rect4
operator|->
name|setParentItem
argument_list|(
name|rect3
argument_list|)
expr_stmt|;
name|rect5
operator|->
name|setParentItem
argument_list|(
name|rect4
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|rect4
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|rect5
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setTransform
argument_list|(
name|QTransform
argument_list|()
operator|.
name|translate
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
operator|.
name|rotate
argument_list|(
literal|45
argument_list|)
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setPos
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setTransform
argument_list|(
name|QTransform
argument_list|()
operator|.
name|translate
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
operator|.
name|rotate
argument_list|(
literal|45
argument_list|)
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setPos
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|rect4
operator|->
name|setTransform
argument_list|(
name|QTransform
argument_list|()
operator|.
name|translate
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
operator|.
name|rotate
argument_list|(
literal|45
argument_list|)
argument_list|)
expr_stmt|;
name|rect4
operator|->
name|setPos
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|rect5
operator|->
name|setTransform
argument_list|(
name|QTransform
argument_list|()
operator|.
name|translate
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
operator|.
name|rotate
argument_list|(
literal|45
argument_list|)
argument_list|)
expr_stmt|;
name|rect5
operator|->
name|setPos
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
comment|// Try to mess up the cached bounding rect.
operator|(
name|void
operator|)
name|rect2
operator|->
name|childrenBoundingRect
argument_list|()
expr_stmt|;
name|QRectF
name|subTreeRect
init|=
name|rect
operator|->
name|childrenBoundingRect
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|subTreeRect
operator|.
name|left
argument_list|()
argument_list|,
name|qreal
argument_list|(
operator|-
literal|206.0660171779821
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subTreeRect
operator|.
name|top
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|75.0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subTreeRect
operator|.
name|width
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|351.7766952966369
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subTreeRect
operator|.
name|height
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|251.7766952966369
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|childrenBoundingRect4
name|void
name|tst_QGraphicsItem
operator|::
name|childrenBoundingRect4
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect3
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|30
argument_list|,
literal|30
argument_list|)
argument_list|)
decl_stmt|;
name|rect2
operator|->
name|setParentItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setParentItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
comment|// Try to mess up the cached bounding rect.
name|rect
operator|->
name|childrenBoundingRect
argument_list|()
expr_stmt|;
name|rect2
operator|->
name|childrenBoundingRect
argument_list|()
expr_stmt|;
name|rect3
operator|->
name|setOpacity
argument_list|(
literal|0.0
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setParentItem
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|childrenBoundingRect
argument_list|()
argument_list|,
name|rect3
operator|->
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2
operator|->
name|childrenBoundingRect
argument_list|()
argument_list|,
name|rect3
operator|->
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|childrenBoundingRect5
name|void
name|tst_QGraphicsItem
operator|::
name|childrenBoundingRect5
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|parent
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|child
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|child
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
comment|// Try to mess up the cached bounding rect.
name|QRectF
name|expectedChildrenBoundingRect
init|=
name|parent
operator|->
name|boundingRect
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|childrenBoundingRect
argument_list|()
argument_list|,
name|expectedChildrenBoundingRect
argument_list|)
expr_stmt|;
comment|// Apply some effects.
name|QGraphicsDropShadowEffect
modifier|*
name|dropShadow
init|=
operator|new
name|QGraphicsDropShadowEffect
decl_stmt|;
name|dropShadow
operator|->
name|setOffset
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|child
operator|->
name|setGraphicsEffect
argument_list|(
name|dropShadow
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setGraphicsEffect
argument_list|(
operator|new
name|QGraphicsOpacityEffect
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parent
operator|->
name|childrenBoundingRect
argument_list|()
operator|!=
name|expectedChildrenBoundingRect
argument_list|)
expr_stmt|;
name|expectedChildrenBoundingRect
operator||=
name|dropShadow
operator|->
name|boundingRect
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|childrenBoundingRect
argument_list|()
argument_list|,
name|expectedChildrenBoundingRect
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|group
name|void
name|tst_QGraphicsItem
operator|::
name|group
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|parent
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|child
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|parent2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
argument_list|)
decl_stmt|;
name|parent2
operator|->
name|setPos
argument_list|(
operator|-
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|child
operator|->
name|rotate
argument_list|(
literal|45
argument_list|)
expr_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setPos
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|child
operator|->
name|setPos
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|group
argument_list|()
argument_list|,
operator|(
name|QGraphicsItemGroup
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent2
operator|->
name|group
argument_list|()
argument_list|,
operator|(
name|QGraphicsItemGroup
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|group
argument_list|()
argument_list|,
operator|(
name|QGraphicsItemGroup
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsItemGroup
modifier|*
name|group
init|=
operator|new
name|QGraphicsItemGroup
decl_stmt|;
name|group
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|QRectF
name|parentSceneBoundingRect
init|=
name|parent
operator|->
name|sceneBoundingRect
argument_list|()
decl_stmt|;
name|group
operator|->
name|addToGroup
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|group
argument_list|()
argument_list|,
name|group
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|sceneBoundingRect
argument_list|()
argument_list|,
name|parentSceneBoundingRect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|group
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|->
name|children
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|group
operator|->
name|sceneBoundingRect
argument_list|()
argument_list|)
operator|.
name|size
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QRectF
name|parent2SceneBoundingRect
init|=
name|parent2
operator|->
name|sceneBoundingRect
argument_list|()
decl_stmt|;
name|group
operator|->
name|addToGroup
argument_list|(
name|parent2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent2
operator|->
name|group
argument_list|()
argument_list|,
name|group
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent2
operator|->
name|sceneBoundingRect
argument_list|()
argument_list|,
name|parent2SceneBoundingRect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent2
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|group
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|->
name|children
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|group
operator|->
name|sceneBoundingRect
argument_list|()
argument_list|)
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|newItems
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|100
condition|;
operator|++
name|i
control|)
block|{
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|QColor
argument_list|(
name|rand
argument_list|()
operator|%
literal|255
argument_list|,
name|rand
argument_list|()
operator|%
literal|255
argument_list|,
name|rand
argument_list|()
operator|%
literal|255
argument_list|,
name|rand
argument_list|()
operator|%
literal|255
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|newItems
operator|<<
name|item
expr_stmt|;
name|item
operator|->
name|setPos
argument_list|(
operator|-
literal|1000
operator|+
name|rand
argument_list|()
operator|%
literal|2000
argument_list|,
operator|-
literal|1000
operator|+
name|rand
argument_list|()
operator|%
literal|2000
argument_list|)
expr_stmt|;
name|item
operator|->
name|rotate
argument_list|(
name|rand
argument_list|()
operator|%
literal|90
argument_list|)
expr_stmt|;
block|}
name|view
operator|.
name|fitInView
argument_list|(
name|scene
operator|.
name|itemsBoundingRect
argument_list|()
argument_list|)
expr_stmt|;
name|int
name|n
init|=
literal|0
decl_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|item
decl|,
name|newItems
control|)
block|{
name|group
operator|->
name|addToGroup
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|group
argument_list|()
argument_list|,
name|group
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|n
operator|++
operator|%
literal|100
operator|)
operator|==
literal|0
condition|)
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|setGroup
name|void
name|tst_QGraphicsItem
operator|::
name|setGroup
parameter_list|()
block|{
name|QGraphicsItemGroup
name|group1
decl_stmt|;
name|QGraphicsItemGroup
name|group2
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|group
argument_list|()
argument_list|,
operator|(
name|QGraphicsItemGroup
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setGroup
argument_list|(
operator|&
name|group1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|group
argument_list|()
argument_list|,
operator|&
name|group1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|&
name|group1
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setGroup
argument_list|(
operator|&
name|group2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|group
argument_list|()
argument_list|,
operator|&
name|group2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|&
name|group2
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setGroup
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|group
argument_list|()
argument_list|,
operator|(
name|QGraphicsItemGroup
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setGroup2
name|void
name|tst_QGraphicsItem
operator|::
name|setGroup2
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItemGroup
name|group
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|group
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
name|Qt
operator|::
name|NoPen
argument_list|,
name|Qt
operator|::
name|black
argument_list|)
decl_stmt|;
name|rect
operator|->
name|setTransformOriginPoint
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setRotation
argument_list|(
literal|45
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setScale
argument_list|(
literal|1.5
argument_list|)
expr_stmt|;
name|rect
operator|->
name|translate
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|group
operator|.
name|translate
argument_list|(
operator|-
literal|30
argument_list|,
operator|-
literal|40
argument_list|)
expr_stmt|;
name|group
operator|.
name|setRotation
argument_list|(
literal|180
argument_list|)
expr_stmt|;
name|group
operator|.
name|setScale
argument_list|(
literal|0.5
argument_list|)
expr_stmt|;
name|QTransform
name|oldSceneTransform
init|=
name|rect
operator|->
name|sceneTransform
argument_list|()
decl_stmt|;
name|rect
operator|->
name|setGroup
argument_list|(
operator|&
name|group
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|sceneTransform
argument_list|()
argument_list|,
name|oldSceneTransform
argument_list|)
expr_stmt|;
name|group
operator|.
name|setRotation
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|group
operator|.
name|setScale
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setRotation
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setScale
argument_list|(
literal|0.8
argument_list|)
expr_stmt|;
name|oldSceneTransform
operator|=
name|rect
operator|->
name|sceneTransform
argument_list|()
expr_stmt|;
name|rect
operator|->
name|setGroup
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|sceneTransform
argument_list|()
argument_list|,
name|oldSceneTransform
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|nestedGroups
name|void
name|tst_QGraphicsItem
operator|::
name|nestedGroups
parameter_list|()
block|{
name|QGraphicsItemGroup
modifier|*
name|group1
init|=
operator|new
name|QGraphicsItemGroup
decl_stmt|;
name|QGraphicsItemGroup
modifier|*
name|group2
init|=
operator|new
name|QGraphicsItemGroup
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|rect2
operator|->
name|setParentItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|group1
operator|->
name|addToGroup
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|group
argument_list|()
argument_list|,
name|group1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2
operator|->
name|group
argument_list|()
argument_list|,
name|group1
argument_list|)
expr_stmt|;
name|group2
operator|->
name|addToGroup
argument_list|(
name|group1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|group
argument_list|()
argument_list|,
name|group1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2
operator|->
name|group
argument_list|()
argument_list|,
name|group1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group1
operator|->
name|group
argument_list|()
argument_list|,
name|group2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group2
operator|->
name|group
argument_list|()
argument_list|,
operator|(
name|QGraphicsItemGroup
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|group1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|group
argument_list|()
argument_list|,
name|group1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2
operator|->
name|group
argument_list|()
argument_list|,
name|group1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group1
operator|->
name|group
argument_list|()
argument_list|,
operator|(
name|QGraphicsItemGroup
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|group2
operator|->
name|children
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
operator|delete
name|group2
expr_stmt|;
block|}
end_function
begin_function
DECL|function|warpChildrenIntoGroup
name|void
name|tst_QGraphicsItem
operator|::
name|warpChildrenIntoGroup
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|parentRectItem
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|childRectItem
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|parentRectItem
operator|->
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|childRectItem
operator|->
name|setPos
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|25
argument_list|)
expr_stmt|;
name|childRectItem
operator|->
name|setParentItem
argument_list|(
name|parentRectItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|childRectItem
operator|->
name|mapToScene
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|25
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|childRectItem
operator|->
name|scenePos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|25
argument_list|,
operator|-
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|parentOfGroup
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|parentOfGroup
operator|->
name|setPos
argument_list|(
operator|-
literal|200
argument_list|,
operator|-
literal|200
argument_list|)
expr_stmt|;
name|parentOfGroup
operator|->
name|scale
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QGraphicsItemGroup
modifier|*
name|group
init|=
operator|new
name|QGraphicsItemGroup
decl_stmt|;
name|group
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|group
operator|->
name|setParentItem
argument_list|(
name|parentOfGroup
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|->
name|scenePos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|group
operator|->
name|addToGroup
argument_list|(
name|childRectItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|childRectItem
operator|->
name|mapToScene
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|25
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|childRectItem
operator|->
name|scenePos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|25
argument_list|,
operator|-
literal|50
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|removeFromGroup
name|void
name|tst_QGraphicsItem
operator|::
name|removeFromGroup
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect1
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
argument_list|)
decl_stmt|;
name|rect1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|rect1
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// index items
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// emit changed
name|QGraphicsItemGroup
modifier|*
name|group
init|=
name|scene
operator|.
name|createItemGroup
argument_list|(
name|scene
operator|.
name|selectedItems
argument_list|()
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|group
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|->
name|children
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// index items
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// emit changed
name|scene
operator|.
name|destroyItemGroup
argument_list|(
name|group
argument_list|)
expr_stmt|;
comment|// calls removeFromGroup.
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// index items
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// emit changed
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect1
operator|->
name|group
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect2
operator|->
name|group
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|ChildEventTester
class|class
name|ChildEventTester
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|ChildEventTester
name|ChildEventTester
parameter_list|(
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|,
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|,
name|parent
argument_list|)
member_init_list|,
name|counter
argument_list|(
literal|0
argument_list|)
block|{ }
DECL|member|counter
name|int
name|counter
decl_stmt|;
protected|protected:
DECL|function|focusInEvent
name|void
name|focusInEvent
parameter_list|(
name|QFocusEvent
modifier|*
name|event
parameter_list|)
block|{
operator|++
name|counter
expr_stmt|;
name|QGraphicsRectItem
operator|::
name|focusInEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
block|}
DECL|function|mousePressEvent
name|void
name|mousePressEvent
parameter_list|(
name|QGraphicsSceneMouseEvent
modifier|*
parameter_list|)
block|{
operator|++
name|counter
expr_stmt|;
block|}
DECL|function|mouseMoveEvent
name|void
name|mouseMoveEvent
parameter_list|(
name|QGraphicsSceneMouseEvent
modifier|*
parameter_list|)
block|{
operator|++
name|counter
expr_stmt|;
block|}
DECL|function|mouseReleaseEvent
name|void
name|mouseReleaseEvent
parameter_list|(
name|QGraphicsSceneMouseEvent
modifier|*
parameter_list|)
block|{
operator|++
name|counter
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|handlesChildEvents
name|void
name|tst_QGraphicsItem
operator|::
name|handlesChildEvents
parameter_list|()
block|{
name|ChildEventTester
modifier|*
name|blue
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|ChildEventTester
modifier|*
name|red
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
decl_stmt|;
name|ChildEventTester
modifier|*
name|green
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|)
decl_stmt|;
name|ChildEventTester
modifier|*
name|gray
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|)
decl_stmt|;
name|ChildEventTester
modifier|*
name|yellow
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
decl_stmt|;
name|blue
operator|->
name|setBrush
argument_list|(
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
expr_stmt|;
name|red
operator|->
name|setBrush
argument_list|(
name|QBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
argument_list|)
expr_stmt|;
name|yellow
operator|->
name|setBrush
argument_list|(
name|QBrush
argument_list|(
name|Qt
operator|::
name|yellow
argument_list|)
argument_list|)
expr_stmt|;
name|green
operator|->
name|setBrush
argument_list|(
name|QBrush
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
argument_list|)
expr_stmt|;
name|gray
operator|->
name|setBrush
argument_list|(
name|QBrush
argument_list|(
name|Qt
operator|::
name|gray
argument_list|)
argument_list|)
expr_stmt|;
name|red
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|yellow
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|green
operator|->
name|setPos
argument_list|(
literal|25
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|gray
operator|->
name|setPos
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|red
operator|->
name|setParentItem
argument_list|(
name|blue
argument_list|)
expr_stmt|;
name|yellow
operator|->
name|setParentItem
argument_list|(
name|blue
argument_list|)
expr_stmt|;
name|green
operator|->
name|setParentItem
argument_list|(
name|red
argument_list|)
expr_stmt|;
name|gray
operator|->
name|setParentItem
argument_list|(
name|red
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|blue
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
comment|// Pull out the items, closest item first
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|items
init|=
name|scene
operator|.
name|items
argument_list|(
name|scene
operator|.
name|itemsBoundingRect
argument_list|()
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|yellow
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|gray
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|green
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|at
argument_list|(
literal|3
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|red
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|at
argument_list|(
literal|4
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|blue
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|blue
operator|->
name|counter
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Send events to the toplevel item
name|QGraphicsSceneMouseEvent
name|pressEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|QGraphicsSceneMouseEvent
name|releaseEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|pressEvent
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setScenePos
argument_list|(
name|blue
operator|->
name|mapToScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setScreenPos
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|pressEvent
operator|.
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScenePos
argument_list|(
name|blue
operator|->
name|mapToScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScreenPos
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|pressEvent
operator|.
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|releaseEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|blue
operator|->
name|counter
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// Send events to a level1 item
name|pressEvent
operator|.
name|setScenePos
argument_list|(
name|red
operator|->
name|mapToScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setScreenPos
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|pressEvent
operator|.
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScenePos
argument_list|(
name|red
operator|->
name|mapToScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScreenPos
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|releaseEvent
operator|.
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|releaseEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|blue
operator|->
name|counter
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|red
operator|->
name|counter
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// Send events to a level2 item
name|pressEvent
operator|.
name|setScenePos
argument_list|(
name|green
operator|->
name|mapToScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setScreenPos
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|pressEvent
operator|.
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScenePos
argument_list|(
name|green
operator|->
name|mapToScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScreenPos
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|releaseEvent
operator|.
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|releaseEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|blue
operator|->
name|counter
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|red
operator|->
name|counter
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|green
operator|->
name|counter
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|blue
operator|->
name|setHandlesChildEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
comment|// Send events to a level1 item
name|pressEvent
operator|.
name|setScenePos
argument_list|(
name|red
operator|->
name|mapToScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setScreenPos
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|pressEvent
operator|.
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScenePos
argument_list|(
name|red
operator|->
name|mapToScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScreenPos
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|releaseEvent
operator|.
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|releaseEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|blue
operator|->
name|counter
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|red
operator|->
name|counter
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// Send events to a level2 item
name|pressEvent
operator|.
name|setScenePos
argument_list|(
name|green
operator|->
name|mapToScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setScreenPos
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|pressEvent
operator|.
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScenePos
argument_list|(
name|green
operator|->
name|mapToScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScreenPos
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|releaseEvent
operator|.
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|releaseEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|blue
operator|->
name|counter
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|red
operator|->
name|counter
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|green
operator|->
name|counter
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|blue
operator|->
name|setHandlesChildEvents
argument_list|(
literal|false
argument_list|)
expr_stmt|;
comment|// Send events to a level1 item
name|pressEvent
operator|.
name|setScenePos
argument_list|(
name|red
operator|->
name|mapToScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setScreenPos
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|pressEvent
operator|.
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScenePos
argument_list|(
name|red
operator|->
name|mapToScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScreenPos
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|releaseEvent
operator|.
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|releaseEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|blue
operator|->
name|counter
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|red
operator|->
name|counter
argument_list|,
literal|4
argument_list|)
expr_stmt|;
comment|// Send events to a level2 item
name|pressEvent
operator|.
name|setScenePos
argument_list|(
name|green
operator|->
name|mapToScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setScreenPos
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|pressEvent
operator|.
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScenePos
argument_list|(
name|green
operator|->
name|mapToScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScreenPos
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|releaseEvent
operator|.
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|releaseEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|blue
operator|->
name|counter
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|red
operator|->
name|counter
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|green
operator|->
name|counter
argument_list|,
literal|4
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|handlesChildEvents2
name|void
name|tst_QGraphicsItem
operator|::
name|handlesChildEvents2
parameter_list|()
block|{
name|ChildEventTester
modifier|*
name|root
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|root
operator|->
name|setHandlesChildEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|root
operator|->
name|handlesChildEvents
argument_list|()
argument_list|)
expr_stmt|;
name|ChildEventTester
modifier|*
name|child
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|root
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|handlesChildEvents
argument_list|()
argument_list|)
expr_stmt|;
name|ChildEventTester
modifier|*
name|child2
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|ChildEventTester
modifier|*
name|child3
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|child2
argument_list|)
decl_stmt|;
name|ChildEventTester
modifier|*
name|child4
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|child3
argument_list|)
decl_stmt|;
name|child2
operator|->
name|setParentItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child2
operator|->
name|handlesChildEvents
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child3
operator|->
name|handlesChildEvents
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child4
operator|->
name|handlesChildEvents
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseButtonPress
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|root
operator|->
name|counter
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|handlesChildEvents3
name|void
name|tst_QGraphicsItem
operator|::
name|handlesChildEvents3
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|ChildEventTester
modifier|*
name|group2
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|()
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|ChildEventTester
modifier|*
name|group1
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|()
argument_list|,
name|group2
argument_list|)
decl_stmt|;
name|ChildEventTester
modifier|*
name|leaf
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|()
argument_list|,
name|group1
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|group2
argument_list|)
expr_stmt|;
name|leaf
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|group1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|group1
operator|->
name|setHandlesChildEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|group2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|group2
operator|->
name|setHandlesChildEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|leaf
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|leaf
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// group2 stole the event, but leaf still got focus
name|QVERIFY
argument_list|(
operator|!
name|group1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|group2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leaf
operator|->
name|counter
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group1
operator|->
name|counter
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group2
operator|->
name|counter
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|group1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|group1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// group2 stole the event, but group1 still got focus
name|QVERIFY
argument_list|(
operator|!
name|leaf
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|group2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leaf
operator|->
name|counter
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group1
operator|->
name|counter
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group2
operator|->
name|counter
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|group2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|group2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// group2 stole the event, and now group2 also has focus
name|QVERIFY
argument_list|(
operator|!
name|leaf
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|group1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leaf
operator|->
name|counter
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group1
operator|->
name|counter
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group2
operator|->
name|counter
argument_list|,
literal|3
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|ChildEventFilterTester
class|class
name|ChildEventFilterTester
super|:
specifier|public
name|ChildEventTester
block|{
public|public:
DECL|function|ChildEventFilterTester
name|ChildEventFilterTester
parameter_list|(
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|,
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|ChildEventTester
argument_list|(
name|rect
argument_list|,
name|parent
argument_list|)
member_init_list|,
name|filter
argument_list|(
name|QEvent
operator|::
name|None
argument_list|)
block|{ }
DECL|member|filter
name|QEvent
operator|::
name|Type
name|filter
decl_stmt|;
protected|protected:
DECL|function|sceneEventFilter
name|bool
name|sceneEventFilter
parameter_list|(
name|QGraphicsItem
modifier|*
name|item
parameter_list|,
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
name|Q_UNUSED
argument_list|(
name|item
argument_list|)
expr_stmt|;
if|if
condition|(
name|event
operator|->
name|type
argument_list|()
operator|==
name|filter
condition|)
block|{
operator|++
name|counter
expr_stmt|;
return|return
literal|true
return|;
block|}
return|return
literal|false
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|filtersChildEvents
name|void
name|tst_QGraphicsItem
operator|::
name|filtersChildEvents
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|ChildEventFilterTester
modifier|*
name|root
init|=
operator|new
name|ChildEventFilterTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|ChildEventFilterTester
modifier|*
name|filter
init|=
operator|new
name|ChildEventFilterTester
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|root
argument_list|)
decl_stmt|;
name|ChildEventTester
modifier|*
name|child
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|filter
argument_list|)
decl_stmt|;
comment|// setup filter
name|filter
operator|->
name|setFiltersChildEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|filter
operator|->
name|filter
operator|=
name|QEvent
operator|::
name|GraphicsSceneMousePress
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|pressEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|QGraphicsSceneMouseEvent
name|releaseEvent
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
comment|// send event to child
name|pressEvent
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|pressEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|)
expr_stmt|;
comment|//child->mapToScene(5, 5));
name|pressEvent
operator|.
name|setScreenPos
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|pressEvent
operator|.
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|releaseEvent
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|)
expr_stmt|;
comment|//child->mapToScene(5, 5));
name|releaseEvent
operator|.
name|setScreenPos
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
name|pressEvent
operator|.
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|releaseEvent
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|child
operator|->
name|counter
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// mouse release is not filtered
name|QCOMPARE
argument_list|(
name|filter
operator|->
name|counter
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// mouse press is filtered
name|QCOMPARE
argument_list|(
name|root
operator|->
name|counter
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// add another filter
name|root
operator|->
name|setFiltersChildEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|root
operator|->
name|filter
operator|=
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
expr_stmt|;
comment|// send event to child
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|releaseEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|counter
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|filter
operator|->
name|counter
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// mouse press is filtered
name|QCOMPARE
argument_list|(
name|root
operator|->
name|counter
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// mouse release is filtered
comment|// reparent to another sub-graph
name|ChildEventTester
modifier|*
name|parent
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|root
argument_list|)
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
comment|// send event to child
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|pressEvent
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|releaseEvent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|counter
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// mouse press is _not_ filtered
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|counter
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|filter
operator|->
name|counter
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|root
operator|->
name|counter
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// mouse release is filtered
block|}
end_function
begin_function
DECL|function|filtersChildEvents2
name|void
name|tst_QGraphicsItem
operator|::
name|filtersChildEvents2
parameter_list|()
block|{
name|ChildEventFilterTester
modifier|*
name|root
init|=
operator|new
name|ChildEventFilterTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|root
operator|->
name|setFiltersChildEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|root
operator|->
name|filter
operator|=
name|QEvent
operator|::
name|GraphicsSceneMousePress
expr_stmt|;
name|QVERIFY
argument_list|(
name|root
operator|->
name|filtersChildEvents
argument_list|()
argument_list|)
expr_stmt|;
name|ChildEventTester
modifier|*
name|child
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|root
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child
operator|->
name|filtersChildEvents
argument_list|()
argument_list|)
expr_stmt|;
name|ChildEventTester
modifier|*
name|child2
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|ChildEventTester
modifier|*
name|child3
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|child2
argument_list|)
decl_stmt|;
name|ChildEventTester
modifier|*
name|child4
init|=
operator|new
name|ChildEventTester
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|child3
argument_list|)
decl_stmt|;
name|child2
operator|->
name|setParentItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child2
operator|->
name|filtersChildEvents
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child3
operator|->
name|filtersChildEvents
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|child4
operator|->
name|filtersChildEvents
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseButtonPress
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|view
operator|.
name|mapFromScene
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|root
operator|->
name|counter
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|counter
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|counter
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child3
operator|->
name|counter
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child4
operator|->
name|counter
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|CustomItem
class|class
name|CustomItem
super|:
specifier|public
name|QGraphicsItem
block|{
public|public:
DECL|function|boundingRect
name|QRectF
name|boundingRect
parameter_list|()
specifier|const
block|{
return|return
name|QRectF
argument_list|(
operator|-
literal|110
argument_list|,
operator|-
literal|110
argument_list|,
literal|220
argument_list|,
literal|220
argument_list|)
return|;
block|}
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
for|for
control|(
name|int
name|x
init|=
operator|-
literal|100
init|;
name|x
operator|<=
literal|100
condition|;
name|x
operator|+=
literal|25
control|)
name|painter
operator|->
name|drawLine
argument_list|(
name|x
argument_list|,
operator|-
literal|100
argument_list|,
name|x
argument_list|,
literal|100
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|y
init|=
operator|-
literal|100
init|;
name|y
operator|<=
literal|100
condition|;
name|y
operator|+=
literal|25
control|)
name|painter
operator|->
name|drawLine
argument_list|(
operator|-
literal|100
argument_list|,
name|y
argument_list|,
literal|100
argument_list|,
name|y
argument_list|)
expr_stmt|;
name|QFont
name|font
init|=
name|painter
operator|->
name|font
argument_list|()
decl_stmt|;
name|font
operator|.
name|setPointSize
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|painter
operator|->
name|setFont
argument_list|(
name|font
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|x
init|=
operator|-
literal|100
init|;
name|x
operator|<
literal|100
condition|;
name|x
operator|+=
literal|25
control|)
block|{
for|for
control|(
name|int
name|y
init|=
operator|-
literal|100
init|;
name|y
operator|<
literal|100
condition|;
name|y
operator|+=
literal|25
control|)
block|{
name|painter
operator|->
name|drawText
argument_list|(
name|QRectF
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|,
name|Qt
operator|::
name|AlignCenter
argument_list|,
name|QString
argument_list|(
literal|"%1x%2"
argument_list|)
operator|.
name|arg
argument_list|(
name|x
argument_list|)
operator|.
name|arg
argument_list|(
name|y
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
class|;
end_class
begin_function
DECL|function|ensureVisible
name|void
name|tst_QGraphicsItem
operator|::
name|ensureVisible
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|200
argument_list|,
operator|-
literal|200
argument_list|,
literal|400
argument_list|,
literal|400
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item
init|=
operator|new
name|CustomItem
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|300
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|25
condition|;
operator|++
name|i
control|)
block|{
name|view
operator|.
name|scale
argument_list|(
name|qreal
argument_list|(
literal|1.06
argument_list|)
argument_list|,
name|qreal
argument_list|(
literal|1.06
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
block|}
name|item
operator|->
name|ensureVisible
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|x
init|=
operator|-
literal|100
init|;
name|x
operator|<
literal|100
condition|;
name|x
operator|+=
literal|25
control|)
block|{
for|for
control|(
name|int
name|y
init|=
operator|-
literal|100
init|;
name|y
operator|<
literal|100
condition|;
name|y
operator|+=
literal|25
control|)
block|{
name|int
name|xmargin
init|=
name|rand
argument_list|()
operator|%
literal|75
decl_stmt|;
name|int
name|ymargin
init|=
name|rand
argument_list|()
operator|%
literal|75
decl_stmt|;
name|item
operator|->
name|ensureVisible
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|,
name|xmargin
argument_list|,
name|ymargin
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QPolygonF
name|viewScenePoly
decl_stmt|;
name|viewScenePoly
operator|<<
name|view
operator|.
name|mapToScene
argument_list|(
name|view
operator|.
name|rect
argument_list|()
operator|.
name|topLeft
argument_list|()
argument_list|)
operator|<<
name|view
operator|.
name|mapToScene
argument_list|(
name|view
operator|.
name|rect
argument_list|()
operator|.
name|topRight
argument_list|()
argument_list|)
operator|<<
name|view
operator|.
name|mapToScene
argument_list|(
name|view
operator|.
name|rect
argument_list|()
operator|.
name|bottomRight
argument_list|()
argument_list|)
operator|<<
name|view
operator|.
name|mapToScene
argument_list|(
name|view
operator|.
name|rect
argument_list|()
operator|.
name|bottomLeft
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|viewScenePoly
argument_list|)
operator|.
name|contains
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
name|QPainterPath
name|path
decl_stmt|;
name|path
operator|.
name|addPolygon
argument_list|(
name|viewScenePoly
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|path
operator|.
name|contains
argument_list|(
name|item
operator|->
name|mapToScene
argument_list|(
name|x
operator|+
literal|12
argument_list|,
name|y
operator|+
literal|12
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QPolygonF
name|viewScenePolyMinusMargins
decl_stmt|;
name|viewScenePolyMinusMargins
operator|<<
name|view
operator|.
name|mapToScene
argument_list|(
name|view
operator|.
name|rect
argument_list|()
operator|.
name|topLeft
argument_list|()
operator|+
name|QPoint
argument_list|(
name|xmargin
argument_list|,
name|ymargin
argument_list|)
argument_list|)
operator|<<
name|view
operator|.
name|mapToScene
argument_list|(
name|view
operator|.
name|rect
argument_list|()
operator|.
name|topRight
argument_list|()
operator|+
name|QPoint
argument_list|(
operator|-
name|xmargin
argument_list|,
name|ymargin
argument_list|)
argument_list|)
operator|<<
name|view
operator|.
name|mapToScene
argument_list|(
name|view
operator|.
name|rect
argument_list|()
operator|.
name|bottomRight
argument_list|()
operator|+
name|QPoint
argument_list|(
operator|-
name|xmargin
argument_list|,
operator|-
name|ymargin
argument_list|)
argument_list|)
operator|<<
name|view
operator|.
name|mapToScene
argument_list|(
name|view
operator|.
name|rect
argument_list|()
operator|.
name|bottomLeft
argument_list|()
operator|+
name|QPoint
argument_list|(
name|xmargin
argument_list|,
operator|-
name|ymargin
argument_list|)
argument_list|)
expr_stmt|;
name|QPainterPath
name|path2
decl_stmt|;
name|path2
operator|.
name|addPolygon
argument_list|(
name|viewScenePolyMinusMargins
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|path2
operator|.
name|contains
argument_list|(
name|item
operator|->
name|mapToScene
argument_list|(
name|x
operator|+
literal|12
argument_list|,
name|y
operator|+
literal|12
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|item
operator|->
name|ensureVisible
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
block|}
end_function
begin_ifndef
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
end_ifndef
begin_function
DECL|function|cursor
name|void
name|tst_QGraphicsItem
operator|::
name|cursor
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item1
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item2
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setPos
argument_list|(
operator|-
literal|100
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|hasCursor
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|hasCursor
argument_list|()
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setCursor
argument_list|(
name|Qt
operator|::
name|IBeamCursor
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setCursor
argument_list|(
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|hasCursor
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|hasCursor
argument_list|()
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setCursor
argument_list|(
name|QCursor
argument_list|()
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setCursor
argument_list|(
name|QCursor
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|hasCursor
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|hasCursor
argument_list|()
argument_list|)
expr_stmt|;
name|item1
operator|->
name|unsetCursor
argument_list|()
expr_stmt|;
name|item2
operator|->
name|unsetCursor
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|hasCursor
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|hasCursor
argument_list|()
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setCursor
argument_list|(
name|Qt
operator|::
name|IBeamCursor
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setCursor
argument_list|(
name|Qt
operator|::
name|PointingHandCursor
argument_list|)
expr_stmt|;
name|QWidget
name|topLevel
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|topLevel
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|200
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|topLevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|mouseMove
argument_list|(
operator|&
name|view
argument_list|,
name|view
operator|.
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QCursor
name|cursor
init|=
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
decl_stmt|;
block|{
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|QPoint
argument_list|(
literal|100
argument_list|,
literal|50
argument_list|)
argument_list|,
name|Qt
operator|::
name|NoButton
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|cursor
operator|.
name|shape
argument_list|()
argument_list|)
expr_stmt|;
block|{
name|QTest
operator|::
name|mouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item1
operator|->
name|sceneBoundingRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item1
operator|->
name|sceneBoundingRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
argument_list|,
name|Qt
operator|::
name|NoButton
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|item1
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|)
expr_stmt|;
block|{
name|QTest
operator|::
name|mouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item2
operator|->
name|sceneBoundingRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item2
operator|->
name|sceneBoundingRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
argument_list|,
name|Qt
operator|::
name|NoButton
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|item2
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|)
expr_stmt|;
block|{
name|QTest
operator|::
name|mouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|rect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|MouseMove
argument_list|,
name|QPoint
argument_list|(
literal|100
argument_list|,
literal|25
argument_list|)
argument_list|,
name|Qt
operator|::
name|NoButton
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|cursor
argument_list|()
operator|.
name|shape
argument_list|()
argument_list|,
name|cursor
operator|.
name|shape
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* void tst_QGraphicsItem::textControlGetterSetter() {     QGraphicsTextItem *item = new QGraphicsTextItem;     QVERIFY(item->textControl()->parent() == item);     QPointer<QWidgetTextControl> control = item->textControl();     delete item;     QVERIFY(!control);      item = new QGraphicsTextItem;      QPointer<QWidgetTextControl> oldControl = control;     control = new QWidgetTextControl;      item->setTextControl(control);     QVERIFY(item->textControl() == control);     QVERIFY(!control->parent());     QVERIFY(!oldControl);      // set some text to give it a size, to test that     // setTextControl (re)connects signals     const QRectF oldBoundingRect = item->boundingRect();     QVERIFY(oldBoundingRect.isValid());     item->setPlainText("Some text");     item->adjustSize();     QVERIFY(item->boundingRect().isValid());     QVERIFY(item->boundingRect() != oldBoundingRect);      // test that on setting a control the item size     // is adjusted     oldControl = control;     control = new QWidgetTextControl;     control->setPlainText("foo!");     item->setTextControl(control);     QCOMPARE(item->boundingRect().size(), control->document()->documentLayout()->documentSize());      QVERIFY(oldControl);     delete oldControl;      delete item;     QVERIFY(control);     delete control; } */
end_comment
begin_function
DECL|function|defaultItemTest_QGraphicsLineItem
name|void
name|tst_QGraphicsItem
operator|::
name|defaultItemTest_QGraphicsLineItem
parameter_list|()
block|{
name|QGraphicsLineItem
name|item
decl_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|line
argument_list|()
argument_list|,
name|QLineF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|pen
argument_list|()
argument_list|,
name|QPen
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|shape
argument_list|()
argument_list|,
name|QPainterPath
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|.
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|pen
argument_list|()
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|.
name|setLine
argument_list|(
name|QLineF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|line
argument_list|()
argument_list|,
name|QLineF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|0.5
argument_list|,
operator|-
literal|0.5
argument_list|,
literal|11
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|shape
argument_list|()
operator|.
name|elementCount
argument_list|()
argument_list|,
literal|11
argument_list|)
expr_stmt|;
name|QPainterPath
name|path
decl_stmt|;
name|path
operator|.
name|moveTo
argument_list|(
literal|0
argument_list|,
operator|-
literal|0.5
argument_list|)
expr_stmt|;
name|path
operator|.
name|lineTo
argument_list|(
literal|10
argument_list|,
operator|-
literal|0.5
argument_list|)
expr_stmt|;
name|path
operator|.
name|lineTo
argument_list|(
literal|10.5
argument_list|,
operator|-
literal|0.5
argument_list|)
expr_stmt|;
name|path
operator|.
name|lineTo
argument_list|(
literal|10.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|path
operator|.
name|lineTo
argument_list|(
literal|10
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|path
operator|.
name|lineTo
argument_list|(
literal|0
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|path
operator|.
name|lineTo
argument_list|(
operator|-
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|path
operator|.
name|lineTo
argument_list|(
operator|-
literal|0.5
argument_list|,
operator|-
literal|0.5
argument_list|)
expr_stmt|;
name|path
operator|.
name|lineTo
argument_list|(
literal|0
argument_list|,
operator|-
literal|0.5
argument_list|)
expr_stmt|;
name|path
operator|.
name|lineTo
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|path
operator|.
name|lineTo
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|path
operator|.
name|closeSubpath
argument_list|()
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|11
condition|;
operator|++
name|i
control|)
name|QCOMPARE
argument_list|(
name|QPointF
argument_list|(
name|item
operator|.
name|shape
argument_list|()
operator|.
name|elementAt
argument_list|(
name|i
argument_list|)
argument_list|)
argument_list|,
name|QPointF
argument_list|(
name|path
operator|.
name|elementAt
argument_list|(
name|i
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|defaultItemTest_QGraphicsPixmapItem
name|void
name|tst_QGraphicsItem
operator|::
name|defaultItemTest_QGraphicsPixmapItem
parameter_list|()
block|{
name|QGraphicsPixmapItem
name|item
decl_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|.
name|pixmap
argument_list|()
operator|.
name|isNull
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|offset
argument_list|()
argument_list|,
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|transformationMode
argument_list|()
argument_list|,
name|Qt
operator|::
name|FastTransformation
argument_list|)
expr_stmt|;
name|QPixmap
name|pixmap
argument_list|(
literal|300
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|pixmap
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|item
operator|.
name|setPixmap
argument_list|(
name|pixmap
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|pixmap
argument_list|()
argument_list|,
name|pixmap
argument_list|)
expr_stmt|;
name|item
operator|.
name|setTransformationMode
argument_list|(
name|Qt
operator|::
name|FastTransformation
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|transformationMode
argument_list|()
argument_list|,
name|Qt
operator|::
name|FastTransformation
argument_list|)
expr_stmt|;
name|item
operator|.
name|setTransformationMode
argument_list|(
name|Qt
operator|::
name|SmoothTransformation
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|transformationMode
argument_list|()
argument_list|,
name|Qt
operator|::
name|SmoothTransformation
argument_list|)
expr_stmt|;
name|item
operator|.
name|setOffset
argument_list|(
operator|-
literal|15
argument_list|,
operator|-
literal|15
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|offset
argument_list|()
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|15
argument_list|,
operator|-
literal|15
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|.
name|setOffset
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|offset
argument_list|()
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|300
argument_list|,
literal|200
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|defaultItemTest_QGraphicsTextItem
name|void
name|tst_QGraphicsItem
operator|::
name|defaultItemTest_QGraphicsTextItem
parameter_list|()
block|{
name|QGraphicsTextItem
modifier|*
name|text
init|=
operator|new
name|QGraphicsTextItem
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|text
operator|->
name|openExternalLinks
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|text
operator|->
name|textCursor
argument_list|()
operator|.
name|isNull
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|->
name|defaultTextColor
argument_list|()
argument_list|,
name|QPalette
argument_list|()
operator|.
name|color
argument_list|(
name|QPalette
operator|::
name|Text
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|text
operator|->
name|document
argument_list|()
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|->
name|font
argument_list|()
argument_list|,
name|QApplication
operator|::
name|font
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|->
name|textInteractionFlags
argument_list|()
argument_list|,
name|Qt
operator|::
name|TextInteractionFlags
argument_list|(
name|Qt
operator|::
name|NoTextInteraction
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|->
name|textWidth
argument_list|()
argument_list|,
operator|-
literal|1.0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|->
name|toPlainText
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|""
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|text
argument_list|)
expr_stmt|;
name|text
operator|->
name|setPlainText
argument_list|(
literal|"Hello world"
argument_list|)
expr_stmt|;
name|text
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|event2
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|event2
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|11
argument_list|,
literal|11
argument_list|)
argument_list|)
expr_stmt|;
name|event2
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event2
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event2
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|text
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|text
operator|->
name|setTextInteractionFlags
argument_list|(
name|Qt
operator|::
name|NoTextInteraction
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
operator|(
name|text
operator|->
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemAcceptsInputMethod
operator|)
argument_list|)
expr_stmt|;
name|text
operator|->
name|setTextInteractionFlags
argument_list|(
name|Qt
operator|::
name|TextEditorInteraction
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|->
name|textInteractionFlags
argument_list|()
argument_list|,
name|Qt
operator|::
name|TextInteractionFlags
argument_list|(
name|Qt
operator|::
name|TextEditorInteraction
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|text
operator|->
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemAcceptsInputMethod
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event2
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|event2
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|21
argument_list|,
literal|21
argument_list|)
argument_list|)
expr_stmt|;
name|event2
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event2
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event2
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|text
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
comment|// clicked on edge, item moved
block|}
end_function
begin_function
DECL|function|defaultItemTest_QGraphicsEllipseItem
name|void
name|tst_QGraphicsItem
operator|::
name|defaultItemTest_QGraphicsEllipseItem
parameter_list|()
block|{
name|QGraphicsEllipseItem
name|item
decl_stmt|;
name|item
operator|.
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|.
name|rect
argument_list|()
operator|.
name|isNull
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|.
name|boundingRect
argument_list|()
operator|.
name|isNull
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|.
name|shape
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|spanAngle
argument_list|()
argument_list|,
literal|360
operator|*
literal|16
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|startAngle
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|item
operator|.
name|setRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|.
name|setSpanAngle
argument_list|(
literal|90
operator|*
literal|16
argument_list|)
expr_stmt|;
name|qFuzzyCompare
argument_list|(
name|item
operator|.
name|boundingRect
argument_list|()
operator|.
name|left
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|50.0
argument_list|)
argument_list|)
expr_stmt|;
name|qFuzzyCompare
argument_list|(
name|item
operator|.
name|boundingRect
argument_list|()
operator|.
name|top
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|0.0
argument_list|)
argument_list|)
expr_stmt|;
name|qFuzzyCompare
argument_list|(
name|item
operator|.
name|boundingRect
argument_list|()
operator|.
name|width
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|50.0
argument_list|)
argument_list|)
expr_stmt|;
name|qFuzzyCompare
argument_list|(
name|item
operator|.
name|boundingRect
argument_list|()
operator|.
name|height
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|50.0
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|.
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|49.5
argument_list|,
operator|-
literal|0.5
argument_list|,
literal|51
argument_list|,
literal|51
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|.
name|setSpanAngle
argument_list|(
literal|180
operator|*
literal|16
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|0.5
argument_list|,
operator|-
literal|0.5
argument_list|,
literal|101
argument_list|,
literal|51
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|.
name|setSpanAngle
argument_list|(
literal|360
operator|*
literal|16
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|0.5
argument_list|,
operator|-
literal|0.5
argument_list|,
literal|101
argument_list|,
literal|101
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|ItemChangeTester
class|class
name|ItemChangeTester
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|ItemChangeTester
name|ItemChangeTester
parameter_list|()
block|{
name|setFlag
argument_list|(
name|ItemSendsGeometryChanges
argument_list|)
expr_stmt|;
name|clear
argument_list|()
expr_stmt|;
block|}
DECL|function|ItemChangeTester
name|ItemChangeTester
parameter_list|(
name|QGraphicsItem
modifier|*
name|parent
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|parent
argument_list|)
block|{
name|setFlag
argument_list|(
name|ItemSendsGeometryChanges
argument_list|)
expr_stmt|;
name|clear
argument_list|()
expr_stmt|;
block|}
DECL|function|clear
name|void
name|clear
parameter_list|()
block|{
name|itemChangeReturnValue
operator|=
name|QVariant
argument_list|()
expr_stmt|;
name|itemSceneChangeTargetScene
operator|=
literal|0
expr_stmt|;
name|changes
operator|.
name|clear
argument_list|()
expr_stmt|;
name|values
operator|.
name|clear
argument_list|()
expr_stmt|;
name|oldValues
operator|.
name|clear
argument_list|()
expr_stmt|;
block|}
DECL|member|itemChangeReturnValue
name|QVariant
name|itemChangeReturnValue
decl_stmt|;
DECL|member|itemSceneChangeTargetScene
name|QGraphicsScene
modifier|*
name|itemSceneChangeTargetScene
decl_stmt|;
DECL|member|changes
name|QList
argument_list|<
name|GraphicsItemChange
argument_list|>
name|changes
decl_stmt|;
DECL|member|values
name|QList
argument_list|<
name|QVariant
argument_list|>
name|values
decl_stmt|;
DECL|member|oldValues
name|QList
argument_list|<
name|QVariant
argument_list|>
name|oldValues
decl_stmt|;
protected|protected:
DECL|function|itemChange
name|QVariant
name|itemChange
parameter_list|(
name|GraphicsItemChange
name|change
parameter_list|,
specifier|const
name|QVariant
modifier|&
name|value
parameter_list|)
block|{
name|changes
operator|<<
name|change
expr_stmt|;
name|values
operator|<<
name|value
expr_stmt|;
switch|switch
condition|(
name|change
condition|)
block|{
case|case
name|QGraphicsItem
operator|::
name|ItemPositionChange
case|:
name|oldValues
operator|<<
name|pos
argument_list|()
expr_stmt|;
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemPositionHasChanged
case|:
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemMatrixChange
case|:
block|{
name|QVariant
name|variant
decl_stmt|;
name|variant
operator|.
name|setValue
argument_list|<
name|QMatrix
argument_list|>
argument_list|(
name|matrix
argument_list|()
argument_list|)
expr_stmt|;
name|oldValues
operator|<<
name|variant
expr_stmt|;
block|}
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemTransformChange
case|:
block|{
name|QVariant
name|variant
decl_stmt|;
name|variant
operator|.
name|setValue
argument_list|<
name|QTransform
argument_list|>
argument_list|(
name|transform
argument_list|()
argument_list|)
expr_stmt|;
name|oldValues
operator|<<
name|variant
expr_stmt|;
block|}
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemTransformHasChanged
case|:
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemVisibleChange
case|:
name|oldValues
operator|<<
name|isVisible
argument_list|()
expr_stmt|;
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemVisibleHasChanged
case|:
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemEnabledChange
case|:
name|oldValues
operator|<<
name|isEnabled
argument_list|()
expr_stmt|;
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemEnabledHasChanged
case|:
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemSelectedChange
case|:
name|oldValues
operator|<<
name|isSelected
argument_list|()
expr_stmt|;
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemSelectedHasChanged
case|:
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemParentChange
case|:
name|oldValues
operator|<<
name|QVariant
operator|::
name|fromValue
argument_list|<
name|void
operator|*
argument_list|>
argument_list|(
name|parentItem
argument_list|()
argument_list|)
expr_stmt|;
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemParentHasChanged
case|:
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemChildAddedChange
case|:
name|oldValues
operator|<<
name|children
argument_list|()
operator|.
name|size
argument_list|()
expr_stmt|;
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemChildRemovedChange
case|:
name|oldValues
operator|<<
name|children
argument_list|()
operator|.
name|size
argument_list|()
expr_stmt|;
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemSceneChange
case|:
name|oldValues
operator|<<
name|QVariant
operator|::
name|fromValue
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|scene
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|itemSceneChangeTargetScene
operator|&&
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|value
argument_list|)
operator|&&
name|itemSceneChangeTargetScene
operator|!=
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|value
argument_list|)
condition|)
block|{
return|return
name|QVariant
operator|::
name|fromValue
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|itemSceneChangeTargetScene
argument_list|)
return|;
block|}
return|return
name|value
return|;
case|case
name|QGraphicsItem
operator|::
name|ItemSceneHasChanged
case|:
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemCursorChange
case|:
ifndef|#
directive|ifndef
name|QTEST_NO_CURSOR
name|oldValues
operator|<<
name|cursor
argument_list|()
expr_stmt|;
endif|#
directive|endif
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemCursorHasChanged
case|:
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemToolTipChange
case|:
name|oldValues
operator|<<
name|toolTip
argument_list|()
expr_stmt|;
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemToolTipHasChanged
case|:
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemFlagsChange
case|:
name|oldValues
operator|<<
name|quint32
argument_list|(
name|flags
argument_list|()
argument_list|)
expr_stmt|;
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemFlagsHaveChanged
case|:
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemZValueChange
case|:
name|oldValues
operator|<<
name|zValue
argument_list|()
expr_stmt|;
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemZValueHasChanged
case|:
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemOpacityChange
case|:
name|oldValues
operator|<<
name|opacity
argument_list|()
expr_stmt|;
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemOpacityHasChanged
case|:
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
case|:
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemRotationChange
case|:
name|oldValues
operator|<<
name|rotation
argument_list|()
expr_stmt|;
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemRotationHasChanged
case|:
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemScaleChange
case|:
name|oldValues
operator|<<
name|scale
argument_list|()
expr_stmt|;
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemScaleHasChanged
case|:
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemTransformOriginPointChange
case|:
name|oldValues
operator|<<
name|transformOriginPoint
argument_list|()
expr_stmt|;
break|break;
case|case
name|QGraphicsItem
operator|::
name|ItemTransformOriginPointHasChanged
case|:
break|break;
block|}
return|return
name|itemChangeReturnValue
operator|.
name|isValid
argument_list|()
condition|?
name|itemChangeReturnValue
else|:
name|value
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|itemChange
name|void
name|tst_QGraphicsItem
operator|::
name|itemChange
parameter_list|()
block|{
name|ItemChangeTester
name|tester
decl_stmt|;
name|tester
operator|.
name|itemSceneChangeTargetScene
operator|=
literal|0
expr_stmt|;
name|ItemChangeTester
name|testerHelper
decl_stmt|;
name|QVERIFY
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|tester
operator|.
name|values
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|int
name|changeCount
init|=
literal|0
decl_stmt|;
block|{
comment|// ItemEnabledChange
name|tester
operator|.
name|itemChangeReturnValue
operator|=
literal|true
expr_stmt|;
name|tester
operator|.
name|setEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// HasChanged
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemEnabledChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemEnabledHasChanged
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QVariant
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QVariant
argument_list|(
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|last
argument_list|()
argument_list|,
name|QVariant
argument_list|(
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|isEnabled
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
block|{
comment|// ItemMatrixChange / ItemTransformHasChanged
name|tester
operator|.
name|itemChangeReturnValue
operator|.
name|setValue
argument_list|<
name|QMatrix
argument_list|>
argument_list|(
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
name|tester
operator|.
name|setMatrix
argument_list|(
name|QMatrix
argument_list|()
operator|.
name|translate
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// notification sent too
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
operator|++
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|)
argument_list|,
name|int
argument_list|(
name|QGraphicsItem
operator|::
name|ItemMatrixChange
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|last
argument_list|()
argument_list|)
argument_list|,
name|int
argument_list|(
name|QGraphicsItem
operator|::
name|ItemTransformHasChanged
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QMatrix
argument_list|>
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|)
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|translate
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|last
argument_list|()
argument_list|,
name|QVariant
argument_list|(
name|QTransform
argument_list|(
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QVariant
name|variant
decl_stmt|;
name|variant
operator|.
name|setValue
argument_list|<
name|QMatrix
argument_list|>
argument_list|(
name|QMatrix
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|last
argument_list|()
argument_list|,
name|variant
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|matrix
argument_list|()
argument_list|,
name|QMatrix
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|{
name|tester
operator|.
name|resetTransform
argument_list|()
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// notification sent too
comment|// ItemTransformChange / ItemTransformHasChanged
name|tester
operator|.
name|itemChangeReturnValue
operator|.
name|setValue
argument_list|<
name|QTransform
argument_list|>
argument_list|(
name|QTransform
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
name|tester
operator|.
name|translate
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// notification sent too
operator|++
name|changeCount
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemTransformChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemTransformHasChanged
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTransform
argument_list|>
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|)
argument_list|,
name|QTransform
argument_list|()
operator|.
name|translate
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QTransform
argument_list|>
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|)
argument_list|,
name|QTransform
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
name|QVariant
name|variant
decl_stmt|;
name|variant
operator|.
name|setValue
argument_list|<
name|QTransform
argument_list|>
argument_list|(
name|QTransform
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|last
argument_list|()
argument_list|,
name|variant
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|transform
argument_list|()
argument_list|,
name|QTransform
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|{
comment|// ItemPositionChange / ItemPositionHasChanged
name|tester
operator|.
name|itemChangeReturnValue
operator|=
name|QPointF
argument_list|(
literal|42
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|tester
operator|.
name|setPos
argument_list|(
literal|0
argument_list|,
literal|42
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// notification sent too
operator|++
name|changeCount
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemPositionChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemPositionHasChanged
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QVariant
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|42
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QVariant
argument_list|(
name|QPointF
argument_list|(
literal|42
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|last
argument_list|()
argument_list|,
name|QVariant
argument_list|(
name|QPointF
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|42
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|{
comment|// ItemZValueChange / ItemZValueHasChanged
name|tester
operator|.
name|itemChangeReturnValue
operator|=
name|qreal
argument_list|(
literal|2.0
argument_list|)
expr_stmt|;
name|tester
operator|.
name|setZValue
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// notification sent too
operator|++
name|changeCount
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemZValueChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemZValueHasChanged
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QVariant
argument_list|(
name|qreal
argument_list|(
literal|1.0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QVariant
argument_list|(
name|qreal
argument_list|(
literal|2.0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|last
argument_list|()
argument_list|,
name|QVariant
argument_list|(
name|qreal
argument_list|(
literal|0.0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|2.0
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|{
comment|// ItemRotationChange / ItemRotationHasChanged
name|tester
operator|.
name|itemChangeReturnValue
operator|=
name|qreal
argument_list|(
literal|15.0
argument_list|)
expr_stmt|;
name|tester
operator|.
name|setRotation
argument_list|(
literal|10.0
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// notification sent too
operator|++
name|changeCount
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemRotationChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemRotationHasChanged
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QVariant
argument_list|(
name|qreal
argument_list|(
literal|10.0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QVariant
argument_list|(
name|qreal
argument_list|(
literal|15.0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|last
argument_list|()
argument_list|,
name|QVariant
argument_list|(
name|qreal
argument_list|(
literal|0.0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|rotation
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|15.0
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|{
comment|// ItemScaleChange / ItemScaleHasChanged
name|tester
operator|.
name|itemChangeReturnValue
operator|=
name|qreal
argument_list|(
literal|2.0
argument_list|)
expr_stmt|;
name|tester
operator|.
name|setScale
argument_list|(
literal|1.5
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// notification sent too
operator|++
name|changeCount
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemScaleChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemScaleHasChanged
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QVariant
argument_list|(
name|qreal
argument_list|(
literal|1.5
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QVariant
argument_list|(
name|qreal
argument_list|(
literal|2.0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|last
argument_list|()
argument_list|,
name|QVariant
argument_list|(
name|qreal
argument_list|(
literal|1.0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|scale
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|2.0
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|{
comment|// ItemTransformOriginPointChange / ItemTransformOriginPointHasChanged
name|tester
operator|.
name|itemChangeReturnValue
operator|=
name|QPointF
argument_list|(
literal|2.0
argument_list|,
literal|2.0
argument_list|)
expr_stmt|;
name|tester
operator|.
name|setTransformOriginPoint
argument_list|(
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// notification sent too
operator|++
name|changeCount
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemTransformOriginPointChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemTransformOriginPointHasChanged
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QVariant
argument_list|(
name|QPointF
argument_list|(
literal|1.0
argument_list|,
literal|1.0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QVariant
argument_list|(
name|QPointF
argument_list|(
literal|2.0
argument_list|,
literal|2.0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|last
argument_list|()
argument_list|,
name|QVariant
argument_list|(
name|QPointF
argument_list|(
literal|0.0
argument_list|,
literal|0.0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|transformOriginPoint
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|2.0
argument_list|,
literal|2.0
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|{
comment|// ItemFlagsChange
name|tester
operator|.
name|itemChangeReturnValue
operator|=
name|QGraphicsItem
operator|::
name|ItemIsSelectable
expr_stmt|;
name|tester
operator|.
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
comment|// No change
name|tester
operator|.
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|,
literal|true
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// ItemFlagsHasChanged
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemFlagsChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemFlagsHaveChanged
argument_list|)
expr_stmt|;
name|QVariant
name|expectedFlags
init|=
name|QVariant
operator|::
name|fromValue
argument_list|<
name|quint32
argument_list|>
argument_list|(
name|QGraphicsItem
operator|::
name|GraphicsItemFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
operator||
name|QGraphicsItem
operator|::
name|ItemSendsGeometryChanges
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|expectedFlags
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QVariant
operator|::
name|fromValue
argument_list|<
name|quint32
argument_list|>
argument_list|(
operator|(
name|quint32
operator|)
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|{
comment|// ItemSelectedChange
name|tester
operator|.
name|setSelected
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
comment|// No change :-)
name|tester
operator|.
name|itemChangeReturnValue
operator|=
literal|true
expr_stmt|;
name|tester
operator|.
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// ItemSelectedHasChanged
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemSelectedChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemSelectedHasChanged
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QVariant
argument_list|(
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QVariant
argument_list|(
literal|true
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|last
argument_list|()
argument_list|,
name|QVariant
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|isSelected
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|tester
operator|.
name|itemChangeReturnValue
operator|=
literal|false
expr_stmt|;
name|tester
operator|.
name|setSelected
argument_list|(
literal|true
argument_list|)
expr_stmt|;
comment|// the value hasn't changed to the itemChange return value
comment|// bacause itemChange is never called (true -> true is a noop).
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|isSelected
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
block|{
comment|// ItemVisibleChange
name|tester
operator|.
name|itemChangeReturnValue
operator|=
literal|false
expr_stmt|;
name|QVERIFY
argument_list|(
name|tester
operator|.
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|tester
operator|.
name|setVisible
argument_list|(
literal|false
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// ItemVisibleChange
operator|++
name|changeCount
expr_stmt|;
comment|// ItemSelectedChange
operator|++
name|changeCount
expr_stmt|;
comment|// ItemSelectedHasChanged
operator|++
name|changeCount
expr_stmt|;
comment|// ItemVisibleHasChanged
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|4
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemVisibleChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|3
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemSelectedChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemSelectedHasChanged
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemVisibleHasChanged
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|4
argument_list|)
argument_list|,
name|QVariant
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|3
argument_list|)
argument_list|,
name|QVariant
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QVariant
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QVariant
argument_list|(
literal|false
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|isVisible
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
block|{
comment|// ItemParentChange
name|tester
operator|.
name|itemChangeReturnValue
operator|.
name|setValue
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|tester
operator|.
name|setParentItem
argument_list|(
operator|&
name|testerHelper
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
operator|++
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|last
argument_list|()
argument_list|,
name|QGraphicsItem
operator|::
name|ItemParentChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|values
operator|.
name|last
argument_list|()
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|&
name|testerHelper
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|last
argument_list|()
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|parentItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
block|{
comment|// ItemOpacityChange
name|tester
operator|.
name|itemChangeReturnValue
operator|=
literal|1.0
expr_stmt|;
name|tester
operator|.
name|setOpacity
argument_list|(
literal|0.7
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
operator|++
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|last
argument_list|()
argument_list|,
name|QGraphicsItem
operator|::
name|ItemOpacityChange
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qFuzzyCompare
argument_list|(
name|qreal
argument_list|(
name|tester
operator|.
name|values
operator|.
name|last
argument_list|()
operator|.
name|toDouble
argument_list|()
argument_list|)
argument_list|,
name|qreal
argument_list|(
literal|0.7
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|last
argument_list|()
operator|.
name|toDouble
argument_list|()
argument_list|,
name|double
argument_list|(
literal|1.0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|opacity
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|1.0
argument_list|)
argument_list|)
expr_stmt|;
name|tester
operator|.
name|itemChangeReturnValue
operator|=
literal|0.7
expr_stmt|;
name|tester
operator|.
name|setOpacity
argument_list|(
literal|0.7
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// ItemOpacityChange
operator|++
name|changeCount
expr_stmt|;
comment|// ItemOpacityHasChanged
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemOpacityChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemOpacityHasChanged
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|opacity
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|0.7
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|{
comment|// ItemChildAddedChange
name|tester
operator|.
name|itemChangeReturnValue
operator|.
name|clear
argument_list|()
expr_stmt|;
name|testerHelper
operator|.
name|setParentItem
argument_list|(
operator|&
name|tester
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
operator|++
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|last
argument_list|()
argument_list|,
name|QGraphicsItem
operator|::
name|ItemChildAddedChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|values
operator|.
name|last
argument_list|()
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|&
name|testerHelper
argument_list|)
expr_stmt|;
block|}
block|{
comment|// ItemChildRemovedChange 1
name|testerHelper
operator|.
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
operator|++
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|last
argument_list|()
argument_list|,
name|QGraphicsItem
operator|::
name|ItemChildRemovedChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|values
operator|.
name|last
argument_list|()
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|&
name|testerHelper
argument_list|)
expr_stmt|;
comment|// ItemChildRemovedChange 1
name|ItemChangeTester
modifier|*
name|test
init|=
operator|new
name|ItemChangeTester
decl_stmt|;
name|test
operator|->
name|itemSceneChangeTargetScene
operator|=
literal|0
expr_stmt|;
name|int
name|count
init|=
literal|0
decl_stmt|;
name|QGraphicsScene
modifier|*
name|scene
init|=
operator|new
name|QGraphicsScene
decl_stmt|;
name|scene
operator|->
name|addItem
argument_list|(
name|test
argument_list|)
expr_stmt|;
name|count
operator|=
name|test
operator|->
name|changes
operator|.
name|size
argument_list|()
expr_stmt|;
comment|//We test here the fact that when a child is deleted the parent receive only one ItemChildRemovedChange
name|QGraphicsRectItem
modifier|*
name|child
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|test
argument_list|)
decl_stmt|;
comment|//We received ItemChildAddedChange
name|QCOMPARE
argument_list|(
name|test
operator|->
name|changes
operator|.
name|size
argument_list|()
argument_list|,
operator|++
name|count
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|test
operator|->
name|changes
operator|.
name|last
argument_list|()
argument_list|,
name|QGraphicsItem
operator|::
name|ItemChildAddedChange
argument_list|)
expr_stmt|;
operator|delete
name|child
expr_stmt|;
name|child
operator|=
literal|0
expr_stmt|;
name|QCOMPARE
argument_list|(
name|test
operator|->
name|changes
operator|.
name|size
argument_list|()
argument_list|,
operator|++
name|count
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|test
operator|->
name|changes
operator|.
name|last
argument_list|()
argument_list|,
name|QGraphicsItem
operator|::
name|ItemChildRemovedChange
argument_list|)
expr_stmt|;
name|ItemChangeTester
modifier|*
name|childTester
init|=
operator|new
name|ItemChangeTester
argument_list|(
name|test
argument_list|)
decl_stmt|;
comment|//Changes contains all sceneHasChanged and so on, we don't want to test that
name|int
name|childCount
init|=
name|childTester
operator|->
name|changes
operator|.
name|size
argument_list|()
decl_stmt|;
comment|//We received ItemChildAddedChange
name|QCOMPARE
argument_list|(
name|test
operator|->
name|changes
operator|.
name|size
argument_list|()
argument_list|,
operator|++
name|count
argument_list|)
expr_stmt|;
name|child
operator|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|childTester
argument_list|)
expr_stmt|;
comment|//We received ItemChildAddedChange
name|QCOMPARE
argument_list|(
name|childTester
operator|->
name|changes
operator|.
name|size
argument_list|()
argument_list|,
operator|++
name|childCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|childTester
operator|->
name|changes
operator|.
name|last
argument_list|()
argument_list|,
name|QGraphicsItem
operator|::
name|ItemChildAddedChange
argument_list|)
expr_stmt|;
comment|//Delete the child of the top level with all its children
operator|delete
name|childTester
expr_stmt|;
comment|//Only one removal
name|QCOMPARE
argument_list|(
name|test
operator|->
name|changes
operator|.
name|size
argument_list|()
argument_list|,
operator|++
name|count
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|test
operator|->
name|changes
operator|.
name|last
argument_list|()
argument_list|,
name|QGraphicsItem
operator|::
name|ItemChildRemovedChange
argument_list|)
expr_stmt|;
operator|delete
name|scene
expr_stmt|;
block|}
block|{
comment|// ItemChildRemovedChange 2
name|ItemChangeTester
name|parent
decl_stmt|;
name|ItemChangeTester
modifier|*
name|child
init|=
operator|new
name|ItemChangeTester
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
operator|&
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|.
name|changes
operator|.
name|last
argument_list|()
argument_list|,
name|QGraphicsItem
operator|::
name|ItemChildAddedChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|parent
operator|.
name|values
operator|.
name|last
argument_list|()
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|child
argument_list|)
expr_stmt|;
operator|delete
name|child
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|.
name|changes
operator|.
name|last
argument_list|()
argument_list|,
name|QGraphicsItem
operator|::
name|ItemChildRemovedChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|parent
operator|.
name|values
operator|.
name|last
argument_list|()
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|child
argument_list|)
expr_stmt|;
block|}
block|{
comment|// !!! Note: If this test crashes because of double-deletion, there's
comment|// a bug somewhere in QGraphicsScene or QGraphicsItem.
comment|// ItemSceneChange
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsScene
name|scene2
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|tester
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// ItemSceneChange (scene)
operator|++
name|changeCount
expr_stmt|;
comment|// ItemSceneHasChanged (scene)
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|scene
argument_list|()
argument_list|,
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemSceneChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemSceneHasChanged
argument_list|)
expr_stmt|;
comment|// Item's old value was 0
comment|// Item's current value is scene
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|last
argument_list|()
argument_list|)
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|values
operator|.
name|last
argument_list|()
argument_list|)
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
operator|&
name|scene
argument_list|)
expr_stmt|;
name|scene2
operator|.
name|addItem
argument_list|(
operator|&
name|tester
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// ItemSceneChange (0) was: (scene)
operator|++
name|changeCount
expr_stmt|;
comment|// ItemSceneHasChanged (0)
operator|++
name|changeCount
expr_stmt|;
comment|// ItemSceneChange (scene2) was: (0)
operator|++
name|changeCount
expr_stmt|;
comment|// ItemSceneHasChanged (scene2)
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|scene
argument_list|()
argument_list|,
operator|&
name|scene2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|4
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemSceneChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|3
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemSceneHasChanged
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemSceneChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemSceneHasChanged
argument_list|)
expr_stmt|;
comment|// Item's last old value was scene
comment|// Item's last current value is 0
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|at
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|)
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|at
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|)
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|4
argument_list|)
argument_list|)
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|3
argument_list|)
argument_list|)
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|)
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
operator|&
name|scene2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|)
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
operator|&
name|scene2
argument_list|)
expr_stmt|;
comment|// Item's last old value was 0
comment|// Item's last current value is scene2
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|last
argument_list|()
argument_list|)
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|values
operator|.
name|last
argument_list|()
argument_list|)
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
operator|&
name|scene2
argument_list|)
expr_stmt|;
name|scene2
operator|.
name|removeItem
argument_list|(
operator|&
name|tester
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// ItemSceneChange (0) was: (scene2)
operator|++
name|changeCount
expr_stmt|;
comment|// ItemSceneHasChanged (0)
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|scene
argument_list|()
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemSceneChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemSceneHasChanged
argument_list|)
expr_stmt|;
comment|// Item's last old value was scene2
comment|// Item's last current value is 0
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|oldValues
operator|.
name|last
argument_list|()
argument_list|)
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
operator|&
name|scene2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|)
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|)
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|tester
operator|.
name|itemSceneChangeTargetScene
operator|=
operator|&
name|scene
expr_stmt|;
name|scene2
operator|.
name|addItem
argument_list|(
operator|&
name|tester
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// ItemSceneChange (scene2) was: (0)
operator|++
name|changeCount
expr_stmt|;
comment|// ItemSceneChange (scene) was: (0)
operator|++
name|changeCount
expr_stmt|;
comment|// ItemSceneHasChanged (scene)
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|3
argument_list|)
argument_list|)
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
operator|&
name|scene2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|2
argument_list|)
argument_list|)
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QGraphicsScene
operator|*
argument_list|>
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|tester
operator|.
name|values
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
argument_list|)
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
operator|&
name|scene
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|scene
argument_list|()
argument_list|,
operator|&
name|scene
argument_list|)
expr_stmt|;
name|tester
operator|.
name|itemSceneChangeTargetScene
operator|=
literal|0
expr_stmt|;
name|tester
operator|.
name|itemChangeReturnValue
operator|=
name|QVariant
argument_list|()
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
operator|&
name|tester
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// ItemSceneChange
operator|++
name|changeCount
expr_stmt|;
comment|// ItemSceneHasChanged
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|scene
argument_list|()
argument_list|,
operator|(
name|QGraphicsScene
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
block|{
comment|// ItemToolTipChange/ItemToolTipHasChanged
specifier|const
name|QString
name|toolTip
argument_list|(
name|QLatin1String
argument_list|(
literal|"I'm soo cool"
argument_list|)
argument_list|)
decl_stmt|;
specifier|const
name|QString
name|overridenToolTip
argument_list|(
name|QLatin1String
argument_list|(
literal|"No, you are not soo cool"
argument_list|)
argument_list|)
decl_stmt|;
name|tester
operator|.
name|itemChangeReturnValue
operator|=
name|overridenToolTip
expr_stmt|;
name|tester
operator|.
name|setToolTip
argument_list|(
name|toolTip
argument_list|)
expr_stmt|;
operator|++
name|changeCount
expr_stmt|;
comment|// ItemToolTipChange
operator|++
name|changeCount
expr_stmt|;
comment|// ItemToolTipHasChanged
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
name|changeCount
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|changeCount
operator|-
literal|2
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemToolTipChange
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|changeCount
operator|-
literal|2
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|toolTip
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|changes
operator|.
name|at
argument_list|(
name|changeCount
operator|-
literal|1
argument_list|)
argument_list|,
name|QGraphicsItem
operator|::
name|ItemToolTipHasChanged
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|values
operator|.
name|at
argument_list|(
name|changeCount
operator|-
literal|1
argument_list|)
operator|.
name|toString
argument_list|()
argument_list|,
name|overridenToolTip
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|.
name|toolTip
argument_list|()
argument_list|,
name|overridenToolTip
argument_list|)
expr_stmt|;
name|tester
operator|.
name|itemChangeReturnValue
operator|=
name|QVariant
argument_list|()
expr_stmt|;
block|}
block|}
end_function
begin_class
DECL|class|EventFilterTesterItem
class|class
name|EventFilterTesterItem
super|:
specifier|public
name|QGraphicsLineItem
block|{
public|public:
DECL|member|filteredEvents
name|QList
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|>
name|filteredEvents
decl_stmt|;
DECL|member|filteredEventReceivers
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|filteredEventReceivers
decl_stmt|;
DECL|member|handlesSceneEvents
name|bool
name|handlesSceneEvents
decl_stmt|;
DECL|member|receivedEvents
name|QList
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|>
name|receivedEvents
decl_stmt|;
DECL|function|EventFilterTesterItem
name|EventFilterTesterItem
parameter_list|()
member_init_list|:
name|handlesSceneEvents
argument_list|(
literal|false
argument_list|)
block|{}
protected|protected:
DECL|function|sceneEventFilter
name|bool
name|sceneEventFilter
parameter_list|(
name|QGraphicsItem
modifier|*
name|watched
parameter_list|,
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
name|filteredEvents
operator|<<
name|event
operator|->
name|type
argument_list|()
expr_stmt|;
name|filteredEventReceivers
operator|<<
name|watched
expr_stmt|;
return|return
name|handlesSceneEvents
return|;
block|}
DECL|function|sceneEvent
name|bool
name|sceneEvent
parameter_list|(
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
return|return
name|QGraphicsLineItem
operator|::
name|sceneEvent
argument_list|(
name|event
argument_list|)
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|sceneEventFilter
name|void
name|tst_QGraphicsItem
operator|::
name|sceneEventFilter
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsTextItem
modifier|*
name|text1
init|=
name|scene
operator|.
name|addText
argument_list|(
name|QLatin1String
argument_list|(
literal|"Text1"
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsTextItem
modifier|*
name|text2
init|=
name|scene
operator|.
name|addText
argument_list|(
name|QLatin1String
argument_list|(
literal|"Text2"
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsTextItem
modifier|*
name|text3
init|=
name|scene
operator|.
name|addText
argument_list|(
name|QLatin1String
argument_list|(
literal|"Text3"
argument_list|)
argument_list|)
decl_stmt|;
name|text1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|text2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|text3
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|EventFilterTesterItem
modifier|*
name|tester
init|=
operator|new
name|EventFilterTesterItem
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|tester
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|text1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|text1
operator|->
name|installSceneEventFilter
argument_list|(
name|tester
argument_list|)
expr_stmt|;
name|text1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|text1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEvents
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEvents
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|QEvent
operator|::
name|FocusIn
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEventReceivers
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|text1
argument_list|)
argument_list|)
expr_stmt|;
name|text2
operator|->
name|installSceneEventFilter
argument_list|(
name|tester
argument_list|)
expr_stmt|;
name|text3
operator|->
name|installSceneEventFilter
argument_list|(
name|tester
argument_list|)
expr_stmt|;
name|text2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|text3
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEvents
operator|.
name|size
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEvents
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|QEvent
operator|::
name|FocusOut
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEventReceivers
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|text1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEvents
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
name|QEvent
operator|::
name|FocusIn
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEventReceivers
operator|.
name|at
argument_list|(
literal|2
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|text2
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEvents
operator|.
name|at
argument_list|(
literal|3
argument_list|)
argument_list|,
name|QEvent
operator|::
name|FocusOut
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEventReceivers
operator|.
name|at
argument_list|(
literal|3
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|text2
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEvents
operator|.
name|at
argument_list|(
literal|4
argument_list|)
argument_list|,
name|QEvent
operator|::
name|FocusIn
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEventReceivers
operator|.
name|at
argument_list|(
literal|4
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|text3
argument_list|)
argument_list|)
expr_stmt|;
name|text1
operator|->
name|removeSceneEventFilter
argument_list|(
name|tester
argument_list|)
expr_stmt|;
name|text1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEvents
operator|.
name|size
argument_list|()
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEvents
operator|.
name|at
argument_list|(
literal|5
argument_list|)
argument_list|,
name|QEvent
operator|::
name|FocusOut
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEventReceivers
operator|.
name|at
argument_list|(
literal|5
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|text3
argument_list|)
argument_list|)
expr_stmt|;
name|tester
operator|->
name|handlesSceneEvents
operator|=
literal|true
expr_stmt|;
name|text2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEvents
operator|.
name|size
argument_list|()
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEvents
operator|.
name|at
argument_list|(
literal|6
argument_list|)
argument_list|,
name|QEvent
operator|::
name|FocusIn
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|filteredEventReceivers
operator|.
name|at
argument_list|(
literal|6
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|text2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|text2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|//Let check if the items are correctly removed from the sceneEventFilters array
comment|//to avoid stale pointers.
name|QGraphicsView
name|gv
decl_stmt|;
name|QGraphicsScene
modifier|*
name|anotherScene
init|=
operator|new
name|QGraphicsScene
decl_stmt|;
name|QGraphicsTextItem
modifier|*
name|ti
init|=
name|anotherScene
operator|->
name|addText
argument_list|(
literal|"This is a test #1"
argument_list|)
decl_stmt|;
name|ti
operator|->
name|moveBy
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|QGraphicsTextItem
modifier|*
name|ti2
init|=
name|anotherScene
operator|->
name|addText
argument_list|(
literal|"This is a test #2"
argument_list|)
decl_stmt|;
name|QGraphicsTextItem
modifier|*
name|ti3
init|=
name|anotherScene
operator|->
name|addText
argument_list|(
literal|"This is a test #3"
argument_list|)
decl_stmt|;
name|gv
operator|.
name|setScene
argument_list|(
name|anotherScene
argument_list|)
expr_stmt|;
name|gv
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|gv
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|ti
operator|->
name|installSceneEventFilter
argument_list|(
name|ti2
argument_list|)
expr_stmt|;
name|ti3
operator|->
name|installSceneEventFilter
argument_list|(
name|ti
argument_list|)
expr_stmt|;
operator|delete
name|ti2
expr_stmt|;
comment|//we souldn't crash
name|QTest
operator|::
name|mouseMove
argument_list|(
name|gv
operator|.
name|viewport
argument_list|()
argument_list|,
name|gv
operator|.
name|mapFromScene
argument_list|(
name|ti
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|30
argument_list|)
expr_stmt|;
operator|delete
name|ti
expr_stmt|;
block|}
end_function
begin_class
DECL|class|GeometryChanger
class|class
name|GeometryChanger
super|:
specifier|public
name|QGraphicsItem
block|{
public|public:
DECL|function|changeGeometry
name|void
name|changeGeometry
parameter_list|()
block|{
name|prepareGeometryChange
argument_list|()
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|prepareGeometryChange
name|void
name|tst_QGraphicsItem
operator|::
name|prepareGeometryChange
parameter_list|()
block|{
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
operator|.
name|contains
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
operator|(
operator|(
name|GeometryChanger
operator|*
operator|)
name|item
operator|)
operator|->
name|changeGeometry
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
operator|.
name|contains
argument_list|(
name|item
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_class
DECL|class|PaintTester
class|class
name|PaintTester
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|PaintTester
name|PaintTester
parameter_list|()
member_init_list|:
name|widget
argument_list|(
name|NULL
argument_list|)
member_init_list|,
name|painted
argument_list|(
literal|0
argument_list|)
block|{
name|setRect
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
name|w
parameter_list|)
block|{
name|widget
operator|=
name|w
expr_stmt|;
name|painted
operator|++
expr_stmt|;
block|}
DECL|member|widget
name|QWidget
modifier|*
name|widget
decl_stmt|;
DECL|member|painted
name|int
name|painted
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|paint
name|void
name|tst_QGraphicsItem
operator|::
name|paint
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|PaintTester
name|paintTester
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|paintTester
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
ifdef|#
directive|ifdef
name|Q_OS_WIN32
comment|//we try to switch the desktop: if it fails, we skip the test
if|if
condition|(
operator|::
name|SwitchDesktop
argument_list|(
operator|::
name|GetThreadDesktop
argument_list|(
operator|::
name|GetCurrentThreadId
argument_list|()
argument_list|)
argument_list|)
operator|==
literal|0
condition|)
block|{
name|QSKIP
argument_list|(
literal|"The Graphics View doesn't get the paint events"
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|QTRY_COMPARE
argument_list|(
name|paintTester
operator|.
name|widget
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|hide
argument_list|()
expr_stmt|;
name|QGraphicsScene
name|scene2
decl_stmt|;
name|QGraphicsView
name|view2
argument_list|(
operator|&
name|scene2
argument_list|)
decl_stmt|;
name|view2
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view2
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|PaintTester
name|tester2
decl_stmt|;
name|scene2
operator|.
name|addItem
argument_list|(
operator|&
name|tester2
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|//First show one paint
name|QTRY_COMPARE
argument_list|(
name|tester2
operator|.
name|painted
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//nominal case, update call paint
name|tester2
operator|.
name|update
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|tester2
operator|.
name|painted
operator|==
literal|2
argument_list|)
expr_stmt|;
comment|//we remove the item from the scene, number of updates is still the same
name|tester2
operator|.
name|update
argument_list|()
expr_stmt|;
name|scene2
operator|.
name|removeItem
argument_list|(
operator|&
name|tester2
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|tester2
operator|.
name|painted
operator|==
literal|2
argument_list|)
expr_stmt|;
comment|//We re-add the item, the number of paint should increase
name|scene2
operator|.
name|addItem
argument_list|(
operator|&
name|tester2
argument_list|)
expr_stmt|;
name|tester2
operator|.
name|update
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|tester2
operator|.
name|painted
operator|==
literal|3
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|HarakiriItem
class|class
name|HarakiriItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|HarakiriItem
name|HarakiriItem
parameter_list|(
name|int
name|harakiriPoint
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
member_init_list|,
name|harakiri
argument_list|(
name|harakiriPoint
argument_list|)
block|{
name|dead
operator|=
literal|0
expr_stmt|;
block|}
DECL|member|dead
specifier|static
name|int
name|dead
decl_stmt|;
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
name|widget
parameter_list|)
block|{
name|QGraphicsRectItem
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|widget
argument_list|)
expr_stmt|;
if|if
condition|(
name|harakiri
operator|==
literal|0
condition|)
block|{
comment|// delete unsupported since 4.5
comment|/*             dead = 1;             delete this;             */
block|}
block|}
DECL|function|advance
name|void
name|advance
parameter_list|(
name|int
name|n
parameter_list|)
block|{
if|if
condition|(
name|harakiri
operator|==
literal|1
operator|&&
name|n
operator|==
literal|0
condition|)
block|{
comment|// delete unsupported
comment|/*             dead = 1;             delete this;             */
block|}
if|if
condition|(
name|harakiri
operator|==
literal|2
operator|&&
name|n
operator|==
literal|1
condition|)
block|{
name|dead
operator|=
literal|1
expr_stmt|;
operator|delete
name|this
expr_stmt|;
block|}
block|}
protected|protected:
DECL|function|contextMenuEvent
name|void
name|contextMenuEvent
parameter_list|(
name|QGraphicsSceneContextMenuEvent
modifier|*
parameter_list|)
block|{
if|if
condition|(
name|harakiri
operator|==
literal|3
condition|)
block|{
name|dead
operator|=
literal|1
expr_stmt|;
operator|delete
name|this
expr_stmt|;
block|}
block|}
DECL|function|dragEnterEvent
name|void
name|dragEnterEvent
parameter_list|(
name|QGraphicsSceneDragDropEvent
modifier|*
name|event
parameter_list|)
block|{
comment|// ??
name|QGraphicsRectItem
operator|::
name|dragEnterEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
block|}
DECL|function|dragLeaveEvent
name|void
name|dragLeaveEvent
parameter_list|(
name|QGraphicsSceneDragDropEvent
modifier|*
name|event
parameter_list|)
block|{
comment|// ??
name|QGraphicsRectItem
operator|::
name|dragLeaveEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
block|}
DECL|function|dragMoveEvent
name|void
name|dragMoveEvent
parameter_list|(
name|QGraphicsSceneDragDropEvent
modifier|*
name|event
parameter_list|)
block|{
comment|// ??
name|QGraphicsRectItem
operator|::
name|dragMoveEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
block|}
DECL|function|dropEvent
name|void
name|dropEvent
parameter_list|(
name|QGraphicsSceneDragDropEvent
modifier|*
name|event
parameter_list|)
block|{
comment|// ??
name|QGraphicsRectItem
operator|::
name|dropEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
block|}
DECL|function|focusInEvent
name|void
name|focusInEvent
parameter_list|(
name|QFocusEvent
modifier|*
parameter_list|)
block|{
if|if
condition|(
name|harakiri
operator|==
literal|4
condition|)
block|{
name|dead
operator|=
literal|1
expr_stmt|;
operator|delete
name|this
expr_stmt|;
block|}
block|}
DECL|function|focusOutEvent
name|void
name|focusOutEvent
parameter_list|(
name|QFocusEvent
modifier|*
parameter_list|)
block|{
if|if
condition|(
name|harakiri
operator|==
literal|5
condition|)
block|{
name|dead
operator|=
literal|1
expr_stmt|;
operator|delete
name|this
expr_stmt|;
block|}
block|}
DECL|function|hoverEnterEvent
name|void
name|hoverEnterEvent
parameter_list|(
name|QGraphicsSceneHoverEvent
modifier|*
parameter_list|)
block|{
if|if
condition|(
name|harakiri
operator|==
literal|6
condition|)
block|{
name|dead
operator|=
literal|1
expr_stmt|;
operator|delete
name|this
expr_stmt|;
block|}
block|}
DECL|function|hoverLeaveEvent
name|void
name|hoverLeaveEvent
parameter_list|(
name|QGraphicsSceneHoverEvent
modifier|*
parameter_list|)
block|{
if|if
condition|(
name|harakiri
operator|==
literal|7
condition|)
block|{
name|dead
operator|=
literal|1
expr_stmt|;
operator|delete
name|this
expr_stmt|;
block|}
block|}
DECL|function|hoverMoveEvent
name|void
name|hoverMoveEvent
parameter_list|(
name|QGraphicsSceneHoverEvent
modifier|*
parameter_list|)
block|{
if|if
condition|(
name|harakiri
operator|==
literal|8
condition|)
block|{
name|dead
operator|=
literal|1
expr_stmt|;
operator|delete
name|this
expr_stmt|;
block|}
block|}
DECL|function|inputMethodEvent
name|void
name|inputMethodEvent
parameter_list|(
name|QInputMethodEvent
modifier|*
name|event
parameter_list|)
block|{
comment|// ??
name|QGraphicsRectItem
operator|::
name|inputMethodEvent
argument_list|(
name|event
argument_list|)
expr_stmt|;
block|}
DECL|function|inputMethodQuery
name|QVariant
name|inputMethodQuery
parameter_list|(
name|Qt
operator|::
name|InputMethodQuery
name|query
parameter_list|)
specifier|const
block|{
comment|// ??
return|return
name|QGraphicsRectItem
operator|::
name|inputMethodQuery
argument_list|(
name|query
argument_list|)
return|;
block|}
DECL|function|itemChange
name|QVariant
name|itemChange
parameter_list|(
name|GraphicsItemChange
name|change
parameter_list|,
specifier|const
name|QVariant
modifier|&
name|value
parameter_list|)
block|{
comment|// deletion not supported
return|return
name|QGraphicsRectItem
operator|::
name|itemChange
argument_list|(
name|change
argument_list|,
name|value
argument_list|)
return|;
block|}
DECL|function|keyPressEvent
name|void
name|keyPressEvent
parameter_list|(
name|QKeyEvent
modifier|*
parameter_list|)
block|{
if|if
condition|(
name|harakiri
operator|==
literal|9
condition|)
block|{
name|dead
operator|=
literal|1
expr_stmt|;
operator|delete
name|this
expr_stmt|;
block|}
block|}
DECL|function|keyReleaseEvent
name|void
name|keyReleaseEvent
parameter_list|(
name|QKeyEvent
modifier|*
parameter_list|)
block|{
if|if
condition|(
name|harakiri
operator|==
literal|10
condition|)
block|{
name|dead
operator|=
literal|1
expr_stmt|;
operator|delete
name|this
expr_stmt|;
block|}
block|}
DECL|function|mouseDoubleClickEvent
name|void
name|mouseDoubleClickEvent
parameter_list|(
name|QGraphicsSceneMouseEvent
modifier|*
parameter_list|)
block|{
if|if
condition|(
name|harakiri
operator|==
literal|11
condition|)
block|{
name|dead
operator|=
literal|1
expr_stmt|;
operator|delete
name|this
expr_stmt|;
block|}
block|}
DECL|function|mouseMoveEvent
name|void
name|mouseMoveEvent
parameter_list|(
name|QGraphicsSceneMouseEvent
modifier|*
parameter_list|)
block|{
if|if
condition|(
name|harakiri
operator|==
literal|12
condition|)
block|{
name|dead
operator|=
literal|1
expr_stmt|;
operator|delete
name|this
expr_stmt|;
block|}
block|}
DECL|function|mousePressEvent
name|void
name|mousePressEvent
parameter_list|(
name|QGraphicsSceneMouseEvent
modifier|*
parameter_list|)
block|{
if|if
condition|(
name|harakiri
operator|==
literal|13
condition|)
block|{
name|dead
operator|=
literal|1
expr_stmt|;
operator|delete
name|this
expr_stmt|;
block|}
block|}
DECL|function|mouseReleaseEvent
name|void
name|mouseReleaseEvent
parameter_list|(
name|QGraphicsSceneMouseEvent
modifier|*
parameter_list|)
block|{
if|if
condition|(
name|harakiri
operator|==
literal|14
condition|)
block|{
name|dead
operator|=
literal|1
expr_stmt|;
operator|delete
name|this
expr_stmt|;
block|}
block|}
DECL|function|sceneEvent
name|bool
name|sceneEvent
parameter_list|(
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
comment|// deletion not supported
return|return
name|QGraphicsRectItem
operator|::
name|sceneEvent
argument_list|(
name|event
argument_list|)
return|;
block|}
DECL|function|sceneEventFilter
name|bool
name|sceneEventFilter
parameter_list|(
name|QGraphicsItem
modifier|*
name|watched
parameter_list|,
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
comment|// deletion not supported
return|return
name|QGraphicsRectItem
operator|::
name|sceneEventFilter
argument_list|(
name|watched
argument_list|,
name|event
argument_list|)
return|;
block|}
DECL|function|wheelEvent
name|void
name|wheelEvent
parameter_list|(
name|QGraphicsSceneWheelEvent
modifier|*
parameter_list|)
block|{
if|if
condition|(
name|harakiri
operator|==
literal|16
condition|)
block|{
name|dead
operator|=
literal|1
expr_stmt|;
operator|delete
name|this
expr_stmt|;
block|}
block|}
private|private:
DECL|member|harakiri
name|int
name|harakiri
decl_stmt|;
block|}
class|;
end_class
begin_decl_stmt
DECL|member|dead
name|int
name|HarakiriItem
operator|::
name|dead
decl_stmt|;
end_decl_stmt
begin_function
DECL|function|deleteItemInEventHandlers
name|void
name|tst_QGraphicsItem
operator|::
name|deleteItemInEventHandlers
parameter_list|()
block|{
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|17
condition|;
operator|++
name|i
control|)
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|HarakiriItem
modifier|*
name|item
init|=
operator|new
name|HarakiriItem
argument_list|(
name|i
argument_list|)
decl_stmt|;
name|item
operator|->
name|setAcceptsHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|item
operator|->
name|installSceneEventFilter
argument_list|(
name|item
argument_list|)
expr_stmt|;
comment|//<- ehey!
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|item
operator|->
name|dead
condition|)
name|scene
operator|.
name|advance
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|item
operator|->
name|dead
condition|)
block|{
name|QContextMenuEvent
name|event
argument_list|(
name|QContextMenuEvent
operator|::
name|Other
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|QCoreApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|item
operator|->
name|dead
condition|)
name|QTest
operator|::
name|mouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|item
operator|->
name|dead
condition|)
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|item
operator|->
name|dead
condition|)
name|QTest
operator|::
name|mouseDClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|item
operator|->
name|dead
condition|)
name|QTest
operator|::
name|mouseClick
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|RightButton
argument_list|,
literal|0
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|item
operator|->
name|dead
condition|)
name|QTest
operator|::
name|mouseMove
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|view
operator|.
name|mapFromScene
argument_list|(
name|item
operator|->
name|scenePos
argument_list|()
operator|+
name|QPointF
argument_list|(
literal|20
argument_list|,
operator|-
literal|20
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|item
operator|->
name|dead
condition|)
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|item
operator|->
name|dead
condition|)
name|item
operator|->
name|clearFocus
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|item
operator|->
name|dead
condition|)
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|item
operator|->
name|dead
condition|)
name|QTest
operator|::
name|keyPress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_A
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|item
operator|->
name|dead
condition|)
name|QTest
operator|::
name|keyRelease
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_A
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|item
operator|->
name|dead
condition|)
name|QTest
operator|::
name|keyPress
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_A
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|item
operator|->
name|dead
condition|)
name|QTest
operator|::
name|keyRelease
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_A
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_class
DECL|class|ItemPaintsOutsideShape
class|class
name|ItemPaintsOutsideShape
super|:
specifier|public
name|QGraphicsItem
block|{
public|public:
DECL|function|boundingRect
name|QRectF
name|boundingRect
parameter_list|()
specifier|const
block|{
return|return
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
return|;
block|}
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
name|painter
operator|->
name|fillRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|,
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|painter
operator|->
name|fillRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|,
name|Qt
operator|::
name|blue
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|itemClipsToShape
name|void
name|tst_QGraphicsItem
operator|::
name|itemClipsToShape
parameter_list|()
block|{
name|QGraphicsItem
modifier|*
name|clippedItem
init|=
operator|new
name|ItemPaintsOutsideShape
decl_stmt|;
name|clippedItem
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsToShape
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|unclippedItem
init|=
operator|new
name|ItemPaintsOutsideShape
decl_stmt|;
name|unclippedItem
operator|->
name|setPos
argument_list|(
literal|200
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|400
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|clippedItem
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|unclippedItem
argument_list|)
expr_stmt|;
name|QImage
name|image
argument_list|(
literal|400
argument_list|,
literal|200
argument_list|,
name|QImage
operator|::
name|Format_ARGB32_Premultiplied
argument_list|)
decl_stmt|;
name|image
operator|.
name|fill
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QPainter
name|painter
argument_list|(
operator|&
name|image
argument_list|)
decl_stmt|;
name|painter
operator|.
name|setRenderHint
argument_list|(
name|QPainter
operator|::
name|Antialiasing
argument_list|)
expr_stmt|;
name|scene
operator|.
name|render
argument_list|(
operator|&
name|painter
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|45
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QRgb
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|100
argument_list|,
literal|45
argument_list|)
argument_list|,
name|QRgb
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|155
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QRgb
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|45
argument_list|,
literal|155
argument_list|)
argument_list|,
name|QRgb
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|55
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QColor
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|100
argument_list|,
literal|55
argument_list|)
argument_list|,
name|QColor
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|145
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QColor
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|55
argument_list|,
literal|145
argument_list|)
argument_list|,
name|QColor
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|245
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QColor
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|300
argument_list|,
literal|45
argument_list|)
argument_list|,
name|QColor
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|355
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QColor
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|245
argument_list|,
literal|155
argument_list|)
argument_list|,
name|QColor
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|255
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QColor
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|300
argument_list|,
literal|55
argument_list|)
argument_list|,
name|QColor
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|345
argument_list|,
literal|100
argument_list|)
argument_list|,
name|QColor
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|255
argument_list|,
literal|145
argument_list|)
argument_list|,
name|QColor
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemClipsChildrenToShape
name|void
name|tst_QGraphicsItem
operator|::
name|itemClipsChildrenToShape
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|rect
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|NoPen
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|yellow
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|ellipse
init|=
name|scene
operator|.
name|addEllipse
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|NoPen
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
argument_list|)
decl_stmt|;
name|ellipse
operator|->
name|setParentItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|clippedEllipse
init|=
name|scene
operator|.
name|addEllipse
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|NoPen
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
decl_stmt|;
name|clippedEllipse
operator|->
name|setParentItem
argument_list|(
name|ellipse
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|clippedEllipse2
init|=
name|scene
operator|.
name|addEllipse
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|NoPen
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
argument_list|)
decl_stmt|;
name|clippedEllipse2
operator|->
name|setParentItem
argument_list|(
name|clippedEllipse
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|clippedEllipse3
init|=
name|scene
operator|.
name|addEllipse
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|NoPen
argument_list|)
argument_list|,
name|QBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
argument_list|)
decl_stmt|;
name|clippedEllipse3
operator|->
name|setParentItem
argument_list|(
name|clippedEllipse
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
operator|(
name|ellipse
operator|->
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
operator|)
argument_list|)
expr_stmt|;
name|ellipse
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|(
name|ellipse
operator|->
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
operator|)
argument_list|)
expr_stmt|;
name|QImage
name|image
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|,
name|QImage
operator|::
name|Format_ARGB32_Premultiplied
argument_list|)
decl_stmt|;
name|image
operator|.
name|fill
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QPainter
name|painter
argument_list|(
operator|&
name|image
argument_list|)
decl_stmt|;
name|painter
operator|.
name|setRenderHint
argument_list|(
name|QPainter
operator|::
name|Antialiasing
argument_list|)
expr_stmt|;
name|scene
operator|.
name|render
argument_list|(
operator|&
name|painter
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|16
argument_list|,
literal|16
argument_list|)
argument_list|,
name|QColor
argument_list|(
literal|255
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|32
argument_list|,
literal|32
argument_list|)
argument_list|,
name|QColor
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|QColor
argument_list|(
literal|0
argument_list|,
literal|255
argument_list|,
literal|0
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|12
argument_list|,
literal|12
argument_list|)
argument_list|,
name|QColor
argument_list|(
literal|255
argument_list|,
literal|255
argument_list|,
literal|0
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|60
argument_list|,
literal|60
argument_list|)
argument_list|,
name|QColor
argument_list|(
literal|255
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemClipsChildrenToShape2
name|void
name|tst_QGraphicsItem
operator|::
name|itemClipsChildrenToShape2
parameter_list|()
block|{
name|QGraphicsRectItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsEllipseItem
modifier|*
name|child1
init|=
operator|new
name|QGraphicsEllipseItem
argument_list|(
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|child2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|15
argument_list|,
literal|15
argument_list|,
literal|80
argument_list|,
literal|80
argument_list|)
argument_list|)
decl_stmt|;
name|child1
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|child1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|child2
operator|->
name|setParentItem
argument_list|(
name|child1
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
expr_stmt|;
name|child1
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
expr_stmt|;
name|child2
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|15
argument_list|,
literal|5
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|5
argument_list|,
literal|15
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|60
argument_list|,
literal|60
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|140
argument_list|,
literal|60
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|60
argument_list|,
literal|140
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|140
argument_list|,
literal|140
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|75
argument_list|,
literal|75
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|child2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|75
argument_list|,
literal|100
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|child1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|100
argument_list|,
literal|75
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|child1
argument_list|)
expr_stmt|;
name|QImage
name|image
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|,
name|QImage
operator|::
name|Format_ARGB32_Premultiplied
argument_list|)
decl_stmt|;
name|image
operator|.
name|fill
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QPainter
name|painter
argument_list|(
operator|&
name|image
argument_list|)
decl_stmt|;
name|scene
operator|.
name|render
argument_list|(
operator|&
name|painter
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
name|QColor
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|5
argument_list|,
literal|10
argument_list|)
argument_list|,
name|QRgb
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|10
argument_list|,
literal|5
argument_list|)
argument_list|,
name|QRgb
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|)
argument_list|,
name|QRgb
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|90
argument_list|,
literal|40
argument_list|)
argument_list|,
name|QRgb
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|40
argument_list|,
literal|90
argument_list|)
argument_list|,
name|QRgb
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|95
argument_list|,
literal|95
argument_list|)
argument_list|,
name|QRgb
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|50
argument_list|,
literal|70
argument_list|)
argument_list|,
name|QColor
argument_list|(
literal|0
argument_list|,
literal|255
argument_list|,
literal|0
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|70
argument_list|,
literal|50
argument_list|)
argument_list|,
name|QColor
argument_list|(
literal|0
argument_list|,
literal|255
argument_list|,
literal|0
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|50
argument_list|,
literal|60
argument_list|)
argument_list|,
name|QColor
argument_list|(
literal|255
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|60
argument_list|,
literal|50
argument_list|)
argument_list|,
name|QColor
argument_list|(
literal|255
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
operator|.
name|rgba
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemClipsChildrenToShape3
name|void
name|tst_QGraphicsItem
operator|::
name|itemClipsChildrenToShape3
parameter_list|()
block|{
comment|// Construct a scene with nested children, each 50 pixels offset from the elder.
comment|// Set a top-level clipping flag
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|parent
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|150
argument_list|,
literal|150
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|child
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|150
argument_list|,
literal|150
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|grandchild
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|150
argument_list|,
literal|150
argument_list|)
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|grandchild
operator|->
name|setParentItem
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|child
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|grandchild
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|75
argument_list|,
literal|75
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|child
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|125
argument_list|,
literal|125
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|grandchild
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|175
argument_list|,
literal|175
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// Move child to fully overlap the parent.  The grandchild should
comment|// now occupy two-thirds of the scene
name|child
operator|->
name|prepareGeometryChange
argument_list|()
expr_stmt|;
name|child
operator|->
name|setPos
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|child
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|75
argument_list|,
literal|75
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|grandchild
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|125
argument_list|,
literal|125
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|grandchild
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|175
argument_list|,
literal|175
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|MyProxyWidget
class|class
name|MyProxyWidget
super|:
specifier|public
name|QGraphicsProxyWidget
block|{
public|public:
DECL|function|MyProxyWidget
name|MyProxyWidget
parameter_list|(
name|QGraphicsItem
modifier|*
name|parent
parameter_list|)
member_init_list|:
name|QGraphicsProxyWidget
argument_list|(
name|parent
argument_list|)
block|{
name|painted
operator|=
literal|false
expr_stmt|;
block|}
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
name|widget
parameter_list|)
block|{
name|QGraphicsProxyWidget
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|widget
argument_list|)
expr_stmt|;
name|painted
operator|=
literal|true
expr_stmt|;
block|}
DECL|member|painted
name|bool
name|painted
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|itemClipsChildrenToShape4
name|void
name|tst_QGraphicsItem
operator|::
name|itemClipsChildrenToShape4
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|outerWidget
init|=
operator|new
name|QGraphicsWidget
argument_list|()
decl_stmt|;
name|outerWidget
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|MyProxyWidget
modifier|*
name|innerWidget
init|=
operator|new
name|MyProxyWidget
argument_list|(
name|outerWidget
argument_list|)
decl_stmt|;
name|QLabel
modifier|*
name|label
init|=
operator|new
name|QLabel
argument_list|()
decl_stmt|;
name|label
operator|->
name|setText
argument_list|(
literal|"Welcome back my friends to the show that never ends..."
argument_list|)
expr_stmt|;
name|innerWidget
operator|->
name|setWidget
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|300
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|outerWidget
argument_list|)
expr_stmt|;
name|outerWidget
operator|->
name|resize
argument_list|(
literal|200
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addEllipse
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|,
literal|50
argument_list|)
expr_stmt|;
comment|//<-- this is important to trigger the right codepath*
comment|//now the label is shown
name|outerWidget
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
operator|(
name|QWidget
operator|*
operator|)
operator|&
name|view
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|innerWidget
operator|->
name|painted
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|//#define DEBUG_ITEM_CLIPS_CHILDREN_TO_SHAPE_5
end_comment
begin_function
DECL|function|renderSceneToImage
specifier|static
specifier|inline
name|void
name|renderSceneToImage
parameter_list|(
name|QGraphicsScene
modifier|*
name|scene
parameter_list|,
name|QImage
modifier|*
name|image
parameter_list|,
specifier|const
name|QString
modifier|&
name|filename
parameter_list|)
block|{
name|image
operator|->
name|fill
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QPainter
name|painter
argument_list|(
name|image
argument_list|)
decl_stmt|;
name|scene
operator|->
name|render
argument_list|(
operator|&
name|painter
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
ifdef|#
directive|ifdef
name|DEBUG_ITEM_CLIPS_CHILDREN_TO_SHAPE_5
name|image
operator|->
name|save
argument_list|(
name|filename
argument_list|)
expr_stmt|;
else|#
directive|else
name|Q_UNUSED
argument_list|(
name|filename
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function
begin_function
DECL|function|itemClipsChildrenToShape5
name|void
name|tst_QGraphicsItem
operator|::
name|itemClipsChildrenToShape5
parameter_list|()
block|{
class|class
name|ParentItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
name|ParentItem
parameter_list|(
name|qreal
name|x
parameter_list|,
name|qreal
name|y
parameter_list|,
name|qreal
name|width
parameter_list|,
name|qreal
name|height
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|x
argument_list|,
name|y
argument_list|,
name|width
argument_list|,
name|height
argument_list|)
block|{}
name|QPainterPath
name|shape
parameter_list|()
specifier|const
block|{
name|QPainterPath
name|path
decl_stmt|;
name|path
operator|.
name|addRect
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
return|return
name|path
return|;
block|}
block|}
class|;
name|ParentItem
modifier|*
name|parent
init|=
operator|new
name|ParentItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|300
argument_list|)
decl_stmt|;
name|parent
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setOpacity
argument_list|(
literal|0.5
argument_list|)
expr_stmt|;
specifier|const
name|QRegion
name|parentRegion
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|300
argument_list|)
decl_stmt|;
specifier|const
name|QRegion
name|clippedParentRegion
init|=
name|parentRegion
operator|&
name|QRect
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|QRegion
name|childRegion
decl_stmt|;
name|QRegion
name|grandChildRegion
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|topLeftChild
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|topLeftChild
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|topLeftChild
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|childRegion
operator|+=
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|topRightChild
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|topRightChild
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|topRightChild
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|topRightChild
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|topRightChild
operator|->
name|setPos
argument_list|(
literal|200
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|childRegion
operator|+=
name|QRect
argument_list|(
literal|200
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|topRightGrandChild
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|topRightGrandChild
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
expr_stmt|;
name|topRightGrandChild
operator|->
name|setParentItem
argument_list|(
name|topRightChild
argument_list|)
expr_stmt|;
name|topRightGrandChild
operator|->
name|setPos
argument_list|(
operator|-
literal|40
argument_list|,
literal|40
argument_list|)
expr_stmt|;
name|grandChildRegion
operator|+=
name|QRect
argument_list|(
literal|200
operator|-
literal|40
argument_list|,
literal|0
operator|+
literal|40
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|&
name|QRect
argument_list|(
literal|200
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|bottomLeftChild
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|bottomLeftChild
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|bottomLeftChild
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|bottomLeftChild
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsToShape
argument_list|)
expr_stmt|;
name|bottomLeftChild
operator|->
name|setPos
argument_list|(
literal|0
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|childRegion
operator|+=
name|QRect
argument_list|(
literal|0
argument_list|,
literal|200
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|bottomLeftGrandChild
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|160
argument_list|,
literal|160
argument_list|)
decl_stmt|;
name|bottomLeftGrandChild
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
expr_stmt|;
name|bottomLeftGrandChild
operator|->
name|setParentItem
argument_list|(
name|bottomLeftChild
argument_list|)
expr_stmt|;
name|bottomLeftGrandChild
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsToShape
argument_list|)
expr_stmt|;
name|bottomLeftGrandChild
operator|->
name|setPos
argument_list|(
literal|0
argument_list|,
operator|-
literal|60
argument_list|)
expr_stmt|;
name|grandChildRegion
operator|+=
name|QRect
argument_list|(
literal|0
argument_list|,
literal|200
operator|-
literal|60
argument_list|,
literal|160
argument_list|,
literal|160
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|bottomRightChild
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|bottomRightChild
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|bottomRightChild
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|bottomRightChild
operator|->
name|setPos
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|childRegion
operator|+=
name|QRect
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QPoint
name|controlPoints
index|[
literal|17
index|]
init|=
block|{
name|QPoint
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
block|,
name|QPoint
argument_list|(
literal|95
argument_list|,
literal|5
argument_list|)
block|,
name|QPoint
argument_list|(
literal|205
argument_list|,
literal|5
argument_list|)
block|,
name|QPoint
argument_list|(
literal|295
argument_list|,
literal|5
argument_list|)
block|,
name|QPoint
argument_list|(
literal|5
argument_list|,
literal|95
argument_list|)
block|,
name|QPoint
argument_list|(
literal|95
argument_list|,
literal|95
argument_list|)
block|,
name|QPoint
argument_list|(
literal|205
argument_list|,
literal|95
argument_list|)
block|,
name|QPoint
argument_list|(
literal|295
argument_list|,
literal|95
argument_list|)
block|,
name|QPoint
argument_list|(
literal|150
argument_list|,
literal|150
argument_list|)
block|,
name|QPoint
argument_list|(
literal|5
argument_list|,
literal|205
argument_list|)
block|,
name|QPoint
argument_list|(
literal|95
argument_list|,
literal|205
argument_list|)
block|,
name|QPoint
argument_list|(
literal|205
argument_list|,
literal|205
argument_list|)
block|,
name|QPoint
argument_list|(
literal|295
argument_list|,
literal|205
argument_list|)
block|,
name|QPoint
argument_list|(
literal|5
argument_list|,
literal|295
argument_list|)
block|,
name|QPoint
argument_list|(
literal|95
argument_list|,
literal|295
argument_list|)
block|,
name|QPoint
argument_list|(
literal|205
argument_list|,
literal|295
argument_list|)
block|,
name|QPoint
argument_list|(
literal|295
argument_list|,
literal|295
argument_list|)
block|,     }
decl_stmt|;
specifier|const
name|QRegion
name|clippedChildRegion
init|=
name|childRegion
operator|&
name|QRect
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
specifier|const
name|QRegion
name|clippedGrandChildRegion
init|=
name|grandChildRegion
operator|&
name|QRect
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QImage
name|sceneImage
argument_list|(
literal|300
argument_list|,
literal|300
argument_list|,
name|QImage
operator|::
name|Format_ARGB32
argument_list|)
decl_stmt|;
DECL|macro|VERIFY_CONTROL_POINTS
define|#
directive|define
name|VERIFY_CONTROL_POINTS
parameter_list|(
name|pRegion
parameter_list|,
name|cRegion
parameter_list|,
name|gRegion
parameter_list|)
define|\
value|for (int i = 0; i< 17; ++i) { \         QPoint controlPoint = controlPoints[i]; \         QRgb pixel = sceneImage.pixel(controlPoint.x(), controlPoint.y()); \         if (pRegion.contains(controlPoint)) \             QVERIFY(qBlue(pixel) != 0); \         else \             QVERIFY(qBlue(pixel) == 0); \         if (cRegion.contains(controlPoint)) \             QVERIFY(qRed(pixel) != 0); \         else \             QVERIFY(qRed(pixel) == 0); \         if (gRegion.contains(controlPoint)) \             QVERIFY(qGreen(pixel) != 0); \         else \             QVERIFY(qGreen(pixel) == 0); \     }
specifier|const
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|children
init|=
name|parent
operator|->
name|childItems
argument_list|()
decl_stmt|;
specifier|const
name|int
name|childrenCount
init|=
name|children
operator|.
name|count
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|5
condition|;
operator|++
name|i
control|)
block|{
name|QString
name|clipString
decl_stmt|;
name|QString
name|childString
decl_stmt|;
switch|switch
condition|(
name|i
condition|)
block|{
case|case
literal|0
case|:
comment|// All children stacked in front.
name|childString
operator|=
name|QLatin1String
argument_list|(
literal|"ChildrenInFront.png"
argument_list|)
expr_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|child
decl|,
name|children
control|)
name|child
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemStacksBehindParent
argument_list|,
literal|false
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
comment|// All children stacked behind.
name|childString
operator|=
name|QLatin1String
argument_list|(
literal|"ChildrenBehind.png"
argument_list|)
expr_stmt|;
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|child
decl|,
name|children
control|)
name|child
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemStacksBehindParent
argument_list|,
literal|true
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
comment|// First half of the children behind, second half in front.
name|childString
operator|=
name|QLatin1String
argument_list|(
literal|"FirstHalfBehind_SecondHalfInFront.png"
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|childrenCount
condition|;
operator|++
name|j
control|)
block|{
name|QGraphicsItem
modifier|*
name|child
init|=
name|children
operator|.
name|at
argument_list|(
name|j
argument_list|)
decl_stmt|;
name|child
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemStacksBehindParent
argument_list|,
operator|(
name|j
operator|<
name|childrenCount
operator|/
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|3
case|:
comment|// First half of the children in front, second half behind.
name|childString
operator|=
name|QLatin1String
argument_list|(
literal|"FirstHalfInFront_SecondHalfBehind.png"
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|childrenCount
condition|;
operator|++
name|j
control|)
block|{
name|QGraphicsItem
modifier|*
name|child
init|=
name|children
operator|.
name|at
argument_list|(
name|j
argument_list|)
decl_stmt|;
name|child
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemStacksBehindParent
argument_list|,
operator|(
name|j
operator|>=
name|childrenCount
operator|/
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|4
case|:
comment|// Child2 and child4 behind, rest in front.
name|childString
operator|=
name|QLatin1String
argument_list|(
literal|"Child2And4Behind_RestInFront.png"
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|j
init|=
literal|0
init|;
name|j
operator|<
name|childrenCount
condition|;
operator|++
name|j
control|)
block|{
name|QGraphicsItem
modifier|*
name|child
init|=
name|children
operator|.
name|at
argument_list|(
name|j
argument_list|)
decl_stmt|;
if|if
condition|(
name|j
operator|==
literal|1
operator|||
name|j
operator|==
literal|3
condition|)
name|child
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemStacksBehindParent
argument_list|,
literal|true
argument_list|)
expr_stmt|;
else|else
name|child
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemStacksBehindParent
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
name|qFatal
argument_list|(
literal|"internal error"
argument_list|)
expr_stmt|;
block|}
comment|// Nothing is clipped.
name|parent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsToShape
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|clipString
operator|=
name|QLatin1String
argument_list|(
literal|"nothingClipped_"
argument_list|)
expr_stmt|;
name|renderSceneToImage
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|sceneImage
argument_list|,
name|clipString
operator|+
name|childString
argument_list|)
expr_stmt|;
name|VERIFY_CONTROL_POINTS
argument_list|(
name|parentRegion
argument_list|,
name|childRegion
argument_list|,
name|grandChildRegion
argument_list|)
expr_stmt|;
comment|// Parent clips children to shape.
name|parent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|clipString
operator|=
name|QLatin1String
argument_list|(
literal|"parentClipsChildrenToShape_"
argument_list|)
expr_stmt|;
name|renderSceneToImage
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|sceneImage
argument_list|,
name|clipString
operator|+
name|childString
argument_list|)
expr_stmt|;
name|VERIFY_CONTROL_POINTS
argument_list|(
name|parentRegion
argument_list|,
name|clippedChildRegion
argument_list|,
name|clippedGrandChildRegion
argument_list|)
expr_stmt|;
comment|// Parent clips itself and children to shape.
name|parent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsToShape
argument_list|)
expr_stmt|;
name|clipString
operator|=
name|QLatin1String
argument_list|(
literal|"parentClipsItselfAndChildrenToShape_"
argument_list|)
expr_stmt|;
name|renderSceneToImage
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|sceneImage
argument_list|,
name|clipString
operator|+
name|childString
argument_list|)
expr_stmt|;
name|VERIFY_CONTROL_POINTS
argument_list|(
name|clippedParentRegion
argument_list|,
name|clippedChildRegion
argument_list|,
name|clippedGrandChildRegion
argument_list|)
expr_stmt|;
comment|// Parent clips itself to shape.
name|parent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|clipString
operator|=
name|QLatin1String
argument_list|(
literal|"parentClipsItselfToShape_"
argument_list|)
expr_stmt|;
name|renderSceneToImage
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|sceneImage
argument_list|,
name|clipString
operator|+
name|childString
argument_list|)
expr_stmt|;
name|VERIFY_CONTROL_POINTS
argument_list|(
name|clippedParentRegion
argument_list|,
name|childRegion
argument_list|,
name|grandChildRegion
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|itemClipsTextChildToShape
name|void
name|tst_QGraphicsItem
operator|::
name|itemClipsTextChildToShape
parameter_list|()
block|{
comment|// Construct a scene with a rect that clips its children, with one text
comment|// child that has text that exceeds the size of the rect.
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|rect
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|,
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
argument_list|,
name|Qt
operator|::
name|black
argument_list|)
decl_stmt|;
name|rect
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|QGraphicsTextItem
modifier|*
name|text
init|=
operator|new
name|QGraphicsTextItem
argument_list|(
literal|"This is a long sentence that's wider than 50 pixels."
argument_list|)
decl_stmt|;
name|text
operator|->
name|setParentItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
comment|// Render this scene to a transparent image.
name|QRectF
name|sr
init|=
name|scene
operator|.
name|itemsBoundingRect
argument_list|()
decl_stmt|;
name|QImage
name|image
argument_list|(
name|sr
operator|.
name|size
argument_list|()
operator|.
name|toSize
argument_list|()
argument_list|,
name|QImage
operator|::
name|Format_ARGB32_Premultiplied
argument_list|)
decl_stmt|;
name|image
operator|.
name|fill
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QPainter
name|painter
argument_list|(
operator|&
name|image
argument_list|)
decl_stmt|;
name|scene
operator|.
name|render
argument_list|(
operator|&
name|painter
argument_list|)
expr_stmt|;
comment|// Erase the area immediately underneath the rect.
name|painter
operator|.
name|setCompositionMode
argument_list|(
name|QPainter
operator|::
name|CompositionMode_Source
argument_list|)
expr_stmt|;
name|painter
operator|.
name|fillRect
argument_list|(
name|rect
operator|->
name|sceneBoundingRect
argument_list|()
operator|.
name|translated
argument_list|(
operator|-
name|sr
operator|.
name|topLeft
argument_list|()
argument_list|)
operator|.
name|adjusted
argument_list|(
operator|-
literal|0.5
argument_list|,
operator|-
literal|0.5
argument_list|,
literal|0.5
argument_list|,
literal|0.5
argument_list|)
argument_list|,
name|Qt
operator|::
name|transparent
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
comment|// Check that you get a truly transparent image back (i.e., the text was
comment|// clipped away, so there should be no trails left after erasing only the
comment|// rect's area).
name|QImage
name|emptyImage
argument_list|(
name|scene
operator|.
name|itemsBoundingRect
argument_list|()
operator|.
name|size
argument_list|()
operator|.
name|toSize
argument_list|()
argument_list|,
name|QImage
operator|::
name|Format_ARGB32_Premultiplied
argument_list|)
decl_stmt|;
name|emptyImage
operator|.
name|fill
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
argument_list|,
name|emptyImage
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemClippingDiscovery
name|void
name|tst_QGraphicsItem
operator|::
name|itemClippingDiscovery
parameter_list|()
block|{
comment|// A simple scene with an ellipse parent and two rect children, one a
comment|// child of the other.
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsEllipseItem
modifier|*
name|clipItem
init|=
name|scene
operator|.
name|addEllipse
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|leftRectItem
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rightRectItem
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|50
argument_list|,
literal|0
argument_list|,
literal|50
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|leftRectItem
operator|->
name|setParentItem
argument_list|(
name|clipItem
argument_list|)
expr_stmt|;
name|rightRectItem
operator|->
name|setParentItem
argument_list|(
name|clipItem
argument_list|)
expr_stmt|;
comment|// The rects item are both visible at these points.
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|leftRectItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|90
argument_list|,
literal|90
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rightRectItem
argument_list|)
expr_stmt|;
comment|// The ellipse clips the rects now.
name|clipItem
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
comment|// The rect items are no longer visible at these points.
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
sizeof|sizeof
argument_list|(
name|qreal
argument_list|)
operator|!=
sizeof|sizeof
argument_list|(
name|double
argument_list|)
condition|)
name|QSKIP
argument_list|(
literal|"This fails due to internal rounding errors"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|itemAt
argument_list|(
literal|90
argument_list|,
literal|90
argument_list|)
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|ancestorFlags
name|void
name|tst_QGraphicsItem
operator|::
name|ancestorFlags
parameter_list|()
block|{
name|QGraphicsItem
modifier|*
name|level1
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|level21
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|level21
operator|->
name|setParentItem
argument_list|(
name|level1
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|level22
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|level22
operator|->
name|setParentItem
argument_list|(
name|level1
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|level31
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|level31
operator|->
name|setParentItem
argument_list|(
name|level21
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|level32
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|level32
operator|->
name|setParentItem
argument_list|(
name|level21
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// HandlesChildEvents: 1) Root level sets a flag
name|level1
operator|->
name|setHandlesChildEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// HandlesChildEvents: 2) Root level set it again
name|level1
operator|->
name|setHandlesChildEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// HandlesChildEvents: 3) Root level unsets a flag
name|level1
operator|->
name|setHandlesChildEvents
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// HandlesChildEvents: 4) Child item sets a flag
name|level21
operator|->
name|setHandlesChildEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// HandlesChildEvents: 5) Parent item sets a flag
name|level1
operator|->
name|setHandlesChildEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// HandlesChildEvents: 6) Child item unsets a flag
name|level21
operator|->
name|setHandlesChildEvents
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// HandlesChildEvents: 7) Parent item unsets a flag
name|level21
operator|->
name|setHandlesChildEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|level1
operator|->
name|setHandlesChildEvents
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Reparent the child to root
name|level21
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Reparent the child to level1 again.
name|level1
operator|->
name|setHandlesChildEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|level21
operator|->
name|setParentItem
argument_list|(
name|level1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Reparenting level31 back to level1.
name|level31
operator|->
name|setParentItem
argument_list|(
name|level1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Reparenting level31 back to level21.
name|level31
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|level31
operator|->
name|setParentItem
argument_list|(
name|level21
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Level1 doesn't handle child events
name|level1
operator|->
name|setHandlesChildEvents
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Nobody handles child events
name|level21
operator|->
name|setHandlesChildEvents
argument_list|(
literal|false
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
operator|++
name|i
control|)
block|{
name|QGraphicsItem
operator|::
name|GraphicsItemFlag
name|flag
init|=
operator|!
name|i
condition|?
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
else|:
name|QGraphicsItem
operator|::
name|ItemIgnoresTransformations
decl_stmt|;
name|int
name|ancestorFlag
init|=
operator|!
name|i
condition|?
name|QGraphicsItemPrivate
operator|::
name|AncestorClipsChildren
else|:
name|QGraphicsItemPrivate
operator|::
name|AncestorIgnoresTransformations
decl_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// HandlesChildEvents: 1) Root level sets a flag
name|level1
operator|->
name|setFlag
argument_list|(
name|flag
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
comment|// HandlesChildEvents: 2) Root level set it again
name|level1
operator|->
name|setFlag
argument_list|(
name|flag
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
comment|// HandlesChildEvents: 3) Root level unsets a flag
name|level1
operator|->
name|setFlag
argument_list|(
name|flag
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// HandlesChildEvents: 4) Child item sets a flag
name|level21
operator|->
name|setFlag
argument_list|(
name|flag
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
comment|// HandlesChildEvents: 5) Parent item sets a flag
name|level1
operator|->
name|setFlag
argument_list|(
name|flag
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
comment|// HandlesChildEvents: 6) Child item unsets a flag
name|level21
operator|->
name|setFlag
argument_list|(
name|flag
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
comment|// HandlesChildEvents: 7) Parent item unsets a flag
name|level21
operator|->
name|setFlag
argument_list|(
name|flag
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|level1
operator|->
name|setFlag
argument_list|(
name|flag
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
comment|// Reparent the child to root
name|level21
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
comment|// Reparent the child to level1 again.
name|level1
operator|->
name|setFlag
argument_list|(
name|flag
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|level21
operator|->
name|setParentItem
argument_list|(
name|level1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
comment|// Reparenting level31 back to level1.
name|level31
operator|->
name|setParentItem
argument_list|(
name|level1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
comment|// Reparenting level31 back to level21.
name|level31
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|level31
operator|->
name|setParentItem
argument_list|(
name|level21
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
comment|// Level1 doesn't handle child events
name|level1
operator|->
name|setFlag
argument_list|(
name|flag
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
name|ancestorFlag
argument_list|)
expr_stmt|;
comment|// Nobody handles child events
name|level21
operator|->
name|setFlag
argument_list|(
name|flag
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level1
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level21
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level22
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level31
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|level32
operator|->
name|d_ptr
operator|->
name|ancestorFlags
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
operator|delete
name|level1
expr_stmt|;
block|}
end_function
begin_function
DECL|function|untransformable
name|void
name|tst_QGraphicsItem
operator|::
name|untransformable
parameter_list|()
block|{
name|QGraphicsItem
modifier|*
name|item1
init|=
operator|new
name|QGraphicsEllipseItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIgnoresTransformations
argument_list|)
expr_stmt|;
name|item1
operator|->
name|rotate
argument_list|(
literal|45
argument_list|)
expr_stmt|;
operator|(
operator|(
name|QGraphicsEllipseItem
operator|*
operator|)
name|item1
operator|)
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item2
init|=
operator|new
name|QGraphicsEllipseItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|item2
operator|->
name|setParentItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|item2
operator|->
name|rotate
argument_list|(
literal|45
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
operator|(
name|QGraphicsEllipseItem
operator|*
operator|)
name|item2
operator|)
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item3
init|=
operator|new
name|QGraphicsEllipseItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|item3
operator|->
name|setParentItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|item3
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|0
argument_list|)
expr_stmt|;
operator|(
operator|(
name|QGraphicsEllipseItem
operator|*
operator|)
name|item3
operator|)
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|500
argument_list|,
operator|-
literal|500
argument_list|,
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|QWidget
name|topLevel
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|topLevel
argument_list|)
decl_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|300
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|topLevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|view
operator|.
name|scale
argument_list|(
literal|8
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|view
operator|.
name|centerOn
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Painting with the DiagCrossPattern is really slow on Mac
comment|// when zoomed out. (The test times out). Task to fix is 155567.
if|#
directive|if
operator|!
name|defined
argument_list|(
name|Q_OS_MAC
argument_list|)
operator|||
literal|1
name|view
operator|.
name|setBackgroundBrush
argument_list|(
name|QBrush
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
name|Qt
operator|::
name|DiagCrossPattern
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|topLevel
argument_list|)
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|10
condition|;
operator|++
name|i
control|)
block|{
name|QPoint
name|center
init|=
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|rect
argument_list|()
operator|.
name|center
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|center
argument_list|)
argument_list|,
name|item1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|center
operator|-
name|QPoint
argument_list|(
literal|40
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|center
operator|-
name|QPoint
argument_list|(
operator|-
literal|40
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|center
operator|-
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|40
argument_list|)
argument_list|)
argument_list|,
name|item1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|center
operator|-
name|QPoint
argument_list|(
literal|0
argument_list|,
operator|-
literal|40
argument_list|)
argument_list|)
argument_list|,
name|item1
argument_list|)
expr_stmt|;
name|center
operator|+=
name|QPoint
argument_list|(
literal|70
argument_list|,
literal|70
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|center
operator|-
name|QPoint
argument_list|(
literal|40
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|center
operator|-
name|QPoint
argument_list|(
operator|-
literal|40
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|center
operator|-
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|40
argument_list|)
argument_list|)
argument_list|,
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|center
operator|-
name|QPoint
argument_list|(
literal|0
argument_list|,
operator|-
literal|40
argument_list|)
argument_list|)
argument_list|,
name|item2
argument_list|)
expr_stmt|;
name|center
operator|+=
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|center
operator|-
name|QPoint
argument_list|(
literal|40
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|center
operator|-
name|QPoint
argument_list|(
operator|-
literal|40
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|,
name|item3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|center
operator|-
name|QPoint
argument_list|(
literal|0
argument_list|,
literal|40
argument_list|)
argument_list|)
argument_list|,
name|item3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|itemAt
argument_list|(
name|center
operator|-
name|QPoint
argument_list|(
literal|0
argument_list|,
operator|-
literal|40
argument_list|)
argument_list|)
argument_list|,
name|item3
argument_list|)
expr_stmt|;
name|view
operator|.
name|scale
argument_list|(
literal|0.5
argument_list|,
literal|0.5
argument_list|)
expr_stmt|;
name|view
operator|.
name|rotate
argument_list|(
literal|13
argument_list|)
expr_stmt|;
name|view
operator|.
name|shear
argument_list|(
name|qreal
argument_list|(
literal|0.01
argument_list|)
argument_list|,
name|qreal
argument_list|(
literal|0.01
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|translate
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_class
DECL|class|ContextMenuItem
class|class
name|ContextMenuItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|ContextMenuItem
name|ContextMenuItem
parameter_list|()
member_init_list|:
name|ignoreEvent
argument_list|(
literal|true
argument_list|)
member_init_list|,
name|gotEvent
argument_list|(
literal|false
argument_list|)
member_init_list|,
name|eventWasAccepted
argument_list|(
literal|false
argument_list|)
block|{ }
DECL|member|ignoreEvent
name|bool
name|ignoreEvent
decl_stmt|;
DECL|member|gotEvent
name|bool
name|gotEvent
decl_stmt|;
DECL|member|eventWasAccepted
name|bool
name|eventWasAccepted
decl_stmt|;
protected|protected:
DECL|function|contextMenuEvent
name|void
name|contextMenuEvent
parameter_list|(
name|QGraphicsSceneContextMenuEvent
modifier|*
name|event
parameter_list|)
block|{
name|gotEvent
operator|=
literal|true
expr_stmt|;
name|eventWasAccepted
operator|=
name|event
operator|->
name|isAccepted
argument_list|()
expr_stmt|;
if|if
condition|(
name|ignoreEvent
condition|)
name|event
operator|->
name|ignore
argument_list|()
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|contextMenuEventPropagation
name|void
name|tst_QGraphicsItem
operator|::
name|contextMenuEventPropagation
parameter_list|()
block|{
name|ContextMenuItem
modifier|*
name|bottomItem
init|=
operator|new
name|ContextMenuItem
decl_stmt|;
name|bottomItem
operator|->
name|setRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|ContextMenuItem
modifier|*
name|topItem
init|=
operator|new
name|ContextMenuItem
decl_stmt|;
name|topItem
operator|->
name|setParentItem
argument_list|(
name|bottomItem
argument_list|)
expr_stmt|;
name|topItem
operator|->
name|setRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setAlignment
argument_list|(
name|Qt
operator|::
name|AlignLeft
operator||
name|Qt
operator|::
name|AlignTop
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QContextMenuEvent
name|event
argument_list|(
name|QContextMenuEvent
operator|::
name|Mouse
argument_list|,
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|mapToGlobal
argument_list|(
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|event
operator|.
name|ignore
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|event
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|bottomItem
argument_list|)
expr_stmt|;
name|topItem
operator|->
name|ignoreEvent
operator|=
literal|true
expr_stmt|;
name|bottomItem
operator|->
name|ignoreEvent
operator|=
literal|true
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|event
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|topItem
operator|->
name|gotEvent
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|topItem
operator|->
name|eventWasAccepted
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|bottomItem
operator|->
name|gotEvent
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|bottomItem
operator|->
name|eventWasAccepted
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|topItem
operator|->
name|ignoreEvent
operator|=
literal|false
expr_stmt|;
name|topItem
operator|->
name|gotEvent
operator|=
literal|false
expr_stmt|;
name|bottomItem
operator|->
name|gotEvent
operator|=
literal|false
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|event
operator|.
name|isAccepted
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|topItem
operator|->
name|gotEvent
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|bottomItem
operator|->
name|gotEvent
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|topItem
operator|->
name|eventWasAccepted
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemIsMovable
name|void
name|tst_QGraphicsItem
operator|::
name|itemIsMovable
parameter_list|()
block|{
name|QGraphicsRectItem
modifier|*
name|rect
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rect
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|event
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|event
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|RightButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|event
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|ItemAddScene
class|class
name|ItemAddScene
super|:
specifier|public
name|QGraphicsScene
block|{
name|Q_OBJECT
public|public:
DECL|function|ItemAddScene
name|ItemAddScene
parameter_list|()
block|{
name|QTimer
operator|::
name|singleShot
argument_list|(
literal|500
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|newTextItem
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
public|public
name|slots
public|:
DECL|function|newTextItem
name|void
name|newTextItem
parameter_list|()
block|{
comment|// Add a text item
name|QGraphicsItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsTextItem
argument_list|(
literal|"This item will not ensure that it's visible"
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|item
operator|->
name|setPos
argument_list|(
literal|.0
argument_list|,
literal|.0
argument_list|)
expr_stmt|;
name|item
operator|->
name|show
argument_list|()
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|task141694_textItemEnsureVisible
name|void
name|tst_QGraphicsItem
operator|::
name|task141694_textItemEnsureVisible
parameter_list|()
block|{
name|ItemAddScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|,
literal|2000
argument_list|,
literal|2000
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|ensureVisible
argument_list|(
operator|-
literal|1000
argument_list|,
operator|-
literal|1000
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|int
name|hscroll
init|=
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
decl_stmt|;
name|int
name|vscroll
init|=
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
decl_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
comment|// This should not cause the view to scroll
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|horizontalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
argument_list|,
name|hscroll
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|verticalScrollBar
argument_list|()
operator|->
name|value
argument_list|()
argument_list|,
name|vscroll
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task128696_textItemEnsureMovable
name|void
name|tst_QGraphicsItem
operator|::
name|task128696_textItemEnsureMovable
parameter_list|()
block|{
name|QGraphicsTextItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsTextItem
decl_stmt|;
name|item
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
operator||
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
expr_stmt|;
name|item
operator|->
name|setTextInteractionFlags
argument_list|(
name|Qt
operator|::
name|TextEditorInteraction
argument_list|)
expr_stmt|;
name|item
operator|->
name|setPlainText
argument_list|(
literal|"abc de\nf ghi\n   j k l"
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFixedSize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|event1
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event1
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|event1
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event1
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|item
argument_list|)
expr_stmt|;
name|QGraphicsSceneMouseEvent
name|event2
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseMove
argument_list|)
decl_stmt|;
name|event2
operator|.
name|setScenePos
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|event2
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event2
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task177918_lineItemUndetected
name|void
name|tst_QGraphicsItem
operator|::
name|task177918_lineItemUndetected
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsLineItem
modifier|*
name|line
init|=
name|scene
operator|.
name|addLine
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|line
operator|->
name|boundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|items
argument_list|(
literal|9
argument_list|,
literal|9
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
name|Qt
operator|::
name|IntersectsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|items
argument_list|(
literal|9
argument_list|,
literal|9
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
name|Qt
operator|::
name|ContainsItemShape
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|items
argument_list|(
literal|9
argument_list|,
literal|9
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|items
argument_list|(
literal|9
argument_list|,
literal|9
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|,
name|Qt
operator|::
name|ContainsItemBoundingRect
argument_list|)
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task240400_clickOnTextItem_data
name|void
name|tst_QGraphicsItem
operator|::
name|task240400_clickOnTextItem_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"flags"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"textFlags"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"editor, noflags"
argument_list|)
operator|<<
literal|0
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|TextEditorInteraction
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"editor, movable"
argument_list|)
operator|<<
name|int
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|TextEditorInteraction
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"editor, selectable"
argument_list|)
operator|<<
name|int
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|TextEditorInteraction
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"editor, movable | selectable"
argument_list|)
operator|<<
name|int
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
operator||
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|TextEditorInteraction
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"noninteractive, noflags"
argument_list|)
operator|<<
literal|0
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|NoTextInteraction
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"noninteractive, movable"
argument_list|)
operator|<<
name|int
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|NoTextInteraction
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"noninteractive, selectable"
argument_list|)
operator|<<
name|int
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|NoTextInteraction
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"noninteractive, movable | selectable"
argument_list|)
operator|<<
name|int
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
operator||
name|QGraphicsItem
operator|::
name|ItemIsSelectable
argument_list|)
operator|<<
name|int
argument_list|(
name|Qt
operator|::
name|NoTextInteraction
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task240400_clickOnTextItem
name|void
name|tst_QGraphicsItem
operator|::
name|task240400_clickOnTextItem
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|flags
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|textFlags
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|QGraphicsTextItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addText
argument_list|(
literal|"Hello"
argument_list|)
decl_stmt|;
name|item
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|GraphicsItemFlags
argument_list|(
name|flags
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setTextInteractionFlags
argument_list|(
name|Qt
operator|::
name|TextInteractionFlags
argument_list|(
name|textFlags
argument_list|)
argument_list|)
expr_stmt|;
name|bool
name|focusable
init|=
operator|(
name|item
operator|->
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemIsFocusable
operator|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|textFlags
condition|?
name|focusable
else|:
operator|!
name|focusable
argument_list|)
expr_stmt|;
name|int
name|column
init|=
name|item
operator|->
name|textCursor
argument_list|()
operator|.
name|columnNumber
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|column
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// Click in the top-left corner of the item
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|item
operator|->
name|sceneBoundingRect
argument_list|()
operator|.
name|topLeft
argument_list|()
operator|+
name|QPointF
argument_list|(
literal|0.1
argument_list|,
literal|0.1
argument_list|)
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|flags
operator|||
name|textFlags
condition|)
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|item
argument_list|)
expr_stmt|;
else|else
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|item
operator|->
name|sceneBoundingRect
argument_list|()
operator|.
name|topLeft
argument_list|()
operator|+
name|QPointF
argument_list|(
literal|0.1
argument_list|,
literal|0.1
argument_list|)
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButtons
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|textFlags
condition|)
name|QVERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
else|else
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|)
expr_stmt|;
name|bool
name|selectable
init|=
operator|(
name|flags
operator|&
name|QGraphicsItem
operator|::
name|ItemIsSelectable
operator|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|selectable
condition|?
name|item
operator|->
name|isSelected
argument_list|()
else|:
operator|!
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|// Now click in the middle and check that the cursor moved.
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMousePress
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|item
operator|->
name|sceneBoundingRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButtons
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|flags
operator|||
name|textFlags
condition|)
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|item
argument_list|)
expr_stmt|;
else|else
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|{
name|QGraphicsSceneMouseEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|item
operator|->
name|sceneBoundingRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButton
argument_list|(
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|event
operator|.
name|setButtons
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|textFlags
condition|)
name|QVERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
else|else
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|selectable
condition|?
name|item
operator|->
name|isSelected
argument_list|()
else|:
operator|!
name|item
operator|->
name|isSelected
argument_list|()
argument_list|)
expr_stmt|;
comment|//
if|if
condition|(
name|textFlags
operator|&
name|Qt
operator|::
name|TextEditorInteraction
condition|)
name|QVERIFY
argument_list|(
name|item
operator|->
name|textCursor
argument_list|()
operator|.
name|columnNumber
argument_list|()
operator|>
name|column
argument_list|)
expr_stmt|;
else|else
name|QCOMPARE
argument_list|(
name|item
operator|->
name|textCursor
argument_list|()
operator|.
name|columnNumber
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|TextItem
class|class
name|TextItem
super|:
specifier|public
name|QGraphicsSimpleTextItem
block|{
public|public:
DECL|function|TextItem
name|TextItem
parameter_list|(
specifier|const
name|QString
modifier|&
name|text
parameter_list|)
member_init_list|:
name|QGraphicsSimpleTextItem
argument_list|(
name|text
argument_list|)
block|{
name|updates
operator|=
literal|0
expr_stmt|;
block|}
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
name|widget
parameter_list|)
block|{
name|updates
operator|++
expr_stmt|;
name|QGraphicsSimpleTextItem
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|widget
argument_list|)
expr_stmt|;
block|}
DECL|member|updates
name|int
name|updates
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|ensureUpdateOnTextItem
name|void
name|tst_QGraphicsItem
operator|::
name|ensureUpdateOnTextItem
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|TextItem
modifier|*
name|text1
init|=
operator|new
name|TextItem
argument_list|(
name|QLatin1String
argument_list|(
literal|"123"
argument_list|)
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|text1
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|text1
operator|->
name|updates
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//same bouding rect but we have to update
name|text1
operator|->
name|setText
argument_list|(
name|QLatin1String
argument_list|(
literal|"321"
argument_list|)
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|text1
operator|->
name|updates
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task243707_addChildBeforeParent
name|void
name|tst_QGraphicsItem
operator|::
name|task243707_addChildBeforeParent
parameter_list|()
block|{
comment|// Task reports that adding the child before the parent leads to an
comment|// inconsistent internal state that can cause a crash.  This test shows
comment|// one such crash.
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|QGraphicsWidget
decl_stmt|;
name|QGraphicsWidget
modifier|*
name|widget2
init|=
operator|new
name|QGraphicsWidget
argument_list|(
name|widget
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|widget2
operator|->
name|parentItem
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|widget
operator|->
name|commonAncestorItem
argument_list|(
name|widget2
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|widget2
operator|->
name|commonAncestorItem
argument_list|(
name|widget
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|task197802_childrenVisibility
name|void
name|tst_QGraphicsItem
operator|::
name|task197802_childrenVisibility
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
name|item
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|,
operator|&
name|item
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|item
argument_list|)
expr_stmt|;
comment|//freshly created: both visible
name|QVERIFY
argument_list|(
name|item
operator|.
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
comment|//hide child: parent visible, child not
name|item2
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|.
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
comment|//hide parent: parent and child invisible
name|item
operator|.
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|.
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
comment|//ask to show the child: parent and child invisible anyways
name|item2
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|.
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
comment|//show the parent: both parent and child visible
name|item
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|.
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|isVisible
argument_list|()
argument_list|)
expr_stmt|;
operator|delete
name|item2
expr_stmt|;
block|}
end_function
begin_function
DECL|function|boundingRegion_data
name|void
name|tst_QGraphicsItem
operator|::
name|boundingRegion_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QLineF
argument_list|>
argument_list|(
literal|"line"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"granularity"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QTransform
argument_list|>
argument_list|(
literal|"transform"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QRegion
argument_list|>
argument_list|(
literal|"expectedRegion"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(0, 0, 10, 10) | 0.0 | identity | {(0, 0, 10, 10)}"
argument_list|)
operator|<<
name|QLineF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QRegion
argument_list|(
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(0, 0, 10, 0) | 0.0 | identity | {(0, 0, 10, 10)}"
argument_list|)
operator|<<
name|QLineF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QRegion
argument_list|(
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(0, 0, 10, 0) | 0.5 | identity | {(0, 0, 10, 1)}"
argument_list|)
operator|<<
name|QLineF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QRegion
argument_list|(
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(0, 0, 10, 0) | 1.0 | identity | {(0, 0, 10, 1)}"
argument_list|)
operator|<<
name|QLineF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QRegion
argument_list|(
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(0, 0, 0, 10) | 0.0 | identity | {(0, 0, 10, 10)}"
argument_list|)
operator|<<
name|QLineF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QRegion
argument_list|(
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(0, 0, 0, 10) | 0.5 | identity | {(0, 0, 1, 10)}"
argument_list|)
operator|<<
name|QLineF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QRegion
argument_list|(
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"(0, 0, 0, 10) | 1.0 | identity | {(0, 0, 1, 10)}"
argument_list|)
operator|<<
name|QLineF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QRegion
argument_list|(
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|boundingRegion
name|void
name|tst_QGraphicsItem
operator|::
name|boundingRegion
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QLineF
argument_list|,
name|line
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|granularity
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QTransform
argument_list|,
name|transform
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QRegion
argument_list|,
name|expectedRegion
argument_list|)
expr_stmt|;
name|QGraphicsLineItem
name|item
argument_list|(
name|line
argument_list|)
decl_stmt|;
name|item
operator|.
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|boundingRegionGranularity
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|0.0
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|.
name|setBoundingRegionGranularity
argument_list|(
name|granularity
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|boundingRegionGranularity
argument_list|()
argument_list|,
name|granularity
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|boundingRegion
argument_list|(
name|transform
argument_list|)
argument_list|,
name|expectedRegion
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemTransform_parentChild
name|void
name|tst_QGraphicsItem
operator|::
name|itemTransform_parentChild
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|child
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|child
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|child
operator|->
name|scale
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|child
operator|->
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|itemTransform
argument_list|(
name|parent
argument_list|)
operator|.
name|map
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|30
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|itemTransform
argument_list|(
name|child
argument_list|)
operator|.
name|map
argument_list|(
name|QPointF
argument_list|(
operator|-
literal|10
argument_list|,
literal|30
argument_list|)
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemTransform_siblings
name|void
name|tst_QGraphicsItem
operator|::
name|itemTransform_siblings
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parent
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|brother
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|sister
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|parent
operator|->
name|scale
argument_list|(
literal|10
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|parent
operator|->
name|rotate
argument_list|(
operator|-
literal|180
argument_list|)
expr_stmt|;
name|parent
operator|->
name|shear
argument_list|(
literal|2
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|brother
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|sister
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|brother
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|brother
operator|->
name|scale
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|brother
operator|->
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|sister
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|sister
operator|->
name|scale
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|sister
operator|->
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|brother
operator|->
name|itemTransform
argument_list|(
name|sister
argument_list|)
operator|.
name|map
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sister
operator|->
name|itemTransform
argument_list|(
name|brother
argument_list|)
operator|.
name|map
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemTransform_unrelated
name|void
name|tst_QGraphicsItem
operator|::
name|itemTransform_unrelated
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|stranger1
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|stranger2
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|stranger1
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|stranger1
operator|->
name|scale
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|stranger1
operator|->
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|stranger2
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|stranger2
operator|->
name|scale
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|stranger2
operator|->
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stranger1
operator|->
name|itemTransform
argument_list|(
name|stranger2
argument_list|)
operator|.
name|map
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stranger2
operator|->
name|itemTransform
argument_list|(
name|stranger1
argument_list|)
operator|.
name|map
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|opacity_data
name|void
name|tst_QGraphicsItem
operator|::
name|opacity_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"p_opacity"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"p_opacityFlags"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"c1_opacity"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"c1_opacityFlags"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"c2_opacity"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"c2_opacityFlags"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"p_effectiveOpacity"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"c1_effectiveOpacity"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"c2_effectiveOpacity"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"c3_effectiveOpacity"
argument_list|)
expr_stmt|;
comment|// Modify the opacity and see how it propagates
name|QTest
operator|::
name|newRow
argument_list|(
literal|"A: 1.0 0 1.0 0 1.0 1.0 1.0 1.0 1.0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"B: 0.5 0 1.0 0 1.0 1.0 1.0 1.0 1.0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"C: 0.5 0 0.1 0 1.0 1.0 1.0 1.0 1.0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|0.1
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.05
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.05
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.05
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"D: 0.0 0 1.0 0 1.0 1.0 1.0 1.0 1.0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
expr_stmt|;
comment|// Parent doesn't propagate to children - now modify the opacity and see how it propagates
name|int
name|flags
init|=
name|QGraphicsItem
operator|::
name|ItemDoesntPropagateOpacityToChildren
decl_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"E: 1.0 2 1.0 0 1.0 1.0 1.0 1.0 1.0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|flags
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"F: 0.5 2 1.0 0 1.0 1.0 1.0 1.0 1.0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|flags
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"G: 0.5 2 0.1 0 1.0 1.0 1.0 1.0 1.0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|flags
operator|<<
name|qreal
argument_list|(
literal|0.1
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.1
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.1
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"H: 0.0 2 1.0 0 1.0 1.0 1.0 1.0 1.0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|flags
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
comment|// Child ignores parent - now modify the opacity and see how it propagates
name|flags
operator|=
name|QGraphicsItem
operator|::
name|ItemIgnoresParentOpacity
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"I: 1.0 0 1.0 1 1.0 1.0 1.0 1.0 1.0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|flags
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"J: 1.0 0 1.0 1 1.0 1.0 1.0 1.0 1.0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|flags
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.25
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.25
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"K: 1.0 0 1.0 1 1.0 1.0 1.0 1.0 1.0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.2
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|0.2
argument_list|)
operator|<<
name|flags
operator|<<
name|qreal
argument_list|(
literal|0.2
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|0.2
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.2
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.04
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.04
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"L: 1.0 0 1.0 1 1.0 1.0 1.0 1.0 1.0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|flags
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
literal|0
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
expr_stmt|;
comment|// Child ignores parent and doesn't propagate - now modify the opacity and see how it propagates
name|flags
operator|=
name|QGraphicsItem
operator|::
name|ItemIgnoresParentOpacity
operator||
name|QGraphicsItem
operator|::
name|ItemDoesntPropagateOpacityToChildren
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"M: 1.0 0 1.0 1 1.0 1.0 1.0 1.0 1.0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
comment|// p
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|flags
comment|// c1 (no prop)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
comment|// c2
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"M: 0.5 0 1.0 1 1.0 1.0 1.0 1.0 1.0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
literal|0
comment|// p
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|flags
comment|// c1 (no prop)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
comment|// c2
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"M: 0.5 0 0.5 1 1.0 1.0 1.0 1.0 1.0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
literal|0
comment|// p
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|flags
comment|// c1 (no prop)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
comment|// c2
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"M: 0.5 0 0.5 1 0.5 1.0 1.0 1.0 1.0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
literal|0
comment|// p
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|flags
comment|// c1 (no prop)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
literal|0
comment|// c2
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"M: 1.0 0 0.5 1 0.5 1.0 1.0 1.0 1.0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
literal|0
comment|// p
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|flags
comment|// c1 (no prop)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
literal|0
comment|// c2
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.5
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|opacity
name|void
name|tst_QGraphicsItem
operator|::
name|opacity
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|p_opacity
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|p_opacityFlags
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|p_effectiveOpacity
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|c1_opacity
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|c1_opacityFlags
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|c1_effectiveOpacity
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|c2_opacity
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|c2_opacityFlags
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|c2_effectiveOpacity
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|c3_effectiveOpacity
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|p
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|c1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|p
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|c2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|c1
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|c3
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|c2
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|p
operator|->
name|opacity
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|1.0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|p
operator|->
name|effectiveOpacity
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|1.0
argument_list|)
argument_list|)
expr_stmt|;
name|int
name|opacityMask
init|=
name|QGraphicsItem
operator|::
name|ItemIgnoresParentOpacity
operator||
name|QGraphicsItem
operator|::
name|ItemDoesntPropagateOpacityToChildren
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
operator|(
name|p
operator|->
name|flags
argument_list|()
operator|&
name|opacityMask
operator|)
argument_list|)
expr_stmt|;
name|p
operator|->
name|setOpacity
argument_list|(
name|p_opacity
argument_list|)
expr_stmt|;
name|c1
operator|->
name|setOpacity
argument_list|(
name|c1_opacity
argument_list|)
expr_stmt|;
name|c2
operator|->
name|setOpacity
argument_list|(
name|c2_opacity
argument_list|)
expr_stmt|;
name|p
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|GraphicsItemFlags
argument_list|(
name|p
operator|->
name|flags
argument_list|()
operator||
name|p_opacityFlags
argument_list|)
argument_list|)
expr_stmt|;
name|c1
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|GraphicsItemFlags
argument_list|(
name|c1
operator|->
name|flags
argument_list|()
operator||
name|c1_opacityFlags
argument_list|)
argument_list|)
expr_stmt|;
name|c2
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|GraphicsItemFlags
argument_list|(
name|c2
operator|->
name|flags
argument_list|()
operator||
name|c2_opacityFlags
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|p
operator|->
name|flags
argument_list|()
operator|&
name|opacityMask
argument_list|)
argument_list|,
name|p_opacityFlags
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|c1
operator|->
name|flags
argument_list|()
operator|&
name|opacityMask
argument_list|)
argument_list|,
name|c1_opacityFlags
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|c2
operator|->
name|flags
argument_list|()
operator|&
name|opacityMask
argument_list|)
argument_list|,
name|c2_opacityFlags
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|p
operator|->
name|opacity
argument_list|()
argument_list|,
name|p_opacity
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|p
operator|->
name|effectiveOpacity
argument_list|()
argument_list|,
name|p_effectiveOpacity
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c1
operator|->
name|effectiveOpacity
argument_list|()
argument_list|,
name|c1_effectiveOpacity
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c2
operator|->
name|effectiveOpacity
argument_list|()
argument_list|,
name|c2_effectiveOpacity
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|c3
operator|->
name|effectiveOpacity
argument_list|()
argument_list|,
name|c3_effectiveOpacity
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|opacity2
name|void
name|tst_QGraphicsItem
operator|::
name|opacity2
parameter_list|()
block|{
name|EventTester
modifier|*
name|parent
init|=
operator|new
name|EventTester
decl_stmt|;
name|EventTester
modifier|*
name|child
init|=
operator|new
name|EventTester
argument_list|(
name|parent
argument_list|)
decl_stmt|;
name|EventTester
modifier|*
name|grandChild
init|=
operator|new
name|EventTester
argument_list|(
name|child
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|MyGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>=
literal|1
argument_list|)
expr_stmt|;
DECL|macro|RESET_REPAINT_COUNTERS
define|#
directive|define
name|RESET_REPAINT_COUNTERS
define|\
value|parent->repaints = 0; \     child->repaints = 0; \     grandChild->repaints = 0; \     view.repaints = 0;
name|RESET_REPAINT_COUNTERS
name|child
operator|->
name|setOpacity
argument_list|(
literal|0.0
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild
operator|->
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|RESET_REPAINT_COUNTERS
name|child
operator|->
name|setOpacity
argument_list|(
literal|1.0
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|RESET_REPAINT_COUNTERS
name|parent
operator|->
name|setOpacity
argument_list|(
literal|0.0
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild
operator|->
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|RESET_REPAINT_COUNTERS
name|parent
operator|->
name|setOpacity
argument_list|(
literal|1.0
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|grandChild
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIgnoresParentOpacity
argument_list|)
expr_stmt|;
name|RESET_REPAINT_COUNTERS
name|child
operator|->
name|setOpacity
argument_list|(
literal|0.0
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|RESET_REPAINT_COUNTERS
name|child
operator|->
name|setOpacity
argument_list|(
literal|0.0
argument_list|)
decl_stmt|;
comment|// Already 0.0; no change.
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild
operator|->
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|opacityZeroUpdates
name|void
name|tst_QGraphicsItem
operator|::
name|opacityZeroUpdates
parameter_list|()
block|{
name|EventTester
modifier|*
name|parent
init|=
operator|new
name|EventTester
decl_stmt|;
name|EventTester
modifier|*
name|child
init|=
operator|new
name|EventTester
argument_list|(
name|parent
argument_list|)
decl_stmt|;
name|child
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|MyGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|parent
operator|->
name|setOpacity
argument_list|(
literal|0.0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
comment|// transforming items bounding rect to view coordinates
specifier|const
name|QRect
name|childDeviceBoundingRect
init|=
name|child
operator|->
name|deviceTransform
argument_list|(
name|view
operator|.
name|viewportTransform
argument_list|()
argument_list|)
operator|.
name|mapRect
argument_list|(
name|child
operator|->
name|boundingRect
argument_list|()
argument_list|)
operator|.
name|toRect
argument_list|()
decl_stmt|;
specifier|const
name|QRect
name|parentDeviceBoundingRect
init|=
name|parent
operator|->
name|deviceTransform
argument_list|(
name|view
operator|.
name|viewportTransform
argument_list|()
argument_list|)
operator|.
name|mapRect
argument_list|(
name|parent
operator|->
name|boundingRect
argument_list|()
argument_list|)
operator|.
name|toRect
argument_list|()
decl_stmt|;
name|QRegion
name|expectedRegion
init|=
name|parentDeviceBoundingRect
operator|.
name|adjusted
argument_list|(
operator|-
literal|2
argument_list|,
operator|-
literal|2
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
decl_stmt|;
name|expectedRegion
operator|+=
name|childDeviceBoundingRect
operator|.
name|adjusted
argument_list|(
operator|-
literal|2
argument_list|,
operator|-
literal|2
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|COMPARE_REGIONS
argument_list|(
name|view
operator|.
name|paintedRegion
argument_list|,
name|expectedRegion
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|StacksBehindParentHelper
class|class
name|StacksBehindParentHelper
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|StacksBehindParentHelper
name|StacksBehindParentHelper
parameter_list|(
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
modifier|*
name|paintedItems
parameter_list|,
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|,
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|,
name|parent
argument_list|)
member_init_list|,
name|paintedItems
argument_list|(
name|paintedItems
argument_list|)
block|{ }
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
name|widget
parameter_list|)
block|{
name|QGraphicsRectItem
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|widget
argument_list|)
expr_stmt|;
name|paintedItems
operator|->
name|append
argument_list|(
name|this
argument_list|)
expr_stmt|;
block|}
private|private:
DECL|member|paintedItems
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
modifier|*
name|paintedItems
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|itemStacksBehindParent
name|void
name|tst_QGraphicsItem
operator|::
name|itemStacksBehindParent
parameter_list|()
block|{
name|StacksBehindParentHelper
modifier|*
name|parent1
init|=
operator|new
name|StacksBehindParentHelper
argument_list|(
operator|&
name|paintedItems
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|50
argument_list|)
argument_list|)
decl_stmt|;
name|StacksBehindParentHelper
modifier|*
name|child11
init|=
operator|new
name|StacksBehindParentHelper
argument_list|(
operator|&
name|paintedItems
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|parent1
argument_list|)
decl_stmt|;
name|StacksBehindParentHelper
modifier|*
name|grandChild111
init|=
operator|new
name|StacksBehindParentHelper
argument_list|(
operator|&
name|paintedItems
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|20
argument_list|,
literal|20
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|child11
argument_list|)
decl_stmt|;
name|StacksBehindParentHelper
modifier|*
name|child12
init|=
operator|new
name|StacksBehindParentHelper
argument_list|(
operator|&
name|paintedItems
argument_list|,
name|QRectF
argument_list|(
literal|60
argument_list|,
literal|10
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|parent1
argument_list|)
decl_stmt|;
name|StacksBehindParentHelper
modifier|*
name|grandChild121
init|=
operator|new
name|StacksBehindParentHelper
argument_list|(
operator|&
name|paintedItems
argument_list|,
name|QRectF
argument_list|(
literal|70
argument_list|,
literal|20
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|child12
argument_list|)
decl_stmt|;
name|StacksBehindParentHelper
modifier|*
name|parent2
init|=
operator|new
name|StacksBehindParentHelper
argument_list|(
operator|&
name|paintedItems
argument_list|,
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|50
argument_list|)
argument_list|)
decl_stmt|;
name|StacksBehindParentHelper
modifier|*
name|child21
init|=
operator|new
name|StacksBehindParentHelper
argument_list|(
operator|&
name|paintedItems
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
literal|10
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|parent2
argument_list|)
decl_stmt|;
name|StacksBehindParentHelper
modifier|*
name|grandChild211
init|=
operator|new
name|StacksBehindParentHelper
argument_list|(
operator|&
name|paintedItems
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|20
argument_list|,
literal|20
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|child21
argument_list|)
decl_stmt|;
name|StacksBehindParentHelper
modifier|*
name|child22
init|=
operator|new
name|StacksBehindParentHelper
argument_list|(
operator|&
name|paintedItems
argument_list|,
name|QRectF
argument_list|(
literal|60
argument_list|,
literal|10
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|parent2
argument_list|)
decl_stmt|;
name|StacksBehindParentHelper
modifier|*
name|grandChild221
init|=
operator|new
name|StacksBehindParentHelper
argument_list|(
operator|&
name|paintedItems
argument_list|,
name|QRectF
argument_list|(
literal|70
argument_list|,
literal|20
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|child22
argument_list|)
decl_stmt|;
name|parent1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"parent1"
argument_list|)
expr_stmt|;
name|child11
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"child11"
argument_list|)
expr_stmt|;
name|grandChild111
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"grandChild111"
argument_list|)
expr_stmt|;
name|child12
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"child12"
argument_list|)
expr_stmt|;
name|grandChild121
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"grandChild121"
argument_list|)
expr_stmt|;
name|parent2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"parent2"
argument_list|)
expr_stmt|;
name|child21
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"child21"
argument_list|)
expr_stmt|;
name|grandChild211
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"grandChild211"
argument_list|)
expr_stmt|;
name|child22
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"child22"
argument_list|)
expr_stmt|;
name|grandChild221
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"grandChild221"
argument_list|)
expr_stmt|;
comment|// Disambiguate siblings
name|parent1
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|child11
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|child21
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent2
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|paintedItems
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|paintedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|update
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|grandChild111
operator|<<
name|child11
operator|<<
name|grandChild121
operator|<<
name|child12
operator|<<
name|parent1
operator|<<
name|grandChild211
operator|<<
name|child21
operator|<<
name|grandChild221
operator|<<
name|child22
operator|<<
name|parent2
operator|)
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|paintedItems
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|parent2
operator|<<
name|child22
operator|<<
name|grandChild221
operator|<<
name|child21
operator|<<
name|grandChild211
operator|<<
name|parent1
operator|<<
name|child12
operator|<<
name|grandChild121
operator|<<
name|child11
operator|<<
name|grandChild111
argument_list|)
expr_stmt|;
name|child11
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemStacksBehindParent
argument_list|)
expr_stmt|;
name|scene
operator|.
name|update
argument_list|()
expr_stmt|;
name|paintedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|grandChild121
operator|<<
name|child12
operator|<<
name|parent1
operator|<<
name|grandChild111
operator|<<
name|child11
operator|<<
name|grandChild211
operator|<<
name|child21
operator|<<
name|grandChild221
operator|<<
name|child22
operator|<<
name|parent2
operator|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|paintedItems
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|parent2
operator|<<
name|child22
operator|<<
name|grandChild221
operator|<<
name|child21
operator|<<
name|grandChild211
operator|<<
name|child11
operator|<<
name|grandChild111
operator|<<
name|parent1
operator|<<
name|child12
operator|<<
name|grandChild121
argument_list|)
expr_stmt|;
name|child12
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemStacksBehindParent
argument_list|)
expr_stmt|;
name|paintedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|scene
operator|.
name|update
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|parent1
operator|<<
name|grandChild111
operator|<<
name|child11
operator|<<
name|grandChild121
operator|<<
name|child12
operator|<<
name|grandChild211
operator|<<
name|child21
operator|<<
name|grandChild221
operator|<<
name|child22
operator|<<
name|parent2
operator|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|paintedItems
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|parent2
operator|<<
name|child22
operator|<<
name|grandChild221
operator|<<
name|child21
operator|<<
name|grandChild211
operator|<<
name|child12
operator|<<
name|grandChild121
operator|<<
name|child11
operator|<<
name|grandChild111
operator|<<
name|parent1
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|ClippingAndTransformsScene
class|class
name|ClippingAndTransformsScene
super|:
specifier|public
name|QGraphicsScene
block|{
public|public:
DECL|member|drawnItems
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|drawnItems
decl_stmt|;
protected|protected:
DECL|function|drawItems
name|void
name|drawItems
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
name|int
name|numItems
parameter_list|,
name|QGraphicsItem
modifier|*
name|items
index|[]
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
name|options
index|[]
parameter_list|,
name|QWidget
modifier|*
name|widget
init|=
literal|0
parameter_list|)
block|{
name|drawnItems
operator|.
name|clear
argument_list|()
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|numItems
condition|;
operator|++
name|i
control|)
name|drawnItems
operator|<<
name|items
index|[
name|i
index|]
expr_stmt|;
name|QGraphicsScene
operator|::
name|drawItems
argument_list|(
name|painter
argument_list|,
name|numItems
argument_list|,
name|items
argument_list|,
name|options
argument_list|,
name|widget
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|nestedClipping
name|void
name|tst_QGraphicsItem
operator|::
name|nestedClipping
parameter_list|()
block|{
name|ClippingAndTransformsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|root
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|root
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
argument_list|)
expr_stmt|;
name|root
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|l1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|l1
operator|->
name|setParentItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|l1
operator|->
name|setPos
argument_list|(
operator|-
literal|50
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|l1
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
literal|255
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|l1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|QGraphicsEllipseItem
modifier|*
name|l2
init|=
operator|new
name|QGraphicsEllipseItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|l2
operator|->
name|setParentItem
argument_list|(
name|l1
argument_list|)
expr_stmt|;
name|l2
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|l2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|l2
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
literal|255
argument_list|,
literal|255
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|l3
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|25
argument_list|,
literal|25
argument_list|)
argument_list|)
decl_stmt|;
name|l3
operator|->
name|setParentItem
argument_list|(
name|l2
argument_list|)
expr_stmt|;
name|l3
operator|->
name|setBrush
argument_list|(
name|QColor
argument_list|(
literal|0
argument_list|,
literal|255
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|l3
operator|->
name|setPos
argument_list|(
literal|50
operator|-
literal|12
argument_list|,
operator|-
literal|12
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|root
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"root"
argument_list|)
expr_stmt|;
name|l1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"l1"
argument_list|)
expr_stmt|;
name|l2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"l2"
argument_list|)
expr_stmt|;
name|l3
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"l3"
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setOptimizationFlag
argument_list|(
name|QGraphicsView
operator|::
name|IndirectPainting
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|expected
decl_stmt|;
name|expected
operator|<<
name|root
operator|<<
name|l1
operator|<<
name|l2
operator|<<
name|l3
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|scene
operator|.
name|drawnItems
argument_list|,
name|expected
argument_list|)
expr_stmt|;
name|QImage
name|image
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|,
name|QImage
operator|::
name|Format_ARGB32_Premultiplied
argument_list|)
decl_stmt|;
name|image
operator|.
name|fill
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QPainter
name|painter
argument_list|(
operator|&
name|image
argument_list|)
decl_stmt|;
name|scene
operator|.
name|render
argument_list|(
operator|&
name|painter
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
comment|// Check transparent areas
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|100
argument_list|,
literal|25
argument_list|)
argument_list|,
name|qRgba
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|100
argument_list|,
literal|175
argument_list|)
argument_list|,
name|qRgba
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|25
argument_list|,
literal|100
argument_list|)
argument_list|,
name|qRgba
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|175
argument_list|,
literal|100
argument_list|)
argument_list|,
name|qRgba
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|70
argument_list|,
literal|80
argument_list|)
argument_list|,
name|qRgba
argument_list|(
literal|255
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|80
argument_list|,
literal|130
argument_list|)
argument_list|,
name|qRgba
argument_list|(
literal|255
argument_list|,
literal|255
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|92
argument_list|,
literal|105
argument_list|)
argument_list|,
name|qRgba
argument_list|(
literal|0
argument_list|,
literal|255
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|image
operator|.
name|pixel
argument_list|(
literal|105
argument_list|,
literal|105
argument_list|)
argument_list|,
name|qRgba
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|,
literal|255
argument_list|)
argument_list|)
expr_stmt|;
if|#
directive|if
literal|0
comment|// Enable this to compare if the test starts failing.
block|image.save("nestedClipping_reference.png");
endif|#
directive|endif
block|}
end_function
begin_class
DECL|class|TransformDebugItem
class|class
name|TransformDebugItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|TransformDebugItem
name|TransformDebugItem
parameter_list|()
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
block|{
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|setBrush
argument_list|(
name|QColor
argument_list|(
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|,
name|qrand
argument_list|()
operator|%
literal|256
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|member|x
name|QTransform
name|x
decl_stmt|;
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
name|widget
init|=
literal|0
parameter_list|)
block|{
name|x
operator|=
name|painter
operator|->
name|worldTransform
argument_list|()
expr_stmt|;
name|QGraphicsRectItem
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|widget
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|nestedClippingTransforms
name|void
name|tst_QGraphicsItem
operator|::
name|nestedClippingTransforms
parameter_list|()
block|{
name|TransformDebugItem
modifier|*
name|rootClipper
init|=
operator|new
name|TransformDebugItem
decl_stmt|;
name|rootClipper
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|TransformDebugItem
modifier|*
name|child
init|=
operator|new
name|TransformDebugItem
decl_stmt|;
name|child
operator|->
name|setParentItem
argument_list|(
name|rootClipper
argument_list|)
expr_stmt|;
name|child
operator|->
name|setPos
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|TransformDebugItem
modifier|*
name|grandChildClipper
init|=
operator|new
name|TransformDebugItem
decl_stmt|;
name|grandChildClipper
operator|->
name|setParentItem
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|grandChildClipper
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|grandChildClipper
operator|->
name|setPos
argument_list|(
literal|4
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|TransformDebugItem
modifier|*
name|greatGrandChild
init|=
operator|new
name|TransformDebugItem
decl_stmt|;
name|greatGrandChild
operator|->
name|setPos
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|greatGrandChild
operator|->
name|setParentItem
argument_list|(
name|grandChildClipper
argument_list|)
expr_stmt|;
name|TransformDebugItem
modifier|*
name|grandChildClipper2
init|=
operator|new
name|TransformDebugItem
decl_stmt|;
name|grandChildClipper2
operator|->
name|setParentItem
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|grandChildClipper2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|grandChildClipper2
operator|->
name|setPos
argument_list|(
literal|8
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|TransformDebugItem
modifier|*
name|greatGrandChild2
init|=
operator|new
name|TransformDebugItem
decl_stmt|;
name|greatGrandChild2
operator|->
name|setPos
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|greatGrandChild2
operator|->
name|setParentItem
argument_list|(
name|grandChildClipper2
argument_list|)
expr_stmt|;
name|TransformDebugItem
modifier|*
name|grandChildClipper3
init|=
operator|new
name|TransformDebugItem
decl_stmt|;
name|grandChildClipper3
operator|->
name|setParentItem
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|grandChildClipper3
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|grandChildClipper3
operator|->
name|setPos
argument_list|(
literal|12
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|TransformDebugItem
modifier|*
name|greatGrandChild3
init|=
operator|new
name|TransformDebugItem
decl_stmt|;
name|greatGrandChild3
operator|->
name|setPos
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|greatGrandChild3
operator|->
name|setParentItem
argument_list|(
name|grandChildClipper3
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rootClipper
argument_list|)
expr_stmt|;
name|QImage
name|image
argument_list|(
name|scene
operator|.
name|itemsBoundingRect
argument_list|()
operator|.
name|size
argument_list|()
operator|.
name|toSize
argument_list|()
argument_list|,
name|QImage
operator|::
name|Format_ARGB32_Premultiplied
argument_list|)
decl_stmt|;
name|image
operator|.
name|fill
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QPainter
name|p
argument_list|(
operator|&
name|image
argument_list|)
decl_stmt|;
name|scene
operator|.
name|render
argument_list|(
operator|&
name|p
argument_list|)
expr_stmt|;
name|p
operator|.
name|end
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rootClipper
operator|->
name|x
argument_list|,
name|QTransform
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|x
argument_list|,
name|QTransform
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|12
argument_list|,
literal|12
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChildClipper
operator|->
name|x
argument_list|,
name|QTransform
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|16
argument_list|,
literal|16
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|greatGrandChild
operator|->
name|x
argument_list|,
name|QTransform
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|18
argument_list|,
literal|18
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChildClipper2
operator|->
name|x
argument_list|,
name|QTransform
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|greatGrandChild2
operator|->
name|x
argument_list|,
name|QTransform
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|22
argument_list|,
literal|22
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChildClipper3
operator|->
name|x
argument_list|,
name|QTransform
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|24
argument_list|,
literal|24
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|greatGrandChild3
operator|->
name|x
argument_list|,
name|QTransform
argument_list|(
literal|1
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|0
argument_list|,
literal|26
argument_list|,
literal|26
argument_list|,
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sceneTransformCache
name|void
name|tst_QGraphicsItem
operator|::
name|sceneTransformCache
parameter_list|()
block|{
comment|// Test that an item's scene transform is updated correctly when the
comment|// parent is transformed.
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rect
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rect2
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setParentItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|rect
operator|->
name|translate
argument_list|(
literal|0
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|rect
operator|->
name|translate
argument_list|(
literal|0
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QTransform
name|x
decl_stmt|;
name|x
operator|.
name|translate
argument_list|(
literal|0
argument_list|,
literal|150
argument_list|)
expr_stmt|;
name|x
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2
operator|->
name|sceneTransform
argument_list|()
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
comment|//Crazy use case : rect4 child of rect3 so the transformation of rect4 will be cached.Good!
comment|//We remove rect4 from the scene, then the validTransform bit flag is set to 0 and the index of the cache
comment|//add to the freeTransformSlots. The problem was that sceneTransformIndex was not set to -1 so if a new item arrive
comment|//with a child (rect6) that will be cached then it will take the freeSlot (ex rect4) and put it his transform. But if rect4 is
comment|//added back to the scene then it will set the transform to his old sceneTransformIndex value that will erase the new
comment|//value of rect6 so rect6 transform will be wrong.
name|QGraphicsRectItem
modifier|*
name|rect3
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect4
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rect3
operator|->
name|setPos
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|rect4
operator|->
name|setParentItem
argument_list|(
name|rect3
argument_list|)
expr_stmt|;
name|rect4
operator|->
name|setPos
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|rect4
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect4
operator|->
name|mapToScene
argument_list|(
name|rect4
operator|->
name|boundingRect
argument_list|()
operator|.
name|topLeft
argument_list|()
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|rect4
argument_list|)
expr_stmt|;
comment|//rect4 transform is local only
name|QCOMPARE
argument_list|(
name|rect4
operator|->
name|mapToScene
argument_list|(
name|rect4
operator|->
name|boundingRect
argument_list|()
operator|.
name|topLeft
argument_list|()
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect5
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect6
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rect5
operator|->
name|setPos
argument_list|(
name|QPointF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|rect5
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|rect6
operator|->
name|setParentItem
argument_list|(
name|rect5
argument_list|)
expr_stmt|;
name|rect6
operator|->
name|setPos
argument_list|(
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|rect6
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
comment|//test if rect6 transform is ok
name|QCOMPARE
argument_list|(
name|rect6
operator|->
name|mapToScene
argument_list|(
name|rect6
operator|->
name|boundingRect
argument_list|()
operator|.
name|topLeft
argument_list|()
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect4
operator|->
name|mapToScene
argument_list|(
name|rect4
operator|->
name|boundingRect
argument_list|()
operator|.
name|topLeft
argument_list|()
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
comment|//test if rect6 transform is still correct
name|QCOMPARE
argument_list|(
name|rect6
operator|->
name|mapToScene
argument_list|(
name|rect6
operator|->
name|boundingRect
argument_list|()
operator|.
name|topLeft
argument_list|()
argument_list|)
argument_list|,
name|QPointF
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|tabChangesFocus_data
name|void
name|tst_QGraphicsItem
operator|::
name|tabChangesFocus_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"tabChangesFocus"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"tab changes focus"
argument_list|)
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"tab doesn't change focus"
argument_list|)
operator|<<
literal|false
expr_stmt|;
block|}
end_function
begin_function
DECL|function|tabChangesFocus
name|void
name|tst_QGraphicsItem
operator|::
name|tabChangesFocus
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|tabChangesFocus
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsTextItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addText
argument_list|(
literal|"Hello"
argument_list|)
decl_stmt|;
name|item
operator|->
name|setTabChangesFocus
argument_list|(
name|tabChangesFocus
argument_list|)
expr_stmt|;
name|item
operator|->
name|setTextInteractionFlags
argument_list|(
name|Qt
operator|::
name|TextEditorInteraction
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QDial
modifier|*
name|dial1
init|=
operator|new
name|QDial
decl_stmt|;
name|QGraphicsView
modifier|*
name|view
init|=
operator|new
name|QGraphicsView
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QDial
modifier|*
name|dial2
init|=
operator|new
name|QDial
decl_stmt|;
name|QVBoxLayout
modifier|*
name|layout
init|=
operator|new
name|QVBoxLayout
decl_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|dial1
argument_list|)
expr_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|view
argument_list|)
expr_stmt|;
name|layout
operator|->
name|addWidget
argument_list|(
name|dial2
argument_list|)
expr_stmt|;
name|QWidget
name|widget
decl_stmt|;
name|widget
operator|.
name|setLayout
argument_list|(
name|layout
argument_list|)
expr_stmt|;
name|widget
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|widget
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|scene
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|dial1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|15
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|dial1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|15
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyPress
argument_list|(
name|QApplication
operator|::
name|focusWidget
argument_list|()
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|15
argument_list|)
expr_stmt|;
if|if
condition|(
name|tabChangesFocus
condition|)
block|{
name|QTRY_VERIFY
argument_list|(
operator|!
name|view
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|dial2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|QTRY_VERIFY
argument_list|(
name|view
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|toPlainText
argument_list|()
argument_list|,
name|QString
argument_list|(
literal|"\tHello"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|cacheMode
name|void
name|tst_QGraphicsItem
operator|::
name|cacheMode
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|150
argument_list|,
literal|150
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
comment|// Increase the probability of window activation
comment|// not causing another repaint of test items.
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|EventTester
modifier|*
name|tester
init|=
operator|new
name|EventTester
decl_stmt|;
name|EventTester
modifier|*
name|testerChild
init|=
operator|new
name|EventTester
decl_stmt|;
name|testerChild
operator|->
name|setParentItem
argument_list|(
name|tester
argument_list|)
expr_stmt|;
name|EventTester
modifier|*
name|testerChild2
init|=
operator|new
name|EventTester
decl_stmt|;
name|testerChild2
operator|->
name|setParentItem
argument_list|(
name|testerChild
argument_list|)
expr_stmt|;
name|testerChild2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIgnoresTransformations
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|tester
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
operator|++
name|i
control|)
block|{
comment|// No visual change.
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|NoCache
argument_list|)
expr_stmt|;
name|testerChild
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|NoCache
argument_list|)
expr_stmt|;
name|testerChild2
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|NoCache
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|DeviceCoordinateCache
argument_list|)
expr_stmt|;
name|testerChild
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|DeviceCoordinateCache
argument_list|)
expr_stmt|;
name|testerChild2
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|DeviceCoordinateCache
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
block|}
comment|// The first move causes a repaint as the item is painted into its pixmap.
comment|// (Only occurs if the item has previously been painted without cache).
name|tester
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|testerChild
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|testerChild2
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// Consecutive moves should not repaint.
name|tester
operator|->
name|setPos
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|testerChild
operator|->
name|setPos
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|testerChild2
operator|->
name|setPos
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|250
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// Translating does not result in a repaint.
name|tester
operator|->
name|translate
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// Rotating results in a repaint.
name|tester
operator|->
name|rotate
argument_list|(
literal|45
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// Change to ItemCoordinateCache (triggers repaint).
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|ItemCoordinateCache
argument_list|)
expr_stmt|;
comment|// autosize
name|testerChild
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|ItemCoordinateCache
argument_list|)
expr_stmt|;
comment|// autosize
name|testerChild2
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|ItemCoordinateCache
argument_list|)
expr_stmt|;
comment|// autosize
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|// Rotating items with ItemCoordinateCache doesn't cause a repaint.
name|tester
operator|->
name|rotate
argument_list|(
literal|22
argument_list|)
expr_stmt|;
name|testerChild
operator|->
name|rotate
argument_list|(
literal|22
argument_list|)
expr_stmt|;
name|testerChild2
operator|->
name|rotate
argument_list|(
literal|22
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|tester
operator|->
name|resetTransform
argument_list|()
expr_stmt|;
name|testerChild
operator|->
name|resetTransform
argument_list|()
expr_stmt|;
name|testerChild2
operator|->
name|resetTransform
argument_list|()
expr_stmt|;
comment|// Explicit update causes a repaint.
name|tester
operator|->
name|update
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|// Updating outside the item's bounds does not cause a repaint.
name|tester
operator|->
name|update
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|// Resizing an item should cause a repaint of that item. (because of
comment|// autosize).
name|tester
operator|->
name|setGeometry
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|15
argument_list|,
operator|-
literal|15
argument_list|,
literal|30
argument_list|,
literal|30
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|// Set fixed size.
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|ItemCoordinateCache
argument_list|,
name|QSize
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|)
argument_list|)
expr_stmt|;
name|testerChild
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|ItemCoordinateCache
argument_list|,
name|QSize
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|)
argument_list|)
expr_stmt|;
name|testerChild2
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|ItemCoordinateCache
argument_list|,
name|QSize
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|20
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|4
argument_list|)
expr_stmt|;
comment|// Resizing the item should cause a repaint.
name|testerChild
operator|->
name|setGeometry
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|15
argument_list|,
operator|-
literal|15
argument_list|,
literal|30
argument_list|,
literal|30
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|4
argument_list|)
expr_stmt|;
comment|// Scaling the view does not cause a repaint.
name|view
operator|.
name|scale
argument_list|(
literal|0.7
argument_list|,
literal|0.7
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|4
argument_list|)
expr_stmt|;
comment|// Switch to device coordinate cache.
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|DeviceCoordinateCache
argument_list|)
expr_stmt|;
name|testerChild
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|DeviceCoordinateCache
argument_list|)
expr_stmt|;
name|testerChild2
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|DeviceCoordinateCache
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|7
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|// Scaling the view back should cause repaints for two of the items.
name|view
operator|.
name|setTransform
argument_list|(
name|QTransform
argument_list|()
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|// Rotating the base item (perspective) should repaint two items.
name|tester
operator|->
name|setTransform
argument_list|(
name|QTransform
argument_list|()
operator|.
name|rotate
argument_list|(
literal|10
argument_list|,
name|Qt
operator|::
name|XAxis
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|9
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|// Moving the middle item should case a repaint even if it's a move,
comment|// because the parent is rotated with a perspective.
name|testerChild
operator|->
name|setPos
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|11
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|tester
operator|->
name|resetTransform
argument_list|()
expr_stmt|;
comment|// Make a huge item
name|tester
operator|->
name|setGeometry
argument_list|(
name|QRectF
argument_list|(
operator|-
literal|4000
argument_list|,
operator|-
literal|4000
argument_list|,
literal|8000
argument_list|,
literal|8000
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|11
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|// Move the large item - will cause a repaint as the
comment|// cache is clipped.
name|tester
operator|->
name|setPos
argument_list|(
literal|5
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|13
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|11
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|// Hiding and showing should invalidate the cache
name|tester
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|25
argument_list|)
expr_stmt|;
name|tester
operator|->
name|show
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|14
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|testerChild
operator|->
name|repaints
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|testerChild2
operator|->
name|repaints
argument_list|,
literal|6
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|cacheMode2
name|void
name|tst_QGraphicsItem
operator|::
name|cacheMode2
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|150
argument_list|,
literal|150
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
comment|// Increase the probability of window activation
comment|// not causing another repaint of test items.
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|EventTester
modifier|*
name|tester
init|=
operator|new
name|EventTester
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|tester
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Switching from NoCache to NoCache (no repaint)
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|NoCache
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Switching from NoCache to DeviceCoordinateCache (no repaint)
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|DeviceCoordinateCache
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Switching from DeviceCoordinateCache to DeviceCoordinateCache (no repaint)
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|DeviceCoordinateCache
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Switching from DeviceCoordinateCache to NoCache (no repaint)
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|NoCache
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Switching from NoCache to ItemCoordinateCache (repaint)
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|ItemCoordinateCache
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// Switching from ItemCoordinateCache to ItemCoordinateCache (no repaint)
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|ItemCoordinateCache
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// Switching from ItemCoordinateCache to ItemCoordinateCache with different size (repaint)
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|ItemCoordinateCache
argument_list|,
name|QSize
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|// Switching from ItemCoordinateCache to NoCache (repaint)
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|NoCache
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|4
argument_list|)
expr_stmt|;
comment|// Switching from DeviceCoordinateCache to ItemCoordinateCache (repaint)
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|DeviceCoordinateCache
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|ItemCoordinateCache
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|// Switching from ItemCoordinateCache to DeviceCoordinateCache (repaint)
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|DeviceCoordinateCache
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|6
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|updateCachedItemAfterMove
name|void
name|tst_QGraphicsItem
operator|::
name|updateCachedItemAfterMove
parameter_list|()
block|{
comment|// A simple item that uses ItemCoordinateCache
name|EventTester
modifier|*
name|tester
init|=
operator|new
name|EventTester
decl_stmt|;
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|ItemCoordinateCache
argument_list|)
expr_stmt|;
comment|// Add to a scene, show in a view, ensure it's painted and reset its
comment|// repaint counter.
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|tester
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|12
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|tester
operator|->
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|tester
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
comment|// Move the item, should not cause repaints
name|tester
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|12
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Move then update, should cause one repaint
name|tester
operator|->
name|setPos
argument_list|(
literal|20
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|tester
operator|->
name|update
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|12
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Hiding the item doesn't cause a repaint
name|tester
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|12
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Moving a hidden item doesn't cause a repaint
name|tester
operator|->
name|setPos
argument_list|(
literal|30
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|tester
operator|->
name|update
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|12
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|Track
class|class
name|Track
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|Track
name|Track
parameter_list|(
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|)
block|{
name|setAcceptHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
name|widget
init|=
literal|0
parameter_list|)
block|{
name|QGraphicsRectItem
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|widget
argument_list|)
expr_stmt|;
name|painter
operator|->
name|drawText
argument_list|(
name|boundingRect
argument_list|()
argument_list|,
name|Qt
operator|::
name|AlignCenter
argument_list|,
name|QString
argument_list|(
literal|"%1x%2\n%3x%4"
argument_list|)
operator|.
name|arg
argument_list|(
name|p
operator|.
name|x
argument_list|()
argument_list|)
operator|.
name|arg
argument_list|(
name|p
operator|.
name|y
argument_list|()
argument_list|)
operator|.
name|arg
argument_list|(
name|sp
operator|.
name|x
argument_list|()
argument_list|)
operator|.
name|arg
argument_list|(
name|sp
operator|.
name|y
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
protected|protected:
DECL|function|hoverMoveEvent
name|void
name|hoverMoveEvent
parameter_list|(
name|QGraphicsSceneHoverEvent
modifier|*
name|event
parameter_list|)
block|{
name|p
operator|=
name|event
operator|->
name|pos
argument_list|()
expr_stmt|;
name|sp
operator|=
name|event
operator|->
name|widget
argument_list|()
operator|->
name|mapFromGlobal
argument_list|(
name|event
operator|->
name|screenPos
argument_list|()
argument_list|)
expr_stmt|;
name|update
argument_list|()
expr_stmt|;
block|}
private|private:
DECL|member|p
name|QPointF
name|p
decl_stmt|;
DECL|member|sp
name|QPoint
name|sp
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|deviceTransform_data
name|void
name|tst_QGraphicsItem
operator|::
name|deviceTransform_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"untransformable1"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"untransformable2"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"untransformable3"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"rotation1"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"rotation2"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"rotation3"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QTransform
argument_list|>
argument_list|(
literal|"deviceX"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QPointF
argument_list|>
argument_list|(
literal|"mapResult1"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QPointF
argument_list|>
argument_list|(
literal|"mapResult2"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QPointF
argument_list|>
argument_list|(
literal|"mapResult3"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"nil"
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
operator|<<
literal|false
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|<<
name|QPointF
argument_list|(
literal|150
argument_list|,
literal|150
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|250
argument_list|,
literal|250
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|350
argument_list|,
literal|350
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"deviceX rot 90"
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
operator|<<
literal|false
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
operator|<<
name|QPointF
argument_list|(
operator|-
literal|150
argument_list|,
literal|150
argument_list|)
operator|<<
name|QPointF
argument_list|(
operator|-
literal|250
argument_list|,
literal|250
argument_list|)
operator|<<
name|QPointF
argument_list|(
operator|-
literal|350
argument_list|,
literal|350
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"deviceX rot 90 100"
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
operator|<<
literal|false
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
operator|<<
name|QPointF
argument_list|(
operator|-
literal|50
argument_list|,
literal|150
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|250
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|150
argument_list|,
literal|350
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"deviceX rot 90 010"
argument_list|)
operator|<<
literal|false
operator|<<
literal|true
operator|<<
literal|false
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
operator|<<
name|QPointF
argument_list|(
operator|-
literal|150
argument_list|,
literal|150
argument_list|)
operator|<<
name|QPointF
argument_list|(
operator|-
literal|150
argument_list|,
literal|250
argument_list|)
operator|<<
name|QPointF
argument_list|(
operator|-
literal|50
argument_list|,
literal|350
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"deviceX rot 90 001"
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
operator|<<
literal|true
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
operator|<<
name|QPointF
argument_list|(
operator|-
literal|150
argument_list|,
literal|150
argument_list|)
operator|<<
name|QPointF
argument_list|(
operator|-
literal|250
argument_list|,
literal|250
argument_list|)
operator|<<
name|QPointF
argument_list|(
operator|-
literal|250
argument_list|,
literal|350
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"deviceX rot 90 111"
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
operator|<<
literal|true
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
operator|<<
name|QPointF
argument_list|(
operator|-
literal|50
argument_list|,
literal|150
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|250
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|150
argument_list|,
literal|350
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"deviceX rot 90 101"
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
operator|<<
literal|true
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|QTransform
argument_list|()
operator|.
name|rotate
argument_list|(
literal|90
argument_list|)
operator|<<
name|QPointF
argument_list|(
operator|-
literal|50
argument_list|,
literal|150
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|250
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|150
argument_list|,
literal|350
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|deviceTransform
name|void
name|tst_QGraphicsItem
operator|::
name|deviceTransform
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|untransformable1
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|untransformable2
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|untransformable3
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|rotation1
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|rotation2
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|rotation3
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QTransform
argument_list|,
name|deviceX
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QPointF
argument_list|,
name|mapResult1
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QPointF
argument_list|,
name|mapResult2
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QPointF
argument_list|,
name|mapResult3
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|Track
modifier|*
name|rect1
init|=
operator|new
name|Track
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|Track
modifier|*
name|rect2
init|=
operator|new
name|Track
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|Track
modifier|*
name|rect3
init|=
operator|new
name|Track
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|rect2
operator|->
name|setParentItem
argument_list|(
name|rect1
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setParentItem
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|rect1
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|rect1
operator|->
name|rotate
argument_list|(
name|rotation1
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|rotate
argument_list|(
name|rotation2
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|rotate
argument_list|(
name|rotation3
argument_list|)
expr_stmt|;
name|rect1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIgnoresTransformations
argument_list|,
name|untransformable1
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIgnoresTransformations
argument_list|,
name|untransformable2
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIgnoresTransformations
argument_list|,
name|untransformable3
argument_list|)
expr_stmt|;
name|rect1
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1
operator|->
name|deviceTransform
argument_list|(
name|deviceX
argument_list|)
operator|.
name|map
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|,
name|mapResult1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2
operator|->
name|deviceTransform
argument_list|(
name|deviceX
argument_list|)
operator|.
name|map
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|,
name|mapResult2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3
operator|->
name|deviceTransform
argument_list|(
name|deviceX
argument_list|)
operator|.
name|map
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
argument_list|,
name|mapResult3
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|update
name|void
name|tst_QGraphicsItem
operator|::
name|update
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QWidget
name|topLevel
decl_stmt|;
name|MyGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|topLevel
argument_list|)
decl_stmt|;
name|topLevel
operator|.
name|resize
argument_list|(
literal|300
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|topLevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|topLevel
argument_list|)
argument_list|)
expr_stmt|;
name|EventTester
modifier|*
name|item
init|=
operator|new
name|EventTester
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
comment|// Make sure all pending updates are processed.
name|item
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
name|item
operator|->
name|update
argument_list|()
expr_stmt|;
comment|// Item marked as dirty
name|scene
operator|.
name|update
argument_list|()
expr_stmt|;
comment|// Entire scene marked as dirty
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Make sure the dirty state from the previous update is reset so that
comment|// the item don't think it is already dirty and discards this update.
name|item
operator|->
name|update
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|repaints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// Make sure a partial update doesn't cause a full update to be discarded.
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|item
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
name|item
operator|->
name|update
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|update
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QRect
name|itemDeviceBoundingRect
init|=
name|item
operator|->
name|deviceTransform
argument_list|(
name|view
operator|.
name|viewportTransform
argument_list|()
argument_list|)
operator|.
name|mapRect
argument_list|(
name|item
operator|->
name|boundingRect
argument_list|()
argument_list|)
operator|.
name|toAlignedRect
argument_list|()
decl_stmt|;
name|QRegion
name|expectedRegion
init|=
name|itemDeviceBoundingRect
operator|.
name|adjusted
argument_list|(
operator|-
literal|2
argument_list|,
operator|-
literal|2
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
decl_stmt|;
comment|// The entire item's bounding rect (adjusted for antialiasing) should have been painted.
name|QCOMPARE
argument_list|(
name|view
operator|.
name|paintedRegion
argument_list|,
name|expectedRegion
argument_list|)
expr_stmt|;
comment|// Make sure update requests outside the bounding rect are discarded.
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|item
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
name|item
operator|->
name|update
argument_list|(
operator|-
literal|15
argument_list|,
operator|-
literal|15
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
expr_stmt|;
comment|// Item's brect: (-10, -10, 20, 20)
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Make sure the area occupied by an item is repainted when hiding it.
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|item
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
name|item
operator|->
name|update
argument_list|()
expr_stmt|;
comment|// Full update; all sub-sequent update requests are discarded.
name|item
operator|->
name|hide
argument_list|()
expr_stmt|;
comment|// visible set to 0. ignoreVisible must be set to 1; the item won't be processed otherwise.
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// The entire item's bounding rect (adjusted for antialiasing) should have been painted.
name|QCOMPARE
argument_list|(
name|view
operator|.
name|paintedRegion
argument_list|,
name|expectedRegion
argument_list|)
expr_stmt|;
comment|// Make sure item is repainted when shown (after being hidden).
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|item
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
name|item
operator|->
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// The entire item's bounding rect (adjusted for antialiasing) should have been painted.
name|QCOMPARE
argument_list|(
name|view
operator|.
name|paintedRegion
argument_list|,
name|expectedRegion
argument_list|)
expr_stmt|;
name|item
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
name|item
operator|->
name|hide
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
specifier|const
name|QPointF
name|originalPos
init|=
name|item
operator|->
name|pos
argument_list|()
decl_stmt|;
name|item
operator|->
name|setPos
argument_list|(
literal|5000
argument_list|,
literal|5000
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|item
operator|->
name|setPos
argument_list|(
name|originalPos
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|item
operator|->
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// The entire item's bounding rect (adjusted for antialiasing) should have been painted.
name|QCOMPARE
argument_list|(
name|view
operator|.
name|paintedRegion
argument_list|,
name|expectedRegion
argument_list|)
expr_stmt|;
name|QGraphicsViewPrivate
modifier|*
name|viewPrivate
init|=
cast|static_cast
argument_list|<
name|QGraphicsViewPrivate
operator|*
argument_list|>
argument_list|(
name|qt_widget_private
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setPos
argument_list|(
name|originalPos
operator|+
name|QPoint
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|viewPrivate
operator|->
name|updateAll
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|viewPrivate
operator|->
name|fullUpdatePending
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|item
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|item
operator|->
name|setPos
argument_list|(
name|originalPos
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|COMPARE_REGIONS
argument_list|(
name|view
operator|.
name|paintedRegion
argument_list|,
name|expectedRegion
operator|+
name|expectedRegion
operator|.
name|translated
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
comment|// Make sure moving a parent item triggers an update on the children
comment|// (even though the parent itself is outside the viewport).
name|QGraphicsRectItem
modifier|*
name|parent
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|parent
operator|->
name|setPos
argument_list|(
operator|-
literal|400
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|item
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|item
operator|->
name|setPos
argument_list|(
literal|400
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|itemDeviceBoundingRect
operator|=
name|item
operator|->
name|deviceTransform
argument_list|(
name|view
operator|.
name|viewportTransform
argument_list|()
argument_list|)
operator|.
name|mapRect
argument_list|(
name|item
operator|->
name|boundingRect
argument_list|()
argument_list|)
operator|.
name|toAlignedRect
argument_list|()
expr_stmt|;
name|expectedRegion
operator|=
name|itemDeviceBoundingRect
operator|.
name|adjusted
argument_list|(
operator|-
literal|2
argument_list|,
operator|-
literal|2
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|item
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
name|parent
operator|->
name|translate
argument_list|(
operator|-
literal|400
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|repaints
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|paintedRegion
argument_list|,
name|expectedRegion
argument_list|)
expr_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|item
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
name|parent
operator|->
name|translate
argument_list|(
literal|400
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|paintedRegion
argument_list|,
name|expectedRegion
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|paintedRegion
argument_list|,
name|expectedRegion
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setTransformProperties_data
name|void
name|tst_QGraphicsItem
operator|::
name|setTransformProperties_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QPointF
argument_list|>
argument_list|(
literal|"origin"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"rotation"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"scale"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"nothing"
argument_list|)
operator|<<
name|QPointF
argument_list|()
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"rotation"
argument_list|)
operator|<<
name|QPointF
argument_list|()
operator|<<
name|qreal
argument_list|(
literal|42.2
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"rotation dicentred"
argument_list|)
operator|<<
name|QPointF
argument_list|(
name|qreal
argument_list|(
literal|22.3
argument_list|)
argument_list|,
name|qreal
argument_list|(
operator|-
literal|56.2
argument_list|)
argument_list|)
operator|<<
name|qreal
argument_list|(
operator|-
literal|2578.2
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Scale"
argument_list|)
operator|<<
name|QPointF
argument_list|()
operator|<<
name|qreal
argument_list|(
literal|0.0
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|6
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Everything dicentred"
argument_list|)
operator|<<
name|QPointF
argument_list|(
name|qreal
argument_list|(
literal|22.3
argument_list|)
argument_list|,
name|qreal
argument_list|(
operator|-
literal|56.2
argument_list|)
argument_list|)
operator|<<
name|qreal
argument_list|(
operator|-
literal|175
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|196
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|/**  * the normal QCOMPARE doesn't work because it doesn't use qFuzzyCompare  */
end_comment
begin_define
DECL|macro|QCOMPARE_TRANSFORM
define|#
directive|define
name|QCOMPARE_TRANSFORM
parameter_list|(
name|X1
parameter_list|,
name|X2
parameter_list|)
value|QVERIFY(((X1)*(X2).inverted()).isIdentity())
end_define
begin_function
DECL|function|setTransformProperties
name|void
name|tst_QGraphicsItem
operator|::
name|setTransformProperties
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QPointF
argument_list|,
name|origin
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|rotation
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|scale
argument_list|)
expr_stmt|;
name|QTransform
name|result
decl_stmt|;
name|result
operator|.
name|translate
argument_list|(
name|origin
operator|.
name|x
argument_list|()
argument_list|,
name|origin
operator|.
name|y
argument_list|()
argument_list|)
expr_stmt|;
name|result
operator|.
name|rotate
argument_list|(
name|rotation
argument_list|,
name|Qt
operator|::
name|ZAxis
argument_list|)
expr_stmt|;
name|result
operator|.
name|scale
argument_list|(
name|scale
argument_list|,
name|scale
argument_list|)
expr_stmt|;
name|result
operator|.
name|translate
argument_list|(
operator|-
name|origin
operator|.
name|x
argument_list|()
argument_list|,
operator|-
name|origin
operator|.
name|y
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|item
operator|->
name|setRotation
argument_list|(
name|rotation
argument_list|)
expr_stmt|;
name|item
operator|->
name|setScale
argument_list|(
name|scale
argument_list|)
expr_stmt|;
name|item
operator|->
name|setTransformOriginPoint
argument_list|(
name|origin
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|rotation
argument_list|()
argument_list|,
name|rotation
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|scale
argument_list|()
argument_list|,
name|scale
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|transformOriginPoint
argument_list|()
argument_list|,
name|origin
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QTransform
argument_list|()
argument_list|,
name|item
operator|->
name|transform
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|result
argument_list|,
name|item
operator|->
name|sceneTransform
argument_list|()
argument_list|)
expr_stmt|;
comment|//-----------------------------------------------------------------
comment|//Change the rotation Z
name|item
operator|->
name|setRotation
argument_list|(
literal|45
argument_list|)
expr_stmt|;
name|QTransform
name|result2
decl_stmt|;
name|result2
operator|.
name|translate
argument_list|(
name|origin
operator|.
name|x
argument_list|()
argument_list|,
name|origin
operator|.
name|y
argument_list|()
argument_list|)
expr_stmt|;
name|result2
operator|.
name|rotate
argument_list|(
literal|45
argument_list|)
expr_stmt|;
name|result2
operator|.
name|scale
argument_list|(
name|scale
argument_list|,
name|scale
argument_list|)
expr_stmt|;
name|result2
operator|.
name|translate
argument_list|(
operator|-
name|origin
operator|.
name|x
argument_list|()
argument_list|,
operator|-
name|origin
operator|.
name|y
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|rotation
argument_list|()
argument_list|,
literal|45.
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|scale
argument_list|()
argument_list|,
name|scale
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|transformOriginPoint
argument_list|()
argument_list|,
name|origin
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QTransform
argument_list|()
argument_list|,
name|item
operator|->
name|transform
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|result2
argument_list|,
name|item
operator|->
name|sceneTransform
argument_list|()
argument_list|)
expr_stmt|;
comment|//-----------------------------------------------------------------
comment|// calling setTransform() and setPos should change the sceneTransform
name|item
operator|->
name|setTransform
argument_list|(
name|result
argument_list|)
expr_stmt|;
name|item
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
operator|-
literal|150.5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|rotation
argument_list|()
argument_list|,
literal|45.
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|scale
argument_list|()
argument_list|,
name|scale
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|transformOriginPoint
argument_list|()
argument_list|,
name|origin
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|result
argument_list|,
name|item
operator|->
name|transform
argument_list|()
argument_list|)
expr_stmt|;
name|QTransform
name|result3
argument_list|(
name|result
argument_list|)
decl_stmt|;
name|result3
operator|.
name|translate
argument_list|(
name|origin
operator|.
name|x
argument_list|()
argument_list|,
name|origin
operator|.
name|y
argument_list|()
argument_list|)
expr_stmt|;
name|result3
operator|.
name|rotate
argument_list|(
literal|45
argument_list|)
expr_stmt|;
name|result3
operator|.
name|scale
argument_list|(
name|scale
argument_list|,
name|scale
argument_list|)
expr_stmt|;
name|result3
operator|.
name|translate
argument_list|(
operator|-
name|origin
operator|.
name|x
argument_list|()
argument_list|,
operator|-
name|origin
operator|.
name|y
argument_list|()
argument_list|)
expr_stmt|;
name|result3
operator|*=
name|QTransform
operator|::
name|fromTranslate
argument_list|(
literal|100
argument_list|,
operator|-
literal|150.5
argument_list|)
expr_stmt|;
comment|//the pos;
name|QCOMPARE
argument_list|(
name|result3
argument_list|,
name|item
operator|->
name|sceneTransform
argument_list|()
argument_list|)
expr_stmt|;
comment|//-----------------------------------------------------
comment|// setting the propertiees should be the same as setting a transform
block|{
comment|//with center origin on the matrix
name|QGraphicsRectItem
modifier|*
name|item1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|50.2
argument_list|,
operator|-
literal|150
argument_list|,
literal|230.5
argument_list|,
literal|119
argument_list|)
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|item2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|50.2
argument_list|,
operator|-
literal|150
argument_list|,
literal|230.5
argument_list|,
literal|119
argument_list|)
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setPos
argument_list|(
literal|12.3
argument_list|,
operator|-
literal|5
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setPos
argument_list|(
literal|12.3
argument_list|,
operator|-
literal|5
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setRotation
argument_list|(
name|rotation
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setScale
argument_list|(
name|scale
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setTransformOriginPoint
argument_list|(
name|origin
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setTransform
argument_list|(
name|result
argument_list|)
expr_stmt|;
name|QCOMPARE_TRANSFORM
argument_list|(
name|item1
operator|->
name|sceneTransform
argument_list|()
argument_list|,
name|item2
operator|->
name|sceneTransform
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE_TRANSFORM
argument_list|(
name|item1
operator|->
name|itemTransform
argument_list|(
name|item2
argument_list|)
argument_list|,
name|QTransform
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE_TRANSFORM
argument_list|(
name|item2
operator|->
name|itemTransform
argument_list|(
name|item1
argument_list|)
argument_list|,
name|QTransform
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_class
DECL|class|MyStyleOptionTester
class|class
name|MyStyleOptionTester
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|MyStyleOptionTester
name|MyStyleOptionTester
parameter_list|(
specifier|const
name|QRectF
modifier|&
name|rect
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|)
member_init_list|,
name|startTrack
argument_list|(
literal|false
argument_list|)
block|{}
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|option
parameter_list|,
name|QWidget
modifier|*
name|widget
init|=
literal|0
parameter_list|)
block|{
if|if
condition|(
name|startTrack
condition|)
block|{
comment|//Doesn't use the extended style option so the exposed rect is the boundingRect
if|if
condition|(
operator|!
operator|(
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemUsesExtendedStyleOption
operator|)
condition|)
block|{
name|QCOMPARE
argument_list|(
name|option
operator|->
name|exposedRect
argument_list|,
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|option
operator|->
name|matrix
argument_list|,
name|QMatrix
argument_list|()
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|QVERIFY
argument_list|(
name|option
operator|->
name|exposedRect
operator|!=
name|QRect
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|option
operator|->
name|exposedRect
operator|!=
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|option
operator|->
name|matrix
argument_list|,
name|sceneTransform
argument_list|()
operator|.
name|toAffine
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
name|QGraphicsRectItem
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|option
argument_list|,
name|widget
argument_list|)
expr_stmt|;
block|}
DECL|member|startTrack
name|bool
name|startTrack
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|itemUsesExtendedStyleOption
name|void
name|tst_QGraphicsItem
operator|::
name|itemUsesExtendedStyleOption
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|300
argument_list|)
decl_stmt|;
name|QGraphicsPixmapItem
name|item
decl_stmt|;
name|item
operator|.
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemUsesExtendedStyleOption
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|flags
argument_list|()
argument_list|,
name|QGraphicsItem
operator|::
name|GraphicsItemFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemUsesExtendedStyleOption
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|.
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemUsesExtendedStyleOption
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|flags
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|//We now test the content of the style option
name|MyStyleOptionTester
modifier|*
name|rect
init|=
operator|new
name|MyStyleOptionTester
argument_list|(
name|QRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setPos
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QWidget
name|topLevel
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|topLevel
argument_list|)
decl_stmt|;
name|topLevel
operator|.
name|setWindowFlags
argument_list|(
name|Qt
operator|::
name|X11BypassWindowManagerHint
argument_list|)
expr_stmt|;
name|rect
operator|->
name|startTrack
operator|=
literal|false
expr_stmt|;
name|topLevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|topLevel
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|60
argument_list|)
expr_stmt|;
name|rect
operator|->
name|startTrack
operator|=
literal|true
expr_stmt|;
name|rect
operator|->
name|update
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|60
argument_list|)
expr_stmt|;
name|rect
operator|->
name|startTrack
operator|=
literal|false
expr_stmt|;
name|rect
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemUsesExtendedStyleOption
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|(
name|rect
operator|->
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemUsesExtendedStyleOption
operator|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|60
argument_list|)
expr_stmt|;
name|rect
operator|->
name|startTrack
operator|=
literal|true
expr_stmt|;
name|rect
operator|->
name|update
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|60
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemSendsGeometryChanges
name|void
name|tst_QGraphicsItem
operator|::
name|itemSendsGeometryChanges
parameter_list|()
block|{
name|ItemChangeTester
name|item
decl_stmt|;
name|item
operator|.
name|setFlags
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|item
operator|.
name|clear
argument_list|()
expr_stmt|;
name|QTransform
name|x
init|=
name|QTransform
argument_list|()
operator|.
name|rotate
argument_list|(
literal|45
argument_list|)
decl_stmt|;
name|QPointF
name|pos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|qreal
name|o
argument_list|(
literal|0.5
argument_list|)
decl_stmt|;
name|qreal
name|r
argument_list|(
literal|10.0
argument_list|)
decl_stmt|;
name|qreal
name|s
argument_list|(
literal|1.5
argument_list|)
decl_stmt|;
name|QPointF
name|origin
argument_list|(
literal|1.0
argument_list|,
literal|1.0
argument_list|)
decl_stmt|;
name|item
operator|.
name|setTransform
argument_list|(
name|x
argument_list|)
expr_stmt|;
name|item
operator|.
name|setPos
argument_list|(
name|pos
argument_list|)
expr_stmt|;
name|item
operator|.
name|setRotation
argument_list|(
name|r
argument_list|)
expr_stmt|;
name|item
operator|.
name|setScale
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|item
operator|.
name|setTransformOriginPoint
argument_list|(
name|origin
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|transform
argument_list|()
argument_list|,
name|x
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|pos
argument_list|()
argument_list|,
name|pos
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|rotation
argument_list|()
argument_list|,
name|r
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|scale
argument_list|()
argument_list|,
name|s
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|transformOriginPoint
argument_list|()
argument_list|,
name|origin
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|item
operator|.
name|setOpacity
argument_list|(
name|o
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// opacity
name|item
operator|.
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemSendsGeometryChanges
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
comment|// flags
name|item
operator|.
name|setTransform
argument_list|(
name|QTransform
argument_list|()
argument_list|)
expr_stmt|;
name|item
operator|.
name|setPos
argument_list|(
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|// transform + pos
name|QCOMPARE
argument_list|(
name|item
operator|.
name|transform
argument_list|()
argument_list|,
name|QTransform
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|opacity
argument_list|()
argument_list|,
name|o
argument_list|)
expr_stmt|;
name|item
operator|.
name|setRotation
argument_list|(
literal|0.0
argument_list|)
expr_stmt|;
name|item
operator|.
name|setScale
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|item
operator|.
name|setTransformOriginPoint
argument_list|(
literal|0.0
argument_list|,
literal|0.0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|changes
operator|.
name|size
argument_list|()
argument_list|,
literal|14
argument_list|)
expr_stmt|;
comment|// rotation + scale + origin
name|QCOMPARE
argument_list|(
name|item
operator|.
name|rotation
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|0.0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|scale
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|1.0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|transformOriginPoint
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|0.0
argument_list|,
literal|0.0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|.
name|changes
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|::
name|GraphicsItemChange
argument_list|>
argument_list|()
operator|<<
name|QGraphicsItem
operator|::
name|ItemOpacityChange
operator|<<
name|QGraphicsItem
operator|::
name|ItemOpacityHasChanged
operator|<<
name|QGraphicsItem
operator|::
name|ItemFlagsChange
operator|<<
name|QGraphicsItem
operator|::
name|ItemFlagsHaveChanged
operator|<<
name|QGraphicsItem
operator|::
name|ItemTransformChange
operator|<<
name|QGraphicsItem
operator|::
name|ItemTransformHasChanged
operator|<<
name|QGraphicsItem
operator|::
name|ItemPositionChange
operator|<<
name|QGraphicsItem
operator|::
name|ItemPositionHasChanged
operator|<<
name|QGraphicsItem
operator|::
name|ItemRotationChange
operator|<<
name|QGraphicsItem
operator|::
name|ItemRotationHasChanged
operator|<<
name|QGraphicsItem
operator|::
name|ItemScaleChange
operator|<<
name|QGraphicsItem
operator|::
name|ItemScaleHasChanged
operator|<<
name|QGraphicsItem
operator|::
name|ItemTransformOriginPointChange
operator|<<
name|QGraphicsItem
operator|::
name|ItemTransformOriginPointHasChanged
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// Make sure we update moved items correctly.
end_comment
begin_function
DECL|function|moveItem
name|void
name|tst_QGraphicsItem
operator|::
name|moveItem
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|MyGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|EventTester
modifier|*
name|parent
init|=
operator|new
name|EventTester
decl_stmt|;
name|EventTester
modifier|*
name|child
init|=
operator|new
name|EventTester
argument_list|(
name|parent
argument_list|)
decl_stmt|;
name|EventTester
modifier|*
name|grandChild
init|=
operator|new
name|EventTester
argument_list|(
name|child
argument_list|)
decl_stmt|;
DECL|macro|RESET_COUNTERS
define|#
directive|define
name|RESET_COUNTERS
define|\
value|parent->repaints = 0; \     child->repaints = 0; \     grandChild->repaints = 0; \     view.reset();
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|RESET_COUNTERS
comment|// Item's boundingRect:  (-10, -10, 20, 20).
name|QRect
name|parentDeviceBoundingRect
init|=
name|parent
operator|->
name|deviceTransform
argument_list|(
name|view
operator|.
name|viewportTransform
argument_list|()
argument_list|)
operator|.
name|mapRect
argument_list|(
name|parent
operator|->
name|boundingRect
argument_list|()
argument_list|)
operator|.
name|toAlignedRect
argument_list|()
operator|.
name|adjusted
argument_list|(
operator|-
literal|2
argument_list|,
operator|-
literal|2
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
decl_stmt|;
comment|// Adjusted for antialiasing.
name|parent
operator|->
name|setPos
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QRegion
name|expectedParentRegion
init|=
name|parentDeviceBoundingRect
decl_stmt|;
comment|// old position
name|parentDeviceBoundingRect
operator|.
name|translate
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|expectedParentRegion
operator|+=
name|parentDeviceBoundingRect
expr_stmt|;
comment|// new position
name|COMPARE_REGIONS
argument_list|(
name|view
operator|.
name|paintedRegion
argument_list|,
name|expectedParentRegion
argument_list|)
expr_stmt|;
name|RESET_COUNTERS
name|child
operator|->
name|setPos
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
specifier|const
name|QRegion
name|expectedChildRegion
init|=
name|expectedParentRegion
operator|.
name|translated
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|COMPARE_REGIONS
argument_list|(
name|view
operator|.
name|paintedRegion
argument_list|,
name|expectedChildRegion
argument_list|)
expr_stmt|;
name|RESET_COUNTERS
name|grandChild
operator|->
name|setPos
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
specifier|const
name|QRegion
name|expectedGrandChildRegion
init|=
name|expectedParentRegion
operator|.
name|translated
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|)
decl_stmt|;
name|COMPARE_REGIONS
argument_list|(
name|view
operator|.
name|paintedRegion
argument_list|,
name|expectedGrandChildRegion
argument_list|)
expr_stmt|;
name|RESET_COUNTERS
name|parent
operator|->
name|translate
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|expectedParentRegion
operator|.
name|translate
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|expectedParentRegion
operator|+=
name|expectedChildRegion
operator|.
name|translated
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|expectedParentRegion
operator|+=
name|expectedGrandChildRegion
operator|.
name|translated
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|COMPARE_REGIONS
argument_list|(
name|view
operator|.
name|paintedRegion
argument_list|,
name|expectedParentRegion
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|moveLineItem
name|void
name|tst_QGraphicsItem
operator|::
name|moveLineItem
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QGraphicsLineItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsLineItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|item
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|MyGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|QRectF
name|brect
init|=
name|item
operator|->
name|boundingRect
argument_list|()
decl_stmt|;
comment|// Do same adjustments as in qgraphicsscene.cpp
if|if
condition|(
operator|!
name|brect
operator|.
name|width
argument_list|()
condition|)
name|brect
operator|.
name|adjust
argument_list|(
name|qreal
argument_list|(
operator|-
literal|0.00001
argument_list|)
argument_list|,
literal|0
argument_list|,
name|qreal
argument_list|(
literal|0.00001
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|brect
operator|.
name|height
argument_list|()
condition|)
name|brect
operator|.
name|adjust
argument_list|(
literal|0
argument_list|,
name|qreal
argument_list|(
operator|-
literal|0.00001
argument_list|)
argument_list|,
literal|0
argument_list|,
name|qreal
argument_list|(
literal|0.00001
argument_list|)
argument_list|)
expr_stmt|;
specifier|const
name|QRect
name|itemDeviceBoundingRect
init|=
name|item
operator|->
name|deviceTransform
argument_list|(
name|view
operator|.
name|viewportTransform
argument_list|()
argument_list|)
operator|.
name|mapRect
argument_list|(
name|brect
argument_list|)
operator|.
name|toAlignedRect
argument_list|()
decl_stmt|;
name|QRegion
name|expectedRegion
init|=
name|itemDeviceBoundingRect
operator|.
name|adjusted
argument_list|(
operator|-
literal|2
argument_list|,
operator|-
literal|2
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
decl_stmt|;
comment|// antialiasing
comment|// Make sure the calculated region is correct.
name|item
operator|->
name|update
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|paintedRegion
argument_list|,
name|expectedRegion
argument_list|)
expr_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
comment|// Old position: (50, 50)
name|item
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|expectedRegion
operator|+=
name|expectedRegion
operator|.
name|translated
argument_list|(
literal|0
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|view
operator|.
name|paintedRegion
argument_list|,
name|expectedRegion
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sorting_data
name|void
name|tst_QGraphicsItem
operator|::
name|sorting_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"index"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"NoIndex"
argument_list|)
operator|<<
name|int
argument_list|(
name|QGraphicsScene
operator|::
name|NoIndex
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"BspTreeIndex"
argument_list|)
operator|<<
name|int
argument_list|(
name|QGraphicsScene
operator|::
name|BspTreeIndex
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sorting
name|void
name|tst_QGraphicsItem
operator|::
name|sorting
parameter_list|()
block|{
if|if
condition|(
name|qGuiApp
operator|->
name|styleHints
argument_list|()
operator|->
name|showIsFullScreen
argument_list|()
condition|)
name|QSKIP
argument_list|(
literal|"Skipped because Platform is auto maximizing"
argument_list|)
expr_stmt|;
name|_paintedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsItem
modifier|*
name|grid
index|[
literal|100
index|]
index|[
literal|100
index|]
decl_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
literal|100
condition|;
operator|++
name|x
control|)
block|{
for|for
control|(
name|int
name|y
init|=
literal|0
init|;
name|y
operator|<
literal|100
condition|;
operator|++
name|y
control|)
block|{
name|PainterItem
modifier|*
name|item
init|=
operator|new
name|PainterItem
decl_stmt|;
name|item
operator|->
name|setPos
argument_list|(
name|x
operator|*
literal|25
argument_list|,
name|y
operator|*
literal|25
argument_list|)
expr_stmt|;
name|item
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
name|QString
argument_list|(
literal|"%1x%2"
argument_list|)
operator|.
name|arg
argument_list|(
name|x
argument_list|)
operator|.
name|arg
argument_list|(
name|y
argument_list|)
argument_list|)
expr_stmt|;
name|grid
index|[
name|x
index|]
index|[
name|y
index|]
operator|=
name|item
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
block|}
block|}
name|PainterItem
modifier|*
name|item1
init|=
operator|new
name|PainterItem
decl_stmt|;
name|PainterItem
modifier|*
name|item2
init|=
operator|new
name|PainterItem
decl_stmt|;
name|item1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"item1"
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"item2"
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
comment|// Use Qt::Tool as fully decorated windows have a minimum width of 160 on Windows.
name|view
operator|.
name|setWindowFlags
argument_list|(
name|view
operator|.
name|windowFlags
argument_list|()
operator||
name|Qt
operator|::
name|Tool
argument_list|)
expr_stmt|;
name|view
operator|.
name|setResizeAnchor
argument_list|(
name|QGraphicsView
operator|::
name|NoAnchor
argument_list|)
expr_stmt|;
name|view
operator|.
name|setTransformationAnchor
argument_list|(
name|QGraphicsView
operator|::
name|NoAnchor
argument_list|)
expr_stmt|;
name|view
operator|.
name|resize
argument_list|(
literal|120
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|view
operator|.
name|setFrameStyle
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|_paintedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|repaint
argument_list|()
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|Q_OS_MAC
argument_list|)
comment|// There's no difference between repaint and update on the Mac,
comment|// so we have to process events here to make sure we get the event.
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QCOMPARE
argument_list|(
name|_paintedItems
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|grid
index|[
literal|0
index|]
index|[
literal|0
index|]
operator|<<
name|grid
index|[
literal|0
index|]
index|[
literal|1
index|]
operator|<<
name|grid
index|[
literal|0
index|]
index|[
literal|2
index|]
operator|<<
name|grid
index|[
literal|0
index|]
index|[
literal|3
index|]
operator|<<
name|grid
index|[
literal|1
index|]
index|[
literal|0
index|]
operator|<<
name|grid
index|[
literal|1
index|]
index|[
literal|1
index|]
operator|<<
name|grid
index|[
literal|1
index|]
index|[
literal|2
index|]
operator|<<
name|grid
index|[
literal|1
index|]
index|[
literal|3
index|]
operator|<<
name|grid
index|[
literal|2
index|]
index|[
literal|0
index|]
operator|<<
name|grid
index|[
literal|2
index|]
index|[
literal|1
index|]
operator|<<
name|grid
index|[
literal|2
index|]
index|[
literal|2
index|]
operator|<<
name|grid
index|[
literal|2
index|]
index|[
literal|3
index|]
operator|<<
name|grid
index|[
literal|3
index|]
index|[
literal|0
index|]
operator|<<
name|grid
index|[
literal|3
index|]
index|[
literal|1
index|]
operator|<<
name|grid
index|[
literal|3
index|]
index|[
literal|2
index|]
operator|<<
name|grid
index|[
literal|3
index|]
index|[
literal|3
index|]
operator|<<
name|grid
index|[
literal|4
index|]
index|[
literal|0
index|]
operator|<<
name|grid
index|[
literal|4
index|]
index|[
literal|1
index|]
operator|<<
name|grid
index|[
literal|4
index|]
index|[
literal|2
index|]
operator|<<
name|grid
index|[
literal|4
index|]
index|[
literal|3
index|]
operator|<<
name|item1
operator|<<
name|item2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemHasNoContents
name|void
name|tst_QGraphicsItem
operator|::
name|itemHasNoContents
parameter_list|()
block|{
name|PainterItem
modifier|*
name|item1
init|=
operator|new
name|PainterItem
decl_stmt|;
name|PainterItem
modifier|*
name|item2
init|=
operator|new
name|PainterItem
decl_stmt|;
name|item2
operator|->
name|setParentItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemHasNoContents
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
operator|!
name|_paintedItems
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|_paintedItems
operator|.
name|clear
argument_list|()
expr_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|repaint
argument_list|()
expr_stmt|;
ifdef|#
directive|ifdef
name|Q_OS_MAC
comment|// There's no difference between update() and repaint() on the Mac,
comment|// so we have to process events here to make sure we get the event.
name|QTest
operator|::
name|qWait
argument_list|(
literal|10
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QTRY_COMPARE
argument_list|(
name|_paintedItems
argument_list|,
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|item2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|hitTestUntransformableItem
name|void
name|tst_QGraphicsItem
operator|::
name|hitTestUntransformableItem
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
comment|// Confuse the BSP with dummy items.
name|QGraphicsRectItem
modifier|*
name|dummy
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|dummy
operator|->
name|setPos
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|dummy
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|100
condition|;
operator|++
name|i
control|)
block|{
name|QGraphicsItem
modifier|*
name|parent
init|=
name|dummy
decl_stmt|;
name|dummy
operator|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|dummy
operator|->
name|setPos
argument_list|(
operator|-
literal|100
operator|+
name|i
argument_list|,
operator|-
literal|100
operator|+
name|i
argument_list|)
expr_stmt|;
name|dummy
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
block|}
name|QGraphicsRectItem
modifier|*
name|item1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setPos
argument_list|(
operator|-
literal|200
argument_list|,
operator|-
literal|200
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|item2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIgnoresTransformations
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setParentItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setPos
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|item3
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|item3
operator|->
name|setParentItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|item3
operator|->
name|setPos
argument_list|(
literal|80
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|items
init|=
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|(
literal|80
argument_list|,
literal|80
argument_list|)
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|item3
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setItemIndexMethod
argument_list|(
name|QGraphicsScene
operator|::
name|NoIndex
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|items
operator|=
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|(
literal|80
argument_list|,
literal|80
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|item3
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|hitTestGraphicsEffectItem
name|void
name|tst_QGraphicsItem
operator|::
name|hitTestGraphicsEffectItem
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QWidget
name|toplevel
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|toplevel
argument_list|)
decl_stmt|;
name|toplevel
operator|.
name|resize
argument_list|(
literal|300
argument_list|,
literal|300
argument_list|)
expr_stmt|;
name|toplevel
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|toplevel
argument_list|)
argument_list|)
expr_stmt|;
comment|// Confuse the BSP with dummy items.
name|QGraphicsRectItem
modifier|*
name|dummy
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|dummy
operator|->
name|setPos
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|dummy
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|100
condition|;
operator|++
name|i
control|)
block|{
name|QGraphicsItem
modifier|*
name|parent
init|=
name|dummy
decl_stmt|;
name|dummy
operator|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|dummy
operator|->
name|setPos
argument_list|(
operator|-
literal|100
operator|+
name|i
argument_list|,
operator|-
literal|100
operator|+
name|i
argument_list|)
expr_stmt|;
name|dummy
operator|->
name|setParentItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
block|}
specifier|const
name|QRectF
name|itemBoundingRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|EventTester
modifier|*
name|item1
init|=
operator|new
name|EventTester
decl_stmt|;
name|item1
operator|->
name|br
operator|=
name|itemBoundingRect
expr_stmt|;
name|item1
operator|->
name|setPos
argument_list|(
operator|-
literal|200
argument_list|,
operator|-
literal|200
argument_list|)
expr_stmt|;
name|item1
operator|->
name|brush
operator|=
name|Qt
operator|::
name|red
expr_stmt|;
name|EventTester
modifier|*
name|item2
init|=
operator|new
name|EventTester
decl_stmt|;
name|item2
operator|->
name|br
operator|=
name|itemBoundingRect
expr_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIgnoresTransformations
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setParentItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setPos
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|item2
operator|->
name|brush
operator|=
name|Qt
operator|::
name|green
expr_stmt|;
name|EventTester
modifier|*
name|item3
init|=
operator|new
name|EventTester
decl_stmt|;
name|item3
operator|->
name|br
operator|=
name|itemBoundingRect
expr_stmt|;
name|item3
operator|->
name|setParentItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|item3
operator|->
name|setPos
argument_list|(
literal|80
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|item3
operator|->
name|brush
operator|=
name|Qt
operator|::
name|blue
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|item1
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
name|item2
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
name|item3
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
comment|// Apply shadow effect to the entire sub-tree.
name|QGraphicsDropShadowEffect
modifier|*
name|shadow
init|=
operator|new
name|QGraphicsDropShadowEffect
decl_stmt|;
name|shadow
operator|->
name|setOffset
argument_list|(
operator|-
literal|20
argument_list|,
operator|-
literal|20
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setGraphicsEffect
argument_list|(
name|shadow
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|50
argument_list|)
expr_stmt|;
comment|// Make sure all visible items are repainted.
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Make sure an item doesn't respond to a click on its shadow.
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|items
init|=
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|(
literal|75
argument_list|,
literal|75
argument_list|)
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|items
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|items
operator|=
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|(
literal|80
argument_list|,
literal|80
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|item3
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setItemIndexMethod
argument_list|(
name|QGraphicsScene
operator|::
name|NoIndex
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|items
operator|=
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|(
literal|75
argument_list|,
literal|75
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|items
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|items
operator|=
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|(
literal|80
argument_list|,
literal|80
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|items
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|(
name|item3
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|focusProxy
name|void
name|tst_QGraphicsItem
operator|::
name|focusProxy
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|focusProxy
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|item2
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocusProxy
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|focusProxy
argument_list|()
argument_list|,
name|item2
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// Try to make a focus chain loop
name|QString
name|err
decl_stmt|;
name|QTextStream
name|stream
argument_list|(
operator|&
name|err
argument_list|)
decl_stmt|;
name|stream
operator|<<
literal|"QGraphicsItem::setFocusProxy: "
operator|<<
operator|(
name|void
operator|*
operator|)
name|item
operator|<<
literal|" is already in the focus proxy chain"
operator|<<
name|flush
expr_stmt|;
name|QTest
operator|::
name|ignoreMessage
argument_list|(
name|QtWarningMsg
argument_list|,
name|err
operator|.
name|toLatin1
argument_list|()
operator|.
name|constData
argument_list|()
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setFocusProxy
argument_list|(
name|item
argument_list|)
expr_stmt|;
comment|// fails
name|QCOMPARE
argument_list|(
name|item
operator|->
name|focusProxy
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|focusProxy
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// Try to assign self as focus proxy
name|QTest
operator|::
name|ignoreMessage
argument_list|(
name|QtWarningMsg
argument_list|,
literal|"QGraphicsItem::setFocusProxy: cannot assign self as focus proxy"
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocusProxy
argument_list|(
name|item
argument_list|)
expr_stmt|;
comment|// fails
name|QCOMPARE
argument_list|(
name|item
operator|->
name|focusProxy
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|focusProxy
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// Reset the focus proxy
name|item
operator|->
name|setFocusProxy
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|focusProxy
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// Test deletion
name|item
operator|->
name|setFocusProxy
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|focusProxy
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|item2
argument_list|)
expr_stmt|;
operator|delete
name|item2
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|focusProxy
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// Test event delivery
name|item2
operator|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocusProxy
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|item
operator|->
name|clearFocus
argument_list|()
expr_stmt|;
name|EventSpy
name|focusInSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|item
argument_list|,
name|QEvent
operator|::
name|FocusIn
argument_list|)
decl_stmt|;
name|EventSpy
name|focusOutSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|item
argument_list|,
name|QEvent
operator|::
name|FocusOut
argument_list|)
decl_stmt|;
name|EventSpy
name|focusInSpy2
argument_list|(
operator|&
name|scene
argument_list|,
name|item2
argument_list|,
name|QEvent
operator|::
name|FocusIn
argument_list|)
decl_stmt|;
name|EventSpy
name|focusOutSpy2
argument_list|(
operator|&
name|scene
argument_list|,
name|item2
argument_list|,
name|QEvent
operator|::
name|FocusOut
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|focusInSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusOutSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusInSpy2
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusOutSpy2
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusInSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusInSpy2
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|item
operator|->
name|clearFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusOutSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|focusOutSpy2
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Test two items proxying one item.
name|QGraphicsItem
modifier|*
name|item3
init|=
name|scene
operator|.
name|addRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|item3
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|item3
operator|->
name|setFocusProxy
argument_list|(
name|item2
argument_list|)
expr_stmt|;
comment|// item and item3 use item2 as proxy
name|QCOMPARE
argument_list|(
name|item
operator|->
name|focusProxy
argument_list|()
argument_list|,
name|item2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|focusProxy
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|focusProxy
argument_list|()
argument_list|,
name|item2
argument_list|)
expr_stmt|;
operator|delete
name|item2
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|focusProxy
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item3
operator|->
name|focusProxy
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|subFocus
name|void
name|tst_QGraphicsItem
operator|::
name|subFocus
parameter_list|()
block|{
comment|// Construct a text item that's not part of a scene (yet)
comment|// and has no parent. Setting focus on it will not make
comment|// the item gain input focus; that requires a scene. But
comment|// it does set subfocus, indicating that the item wishes
comment|// to gain focus later.
name|QGraphicsTextItem
modifier|*
name|text
init|=
operator|new
name|QGraphicsTextItem
argument_list|(
literal|"Hello"
argument_list|)
decl_stmt|;
name|text
operator|->
name|setTextInteractionFlags
argument_list|(
name|Qt
operator|::
name|TextEditorInteraction
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|text
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|text
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|text
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|text
argument_list|)
expr_stmt|;
comment|// Add a sibling.
name|QGraphicsTextItem
modifier|*
name|text2
init|=
operator|new
name|QGraphicsTextItem
argument_list|(
literal|"Hi"
argument_list|)
decl_stmt|;
name|text2
operator|->
name|setTextInteractionFlags
argument_list|(
name|Qt
operator|::
name|TextEditorInteraction
argument_list|)
expr_stmt|;
name|text2
operator|->
name|setPos
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|)
expr_stmt|;
comment|// Add both items to a scene and check that it's text that
comment|// got input focus.
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|text
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|text2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|text
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|text
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"text"
argument_list|)
expr_stmt|;
name|text2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"text2"
argument_list|)
expr_stmt|;
comment|// Remove text2 and set subfocus on it. Then readd. Reparent it onto the
comment|// other item and see that it gains input focus.
name|scene
operator|.
name|removeItem
argument_list|(
name|text2
argument_list|)
expr_stmt|;
name|text2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|text2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text2
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|text2
argument_list|)
expr_stmt|;
name|text2
operator|->
name|setParentItem
argument_list|(
name|text
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|text2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text2
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|text2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|text
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|text2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// Remove both items from the scene, restore subfocus and
comment|// readd them. Now the subfocus should kick in and give
comment|// text2 focus.
name|scene
operator|.
name|removeItem
argument_list|(
name|text
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text2
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|text2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|text2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text2
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|text2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|text
argument_list|)
expr_stmt|;
comment|// Hiding and showing text should pass focus to text2.
name|QCOMPARE
argument_list|(
name|text
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|text2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|text2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// Subfocus should repropagate to root when reparenting.
name|QGraphicsRectItem
modifier|*
name|rect
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect3
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|rect2
argument_list|)
decl_stmt|;
name|rect3
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|text
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"text"
argument_list|)
expr_stmt|;
name|text2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"text2"
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect"
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect2"
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect3"
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect3
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setParentItem
argument_list|(
name|text2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text2
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect3
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
operator|delete
name|rect2
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|text2
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|focusProxyDeletion
name|void
name|tst_QGraphicsItem
operator|::
name|focusProxyDeletion
parameter_list|()
block|{
name|QGraphicsRectItem
modifier|*
name|rect
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|rect
operator|->
name|setFocusProxy
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|focusProxy
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect2
argument_list|)
expr_stmt|;
operator|delete
name|rect2
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|focusProxy
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|rect2
operator|=
operator|new
name|QGraphicsRectItem
expr_stmt|;
name|rect
operator|->
name|setFocusProxy
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
modifier|*
name|danglingFocusProxyRef
init|=
operator|&
name|rect
operator|->
name|d_ptr
operator|->
name|focusProxy
decl_stmt|;
operator|delete
name|rect
expr_stmt|;
comment|// don't crash
name|QVERIFY
argument_list|(
operator|!
name|rect2
operator|->
name|d_ptr
operator|->
name|focusProxyRefs
operator|.
name|contains
argument_list|(
name|danglingFocusProxyRef
argument_list|)
argument_list|)
expr_stmt|;
name|rect
operator|=
operator|new
name|QGraphicsRectItem
expr_stmt|;
name|rect
operator|->
name|setFocusProxy
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|QGraphicsScene
modifier|*
name|scene
init|=
operator|new
name|QGraphicsScene
decl_stmt|;
name|scene
operator|->
name|addItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|scene
operator|->
name|addItem
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
operator|delete
name|rect2
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|focusProxy
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|rect2
operator|=
operator|new
name|QGraphicsRectItem
expr_stmt|;
name|QTest
operator|::
name|ignoreMessage
argument_list|(
name|QtWarningMsg
argument_list|,
literal|"QGraphicsItem::setFocusProxy: focus proxy must be in same scene"
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setFocusProxy
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|focusProxy
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|->
name|addItem
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setFocusProxy
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|focusProxy
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect2
argument_list|)
expr_stmt|;
operator|delete
name|rect
expr_stmt|;
comment|// don't crash
name|rect
operator|=
operator|new
name|QGraphicsRectItem
expr_stmt|;
name|rect2
operator|=
operator|new
name|QGraphicsRectItem
expr_stmt|;
name|rect
operator|->
name|setFocusProxy
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|->
name|focusProxy
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect2
argument_list|)
expr_stmt|;
name|scene
operator|->
name|addItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|scene
operator|->
name|addItem
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setFocusProxy
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
operator|delete
name|scene
expr_stmt|;
comment|// don't crash
block|}
end_function
begin_function
DECL|function|negativeZStacksBehindParent
name|void
name|tst_QGraphicsItem
operator|::
name|negativeZStacksBehindParent
parameter_list|()
block|{
name|QGraphicsRectItem
name|rect
decl_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|.
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
literal|0.0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
operator|(
name|rect
operator|.
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemNegativeZStacksBehindParent
operator|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
operator|(
name|rect
operator|.
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemStacksBehindParent
operator|)
argument_list|)
expr_stmt|;
name|rect
operator|.
name|setZValue
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect
operator|.
name|zValue
argument_list|()
argument_list|,
name|qreal
argument_list|(
operator|-
literal|1.0
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
operator|(
name|rect
operator|.
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemStacksBehindParent
operator|)
argument_list|)
expr_stmt|;
name|rect
operator|.
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|rect
operator|.
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemNegativeZStacksBehindParent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect
operator|.
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemNegativeZStacksBehindParent
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
operator|(
name|rect
operator|.
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemStacksBehindParent
operator|)
argument_list|)
expr_stmt|;
name|rect
operator|.
name|setZValue
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect
operator|.
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemStacksBehindParent
argument_list|)
expr_stmt|;
name|rect
operator|.
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
operator|(
name|rect
operator|.
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemStacksBehindParent
operator|)
argument_list|)
expr_stmt|;
name|rect
operator|.
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemNegativeZStacksBehindParent
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|rect
operator|.
name|setZValue
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|rect
operator|.
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemNegativeZStacksBehindParent
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect
operator|.
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemStacksBehindParent
argument_list|)
expr_stmt|;
name|rect
operator|.
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemNegativeZStacksBehindParent
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect
operator|.
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemStacksBehindParent
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setGraphicsEffect
name|void
name|tst_QGraphicsItem
operator|::
name|setGraphicsEffect
parameter_list|()
block|{
comment|// Check that we don't have any effect by default.
name|QGraphicsItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|graphicsEffect
argument_list|()
argument_list|)
expr_stmt|;
comment|// SetGet check.
name|QPointer
argument_list|<
name|QGraphicsEffect
argument_list|>
name|blurEffect
init|=
operator|new
name|QGraphicsBlurEffect
decl_stmt|;
name|item
operator|->
name|setGraphicsEffect
argument_list|(
name|blurEffect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|graphicsEffect
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsEffect
operator|*
argument_list|>
argument_list|(
name|blurEffect
argument_list|)
argument_list|)
expr_stmt|;
comment|// Ensure the existing effect is deleted when setting a new one.
name|QPointer
argument_list|<
name|QGraphicsEffect
argument_list|>
name|shadowEffect
init|=
operator|new
name|QGraphicsDropShadowEffect
decl_stmt|;
name|item
operator|->
name|setGraphicsEffect
argument_list|(
name|shadowEffect
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|blurEffect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item
operator|->
name|graphicsEffect
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsEffect
operator|*
argument_list|>
argument_list|(
name|shadowEffect
argument_list|)
argument_list|)
expr_stmt|;
name|blurEffect
operator|=
operator|new
name|QGraphicsBlurEffect
expr_stmt|;
comment|// Ensure the effect is uninstalled when setting it on a new target.
name|QGraphicsItem
modifier|*
name|anotherItem
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|anotherItem
operator|->
name|setGraphicsEffect
argument_list|(
name|blurEffect
argument_list|)
expr_stmt|;
name|item
operator|->
name|setGraphicsEffect
argument_list|(
name|blurEffect
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|anotherItem
operator|->
name|graphicsEffect
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|shadowEffect
argument_list|)
expr_stmt|;
comment|// Ensure the existing effect is deleted when deleting the item.
operator|delete
name|item
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|blurEffect
argument_list|)
expr_stmt|;
operator|delete
name|anotherItem
expr_stmt|;
comment|// Ensure the effect is uninstalled when deleting it
name|item
operator|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|blurEffect
operator|=
operator|new
name|QGraphicsBlurEffect
expr_stmt|;
name|item
operator|->
name|setGraphicsEffect
argument_list|(
name|blurEffect
argument_list|)
expr_stmt|;
operator|delete
name|blurEffect
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|graphicsEffect
argument_list|()
argument_list|)
expr_stmt|;
comment|// Ensure the existing effect is uninstalled and deleted when setting a null effect
name|blurEffect
operator|=
operator|new
name|QGraphicsBlurEffect
expr_stmt|;
name|item
operator|->
name|setGraphicsEffect
argument_list|(
name|blurEffect
argument_list|)
expr_stmt|;
name|item
operator|->
name|setGraphicsEffect
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item
operator|->
name|graphicsEffect
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|blurEffect
argument_list|)
expr_stmt|;
operator|delete
name|item
expr_stmt|;
block|}
end_function
begin_function
DECL|function|panel
name|void
name|tst_QGraphicsItem
operator|::
name|panel
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|panel1
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|panel2
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|panel3
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|panel4
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|notPanel1
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|notPanel2
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|panel1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|panel2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|panel3
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|panel4
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|panel1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|panel2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|panel3
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|panel4
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|notPanel1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|notPanel2
argument_list|)
expr_stmt|;
name|EventSpy
name|spy_activate_panel1
argument_list|(
operator|&
name|scene
argument_list|,
name|panel1
argument_list|,
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|EventSpy
name|spy_deactivate_panel1
argument_list|(
operator|&
name|scene
argument_list|,
name|panel1
argument_list|,
name|QEvent
operator|::
name|WindowDeactivate
argument_list|)
decl_stmt|;
name|EventSpy
name|spy_activate_panel2
argument_list|(
operator|&
name|scene
argument_list|,
name|panel2
argument_list|,
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|EventSpy
name|spy_deactivate_panel2
argument_list|(
operator|&
name|scene
argument_list|,
name|panel2
argument_list|,
name|QEvent
operator|::
name|WindowDeactivate
argument_list|)
decl_stmt|;
name|EventSpy
name|spy_activate_panel3
argument_list|(
operator|&
name|scene
argument_list|,
name|panel3
argument_list|,
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|EventSpy
name|spy_deactivate_panel3
argument_list|(
operator|&
name|scene
argument_list|,
name|panel3
argument_list|,
name|QEvent
operator|::
name|WindowDeactivate
argument_list|)
decl_stmt|;
name|EventSpy
name|spy_activate_panel4
argument_list|(
operator|&
name|scene
argument_list|,
name|panel4
argument_list|,
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|EventSpy
name|spy_deactivate_panel4
argument_list|(
operator|&
name|scene
argument_list|,
name|panel4
argument_list|,
name|QEvent
operator|::
name|WindowDeactivate
argument_list|)
decl_stmt|;
name|EventSpy
name|spy_activate_notPanel1
argument_list|(
operator|&
name|scene
argument_list|,
name|notPanel1
argument_list|,
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|EventSpy
name|spy_deactivate_notPanel1
argument_list|(
operator|&
name|scene
argument_list|,
name|notPanel1
argument_list|,
name|QEvent
operator|::
name|WindowDeactivate
argument_list|)
decl_stmt|;
name|EventSpy
name|spy_activate_notPanel2
argument_list|(
operator|&
name|scene
argument_list|,
name|notPanel1
argument_list|,
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|EventSpy
name|spy_deactivate_notPanel2
argument_list|(
operator|&
name|scene
argument_list|,
name|notPanel1
argument_list|,
name|QEvent
operator|::
name|WindowDeactivate
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|spy_activate_panel1
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_deactivate_panel1
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_activate_panel2
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_deactivate_panel2
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_activate_panel3
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_deactivate_panel3
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_activate_panel4
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_deactivate_panel4
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_activate_notPanel1
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_deactivate_notPanel1
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_activate_notPanel2
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_deactivate_notPanel2
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|activePanel
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QEvent
name|deactivate
argument_list|(
name|QEvent
operator|::
name|WindowDeactivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
comment|// No previous activation, so the scene is active.
name|QVERIFY
argument_list|(
name|scene
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|activePanel
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|panel1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|panel1
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel2
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel3
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel4
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|notPanel1
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|notPanel2
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_deactivate_notPanel1
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_deactivate_notPanel2
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_activate_panel1
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_activate_panel2
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_activate_panel3
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_activate_panel4
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Switch back to scene.
name|scene
operator|.
name|setActivePanel
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|activePanel
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel1
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel2
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel3
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel4
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|notPanel1
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|notPanel2
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_activate_notPanel1
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_activate_notPanel2
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Deactivate the scene
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|deactivate
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|activePanel
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel1
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel2
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel3
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel4
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|notPanel1
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|notPanel2
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_deactivate_notPanel1
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_deactivate_notPanel2
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Reactivate the scene
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|activePanel
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel1
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel2
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel3
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel4
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|notPanel1
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|notPanel2
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_activate_notPanel1
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_activate_notPanel2
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// Switch to panel1
name|scene
operator|.
name|setActivePanel
argument_list|(
name|panel1
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|panel1
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_deactivate_notPanel1
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_deactivate_notPanel2
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_activate_panel1
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// Deactivate the scene
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|deactivate
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel1
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_deactivate_panel1
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// Reactivate the scene
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|panel1
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy_activate_panel1
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|// Deactivate the scene
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|deactivate
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel1
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|activePanel
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setActivePanel
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|// Reactivate the scene
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|panel1
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|panelWithFocusItems
name|void
name|tst_QGraphicsItem
operator|::
name|panelWithFocusItems
parameter_list|()
block|{
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|2
condition|;
operator|++
name|i
control|)
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|bool
name|widget
init|=
operator|(
name|i
operator|==
literal|1
operator|)
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parentPanel
init|=
name|widget
condition|?
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsWidget
else|:
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parentPanelFocusItem
init|=
name|widget
condition|?
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsWidget
else|:
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|parentPanelFocusItemSibling
init|=
name|widget
condition|?
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsWidget
else|:
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|parentPanel
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|parentPanelFocusItem
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|parentPanelFocusItemSibling
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
if|if
condition|(
name|widget
condition|)
block|{
cast|static_cast
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|(
name|parentPanelFocusItem
argument_list|)
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
cast|static_cast
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|(
name|parentPanelFocusItemSibling
argument_list|)
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
block|}
name|parentPanelFocusItem
operator|->
name|setParentItem
argument_list|(
name|parentPanel
argument_list|)
expr_stmt|;
name|parentPanelFocusItemSibling
operator|->
name|setParentItem
argument_list|(
name|parentPanel
argument_list|)
expr_stmt|;
name|parentPanelFocusItem
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parentPanel
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parentPanel
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parentPanelFocusItem
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parentPanel
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|parentPanelFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parentPanelFocusItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|parentPanelFocusItem
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|childPanel
init|=
name|widget
condition|?
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsWidget
else|:
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|childPanelFocusItem
init|=
name|widget
condition|?
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsWidget
else|:
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|grandChildPanelFocusItem
init|=
name|widget
condition|?
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsWidget
else|:
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsItem
modifier|*
name|grandChildPanelFocusItem2
init|=
name|widget
condition|?
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsWidget
else|:
operator|(
name|QGraphicsItem
operator|*
operator|)
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|childPanel
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|childPanelFocusItem
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|grandChildPanelFocusItem
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|grandChildPanelFocusItem2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
if|if
condition|(
name|widget
condition|)
block|{
cast|static_cast
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|(
name|childPanelFocusItem
argument_list|)
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
cast|static_cast
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|(
name|grandChildPanelFocusItem
argument_list|)
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
cast|static_cast
argument_list|<
name|QGraphicsWidget
operator|*
argument_list|>
argument_list|(
name|grandChildPanelFocusItem2
argument_list|)
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
block|}
name|grandChildPanelFocusItem
operator|->
name|setParentItem
argument_list|(
name|childPanelFocusItem
argument_list|)
expr_stmt|;
name|grandChildPanelFocusItem2
operator|->
name|setParentItem
argument_list|(
name|childPanelFocusItem
argument_list|)
expr_stmt|;
name|childPanelFocusItem
operator|->
name|setParentItem
argument_list|(
name|childPanel
argument_list|)
expr_stmt|;
name|grandChildPanelFocusItem
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|grandChildPanelFocusItem
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|childPanel
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|grandChildPanelFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|childPanelFocusItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|grandChildPanelFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChildPanelFocusItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|grandChildPanelFocusItem
argument_list|)
expr_stmt|;
name|childPanel
operator|->
name|setParentItem
argument_list|(
name|parentPanel
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parentPanel
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|parentPanelFocusItem
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parentPanel
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|parentPanelFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parentPanelFocusItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|parentPanelFocusItem
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|childPanel
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|childPanelFocusItem
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandChildPanelFocusItem
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|childPanel
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|grandChildPanelFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|childPanelFocusItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|grandChildPanelFocusItem
argument_list|)
expr_stmt|;
name|childPanel
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|childPanel
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|grandChildPanelFocusItem
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|childPanel
operator|->
name|focusItem
argument_list|()
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parentPanel
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parentPanelFocusItem
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parentPanel
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|parentPanelFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parentPanelFocusItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|parentPanelFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChildPanelFocusItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|grandChildPanelFocusItem
argument_list|)
expr_stmt|;
name|childPanel
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|childPanel
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandChildPanelFocusItem
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|childPanel
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|grandChildPanelFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|childPanelFocusItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|grandChildPanelFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChildPanelFocusItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|grandChildPanelFocusItem
argument_list|)
expr_stmt|;
name|childPanel
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|parentPanel
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|parentPanelFocusItem
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parentPanel
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|parentPanelFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parentPanelFocusItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|parentPanelFocusItem
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|addPanelToActiveScene
name|void
name|tst_QGraphicsItem
operator|::
name|addPanelToActiveScene
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QEvent
name|deactivate
argument_list|(
name|QEvent
operator|::
name|WindowDeactivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|rect
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|activePanel
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|activePanel
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|activate
name|void
name|tst_QGraphicsItem
operator|::
name|activate
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QEvent
name|deactivate
argument_list|(
name|QEvent
operator|::
name|WindowDeactivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
comment|// Non-panel item (active when scene is active).
name|QVERIFY
argument_list|(
name|rect
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|rect2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect3
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|rect3
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
comment|// Test normal activation.
name|QVERIFY
argument_list|(
operator|!
name|rect2
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect2
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
comment|// first panel item is activated
name|scene
operator|.
name|addItem
argument_list|(
name|rect3
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect3
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
comment|// second panel item is _not_ activated
name|rect3
operator|->
name|setActive
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect3
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|rect3
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect3
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
comment|// no panel is active anymore
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|activePanel
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect3
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect3
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
comment|// second panel item is activated
comment|// Test pending activation.
name|scene
operator|.
name|removeItem
argument_list|(
name|rect3
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setActive
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect2
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
comment|// first panel item is activated
name|rect3
operator|->
name|setActive
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect3
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
comment|// not active (yet)
name|scene
operator|.
name|addItem
argument_list|(
name|rect3
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect3
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
comment|// now becomes active
comment|// Test pending deactivation.
name|scene
operator|.
name|removeItem
argument_list|(
name|rect3
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setActive
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect3
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect3
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
comment|// doesn't become active
comment|// Child of panel activation.
name|rect3
operator|->
name|setActive
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect4
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|rect4
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect5
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|rect4
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect6
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|rect5
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|activePanel
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect3
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|rect4
argument_list|)
expr_stmt|;
name|rect6
operator|->
name|setActive
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect4
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect4
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect5
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect6
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|activePanel
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect4
argument_list|)
expr_stmt|;
name|scene
operator|.
name|removeItem
argument_list|(
name|rect4
argument_list|)
expr_stmt|;
comment|// no active panel
name|rect6
operator|->
name|setActive
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect4
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect4
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect5
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect6
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|activePanel
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// Controlling auto-activation when the scene changes activation.
name|rect4
operator|->
name|setActive
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|deactivate
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect4
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|rect4
operator|->
name|setActive
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scene
operator|.
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scene
operator|.
name|activePanel
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rect4
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setActivePanelOnInactiveScene
name|void
name|tst_QGraphicsItem
operator|::
name|setActivePanelOnInactiveScene
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|()
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|panel
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|()
argument_list|)
decl_stmt|;
name|panel
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|EventSpy
name|itemActivateSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|item
argument_list|,
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|EventSpy
name|itemDeactivateSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|item
argument_list|,
name|QEvent
operator|::
name|WindowDeactivate
argument_list|)
decl_stmt|;
name|EventSpy
name|panelActivateSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|panel
argument_list|,
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|EventSpy
name|panelDeactivateSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|panel
argument_list|,
name|QEvent
operator|::
name|WindowDeactivate
argument_list|)
decl_stmt|;
name|EventSpy
name|sceneActivationChangeSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|QEvent
operator|::
name|ActivationChange
argument_list|)
decl_stmt|;
name|scene
operator|.
name|setActivePanel
argument_list|(
name|panel
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|activePanel
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemActivateSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|itemDeactivateSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|panelActivateSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|panelDeactivateSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|sceneActivationChangeSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|activationOnShowHide
name|void
name|tst_QGraphicsItem
operator|::
name|activationOnShowHide
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rootPanel
init|=
name|scene
operator|.
name|addRect
argument_list|(
name|QRectF
argument_list|()
argument_list|)
decl_stmt|;
name|rootPanel
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|rootPanel
operator|->
name|setActive
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|subPanel
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|subPanel
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
comment|// Reparenting onto an active panel auto-activates the child panel.
name|subPanel
operator|->
name|setParentItem
argument_list|(
name|rootPanel
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|subPanel
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rootPanel
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
comment|// Hiding an active child panel will reactivate the parent panel.
name|subPanel
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|rootPanel
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
comment|// Showing a child panel will auto-activate it.
name|subPanel
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|subPanel
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rootPanel
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
comment|// Adding an unrelated panel doesn't affect activation.
name|QGraphicsRectItem
modifier|*
name|otherPanel
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|otherPanel
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|otherPanel
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|subPanel
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
comment|// Showing an unrelated panel doesn't affect activation.
name|otherPanel
operator|->
name|hide
argument_list|()
expr_stmt|;
name|otherPanel
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|subPanel
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
comment|// Add a non-panel item.
name|QGraphicsRectItem
modifier|*
name|otherItem
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|otherItem
argument_list|)
expr_stmt|;
name|otherItem
operator|->
name|setActive
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|otherItem
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
comment|// Reparent a panel onto an active non-panel item.
name|subPanel
operator|->
name|setParentItem
argument_list|(
name|otherItem
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|subPanel
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
comment|// Showing a child panel of a non-panel item will activate it.
name|subPanel
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|subPanel
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|otherItem
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|subPanel
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|subPanel
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
comment|// Hiding a toplevel active panel will pass activation back
comment|// to the non-panel items.
name|rootPanel
operator|->
name|setActive
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|rootPanel
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rootPanel
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|otherItem
operator|->
name|isActive
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|MoveWhileDying
class|class
name|MoveWhileDying
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
DECL|function|MoveWhileDying
name|MoveWhileDying
parameter_list|(
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsRectItem
argument_list|(
name|parent
argument_list|)
block|{ }
DECL|function|~MoveWhileDying
name|~
name|MoveWhileDying
parameter_list|()
block|{
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|c
decl|,
name|childItems
argument_list|()
control|)
block|{
foreach|foreach
control|(
name|QGraphicsItem
modifier|*
name|cc
decl|,
name|c
operator|->
name|childItems
argument_list|()
control|)
block|{
name|cc
operator|->
name|moveBy
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
name|c
operator|->
name|moveBy
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|QGraphicsItem
modifier|*
name|p
init|=
name|parentItem
argument_list|()
condition|)
block|{
name|p
operator|->
name|moveBy
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
block|}
block|}
class|;
end_class
begin_function
DECL|function|moveWhileDeleting
name|void
name|tst_QGraphicsItem
operator|::
name|moveWhileDeleting
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|MoveWhileDying
modifier|*
name|silly
init|=
operator|new
name|MoveWhileDying
argument_list|(
name|rect
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|child
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|silly
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
operator|delete
name|rect
expr_stmt|;
comment|// don't crash!
name|rect
operator|=
operator|new
name|QGraphicsRectItem
expr_stmt|;
name|silly
operator|=
operator|new
name|MoveWhileDying
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|child
operator|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|silly
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
operator|delete
name|rect
expr_stmt|;
name|rect
operator|=
operator|new
name|QGraphicsRectItem
expr_stmt|;
name|rect
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|silly
operator|=
operator|new
name|MoveWhileDying
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|child
operator|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|silly
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|125
argument_list|)
expr_stmt|;
operator|delete
name|rect
expr_stmt|;
name|rect
operator|=
operator|new
name|MoveWhileDying
expr_stmt|;
name|rect
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemClipsChildrenToShape
argument_list|)
expr_stmt|;
name|child
operator|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|rect
argument_list|)
expr_stmt|;
name|silly
operator|=
operator|new
name|MoveWhileDying
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|125
argument_list|)
expr_stmt|;
operator|delete
name|rect
expr_stmt|;
block|}
end_function
begin_class
DECL|class|MyRectItem
class|class
name|MyRectItem
super|:
specifier|public
name|QGraphicsWidget
block|{
name|Q_OBJECT
public|public:
DECL|function|MyRectItem
name|MyRectItem
parameter_list|(
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsWidget
argument_list|(
name|parent
argument_list|)
block|{      }
DECL|function|paint
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
name|painter
operator|->
name|setBrush
argument_list|(
name|brush
argument_list|)
expr_stmt|;
name|painter
operator|->
name|drawRect
argument_list|(
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|function|move
name|void
name|move
parameter_list|()
block|{
name|setPos
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|)
expr_stmt|;
name|topLevel
operator|->
name|collidingItems
argument_list|(
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|)
expr_stmt|;
block|}
public|public:
DECL|member|topLevel
name|QGraphicsItem
modifier|*
name|topLevel
decl_stmt|;
DECL|member|brush
name|QBrush
name|brush
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|ensureDirtySceneTransform
name|void
name|tst_QGraphicsItem
operator|::
name|ensureDirtySceneTransform
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|MyRectItem
modifier|*
name|topLevel
init|=
operator|new
name|MyRectItem
decl_stmt|;
name|topLevel
operator|->
name|setGeometry
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|topLevel
operator|->
name|setPos
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|)
expr_stmt|;
name|topLevel
operator|->
name|brush
operator|=
name|QBrush
argument_list|(
name|QColor
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|topLevel
argument_list|)
expr_stmt|;
name|MyRectItem
modifier|*
name|parent
init|=
operator|new
name|MyRectItem
decl_stmt|;
name|parent
operator|->
name|topLevel
operator|=
name|topLevel
expr_stmt|;
name|parent
operator|->
name|setGeometry
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setPos
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|parent
operator|->
name|brush
operator|=
name|QBrush
argument_list|(
name|QColor
argument_list|(
name|Qt
operator|::
name|magenta
argument_list|)
argument_list|)
expr_stmt|;
name|parent
operator|->
name|setObjectName
argument_list|(
literal|"parent"
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|MyRectItem
modifier|*
name|child
init|=
operator|new
name|MyRectItem
argument_list|(
name|parent
argument_list|)
decl_stmt|;
name|child
operator|->
name|setGeometry
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|80
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|child
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|child
operator|->
name|setObjectName
argument_list|(
literal|"child"
argument_list|)
expr_stmt|;
name|child
operator|->
name|brush
operator|=
name|QBrush
argument_list|(
name|QColor
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
argument_list|)
expr_stmt|;
name|MyRectItem
modifier|*
name|child2
init|=
operator|new
name|MyRectItem
argument_list|(
name|parent
argument_list|)
decl_stmt|;
name|child2
operator|->
name|setGeometry
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|80
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|child2
operator|->
name|setPos
argument_list|(
literal|15
argument_list|,
literal|15
argument_list|)
expr_stmt|;
name|child2
operator|->
name|setObjectName
argument_list|(
literal|"child2"
argument_list|)
expr_stmt|;
name|child2
operator|->
name|brush
operator|=
name|QBrush
argument_list|(
name|QColor
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
argument_list|)
expr_stmt|;
name|MyRectItem
modifier|*
name|child3
init|=
operator|new
name|MyRectItem
argument_list|(
name|parent
argument_list|)
decl_stmt|;
name|child3
operator|->
name|setGeometry
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|80
argument_list|,
literal|80
argument_list|)
expr_stmt|;
name|child3
operator|->
name|setPos
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|child3
operator|->
name|setObjectName
argument_list|(
literal|"child3"
argument_list|)
expr_stmt|;
name|child3
operator|->
name|brush
operator|=
name|QBrush
argument_list|(
name|QColor
argument_list|(
name|Qt
operator|::
name|gray
argument_list|)
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
comment|//We move the parent
name|parent
operator|->
name|move
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
comment|//We check if all items moved
name|QCOMPARE
argument_list|(
name|child
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|15
argument_list|,
literal|15
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child3
operator|->
name|pos
argument_list|()
argument_list|,
name|QPointF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|sceneBoundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|90
argument_list|,
operator|-
literal|90
argument_list|,
literal|80
argument_list|,
literal|80
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|sceneBoundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|85
argument_list|,
operator|-
literal|85
argument_list|,
literal|80
argument_list|,
literal|80
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child3
operator|->
name|sceneBoundingRect
argument_list|()
argument_list|,
name|QRectF
argument_list|(
operator|-
literal|80
argument_list|,
operator|-
literal|80
argument_list|,
literal|80
argument_list|,
literal|80
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|sceneTransform
argument_list|()
argument_list|,
name|QTransform
operator|::
name|fromTranslate
argument_list|(
operator|-
literal|90
argument_list|,
operator|-
literal|90
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|sceneTransform
argument_list|()
argument_list|,
name|QTransform
operator|::
name|fromTranslate
argument_list|(
operator|-
literal|85
argument_list|,
operator|-
literal|85
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child3
operator|->
name|sceneTransform
argument_list|()
argument_list|,
name|QTransform
operator|::
name|fromTranslate
argument_list|(
operator|-
literal|80
argument_list|,
operator|-
literal|80
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|focusScope
name|void
name|tst_QGraphicsItem
operator|::
name|focusScope
parameter_list|()
block|{
comment|// ItemIsFocusScope is an internal feature (for now).
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|scope3
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|scope3
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"scope3"
argument_list|)
expr_stmt|;
name|scope3
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
operator||
name|QGraphicsItem
operator|::
name|ItemIsFocusScope
argument_list|)
expr_stmt|;
name|scope3
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope3
operator|->
name|focusScopeItem
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope3
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|scope3
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|scope2
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|scope2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"scope2"
argument_list|)
expr_stmt|;
name|scope2
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
operator||
name|QGraphicsItem
operator|::
name|ItemIsFocusScope
argument_list|)
expr_stmt|;
name|scope2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope2
operator|->
name|focusScopeItem
argument_list|()
argument_list|)
expr_stmt|;
name|scope3
operator|->
name|setParentItem
argument_list|(
name|scope2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope2
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|scope3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope2
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|scope3
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|scope1
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|scope1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"scope1"
argument_list|)
expr_stmt|;
name|scope1
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
operator||
name|QGraphicsItem
operator|::
name|ItemIsFocusScope
argument_list|)
expr_stmt|;
name|scope1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope1
operator|->
name|focusScopeItem
argument_list|()
argument_list|)
expr_stmt|;
name|scope2
operator|->
name|setParentItem
argument_list|(
name|scope1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope1
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|scope3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope2
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|scope3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope3
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|scope3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope1
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|scope2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope2
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|scope3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope3
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|scope1
argument_list|)
expr_stmt|;
name|QEvent
name|windowActivate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|windowActivate
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope1
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|scope3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope2
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|scope3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope3
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|scope3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope1
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|scope2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope2
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|scope3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope3
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scope3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope3
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scope2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope2
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scope1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope2
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scope2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope3
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scope3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope1
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope1
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scope3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope3
operator|->
name|clearFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scope2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope2
operator|->
name|clearFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scope1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope2
operator|->
name|hide
argument_list|()
expr_stmt|;
name|scope2
operator|->
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scope1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scope2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope3
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scope3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// clearFocus() on a focus scope will remove focus from its children.
name|scope1
operator|->
name|clearFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scope3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope2
operator|->
name|clearFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scope1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scope3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// Focus cleared while a parent doesn't have focus remains cleared
comment|// when the parent regains focus.
name|scope1
operator|->
name|clearFocus
argument_list|()
expr_stmt|;
name|scope3
operator|->
name|clearFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scope2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope3
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope1
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|scope3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect4
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|rect4
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect4"
argument_list|)
expr_stmt|;
name|rect4
operator|->
name|setParentItem
argument_list|(
name|scope3
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect5
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|rect5
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect5"
argument_list|)
expr_stmt|;
name|rect5
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
operator||
name|QGraphicsItem
operator|::
name|ItemIsFocusScope
argument_list|)
expr_stmt|;
name|rect5
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|rect5
operator|->
name|setParentItem
argument_list|(
name|rect4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope3
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect5
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect5
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|rect4
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect5
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope3
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope3
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scope3
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rectA
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|scopeA
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|rectA
argument_list|)
decl_stmt|;
name|scopeA
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
operator||
name|QGraphicsItem
operator|::
name|ItemIsFocusScope
argument_list|)
expr_stmt|;
name|scopeA
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|scopeB
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|scopeA
argument_list|)
decl_stmt|;
name|scopeB
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
operator||
name|QGraphicsItem
operator|::
name|ItemIsFocusScope
argument_list|)
expr_stmt|;
name|scopeB
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rectA
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rect5
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|scopeB
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scopeA
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|scopeB
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scopeB
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|scopeB
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|focusScope2
name|void
name|tst_QGraphicsItem
operator|::
name|focusScope2
parameter_list|()
block|{
name|QGraphicsRectItem
modifier|*
name|child1
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|child1
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|child1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|child1
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|child2
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|child2
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rootFocusScope
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|rootFocusScope
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
operator||
name|QGraphicsItem
operator|::
name|ItemIsFocusScope
argument_list|)
expr_stmt|;
name|rootFocusScope
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rootFocusScope
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rootFocusScope
argument_list|)
expr_stmt|;
name|child1
operator|->
name|setParentItem
argument_list|(
name|rootFocusScope
argument_list|)
expr_stmt|;
name|child2
operator|->
name|setParentItem
argument_list|(
name|rootFocusScope
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rootFocusScope
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|child1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rootFocusScope
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|child1
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|siblingChild1
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|siblingChild1
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|siblingChild1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|siblingChild2
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|siblingChild2
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|siblingFocusScope
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|siblingFocusScope
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
operator||
name|QGraphicsItem
operator|::
name|ItemIsFocusScope
argument_list|)
expr_stmt|;
name|siblingChild1
operator|->
name|setParentItem
argument_list|(
name|siblingFocusScope
argument_list|)
expr_stmt|;
name|siblingChild2
operator|->
name|setParentItem
argument_list|(
name|siblingFocusScope
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|siblingFocusScope
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|siblingChild1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|siblingFocusScope
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsItem
modifier|*
name|root
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|rootFocusScope
operator|->
name|setParentItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|siblingFocusScope
operator|->
name|setParentItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|root
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|child1
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
name|QEvent
name|activate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|activate
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|child1
argument_list|)
expr_stmt|;
comment|// You cannot set focus on a descendant of a focus scope directly;
comment|// this will only change the scope's focus scope item pointer. If
comment|// you want to give true input focus, you must set it directly on
comment|// the scope itself
name|siblingChild2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|siblingChild2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|siblingChild2
operator|->
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|siblingFocusScope
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|siblingChild2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|siblingFocusScope
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// Set focus on the scope; focus is forwarded to the focus scope item.
name|siblingFocusScope
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|siblingChild2
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|siblingChild2
operator|->
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|siblingFocusScope
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|siblingChild2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|siblingFocusScope
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|siblingChild2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|stackBefore
name|void
name|tst_QGraphicsItem
operator|::
name|stackBefore
parameter_list|()
block|{
name|QGraphicsRectItem
name|parent
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|child1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
operator|&
name|parent
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|child2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
operator|&
name|parent
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|child3
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
operator|&
name|parent
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|child4
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
operator|&
name|parent
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|.
name|childItems
argument_list|()
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child1
operator|<<
name|child2
operator|<<
name|child3
operator|<<
name|child4
operator|)
argument_list|)
expr_stmt|;
name|child1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"child1"
argument_list|)
expr_stmt|;
name|child2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"child2"
argument_list|)
expr_stmt|;
name|child3
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"child3"
argument_list|)
expr_stmt|;
name|child4
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"child4"
argument_list|)
expr_stmt|;
comment|// Remove and append
name|child2
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|child2
operator|->
name|setParentItem
argument_list|(
operator|&
name|parent
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parent
operator|.
name|childItems
argument_list|()
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child1
operator|<<
name|child3
operator|<<
name|child4
operator|<<
name|child2
operator|)
argument_list|)
expr_stmt|;
comment|// Move child2 before child1
name|child2
operator|->
name|stackBefore
argument_list|(
name|child1
argument_list|)
expr_stmt|;
comment|// 2134
name|QCOMPARE
argument_list|(
name|parent
operator|.
name|childItems
argument_list|()
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child2
operator|<<
name|child1
operator|<<
name|child3
operator|<<
name|child4
operator|)
argument_list|)
expr_stmt|;
name|child2
operator|->
name|stackBefore
argument_list|(
name|child2
argument_list|)
expr_stmt|;
comment|// 2134
name|QCOMPARE
argument_list|(
name|parent
operator|.
name|childItems
argument_list|()
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child2
operator|<<
name|child1
operator|<<
name|child3
operator|<<
name|child4
operator|)
argument_list|)
expr_stmt|;
name|child1
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|// 2341
name|QCOMPARE
argument_list|(
name|parent
operator|.
name|childItems
argument_list|()
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child2
operator|<<
name|child3
operator|<<
name|child4
operator|<<
name|child1
operator|)
argument_list|)
expr_stmt|;
name|child1
operator|->
name|stackBefore
argument_list|(
name|child2
argument_list|)
expr_stmt|;
comment|// 2341
name|QCOMPARE
argument_list|(
name|parent
operator|.
name|childItems
argument_list|()
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child2
operator|<<
name|child3
operator|<<
name|child4
operator|<<
name|child1
operator|)
argument_list|)
expr_stmt|;
name|child1
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|// 1234
name|QCOMPARE
argument_list|(
name|parent
operator|.
name|childItems
argument_list|()
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child1
operator|<<
name|child2
operator|<<
name|child3
operator|<<
name|child4
operator|)
argument_list|)
expr_stmt|;
name|child4
operator|->
name|stackBefore
argument_list|(
name|child1
argument_list|)
expr_stmt|;
comment|// 4123
name|QCOMPARE
argument_list|(
name|parent
operator|.
name|childItems
argument_list|()
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child4
operator|<<
name|child1
operator|<<
name|child2
operator|<<
name|child3
operator|)
argument_list|)
expr_stmt|;
name|child4
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|// 1234 (4123)
name|QCOMPARE
argument_list|(
name|parent
operator|.
name|childItems
argument_list|()
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child1
operator|<<
name|child2
operator|<<
name|child3
operator|<<
name|child4
operator|)
argument_list|)
expr_stmt|;
name|child3
operator|->
name|stackBefore
argument_list|(
name|child1
argument_list|)
expr_stmt|;
comment|// 3124 (4312)
name|QCOMPARE
argument_list|(
name|parent
operator|.
name|childItems
argument_list|()
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child3
operator|<<
name|child1
operator|<<
name|child2
operator|<<
name|child4
operator|)
argument_list|)
expr_stmt|;
name|child4
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|// 4312
name|QCOMPARE
argument_list|(
name|parent
operator|.
name|childItems
argument_list|()
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child4
operator|<<
name|child3
operator|<<
name|child1
operator|<<
name|child2
operator|)
argument_list|)
expr_stmt|;
comment|// Make them all toplevels
name|child1
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|child2
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|child3
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|child4
operator|->
name|setParentItem
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|child1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|child2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|child3
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|child4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child1
operator|<<
name|child2
operator|<<
name|child3
operator|<<
name|child4
operator|)
argument_list|)
expr_stmt|;
comment|// Remove and append
name|scene
operator|.
name|removeItem
argument_list|(
name|child2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|child2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child1
operator|<<
name|child3
operator|<<
name|child4
operator|<<
name|child2
operator|)
argument_list|)
expr_stmt|;
comment|// Move child2 before child1
name|child2
operator|->
name|stackBefore
argument_list|(
name|child1
argument_list|)
expr_stmt|;
comment|// 2134
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child2
operator|<<
name|child1
operator|<<
name|child3
operator|<<
name|child4
operator|)
argument_list|)
expr_stmt|;
name|child2
operator|->
name|stackBefore
argument_list|(
name|child2
argument_list|)
expr_stmt|;
comment|// 2134
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child2
operator|<<
name|child1
operator|<<
name|child3
operator|<<
name|child4
operator|)
argument_list|)
expr_stmt|;
name|child1
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|// 2341
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child2
operator|<<
name|child3
operator|<<
name|child4
operator|<<
name|child1
operator|)
argument_list|)
expr_stmt|;
name|child1
operator|->
name|stackBefore
argument_list|(
name|child2
argument_list|)
expr_stmt|;
comment|// 2341
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child2
operator|<<
name|child3
operator|<<
name|child4
operator|<<
name|child1
operator|)
argument_list|)
expr_stmt|;
name|child1
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|// 1234
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child1
operator|<<
name|child2
operator|<<
name|child3
operator|<<
name|child4
operator|)
argument_list|)
expr_stmt|;
name|child4
operator|->
name|stackBefore
argument_list|(
name|child1
argument_list|)
expr_stmt|;
comment|// 4123
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child4
operator|<<
name|child1
operator|<<
name|child2
operator|<<
name|child3
operator|)
argument_list|)
expr_stmt|;
name|child4
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|// 1234 (4123)
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child1
operator|<<
name|child2
operator|<<
name|child3
operator|<<
name|child4
operator|)
argument_list|)
expr_stmt|;
name|child3
operator|->
name|stackBefore
argument_list|(
name|child1
argument_list|)
expr_stmt|;
comment|// 3124 (4312)
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child3
operator|<<
name|child1
operator|<<
name|child2
operator|<<
name|child4
operator|)
argument_list|)
expr_stmt|;
name|child4
operator|->
name|setZValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|// 4312
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|items
argument_list|(
name|QPointF
argument_list|(
literal|2
argument_list|,
literal|2
argument_list|)
argument_list|,
name|Qt
operator|::
name|IntersectsItemBoundingRect
argument_list|,
name|Qt
operator|::
name|AscendingOrder
argument_list|)
argument_list|,
operator|(
name|QList
argument_list|<
name|QGraphicsItem
operator|*
argument_list|>
argument_list|()
operator|<<
name|child4
operator|<<
name|child3
operator|<<
name|child1
operator|<<
name|child2
operator|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|QTBUG_4233_updateCachedWithSceneRect
name|void
name|tst_QGraphicsItem
operator|::
name|QTBUG_4233_updateCachedWithSceneRect
parameter_list|()
block|{
name|EventTester
modifier|*
name|tester
init|=
operator|new
name|EventTester
decl_stmt|;
name|tester
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|ItemCoordinateCache
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|tester
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
operator|-
literal|100
argument_list|,
operator|-
literal|100
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
comment|// contains the tester item
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
operator|(
name|QWidget
operator|*
operator|)
operator|&
name|view
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|update
argument_list|()
expr_stmt|;
comment|// triggers "updateAll" optimization
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// in 4.6 only one processEvents is necessary
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|update
argument_list|()
expr_stmt|;
comment|// triggers "updateAll" optimization
name|tester
operator|->
name|update
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|processEvents
argument_list|()
expr_stmt|;
comment|// in 4.6 only one processEvents is necessary
name|QCOMPARE
argument_list|(
name|tester
operator|->
name|repaints
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sceneModality
name|void
name|tst_QGraphicsItem
operator|::
name|sceneModality
parameter_list|()
block|{
comment|// 1) Test mouse events (delivery/propagation/redirection)
comment|// 2) Test hover events (incl. leave on block, enter on unblock)
comment|// 3) Test cursor stuff (incl. unset on block, set on unblock)
comment|// 4) Test clickfocus
comment|// 5) Test grab/ungrab events (possibly ungrab on block, regrab on unblock)
comment|// 6) ### modality for non-panels is unsupported for now
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|bottomItem
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|150
argument_list|,
operator|-
literal|100
argument_list|,
literal|300
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|bottomItem
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|bottomItem
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|yellow
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|leftParent
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|leftParent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|leftParent
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|leftChild
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|leftChild
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|leftChild
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
expr_stmt|;
name|leftChild
operator|->
name|setParentItem
argument_list|(
name|leftParent
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rightParent
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rightParent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|rightParent
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rightChild
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|rightChild
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|rightChild
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|gray
argument_list|)
expr_stmt|;
name|rightChild
operator|->
name|setParentItem
argument_list|(
name|rightParent
argument_list|)
expr_stmt|;
name|leftParent
operator|->
name|setPos
argument_list|(
operator|-
literal|75
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|rightParent
operator|->
name|setPos
argument_list|(
literal|75
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|bottomItem
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"bottomItem"
argument_list|)
expr_stmt|;
name|leftParent
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"leftParent"
argument_list|)
expr_stmt|;
name|leftChild
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"leftChild"
argument_list|)
expr_stmt|;
name|rightParent
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rightParent"
argument_list|)
expr_stmt|;
name|rightChild
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rightChild"
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
name|scene
operator|.
name|itemsBoundingRect
argument_list|()
operator|.
name|adjusted
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|EventSpy2
name|leftParentSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|leftParent
argument_list|)
decl_stmt|;
name|EventSpy2
name|leftChildSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|leftChild
argument_list|)
decl_stmt|;
name|EventSpy2
name|rightParentSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|rightParent
argument_list|)
decl_stmt|;
name|EventSpy2
name|rightChildSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|rightChild
argument_list|)
decl_stmt|;
name|EventSpy2
name|bottomItemSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|bottomItem
argument_list|)
decl_stmt|;
comment|// Scene modality, also test multiple scene modal items
name|leftChild
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|SceneModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// not a panel
comment|// Click inside left child
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|leftChild
operator|->
name|scenePos
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// no grab
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
comment|// Click on left parent, event goes to modal child
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|leftParent
operator|->
name|sceneBoundingRect
argument_list|()
operator|.
name|topLeft
argument_list|()
operator|+
name|QPointF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// no grab
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
comment|// Click on all other items and outside the items
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|rightParent
operator|->
name|sceneBoundingRect
argument_list|()
operator|.
name|topLeft
argument_list|()
operator|+
name|QPointF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|rightChild
operator|->
name|scenePos
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|bottomItem
operator|->
name|scenePos
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|QPointF
argument_list|(
literal|10000
argument_list|,
literal|10000
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// no grab
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|leftChildSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|rightChildSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|leftParentSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|rightParentSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|bottomItemSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|leftChild
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|NonModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Left parent enters scene modality.
name|leftParent
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|SceneModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Click inside left child.
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|leftChild
operator|->
name|scenePos
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// panel stops propagation
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
comment|// Click on left parent.
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|leftParent
operator|->
name|sceneBoundingRect
argument_list|()
operator|.
name|topLeft
argument_list|()
operator|+
name|QPointF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Click on all other items and outside the items
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|rightParent
operator|->
name|sceneBoundingRect
argument_list|()
operator|.
name|topLeft
argument_list|()
operator|+
name|QPointF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|rightChild
operator|->
name|scenePos
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|bottomItem
operator|->
name|scenePos
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|QPointF
argument_list|(
literal|10000
argument_list|,
literal|10000
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|leftChildSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|rightChildSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|leftParentSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|rightParentSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|bottomItemSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
comment|// Now both left parent and child are scene modal. Left parent is blocked.
name|leftChild
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|SceneModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Click inside left child
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|leftChild
operator|->
name|scenePos
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// no grab
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
comment|// Click on left parent, event goes to modal child
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|leftParent
operator|->
name|sceneBoundingRect
argument_list|()
operator|.
name|topLeft
argument_list|()
operator|+
name|QPointF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// no grab
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
comment|// Click on all other items and outside the items
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|rightParent
operator|->
name|sceneBoundingRect
argument_list|()
operator|.
name|topLeft
argument_list|()
operator|+
name|QPointF
argument_list|(
literal|5
argument_list|,
literal|5
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|rightChild
operator|->
name|scenePos
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|bottomItem
operator|->
name|scenePos
argument_list|()
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|QPointF
argument_list|(
literal|10000
argument_list|,
literal|10000
argument_list|)
argument_list|,
name|Qt
operator|::
name|LeftButton
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// no grab
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// blocked
name|leftChildSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|rightChildSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|leftParentSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|rightParentSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|bottomItemSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
comment|// Right child enters scene modality, only left child is blocked.
name|rightChild
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|SceneModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|panelModality
name|void
name|tst_QGraphicsItem
operator|::
name|panelModality
parameter_list|()
block|{
comment|// 1) Test mouse events (delivery/propagation/redirection)
comment|// 2) Test hover events (incl. leave on block, enter on unblock)
comment|// 3) Test cursor stuff (incl. unset on block, set on unblock)
comment|// 4) Test clickfocus
comment|// 5) Test grab/ungrab events (possibly ungrab on block, regrab on unblock)
comment|// 6) ### modality for non-panels is unsupported for now
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|bottomItem
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|150
argument_list|,
operator|-
literal|100
argument_list|,
literal|300
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|bottomItem
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|bottomItem
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|yellow
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|leftParent
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|leftParent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|leftParent
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|leftChild
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|leftChild
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|leftChild
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
expr_stmt|;
name|leftChild
operator|->
name|setParentItem
argument_list|(
name|leftParent
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rightParent
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rightParent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|rightParent
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rightChild
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|rightChild
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|rightChild
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|gray
argument_list|)
expr_stmt|;
name|rightChild
operator|->
name|setParentItem
argument_list|(
name|rightParent
argument_list|)
expr_stmt|;
name|leftParent
operator|->
name|setPos
argument_list|(
operator|-
literal|75
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|rightParent
operator|->
name|setPos
argument_list|(
literal|75
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|bottomItem
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"bottomItem"
argument_list|)
expr_stmt|;
name|leftParent
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"leftParent"
argument_list|)
expr_stmt|;
name|leftChild
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"leftChild"
argument_list|)
expr_stmt|;
name|rightParent
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rightParent"
argument_list|)
expr_stmt|;
name|rightChild
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rightChild"
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
name|scene
operator|.
name|itemsBoundingRect
argument_list|()
operator|.
name|adjusted
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|EventSpy2
name|leftParentSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|leftParent
argument_list|)
decl_stmt|;
name|EventSpy2
name|leftChildSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|leftChild
argument_list|)
decl_stmt|;
name|EventSpy2
name|rightParentSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|rightParent
argument_list|)
decl_stmt|;
name|EventSpy2
name|rightChildSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|rightChild
argument_list|)
decl_stmt|;
name|EventSpy2
name|bottomItemSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|bottomItem
argument_list|)
decl_stmt|;
comment|// Left Child enters panel modality, only left parent is blocked.
name|leftChild
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|PanelModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|leftChild
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|NonModal
argument_list|)
expr_stmt|;
name|leftChildSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|rightChildSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|leftParentSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|rightParentSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|bottomItemSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
comment|// Left parent enter panel modality, nothing is blocked.
name|leftParent
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|PanelModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Left child enters panel modality, left parent is blocked again.
name|leftChild
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|PanelModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|leftChildSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|rightChildSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|leftParentSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|rightParentSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|bottomItemSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|leftChild
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|NonModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|leftParent
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|NonModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|bottomItemSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|leftChildSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|rightChildSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|leftParentSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|rightParentSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|bottomItemSpy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
comment|// Left and right child enter panel modality, both parents are blocked.
name|rightChild
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|PanelModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|leftChild
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|PanelModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|mixedModality
name|void
name|tst_QGraphicsItem
operator|::
name|mixedModality
parameter_list|()
block|{
comment|// 1) Test mouse events (delivery/propagation/redirection)
comment|// 2) Test hover events (incl. leave on block, enter on unblock)
comment|// 3) Test cursor stuff (incl. unset on block, set on unblock)
comment|// 4) Test clickfocus
comment|// 5) Test grab/ungrab events (possibly ungrab on block, regrab on unblock)
comment|// 6) ### modality for non-panels is unsupported for now
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|bottomItem
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|150
argument_list|,
operator|-
literal|100
argument_list|,
literal|300
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|bottomItem
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|bottomItem
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|yellow
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|leftParent
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|leftParent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|leftParent
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|leftChild
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|leftChild
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|leftChild
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|green
argument_list|)
expr_stmt|;
name|leftChild
operator|->
name|setParentItem
argument_list|(
name|leftParent
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rightParent
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rightParent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|rightParent
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rightChild
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|rightChild
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|rightChild
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|gray
argument_list|)
expr_stmt|;
name|rightChild
operator|->
name|setParentItem
argument_list|(
name|rightParent
argument_list|)
expr_stmt|;
name|leftParent
operator|->
name|setPos
argument_list|(
operator|-
literal|75
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|rightParent
operator|->
name|setPos
argument_list|(
literal|75
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|bottomItem
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"bottomItem"
argument_list|)
expr_stmt|;
name|leftParent
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"leftParent"
argument_list|)
expr_stmt|;
name|leftChild
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"leftChild"
argument_list|)
expr_stmt|;
name|rightParent
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rightParent"
argument_list|)
expr_stmt|;
name|rightChild
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rightChild"
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
name|scene
operator|.
name|itemsBoundingRect
argument_list|()
operator|.
name|adjusted
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|EventSpy2
name|leftParentSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|leftParent
argument_list|)
decl_stmt|;
name|EventSpy2
name|leftChildSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|leftChild
argument_list|)
decl_stmt|;
name|EventSpy2
name|rightParentSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|rightParent
argument_list|)
decl_stmt|;
name|EventSpy2
name|rightChildSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|rightChild
argument_list|)
decl_stmt|;
name|EventSpy2
name|bottomItemSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|bottomItem
argument_list|)
decl_stmt|;
comment|// Left Child enters panel modality, only left parent is blocked.
name|leftChild
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|PanelModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Left parent enters scene modality, which blocks everything except the child.
name|leftParent
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|SceneModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Right child enters panel modality (changes nothing).
name|rightChild
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|PanelModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Left parent leaves modality. Right child is unblocked.
name|leftParent
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|NonModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// Right child "upgrades" its modality to scene modal. Left child is blocked.
comment|// Right parent is unaffected.
name|rightChild
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|SceneModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// "downgrade" right child back to panel modal, left child is unblocked
name|rightChild
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|PanelModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightChildSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|leftParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowBlocked
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rightParentSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|WindowUnblocked
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|modality_hover
name|void
name|tst_QGraphicsItem
operator|::
name|modality_hover
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect1
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rect1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|rect1
operator|->
name|setAcceptHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|rect1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect1"
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rect2
operator|->
name|setParentItem
argument_list|(
name|rect1
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setAcceptHoverEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|SceneModal
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect2"
argument_list|)
expr_stmt|;
name|EventSpy2
name|rect1Spy
argument_list|(
operator|&
name|scene
argument_list|,
name|rect1
argument_list|)
decl_stmt|;
name|EventSpy2
name|rect2Spy
argument_list|(
operator|&
name|scene
argument_list|,
name|rect2
argument_list|)
decl_stmt|;
name|sendMouseMove
argument_list|(
operator|&
name|scene
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverEnter
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverMove
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverLeave
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
operator|&
name|scene
argument_list|,
name|QPointF
argument_list|(
literal|75
argument_list|,
literal|75
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverEnter
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverMove
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverLeave
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverEnter
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverMove
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverLeave
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
operator|&
name|scene
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverLeave
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverEnter
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverMove
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverLeave
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|NonModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverEnter
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverMove
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
operator|&
name|scene
argument_list|,
name|QPointF
argument_list|(
literal|75
argument_list|,
literal|75
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverEnter
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverMove
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|SceneModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverLeave
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverEnter
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// changing modality causes a spurious GraphicsSceneHoveMove, even though the mouse didn't
comment|// actually move
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverMove
index|]
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|sendMouseMove
argument_list|(
operator|&
name|scene
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverLeave
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverEnter
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverMove
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverLeave
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|PanelModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverEnter
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverMove
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverLeave
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverEnter
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverMove
index|]
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverLeave
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|NonModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverEnter
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverMove
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverEnter
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverMove
index|]
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneHoverLeave
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|modality_mouseGrabber
name|void
name|tst_QGraphicsItem
operator|::
name|modality_mouseGrabber
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect1
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rect1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|rect1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|rect1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect1"
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rect2
operator|->
name|setParentItem
argument_list|(
name|rect1
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect2"
argument_list|)
expr_stmt|;
name|EventSpy2
name|rect1Spy
argument_list|(
operator|&
name|scene
argument_list|,
name|rect1
argument_list|)
decl_stmt|;
name|EventSpy2
name|rect2Spy
argument_list|(
operator|&
name|scene
argument_list|,
name|rect2
argument_list|)
decl_stmt|;
block|{
comment|// pressing mouse on rect1 starts implicit grab
name|sendMousePress
argument_list|(
operator|&
name|scene
argument_list|,
name|QPoint
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect1
argument_list|)
expr_stmt|;
comment|// grab lost when rect1 is modally shadowed
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|SceneModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// releasing goes nowhere
name|sendMouseRelease
argument_list|(
operator|&
name|scene
argument_list|,
name|QPoint
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// pressing mouse on rect1 starts implicit grab on rect2 (since it is modal)
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|QPoint
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|NonModal
argument_list|)
expr_stmt|;
comment|// pressing mouse on rect1 starts implicit grab
name|sendMousePress
argument_list|(
operator|&
name|scene
argument_list|,
name|QPoint
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect1
argument_list|)
expr_stmt|;
comment|// grab lost to rect2 when rect1 is modally shadowed
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|SceneModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// rect1 does *not* re-grab when rect2 is no longer modal
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|NonModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// release goes nowhere
name|sendMouseRelease
argument_list|(
operator|&
name|scene
argument_list|,
name|QPoint
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
block|{
comment|// repeat the test using PanelModal
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|NonModal
argument_list|)
expr_stmt|;
name|rect1Spy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|rect2Spy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
comment|// pressing mouse on rect1 starts implicit grab
name|sendMousePress
argument_list|(
operator|&
name|scene
argument_list|,
name|QPoint
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect1
argument_list|)
expr_stmt|;
comment|// grab lost when rect1 is modally shadowed
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|PanelModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// releasing goes nowhere
name|sendMouseRelease
argument_list|(
operator|&
name|scene
argument_list|,
name|QPoint
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// pressing mouse on rect1 starts implicit grab on rect2 (since it is modal)
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|QPoint
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|NonModal
argument_list|)
expr_stmt|;
comment|// pressing mouse on rect1 starts implicit grab
name|sendMousePress
argument_list|(
operator|&
name|scene
argument_list|,
name|QPoint
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect1
argument_list|)
expr_stmt|;
comment|// grab lost to rect2 when rect1 is modally shadowed
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|PanelModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// rect1 does *not* re-grab when rect2 is no longer modal
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|NonModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// release goes nowhere
name|sendMouseRelease
argument_list|(
operator|&
name|scene
argument_list|,
name|QPoint
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
block|{
comment|// repeat the PanelModal tests, but this time the mouse events will be on a non-modal item,
comment|// meaning normal grabbing should work
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|NonModal
argument_list|)
expr_stmt|;
name|rect1Spy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|rect2Spy
operator|.
name|counts
operator|.
name|clear
argument_list|()
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect3
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rect3
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setPos
argument_list|(
literal|150
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|rect3
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect3"
argument_list|)
expr_stmt|;
name|EventSpy2
name|rect3Spy
argument_list|(
operator|&
name|scene
argument_list|,
name|rect3
argument_list|)
decl_stmt|;
comment|// pressing mouse on rect3 starts implicit grab
name|sendMousePress
argument_list|(
operator|&
name|scene
argument_list|,
name|QPoint
argument_list|(
literal|150
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMousePress
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect3
argument_list|)
expr_stmt|;
comment|// grab is *not* lost when rect1 is modally shadowed by rect2
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|PanelModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect3
argument_list|)
expr_stmt|;
comment|// releasing goes to rect3
name|sendMouseRelease
argument_list|(
operator|&
name|scene
argument_list|,
name|QPoint
argument_list|(
literal|150
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GraphicsSceneMouseRelease
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|NonModal
argument_list|)
expr_stmt|;
comment|// pressing mouse on rect3 starts implicit grab
name|sendMousePress
argument_list|(
operator|&
name|scene
argument_list|,
name|QPoint
argument_list|(
literal|150
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect3
argument_list|)
expr_stmt|;
comment|// grab is not lost
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|PanelModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect3
argument_list|)
expr_stmt|;
comment|// grab stays on rect3
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|NonModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect3
argument_list|)
expr_stmt|;
comment|// release goes to rect3
name|sendMouseRelease
argument_list|(
operator|&
name|scene
argument_list|,
name|QPoint
argument_list|(
literal|150
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|GrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect3Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|UngrabMouse
index|]
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|mouseGrabberItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|modality_clickFocus
name|void
name|tst_QGraphicsItem
operator|::
name|modality_clickFocus
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect1
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rect1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|rect1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|rect1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect1"
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rect2
operator|->
name|setParentItem
argument_list|(
name|rect1
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect2"
argument_list|)
expr_stmt|;
name|QEvent
name|windowActivateEvent
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|windowActivateEvent
argument_list|)
expr_stmt|;
name|EventSpy2
name|rect1Spy
argument_list|(
operator|&
name|scene
argument_list|,
name|rect1
argument_list|)
decl_stmt|;
name|EventSpy2
name|rect2Spy
argument_list|(
operator|&
name|scene
argument_list|,
name|rect2
argument_list|)
decl_stmt|;
comment|// activate rect1, it should not get focus
name|rect1
operator|->
name|setActive
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
comment|// focus stays unset when rect2 becomes modal
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|SceneModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusIn
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusOut
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusIn
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusOut
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// clicking on rect1 should not set it's focus item
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusIn
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusOut
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusIn
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusOut
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// clicking on rect2 gives it focus
name|rect2
operator|->
name|setActive
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|QPointF
argument_list|(
literal|75
argument_list|,
literal|75
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusIn
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusOut
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusIn
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusOut
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// clicking on rect1 does *not* give it focus
name|rect1
operator|->
name|setActive
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusIn
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusOut
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusIn
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusOut
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// focus doesn't change when leaving modality either
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|NonModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusIn
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusOut
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusIn
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusOut
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// click on rect1, it should get focus now
name|sendMouseClick
argument_list|(
operator|&
name|scene
argument_list|,
name|QPointF
argument_list|(
operator|-
literal|25
argument_list|,
operator|-
literal|25
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusIn
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusOut
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusIn
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect2Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|FocusOut
index|]
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|modality_keyEvents
name|void
name|tst_QGraphicsItem
operator|::
name|modality_keyEvents
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect1
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rect1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|rect1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|rect1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect1"
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect1child
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|rect1child
operator|->
name|setParentItem
argument_list|(
name|rect1
argument_list|)
expr_stmt|;
name|rect1child
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|rect1child
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect1child1"
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
decl_stmt|;
name|rect2
operator|->
name|setParentItem
argument_list|(
name|rect1
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsPanel
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|rect2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect2"
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2child
init|=
name|scene
operator|.
name|addRect
argument_list|(
operator|-
literal|10
argument_list|,
operator|-
literal|10
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|rect2child
operator|->
name|setParentItem
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|rect2child
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|rect2child
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect2child1"
argument_list|)
expr_stmt|;
name|QEvent
name|windowActivateEvent
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|windowActivateEvent
argument_list|)
expr_stmt|;
name|EventSpy2
name|rect1Spy
argument_list|(
operator|&
name|scene
argument_list|,
name|rect1
argument_list|)
decl_stmt|;
name|EventSpy2
name|rect1childSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|rect1child
argument_list|)
decl_stmt|;
name|EventSpy2
name|rect2Spy
argument_list|(
operator|&
name|scene
argument_list|,
name|rect2
argument_list|)
decl_stmt|;
name|EventSpy2
name|rect2childSpy
argument_list|(
operator|&
name|scene
argument_list|,
name|rect2child
argument_list|)
decl_stmt|;
comment|// activate rect1 and give it rect1child focus
name|rect1
operator|->
name|setActive
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|rect1child
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect1child
argument_list|)
expr_stmt|;
comment|// focus stays on rect1child when rect2 becomes modal
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|SceneModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect1child
argument_list|)
expr_stmt|;
comment|// but key events to rect1child should be neither delivered nor propagated
name|sendKeyClick
argument_list|(
operator|&
name|scene
argument_list|,
name|Qt
operator|::
name|Key_A
argument_list|)
expr_stmt|;
name|sendKeyClick
argument_list|(
operator|&
name|scene
argument_list|,
name|Qt
operator|::
name|Key_S
argument_list|)
expr_stmt|;
name|sendKeyClick
argument_list|(
operator|&
name|scene
argument_list|,
name|Qt
operator|::
name|Key_D
argument_list|)
expr_stmt|;
name|sendKeyClick
argument_list|(
operator|&
name|scene
argument_list|,
name|Qt
operator|::
name|Key_F
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1childSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|KeyPress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1childSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|KeyRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|KeyPress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|KeyRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|// change to panel modality, rect1child1 keeps focus
name|rect2
operator|->
name|setPanelModality
argument_list|(
name|QGraphicsItem
operator|::
name|PanelModal
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|rect1child
argument_list|)
expr_stmt|;
comment|// still no key events
name|sendKeyClick
argument_list|(
operator|&
name|scene
argument_list|,
name|Qt
operator|::
name|Key_J
argument_list|)
expr_stmt|;
name|sendKeyClick
argument_list|(
operator|&
name|scene
argument_list|,
name|Qt
operator|::
name|Key_K
argument_list|)
expr_stmt|;
name|sendKeyClick
argument_list|(
operator|&
name|scene
argument_list|,
name|Qt
operator|::
name|Key_L
argument_list|)
expr_stmt|;
name|sendKeyClick
argument_list|(
operator|&
name|scene
argument_list|,
name|Qt
operator|::
name|Key_Semicolon
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1childSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|KeyPress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1childSpy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|KeyRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|KeyPress
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rect1Spy
operator|.
name|counts
index|[
name|QEvent
operator|::
name|KeyRelease
index|]
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemIsInFront
name|void
name|tst_QGraphicsItem
operator|::
name|itemIsInFront
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect1
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|rect1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect1"
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect1
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect1child1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|rect1
argument_list|)
decl_stmt|;
name|rect1child1
operator|->
name|setZValue
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|rect1child1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect1child1"
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect1child2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|rect1
argument_list|)
decl_stmt|;
name|rect1child2
operator|->
name|setParentItem
argument_list|(
name|rect1
argument_list|)
expr_stmt|;
name|rect1child2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect1child2"
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect1child1_1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|rect1child1
argument_list|)
decl_stmt|;
name|rect1child1_1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect1child1_1"
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect1child1_2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|rect1child1
argument_list|)
decl_stmt|;
name|rect1child1_2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemStacksBehindParent
argument_list|)
expr_stmt|;
name|rect1child1_2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect1child1_2"
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|rect2
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect2"
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|rect2
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rect2child1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|rect2
argument_list|)
decl_stmt|;
name|rect2child1
operator|->
name|setData
argument_list|(
literal|0
argument_list|,
literal|"rect2child1"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qt_closestItemFirst
argument_list|(
name|rect1
argument_list|,
name|rect1
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qt_closestItemFirst
argument_list|(
name|rect1
argument_list|,
name|rect2
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qt_closestItemFirst
argument_list|(
name|rect1child1
argument_list|,
name|rect2child1
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qt_closestItemFirst
argument_list|(
name|rect1child1
argument_list|,
name|rect1child2
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qt_closestItemFirst
argument_list|(
name|rect1child1_1
argument_list|,
name|rect1child2
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qt_closestItemFirst
argument_list|(
name|rect1child1_1
argument_list|,
name|rect1child1
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qt_closestItemFirst
argument_list|(
name|rect1child1_2
argument_list|,
name|rect1child2
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qt_closestItemFirst
argument_list|(
name|rect1child1_2
argument_list|,
name|rect1child1
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qt_closestItemFirst
argument_list|(
name|rect1child1_2
argument_list|,
name|rect1
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qt_closestItemFirst
argument_list|(
name|rect1child1_2
argument_list|,
name|rect2
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qt_closestItemFirst
argument_list|(
name|rect1child1_2
argument_list|,
name|rect2child1
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|ScenePosChangeTester
class|class
name|ScenePosChangeTester
super|:
specifier|public
name|ItemChangeTester
block|{
public|public:
DECL|function|ScenePosChangeTester
name|ScenePosChangeTester
parameter_list|()
block|{ }
DECL|function|ScenePosChangeTester
name|ScenePosChangeTester
parameter_list|(
name|QGraphicsItem
modifier|*
name|parent
parameter_list|)
member_init_list|:
name|ItemChangeTester
argument_list|(
name|parent
argument_list|)
block|{ }
block|}
class|;
end_class
begin_function
DECL|function|scenePosChange
name|void
name|tst_QGraphicsItem
operator|::
name|scenePosChange
parameter_list|()
block|{
name|ScenePosChangeTester
modifier|*
name|root
init|=
operator|new
name|ScenePosChangeTester
decl_stmt|;
name|ScenePosChangeTester
modifier|*
name|child1
init|=
operator|new
name|ScenePosChangeTester
argument_list|(
name|root
argument_list|)
decl_stmt|;
name|ScenePosChangeTester
modifier|*
name|grandChild1
init|=
operator|new
name|ScenePosChangeTester
argument_list|(
name|child1
argument_list|)
decl_stmt|;
name|ScenePosChangeTester
modifier|*
name|child2
init|=
operator|new
name|ScenePosChangeTester
argument_list|(
name|root
argument_list|)
decl_stmt|;
name|ScenePosChangeTester
modifier|*
name|grandChild2
init|=
operator|new
name|ScenePosChangeTester
argument_list|(
name|child2
argument_list|)
decl_stmt|;
name|child1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemSendsScenePositionChanges
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|grandChild2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemSendsScenePositionChanges
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|child1
operator|->
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemSendsScenePositionChanges
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|grandChild2
operator|->
name|flags
argument_list|()
operator|&
name|QGraphicsItem
operator|::
name|ItemSendsScenePositionChanges
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|root
argument_list|)
expr_stmt|;
comment|// ignore uninteresting changes
name|child1
operator|->
name|clear
argument_list|()
expr_stmt|;
name|child2
operator|->
name|clear
argument_list|()
expr_stmt|;
name|grandChild1
operator|->
name|clear
argument_list|()
expr_stmt|;
name|grandChild2
operator|->
name|clear
argument_list|()
expr_stmt|;
comment|// move whole tree
name|root
operator|->
name|moveBy
argument_list|(
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild1
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild2
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// move subtree
name|child2
operator|->
name|moveBy
argument_list|(
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild1
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild2
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|// reparent
name|grandChild2
operator|->
name|setParentItem
argument_list|(
name|child1
argument_list|)
expr_stmt|;
name|child1
operator|->
name|moveBy
argument_list|(
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild1
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild2
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|// change flags
name|grandChild1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemSendsScenePositionChanges
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|grandChild2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemSendsScenePositionChanges
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|QCoreApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
comment|// QGraphicsScenePrivate::_q_updateScenePosDescendants()
name|child1
operator|->
name|moveBy
argument_list|(
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild1
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild2
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|3
argument_list|)
expr_stmt|;
comment|// remove
name|scene
operator|.
name|removeItem
argument_list|(
name|grandChild1
argument_list|)
expr_stmt|;
operator|delete
name|grandChild2
expr_stmt|;
name|grandChild2
operator|=
literal|0
expr_stmt|;
name|QCoreApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
comment|// QGraphicsScenePrivate::_q_updateScenePosDescendants()
name|root
operator|->
name|moveBy
argument_list|(
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild1
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|root
operator|->
name|setX
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild1
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|root
operator|->
name|setY
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child1
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|grandChild1
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child2
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|textItem_shortcuts
name|void
name|tst_QGraphicsItem
operator|::
name|textItem_shortcuts
parameter_list|()
block|{
name|QWidget
name|w
decl_stmt|;
name|QVBoxLayout
name|l
decl_stmt|;
name|w
operator|.
name|setLayout
argument_list|(
operator|&
name|l
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|l
operator|.
name|addWidget
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QPushButton
name|b
argument_list|(
literal|"Push Me"
argument_list|)
decl_stmt|;
name|l
operator|.
name|addWidget
argument_list|(
operator|&
name|b
argument_list|)
expr_stmt|;
name|QGraphicsTextItem
modifier|*
name|item
init|=
name|scene
operator|.
name|addText
argument_list|(
literal|"Troll Text"
argument_list|)
decl_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|item
operator|->
name|setTextInteractionFlags
argument_list|(
name|Qt
operator|::
name|TextEditorInteraction
argument_list|)
expr_stmt|;
name|w
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|w
argument_list|)
argument_list|)
expr_stmt|;
name|item
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|item
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|textCursor
argument_list|()
operator|.
name|selectedText
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
comment|// Shortcut should work (select all)
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|view
argument_list|,
name|Qt
operator|::
name|Key_A
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item
operator|->
name|textCursor
argument_list|()
operator|.
name|selectedText
argument_list|()
argument_list|,
name|item
operator|->
name|toPlainText
argument_list|()
argument_list|)
expr_stmt|;
name|QTextCursor
name|tc
init|=
name|item
operator|->
name|textCursor
argument_list|()
decl_stmt|;
name|tc
operator|.
name|clearSelection
argument_list|()
expr_stmt|;
name|item
operator|->
name|setTextCursor
argument_list|(
name|tc
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item
operator|->
name|textCursor
argument_list|()
operator|.
name|selectedText
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
comment|// Shortcut should also work if the text item has the focus and another widget
comment|// has the same shortcut.
name|b
operator|.
name|setShortcut
argument_list|(
name|QKeySequence
argument_list|(
literal|"CTRL+A"
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|view
argument_list|,
name|Qt
operator|::
name|Key_A
argument_list|,
name|Qt
operator|::
name|ControlModifier
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item
operator|->
name|textCursor
argument_list|()
operator|.
name|selectedText
argument_list|()
argument_list|,
name|item
operator|->
name|toPlainText
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|scroll
name|void
name|tst_QGraphicsItem
operator|::
name|scroll
parameter_list|()
block|{
comment|// Create two overlapping rectangles in the scene:
comment|// +-------+
comment|// |       |<- item1
comment|// |   +-------+
comment|// |   |       |
comment|// +---|       |<- item2
comment|//     |       |
comment|//     +-------+
name|EventTester
modifier|*
name|item1
init|=
operator|new
name|EventTester
decl_stmt|;
name|item1
operator|->
name|br
operator|=
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|item1
operator|->
name|brush
operator|=
name|Qt
operator|::
name|red
expr_stmt|;
name|item1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemUsesExtendedStyleOption
argument_list|)
expr_stmt|;
name|EventTester
modifier|*
name|item2
init|=
operator|new
name|EventTester
decl_stmt|;
name|item2
operator|->
name|br
operator|=
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|item2
operator|->
name|brush
operator|=
name|Qt
operator|::
name|blue
expr_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemUsesExtendedStyleOption
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setPos
argument_list|(
literal|100
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|300
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|MyGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setFrameStyle
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|item1
operator|->
name|reset
argument_list|()
expr_stmt|;
name|item2
operator|->
name|reset
argument_list|()
expr_stmt|;
specifier|const
name|QRectF
name|item1BoundingRect
init|=
name|item1
operator|->
name|boundingRect
argument_list|()
decl_stmt|;
specifier|const
name|QRectF
name|item2BoundingRect
init|=
name|item2
operator|->
name|boundingRect
argument_list|()
decl_stmt|;
comment|// Scroll item1:
comment|// Item1 should get full exposure
comment|// Item2 should get exposure for the part that overlaps item1.
name|item1
operator|->
name|scroll
argument_list|(
literal|0
argument_list|,
operator|-
literal|10
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|lastExposedRect
argument_list|,
name|item1BoundingRect
argument_list|)
expr_stmt|;
name|QRectF
name|expectedItem2Expose
init|=
name|item2BoundingRect
decl_stmt|;
comment|// NB! Adjusted by 2 pixels for antialiasing
name|expectedItem2Expose
operator|&=
name|item1
operator|->
name|mapRectToItem
argument_list|(
name|item2
argument_list|,
name|item1BoundingRect
operator|.
name|adjusted
argument_list|(
operator|-
literal|2
argument_list|,
operator|-
literal|2
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|lastExposedRect
argument_list|,
name|expectedItem2Expose
argument_list|)
expr_stmt|;
comment|// Enable ItemCoordinateCache on item1.
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|item1
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|ItemCoordinateCache
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|item1
operator|->
name|reset
argument_list|()
expr_stmt|;
name|item2
operator|->
name|reset
argument_list|()
expr_stmt|;
comment|// Scroll item1:
comment|// Item1 should only get expose for the newly exposed area (accelerated scroll).
comment|// Item2 should get exposure for the part that overlaps item1.
name|item1
operator|->
name|scroll
argument_list|(
literal|0
argument_list|,
operator|-
literal|10
argument_list|,
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item1
operator|->
name|lastExposedRect
argument_list|,
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|140
argument_list|,
literal|100
argument_list|,
literal|10
argument_list|)
argument_list|)
expr_stmt|;
name|expectedItem2Expose
operator|=
name|item2BoundingRect
expr_stmt|;
comment|// NB! Adjusted by 2 pixels for antialiasing
name|expectedItem2Expose
operator|&=
name|item1
operator|->
name|mapRectToItem
argument_list|(
name|item2
argument_list|,
name|QRectF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
operator|.
name|adjusted
argument_list|(
operator|-
literal|2
argument_list|,
operator|-
literal|2
argument_list|,
literal|2
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|item2
operator|->
name|lastExposedRect
argument_list|,
name|expectedItem2Expose
argument_list|)
expr_stmt|;
block|}
end_function
begin_expr_stmt
DECL|variable|GraphicsItemFlag
name|Q_DECLARE_METATYPE
argument_list|(
name|QGraphicsItem
operator|::
name|GraphicsItemFlag
argument_list|)
expr_stmt|;
end_expr_stmt
begin_function
DECL|function|focusHandling_data
name|void
name|tst_QGraphicsItem
operator|::
name|focusHandling_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QGraphicsItem
operator|::
name|GraphicsItemFlag
argument_list|>
argument_list|(
literal|"focusFlag"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"useStickyFocus"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"expectedFocusItem"
argument_list|)
expr_stmt|;
comment|// 0: none, 1: focusableUnder, 2: itemWithFocus
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Focus goes through."
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|::
name|GraphicsItemFlag
argument_list|>
argument_list|(
literal|0x0
argument_list|)
operator|<<
literal|false
operator|<<
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Focus goes through, even with sticky scene."
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|QGraphicsItem
operator|::
name|GraphicsItemFlag
argument_list|>
argument_list|(
literal|0x0
argument_list|)
operator|<<
literal|true
operator|<<
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"With ItemStopsClickFocusPropagation, we cannot focus the item beneath the flagged one (but can still focus-out)."
argument_list|)
operator|<<
name|QGraphicsItem
operator|::
name|ItemStopsClickFocusPropagation
operator|<<
literal|false
operator|<<
literal|0
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"With ItemStopsClickFocusPropagation, we cannot focus the item beneath the flagged one (and cannot focus-out if scene is sticky)."
argument_list|)
operator|<<
name|QGraphicsItem
operator|::
name|ItemStopsClickFocusPropagation
operator|<<
literal|true
operator|<<
literal|2
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"With ItemStopsFocusHandling, focus cannot be changed by presses."
argument_list|)
operator|<<
name|QGraphicsItem
operator|::
name|ItemStopsFocusHandling
operator|<<
literal|false
operator|<<
literal|2
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"With ItemStopsFocusHandling, focus cannot be changed by presses (even if scene is sticky)."
argument_list|)
operator|<<
name|QGraphicsItem
operator|::
name|ItemStopsFocusHandling
operator|<<
literal|true
operator|<<
literal|2
expr_stmt|;
block|}
end_function
begin_function
DECL|function|focusHandling
name|void
name|tst_QGraphicsItem
operator|::
name|focusHandling
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QGraphicsItem
operator|::
name|GraphicsItemFlag
argument_list|,
name|focusFlag
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|useStickyFocus
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|expectedFocusItem
argument_list|)
expr_stmt|;
class|class
name|MyItem
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
name|MyItem
parameter_list|()
member_init_list|:
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
block|{}
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
parameter_list|,
name|QWidget
modifier|*
parameter_list|)
block|{
name|painter
operator|->
name|fillRect
argument_list|(
name|boundingRect
argument_list|()
argument_list|,
name|hasFocus
argument_list|()
condition|?
name|QBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
else|:
name|brush
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
class|;
name|QGraphicsRectItem
modifier|*
name|noFocusOnTop
init|=
operator|new
name|MyItem
decl_stmt|;
name|noFocusOnTop
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|noFocusOnTop
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|yellow
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|focusableUnder
init|=
operator|new
name|MyItem
decl_stmt|;
name|focusableUnder
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|blue
argument_list|)
expr_stmt|;
name|focusableUnder
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|focusableUnder
operator|->
name|setPos
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|itemWithFocus
init|=
operator|new
name|MyItem
decl_stmt|;
name|itemWithFocus
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|black
argument_list|)
expr_stmt|;
name|itemWithFocus
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|itemWithFocus
operator|->
name|setPos
argument_list|(
literal|250
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
argument_list|(
operator|-
literal|50
argument_list|,
operator|-
literal|50
argument_list|,
literal|400
argument_list|,
literal|400
argument_list|)
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|noFocusOnTop
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|focusableUnder
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|itemWithFocus
argument_list|)
expr_stmt|;
name|scene
operator|.
name|setStickyFocus
argument_list|(
name|useStickyFocus
argument_list|)
expr_stmt|;
name|noFocusOnTop
operator|->
name|setFlag
argument_list|(
name|focusFlag
argument_list|)
expr_stmt|;
name|focusableUnder
operator|->
name|stackBefore
argument_list|(
name|noFocusOnTop
argument_list|)
expr_stmt|;
name|itemWithFocus
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QWidget
operator|*
argument_list|>
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|itemWithFocus
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
specifier|const
name|QPointF
name|mousePressPoint
init|=
name|noFocusOnTop
operator|->
name|mapToScene
argument_list|(
name|noFocusOnTop
operator|->
name|boundingRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
decl_stmt|;
specifier|const
name|QList
argument_list|<
name|QGraphicsItem
modifier|*
argument_list|>
name|itemsAtMousePressPosition
init|=
name|scene
operator|.
name|items
argument_list|(
name|mousePressPoint
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|itemsAtMousePressPosition
operator|.
name|contains
argument_list|(
name|noFocusOnTop
argument_list|)
argument_list|)
expr_stmt|;
name|sendMousePress
argument_list|(
operator|&
name|scene
argument_list|,
name|mousePressPoint
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|expectedFocusItem
condition|)
block|{
case|case
literal|0
case|:
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QGraphicsRectItem
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
literal|1
case|:
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
name|focusableUnder
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
name|itemWithFocus
argument_list|)
expr_stmt|;
break|break;
block|}
comment|// Sanity check - manually setting the focus must work regardless of our
comment|// focus handling flags:
name|focusableUnder
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scene
operator|.
name|focusItem
argument_list|()
argument_list|,
name|focusableUnder
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|touchEventPropagation_data
name|void
name|tst_QGraphicsItem
operator|::
name|touchEventPropagation_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QGraphicsItem
operator|::
name|GraphicsItemFlag
argument_list|>
argument_list|(
literal|"flag"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"expectedCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"ItemIsPanel"
argument_list|)
operator|<<
name|QGraphicsItem
operator|::
name|ItemIsPanel
operator|<<
literal|0
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"ItemStopsClickFocusPropagation"
argument_list|)
operator|<<
name|QGraphicsItem
operator|::
name|ItemStopsClickFocusPropagation
operator|<<
literal|1
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"ItemStopsFocusHandling"
argument_list|)
operator|<<
name|QGraphicsItem
operator|::
name|ItemStopsFocusHandling
operator|<<
literal|1
expr_stmt|;
block|}
end_function
begin_function
DECL|function|touchEventPropagation
name|void
name|tst_QGraphicsItem
operator|::
name|touchEventPropagation
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QGraphicsItem
operator|::
name|GraphicsItemFlag
argument_list|,
name|flag
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|expectedCount
argument_list|)
expr_stmt|;
class|class
name|Testee
super|:
specifier|public
name|QGraphicsRectItem
block|{
public|public:
name|int
name|touchBeginEventCount
decl_stmt|;
name|Testee
parameter_list|()
member_init_list|:
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
member_init_list|,
name|touchBeginEventCount
argument_list|(
literal|0
argument_list|)
block|{
name|setAcceptTouchEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
name|bool
name|sceneEvent
parameter_list|(
name|QEvent
modifier|*
name|ev
parameter_list|)
block|{
if|if
condition|(
name|ev
operator|->
name|type
argument_list|()
operator|==
name|QEvent
operator|::
name|TouchBegin
condition|)
operator|++
name|touchBeginEventCount
expr_stmt|;
return|return
name|QGraphicsRectItem
operator|::
name|sceneEvent
argument_list|(
name|ev
argument_list|)
return|;
block|}
block|}
class|;
name|Testee
modifier|*
name|touchEventReceiver
init|=
operator|new
name|Testee
decl_stmt|;
name|QGraphicsItem
modifier|*
name|topMost
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|touchEventReceiver
operator|->
name|boundingRect
argument_list|()
argument_list|)
decl_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|topMost
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|touchEventReceiver
argument_list|)
expr_stmt|;
name|topMost
operator|->
name|setAcceptTouchEvents
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|topMost
operator|->
name|setZValue
argument_list|(
name|FLT_MAX
argument_list|)
expr_stmt|;
name|topMost
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|topMost
operator|->
name|setFlag
argument_list|(
name|flag
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|setSceneRect
argument_list|(
name|touchEventReceiver
operator|->
name|boundingRect
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|touchEventReceiver
operator|->
name|touchBeginEventCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QTouchEvent
operator|::
name|TouchPoint
name|tp
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|tp
operator|.
name|setState
argument_list|(
name|Qt
operator|::
name|TouchPointPressed
argument_list|)
expr_stmt|;
name|tp
operator|.
name|setScenePos
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|tp
operator|.
name|setLastScenePos
argument_list|(
name|view
operator|.
name|sceneRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QTouchEvent
operator|::
name|TouchPoint
argument_list|>
name|touchPoints
decl_stmt|;
name|touchPoints
operator|<<
name|tp
expr_stmt|;
name|sendMousePress
argument_list|(
operator|&
name|scene
argument_list|,
name|tp
operator|.
name|scenePos
argument_list|()
argument_list|)
expr_stmt|;
name|QTouchDevice
modifier|*
name|device
init|=
operator|new
name|QTouchDevice
decl_stmt|;
name|device
operator|->
name|setType
argument_list|(
name|QTouchDevice
operator|::
name|TouchScreen
argument_list|)
expr_stmt|;
name|QWindowSystemInterface
operator|::
name|registerTouchDevice
argument_list|(
name|device
argument_list|)
expr_stmt|;
name|QTouchEvent
name|touchBegin
argument_list|(
name|QEvent
operator|::
name|TouchBegin
argument_list|,
name|device
argument_list|,
name|Qt
operator|::
name|NoModifier
argument_list|,
name|Qt
operator|::
name|TouchPointPressed
argument_list|,
name|touchPoints
argument_list|)
decl_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|touchBegin
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|touchEventReceiver
operator|->
name|touchBeginEventCount
argument_list|,
name|expectedCount
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|deviceCoordinateCache_simpleRotations
name|void
name|tst_QGraphicsItem
operator|::
name|deviceCoordinateCache_simpleRotations
parameter_list|()
block|{
comment|// Make sure we don't invalidate the cache when applying simple
comment|// (90, 180, 270, 360) rotation transforms to the item.
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|item
operator|->
name|setBrush
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
expr_stmt|;
name|item
operator|->
name|setCacheMode
argument_list|(
name|QGraphicsItem
operator|::
name|DeviceCoordinateCache
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|setSceneRect
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|300
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|MyGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|QGraphicsItemCache
modifier|*
name|itemCache
init|=
name|QGraphicsItemPrivate
operator|::
name|get
argument_list|(
name|item
argument_list|)
operator|->
name|extraItemCache
argument_list|()
decl_stmt|;
name|QVERIFY
argument_list|(
name|itemCache
argument_list|)
expr_stmt|;
name|QPixmapCache
operator|::
name|Key
name|currentKey
init|=
name|itemCache
operator|->
name|deviceData
operator|.
name|value
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|)
operator|.
name|key
decl_stmt|;
comment|// Trigger an update and verify that the cache is unchanged.
name|QPixmapCache
operator|::
name|Key
name|oldKey
init|=
name|currentKey
decl_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|update
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|currentKey
operator|=
name|itemCache
operator|->
name|deviceData
operator|.
name|value
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|)
operator|.
name|key
expr_stmt|;
name|QCOMPARE
argument_list|(
name|currentKey
argument_list|,
name|oldKey
argument_list|)
expr_stmt|;
comment|// Check 90, 180, 270 and 360 degree rotations.
for|for
control|(
name|int
name|angle
init|=
literal|90
init|;
name|angle
operator|<=
literal|360
condition|;
name|angle
operator|+=
literal|90
control|)
block|{
comment|// Rotate item and verify that the cache was invalidated.
name|oldKey
operator|=
name|currentKey
expr_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|QTransform
name|transform
decl_stmt|;
name|transform
operator|.
name|translate
argument_list|(
literal|150
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|transform
operator|.
name|rotate
argument_list|(
name|angle
argument_list|)
expr_stmt|;
name|transform
operator|.
name|translate
argument_list|(
operator|-
literal|150
argument_list|,
operator|-
literal|100
argument_list|)
expr_stmt|;
name|item
operator|->
name|setTransform
argument_list|(
name|transform
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|currentKey
operator|=
name|itemCache
operator|->
name|deviceData
operator|.
name|value
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|)
operator|.
name|key
expr_stmt|;
name|QVERIFY
argument_list|(
name|currentKey
operator|!=
name|oldKey
argument_list|)
expr_stmt|;
comment|// IMPORTANT PART:
comment|// Trigger an update and verify that the cache is unchanged.
name|oldKey
operator|=
name|currentKey
expr_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|update
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|currentKey
operator|=
name|itemCache
operator|->
name|deviceData
operator|.
name|value
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|)
operator|.
name|key
expr_stmt|;
name|QCOMPARE
argument_list|(
name|currentKey
argument_list|,
name|oldKey
argument_list|)
expr_stmt|;
block|}
comment|// 45 degree rotation.
name|oldKey
operator|=
name|currentKey
expr_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|QTransform
name|transform
decl_stmt|;
name|transform
operator|.
name|translate
argument_list|(
literal|150
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|transform
operator|.
name|rotate
argument_list|(
literal|45
argument_list|)
expr_stmt|;
name|transform
operator|.
name|translate
argument_list|(
operator|-
literal|150
argument_list|,
operator|-
literal|100
argument_list|)
expr_stmt|;
name|item
operator|->
name|setTransform
argument_list|(
name|transform
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|currentKey
operator|=
name|itemCache
operator|->
name|deviceData
operator|.
name|value
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|)
operator|.
name|key
expr_stmt|;
name|QVERIFY
argument_list|(
name|currentKey
operator|!=
name|oldKey
argument_list|)
expr_stmt|;
comment|// Trigger an update and verify that the cache was invalidated.
comment|// We should always invalidate the cache for non-trivial transforms.
name|oldKey
operator|=
name|currentKey
expr_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|view
operator|.
name|viewport
argument_list|()
operator|->
name|update
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
name|currentKey
operator|=
name|itemCache
operator|->
name|deviceData
operator|.
name|value
argument_list|(
name|view
operator|.
name|viewport
argument_list|()
argument_list|)
operator|.
name|key
expr_stmt|;
name|QVERIFY
argument_list|(
name|currentKey
operator|!=
name|oldKey
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|QTBUG_5418_textItemSetDefaultColor
name|void
name|tst_QGraphicsItem
operator|::
name|QTBUG_5418_textItemSetDefaultColor
parameter_list|()
block|{
struct|struct
name|Item
super|:
specifier|public
name|QGraphicsTextItem
block|{
name|int
name|painted
decl_stmt|;
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|opt
parameter_list|,
name|QWidget
modifier|*
name|wid
parameter_list|)
block|{
name|painted
operator|++
expr_stmt|;
name|QGraphicsTextItem
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|opt
argument_list|,
name|wid
argument_list|)
expr_stmt|;
block|}
block|}
struct|;
name|Item
modifier|*
name|i
init|=
operator|new
name|Item
decl_stmt|;
name|i
operator|->
name|painted
operator|=
literal|0
expr_stmt|;
name|i
operator|->
name|setPlainText
argument_list|(
literal|"I AM A TROLL"
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|i
operator|->
name|painted
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|i
operator|->
name|painted
operator|=
literal|0
expr_stmt|;
name|QColor
name|col
argument_list|(
name|Qt
operator|::
name|red
argument_list|)
decl_stmt|;
name|i
operator|->
name|setDefaultTextColor
argument_list|(
name|col
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|i
operator|->
name|painted
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//check that changing the color force an update
name|i
operator|->
name|painted
operator|=
literal|false
expr_stmt|;
name|QImage
name|image
argument_list|(
literal|400
argument_list|,
literal|200
argument_list|,
name|QImage
operator|::
name|Format_RGB32
argument_list|)
decl_stmt|;
name|image
operator|.
name|fill
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|QPainter
name|painter
argument_list|(
operator|&
name|image
argument_list|)
decl_stmt|;
name|scene
operator|.
name|render
argument_list|(
operator|&
name|painter
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i
operator|->
name|painted
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|int
name|numRedPixel
init|=
literal|0
decl_stmt|;
name|QRgb
name|rgb
init|=
name|col
operator|.
name|rgb
argument_list|()
decl_stmt|;
for|for
control|(
name|int
name|y
init|=
literal|0
init|;
name|y
operator|<
name|image
operator|.
name|height
argument_list|()
condition|;
operator|++
name|y
control|)
block|{
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
name|image
operator|.
name|width
argument_list|()
condition|;
operator|++
name|x
control|)
block|{
comment|// Because of antialiasing we allow a certain range of errors here.
name|QRgb
name|pixel
init|=
name|image
operator|.
name|pixel
argument_list|(
name|x
argument_list|,
name|y
argument_list|)
decl_stmt|;
if|if
condition|(
name|qAbs
argument_list|(
call|(
name|int
call|)
argument_list|(
name|pixel
operator|&
literal|0xff
argument_list|)
operator|-
call|(
name|int
call|)
argument_list|(
name|rgb
operator|&
literal|0xff
argument_list|)
argument_list|)
operator|+
name|qAbs
argument_list|(
call|(
name|int
call|)
argument_list|(
operator|(
name|pixel
operator|&
literal|0xff00
operator|)
operator|>>
literal|8
argument_list|)
operator|-
call|(
name|int
call|)
argument_list|(
operator|(
name|rgb
operator|&
literal|0xff00
operator|)
operator|>>
literal|8
argument_list|)
argument_list|)
operator|+
name|qAbs
argument_list|(
call|(
name|int
call|)
argument_list|(
operator|(
name|pixel
operator|&
literal|0xff0000
operator|)
operator|>>
literal|16
argument_list|)
operator|-
call|(
name|int
call|)
argument_list|(
operator|(
name|rgb
operator|&
literal|0xff0000
operator|)
operator|>>
literal|16
argument_list|)
argument_list|)
operator|<=
literal|50
condition|)
block|{
if|if
condition|(
operator|++
name|numRedPixel
operator|>=
literal|10
condition|)
block|{
return|return;
block|}
block|}
block|}
block|}
name|QCOMPARE
argument_list|(
name|numRedPixel
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
comment|//color not found, FAIL!
name|i
operator|->
name|painted
operator|=
literal|0
expr_stmt|;
name|i
operator|->
name|setDefaultTextColor
argument_list|(
name|col
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|i
operator|->
name|painted
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|//same color as before should not trigger an update (QTBUG-6242)
block|}
end_function
begin_function
DECL|function|QTBUG_6738_missingUpdateWithSetParent
name|void
name|tst_QGraphicsItem
operator|::
name|QTBUG_6738_missingUpdateWithSetParent
parameter_list|()
block|{
comment|// In all 3 test cases below the reparented item should disappear
name|EventTester
modifier|*
name|parent
init|=
operator|new
name|EventTester
decl_stmt|;
name|EventTester
modifier|*
name|child
init|=
operator|new
name|EventTester
argument_list|(
name|parent
argument_list|)
decl_stmt|;
name|EventTester
modifier|*
name|child2
init|=
operator|new
name|EventTester
argument_list|(
name|parent
argument_list|)
decl_stmt|;
name|EventTester
modifier|*
name|child3
init|=
operator|new
name|EventTester
argument_list|(
name|parent
argument_list|)
decl_stmt|;
name|EventTester
modifier|*
name|child4
init|=
operator|new
name|EventTester
argument_list|(
name|parent
argument_list|)
decl_stmt|;
name|child
operator|->
name|setPos
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|child2
operator|->
name|setPos
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|)
expr_stmt|;
name|child3
operator|->
name|setPos
argument_list|(
literal|30
argument_list|,
literal|30
argument_list|)
expr_stmt|;
name|child4
operator|->
name|setPos
argument_list|(
literal|40
argument_list|,
literal|40
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|MyGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>
literal|0
argument_list|)
expr_stmt|;
comment|// test case #1
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|child2
operator|->
name|setVisible
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|child2
operator|->
name|setParentItem
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// test case #2
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|child3
operator|->
name|setOpacity
argument_list|(
literal|0.0
argument_list|)
expr_stmt|;
name|child3
operator|->
name|setParentItem
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|==
literal|1
argument_list|)
expr_stmt|;
comment|// test case #3
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|child4
operator|->
name|setParentItem
argument_list|(
name|child
argument_list|)
expr_stmt|;
name|child4
operator|->
name|setVisible
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|==
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|QT_2653_fullUpdateDiscardingOpacityUpdate
name|void
name|tst_QGraphicsItem
operator|::
name|QT_2653_fullUpdateDiscardingOpacityUpdate
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|MyGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|EventTester
modifier|*
name|parentGreen
init|=
operator|new
name|EventTester
argument_list|()
decl_stmt|;
name|parentGreen
operator|->
name|setGeometry
argument_list|(
name|QRectF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|parentGreen
operator|->
name|brush
operator|=
name|Qt
operator|::
name|green
expr_stmt|;
name|EventTester
modifier|*
name|childYellow
init|=
operator|new
name|EventTester
argument_list|(
name|parentGreen
argument_list|)
decl_stmt|;
name|childYellow
operator|->
name|setGeometry
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|childYellow
operator|->
name|brush
operator|=
name|Qt
operator|::
name|yellow
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parentGreen
argument_list|)
expr_stmt|;
name|childYellow
operator|->
name|setOpacity
argument_list|(
literal|0.0
argument_list|)
expr_stmt|;
name|parentGreen
operator|->
name|setOpacity
argument_list|(
literal|0.0
argument_list|)
expr_stmt|;
comment|// set any of the flags below to trigger a fullUpdate to reproduce the bug:
comment|// ItemIgnoresTransformations, ItemClipsChildrenToShape, ItemIsSelectable
name|parentGreen
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIgnoresTransformations
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|parentGreen
operator|->
name|setOpacity
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|childYellow
operator|->
name|repaints
operator|=
literal|0
expr_stmt|;
name|childYellow
operator|->
name|setOpacity
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|childYellow
operator|->
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|QTBUG_7714_fullUpdateDiscardingOpacityUpdate2
name|void
name|tst_QGraphicsItem
operator|::
name|QTBUG_7714_fullUpdateDiscardingOpacityUpdate2
parameter_list|()
block|{
name|QGraphicsScene
name|scene
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|200
argument_list|,
literal|200
argument_list|)
decl_stmt|;
name|MyGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|MyGraphicsView
name|origView
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|EventTester
modifier|*
name|parentGreen
init|=
operator|new
name|EventTester
argument_list|()
decl_stmt|;
name|parentGreen
operator|->
name|setGeometry
argument_list|(
name|QRectF
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
expr_stmt|;
name|parentGreen
operator|->
name|brush
operator|=
name|Qt
operator|::
name|green
expr_stmt|;
name|EventTester
modifier|*
name|childYellow
init|=
operator|new
name|EventTester
argument_list|(
name|parentGreen
argument_list|)
decl_stmt|;
name|childYellow
operator|->
name|setGeometry
argument_list|(
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|10
argument_list|,
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
name|childYellow
operator|->
name|brush
operator|=
name|Qt
operator|::
name|yellow
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parentGreen
argument_list|)
expr_stmt|;
name|origView
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|origView
argument_list|)
argument_list|)
expr_stmt|;
name|origView
operator|.
name|setGeometry
argument_list|(
name|origView
operator|.
name|width
argument_list|()
operator|+
literal|20
argument_list|,
literal|20
argument_list|,
name|origView
operator|.
name|width
argument_list|()
argument_list|,
name|origView
operator|.
name|height
argument_list|()
argument_list|)
expr_stmt|;
name|parentGreen
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIgnoresTransformations
argument_list|)
expr_stmt|;
name|origView
operator|.
name|reset
argument_list|()
expr_stmt|;
name|childYellow
operator|->
name|setOpacity
argument_list|(
literal|0.0
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|origView
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|qApp
operator|->
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|view
operator|.
name|reset
argument_list|()
expr_stmt|;
name|origView
operator|.
name|reset
argument_list|()
expr_stmt|;
name|childYellow
operator|->
name|setOpacity
argument_list|(
literal|1.0
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|origView
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|view
operator|.
name|repaints
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|QT_2649_focusScope
name|void
name|tst_QGraphicsItem
operator|::
name|QT_2649_focusScope
parameter_list|()
block|{
name|QGraphicsScene
modifier|*
name|scene
init|=
operator|new
name|QGraphicsScene
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|subFocusItem
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|subFocusItem
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|subFocusItem
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subFocusItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|subFocusItem
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|scope
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|scope
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
operator||
name|QGraphicsItem
operator|::
name|ItemIsFocusScope
argument_list|)
expr_stmt|;
name|scope
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|subFocusItem
operator|->
name|setParentItem
argument_list|(
name|scope
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subFocusItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|subFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subFocusItem
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|subFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|subFocusItem
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|rootItem
init|=
operator|new
name|QGraphicsRectItem
decl_stmt|;
name|rootItem
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|scope
operator|->
name|setParentItem
argument_list|(
name|rootItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rootItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|subFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rootItem
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subFocusItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|subFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subFocusItem
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|subFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|subFocusItem
argument_list|)
expr_stmt|;
name|scene
operator|->
name|addItem
argument_list|(
name|rootItem
argument_list|)
expr_stmt|;
name|QEvent
name|windowActivate
argument_list|(
name|QEvent
operator|::
name|WindowActivate
argument_list|)
decl_stmt|;
name|qApp
operator|->
name|sendEvent
argument_list|(
name|scene
argument_list|,
operator|&
name|windowActivate
argument_list|)
expr_stmt|;
name|scene
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rootItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|subFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|subFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subFocusItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|subFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rootItem
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|subFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subFocusItem
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|subFocusItem
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope
operator|->
name|hide
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rootItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subFocusItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rootItem
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|subFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subFocusItem
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|subFocusItem
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
name|scope
operator|->
name|show
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rootItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|subFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|subFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subFocusItem
operator|->
name|focusItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|subFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rootItem
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|scope
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
name|subFocusItem
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|subFocusItem
operator|->
name|focusScopeItem
argument_list|()
argument_list|,
operator|(
name|QGraphicsItem
operator|*
operator|)
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|subFocusItem
operator|->
name|hasFocus
argument_list|()
argument_list|)
expr_stmt|;
comment|// This should not crash
name|scope
operator|->
name|hide
argument_list|()
expr_stmt|;
operator|delete
name|scene
expr_stmt|;
block|}
end_function
begin_class
DECL|class|MyGraphicsItemWithItemChange
class|class
name|MyGraphicsItemWithItemChange
super|:
specifier|public
name|QGraphicsWidget
block|{
public|public:
DECL|function|MyGraphicsItemWithItemChange
name|MyGraphicsItemWithItemChange
parameter_list|(
name|QGraphicsItem
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QGraphicsWidget
argument_list|(
name|parent
argument_list|)
block|{}
DECL|function|itemChange
name|QVariant
name|itemChange
parameter_list|(
name|GraphicsItemChange
name|change
parameter_list|,
specifier|const
name|QVariant
modifier|&
name|value
parameter_list|)
block|{
if|if
condition|(
name|change
operator|==
name|QGraphicsItem
operator|::
name|ItemSceneHasChanged
condition|)
block|{
foreach|foreach
control|(
name|QGraphicsView
modifier|*
name|view
decl|,
name|scene
argument_list|()
operator|->
name|views
argument_list|()
control|)
block|{
comment|//We trigger a sort of unindexed items in the BSP
name|view
operator|->
name|sceneRect
argument_list|()
expr_stmt|;
block|}
block|}
return|return
name|QGraphicsWidget
operator|::
name|itemChange
argument_list|(
name|change
argument_list|,
name|value
argument_list|)
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|sortItemsWhileAdding
name|void
name|tst_QGraphicsItem
operator|::
name|sortItemsWhileAdding
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QGraphicsWidget
name|grandGrandParent
decl_stmt|;
name|grandGrandParent
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|grandGrandParent
argument_list|)
expr_stmt|;
name|QGraphicsWidget
name|grandParent
decl_stmt|;
name|grandParent
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|QGraphicsWidget
name|parent
argument_list|(
operator|&
name|grandParent
argument_list|)
decl_stmt|;
name|parent
operator|.
name|resize
argument_list|(
literal|200
argument_list|,
literal|200
argument_list|)
expr_stmt|;
name|MyGraphicsItemWithItemChange
name|item
argument_list|(
operator|&
name|parent
argument_list|)
decl_stmt|;
name|grandParent
operator|.
name|setParentItem
argument_list|(
operator|&
name|grandGrandParent
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|doNotMarkFullUpdateIfNotInScene
name|void
name|tst_QGraphicsItem
operator|::
name|doNotMarkFullUpdateIfNotInScene
parameter_list|()
block|{
struct|struct
name|Item
super|:
specifier|public
name|QGraphicsTextItem
block|{
name|int
name|painted
decl_stmt|;
name|void
name|paint
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|,
specifier|const
name|QStyleOptionGraphicsItem
modifier|*
name|opt
parameter_list|,
name|QWidget
modifier|*
name|wid
parameter_list|)
block|{
name|painted
operator|++
expr_stmt|;
name|QGraphicsTextItem
operator|::
name|paint
argument_list|(
name|painter
argument_list|,
name|opt
argument_list|,
name|wid
argument_list|)
expr_stmt|;
block|}
block|}
struct|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|MyGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|Item
modifier|*
name|item
init|=
operator|new
name|Item
decl_stmt|;
name|item
operator|->
name|painted
operator|=
literal|0
expr_stmt|;
name|item
operator|->
name|setPlainText
argument_list|(
literal|"Grandparent"
argument_list|)
expr_stmt|;
name|Item
modifier|*
name|item2
init|=
operator|new
name|Item
decl_stmt|;
name|item2
operator|->
name|setPlainText
argument_list|(
literal|"parent"
argument_list|)
expr_stmt|;
name|item2
operator|->
name|painted
operator|=
literal|0
expr_stmt|;
name|Item
modifier|*
name|item3
init|=
operator|new
name|Item
decl_stmt|;
name|item3
operator|->
name|setPlainText
argument_list|(
literal|"child"
argument_list|)
expr_stmt|;
name|item3
operator|->
name|painted
operator|=
literal|0
expr_stmt|;
name|QGraphicsOpacityEffect
modifier|*
name|effect
init|=
operator|new
name|QGraphicsOpacityEffect
decl_stmt|;
name|effect
operator|->
name|setOpacity
argument_list|(
literal|0.5
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setGraphicsEffect
argument_list|(
name|effect
argument_list|)
expr_stmt|;
name|item3
operator|->
name|setParentItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setParentItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
name|view
operator|.
name|windowHandle
argument_list|()
argument_list|)
expr_stmt|;
name|view
operator|.
name|activateWindow
argument_list|()
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|isActiveWindow
argument_list|()
argument_list|)
expr_stmt|;
name|QTRY_VERIFY
argument_list|(
name|view
operator|.
name|repaints
operator|>=
literal|1
argument_list|)
expr_stmt|;
name|int
name|count
init|=
name|view
operator|.
name|repaints
decl_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item
operator|->
name|painted
argument_list|,
name|count
argument_list|)
expr_stmt|;
comment|// cached as graphics effects, not painted multiple times
name|QTRY_COMPARE
argument_list|(
name|item2
operator|->
name|painted
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item3
operator|->
name|painted
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|item2
operator|->
name|update
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item
operator|->
name|painted
argument_list|,
name|count
operator|+
literal|1
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item2
operator|->
name|painted
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item3
operator|->
name|painted
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|item2
operator|->
name|update
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|processEvents
argument_list|()
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item
operator|->
name|painted
argument_list|,
name|count
operator|+
literal|2
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item2
operator|->
name|painted
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QTRY_COMPARE
argument_list|(
name|item3
operator|->
name|painted
argument_list|,
literal|3
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|itemDiesDuringDraggingOperation
name|void
name|tst_QGraphicsItem
operator|::
name|itemDiesDuringDraggingOperation
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|100
argument_list|,
literal|100
argument_list|)
argument_list|)
decl_stmt|;
name|item
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsMovable
argument_list|)
expr_stmt|;
name|item
operator|->
name|setAcceptDrops
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
operator|(
name|QWidget
operator|*
operator|)
operator|&
name|view
argument_list|)
expr_stmt|;
name|QGraphicsSceneDragDropEvent
name|dragEnter
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneDragEnter
argument_list|)
decl_stmt|;
name|dragEnter
operator|.
name|setScenePos
argument_list|(
name|item
operator|->
name|boundingRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|dragEnter
argument_list|)
expr_stmt|;
name|QGraphicsSceneDragDropEvent
name|event
argument_list|(
name|QEvent
operator|::
name|GraphicsSceneDragMove
argument_list|)
decl_stmt|;
name|event
operator|.
name|setScenePos
argument_list|(
name|item
operator|->
name|boundingRect
argument_list|()
operator|.
name|center
argument_list|()
argument_list|)
expr_stmt|;
name|QApplication
operator|::
name|sendEvent
argument_list|(
operator|&
name|scene
argument_list|,
operator|&
name|event
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QGraphicsScenePrivate
operator|::
name|get
argument_list|(
operator|&
name|scene
argument_list|)
operator|->
name|dragDropItem
operator|==
name|item
argument_list|)
expr_stmt|;
operator|delete
name|item
expr_stmt|;
name|QVERIFY
argument_list|(
name|QGraphicsScenePrivate
operator|::
name|get
argument_list|(
operator|&
name|scene
argument_list|)
operator|->
name|dragDropItem
operator|==
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|QTBUG_12112_focusItem
name|void
name|tst_QGraphicsItem
operator|::
name|QTBUG_12112_focusItem
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QGraphicsRectItem
modifier|*
name|item1
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|item1
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|QGraphicsRectItem
modifier|*
name|item2
init|=
operator|new
name|QGraphicsRectItem
argument_list|(
literal|20
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|,
literal|20
argument_list|)
decl_stmt|;
name|item2
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|item1
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item2
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|item1
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QApplication
operator|::
name|setActiveWindow
argument_list|(
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowActive
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QApplication
operator|::
name|activeWindow
argument_list|()
argument_list|,
operator|(
name|QWidget
operator|*
operator|)
operator|&
name|view
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item1
operator|->
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item2
operator|->
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|item2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|item1
operator|->
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|item2
operator|->
name|focusItem
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|QTBUG_13473_sceneposchange
name|void
name|tst_QGraphicsItem
operator|::
name|QTBUG_13473_sceneposchange
parameter_list|()
block|{
name|ScenePosChangeTester
modifier|*
name|parent
init|=
operator|new
name|ScenePosChangeTester
decl_stmt|;
name|ScenePosChangeTester
modifier|*
name|child
init|=
operator|new
name|ScenePosChangeTester
argument_list|(
name|parent
argument_list|)
decl_stmt|;
comment|// parent's disabled ItemSendsGeometryChanges flag must not affect
comment|// child's scene pos change notifications
name|parent
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemSendsGeometryChanges
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|child
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemSendsScenePositionChanges
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QGraphicsScene
name|scene
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
name|parent
argument_list|)
expr_stmt|;
comment|// ignore uninteresting changes
name|parent
operator|->
name|clear
argument_list|()
expr_stmt|;
name|child
operator|->
name|clear
argument_list|()
expr_stmt|;
comment|// move
name|parent
operator|->
name|moveBy
argument_list|(
literal|1.0
argument_list|,
literal|1.0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// transform
name|parent
operator|->
name|setTransform
argument_list|(
name|QTransform
operator|::
name|fromScale
argument_list|(
literal|0.5
argument_list|,
literal|0.5
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|child
operator|->
name|changes
operator|.
name|count
argument_list|(
name|QGraphicsItem
operator|::
name|ItemScenePositionHasChanged
argument_list|)
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|MyGraphicsWidget
class|class
name|MyGraphicsWidget
super|:
specifier|public
name|QGraphicsWidget
block|{
name|Q_OBJECT
public|public:
DECL|function|MyGraphicsWidget
name|MyGraphicsWidget
parameter_list|()
member_init_list|:
name|QGraphicsWidget
argument_list|(
literal|0
argument_list|)
block|{
name|QGraphicsLinearLayout
modifier|*
name|lay
init|=
operator|new
name|QGraphicsLinearLayout
argument_list|(
name|Qt
operator|::
name|Vertical
argument_list|)
decl_stmt|;
name|QLatin1String
name|wiseWords
argument_list|(
literal|"AZ BUKI VEDI"
argument_list|)
decl_stmt|;
name|QString
name|sentence
argument_list|(
name|wiseWords
argument_list|)
decl_stmt|;
name|QStringList
name|words
init|=
name|sentence
operator|.
name|split
argument_list|(
name|QLatin1Char
argument_list|(
literal|' '
argument_list|)
argument_list|,
name|QString
operator|::
name|SkipEmptyParts
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|words
operator|.
name|count
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|QGraphicsProxyWidget
modifier|*
name|proxy
init|=
operator|new
name|QGraphicsProxyWidget
argument_list|(
name|this
argument_list|)
decl_stmt|;
name|QLabel
modifier|*
name|label
init|=
operator|new
name|QLabel
argument_list|(
name|words
operator|.
name|at
argument_list|(
name|i
argument_list|)
argument_list|)
decl_stmt|;
name|proxy
operator|->
name|setWidget
argument_list|(
name|label
argument_list|)
expr_stmt|;
name|proxy
operator|->
name|setFocusPolicy
argument_list|(
name|Qt
operator|::
name|StrongFocus
argument_list|)
expr_stmt|;
name|proxy
operator|->
name|setFlag
argument_list|(
name|QGraphicsItem
operator|::
name|ItemAcceptsInputMethod
argument_list|,
literal|true
argument_list|)
expr_stmt|;
if|if
condition|(
name|i
operator|%
literal|2
operator|==
literal|0
condition|)
name|proxy
operator|->
name|setVisible
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|proxy
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|lay
operator|->
name|addItem
argument_list|(
name|proxy
argument_list|)
expr_stmt|;
block|}
name|setLayout
argument_list|(
name|lay
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_class
DECL|class|MyWidgetWindow
class|class
name|MyWidgetWindow
super|:
specifier|public
name|QGraphicsWidget
block|{
public|public:
DECL|function|MyWidgetWindow
name|MyWidgetWindow
parameter_list|()
member_init_list|:
name|QGraphicsWidget
argument_list|(
literal|0
argument_list|,
name|Qt
operator|::
name|Window
argument_list|)
block|{
name|QGraphicsLinearLayout
modifier|*
name|lay
init|=
operator|new
name|QGraphicsLinearLayout
argument_list|(
name|Qt
operator|::
name|Vertical
argument_list|)
decl_stmt|;
name|MyGraphicsWidget
modifier|*
name|widget
init|=
operator|new
name|MyGraphicsWidget
argument_list|()
decl_stmt|;
name|lay
operator|->
name|addItem
argument_list|(
name|widget
argument_list|)
expr_stmt|;
name|setLayout
argument_list|(
name|lay
argument_list|)
expr_stmt|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|QTBUG_16374_crashInDestructor
name|void
name|tst_QGraphicsItem
operator|::
name|QTBUG_16374_crashInDestructor
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|MyWidgetWindow
name|win
decl_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|win
argument_list|)
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|QTBUG_20699_focusScopeCrash
name|void
name|tst_QGraphicsItem
operator|::
name|QTBUG_20699_focusScopeCrash
parameter_list|()
block|{
name|QGraphicsScene
name|scene
decl_stmt|;
name|QGraphicsView
name|view
argument_list|(
operator|&
name|scene
argument_list|)
decl_stmt|;
name|QGraphicsPixmapItem
name|fs
decl_stmt|;
name|fs
operator|.
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusScope
operator||
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|scene
operator|.
name|addItem
argument_list|(
operator|&
name|fs
argument_list|)
expr_stmt|;
name|QGraphicsPixmapItem
modifier|*
name|fs2
init|=
operator|new
name|QGraphicsPixmapItem
argument_list|(
operator|&
name|fs
argument_list|)
decl_stmt|;
name|fs2
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusScope
operator||
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|QGraphicsPixmapItem
modifier|*
name|fi2
init|=
operator|new
name|QGraphicsPixmapItem
argument_list|(
operator|&
name|fs
argument_list|)
decl_stmt|;
name|fi2
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|QGraphicsPixmapItem
modifier|*
name|fi
init|=
operator|new
name|QGraphicsPixmapItem
argument_list|(
name|fs2
argument_list|)
decl_stmt|;
name|fi
operator|->
name|setFlags
argument_list|(
name|QGraphicsItem
operator|::
name|ItemIsFocusable
argument_list|)
expr_stmt|;
name|fs
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|fi
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|view
operator|.
name|show
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|QTest
operator|::
name|qWaitForWindowExposed
argument_list|(
operator|&
name|view
argument_list|)
argument_list|)
expr_stmt|;
name|fi
operator|->
name|setParentItem
argument_list|(
name|fi2
argument_list|)
expr_stmt|;
name|fi
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|fs
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|fi
operator|->
name|setParentItem
argument_list|(
name|fs2
argument_list|)
expr_stmt|;
name|fi
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|fs2
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|fs
operator|.
name|setFocus
argument_list|()
expr_stmt|;
name|fi
operator|->
name|setParentItem
argument_list|(
name|fi2
argument_list|)
expr_stmt|;
name|fi
operator|->
name|setFocus
argument_list|()
expr_stmt|;
name|fs
operator|.
name|setFocus
argument_list|()
expr_stmt|;
block|}
end_function
begin_macro
name|QTEST_MAIN
argument_list|(
argument|tst_QGraphicsItem
argument_list|)
end_macro
begin_include
include|#
directive|include
file|"tst_qgraphicsitem.moc"
end_include
end_unit
