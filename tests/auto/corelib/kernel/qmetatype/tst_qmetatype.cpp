begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2011 Nokia Corporation and/or its subsidiary(-ies). ** All rights reserved. ** Contact: Nokia Corporation (qt-info@nokia.com) ** ** This file is part of the test suite of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL$ ** GNU Lesser General Public License Usage ** This file may be used under the terms of the GNU Lesser General Public ** License version 2.1 as published by the Free Software Foundation and ** appearing in the file LICENSE.LGPL included in the packaging of this ** file. Please review the following information to ensure the GNU Lesser ** General Public License version 2.1 requirements will be met: ** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html. ** ** In addition, as a special exception, Nokia gives you certain additional ** rights. These rights are described in the Nokia Qt LGPL Exception ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package. ** ** GNU General Public License Usage ** Alternatively, this file may be used under the terms of the GNU General ** Public License version 3.0 as published by the Free Software Foundation ** and appearing in the file LICENSE.GPL included in the packaging of this ** file. Please review the following information to ensure the GNU General ** Public License version 3.0 requirements will be met: ** http://www.gnu.org/copyleft/gpl.html. ** ** Other Usage ** Alternatively, this file may be used in accordance with the terms and ** conditions contained in a signed written agreement between you and Nokia. ** ** ** ** ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<QtCore>
end_include
begin_include
include|#
directive|include
file|<QtTest/QtTest>
end_include
begin_ifdef
ifdef|#
directive|ifdef
name|Q_OS_LINUX
end_ifdef
begin_include
include|#
directive|include
file|<pthread.h>
end_include
begin_endif
endif|#
directive|endif
end_endif
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QMetaType::Type
argument_list|)
end_macro
begin_class
DECL|class|tst_QMetaType
class|class
name|tst_QMetaType
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
name|Q_PROPERTY
parameter_list|(
name|QList
argument_list|<
name|QVariant
argument_list|>
name|prop
name|READ
name|prop
name|WRITE
name|setProp
parameter_list|)
specifier|public
private|:
DECL|function|tst_QMetaType
name|tst_QMetaType
parameter_list|()
block|{
name|propList
operator|<<
literal|42
operator|<<
literal|"Hello"
expr_stmt|;
block|}
DECL|function|prop
name|QList
argument_list|<
name|QVariant
argument_list|>
name|prop
parameter_list|()
specifier|const
block|{
return|return
name|propList
return|;
block|}
DECL|function|setProp
name|void
name|setProp
parameter_list|(
specifier|const
name|QList
argument_list|<
name|QVariant
argument_list|>
modifier|&
name|list
parameter_list|)
block|{
name|propList
operator|=
name|list
expr_stmt|;
block|}
private|private:
DECL|member|propList
name|QList
argument_list|<
name|QVariant
argument_list|>
name|propList
decl_stmt|;
private|private
name|slots
private|:
name|void
name|defined
parameter_list|()
function_decl|;
name|void
name|threadSafety
parameter_list|()
function_decl|;
name|void
name|namespaces
parameter_list|()
function_decl|;
name|void
name|qMetaTypeId
parameter_list|()
function_decl|;
name|void
name|properties
parameter_list|()
function_decl|;
name|void
name|normalizedTypes
parameter_list|()
function_decl|;
name|void
name|typeName_data
parameter_list|()
function_decl|;
name|void
name|typeName
parameter_list|()
function_decl|;
name|void
name|create_data
parameter_list|()
function_decl|;
name|void
name|create
parameter_list|()
function_decl|;
name|void
name|createCopy_data
parameter_list|()
function_decl|;
name|void
name|createCopy
parameter_list|()
function_decl|;
name|void
name|sizeOf_data
parameter_list|()
function_decl|;
name|void
name|sizeOf
parameter_list|()
function_decl|;
name|void
name|construct_data
parameter_list|()
function_decl|;
name|void
name|construct
parameter_list|()
function_decl|;
name|void
name|constructCopy_data
parameter_list|()
function_decl|;
name|void
name|constructCopy
parameter_list|()
function_decl|;
name|void
name|typedefs
parameter_list|()
function_decl|;
name|void
name|isRegistered_data
parameter_list|()
function_decl|;
name|void
name|isRegistered
parameter_list|()
function_decl|;
name|void
name|unregisterType
parameter_list|()
function_decl|;
name|void
name|QTBUG11316_registerStreamBuiltin
parameter_list|()
function_decl|;
block|}
class|;
end_class
begin_struct
DECL|struct|Foo
DECL|member|i
struct|struct
name|Foo
block|{
name|int
name|i
decl_stmt|;
block|}
struct|;
end_struct
begin_function
DECL|function|defined
name|void
name|tst_QMetaType
operator|::
name|defined
parameter_list|()
block|{
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|QMetaTypeId2
argument_list|<
name|QString
argument_list|>
operator|::
name|Defined
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|QMetaTypeId2
argument_list|<
name|Foo
argument_list|>
operator|::
name|Defined
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|QMetaTypeId2
argument_list|<
name|void
operator|*
argument_list|>
operator|::
name|Defined
argument_list|)
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|QMetaTypeId2
argument_list|<
name|int
operator|*
argument_list|>
operator|::
name|Defined
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_struct
DECL|struct|Bar
struct|struct
name|Bar
block|{
DECL|function|Bar
name|Bar
parameter_list|()
block|{
comment|// check re-entrancy
if|if
condition|(
operator|!
name|QMetaType
operator|::
name|isRegistered
argument_list|(
name|qRegisterMetaType
argument_list|<
name|Foo
argument_list|>
argument_list|(
literal|"Foo"
argument_list|)
argument_list|)
condition|)
block|{
name|qWarning
argument_list|(
literal|"%s: re-entrancy test failed"
argument_list|,
name|Q_FUNC_INFO
argument_list|)
expr_stmt|;
operator|++
name|failureCount
expr_stmt|;
block|}
block|}
public|public:
DECL|member|failureCount
specifier|static
name|int
name|failureCount
decl_stmt|;
block|}
struct|;
end_struct
begin_decl_stmt
DECL|member|failureCount
name|int
name|Bar
operator|::
name|failureCount
init|=
literal|0
decl_stmt|;
end_decl_stmt
begin_class
DECL|class|MetaTypeTorturer
class|class
name|MetaTypeTorturer
super|:
specifier|public
name|QThread
block|{
name|Q_OBJECT
protected|protected:
DECL|function|run
name|void
name|run
parameter_list|()
block|{
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
literal|1000
condition|;
operator|++
name|i
control|)
block|{
specifier|const
name|QByteArray
name|name
init|=
name|QString
argument_list|(
literal|"Bar%1_%2"
argument_list|)
operator|.
name|arg
argument_list|(
name|i
argument_list|)
operator|.
name|arg
argument_list|(
operator|(
name|size_t
operator|)
name|QThread
operator|::
name|currentThreadId
argument_list|()
argument_list|)
operator|.
name|toLatin1
argument_list|()
decl_stmt|;
specifier|const
name|char
modifier|*
name|nm
init|=
name|name
operator|.
name|constData
argument_list|()
decl_stmt|;
name|int
name|tp
init|=
name|qRegisterMetaType
argument_list|<
name|Bar
argument_list|>
argument_list|(
name|nm
argument_list|)
decl_stmt|;
ifdef|#
directive|ifdef
name|Q_OS_LINUX
name|pthread_yield
argument_list|()
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|QMetaType
operator|::
name|isRegistered
argument_list|(
name|tp
argument_list|)
condition|)
block|{
operator|++
name|failureCount
expr_stmt|;
name|qWarning
argument_list|()
operator|<<
name|name
operator|<<
literal|"is not a registered metatype"
expr_stmt|;
block|}
if|if
condition|(
name|QMetaType
operator|::
name|type
argument_list|(
name|nm
argument_list|)
operator|!=
name|tp
condition|)
block|{
operator|++
name|failureCount
expr_stmt|;
name|qWarning
argument_list|()
operator|<<
literal|"Wrong metatype returned for"
operator|<<
name|name
expr_stmt|;
block|}
if|if
condition|(
name|QMetaType
operator|::
name|typeName
argument_list|(
name|tp
argument_list|)
operator|!=
name|name
condition|)
block|{
operator|++
name|failureCount
expr_stmt|;
name|qWarning
argument_list|()
operator|<<
literal|"Wrong typeName returned for"
operator|<<
name|tp
expr_stmt|;
block|}
name|void
modifier|*
name|buf
init|=
name|QMetaType
operator|::
name|create
argument_list|(
name|tp
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|void
modifier|*
name|buf2
init|=
name|QMetaType
operator|::
name|create
argument_list|(
name|tp
argument_list|,
name|buf
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|buf
condition|)
block|{
operator|++
name|failureCount
expr_stmt|;
name|qWarning
argument_list|()
operator|<<
literal|"Null buffer returned by QMetaType::create(tp, 0)"
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|buf2
condition|)
block|{
operator|++
name|failureCount
expr_stmt|;
name|qWarning
argument_list|()
operator|<<
literal|"Null buffer returned by QMetaType::create(tp, buf)"
expr_stmt|;
block|}
name|QMetaType
operator|::
name|destroy
argument_list|(
name|tp
argument_list|,
name|buf
argument_list|)
expr_stmt|;
name|QMetaType
operator|::
name|destroy
argument_list|(
name|tp
argument_list|,
name|buf2
argument_list|)
expr_stmt|;
block|}
block|}
public|public:
DECL|function|MetaTypeTorturer
name|MetaTypeTorturer
parameter_list|()
member_init_list|:
name|failureCount
argument_list|(
literal|0
argument_list|)
block|{ }
DECL|member|failureCount
name|int
name|failureCount
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|threadSafety
name|void
name|tst_QMetaType
operator|::
name|threadSafety
parameter_list|()
block|{
name|MetaTypeTorturer
name|t1
decl_stmt|;
name|MetaTypeTorturer
name|t2
decl_stmt|;
name|MetaTypeTorturer
name|t3
decl_stmt|;
name|t1
operator|.
name|start
argument_list|()
expr_stmt|;
name|t2
operator|.
name|start
argument_list|()
expr_stmt|;
name|t3
operator|.
name|start
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|t1
operator|.
name|wait
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|t2
operator|.
name|wait
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|t3
operator|.
name|wait
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|t1
operator|.
name|failureCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|t2
operator|.
name|failureCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|t3
operator|.
name|failureCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|Bar
operator|::
name|failureCount
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_namespace
DECL|namespace|TestSpace
namespace|namespace
name|TestSpace
block|{
DECL|struct|Foo
DECL|member|d
struct|struct
name|Foo
block|{
name|double
name|d
decl_stmt|;
block|}
struct|;
block|}
end_namespace
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|TestSpace::Foo
argument_list|)
end_macro
begin_function
DECL|function|namespaces
name|void
name|tst_QMetaType
operator|::
name|namespaces
parameter_list|()
block|{
name|TestSpace
operator|::
name|Foo
name|nf
init|=
block|{
literal|11.12
block|}
decl_stmt|;
name|QVariant
name|v
init|=
name|qVariantFromValue
argument_list|(
name|nf
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|TestSpace
operator|::
name|Foo
argument_list|>
argument_list|(
name|v
argument_list|)
operator|.
name|d
argument_list|,
literal|11.12
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|qMetaTypeId
name|void
name|tst_QMetaType
operator|::
name|qMetaTypeId
parameter_list|()
block|{
name|QCOMPARE
argument_list|(
operator|::
name|qMetaTypeId
argument_list|<
name|QString
argument_list|>
argument_list|()
argument_list|,
name|int
argument_list|(
name|QMetaType
operator|::
name|QString
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
operator|::
name|qMetaTypeId
argument_list|<
name|int
argument_list|>
argument_list|()
argument_list|,
name|int
argument_list|(
name|QMetaType
operator|::
name|Int
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
operator|::
name|qMetaTypeId
argument_list|<
name|TestSpace
operator|::
name|Foo
argument_list|>
argument_list|()
argument_list|,
name|QMetaType
operator|::
name|type
argument_list|(
literal|"TestSpace::Foo"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
operator|::
name|qMetaTypeId
argument_list|<
name|char
argument_list|>
argument_list|()
argument_list|,
name|QMetaType
operator|::
name|type
argument_list|(
literal|"char"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
operator|::
name|qMetaTypeId
argument_list|<
name|uchar
argument_list|>
argument_list|()
argument_list|,
name|QMetaType
operator|::
name|type
argument_list|(
literal|"unsigned char"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
argument|::qMetaTypeId<signed char>()
argument_list|,
argument|QMetaType::type(
literal|"signed char"
argument|)
argument_list|)
empty_stmt|;
name|QCOMPARE
argument_list|(
operator|::
name|qMetaTypeId
argument_list|<
name|qint8
argument_list|>
argument_list|()
argument_list|,
name|QMetaType
operator|::
name|type
argument_list|(
literal|"qint8"
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|properties
name|void
name|tst_QMetaType
operator|::
name|properties
parameter_list|()
block|{
name|qRegisterMetaType
argument_list|<
name|QList
argument_list|<
name|QVariant
argument_list|>
argument_list|>
argument_list|(
literal|"QList<QVariant>"
argument_list|)
expr_stmt|;
name|QVariant
name|v
init|=
name|property
argument_list|(
literal|"prop"
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|v
operator|.
name|typeName
argument_list|()
argument_list|,
literal|"QVariantList"
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QVariant
argument_list|>
name|values
init|=
name|v
operator|.
name|toList
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|values
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|values
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|toInt
argument_list|()
argument_list|,
literal|42
argument_list|)
expr_stmt|;
name|values
operator|<<
literal|43
operator|<<
literal|"world"
expr_stmt|;
name|QVERIFY
argument_list|(
name|setProperty
argument_list|(
literal|"prop"
argument_list|,
name|values
argument_list|)
argument_list|)
expr_stmt|;
name|v
operator|=
name|property
argument_list|(
literal|"prop"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|v
operator|.
name|toList
argument_list|()
operator|.
name|count
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
block|}
end_function
begin_struct
template|template
parameter_list|<
name|typename
name|T
parameter_list|>
struct|struct
DECL|struct|Whity
DECL|member|t
name|Whity
block|{
name|T
name|t
decl_stmt|;
block|}
struct|;
end_struct
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|Whity< int>
argument_list|)
end_macro
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|Whity<double>
argument_list|)
end_macro
begin_function
DECL|function|normalizedTypes
name|void
name|tst_QMetaType
operator|::
name|normalizedTypes
parameter_list|()
block|{
name|int
name|WhityIntId
init|=
operator|::
name|qMetaTypeId
argument_list|<
name|Whity
argument_list|<
name|int
argument_list|>
argument_list|>
argument_list|()
decl_stmt|;
name|int
name|WhityDoubleId
init|=
operator|::
name|qMetaTypeId
argument_list|<
name|Whity
argument_list|<
name|double
argument_list|>
argument_list|>
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|"Whity<int>"
argument_list|)
argument_list|,
name|WhityIntId
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|" Whity< int> "
argument_list|)
argument_list|,
name|WhityIntId
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|"Whity<int>"
argument_list|)
argument_list|,
name|WhityIntId
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|"Whity<double>"
argument_list|)
argument_list|,
name|WhityDoubleId
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|" Whity< double> "
argument_list|)
argument_list|,
name|WhityDoubleId
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|"Whity<double>"
argument_list|)
argument_list|,
name|WhityDoubleId
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qRegisterMetaType
argument_list|<
name|Whity
argument_list|<
name|int
argument_list|>
argument_list|>
argument_list|(
literal|" Whity< int> "
argument_list|)
argument_list|,
name|WhityIntId
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qRegisterMetaType
argument_list|<
name|Whity
argument_list|<
name|int
argument_list|>
argument_list|>
argument_list|(
literal|"Whity<int>"
argument_list|)
argument_list|,
name|WhityIntId
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qRegisterMetaType
argument_list|<
name|Whity
argument_list|<
name|int
argument_list|>
argument_list|>
argument_list|(
literal|"Whity<int> "
argument_list|)
argument_list|,
name|WhityIntId
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qRegisterMetaType
argument_list|<
name|Whity
argument_list|<
name|double
argument_list|>
argument_list|>
argument_list|(
literal|" Whity< double> "
argument_list|)
argument_list|,
name|WhityDoubleId
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qRegisterMetaType
argument_list|<
name|Whity
argument_list|<
name|double
argument_list|>
argument_list|>
argument_list|(
literal|"Whity<double>"
argument_list|)
argument_list|,
name|WhityDoubleId
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qRegisterMetaType
argument_list|<
name|Whity
argument_list|<
name|double
argument_list|>
argument_list|>
argument_list|(
literal|"Whity<double> "
argument_list|)
argument_list|,
name|WhityDoubleId
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|typeName_data
name|void
name|tst_QMetaType
operator|::
name|typeName_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QMetaType
operator|::
name|Type
argument_list|>
argument_list|(
literal|"aType"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QString
argument_list|>
argument_list|(
literal|"aTypeName"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"void"
argument_list|)
operator|<<
name|QMetaType
operator|::
name|Void
operator|<<
literal|"void"
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"int"
argument_list|)
operator|<<
name|QMetaType
operator|::
name|Int
operator|<<
literal|"int"
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"double"
argument_list|)
operator|<<
name|QMetaType
operator|::
name|Double
operator|<<
literal|"double"
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"qlonglong"
argument_list|)
operator|<<
name|QMetaType
operator|::
name|LongLong
operator|<<
literal|"qlonglong"
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"QRegExp"
argument_list|)
operator|<<
name|QMetaType
operator|::
name|QRegExp
operator|<<
literal|"QRegExp"
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"void*"
argument_list|)
operator|<<
name|QMetaType
operator|::
name|VoidStar
operator|<<
literal|"void*"
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"ulong"
argument_list|)
operator|<<
name|QMetaType
operator|::
name|ULong
operator|<<
literal|"ulong"
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"QWidget*"
argument_list|)
operator|<<
name|QMetaType
operator|::
name|QWidgetStar
operator|<<
literal|"QWidget*"
expr_stmt|;
block|}
end_function
begin_function
DECL|function|typeName
name|void
name|tst_QMetaType
operator|::
name|typeName
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QMetaType
operator|::
name|Type
argument_list|,
name|aType
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QString
argument_list|,
name|aTypeName
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QString
operator|::
name|fromLatin1
argument_list|(
name|QMetaType
operator|::
name|typeName
argument_list|(
name|aType
argument_list|)
argument_list|)
argument_list|,
name|aTypeName
argument_list|)
expr_stmt|;
block|}
end_function
begin_define
DECL|macro|FOR_EACH_PRIMITIVE_METATYPE
define|#
directive|define
name|FOR_EACH_PRIMITIVE_METATYPE
parameter_list|(
name|F
parameter_list|)
define|\
value|F(int, Int) \     F(uint, UInt) \     F(bool, Bool) \     F(double, Double) \     F(long, Long) \     F(short, Short) \     F(char, Char) \     F(ulong, ULong) \     F(ushort, UShort) \     F(uchar, UChar) \     F(float, Float) \     F(QObject *, QObjectStar) \     F(QWidget *, QWidgetStar) \     F(void *, VoidStar) \     F(qlonglong, LongLong) \     F(qulonglong, ULongLong)
end_define
begin_define
DECL|macro|FOR_EACH_COMPLEX_CORE_METATYPE
define|#
directive|define
name|FOR_EACH_COMPLEX_CORE_METATYPE
parameter_list|(
name|F
parameter_list|)
define|\
value|F(QString, QString) \     F(QByteArray, QByteArray) \     F(QChar, QChar) \     F(QStringList, QStringList) \     F(QBitArray, QBitArray) \     F(QDate, QDate) \     F(QTime, QTime) \     F(QDateTime, QDateTime) \     F(QUrl, QUrl) \     F(QLocale, QLocale) \     F(QRect, QRect) \     F(QRectF, QRectF) \     F(QSize, QSize) \     F(QSizeF, QSizeF) \     F(QLine, QLine) \     F(QLineF, QLineF) \     F(QPoint, QPoint) \     F(QPointF, QPointF) \     F(QEasingCurve, QEasingCurve)
end_define
begin_ifndef
ifndef|#
directive|ifndef
name|QT_NO_REGEXP
end_ifndef
begin_define
DECL|macro|FOR_EACH_COMPLEX_CORE_METATYPE2
define|#
directive|define
name|FOR_EACH_COMPLEX_CORE_METATYPE2
parameter_list|(
name|F
parameter_list|)
define|\
value|F(QRegExp, QRegExp)
end_define
begin_else
else|#
directive|else
end_else
begin_define
DECL|macro|FOR_EACH_COMPLEX_CORE_METATYPE2
define|#
directive|define
name|FOR_EACH_COMPLEX_CORE_METATYPE2
parameter_list|(
name|F
parameter_list|)
end_define
begin_endif
endif|#
directive|endif
end_endif
begin_define
DECL|macro|FOR_EACH_CORE_METATYPE
define|#
directive|define
name|FOR_EACH_CORE_METATYPE
parameter_list|(
name|F
parameter_list|)
define|\
value|FOR_EACH_PRIMITIVE_METATYPE(F) \     FOR_EACH_COMPLEX_CORE_METATYPE(F) \     FOR_EACH_COMPLEX_CORE_METATYPE2(F)
end_define
begin_struct
template|template
parameter_list|<
name|int
name|ID
parameter_list|>
struct|struct
DECL|struct|MetaEnumToType
name|MetaEnumToType
block|{
block|}
struct|;
end_struct
begin_define
DECL|macro|DEFINE_META_ENUM_TO_TYPE
define|#
directive|define
name|DEFINE_META_ENUM_TO_TYPE
parameter_list|(
name|TYPE
parameter_list|,
name|ID
parameter_list|)
define|\
value|template<> \ struct MetaEnumToType<QMetaType::ID> { \     typedef TYPE Type; \ };
end_define
begin_macro
name|FOR_EACH_CORE_METATYPE
argument_list|(
argument|DEFINE_META_ENUM_TO_TYPE
argument_list|)
end_macro
begin_undef
DECL|macro|DEFINE_META_ENUM_TO_TYPE
undef|#
directive|undef
name|DEFINE_META_ENUM_TO_TYPE
end_undef
begin_struct
template|template
parameter_list|<
name|int
name|ID
parameter_list|>
struct|struct
DECL|struct|DefaultValueFactory
name|DefaultValueFactory
block|{
DECL|typedef|Type
typedef|typedef
typename|typename
name|MetaEnumToType
argument_list|<
name|ID
argument_list|>
operator|::
name|Type
name|Type
typedef|;
DECL|function|create
specifier|static
name|Type
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|Type
return|;
block|}
block|}
struct|;
end_struct
begin_struct
template|template
parameter_list|<
name|int
name|ID
parameter_list|>
struct|struct
DECL|struct|DefaultValueTraits
name|DefaultValueTraits
block|{
comment|// By default we assume that a default-constructed value (new T) is
comment|// initialized; e.g. QCOMPARE(*(new T), *(new T)) should succeed
DECL|enumerator|IsInitialized
enum|enum
block|{
name|IsInitialized
init|=
literal|true
block|}
enum|;
block|}
struct|;
end_struct
begin_define
DECL|macro|DEFINE_NON_INITIALIZED_DEFAULT_VALUE_TRAITS
define|#
directive|define
name|DEFINE_NON_INITIALIZED_DEFAULT_VALUE_TRAITS
parameter_list|(
name|TYPE
parameter_list|,
name|ID
parameter_list|)
define|\
value|template<> struct DefaultValueTraits<QMetaType::ID> { \     enum { IsInitialized = false }; \ };
end_define
begin_comment
comment|// Primitive types (int et al) aren't initialized
end_comment
begin_macro
name|FOR_EACH_PRIMITIVE_METATYPE
argument_list|(
argument|DEFINE_NON_INITIALIZED_DEFAULT_VALUE_TRAITS
argument_list|)
end_macro
begin_undef
DECL|macro|DEFINE_NON_INITIALIZED_DEFAULT_VALUE_TRAITS
undef|#
directive|undef
name|DEFINE_NON_INITIALIZED_DEFAULT_VALUE_TRAITS
end_undef
begin_struct
template|template
parameter_list|<
name|int
name|ID
parameter_list|>
struct|struct
DECL|struct|TestValueFactory
name|TestValueFactory
block|{
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QString
argument_list|>
block|{
DECL|function|create
specifier|static
name|QString
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QString
argument_list|(
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"QString"
argument_list|)
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|Int
argument_list|>
block|{
DECL|function|create
specifier|static
name|int
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|int
argument_list|(
literal|0x12345678
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|UInt
argument_list|>
block|{
DECL|function|create
specifier|static
name|uint
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|uint
argument_list|(
literal|0x12345678
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|Bool
argument_list|>
block|{
DECL|function|create
specifier|static
name|bool
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|bool
argument_list|(
literal|true
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|Double
argument_list|>
block|{
DECL|function|create
specifier|static
name|double
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|double
argument_list|(
literal|3.14
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QByteArray
argument_list|>
block|{
DECL|function|create
specifier|static
name|QByteArray
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QByteArray
argument_list|(
name|QByteArray
argument_list|(
literal|"QByteArray"
argument_list|)
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QChar
argument_list|>
block|{
DECL|function|create
specifier|static
name|QChar
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QChar
argument_list|(
name|QChar
argument_list|(
literal|'q'
argument_list|)
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|Long
argument_list|>
block|{
DECL|function|create
specifier|static
name|long
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|long
argument_list|(
literal|0x12345678
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|Short
argument_list|>
block|{
DECL|function|create
specifier|static
name|short
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|short
argument_list|(
literal|0x1234
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|Char
argument_list|>
block|{
DECL|function|create
specifier|static
name|char
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|char
argument_list|(
literal|'c'
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|ULong
argument_list|>
block|{
DECL|function|create
specifier|static
name|ulong
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|ulong
argument_list|(
literal|0x12345678
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|UShort
argument_list|>
block|{
DECL|function|create
specifier|static
name|ushort
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|ushort
argument_list|(
literal|0x1234
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|UChar
argument_list|>
block|{
DECL|function|create
specifier|static
name|uchar
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|uchar
argument_list|(
literal|'u'
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|Float
argument_list|>
block|{
DECL|function|create
specifier|static
name|float
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|float
argument_list|(
literal|3.14
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QObjectStar
argument_list|>
block|{
DECL|function|create
specifier|static
name|QObject
modifier|*
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QObject
operator|*
operator|(
literal|0
operator|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QWidgetStar
argument_list|>
block|{
DECL|function|create
specifier|static
name|QWidget
modifier|*
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QWidget
operator|*
operator|(
literal|0
operator|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|VoidStar
argument_list|>
block|{
DECL|function|create
specifier|static
name|void
modifier|*
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|void
operator|*
operator|(
literal|0
operator|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|LongLong
argument_list|>
block|{
DECL|function|create
specifier|static
name|qlonglong
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|qlonglong
argument_list|(
literal|0x12345678
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|ULongLong
argument_list|>
block|{
DECL|function|create
specifier|static
name|qulonglong
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|qulonglong
argument_list|(
literal|0x12345678
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QStringList
argument_list|>
block|{
DECL|function|create
specifier|static
name|QStringList
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QStringList
argument_list|(
name|QStringList
argument_list|()
operator|<<
literal|"Q"
operator|<<
literal|"t"
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QBitArray
argument_list|>
block|{
DECL|function|create
specifier|static
name|QBitArray
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QBitArray
argument_list|(
name|QBitArray
argument_list|(
literal|256
argument_list|,
literal|true
argument_list|)
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QDate
argument_list|>
block|{
DECL|function|create
specifier|static
name|QDate
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QDate
argument_list|(
name|QDate
operator|::
name|currentDate
argument_list|()
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QTime
argument_list|>
block|{
DECL|function|create
specifier|static
name|QTime
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QTime
argument_list|(
name|QTime
operator|::
name|currentTime
argument_list|()
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QDateTime
argument_list|>
block|{
DECL|function|create
specifier|static
name|QDateTime
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QDateTime
argument_list|(
name|QDateTime
operator|::
name|currentDateTime
argument_list|()
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QUrl
argument_list|>
block|{
DECL|function|create
specifier|static
name|QUrl
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QUrl
argument_list|(
literal|"http://www.example.org"
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QLocale
argument_list|>
block|{
DECL|function|create
specifier|static
name|QLocale
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QLocale
argument_list|(
name|QLocale
operator|::
name|c
argument_list|()
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QRect
argument_list|>
block|{
DECL|function|create
specifier|static
name|QRect
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QRect
argument_list|(
literal|10
argument_list|,
literal|20
argument_list|,
literal|30
argument_list|,
literal|40
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QRectF
argument_list|>
block|{
DECL|function|create
specifier|static
name|QRectF
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QRectF
argument_list|(
literal|10
argument_list|,
literal|20
argument_list|,
literal|30
argument_list|,
literal|40
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QSize
argument_list|>
block|{
DECL|function|create
specifier|static
name|QSize
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QSize
argument_list|(
literal|10
argument_list|,
literal|20
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QSizeF
argument_list|>
block|{
DECL|function|create
specifier|static
name|QSizeF
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QSizeF
argument_list|(
literal|10
argument_list|,
literal|20
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QLine
argument_list|>
block|{
DECL|function|create
specifier|static
name|QLine
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QLine
argument_list|(
literal|10
argument_list|,
literal|20
argument_list|,
literal|30
argument_list|,
literal|40
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QLineF
argument_list|>
block|{
DECL|function|create
specifier|static
name|QLineF
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QLineF
argument_list|(
literal|10
argument_list|,
literal|20
argument_list|,
literal|30
argument_list|,
literal|40
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QPoint
argument_list|>
block|{
DECL|function|create
specifier|static
name|QPoint
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QPoint
argument_list|(
literal|10
argument_list|,
literal|20
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QPointF
argument_list|>
block|{
DECL|function|create
specifier|static
name|QPointF
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|20
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QEasingCurve
argument_list|>
block|{
DECL|function|create
specifier|static
name|QEasingCurve
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QEasingCurve
argument_list|(
name|QEasingCurve
operator|::
name|InOutElastic
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_ifndef
ifndef|#
directive|ifndef
name|QT_NO_REGEXP
end_ifndef
begin_struct
DECL|struct|TestValueFactory
template|template
parameter_list|<>
struct|struct
name|TestValueFactory
argument_list|<
name|QMetaType
operator|::
name|QRegExp
argument_list|>
block|{
DECL|function|create
specifier|static
name|QRegExp
modifier|*
name|create
parameter_list|()
block|{
return|return
operator|new
name|QRegExp
argument_list|(
literal|"A*"
argument_list|)
return|;
block|}
block|}
struct|;
end_struct
begin_endif
endif|#
directive|endif
end_endif
begin_function
DECL|function|create_data
name|void
name|tst_QMetaType
operator|::
name|create_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QMetaType
operator|::
name|Type
argument_list|>
argument_list|(
literal|"type"
argument_list|)
expr_stmt|;
DECL|macro|ADD_METATYPE_TEST_ROW
define|#
directive|define
name|ADD_METATYPE_TEST_ROW
parameter_list|(
name|TYPE
parameter_list|,
name|ID
parameter_list|)
define|\
value|QTest::newRow(QMetaType::typeName(QMetaType::ID))<< QMetaType::ID;
name|FOR_EACH_CORE_METATYPE
argument_list|(
argument|ADD_METATYPE_TEST_ROW
argument_list|)
DECL|macro|ADD_METATYPE_TEST_ROW
undef|#
directive|undef
name|ADD_METATYPE_TEST_ROW
block|}
end_function
begin_function
template|template
parameter_list|<
name|int
name|ID
parameter_list|>
DECL|function|testCreateHelper
specifier|static
name|void
name|testCreateHelper
parameter_list|()
block|{
typedef|typedef
typename|typename
name|MetaEnumToType
argument_list|<
name|ID
argument_list|>
operator|::
name|Type
name|Type
typedef|;
name|void
modifier|*
name|actual
init|=
name|QMetaType
operator|::
name|create
argument_list|(
name|ID
argument_list|)
decl_stmt|;
if|if
condition|(
name|DefaultValueTraits
argument_list|<
name|ID
argument_list|>
operator|::
name|IsInitialized
condition|)
block|{
name|Type
modifier|*
name|expected
init|=
name|DefaultValueFactory
argument_list|<
name|ID
argument_list|>
operator|::
name|create
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
operator|*
cast|static_cast
argument_list|<
name|Type
operator|*
argument_list|>
argument_list|(
name|actual
argument_list|)
argument_list|,
operator|*
name|expected
argument_list|)
expr_stmt|;
operator|delete
name|expected
expr_stmt|;
block|}
name|QMetaType
operator|::
name|destroy
argument_list|(
name|ID
argument_list|,
name|actual
argument_list|)
expr_stmt|;
block|}
end_function
begin_typedef
DECL|typedef|TypeTestFunction
typedef|typedef
name|void
function_decl|(
modifier|*
name|TypeTestFunction
function_decl|)
parameter_list|()
function_decl|;
end_typedef
begin_function
DECL|function|create
name|void
name|tst_QMetaType
operator|::
name|create
parameter_list|()
block|{
struct|struct
name|TypeTestFunctionGetter
block|{
specifier|static
name|TypeTestFunction
name|get
parameter_list|(
name|int
name|type
parameter_list|)
block|{
switch|switch
condition|(
name|type
condition|)
block|{
DECL|macro|RETURN_CREATE_FUNCTION
define|#
directive|define
name|RETURN_CREATE_FUNCTION
parameter_list|(
name|TYPE
parameter_list|,
name|ID
parameter_list|)
define|\
value|case QMetaType::ID: \             return testCreateHelper<QMetaType::ID>;
name|FOR_EACH_CORE_METATYPE
argument_list|(
argument|RETURN_CREATE_FUNCTION
argument_list|)
DECL|macro|RETURN_CREATE_FUNCTION
undef|#
directive|undef
name|RETURN_CREATE_FUNCTION
block|}
return|return
literal|0
return|;
block|}
block|}
struct|;
name|QFETCH
argument_list|(
name|QMetaType
operator|::
name|Type
argument_list|,
name|type
argument_list|)
expr_stmt|;
name|TypeTestFunctionGetter
operator|::
name|get
function_decl|(
name|type
function_decl|)
parameter_list|()
function_decl|;
block|}
end_function
begin_function
template|template
parameter_list|<
name|int
name|ID
parameter_list|>
DECL|function|testCreateCopyHelper
specifier|static
name|void
name|testCreateCopyHelper
parameter_list|()
block|{
typedef|typedef
typename|typename
name|MetaEnumToType
argument_list|<
name|ID
argument_list|>
operator|::
name|Type
name|Type
typedef|;
name|Type
modifier|*
name|expected
init|=
name|TestValueFactory
argument_list|<
name|ID
argument_list|>
operator|::
name|create
argument_list|()
decl_stmt|;
name|void
modifier|*
name|actual
init|=
name|QMetaType
operator|::
name|create
argument_list|(
name|ID
argument_list|,
name|expected
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
operator|*
cast|static_cast
argument_list|<
name|Type
operator|*
argument_list|>
argument_list|(
name|actual
argument_list|)
argument_list|,
operator|*
name|expected
argument_list|)
expr_stmt|;
name|QMetaType
operator|::
name|destroy
argument_list|(
name|ID
argument_list|,
name|actual
argument_list|)
expr_stmt|;
operator|delete
name|expected
expr_stmt|;
block|}
end_function
begin_function
DECL|function|createCopy_data
name|void
name|tst_QMetaType
operator|::
name|createCopy_data
parameter_list|()
block|{
name|create_data
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|createCopy
name|void
name|tst_QMetaType
operator|::
name|createCopy
parameter_list|()
block|{
struct|struct
name|TypeTestFunctionGetter
block|{
specifier|static
name|TypeTestFunction
name|get
parameter_list|(
name|int
name|type
parameter_list|)
block|{
switch|switch
condition|(
name|type
condition|)
block|{
DECL|macro|RETURN_CREATE_COPY_FUNCTION
define|#
directive|define
name|RETURN_CREATE_COPY_FUNCTION
parameter_list|(
name|TYPE
parameter_list|,
name|ID
parameter_list|)
define|\
value|case QMetaType::ID: \             return testCreateCopyHelper<QMetaType::ID>;
name|FOR_EACH_CORE_METATYPE
argument_list|(
argument|RETURN_CREATE_COPY_FUNCTION
argument_list|)
DECL|macro|RETURN_CREATE_COPY_FUNCTION
undef|#
directive|undef
name|RETURN_CREATE_COPY_FUNCTION
block|}
return|return
literal|0
return|;
block|}
block|}
struct|;
name|QFETCH
argument_list|(
name|QMetaType
operator|::
name|Type
argument_list|,
name|type
argument_list|)
expr_stmt|;
name|TypeTestFunctionGetter
operator|::
name|get
function_decl|(
name|type
function_decl|)
parameter_list|()
function_decl|;
block|}
end_function
begin_function
DECL|function|sizeOf_data
name|void
name|tst_QMetaType
operator|::
name|sizeOf_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QMetaType
operator|::
name|Type
argument_list|>
argument_list|(
literal|"type"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"size"
argument_list|)
expr_stmt|;
DECL|macro|ADD_METATYPE_TEST_ROW
define|#
directive|define
name|ADD_METATYPE_TEST_ROW
parameter_list|(
name|TYPE
parameter_list|,
name|ID
parameter_list|)
define|\
value|QTest::newRow(QMetaType::typeName(QMetaType::ID))<< QMetaType::ID<< int(sizeof(TYPE));
name|FOR_EACH_CORE_METATYPE
argument_list|(
argument|ADD_METATYPE_TEST_ROW
argument_list|)
DECL|macro|ADD_METATYPE_TEST_ROW
undef|#
directive|undef
name|ADD_METATYPE_TEST_ROW
block|}
end_function
begin_function
DECL|function|sizeOf
name|void
name|tst_QMetaType
operator|::
name|sizeOf
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QMetaType
operator|::
name|Type
argument_list|,
name|type
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|sizeOf
argument_list|(
name|type
argument_list|)
argument_list|,
name|size
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|construct_data
name|void
name|tst_QMetaType
operator|::
name|construct_data
parameter_list|()
block|{
name|create_data
argument_list|()
expr_stmt|;
block|}
end_function
begin_ifndef
ifndef|#
directive|ifndef
name|Q_ALIGNOF
end_ifndef
begin_struct
template|template
parameter_list|<
name|uint
name|N
parameter_list|>
struct|struct
DECL|struct|RoundToNextHighestPowerOfTwo
name|RoundToNextHighestPowerOfTwo
block|{
private|private:
DECL|enumerator|V1
enum|enum
block|{
name|V1
init|=
name|N
operator|-
literal|1
block|}
enum|;
DECL|enumerator|V2
enum|enum
block|{
name|V2
init|=
name|V1
operator||
operator|(
name|V1
operator|>>
literal|1
operator|)
block|}
enum|;
DECL|enumerator|V3
enum|enum
block|{
name|V3
init|=
name|V2
operator||
operator|(
name|V2
operator|>>
literal|2
operator|)
block|}
enum|;
DECL|enumerator|V4
enum|enum
block|{
name|V4
init|=
name|V3
operator||
operator|(
name|V3
operator|>>
literal|4
operator|)
block|}
enum|;
DECL|enumerator|V5
enum|enum
block|{
name|V5
init|=
name|V4
operator||
operator|(
name|V4
operator|>>
literal|8
operator|)
block|}
enum|;
DECL|enumerator|V6
enum|enum
block|{
name|V6
init|=
name|V5
operator||
operator|(
name|V5
operator|>>
literal|16
operator|)
block|}
enum|;
public|public:
DECL|enumerator|Value
enum|enum
block|{
name|Value
init|=
name|V6
operator|+
literal|1
block|}
enum|;
block|}
struct|;
end_struct
begin_endif
endif|#
directive|endif
end_endif
begin_struct
template|template
parameter_list|<
name|class
name|T
parameter_list|>
struct|struct
DECL|struct|TypeAlignment
name|TypeAlignment
block|{
ifdef|#
directive|ifdef
name|Q_ALIGNOF
DECL|enumerator|Value
enum|enum
block|{
name|Value
init|=
name|Q_ALIGNOF
argument_list|(
argument|T
argument_list|)
block|}
enum|;
else|#
directive|else
enum|enum
block|{
name|Value
init|=
name|RoundToNextHighestPowerOfTwo
operator|<
sizeof|sizeof
argument_list|(
name|T
argument_list|)
operator|>
operator|::
name|Value
block|}
enum|;
endif|#
directive|endif
block|}
struct|;
end_struct
begin_function
template|template
parameter_list|<
name|int
name|ID
parameter_list|>
DECL|function|testConstructHelper
specifier|static
name|void
name|testConstructHelper
parameter_list|()
block|{
typedef|typedef
typename|typename
name|MetaEnumToType
argument_list|<
name|ID
argument_list|>
operator|::
name|Type
name|Type
typedef|;
name|int
name|size
init|=
name|QMetaType
operator|::
name|sizeOf
argument_list|(
name|ID
argument_list|)
decl_stmt|;
name|void
modifier|*
name|storage
init|=
name|qMallocAligned
argument_list|(
name|size
argument_list|,
name|TypeAlignment
argument_list|<
name|Type
argument_list|>
operator|::
name|Value
argument_list|)
decl_stmt|;
name|void
modifier|*
name|actual
init|=
name|QMetaType
operator|::
name|construct
argument_list|(
name|ID
argument_list|,
name|storage
argument_list|,
comment|/*copy=*/
literal|0
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|actual
argument_list|,
name|storage
argument_list|)
expr_stmt|;
if|if
condition|(
name|DefaultValueTraits
argument_list|<
name|ID
argument_list|>
operator|::
name|IsInitialized
condition|)
block|{
name|Type
modifier|*
name|expected
init|=
name|DefaultValueFactory
argument_list|<
name|ID
argument_list|>
operator|::
name|create
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
operator|*
cast|static_cast
argument_list|<
name|Type
operator|*
argument_list|>
argument_list|(
name|actual
argument_list|)
argument_list|,
operator|*
name|expected
argument_list|)
expr_stmt|;
operator|delete
name|expected
expr_stmt|;
block|}
name|QMetaType
operator|::
name|destruct
argument_list|(
name|ID
argument_list|,
name|actual
argument_list|)
expr_stmt|;
name|qFreeAligned
argument_list|(
name|storage
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QMetaType
operator|::
name|construct
argument_list|(
name|ID
argument_list|,
literal|0
argument_list|,
comment|/*copy=*/
literal|0
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
name|QMetaType
operator|::
name|destruct
argument_list|(
name|ID
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|construct
name|void
name|tst_QMetaType
operator|::
name|construct
parameter_list|()
block|{
struct|struct
name|TypeTestFunctionGetter
block|{
specifier|static
name|TypeTestFunction
name|get
parameter_list|(
name|int
name|type
parameter_list|)
block|{
switch|switch
condition|(
name|type
condition|)
block|{
DECL|macro|RETURN_CONSTRUCT_FUNCTION
define|#
directive|define
name|RETURN_CONSTRUCT_FUNCTION
parameter_list|(
name|TYPE
parameter_list|,
name|ID
parameter_list|)
define|\
value|case QMetaType::ID: \             return testConstructHelper<QMetaType::ID>;
name|FOR_EACH_CORE_METATYPE
argument_list|(
argument|RETURN_CONSTRUCT_FUNCTION
argument_list|)
DECL|macro|RETURN_CONSTRUCT_FUNCTION
undef|#
directive|undef
name|RETURN_CONSTRUCT_FUNCTION
block|}
return|return
literal|0
return|;
block|}
block|}
struct|;
name|QFETCH
argument_list|(
name|QMetaType
operator|::
name|Type
argument_list|,
name|type
argument_list|)
expr_stmt|;
name|TypeTestFunctionGetter
operator|::
name|get
function_decl|(
name|type
function_decl|)
parameter_list|()
function_decl|;
block|}
end_function
begin_function
template|template
parameter_list|<
name|int
name|ID
parameter_list|>
DECL|function|testConstructCopyHelper
specifier|static
name|void
name|testConstructCopyHelper
parameter_list|()
block|{
typedef|typedef
typename|typename
name|MetaEnumToType
argument_list|<
name|ID
argument_list|>
operator|::
name|Type
name|Type
typedef|;
name|Type
modifier|*
name|expected
init|=
name|TestValueFactory
argument_list|<
name|ID
argument_list|>
operator|::
name|create
argument_list|()
decl_stmt|;
name|int
name|size
init|=
name|QMetaType
operator|::
name|sizeOf
argument_list|(
name|ID
argument_list|)
decl_stmt|;
name|void
modifier|*
name|storage
init|=
name|qMallocAligned
argument_list|(
name|size
argument_list|,
name|TypeAlignment
argument_list|<
name|Type
argument_list|>
operator|::
name|Value
argument_list|)
decl_stmt|;
name|void
modifier|*
name|actual
init|=
name|QMetaType
operator|::
name|construct
argument_list|(
name|ID
argument_list|,
name|storage
argument_list|,
name|expected
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|actual
argument_list|,
name|storage
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
operator|*
cast|static_cast
argument_list|<
name|Type
operator|*
argument_list|>
argument_list|(
name|actual
argument_list|)
argument_list|,
operator|*
name|expected
argument_list|)
expr_stmt|;
name|QMetaType
operator|::
name|destruct
argument_list|(
name|ID
argument_list|,
name|actual
argument_list|)
expr_stmt|;
name|qFreeAligned
argument_list|(
name|storage
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|QMetaType
operator|::
name|construct
argument_list|(
name|ID
argument_list|,
literal|0
argument_list|,
name|expected
argument_list|)
operator|==
literal|0
argument_list|)
expr_stmt|;
operator|delete
name|expected
expr_stmt|;
block|}
end_function
begin_function
DECL|function|constructCopy_data
name|void
name|tst_QMetaType
operator|::
name|constructCopy_data
parameter_list|()
block|{
name|create_data
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|constructCopy
name|void
name|tst_QMetaType
operator|::
name|constructCopy
parameter_list|()
block|{
struct|struct
name|TypeTestFunctionGetter
block|{
specifier|static
name|TypeTestFunction
name|get
parameter_list|(
name|int
name|type
parameter_list|)
block|{
switch|switch
condition|(
name|type
condition|)
block|{
DECL|macro|RETURN_CONSTRUCT_COPY_FUNCTION
define|#
directive|define
name|RETURN_CONSTRUCT_COPY_FUNCTION
parameter_list|(
name|TYPE
parameter_list|,
name|ID
parameter_list|)
define|\
value|case QMetaType::ID: \             return testConstructCopyHelper<QMetaType::ID>;
name|FOR_EACH_CORE_METATYPE
argument_list|(
argument|RETURN_CONSTRUCT_COPY_FUNCTION
argument_list|)
DECL|macro|RETURN_CONSTRUCT_COPY_FUNCTION
undef|#
directive|undef
name|RETURN_CONSTRUCT_COPY_FUNCTION
block|}
return|return
literal|0
return|;
block|}
block|}
struct|;
name|QFETCH
argument_list|(
name|QMetaType
operator|::
name|Type
argument_list|,
name|type
argument_list|)
expr_stmt|;
name|TypeTestFunctionGetter
operator|::
name|get
function_decl|(
name|type
function_decl|)
parameter_list|()
function_decl|;
block|}
end_function
begin_typedef
DECL|typedef|CustomString
typedef|typedef
name|QString
name|CustomString
typedef|;
end_typedef
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|CustomString
argument_list|)
end_macro
begin_comment
comment|//this line is useless
end_comment
begin_function
DECL|function|typedefs
name|void
name|tst_QMetaType
operator|::
name|typedefs
parameter_list|()
block|{
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|"long long"
argument_list|)
argument_list|,
name|int
argument_list|(
name|QMetaType
operator|::
name|LongLong
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|"unsigned long long"
argument_list|)
argument_list|,
name|int
argument_list|(
name|QMetaType
operator|::
name|ULongLong
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|"qint8"
argument_list|)
argument_list|,
name|int
argument_list|(
name|QMetaType
operator|::
name|Char
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|"quint8"
argument_list|)
argument_list|,
name|int
argument_list|(
name|QMetaType
operator|::
name|UChar
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|"qint16"
argument_list|)
argument_list|,
name|int
argument_list|(
name|QMetaType
operator|::
name|Short
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|"quint16"
argument_list|)
argument_list|,
name|int
argument_list|(
name|QMetaType
operator|::
name|UShort
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|"qint32"
argument_list|)
argument_list|,
name|int
argument_list|(
name|QMetaType
operator|::
name|Int
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|"quint32"
argument_list|)
argument_list|,
name|int
argument_list|(
name|QMetaType
operator|::
name|UInt
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|"qint64"
argument_list|)
argument_list|,
name|int
argument_list|(
name|QMetaType
operator|::
name|LongLong
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|"quint64"
argument_list|)
argument_list|,
name|int
argument_list|(
name|QMetaType
operator|::
name|ULongLong
argument_list|)
argument_list|)
expr_stmt|;
comment|// make sure the qreal typeId is the type id of the type it's defined to
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|"qreal"
argument_list|)
argument_list|,
operator|::
name|qMetaTypeId
argument_list|<
name|qreal
argument_list|>
argument_list|()
argument_list|)
expr_stmt|;
name|qRegisterMetaType
argument_list|<
name|CustomString
argument_list|>
argument_list|(
literal|"CustomString"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|"CustomString"
argument_list|)
argument_list|,
operator|::
name|qMetaTypeId
argument_list|<
name|CustomString
argument_list|>
argument_list|()
argument_list|)
expr_stmt|;
typedef|typedef
name|Whity
argument_list|<
name|double
argument_list|>
name|WhityDouble
typedef|;
name|qRegisterMetaType
argument_list|<
name|WhityDouble
argument_list|>
argument_list|(
literal|"WhityDouble"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|type
argument_list|(
literal|"WhityDouble"
argument_list|)
argument_list|,
operator|::
name|qMetaTypeId
argument_list|<
name|WhityDouble
argument_list|>
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|IsRegisteredDummyType
class|class
name|IsRegisteredDummyType
block|{
block|}
class|;
end_class
begin_function
DECL|function|isRegistered_data
name|void
name|tst_QMetaType
operator|::
name|isRegistered_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"typeId"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"registered"
argument_list|)
expr_stmt|;
comment|// predefined/custom types
name|QTest
operator|::
name|newRow
argument_list|(
literal|"QMetaType::Void"
argument_list|)
operator|<<
name|int
argument_list|(
name|QMetaType
operator|::
name|Void
argument_list|)
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"QMetaType::Int"
argument_list|)
operator|<<
name|int
argument_list|(
name|QMetaType
operator|::
name|Int
argument_list|)
operator|<<
literal|true
expr_stmt|;
name|int
name|dummyTypeId
init|=
name|qRegisterMetaType
argument_list|<
name|IsRegisteredDummyType
argument_list|>
argument_list|(
literal|"IsRegisteredDummyType"
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"IsRegisteredDummyType"
argument_list|)
operator|<<
name|dummyTypeId
operator|<<
literal|true
expr_stmt|;
comment|// unknown types
name|QTest
operator|::
name|newRow
argument_list|(
literal|"-1"
argument_list|)
operator|<<
operator|-
literal|1
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"-42"
argument_list|)
operator|<<
operator|-
literal|42
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"IsRegisteredDummyType + 1"
argument_list|)
operator|<<
operator|(
name|dummyTypeId
operator|+
literal|1
operator|)
operator|<<
literal|false
expr_stmt|;
block|}
end_function
begin_function
DECL|function|isRegistered
name|void
name|tst_QMetaType
operator|::
name|isRegistered
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|int
argument_list|,
name|typeId
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|registered
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|isRegistered
argument_list|(
name|typeId
argument_list|)
argument_list|,
name|registered
argument_list|)
expr_stmt|;
block|}
end_function
begin_class
DECL|class|RegUnreg
class|class
name|RegUnreg
block|{
public|public:
DECL|function|RegUnreg
name|RegUnreg
parameter_list|()
block|{}
empty_stmt|;
DECL|function|RegUnreg
name|RegUnreg
parameter_list|(
specifier|const
name|RegUnreg
modifier|&
parameter_list|)
block|{}
empty_stmt|;
DECL|function|~RegUnreg
name|~
name|RegUnreg
parameter_list|()
block|{}
empty_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|unregisterType
name|void
name|tst_QMetaType
operator|::
name|unregisterType
parameter_list|()
block|{
comment|// cannot unregister standard types
name|int
name|typeId
init|=
name|qRegisterMetaType
argument_list|<
name|QList
argument_list|<
name|QVariant
argument_list|>
argument_list|>
argument_list|(
literal|"QList<QVariant>"
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|isRegistered
argument_list|(
name|typeId
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QMetaType
operator|::
name|unregisterType
argument_list|(
literal|"QList<QVariant>"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|isRegistered
argument_list|(
name|typeId
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
comment|// allow unregister user types
name|typeId
operator|=
name|qRegisterMetaType
argument_list|<
name|RegUnreg
argument_list|>
argument_list|(
literal|"RegUnreg"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|isRegistered
argument_list|(
name|typeId
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QMetaType
operator|::
name|unregisterType
argument_list|(
literal|"RegUnreg"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QMetaType
operator|::
name|isRegistered
argument_list|(
name|typeId
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|QTBUG11316_registerStreamBuiltin
name|void
name|tst_QMetaType
operator|::
name|QTBUG11316_registerStreamBuiltin
parameter_list|()
block|{
comment|//should not crash;
name|qRegisterMetaTypeStreamOperators
argument_list|<
name|QString
argument_list|>
argument_list|(
literal|"QString"
argument_list|)
expr_stmt|;
name|qRegisterMetaTypeStreamOperators
argument_list|<
name|QVariant
argument_list|>
argument_list|(
literal|"QVariant"
argument_list|)
expr_stmt|;
block|}
end_function
begin_macro
name|QTEST_MAIN
argument_list|(
argument|tst_QMetaType
argument_list|)
end_macro
begin_include
include|#
directive|include
file|"tst_qmetatype.moc"
end_include
end_unit
