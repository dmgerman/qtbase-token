begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2015 The Qt Company Ltd. ** Contact: http://www.qt.io/licensing/ ** ** This file is part of the test suite of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL21$ ** Commercial License Usage ** Licensees holding valid commercial Qt licenses may use this file in ** accordance with the commercial license agreement provided with the ** Software or, alternatively, in accordance with the terms contained in ** a written agreement between you and The Qt Company. For licensing terms ** and conditions see http://www.qt.io/terms-conditions. For further ** information use the contact form at http://www.qt.io/contact-us. ** ** GNU Lesser General Public License Usage ** Alternatively, this file may be used under the terms of the GNU Lesser ** General Public License version 2.1 or version 3 as published by the Free ** Software Foundation and appearing in the file LICENSE.LGPLv21 and ** LICENSE.LGPLv3 included in the packaging of this file. Please review the ** following information to ensure the GNU Lesser General Public License ** requirements will be met: https://www.gnu.org/licenses/lgpl.html and ** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html. ** ** As a special exception, The Qt Company gives you certain additional ** rights. These rights are described in The Qt Company LGPL Exception ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package. ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<QtTest/QtTest>
end_include
begin_include
include|#
directive|include
file|<QtCore/qparallelanimationgroup.h>
end_include
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|QAbstractAnimation::State
argument_list|)
end_macro
begin_class
DECL|class|tst_QParallelAnimationGroup
class|class
name|tst_QParallelAnimationGroup
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
public|public
name|Q_SLOTS
public|:
name|void
name|initTestCase
parameter_list|()
function_decl|;
private|private
name|slots
private|:
name|void
name|construction
parameter_list|()
function_decl|;
name|void
name|setCurrentTime
parameter_list|()
function_decl|;
name|void
name|stateChanged
parameter_list|()
function_decl|;
name|void
name|clearGroup
parameter_list|()
function_decl|;
name|void
name|propagateGroupUpdateToChildren
parameter_list|()
function_decl|;
name|void
name|updateChildrenWithRunningGroup
parameter_list|()
function_decl|;
name|void
name|deleteChildrenWithRunningGroup
parameter_list|()
function_decl|;
name|void
name|startChildrenWithStoppedGroup
parameter_list|()
function_decl|;
name|void
name|stopGroupWithRunningChild
parameter_list|()
function_decl|;
name|void
name|startGroupWithRunningChild
parameter_list|()
function_decl|;
name|void
name|zeroDurationAnimation
parameter_list|()
function_decl|;
name|void
name|stopUncontrolledAnimations
parameter_list|()
function_decl|;
name|void
name|loopCount_data
parameter_list|()
function_decl|;
name|void
name|loopCount
parameter_list|()
function_decl|;
name|void
name|autoAdd
parameter_list|()
function_decl|;
name|void
name|pauseResume
parameter_list|()
function_decl|;
name|void
name|crashWhenRemovingUncontrolledAnimation
parameter_list|()
function_decl|;
block|}
class|;
end_class
begin_function
DECL|function|initTestCase
name|void
name|tst_QParallelAnimationGroup
operator|::
name|initTestCase
parameter_list|()
block|{
name|qRegisterMetaType
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
literal|"QAbstractAnimation::State"
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|Q_OS_MAC
argument_list|)
operator|||
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
comment|// give the mac/wince app start event queue time to clear
name|QTest
operator|::
name|qWait
argument_list|(
literal|1000
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function
begin_function
DECL|function|construction
name|void
name|tst_QParallelAnimationGroup
operator|::
name|construction
parameter_list|()
block|{
name|QParallelAnimationGroup
name|animationgroup
decl_stmt|;
block|}
end_function
begin_class
DECL|class|AnimationObject
class|class
name|AnimationObject
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
name|Q_PROPERTY
parameter_list|(
name|int
name|value
name|READ
name|value
name|WRITE
name|setValue
parameter_list|)
specifier|public
private|:
DECL|function|AnimationObject
name|AnimationObject
parameter_list|(
name|int
name|startValue
init|=
literal|0
parameter_list|)
member_init_list|:
name|v
argument_list|(
name|startValue
argument_list|)
block|{ }
DECL|function|value
name|int
name|value
parameter_list|()
specifier|const
block|{
return|return
name|v
return|;
block|}
DECL|function|setValue
name|void
name|setValue
parameter_list|(
name|int
name|value
parameter_list|)
block|{
name|v
operator|=
name|value
expr_stmt|;
block|}
DECL|member|v
name|int
name|v
decl_stmt|;
block|}
class|;
end_class
begin_class
DECL|class|TestAnimation
class|class
name|TestAnimation
super|:
specifier|public
name|QVariantAnimation
block|{
name|Q_OBJECT
public|public:
DECL|function|updateCurrentValue
specifier|virtual
name|void
name|updateCurrentValue
parameter_list|(
specifier|const
name|QVariant
modifier|&
name|value
parameter_list|)
block|{
name|Q_UNUSED
argument_list|(
argument|value
argument_list|)
block|}
empty_stmt|;
DECL|function|updateState
specifier|virtual
name|void
name|updateState
parameter_list|(
name|QAbstractAnimation
operator|::
name|State
name|newState
parameter_list|,
name|QAbstractAnimation
operator|::
name|State
name|oldState
parameter_list|)
block|{
name|Q_UNUSED
argument_list|(
argument|oldState
argument_list|)
name|Q_UNUSED
argument_list|(
argument|newState
argument_list|)
block|}
empty_stmt|;
block|}
class|;
end_class
begin_class
DECL|class|TestAnimation2
class|class
name|TestAnimation2
super|:
specifier|public
name|QVariantAnimation
block|{
name|Q_OBJECT
public|public:
DECL|function|TestAnimation2
name|TestAnimation2
parameter_list|(
name|QAbstractAnimation
modifier|*
name|animation
parameter_list|)
member_init_list|:
name|QVariantAnimation
argument_list|(
name|animation
argument_list|)
block|{}
DECL|function|TestAnimation2
name|TestAnimation2
parameter_list|(
name|int
name|duration
parameter_list|,
name|QAbstractAnimation
modifier|*
name|animation
parameter_list|)
member_init_list|:
name|QVariantAnimation
argument_list|(
name|animation
argument_list|)
member_init_list|,
name|m_duration
argument_list|(
name|duration
argument_list|)
block|{}
DECL|function|updateCurrentValue
specifier|virtual
name|void
name|updateCurrentValue
parameter_list|(
specifier|const
name|QVariant
modifier|&
name|value
parameter_list|)
block|{
name|Q_UNUSED
argument_list|(
argument|value
argument_list|)
block|}
empty_stmt|;
DECL|function|updateState
specifier|virtual
name|void
name|updateState
parameter_list|(
name|QAbstractAnimation
operator|::
name|State
name|newState
parameter_list|,
name|QAbstractAnimation
operator|::
name|State
name|oldState
parameter_list|)
block|{
name|Q_UNUSED
argument_list|(
argument|oldState
argument_list|)
name|Q_UNUSED
argument_list|(
argument|newState
argument_list|)
block|}
empty_stmt|;
DECL|function|duration
specifier|virtual
name|int
name|duration
parameter_list|()
specifier|const
block|{
return|return
name|m_duration
return|;
block|}
private|private:
DECL|member|m_duration
name|int
name|m_duration
decl_stmt|;
block|}
class|;
end_class
begin_class
DECL|class|UncontrolledAnimation
class|class
name|UncontrolledAnimation
super|:
specifier|public
name|QPropertyAnimation
block|{
name|Q_OBJECT
public|public:
DECL|function|UncontrolledAnimation
name|UncontrolledAnimation
parameter_list|(
name|QObject
modifier|*
name|target
parameter_list|,
specifier|const
name|QByteArray
modifier|&
name|propertyName
parameter_list|,
name|QObject
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QPropertyAnimation
argument_list|(
name|target
argument_list|,
name|propertyName
argument_list|,
name|parent
argument_list|)
member_init_list|,
name|id
argument_list|(
literal|0
argument_list|)
block|{
name|setDuration
argument_list|(
literal|250
argument_list|)
expr_stmt|;
name|setEndValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
DECL|function|duration
name|int
name|duration
parameter_list|()
specifier|const
block|{
return|return
operator|-
literal|1
return|;
comment|/* not time driven */
block|}
protected|protected:
DECL|function|timerEvent
name|void
name|timerEvent
parameter_list|(
name|QTimerEvent
modifier|*
name|event
parameter_list|)
block|{
if|if
condition|(
name|event
operator|->
name|timerId
argument_list|()
operator|==
name|id
condition|)
name|stop
argument_list|()
expr_stmt|;
block|}
DECL|function|updateRunning
name|void
name|updateRunning
parameter_list|(
name|bool
name|running
parameter_list|)
block|{
if|if
condition|(
name|running
condition|)
block|{
name|id
operator|=
name|startTimer
argument_list|(
literal|500
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|killTimer
argument_list|(
name|id
argument_list|)
expr_stmt|;
name|id
operator|=
literal|0
expr_stmt|;
block|}
block|}
private|private:
DECL|member|id
name|int
name|id
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|setCurrentTime
name|void
name|tst_QParallelAnimationGroup
operator|::
name|setCurrentTime
parameter_list|()
block|{
name|AnimationObject
name|p_o1
decl_stmt|;
name|AnimationObject
name|p_o2
decl_stmt|;
name|AnimationObject
name|p_o3
decl_stmt|;
name|AnimationObject
name|t_o1
decl_stmt|;
name|AnimationObject
name|t_o2
decl_stmt|;
comment|// parallel operating on different object/properties
name|QAnimationGroup
modifier|*
name|parallel
init|=
operator|new
name|QParallelAnimationGroup
argument_list|()
decl_stmt|;
name|QVariantAnimation
modifier|*
name|a1_p_o1
init|=
operator|new
name|QPropertyAnimation
argument_list|(
operator|&
name|p_o1
argument_list|,
literal|"value"
argument_list|)
decl_stmt|;
name|QVariantAnimation
modifier|*
name|a1_p_o2
init|=
operator|new
name|QPropertyAnimation
argument_list|(
operator|&
name|p_o2
argument_list|,
literal|"value"
argument_list|)
decl_stmt|;
name|QVariantAnimation
modifier|*
name|a1_p_o3
init|=
operator|new
name|QPropertyAnimation
argument_list|(
operator|&
name|p_o3
argument_list|,
literal|"value"
argument_list|)
decl_stmt|;
name|a1_p_o2
operator|->
name|setLoopCount
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|parallel
operator|->
name|addAnimation
argument_list|(
name|a1_p_o1
argument_list|)
expr_stmt|;
name|parallel
operator|->
name|addAnimation
argument_list|(
name|a1_p_o2
argument_list|)
expr_stmt|;
name|parallel
operator|->
name|addAnimation
argument_list|(
name|a1_p_o3
argument_list|)
expr_stmt|;
name|UncontrolledAnimation
modifier|*
name|notTimeDriven
init|=
operator|new
name|UncontrolledAnimation
argument_list|(
operator|&
name|t_o1
argument_list|,
literal|"value"
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|notTimeDriven
operator|->
name|totalDuration
argument_list|()
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QVariantAnimation
modifier|*
name|loopsForever
init|=
operator|new
name|QPropertyAnimation
argument_list|(
operator|&
name|t_o2
argument_list|,
literal|"value"
argument_list|)
decl_stmt|;
name|loopsForever
operator|->
name|setLoopCount
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|loopsForever
operator|->
name|totalDuration
argument_list|()
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QParallelAnimationGroup
name|group
decl_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
name|parallel
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
name|notTimeDriven
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
name|loopsForever
argument_list|)
expr_stmt|;
comment|// Current time = 1
name|group
operator|.
name|setCurrentTime
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|parallel
operator|->
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a1_p_o1
operator|->
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a1_p_o2
operator|->
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a1_p_o3
operator|->
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|notTimeDriven
operator|->
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|loopsForever
operator|->
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|currentLoopTime
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a1_p_o1
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a1_p_o2
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a1_p_o3
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|notTimeDriven
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|loopsForever
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Current time = 250
name|group
operator|.
name|setCurrentTime
argument_list|(
literal|250
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|currentLoopTime
argument_list|()
argument_list|,
literal|250
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a1_p_o1
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
literal|250
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a1_p_o2
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a1_p_o2
operator|->
name|currentLoop
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a1_p_o3
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
literal|250
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|notTimeDriven
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
literal|250
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|loopsForever
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|loopsForever
operator|->
name|currentLoop
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// Current time = 251
name|group
operator|.
name|setCurrentTime
argument_list|(
literal|251
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|currentLoopTime
argument_list|()
argument_list|,
literal|251
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a1_p_o1
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
literal|250
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a1_p_o2
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a1_p_o2
operator|->
name|currentLoop
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|a1_p_o3
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
literal|250
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|notTimeDriven
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
literal|251
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|loopsForever
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|stateChanged
name|void
name|tst_QParallelAnimationGroup
operator|::
name|stateChanged
parameter_list|()
block|{
comment|//this ensures that the correct animations are started when starting the group
name|TestAnimation
modifier|*
name|anim1
init|=
operator|new
name|TestAnimation
decl_stmt|;
name|TestAnimation
modifier|*
name|anim2
init|=
operator|new
name|TestAnimation
decl_stmt|;
name|TestAnimation
modifier|*
name|anim3
init|=
operator|new
name|TestAnimation
decl_stmt|;
name|TestAnimation
modifier|*
name|anim4
init|=
operator|new
name|TestAnimation
decl_stmt|;
name|anim1
operator|->
name|setDuration
argument_list|(
literal|1000
argument_list|)
expr_stmt|;
name|anim2
operator|->
name|setDuration
argument_list|(
literal|2000
argument_list|)
expr_stmt|;
name|anim3
operator|->
name|setDuration
argument_list|(
literal|3000
argument_list|)
expr_stmt|;
name|anim4
operator|->
name|setDuration
argument_list|(
literal|3000
argument_list|)
expr_stmt|;
name|QParallelAnimationGroup
name|group
decl_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
name|anim1
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
name|anim2
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
name|anim3
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
name|anim4
argument_list|)
expr_stmt|;
name|QSignalSpy
name|spy1
argument_list|(
name|anim1
argument_list|,
operator|&
name|TestAnimation
operator|::
name|stateChanged
argument_list|)
decl_stmt|;
name|QSignalSpy
name|spy2
argument_list|(
name|anim2
argument_list|,
operator|&
name|TestAnimation
operator|::
name|stateChanged
argument_list|)
decl_stmt|;
name|QSignalSpy
name|spy3
argument_list|(
name|anim3
argument_list|,
operator|&
name|TestAnimation
operator|::
name|stateChanged
argument_list|)
decl_stmt|;
name|QSignalSpy
name|spy4
argument_list|(
name|anim4
argument_list|,
operator|&
name|TestAnimation
operator|::
name|stateChanged
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|spy1
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|spy2
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|spy3
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|spy4
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
comment|//first; let's start forward
name|group
operator|.
name|start
argument_list|()
expr_stmt|;
comment|//all the animations should be started
name|QCOMPARE
argument_list|(
name|spy1
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy1
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy2
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy2
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy3
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy3
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy4
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy4
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Running
argument_list|)
expr_stmt|;
name|group
operator|.
name|setCurrentTime
argument_list|(
literal|1500
argument_list|)
expr_stmt|;
comment|//anim1 should be finished
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy1
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy1
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy2
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//no change
name|QCOMPARE
argument_list|(
name|spy3
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//no change
name|QCOMPARE
argument_list|(
name|spy4
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//no change
name|group
operator|.
name|setCurrentTime
argument_list|(
literal|2500
argument_list|)
expr_stmt|;
comment|//anim2 should be finished
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy1
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|//no change
name|QCOMPARE
argument_list|(
name|spy2
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy2
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy3
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//no change
name|QCOMPARE
argument_list|(
name|spy4
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//no change
name|group
operator|.
name|setCurrentTime
argument_list|(
literal|3500
argument_list|)
expr_stmt|;
comment|//everything should be finished
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy1
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|//no change
name|QCOMPARE
argument_list|(
name|spy2
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|//no change
name|QCOMPARE
argument_list|(
name|spy3
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy3
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy4
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy4
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Stopped
argument_list|)
expr_stmt|;
comment|//cleanup
name|spy1
operator|.
name|clear
argument_list|()
expr_stmt|;
name|spy2
operator|.
name|clear
argument_list|()
expr_stmt|;
name|spy3
operator|.
name|clear
argument_list|()
expr_stmt|;
name|spy4
operator|.
name|clear
argument_list|()
expr_stmt|;
comment|//now let's try to reverse that
name|group
operator|.
name|setDirection
argument_list|(
name|QAbstractAnimation
operator|::
name|Backward
argument_list|)
expr_stmt|;
name|group
operator|.
name|start
argument_list|()
expr_stmt|;
comment|//only anim3 and anim4 should be started
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy1
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy2
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy3
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy3
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy4
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy4
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Running
argument_list|)
expr_stmt|;
name|group
operator|.
name|setCurrentTime
argument_list|(
literal|1500
argument_list|)
expr_stmt|;
comment|//anim2 should be started
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy1
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|//no change
name|QCOMPARE
argument_list|(
name|spy2
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy2
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy3
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//no change
name|QCOMPARE
argument_list|(
name|spy4
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//no change
name|group
operator|.
name|setCurrentTime
argument_list|(
literal|500
argument_list|)
expr_stmt|;
comment|//anim1 is finally also started
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy1
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy1
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy2
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//no change
name|QCOMPARE
argument_list|(
name|spy3
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//no change
name|QCOMPARE
argument_list|(
name|spy4
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//no change
name|group
operator|.
name|setCurrentTime
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|//everything should be stopped
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy1
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy1
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy2
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy2
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy3
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy3
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy4
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy4
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Stopped
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|clearGroup
name|void
name|tst_QParallelAnimationGroup
operator|::
name|clearGroup
parameter_list|()
block|{
name|QParallelAnimationGroup
name|group
decl_stmt|;
specifier|static
specifier|const
name|int
name|animationCount
init|=
literal|10
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|animationCount
condition|;
operator|++
name|i
control|)
block|{
operator|new
name|QParallelAnimationGroup
argument_list|(
operator|&
name|group
argument_list|)
expr_stmt|;
block|}
name|QCOMPARE
argument_list|(
name|group
operator|.
name|animationCount
argument_list|()
argument_list|,
name|animationCount
argument_list|)
expr_stmt|;
name|QPointer
argument_list|<
name|QAbstractAnimation
argument_list|>
name|children
index|[
name|animationCount
index|]
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|animationCount
condition|;
operator|++
name|i
control|)
block|{
name|QVERIFY
argument_list|(
name|group
operator|.
name|animationAt
argument_list|(
name|i
argument_list|)
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|children
index|[
name|i
index|]
operator|=
name|group
operator|.
name|animationAt
argument_list|(
name|i
argument_list|)
expr_stmt|;
block|}
name|group
operator|.
name|clear
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|animationCount
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|currentLoopTime
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|animationCount
condition|;
operator|++
name|i
control|)
name|QVERIFY
argument_list|(
name|children
index|[
name|i
index|]
operator|.
name|isNull
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|propagateGroupUpdateToChildren
name|void
name|tst_QParallelAnimationGroup
operator|::
name|propagateGroupUpdateToChildren
parameter_list|()
block|{
comment|// this test verifies if group state changes are updating its children correctly
name|QParallelAnimationGroup
name|group
decl_stmt|;
name|QObject
name|o
decl_stmt|;
name|o
operator|.
name|setProperty
argument_list|(
literal|"ole"
argument_list|,
literal|42
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|o
operator|.
name|property
argument_list|(
literal|"ole"
argument_list|)
operator|.
name|toInt
argument_list|()
argument_list|,
literal|42
argument_list|)
expr_stmt|;
name|QPropertyAnimation
name|anim1
argument_list|(
operator|&
name|o
argument_list|,
literal|"ole"
argument_list|)
decl_stmt|;
name|anim1
operator|.
name|setEndValue
argument_list|(
literal|43
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|setDuration
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|anim1
operator|.
name|currentValue
argument_list|()
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|currentValue
argument_list|()
operator|.
name|toInt
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|o
operator|.
name|property
argument_list|(
literal|"ole"
argument_list|)
operator|.
name|toInt
argument_list|()
argument_list|,
literal|42
argument_list|)
expr_stmt|;
name|TestAnimation
name|anim2
decl_stmt|;
name|anim2
operator|.
name|setStartValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|anim2
operator|.
name|setEndValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|anim2
operator|.
name|setDuration
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|anim2
operator|.
name|currentValue
argument_list|()
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim2
operator|.
name|currentValue
argument_list|()
operator|.
name|toInt
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim2
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|anim1
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|anim2
argument_list|)
expr_stmt|;
name|group
operator|.
name|start
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim2
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|group
operator|.
name|pause
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Paused
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Paused
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim2
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Paused
argument_list|)
expr_stmt|;
name|group
operator|.
name|stop
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim2
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|updateChildrenWithRunningGroup
name|void
name|tst_QParallelAnimationGroup
operator|::
name|updateChildrenWithRunningGroup
parameter_list|()
block|{
comment|// assert that its possible to modify a child's state directly while their group is running
name|QParallelAnimationGroup
name|group
decl_stmt|;
name|TestAnimation
name|anim
decl_stmt|;
name|anim
operator|.
name|setStartValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|anim
operator|.
name|setEndValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|anim
operator|.
name|setDuration
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|QSignalSpy
name|groupStateChangedSpy
argument_list|(
operator|&
name|group
argument_list|,
operator|&
name|QParallelAnimationGroup
operator|::
name|stateChanged
argument_list|)
decl_stmt|;
name|QSignalSpy
name|childStateChangedSpy
argument_list|(
operator|&
name|anim
argument_list|,
operator|&
name|TestAnimation
operator|::
name|stateChanged
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|groupStateChangedSpy
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|childStateChangedSpy
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|groupStateChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|childStateChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|anim
argument_list|)
expr_stmt|;
name|group
operator|.
name|start
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|groupStateChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|childStateChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|groupStateChangedSpy
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|childStateChangedSpy
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
comment|// starting directly a running child will not have any effect
name|anim
operator|.
name|start
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|groupStateChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|childStateChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|anim
operator|.
name|pause
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Paused
argument_list|)
expr_stmt|;
comment|// in the animation stops directly, the group will still be running
name|anim
operator|.
name|stop
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|deleteChildrenWithRunningGroup
name|void
name|tst_QParallelAnimationGroup
operator|::
name|deleteChildrenWithRunningGroup
parameter_list|()
block|{
comment|// test if children can be activated when their group is stopped
name|QParallelAnimationGroup
name|group
decl_stmt|;
name|QVariantAnimation
modifier|*
name|anim1
init|=
operator|new
name|TestAnimation
decl_stmt|;
name|anim1
operator|->
name|setStartValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|anim1
operator|->
name|setEndValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|anim1
operator|->
name|setDuration
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
name|anim1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|duration
argument_list|()
argument_list|,
name|anim1
operator|->
name|duration
argument_list|()
argument_list|)
expr_stmt|;
name|group
operator|.
name|start
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|->
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|80
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|group
operator|.
name|currentLoopTime
argument_list|()
operator|>
literal|0
argument_list|)
expr_stmt|;
operator|delete
name|anim1
expr_stmt|;
name|QVERIFY
argument_list|(
name|group
operator|.
name|animationCount
argument_list|()
operator|==
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|duration
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|currentLoopTime
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
comment|//that's the invariant
block|}
end_function
begin_function
DECL|function|startChildrenWithStoppedGroup
name|void
name|tst_QParallelAnimationGroup
operator|::
name|startChildrenWithStoppedGroup
parameter_list|()
block|{
comment|// test if children can be activated when their group is stopped
name|QParallelAnimationGroup
name|group
decl_stmt|;
name|TestAnimation
name|anim1
decl_stmt|;
name|anim1
operator|.
name|setStartValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|setEndValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|setDuration
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|TestAnimation
name|anim2
decl_stmt|;
name|anim2
operator|.
name|setStartValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|anim2
operator|.
name|setEndValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|anim2
operator|.
name|setDuration
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim2
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|anim1
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|anim2
argument_list|)
expr_stmt|;
name|group
operator|.
name|stop
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim2
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|start
argument_list|()
expr_stmt|;
name|anim2
operator|.
name|start
argument_list|()
expr_stmt|;
name|anim2
operator|.
name|pause
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim2
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Paused
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|stopGroupWithRunningChild
name|void
name|tst_QParallelAnimationGroup
operator|::
name|stopGroupWithRunningChild
parameter_list|()
block|{
comment|// children that started independently will not be affected by a group stop
name|QParallelAnimationGroup
name|group
decl_stmt|;
name|TestAnimation
name|anim1
decl_stmt|;
name|anim1
operator|.
name|setStartValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|setEndValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|setDuration
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|TestAnimation
name|anim2
decl_stmt|;
name|anim2
operator|.
name|setStartValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|anim2
operator|.
name|setEndValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|anim2
operator|.
name|setDuration
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim2
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|anim1
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|anim2
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|start
argument_list|()
expr_stmt|;
name|anim2
operator|.
name|start
argument_list|()
expr_stmt|;
name|anim2
operator|.
name|pause
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim2
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Paused
argument_list|)
expr_stmt|;
name|group
operator|.
name|stop
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim2
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Paused
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|stop
argument_list|()
expr_stmt|;
name|anim2
operator|.
name|stop
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim2
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|startGroupWithRunningChild
name|void
name|tst_QParallelAnimationGroup
operator|::
name|startGroupWithRunningChild
parameter_list|()
block|{
comment|// as the group has precedence over its children, starting a group will restart all the children
name|QParallelAnimationGroup
name|group
decl_stmt|;
name|TestAnimation
name|anim1
decl_stmt|;
name|anim1
operator|.
name|setStartValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|setEndValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|setDuration
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|TestAnimation
name|anim2
decl_stmt|;
name|anim2
operator|.
name|setStartValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|anim2
operator|.
name|setEndValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|anim2
operator|.
name|setDuration
argument_list|(
literal|200
argument_list|)
expr_stmt|;
name|QSignalSpy
name|stateChangedSpy1
argument_list|(
operator|&
name|anim1
argument_list|,
operator|&
name|TestAnimation
operator|::
name|stateChanged
argument_list|)
decl_stmt|;
name|QSignalSpy
name|stateChangedSpy2
argument_list|(
operator|&
name|anim2
argument_list|,
operator|&
name|TestAnimation
operator|::
name|stateChanged
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|stateChangedSpy1
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|stateChangedSpy2
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy1
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy2
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim2
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|anim1
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|anim2
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|start
argument_list|()
expr_stmt|;
name|anim2
operator|.
name|start
argument_list|()
expr_stmt|;
name|anim2
operator|.
name|pause
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|stateChangedSpy1
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|stateChangedSpy2
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|stateChangedSpy2
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|QAnimationGroup
operator|::
name|Paused
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim2
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Paused
argument_list|)
expr_stmt|;
name|group
operator|.
name|start
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy1
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|stateChangedSpy1
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|stateChangedSpy1
operator|.
name|at
argument_list|(
literal|2
argument_list|)
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy2
operator|.
name|count
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|stateChangedSpy2
operator|.
name|at
argument_list|(
literal|2
argument_list|)
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|stateChangedSpy2
operator|.
name|at
argument_list|(
literal|3
argument_list|)
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim2
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|zeroDurationAnimation
name|void
name|tst_QParallelAnimationGroup
operator|::
name|zeroDurationAnimation
parameter_list|()
block|{
name|QParallelAnimationGroup
name|group
decl_stmt|;
name|TestAnimation
name|anim1
decl_stmt|;
name|anim1
operator|.
name|setStartValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|setEndValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|setDuration
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|TestAnimation
name|anim2
decl_stmt|;
name|anim2
operator|.
name|setStartValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|anim2
operator|.
name|setEndValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|anim2
operator|.
name|setDuration
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|TestAnimation
name|anim3
decl_stmt|;
name|anim3
operator|.
name|setStartValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|anim3
operator|.
name|setEndValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|anim3
operator|.
name|setDuration
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|QSignalSpy
name|stateChangedSpy1
argument_list|(
operator|&
name|anim1
argument_list|,
operator|&
name|TestAnimation
operator|::
name|stateChanged
argument_list|)
decl_stmt|;
name|QSignalSpy
name|finishedSpy1
argument_list|(
operator|&
name|anim1
argument_list|,
operator|&
name|TestAnimation
operator|::
name|finished
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|stateChangedSpy1
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|finishedSpy1
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QSignalSpy
name|stateChangedSpy2
argument_list|(
operator|&
name|anim2
argument_list|,
operator|&
name|TestAnimation
operator|::
name|stateChanged
argument_list|)
decl_stmt|;
name|QSignalSpy
name|finishedSpy2
argument_list|(
operator|&
name|anim2
argument_list|,
operator|&
name|TestAnimation
operator|::
name|finished
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|stateChangedSpy2
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|finishedSpy2
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QSignalSpy
name|stateChangedSpy3
argument_list|(
operator|&
name|anim3
argument_list|,
operator|&
name|TestAnimation
operator|::
name|stateChanged
argument_list|)
decl_stmt|;
name|QSignalSpy
name|finishedSpy3
argument_list|(
operator|&
name|anim3
argument_list|,
operator|&
name|TestAnimation
operator|::
name|finished
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|stateChangedSpy3
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|finishedSpy3
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|anim1
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|anim2
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|anim3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy1
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|group
operator|.
name|start
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy1
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|finishedSpy1
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|stateChangedSpy1
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|stateChangedSpy1
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy2
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|finishedSpy2
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|stateChangedSpy1
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy3
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|finishedSpy3
operator|.
name|count
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|stateChangedSpy3
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim2
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim3
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|group
operator|.
name|stop
argument_list|()
expr_stmt|;
name|group
operator|.
name|setLoopCount
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|stateChangedSpy1
operator|.
name|clear
argument_list|()
expr_stmt|;
name|stateChangedSpy2
operator|.
name|clear
argument_list|()
expr_stmt|;
name|stateChangedSpy3
operator|.
name|clear
argument_list|()
expr_stmt|;
name|group
operator|.
name|start
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy1
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy2
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy3
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|group
operator|.
name|setCurrentTime
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy1
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy2
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy3
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|group
operator|.
name|setCurrentTime
argument_list|(
literal|150
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy1
operator|.
name|count
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy2
operator|.
name|count
argument_list|()
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy3
operator|.
name|count
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|group
operator|.
name|setCurrentTime
argument_list|(
literal|50
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy1
operator|.
name|count
argument_list|()
argument_list|,
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy2
operator|.
name|count
argument_list|()
argument_list|,
literal|5
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy3
operator|.
name|count
argument_list|()
argument_list|,
literal|6
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|stopUncontrolledAnimations
name|void
name|tst_QParallelAnimationGroup
operator|::
name|stopUncontrolledAnimations
parameter_list|()
block|{
name|QParallelAnimationGroup
name|group
decl_stmt|;
name|TestAnimation
name|anim1
decl_stmt|;
name|anim1
operator|.
name|setStartValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|setEndValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|setDuration
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|AnimationObject
name|o1
decl_stmt|;
name|UncontrolledAnimation
name|notTimeDriven
argument_list|(
operator|&
name|o1
argument_list|,
literal|"value"
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|notTimeDriven
operator|.
name|totalDuration
argument_list|()
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|TestAnimation
name|loopsForever
decl_stmt|;
name|loopsForever
operator|.
name|setStartValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|loopsForever
operator|.
name|setEndValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|loopsForever
operator|.
name|setDuration
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|loopsForever
operator|.
name|setLoopCount
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|QSignalSpy
name|stateChangedSpy
argument_list|(
operator|&
name|anim1
argument_list|,
operator|&
name|TestAnimation
operator|::
name|stateChanged
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|stateChangedSpy
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|anim1
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|notTimeDriven
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|loopsForever
argument_list|)
expr_stmt|;
name|group
operator|.
name|start
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|stateChangedSpy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|stateChangedSpy
operator|.
name|at
argument_list|(
literal|0
argument_list|)
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|stateChangedSpy
operator|.
name|at
argument_list|(
literal|1
argument_list|)
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|notTimeDriven
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|loopsForever
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|notTimeDriven
operator|.
name|stop
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|notTimeDriven
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|loopsForever
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|loopsForever
operator|.
name|stop
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|notTimeDriven
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|loopsForever
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Stopped
argument_list|)
expr_stmt|;
block|}
end_function
begin_struct
DECL|struct|AnimState
struct|struct
name|AnimState
block|{
DECL|function|AnimState
name|AnimState
parameter_list|(
name|int
name|time
init|=
operator|-
literal|1
parameter_list|)
member_init_list|:
name|time
argument_list|(
name|time
argument_list|)
member_init_list|,
name|state
argument_list|(
operator|-
literal|1
argument_list|)
block|{}
DECL|function|AnimState
name|AnimState
parameter_list|(
name|int
name|time
parameter_list|,
name|int
name|state
parameter_list|)
member_init_list|:
name|time
argument_list|(
name|time
argument_list|)
member_init_list|,
name|state
argument_list|(
name|state
argument_list|)
block|{}
DECL|member|time
name|int
name|time
decl_stmt|;
DECL|member|state
name|int
name|state
decl_stmt|;
block|}
struct|;
end_struct
begin_define
DECL|macro|Running
define|#
directive|define
name|Running
value|QAbstractAnimation::Running
end_define
begin_define
DECL|macro|Stopped
define|#
directive|define
name|Stopped
value|QAbstractAnimation::Stopped
end_define
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|AnimState
argument_list|)
end_macro
begin_function
DECL|function|loopCount_data
name|void
name|tst_QParallelAnimationGroup
operator|::
name|loopCount_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"directionBackward"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"setLoopCount"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"initialGroupTime"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"currentGroupTime"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|AnimState
argument_list|>
argument_list|(
literal|"expected1"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|AnimState
argument_list|>
argument_list|(
literal|"expected2"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|AnimState
argument_list|>
argument_list|(
literal|"expected3"
argument_list|)
expr_stmt|;
comment|//                                                                                  D U R A T I O N
comment|//                                                              100                           60*2                           0
comment|// direction = Forward
name|QTest
operator|::
name|newRow
argument_list|(
literal|"50"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|50
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"100"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|100
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|40
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"110"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|110
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"120"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|120
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"170"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|170
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"220"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|220
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|40
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"230"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|230
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"240"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|240
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"290"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|290
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"340"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|340
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|40
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"350"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|350
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"360"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|360
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|60
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"410"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|410
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|60
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"460"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|460
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|60
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"470"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|470
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|60
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"480"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|0
operator|<<
literal|480
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|60
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
comment|// direction = Forward, rewind
name|QTest
operator|::
name|newRow
argument_list|(
literal|"120-110"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|120
operator|<<
literal|110
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"120-50"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|120
operator|<<
literal|50
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"120-0"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|120
operator|<<
literal|0
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"300-110"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|300
operator|<<
literal|110
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"300-50"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|300
operator|<<
literal|50
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"300-0"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|300
operator|<<
literal|0
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"115-105"
argument_list|)
operator|<<
literal|false
operator|<<
literal|3
operator|<<
literal|115
operator|<<
literal|105
operator|<<
name|AnimState
argument_list|(
literal|42
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|45
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
comment|// direction = Backward
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b120-120"
argument_list|)
operator|<<
literal|true
operator|<<
literal|3
operator|<<
literal|120
operator|<<
literal|120
operator|<<
name|AnimState
argument_list|(
literal|42
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|60
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b120-110"
argument_list|)
operator|<<
literal|true
operator|<<
literal|3
operator|<<
literal|120
operator|<<
literal|110
operator|<<
name|AnimState
argument_list|(
literal|42
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b120-100"
argument_list|)
operator|<<
literal|true
operator|<<
literal|3
operator|<<
literal|120
operator|<<
literal|100
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|40
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b120-50"
argument_list|)
operator|<<
literal|true
operator|<<
literal|3
operator|<<
literal|120
operator|<<
literal|50
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b120-0"
argument_list|)
operator|<<
literal|true
operator|<<
literal|3
operator|<<
literal|120
operator|<<
literal|0
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b360-170"
argument_list|)
operator|<<
literal|true
operator|<<
literal|3
operator|<<
literal|360
operator|<<
literal|170
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b360-220"
argument_list|)
operator|<<
literal|true
operator|<<
literal|3
operator|<<
literal|360
operator|<<
literal|220
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|40
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b360-210"
argument_list|)
operator|<<
literal|true
operator|<<
literal|3
operator|<<
literal|360
operator|<<
literal|210
operator|<<
name|AnimState
argument_list|(
literal|90
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|30
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b360-120"
argument_list|)
operator|<<
literal|true
operator|<<
literal|3
operator|<<
literal|360
operator|<<
literal|120
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|60
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
comment|// rewind, direction = Backward
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b50-110"
argument_list|)
operator|<<
literal|true
operator|<<
literal|3
operator|<<
literal|50
operator|<<
literal|110
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b50-120"
argument_list|)
operator|<<
literal|true
operator|<<
literal|3
operator|<<
literal|50
operator|<<
literal|120
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|60
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b50-140"
argument_list|)
operator|<<
literal|true
operator|<<
literal|3
operator|<<
literal|50
operator|<<
literal|140
operator|<<
name|AnimState
argument_list|(
literal|20
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|20
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b50-240"
argument_list|)
operator|<<
literal|true
operator|<<
literal|3
operator|<<
literal|50
operator|<<
literal|240
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|60
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b50-260"
argument_list|)
operator|<<
literal|true
operator|<<
literal|3
operator|<<
literal|50
operator|<<
literal|260
operator|<<
name|AnimState
argument_list|(
literal|20
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|20
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b50-350"
argument_list|)
operator|<<
literal|true
operator|<<
literal|3
operator|<<
literal|50
operator|<<
literal|350
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
comment|// infinite looping
name|QTest
operator|::
name|newRow
argument_list|(
literal|"inf1220"
argument_list|)
operator|<<
literal|false
operator|<<
operator|-
literal|1
operator|<<
literal|0
operator|<<
literal|1220
operator|<<
name|AnimState
argument_list|(
literal|20
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|20
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"inf1310"
argument_list|)
operator|<<
literal|false
operator|<<
operator|-
literal|1
operator|<<
literal|0
operator|<<
literal|1310
operator|<<
name|AnimState
argument_list|(
literal|100
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
comment|// infinite looping, direction = Backward (will only loop once)
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b.inf120-120"
argument_list|)
operator|<<
literal|true
operator|<<
operator|-
literal|1
operator|<<
literal|120
operator|<<
literal|120
operator|<<
name|AnimState
argument_list|(
literal|42
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|60
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b.inf120-20"
argument_list|)
operator|<<
literal|true
operator|<<
operator|-
literal|1
operator|<<
literal|120
operator|<<
literal|20
operator|<<
name|AnimState
argument_list|(
literal|20
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|20
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"b.inf120-110"
argument_list|)
operator|<<
literal|true
operator|<<
operator|-
literal|1
operator|<<
literal|120
operator|<<
literal|110
operator|<<
name|AnimState
argument_list|(
literal|42
argument_list|,
name|Stopped
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|50
argument_list|,
name|Running
argument_list|)
operator|<<
name|AnimState
argument_list|(
literal|0
argument_list|,
name|Stopped
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|loopCount
name|void
name|tst_QParallelAnimationGroup
operator|::
name|loopCount
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|directionBackward
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|setLoopCount
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|initialGroupTime
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|currentGroupTime
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|AnimState
argument_list|,
name|expected1
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|AnimState
argument_list|,
name|expected2
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|AnimState
argument_list|,
name|expected3
argument_list|)
expr_stmt|;
name|QParallelAnimationGroup
name|group
decl_stmt|;
name|TestAnimation
name|anim1
decl_stmt|;
name|anim1
operator|.
name|setStartValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|setEndValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|setDuration
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|TestAnimation
name|anim2
decl_stmt|;
name|anim2
operator|.
name|setStartValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|anim2
operator|.
name|setEndValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|anim2
operator|.
name|setDuration
argument_list|(
literal|60
argument_list|)
expr_stmt|;
comment|//total 120
name|anim2
operator|.
name|setLoopCount
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|TestAnimation
name|anim3
decl_stmt|;
name|anim3
operator|.
name|setStartValue
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|anim3
operator|.
name|setEndValue
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|anim3
operator|.
name|setDuration
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|anim1
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|anim2
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
operator|&
name|anim3
argument_list|)
expr_stmt|;
name|group
operator|.
name|setLoopCount
argument_list|(
name|setLoopCount
argument_list|)
expr_stmt|;
if|if
condition|(
name|initialGroupTime
operator|>=
literal|0
condition|)
name|group
operator|.
name|setCurrentTime
argument_list|(
name|initialGroupTime
argument_list|)
expr_stmt|;
if|if
condition|(
name|directionBackward
condition|)
name|group
operator|.
name|setDirection
argument_list|(
name|QAbstractAnimation
operator|::
name|Backward
argument_list|)
expr_stmt|;
name|group
operator|.
name|start
argument_list|()
expr_stmt|;
if|if
condition|(
name|initialGroupTime
operator|>=
literal|0
condition|)
name|group
operator|.
name|setCurrentTime
argument_list|(
name|initialGroupTime
argument_list|)
expr_stmt|;
name|anim1
operator|.
name|setCurrentTime
argument_list|(
literal|42
argument_list|)
expr_stmt|;
comment|// 42 is "untouched"
name|anim2
operator|.
name|setCurrentTime
argument_list|(
literal|42
argument_list|)
expr_stmt|;
name|group
operator|.
name|setCurrentTime
argument_list|(
name|currentGroupTime
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim1
operator|.
name|currentLoopTime
argument_list|()
argument_list|,
name|expected1
operator|.
name|time
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim2
operator|.
name|currentLoopTime
argument_list|()
argument_list|,
name|expected2
operator|.
name|time
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim3
operator|.
name|currentLoopTime
argument_list|()
argument_list|,
name|expected3
operator|.
name|time
argument_list|)
expr_stmt|;
if|if
condition|(
name|expected1
operator|.
name|state
operator|>=
literal|0
condition|)
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|anim1
operator|.
name|state
argument_list|()
argument_list|)
argument_list|,
name|expected1
operator|.
name|state
argument_list|)
expr_stmt|;
if|if
condition|(
name|expected2
operator|.
name|state
operator|>=
literal|0
condition|)
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|anim2
operator|.
name|state
argument_list|()
argument_list|)
argument_list|,
name|expected2
operator|.
name|state
argument_list|)
expr_stmt|;
if|if
condition|(
name|expected3
operator|.
name|state
operator|>=
literal|0
condition|)
name|QCOMPARE
argument_list|(
name|int
argument_list|(
name|anim3
operator|.
name|state
argument_list|()
argument_list|)
argument_list|,
name|expected3
operator|.
name|state
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|autoAdd
name|void
name|tst_QParallelAnimationGroup
operator|::
name|autoAdd
parameter_list|()
block|{
name|QParallelAnimationGroup
name|group
decl_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|duration
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|TestAnimation2
modifier|*
name|test
init|=
operator|new
name|TestAnimation2
argument_list|(
literal|250
argument_list|,
operator|&
name|group
argument_list|)
decl_stmt|;
comment|// 0, duration = 250;
name|QCOMPARE
argument_list|(
name|test
operator|->
name|group
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QAnimationGroup
operator|*
argument_list|>
argument_list|(
operator|&
name|group
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|test
operator|->
name|duration
argument_list|()
argument_list|,
literal|250
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|duration
argument_list|()
argument_list|,
literal|250
argument_list|)
expr_stmt|;
name|test
operator|=
operator|new
name|TestAnimation2
argument_list|(
literal|750
argument_list|,
operator|&
name|group
argument_list|)
expr_stmt|;
comment|// 1
name|QCOMPARE
argument_list|(
name|test
operator|->
name|group
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QAnimationGroup
operator|*
argument_list|>
argument_list|(
operator|&
name|group
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|duration
argument_list|()
argument_list|,
literal|750
argument_list|)
expr_stmt|;
name|test
operator|=
operator|new
name|TestAnimation2
argument_list|(
literal|500
argument_list|,
operator|&
name|group
argument_list|)
expr_stmt|;
comment|// 2
name|QCOMPARE
argument_list|(
name|test
operator|->
name|group
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QAnimationGroup
operator|*
argument_list|>
argument_list|(
operator|&
name|group
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|duration
argument_list|()
argument_list|,
literal|750
argument_list|)
expr_stmt|;
operator|delete
name|group
operator|.
name|animationAt
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|// remove the one with duration = 750
name|QCOMPARE
argument_list|(
name|group
operator|.
name|duration
argument_list|()
argument_list|,
literal|500
argument_list|)
expr_stmt|;
operator|delete
name|group
operator|.
name|animationAt
argument_list|(
literal|1
argument_list|)
expr_stmt|;
comment|// remove the one with duration = 500
name|QCOMPARE
argument_list|(
name|group
operator|.
name|duration
argument_list|()
argument_list|,
literal|250
argument_list|)
expr_stmt|;
name|test
operator|=
cast|static_cast
argument_list|<
name|TestAnimation2
operator|*
argument_list|>
argument_list|(
name|group
operator|.
name|animationAt
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|test
operator|->
name|setParent
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|// remove the last one (with duration = 250)
name|QCOMPARE
argument_list|(
name|test
operator|->
name|group
argument_list|()
argument_list|,
cast|static_cast
argument_list|<
name|QAnimationGroup
operator|*
argument_list|>
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|duration
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|pauseResume
name|void
name|tst_QParallelAnimationGroup
operator|::
name|pauseResume
parameter_list|()
block|{
name|QParallelAnimationGroup
name|group
decl_stmt|;
name|TestAnimation2
modifier|*
name|anim
init|=
operator|new
name|TestAnimation2
argument_list|(
literal|250
argument_list|,
operator|&
name|group
argument_list|)
decl_stmt|;
comment|// 0, duration = 250;
name|QSignalSpy
name|spy
argument_list|(
name|anim
argument_list|,
operator|&
name|TestAnimation
operator|::
name|stateChanged
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|spy
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|duration
argument_list|()
argument_list|,
literal|250
argument_list|)
expr_stmt|;
name|group
operator|.
name|start
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim
operator|->
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|spy
operator|.
name|clear
argument_list|()
expr_stmt|;
specifier|const
name|int
name|currentTime
init|=
name|group
operator|.
name|currentLoopTime
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|anim
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
name|currentTime
argument_list|)
expr_stmt|;
name|group
operator|.
name|pause
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Paused
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|currentLoopTime
argument_list|()
argument_list|,
name|currentTime
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim
operator|->
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Paused
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
name|currentTime
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|spy
operator|.
name|clear
argument_list|()
expr_stmt|;
name|group
operator|.
name|resume
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|group
operator|.
name|currentLoopTime
argument_list|()
argument_list|,
name|currentTime
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim
operator|->
name|state
argument_list|()
argument_list|,
name|QAnimationGroup
operator|::
name|Running
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|anim
operator|->
name|currentLoopTime
argument_list|()
argument_list|,
name|currentTime
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|group
operator|.
name|stop
argument_list|()
expr_stmt|;
name|spy
operator|.
name|clear
argument_list|()
expr_stmt|;
operator|new
name|TestAnimation2
argument_list|(
literal|500
argument_list|,
operator|&
name|group
argument_list|)
expr_stmt|;
name|group
operator|.
name|start
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|//the animation should have been started
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Running
argument_list|)
expr_stmt|;
name|group
operator|.
name|setCurrentTime
argument_list|(
literal|250
argument_list|)
expr_stmt|;
comment|//end of first animation
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|//the animation should have been stopped
name|QCOMPARE
argument_list|(
name|qvariant_cast
argument_list|<
name|QAbstractAnimation
operator|::
name|State
argument_list|>
argument_list|(
name|spy
operator|.
name|last
argument_list|()
operator|.
name|first
argument_list|()
argument_list|)
argument_list|,
name|TestAnimation
operator|::
name|Stopped
argument_list|)
expr_stmt|;
name|group
operator|.
name|pause
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|//this shouldn't have changed
name|group
operator|.
name|resume
argument_list|()
expr_stmt|;
name|QCOMPARE
argument_list|(
name|spy
operator|.
name|count
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
comment|//this shouldn't have changed
block|}
end_function
begin_comment
comment|// This is a regression test for QTBUG-8910, where a crash occurred when the
end_comment
begin_comment
comment|// last animation was removed from a group.
end_comment
begin_function
DECL|function|crashWhenRemovingUncontrolledAnimation
name|void
name|tst_QParallelAnimationGroup
operator|::
name|crashWhenRemovingUncontrolledAnimation
parameter_list|()
block|{
name|QParallelAnimationGroup
name|group
decl_stmt|;
name|TestAnimation
modifier|*
name|anim
init|=
operator|new
name|TestAnimation
decl_stmt|;
name|anim
operator|->
name|setLoopCount
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|TestAnimation
modifier|*
name|anim2
init|=
operator|new
name|TestAnimation
decl_stmt|;
name|anim2
operator|->
name|setLoopCount
argument_list|(
operator|-
literal|1
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
name|anim
argument_list|)
expr_stmt|;
name|group
operator|.
name|addAnimation
argument_list|(
name|anim2
argument_list|)
expr_stmt|;
name|group
operator|.
name|start
argument_list|()
expr_stmt|;
operator|delete
name|anim
expr_stmt|;
comment|// it would crash here because the internals of the group would still have a reference to anim
operator|delete
name|anim2
expr_stmt|;
block|}
end_function
begin_macro
name|QTEST_MAIN
argument_list|(
argument|tst_QParallelAnimationGroup
argument_list|)
end_macro
begin_include
include|#
directive|include
file|"tst_qparallelanimationgroup.moc"
end_include
end_unit
