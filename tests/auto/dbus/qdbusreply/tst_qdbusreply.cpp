begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2016 The Qt Company Ltd. ** Contact: https://www.qt.io/licensing/ ** ** This file is part of the test suite of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:GPL-EXCEPT$ ** Commercial License Usage ** Licensees holding valid commercial Qt licenses may use this file in ** accordance with the commercial license agreement provided with the ** Software or, alternatively, in accordance with the terms contained in ** a written agreement between you and The Qt Company. For licensing terms ** and conditions see https://www.qt.io/terms-conditions. For further ** information use the contact form at https://www.qt.io/contact-us. ** ** GNU General Public License Usage ** Alternatively, this file may be used under the terms of the GNU ** General Public License version 3 as published by the Free Software ** Foundation with exceptions as appearing in the file LICENSE.GPL3-EXCEPT ** included in the packaging of this file. Please review the following ** information to ensure the GNU General Public License requirements will ** be met: https://www.gnu.org/licenses/gpl-3.0.html. ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<qcoreapplication.h>
end_include
begin_include
include|#
directive|include
file|<qdebug.h>
end_include
begin_include
include|#
directive|include
file|<qvariant.h>
end_include
begin_include
include|#
directive|include
file|<QtTest/QtTest>
end_include
begin_include
include|#
directive|include
file|<QtDBus>
end_include
begin_typedef
DECL|typedef|IntStringMap
typedef|typedef
name|QMap
argument_list|<
name|int
argument_list|,
name|QString
argument_list|>
name|IntStringMap
typedef|;
end_typedef
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|IntStringMap
argument_list|)
end_macro
begin_struct
DECL|struct|MyStruct
struct|struct
name|MyStruct
block|{
DECL|member|i
name|int
name|i
decl_stmt|;
DECL|member|s
name|QString
name|s
decl_stmt|;
DECL|function|MyStruct
name|MyStruct
parameter_list|()
member_init_list|:
name|i
argument_list|(
literal|1
argument_list|)
member_init_list|,
name|s
argument_list|(
literal|"String"
argument_list|)
block|{ }
DECL|function|operator ==
name|bool
name|operator
name|==
parameter_list|(
specifier|const
name|MyStruct
modifier|&
name|other
parameter_list|)
specifier|const
block|{
return|return
name|i
operator|==
name|other
operator|.
name|i
operator|&&
name|s
operator|==
name|other
operator|.
name|s
return|;
block|}
block|}
struct|;
end_struct
begin_macro
name|Q_DECLARE_METATYPE
argument_list|(
argument|MyStruct
argument_list|)
end_macro
begin_function
DECL|function|operator <<
name|QDBusArgument
modifier|&
name|operator
name|<<
parameter_list|(
name|QDBusArgument
modifier|&
name|arg
parameter_list|,
specifier|const
name|MyStruct
modifier|&
name|ms
parameter_list|)
block|{
name|arg
operator|.
name|beginStructure
argument_list|()
expr_stmt|;
name|arg
operator|<<
name|ms
operator|.
name|i
operator|<<
name|ms
operator|.
name|s
expr_stmt|;
name|arg
operator|.
name|endStructure
argument_list|()
expr_stmt|;
return|return
name|arg
return|;
block|}
end_function
begin_function
DECL|function|operator >>
specifier|const
name|QDBusArgument
modifier|&
name|operator
name|>>
parameter_list|(
specifier|const
name|QDBusArgument
modifier|&
name|arg
parameter_list|,
name|MyStruct
modifier|&
name|ms
parameter_list|)
block|{
name|arg
operator|.
name|beginStructure
argument_list|()
expr_stmt|;
name|arg
operator|>>
name|ms
operator|.
name|i
operator|>>
name|ms
operator|.
name|s
expr_stmt|;
name|arg
operator|.
name|endStructure
argument_list|()
expr_stmt|;
return|return
name|arg
return|;
block|}
end_function
begin_class_decl
class_decl|class
name|TypesInterface
class_decl|;
end_class_decl
begin_class
DECL|class|tst_QDBusReply
class|class
name|tst_QDBusReply
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
DECL|member|iface
name|QDBusInterface
modifier|*
name|iface
decl_stmt|;
DECL|member|adaptor
name|TypesInterface
modifier|*
name|adaptor
decl_stmt|;
public|public:
name|tst_QDBusReply
parameter_list|()
constructor_decl|;
private|private
name|slots
private|:
DECL|function|initTestCase
name|void
name|initTestCase
parameter_list|()
block|{
name|qDBusRegisterMetaType
argument_list|<
name|IntStringMap
argument_list|>
argument_list|()
expr_stmt|;
name|qDBusRegisterMetaType
argument_list|<
name|MyStruct
argument_list|>
argument_list|()
expr_stmt|;
block|}
name|void
name|init
parameter_list|()
function_decl|;
name|void
name|unconnected
parameter_list|()
function_decl|;
name|void
name|simpleTypes
parameter_list|()
function_decl|;
name|void
name|complexTypes
parameter_list|()
function_decl|;
name|void
name|wrongTypes
parameter_list|()
function_decl|;
name|void
name|error
parameter_list|()
function_decl|;
block|}
class|;
end_class
begin_class
DECL|class|TypesInterface
class|class
name|TypesInterface
super|:
specifier|public
name|QDBusAbstractAdaptor
block|{
name|Q_OBJECT
name|Q_CLASSINFO
argument_list|(
literal|"D-Bus Interface"
argument_list|,
literal|"org.qtproject.Qt.Autotests.TypesInterface"
argument_list|)
decl|public
range|:
DECL|function|TypesInterface
name|TypesInterface
argument_list|(
name|QObject
operator|*
name|parent
argument_list|)
operator|:
name|QDBusAbstractAdaptor
argument_list|(
argument|parent
argument_list|)
block|{ }
specifier|public
name|slots
operator|:
DECL|function|retrieveBool
name|bool
name|retrieveBool
argument_list|()
block|{
return|return
literal|true
return|;
block|}
DECL|function|retrieveUChar
name|uchar
name|retrieveUChar
parameter_list|()
block|{
return|return
literal|'A'
return|;
block|}
DECL|function|retrieveShort
name|short
name|retrieveShort
parameter_list|()
block|{
return|return
operator|-
literal|47
return|;
block|}
DECL|function|retrieveUShort
name|ushort
name|retrieveUShort
parameter_list|()
block|{
return|return
literal|42U
return|;
block|}
DECL|function|retrieveInt
name|int
name|retrieveInt
parameter_list|()
block|{
return|return
operator|-
literal|470000
return|;
block|}
DECL|function|retrieveUInt
name|uint
name|retrieveUInt
parameter_list|()
block|{
return|return
literal|42424242
return|;
block|}
DECL|function|retrieveLongLong
name|qlonglong
name|retrieveLongLong
parameter_list|()
block|{
return|return
operator|-
operator|(
name|Q_INT64_C
argument_list|(
literal|1
argument_list|)
operator|<<
literal|32
operator|)
return|;
block|}
DECL|function|retrieveULongLong
name|qulonglong
name|retrieveULongLong
parameter_list|()
block|{
return|return
name|Q_INT64_C
argument_list|(
literal|1
argument_list|)
operator|<<
literal|32
return|;
block|}
DECL|function|retrieveDouble
name|double
name|retrieveDouble
parameter_list|()
block|{
return|return
literal|1.5
return|;
block|}
DECL|function|retrieveString
name|QString
name|retrieveString
parameter_list|()
block|{
return|return
literal|"This string you should see"
return|;
block|}
DECL|function|retrieveObjectPath
name|QDBusObjectPath
name|retrieveObjectPath
parameter_list|()
block|{
return|return
name|QDBusObjectPath
argument_list|(
literal|"/"
argument_list|)
return|;
block|}
DECL|function|retrieveSignature
name|QDBusSignature
name|retrieveSignature
parameter_list|()
block|{
return|return
name|QDBusSignature
argument_list|(
literal|"g"
argument_list|)
return|;
block|}
DECL|function|retrieveVariant
name|QDBusVariant
name|retrieveVariant
parameter_list|()
block|{
return|return
name|QDBusVariant
argument_list|(
name|retrieveString
argument_list|()
argument_list|)
return|;
block|}
DECL|function|retrieveStringList
name|QStringList
name|retrieveStringList
parameter_list|()
block|{
return|return
name|QStringList
argument_list|()
operator|<<
literal|"one"
operator|<<
literal|"two"
return|;
block|}
DECL|function|retrieveByteArray
name|QByteArray
name|retrieveByteArray
parameter_list|()
block|{
return|return
literal|"Hello, World"
return|;
block|}
DECL|function|retrieveList
name|QVariantList
name|retrieveList
parameter_list|()
block|{
return|return
name|QVariantList
argument_list|()
operator|<<
name|retrieveInt
argument_list|()
operator|<<
name|retrieveString
argument_list|()
operator|<<
name|retrieveByteArray
argument_list|()
return|;
block|}
DECL|function|retrieveObjectPathList
name|QList
argument_list|<
name|QDBusObjectPath
argument_list|>
name|retrieveObjectPathList
parameter_list|()
block|{
return|return
name|QList
argument_list|<
name|QDBusObjectPath
argument_list|>
argument_list|()
operator|<<
name|QDBusObjectPath
argument_list|(
literal|"/"
argument_list|)
operator|<<
name|QDBusObjectPath
argument_list|(
literal|"/foo"
argument_list|)
return|;
block|}
DECL|function|retrieveMap
name|QVariantMap
name|retrieveMap
parameter_list|()
block|{
name|QVariantMap
name|map
decl_stmt|;
name|map
index|[
literal|"one"
index|]
operator|=
literal|1
expr_stmt|;
name|map
index|[
literal|"two"
index|]
operator|=
literal|2U
expr_stmt|;
name|map
index|[
literal|"string"
index|]
operator|=
name|retrieveString
argument_list|()
expr_stmt|;
name|map
index|[
literal|"stringlist"
index|]
operator|=
name|retrieveStringList
argument_list|()
expr_stmt|;
return|return
name|map
return|;
block|}
DECL|function|retrieveIntStringMap
name|IntStringMap
name|retrieveIntStringMap
parameter_list|()
block|{
name|IntStringMap
name|map
decl_stmt|;
name|map
index|[
literal|1
index|]
operator|=
literal|"1"
expr_stmt|;
name|map
index|[
literal|2
index|]
operator|=
literal|"2"
expr_stmt|;
name|map
index|[
operator|-
literal|1231456
index|]
operator|=
literal|"foo"
expr_stmt|;
return|return
name|map
return|;
block|}
DECL|function|retrieveStruct
name|MyStruct
name|retrieveStruct
parameter_list|()
block|{
return|return
name|MyStruct
argument_list|()
return|;
block|}
block|}
class|;
end_class
begin_constructor
DECL|function|tst_QDBusReply
name|tst_QDBusReply
operator|::
name|tst_QDBusReply
parameter_list|()
block|{
name|adaptor
operator|=
operator|new
name|TypesInterface
argument_list|(
name|this
argument_list|)
expr_stmt|;
name|QDBusConnection
operator|::
name|sessionBus
argument_list|()
operator|.
name|registerObject
argument_list|(
literal|"/"
argument_list|,
name|this
argument_list|)
expr_stmt|;
name|iface
operator|=
operator|new
name|QDBusInterface
argument_list|(
name|QDBusConnection
operator|::
name|sessionBus
argument_list|()
operator|.
name|baseService
argument_list|()
argument_list|,
literal|"/"
argument_list|,
literal|"org.qtproject.Qt.Autotests.TypesInterface"
argument_list|,
name|QDBusConnection
operator|::
name|sessionBus
argument_list|()
argument_list|,
name|this
argument_list|)
expr_stmt|;
block|}
end_constructor
begin_function
DECL|function|init
name|void
name|tst_QDBusReply
operator|::
name|init
parameter_list|()
block|{
name|QVERIFY
argument_list|(
name|iface
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|iface
operator|->
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|unconnected
name|void
name|tst_QDBusReply
operator|::
name|unconnected
parameter_list|()
block|{
name|QDBusConnection
name|con
argument_list|(
literal|"invalid stored connection"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|con
operator|.
name|isConnected
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusInterface
name|iface
argument_list|(
literal|"doesnt.matter"
argument_list|,
literal|"/"
argument_list|,
literal|"doesnt.matter"
argument_list|,
name|con
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|iface
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|void
argument_list|>
name|rvoid
init|=
name|iface
operator|.
name|asyncCall
argument_list|(
literal|"ReloadConfig"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rvoid
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|QString
argument_list|>
name|rstring
init|=
name|iface
operator|.
name|asyncCall
argument_list|(
literal|"GetId"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rstring
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|rstring
operator|.
name|value
argument_list|()
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|simpleTypes
name|void
name|tst_QDBusReply
operator|::
name|simpleTypes
parameter_list|()
block|{
name|QDBusReply
argument_list|<
name|bool
argument_list|>
name|rbool
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveBool"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rbool
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rbool
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveBool
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|uchar
argument_list|>
name|ruchar
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveUChar"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|ruchar
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|ruchar
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveUChar
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|short
argument_list|>
name|rshort
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveShort"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rshort
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rshort
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveShort
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|ushort
argument_list|>
name|rushort
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveUShort"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rushort
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rushort
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveUShort
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|int
argument_list|>
name|rint
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveInt"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rint
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rint
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveInt
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|uint
argument_list|>
name|ruint
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveUInt"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|ruint
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|ruint
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveUInt
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|qlonglong
argument_list|>
name|rqlonglong
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveLongLong"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rqlonglong
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rqlonglong
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveLongLong
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|qulonglong
argument_list|>
name|rqulonglong
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveULongLong"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rqulonglong
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rqulonglong
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveULongLong
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|double
argument_list|>
name|rdouble
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveDouble"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rdouble
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rdouble
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveDouble
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|QString
argument_list|>
name|rstring
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveString"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rstring
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rstring
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveString
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|QDBusObjectPath
argument_list|>
name|robjectpath
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveObjectPath"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|robjectpath
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|robjectpath
operator|.
name|value
argument_list|()
operator|.
name|path
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveObjectPath
argument_list|()
operator|.
name|path
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|QDBusSignature
argument_list|>
name|rsignature
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveSignature"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rsignature
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rsignature
operator|.
name|value
argument_list|()
operator|.
name|signature
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveSignature
argument_list|()
operator|.
name|signature
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|QDBusVariant
argument_list|>
name|rdbusvariant
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveVariant"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rdbusvariant
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rdbusvariant
operator|.
name|value
argument_list|()
operator|.
name|variant
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveVariant
argument_list|()
operator|.
name|variant
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|QVariant
argument_list|>
name|rvariant
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveVariant"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rvariant
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rvariant
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveVariant
argument_list|()
operator|.
name|variant
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|QByteArray
argument_list|>
name|rbytearray
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveByteArray"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rbytearray
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rbytearray
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveByteArray
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|QStringList
argument_list|>
name|rstringlist
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveStringList"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rstringlist
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rstringlist
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveStringList
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|complexTypes
name|void
name|tst_QDBusReply
operator|::
name|complexTypes
parameter_list|()
block|{
name|QDBusReply
argument_list|<
name|QVariantList
argument_list|>
name|rlist
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveList"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rlist
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rlist
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveList
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|QList
argument_list|<
name|QDBusObjectPath
argument_list|>
argument_list|>
name|rolist
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveObjectPathList"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rolist
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rolist
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveObjectPathList
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|QVariantMap
argument_list|>
name|rmap
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveMap"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rmap
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rmap
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveMap
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|IntStringMap
argument_list|>
name|rismap
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveIntStringMap"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rismap
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rismap
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveIntStringMap
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|MyStruct
argument_list|>
name|rstruct
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveStruct"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rstruct
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|rstruct
operator|.
name|value
argument_list|()
argument_list|,
name|adaptor
operator|->
name|retrieveStruct
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|wrongTypes
name|void
name|tst_QDBusReply
operator|::
name|wrongTypes
parameter_list|()
block|{
name|QDBusReply
argument_list|<
name|bool
argument_list|>
name|rbool
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveInt"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rbool
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|rbool
operator|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveShort"
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rbool
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|rbool
operator|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveStruct"
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rbool
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|short
argument_list|>
name|rshort
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveInt"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rshort
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|rshort
operator|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveBool"
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rshort
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|rshort
operator|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveStruct"
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rshort
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QDBusReply
argument_list|<
name|MyStruct
argument_list|>
name|rstruct
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveInt"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rstruct
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|rstruct
operator|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveShort"
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rstruct
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|rstruct
operator|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveIntStringMap"
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|rstruct
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|error
name|void
name|tst_QDBusReply
operator|::
name|error
parameter_list|()
block|{
block|{
comment|// Wrong type
name|QDBusReply
argument_list|<
name|bool
argument_list|>
name|result
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveInt"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|result
operator|.
name|error
argument_list|()
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Wrong type, const version
specifier|const
name|QDBusReply
argument_list|<
name|bool
argument_list|>
name|result
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveInt"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|result
operator|.
name|error
argument_list|()
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Ok type
name|QDBusReply
argument_list|<
name|void
argument_list|>
name|result
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveInt"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|result
operator|.
name|error
argument_list|()
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|{
comment|// Ok type, const version
specifier|const
name|QDBusReply
argument_list|<
name|void
argument_list|>
name|result
init|=
name|iface
operator|->
name|call
argument_list|(
name|QDBus
operator|::
name|BlockWithGui
argument_list|,
literal|"retrieveInt"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|result
operator|.
name|error
argument_list|()
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_macro
name|QTEST_MAIN
argument_list|(
argument|tst_QDBusReply
argument_list|)
end_macro
begin_include
include|#
directive|include
file|"tst_qdbusreply.moc"
end_include
end_unit
