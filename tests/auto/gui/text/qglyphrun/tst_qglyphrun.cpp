begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2013 Digia Plc and/or its subsidiary(-ies). ** Contact: http://www.qt-project.org/legal ** ** This file is part of the test suite of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL$ ** Commercial License Usage ** Licensees holding valid commercial Qt licenses may use this file in ** accordance with the commercial license agreement provided with the ** Software or, alternatively, in accordance with the terms contained in ** a written agreement between you and Digia.  For licensing terms and ** conditions see http://qt.digia.com/licensing.  For further information ** use the contact form at http://qt.digia.com/contact-us. ** ** GNU Lesser General Public License Usage ** Alternatively, this file may be used under the terms of the GNU Lesser ** General Public License version 2.1 as published by the Free Software ** Foundation and appearing in the file LICENSE.LGPL included in the ** packaging of this file.  Please review the following information to ** ensure the GNU Lesser General Public License version 2.1 requirements ** will be met: http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html. ** ** In addition, as a special exception, Digia gives you certain additional ** rights.  These rights are described in the Digia Qt LGPL Exception ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package. ** ** GNU General Public License Usage ** Alternatively, this file may be used under the terms of the GNU ** General Public License version 3.0 as published by the Free Software ** Foundation and appearing in the file LICENSE.GPL included in the ** packaging of this file.  Please review the following information to ** ensure the GNU General Public License version 3.0 requirements will be ** met: http://www.gnu.org/copyleft/gpl.html. ** ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<QtTest/QtTest>
end_include
begin_include
include|#
directive|include
file|<qglyphrun.h>
end_include
begin_include
include|#
directive|include
file|<qpainter.h>
end_include
begin_include
include|#
directive|include
file|<qtextlayout.h>
end_include
begin_include
include|#
directive|include
file|<qfontdatabase.h>
end_include
begin_comment
comment|// #define DEBUG_SAVE_IMAGE
end_comment
begin_class
DECL|class|tst_QGlyphRun
class|class
name|tst_QGlyphRun
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
if|#
directive|if
operator|!
name|defined
argument_list|(
name|QT_NO_RAWFONT
argument_list|)
private|private
name|slots
private|:
name|void
name|initTestCase
parameter_list|()
function_decl|;
name|void
name|init
parameter_list|()
function_decl|;
name|void
name|cleanupTestCase
parameter_list|()
function_decl|;
name|void
name|constructionAndDestruction
parameter_list|()
function_decl|;
name|void
name|copyConstructor
parameter_list|()
function_decl|;
name|void
name|assignment
parameter_list|()
function_decl|;
name|void
name|equalsOperator_data
parameter_list|()
function_decl|;
name|void
name|equalsOperator
parameter_list|()
function_decl|;
name|void
name|isEmpty
parameter_list|()
function_decl|;
name|void
name|textLayoutGlyphIndexes
parameter_list|()
function_decl|;
name|void
name|drawExistingGlyphs
parameter_list|()
function_decl|;
name|void
name|drawNonExistentGlyphs
parameter_list|()
function_decl|;
name|void
name|drawMultiScriptText1
parameter_list|()
function_decl|;
name|void
name|drawMultiScriptText2
parameter_list|()
function_decl|;
name|void
name|drawStruckOutText
parameter_list|()
function_decl|;
name|void
name|drawOverlinedText
parameter_list|()
function_decl|;
name|void
name|drawUnderlinedText
parameter_list|()
function_decl|;
name|void
name|drawRightToLeft
parameter_list|()
function_decl|;
name|void
name|detach
parameter_list|()
function_decl|;
name|void
name|setRawData
parameter_list|()
function_decl|;
name|void
name|setRawDataAndGetAsVector
parameter_list|()
function_decl|;
name|void
name|boundingRect
parameter_list|()
function_decl|;
private|private:
DECL|member|m_testFontId
name|int
name|m_testFontId
decl_stmt|;
DECL|member|m_testFont
name|QFont
name|m_testFont
decl_stmt|;
DECL|member|m_testFont_ok
name|bool
name|m_testFont_ok
decl_stmt|;
endif|#
directive|endif
comment|// QT_NO_RAWFONT
block|}
class|;
end_class
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|QT_NO_RAWFONT
argument_list|)
end_if
begin_expr_stmt
DECL|variable|QGlyphRun
name|Q_DECLARE_METATYPE
argument_list|(
name|QGlyphRun
argument_list|)
expr_stmt|;
end_expr_stmt
begin_function
DECL|function|initTestCase
name|void
name|tst_QGlyphRun
operator|::
name|initTestCase
parameter_list|()
block|{
name|m_testFont_ok
operator|=
literal|false
expr_stmt|;
name|m_testFontId
operator|=
name|QFontDatabase
operator|::
name|addApplicationFont
argument_list|(
name|SRCDIR
literal|"test.ttf"
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|m_testFontId
operator|>=
literal|0
argument_list|)
expr_stmt|;
name|m_testFont
operator|=
name|QFont
argument_list|(
literal|"QtsSpecialTestFont"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QFontInfo
argument_list|(
name|m_testFont
argument_list|)
operator|.
name|family
argument_list|()
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"QtsSpecialTestFont"
argument_list|)
argument_list|)
expr_stmt|;
name|m_testFont_ok
operator|=
literal|true
expr_stmt|;
block|}
end_function
begin_function
DECL|function|init
name|void
name|tst_QGlyphRun
operator|::
name|init
parameter_list|()
block|{
if|if
condition|(
operator|!
name|m_testFont_ok
condition|)
name|QSKIP
argument_list|(
literal|"Test font is not working correctly"
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|cleanupTestCase
name|void
name|tst_QGlyphRun
operator|::
name|cleanupTestCase
parameter_list|()
block|{
name|QFontDatabase
operator|::
name|removeApplicationFont
argument_list|(
name|m_testFontId
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|constructionAndDestruction
name|void
name|tst_QGlyphRun
operator|::
name|constructionAndDestruction
parameter_list|()
block|{
name|QGlyphRun
name|glyphIndexes
decl_stmt|;
block|}
end_function
begin_function
DECL|function|make_dummy_indexes
specifier|static
name|QGlyphRun
name|make_dummy_indexes
parameter_list|()
block|{
name|QGlyphRun
name|glyphs
decl_stmt|;
name|QVector
argument_list|<
name|quint32
argument_list|>
name|glyphIndexes
decl_stmt|;
name|QVector
argument_list|<
name|QPointF
argument_list|>
name|positions
decl_stmt|;
name|QFont
name|font
decl_stmt|;
name|font
operator|.
name|setPointSize
argument_list|(
literal|18
argument_list|)
expr_stmt|;
name|glyphIndexes
operator|.
name|append
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|glyphIndexes
operator|.
name|append
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|glyphIndexes
operator|.
name|append
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|positions
operator|.
name|append
argument_list|(
name|QPointF
argument_list|(
literal|1
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|positions
operator|.
name|append
argument_list|(
name|QPointF
argument_list|(
literal|3
argument_list|,
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|positions
operator|.
name|append
argument_list|(
name|QPointF
argument_list|(
literal|5
argument_list|,
literal|6
argument_list|)
argument_list|)
expr_stmt|;
name|glyphs
operator|.
name|setRawFont
argument_list|(
name|QRawFont
operator|::
name|fromFont
argument_list|(
name|font
argument_list|)
argument_list|)
expr_stmt|;
name|glyphs
operator|.
name|setGlyphIndexes
argument_list|(
name|glyphIndexes
argument_list|)
expr_stmt|;
name|glyphs
operator|.
name|setPositions
argument_list|(
name|positions
argument_list|)
expr_stmt|;
return|return
name|glyphs
return|;
block|}
end_function
begin_function
DECL|function|copyConstructor
name|void
name|tst_QGlyphRun
operator|::
name|copyConstructor
parameter_list|()
block|{
name|QGlyphRun
name|glyphs
decl_stmt|;
block|{
name|QVector
argument_list|<
name|quint32
argument_list|>
name|glyphIndexes
decl_stmt|;
name|QVector
argument_list|<
name|QPointF
argument_list|>
name|positions
decl_stmt|;
name|QFont
name|font
decl_stmt|;
name|font
operator|.
name|setPointSize
argument_list|(
literal|18
argument_list|)
expr_stmt|;
name|glyphIndexes
operator|.
name|append
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|glyphIndexes
operator|.
name|append
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|glyphIndexes
operator|.
name|append
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|positions
operator|.
name|append
argument_list|(
name|QPointF
argument_list|(
literal|1
argument_list|,
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|positions
operator|.
name|append
argument_list|(
name|QPointF
argument_list|(
literal|3
argument_list|,
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|positions
operator|.
name|append
argument_list|(
name|QPointF
argument_list|(
literal|5
argument_list|,
literal|6
argument_list|)
argument_list|)
expr_stmt|;
name|glyphs
operator|.
name|setRawFont
argument_list|(
name|QRawFont
operator|::
name|fromFont
argument_list|(
name|font
argument_list|)
argument_list|)
expr_stmt|;
name|glyphs
operator|.
name|setGlyphIndexes
argument_list|(
name|glyphIndexes
argument_list|)
expr_stmt|;
name|glyphs
operator|.
name|setPositions
argument_list|(
name|positions
argument_list|)
expr_stmt|;
block|}
name|QGlyphRun
name|otherGlyphs
argument_list|(
name|glyphs
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|otherGlyphs
operator|.
name|rawFont
argument_list|()
argument_list|,
name|glyphs
operator|.
name|rawFont
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|glyphs
operator|.
name|glyphIndexes
argument_list|()
argument_list|,
name|otherGlyphs
operator|.
name|glyphIndexes
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|glyphs
operator|.
name|positions
argument_list|()
argument_list|,
name|otherGlyphs
operator|.
name|positions
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|assignment
name|void
name|tst_QGlyphRun
operator|::
name|assignment
parameter_list|()
block|{
name|QGlyphRun
name|glyphs
argument_list|(
name|make_dummy_indexes
argument_list|()
argument_list|)
decl_stmt|;
name|QGlyphRun
name|otherGlyphs
init|=
name|glyphs
decl_stmt|;
name|QCOMPARE
argument_list|(
name|otherGlyphs
operator|.
name|rawFont
argument_list|()
argument_list|,
name|glyphs
operator|.
name|rawFont
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|glyphs
operator|.
name|glyphIndexes
argument_list|()
argument_list|,
name|otherGlyphs
operator|.
name|glyphIndexes
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|glyphs
operator|.
name|positions
argument_list|()
argument_list|,
name|otherGlyphs
operator|.
name|positions
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|equalsOperator_data
name|void
name|tst_QGlyphRun
operator|::
name|equalsOperator_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|QGlyphRun
argument_list|>
argument_list|(
literal|"one"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|QGlyphRun
argument_list|>
argument_list|(
literal|"two"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"equals"
argument_list|)
expr_stmt|;
name|QGlyphRun
name|one
argument_list|(
name|make_dummy_indexes
argument_list|()
argument_list|)
decl_stmt|;
name|QGlyphRun
name|two
argument_list|(
name|make_dummy_indexes
argument_list|()
argument_list|)
decl_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Identical"
argument_list|)
operator|<<
name|one
operator|<<
name|two
operator|<<
literal|true
expr_stmt|;
block|{
name|QGlyphRun
name|busted
argument_list|(
name|two
argument_list|)
decl_stmt|;
name|QVector
argument_list|<
name|QPointF
argument_list|>
name|positions
init|=
name|busted
operator|.
name|positions
argument_list|()
decl_stmt|;
name|positions
index|[
literal|2
index|]
operator|+=
name|QPointF
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|busted
operator|.
name|setPositions
argument_list|(
name|positions
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Different positions"
argument_list|)
operator|<<
name|one
operator|<<
name|busted
operator|<<
literal|false
expr_stmt|;
block|}
block|{
name|QGlyphRun
name|busted
argument_list|(
name|two
argument_list|)
decl_stmt|;
name|QFont
name|font
decl_stmt|;
name|font
operator|.
name|setPixelSize
argument_list|(
name|busted
operator|.
name|rawFont
argument_list|()
operator|.
name|pixelSize
argument_list|()
operator|*
literal|2
argument_list|)
expr_stmt|;
name|busted
operator|.
name|setRawFont
argument_list|(
name|QRawFont
operator|::
name|fromFont
argument_list|(
name|font
argument_list|)
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Different fonts"
argument_list|)
operator|<<
name|one
operator|<<
name|busted
operator|<<
literal|false
expr_stmt|;
block|}
block|{
name|QGlyphRun
name|busted
argument_list|(
name|two
argument_list|)
decl_stmt|;
name|QVector
argument_list|<
name|quint32
argument_list|>
name|glyphIndexes
init|=
name|busted
operator|.
name|glyphIndexes
argument_list|()
decl_stmt|;
name|glyphIndexes
index|[
literal|2
index|]
operator|+=
literal|1
expr_stmt|;
name|busted
operator|.
name|setGlyphIndexes
argument_list|(
name|glyphIndexes
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"Different glyph indexes"
argument_list|)
operator|<<
name|one
operator|<<
name|busted
operator|<<
literal|false
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|equalsOperator
name|void
name|tst_QGlyphRun
operator|::
name|equalsOperator
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|QGlyphRun
argument_list|,
name|one
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|QGlyphRun
argument_list|,
name|two
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|equals
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|one
operator|==
name|two
argument_list|,
name|equals
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|one
operator|!=
name|two
argument_list|,
operator|!
name|equals
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|isEmpty
name|void
name|tst_QGlyphRun
operator|::
name|isEmpty
parameter_list|()
block|{
name|QGlyphRun
name|glyphs
decl_stmt|;
name|QVERIFY
argument_list|(
name|glyphs
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|glyphs
operator|.
name|setGlyphIndexes
argument_list|(
name|QVector
argument_list|<
name|quint32
argument_list|>
argument_list|()
operator|<<
literal|1
operator|<<
literal|2
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|glyphs
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|glyphs
operator|.
name|clear
argument_list|()
expr_stmt|;
name|QVERIFY
argument_list|(
name|glyphs
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
name|QVector
argument_list|<
name|quint32
argument_list|>
name|glyphIndexes
init|=
name|QVector
argument_list|<
name|quint32
argument_list|>
argument_list|()
operator|<<
literal|1
operator|<<
literal|2
operator|<<
literal|3
decl_stmt|;
name|QVector
argument_list|<
name|QPointF
argument_list|>
name|positions
init|=
name|QVector
argument_list|<
name|QPointF
argument_list|>
argument_list|()
operator|<<
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
decl_stmt|;
name|glyphs
operator|.
name|setRawData
argument_list|(
name|glyphIndexes
operator|.
name|constData
argument_list|()
argument_list|,
name|positions
operator|.
name|constData
argument_list|()
argument_list|,
name|glyphIndexes
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|glyphs
operator|.
name|isEmpty
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|textLayoutGlyphIndexes
name|void
name|tst_QGlyphRun
operator|::
name|textLayoutGlyphIndexes
parameter_list|()
block|{
name|QString
name|s
decl_stmt|;
name|s
operator|.
name|append
argument_list|(
name|QLatin1Char
argument_list|(
literal|'A'
argument_list|)
argument_list|)
expr_stmt|;
name|s
operator|.
name|append
argument_list|(
name|QChar
argument_list|(
literal|0xe000
argument_list|)
argument_list|)
expr_stmt|;
name|QTextLayout
name|layout
argument_list|(
name|s
argument_list|)
decl_stmt|;
name|layout
operator|.
name|setFont
argument_list|(
name|m_testFont
argument_list|)
expr_stmt|;
name|layout
operator|.
name|setCacheEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|layout
operator|.
name|beginLayout
argument_list|()
expr_stmt|;
name|layout
operator|.
name|createLine
argument_list|()
expr_stmt|;
name|layout
operator|.
name|endLayout
argument_list|()
expr_stmt|;
name|QList
argument_list|<
name|QGlyphRun
argument_list|>
name|listOfGlyphs
init|=
name|layout
operator|.
name|glyphRuns
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|listOfGlyphs
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QGlyphRun
name|glyphs
init|=
name|listOfGlyphs
operator|.
name|at
argument_list|(
literal|0
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|glyphs
operator|.
name|glyphIndexes
argument_list|()
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|glyphs
operator|.
name|glyphIndexes
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
argument_list|,
name|quint32
argument_list|(
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|glyphs
operator|.
name|glyphIndexes
argument_list|()
operator|.
name|at
argument_list|(
literal|1
argument_list|)
argument_list|,
name|quint32
argument_list|(
literal|1
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|drawExistingGlyphs
name|void
name|tst_QGlyphRun
operator|::
name|drawExistingGlyphs
parameter_list|()
block|{
name|QPixmap
name|textLayoutDraw
argument_list|(
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
name|QPixmap
name|drawGlyphs
argument_list|(
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
name|textLayoutDraw
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
name|drawGlyphs
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
name|QString
name|s
decl_stmt|;
name|s
operator|.
name|append
argument_list|(
name|QLatin1Char
argument_list|(
literal|'A'
argument_list|)
argument_list|)
expr_stmt|;
name|s
operator|.
name|append
argument_list|(
name|QChar
argument_list|(
literal|0xe000
argument_list|)
argument_list|)
expr_stmt|;
name|QTextLayout
name|layout
argument_list|(
name|s
argument_list|)
decl_stmt|;
name|layout
operator|.
name|setFont
argument_list|(
name|m_testFont
argument_list|)
expr_stmt|;
name|layout
operator|.
name|setCacheEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|layout
operator|.
name|beginLayout
argument_list|()
expr_stmt|;
name|layout
operator|.
name|createLine
argument_list|()
expr_stmt|;
name|layout
operator|.
name|endLayout
argument_list|()
expr_stmt|;
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|textLayoutDraw
argument_list|)
decl_stmt|;
name|layout
operator|.
name|draw
argument_list|(
operator|&
name|p
argument_list|,
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|QGlyphRun
name|glyphs
init|=
name|layout
operator|.
name|glyphRuns
argument_list|()
operator|.
name|size
argument_list|()
operator|>
literal|0
condition|?
name|layout
operator|.
name|glyphRuns
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
else|:
name|QGlyphRun
argument_list|()
decl_stmt|;
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|drawGlyphs
argument_list|)
decl_stmt|;
name|p
operator|.
name|drawGlyphRun
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|glyphs
argument_list|)
expr_stmt|;
block|}
if|#
directive|if
name|defined
argument_list|(
name|DEBUG_SAVE_IMAGE
argument_list|)
name|textLayoutDraw
operator|.
name|save
argument_list|(
literal|"drawExistingGlyphs_textLayoutDraw.png"
argument_list|)
expr_stmt|;
name|drawGlyphs
operator|.
name|save
argument_list|(
literal|"drawExistingGlyphs_drawGlyphIndexes.png"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QCOMPARE
argument_list|(
name|textLayoutDraw
argument_list|,
name|drawGlyphs
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setRawData
name|void
name|tst_QGlyphRun
operator|::
name|setRawData
parameter_list|()
block|{
name|QGlyphRun
name|glyphRun
decl_stmt|;
name|glyphRun
operator|.
name|setRawFont
argument_list|(
name|QRawFont
operator|::
name|fromFont
argument_list|(
name|m_testFont
argument_list|)
argument_list|)
expr_stmt|;
name|glyphRun
operator|.
name|setGlyphIndexes
argument_list|(
name|QVector
argument_list|<
name|quint32
argument_list|>
argument_list|()
operator|<<
literal|2
operator|<<
literal|2
operator|<<
literal|2
argument_list|)
expr_stmt|;
name|glyphRun
operator|.
name|setPositions
argument_list|(
name|QVector
argument_list|<
name|QPointF
argument_list|>
argument_list|()
operator|<<
name|QPointF
argument_list|(
literal|2
argument_list|,
literal|3
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|20
argument_list|,
literal|3
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|20
argument_list|)
argument_list|)
expr_stmt|;
name|QPixmap
name|baseline
argument_list|(
literal|100
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|baseline
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|baseline
argument_list|)
decl_stmt|;
name|p
operator|.
name|drawGlyphRun
argument_list|(
name|QPointF
argument_list|(
literal|3
argument_list|,
literal|2
argument_list|)
argument_list|,
name|glyphRun
argument_list|)
expr_stmt|;
block|}
name|QGlyphRun
name|baselineCopied
init|=
name|glyphRun
decl_stmt|;
name|quint32
name|glyphIndexArray
index|[
literal|3
index|]
init|=
block|{
literal|2
block|,
literal|2
block|,
literal|2
block|}
decl_stmt|;
name|QPointF
name|glyphPositionArray
index|[
literal|3
index|]
init|=
block|{
name|QPointF
argument_list|(
literal|2
argument_list|,
literal|3
argument_list|)
block|,
name|QPointF
argument_list|(
literal|20
argument_list|,
literal|3
argument_list|)
block|,
name|QPointF
argument_list|(
literal|10
argument_list|,
literal|20
argument_list|)
block|}
decl_stmt|;
name|glyphRun
operator|.
name|setRawData
argument_list|(
name|glyphIndexArray
argument_list|,
name|glyphPositionArray
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|QPixmap
name|rawDataGlyphs
argument_list|(
literal|100
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|rawDataGlyphs
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|rawDataGlyphs
argument_list|)
decl_stmt|;
name|p
operator|.
name|drawGlyphRun
argument_list|(
name|QPointF
argument_list|(
literal|3
argument_list|,
literal|2
argument_list|)
argument_list|,
name|glyphRun
argument_list|)
expr_stmt|;
block|}
name|quint32
name|otherGlyphIndexArray
index|[
literal|1
index|]
init|=
block|{
literal|2
block|}
decl_stmt|;
name|QPointF
name|otherGlyphPositionArray
index|[
literal|1
index|]
init|=
block|{
name|QPointF
argument_list|(
literal|2
argument_list|,
literal|3
argument_list|)
block|}
decl_stmt|;
name|glyphRun
operator|.
name|setRawData
argument_list|(
name|otherGlyphIndexArray
argument_list|,
name|otherGlyphPositionArray
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QPixmap
name|baselineCopiedPixmap
argument_list|(
literal|100
argument_list|,
literal|50
argument_list|)
decl_stmt|;
name|baselineCopiedPixmap
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|baselineCopiedPixmap
argument_list|)
decl_stmt|;
name|p
operator|.
name|drawGlyphRun
argument_list|(
name|QPointF
argument_list|(
literal|3
argument_list|,
literal|2
argument_list|)
argument_list|,
name|baselineCopied
argument_list|)
expr_stmt|;
block|}
if|#
directive|if
name|defined
argument_list|(
name|DEBUG_SAVE_IMAGE
argument_list|)
name|baseline
operator|.
name|save
argument_list|(
literal|"setRawData_baseline.png"
argument_list|)
expr_stmt|;
name|rawDataGlyphs
operator|.
name|save
argument_list|(
literal|"setRawData_rawDataGlyphs.png"
argument_list|)
expr_stmt|;
name|baselineCopiedPixmap
operator|.
name|save
argument_list|(
literal|"setRawData_baselineCopiedPixmap.png"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QCOMPARE
argument_list|(
name|rawDataGlyphs
argument_list|,
name|baseline
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|baselineCopiedPixmap
argument_list|,
name|baseline
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setRawDataAndGetAsVector
name|void
name|tst_QGlyphRun
operator|::
name|setRawDataAndGetAsVector
parameter_list|()
block|{
name|QVector
argument_list|<
name|quint32
argument_list|>
name|glyphIndexArray
decl_stmt|;
name|glyphIndexArray
operator|<<
literal|3
operator|<<
literal|2
operator|<<
literal|1
operator|<<
literal|4
expr_stmt|;
name|QVector
argument_list|<
name|QPointF
argument_list|>
name|glyphPositionArray
decl_stmt|;
name|glyphPositionArray
operator|<<
name|QPointF
argument_list|(
literal|1
argument_list|,
literal|2
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|3
argument_list|,
literal|4
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|5
argument_list|,
literal|6
argument_list|)
operator|<<
name|QPointF
argument_list|(
literal|7
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|QGlyphRun
name|glyphRun
decl_stmt|;
name|glyphRun
operator|.
name|setRawData
argument_list|(
name|glyphIndexArray
operator|.
name|constData
argument_list|()
argument_list|,
name|glyphPositionArray
operator|.
name|constData
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QVector
argument_list|<
name|quint32
argument_list|>
name|glyphIndexes
init|=
name|glyphRun
operator|.
name|glyphIndexes
argument_list|()
decl_stmt|;
name|QVector
argument_list|<
name|QPointF
argument_list|>
name|glyphPositions
init|=
name|glyphRun
operator|.
name|positions
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|glyphIndexes
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|glyphPositions
operator|.
name|size
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|glyphIndexes
argument_list|,
name|glyphIndexArray
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|glyphPositions
argument_list|,
name|glyphPositionArray
argument_list|)
expr_stmt|;
name|QGlyphRun
name|otherGlyphRun
decl_stmt|;
name|otherGlyphRun
operator|.
name|setGlyphIndexes
argument_list|(
name|glyphIndexArray
argument_list|)
expr_stmt|;
name|otherGlyphRun
operator|.
name|setPositions
argument_list|(
name|glyphPositionArray
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|glyphRun
argument_list|,
name|otherGlyphRun
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|drawNonExistentGlyphs
name|void
name|tst_QGlyphRun
operator|::
name|drawNonExistentGlyphs
parameter_list|()
block|{
name|QVector
argument_list|<
name|quint32
argument_list|>
name|glyphIndexes
decl_stmt|;
name|glyphIndexes
operator|.
name|append
argument_list|(
literal|3
argument_list|)
expr_stmt|;
name|QVector
argument_list|<
name|QPointF
argument_list|>
name|glyphPositions
decl_stmt|;
name|glyphPositions
operator|.
name|append
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|)
expr_stmt|;
name|QGlyphRun
name|glyphs
decl_stmt|;
name|glyphs
operator|.
name|setGlyphIndexes
argument_list|(
name|glyphIndexes
argument_list|)
expr_stmt|;
name|glyphs
operator|.
name|setPositions
argument_list|(
name|glyphPositions
argument_list|)
expr_stmt|;
name|glyphs
operator|.
name|setRawFont
argument_list|(
name|QRawFont
operator|::
name|fromFont
argument_list|(
name|m_testFont
argument_list|)
argument_list|)
expr_stmt|;
name|QPixmap
name|image
argument_list|(
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
name|image
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
name|QPixmap
name|imageBefore
init|=
name|image
decl_stmt|;
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|image
argument_list|)
decl_stmt|;
name|p
operator|.
name|drawGlyphRun
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|glyphs
argument_list|)
expr_stmt|;
block|}
if|#
directive|if
name|defined
argument_list|(
name|DEBUG_SAVE_IMAGE
argument_list|)
name|image
operator|.
name|save
argument_list|(
literal|"drawNonExistentGlyphs.png"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QCOMPARE
argument_list|(
name|image
argument_list|,
name|imageBefore
argument_list|)
expr_stmt|;
comment|// Should be unchanged
block|}
end_function
begin_function
DECL|function|drawMultiScriptText1
name|void
name|tst_QGlyphRun
operator|::
name|drawMultiScriptText1
parameter_list|()
block|{
name|QString
name|text
decl_stmt|;
name|text
operator|+=
name|QChar
argument_list|(
literal|0x03D0
argument_list|)
expr_stmt|;
comment|// Greek, beta
name|QTextLayout
name|textLayout
argument_list|(
name|text
argument_list|)
decl_stmt|;
name|textLayout
operator|.
name|setCacheEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|textLayout
operator|.
name|beginLayout
argument_list|()
expr_stmt|;
name|textLayout
operator|.
name|createLine
argument_list|()
expr_stmt|;
name|textLayout
operator|.
name|endLayout
argument_list|()
expr_stmt|;
name|QPixmap
name|textLayoutDraw
argument_list|(
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
name|textLayoutDraw
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
name|QPixmap
name|drawGlyphs
argument_list|(
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
name|drawGlyphs
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QGlyphRun
argument_list|>
name|glyphsList
init|=
name|textLayout
operator|.
name|glyphRuns
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|glyphsList
operator|.
name|size
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|textLayoutDraw
argument_list|)
decl_stmt|;
name|textLayout
operator|.
name|draw
argument_list|(
operator|&
name|p
argument_list|,
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|drawGlyphs
argument_list|)
decl_stmt|;
foreach|foreach
control|(
name|QGlyphRun
name|glyphs
decl|,
name|glyphsList
control|)
name|p
operator|.
name|drawGlyphRun
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|glyphs
argument_list|)
expr_stmt|;
block|}
if|#
directive|if
name|defined
argument_list|(
name|DEBUG_SAVE_IMAGE
argument_list|)
name|textLayoutDraw
operator|.
name|save
argument_list|(
literal|"drawMultiScriptText1_textLayoutDraw.png"
argument_list|)
expr_stmt|;
name|drawGlyphs
operator|.
name|save
argument_list|(
literal|"drawMultiScriptText1_drawGlyphIndexes.png"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QCOMPARE
argument_list|(
name|drawGlyphs
argument_list|,
name|textLayoutDraw
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|drawMultiScriptText2
name|void
name|tst_QGlyphRun
operator|::
name|drawMultiScriptText2
parameter_list|()
block|{
name|QString
name|text
decl_stmt|;
name|text
operator|+=
name|QChar
argument_list|(
literal|0x0621
argument_list|)
expr_stmt|;
comment|// Arabic, Hamza
name|text
operator|+=
name|QChar
argument_list|(
literal|0x03D0
argument_list|)
expr_stmt|;
comment|// Greek, beta
name|QTextLayout
name|textLayout
argument_list|(
name|text
argument_list|)
decl_stmt|;
name|textLayout
operator|.
name|setCacheEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|textLayout
operator|.
name|beginLayout
argument_list|()
expr_stmt|;
name|textLayout
operator|.
name|createLine
argument_list|()
expr_stmt|;
name|textLayout
operator|.
name|endLayout
argument_list|()
expr_stmt|;
name|QPixmap
name|textLayoutDraw
argument_list|(
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
name|textLayoutDraw
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
name|QPixmap
name|drawGlyphs
argument_list|(
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
name|drawGlyphs
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QGlyphRun
argument_list|>
name|glyphsList
init|=
name|textLayout
operator|.
name|glyphRuns
argument_list|()
decl_stmt|;
name|QCOMPARE
argument_list|(
name|glyphsList
operator|.
name|size
argument_list|()
argument_list|,
literal|2
argument_list|)
expr_stmt|;
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|textLayoutDraw
argument_list|)
decl_stmt|;
name|textLayout
operator|.
name|draw
argument_list|(
operator|&
name|p
argument_list|,
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|drawGlyphs
argument_list|)
decl_stmt|;
foreach|foreach
control|(
name|QGlyphRun
name|glyphs
decl|,
name|glyphsList
control|)
name|p
operator|.
name|drawGlyphRun
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|glyphs
argument_list|)
expr_stmt|;
block|}
if|#
directive|if
name|defined
argument_list|(
name|DEBUG_SAVE_IMAGE
argument_list|)
name|textLayoutDraw
operator|.
name|save
argument_list|(
literal|"drawMultiScriptText2_textLayoutDraw.png"
argument_list|)
expr_stmt|;
name|drawGlyphs
operator|.
name|save
argument_list|(
literal|"drawMultiScriptText2_drawGlyphIndexes.png"
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|Q_OS_OSX
if|if
condition|(
name|drawGlyphs
operator|.
name|toImage
argument_list|()
operator|!=
name|textLayoutDraw
operator|.
name|toImage
argument_list|()
condition|)
name|QEXPECT_FAIL
argument_list|(
literal|""
argument_list|,
literal|"See QTBUG-32690"
argument_list|,
name|Continue
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|// Q_OS_OSX
name|QCOMPARE
argument_list|(
name|drawGlyphs
argument_list|,
name|textLayoutDraw
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|detach
name|void
name|tst_QGlyphRun
operator|::
name|detach
parameter_list|()
block|{
name|QGlyphRun
name|glyphs
decl_stmt|;
name|glyphs
operator|.
name|setGlyphIndexes
argument_list|(
name|QVector
argument_list|<
name|quint32
argument_list|>
argument_list|()
operator|<<
literal|1
operator|<<
literal|2
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|QGlyphRun
name|otherGlyphs
decl_stmt|;
name|otherGlyphs
operator|=
name|glyphs
expr_stmt|;
name|QCOMPARE
argument_list|(
name|otherGlyphs
operator|.
name|glyphIndexes
argument_list|()
argument_list|,
name|glyphs
operator|.
name|glyphIndexes
argument_list|()
argument_list|)
expr_stmt|;
name|otherGlyphs
operator|.
name|setGlyphIndexes
argument_list|(
name|QVector
argument_list|<
name|quint32
argument_list|>
argument_list|()
operator|<<
literal|4
operator|<<
literal|5
operator|<<
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|otherGlyphs
operator|.
name|glyphIndexes
argument_list|()
argument_list|,
name|QVector
argument_list|<
name|quint32
argument_list|>
argument_list|()
operator|<<
literal|4
operator|<<
literal|5
operator|<<
literal|6
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|glyphs
operator|.
name|glyphIndexes
argument_list|()
argument_list|,
name|QVector
argument_list|<
name|quint32
argument_list|>
argument_list|()
operator|<<
literal|1
operator|<<
literal|2
operator|<<
literal|3
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|drawStruckOutText
name|void
name|tst_QGlyphRun
operator|::
name|drawStruckOutText
parameter_list|()
block|{
name|QPixmap
name|textLayoutDraw
argument_list|(
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
name|QPixmap
name|drawGlyphs
argument_list|(
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
name|textLayoutDraw
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
name|drawGlyphs
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
name|QString
name|s
init|=
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"Foobar"
argument_list|)
decl_stmt|;
name|QFont
name|font
decl_stmt|;
name|font
operator|.
name|setStrikeOut
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QTextLayout
name|layout
argument_list|(
name|s
argument_list|)
decl_stmt|;
name|layout
operator|.
name|setFont
argument_list|(
name|font
argument_list|)
expr_stmt|;
name|layout
operator|.
name|setCacheEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|layout
operator|.
name|beginLayout
argument_list|()
expr_stmt|;
name|layout
operator|.
name|createLine
argument_list|()
expr_stmt|;
name|layout
operator|.
name|endLayout
argument_list|()
expr_stmt|;
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|textLayoutDraw
argument_list|)
decl_stmt|;
name|layout
operator|.
name|draw
argument_list|(
operator|&
name|p
argument_list|,
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|QGlyphRun
name|glyphs
init|=
name|layout
operator|.
name|glyphRuns
argument_list|()
operator|.
name|size
argument_list|()
operator|>
literal|0
condition|?
name|layout
operator|.
name|glyphRuns
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
else|:
name|QGlyphRun
argument_list|()
decl_stmt|;
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|drawGlyphs
argument_list|)
decl_stmt|;
name|p
operator|.
name|drawGlyphRun
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|glyphs
argument_list|)
expr_stmt|;
block|}
if|#
directive|if
name|defined
argument_list|(
name|DEBUG_SAVE_IMAGE
argument_list|)
name|textLayoutDraw
operator|.
name|save
argument_list|(
literal|"drawStruckOutText_textLayoutDraw.png"
argument_list|)
expr_stmt|;
name|drawGlyphs
operator|.
name|save
argument_list|(
literal|"drawStruckOutText_drawGlyphIndexes.png"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QCOMPARE
argument_list|(
name|textLayoutDraw
argument_list|,
name|drawGlyphs
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|drawOverlinedText
name|void
name|tst_QGlyphRun
operator|::
name|drawOverlinedText
parameter_list|()
block|{
name|QPixmap
name|textLayoutDraw
argument_list|(
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
name|QPixmap
name|drawGlyphs
argument_list|(
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
name|textLayoutDraw
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
name|drawGlyphs
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
name|QString
name|s
init|=
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"Foobar"
argument_list|)
decl_stmt|;
name|QFont
name|font
decl_stmt|;
name|font
operator|.
name|setOverline
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QTextLayout
name|layout
argument_list|(
name|s
argument_list|)
decl_stmt|;
name|layout
operator|.
name|setFont
argument_list|(
name|font
argument_list|)
expr_stmt|;
name|layout
operator|.
name|setCacheEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|layout
operator|.
name|beginLayout
argument_list|()
expr_stmt|;
name|layout
operator|.
name|createLine
argument_list|()
expr_stmt|;
name|layout
operator|.
name|endLayout
argument_list|()
expr_stmt|;
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|textLayoutDraw
argument_list|)
decl_stmt|;
name|layout
operator|.
name|draw
argument_list|(
operator|&
name|p
argument_list|,
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|QGlyphRun
name|glyphs
init|=
name|layout
operator|.
name|glyphRuns
argument_list|()
operator|.
name|size
argument_list|()
operator|>
literal|0
condition|?
name|layout
operator|.
name|glyphRuns
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
else|:
name|QGlyphRun
argument_list|()
decl_stmt|;
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|drawGlyphs
argument_list|)
decl_stmt|;
name|p
operator|.
name|drawGlyphRun
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|glyphs
argument_list|)
expr_stmt|;
block|}
if|#
directive|if
name|defined
argument_list|(
name|DEBUG_SAVE_IMAGE
argument_list|)
name|textLayoutDraw
operator|.
name|save
argument_list|(
literal|"drawOverlineText_textLayoutDraw.png"
argument_list|)
expr_stmt|;
name|drawGlyphs
operator|.
name|save
argument_list|(
literal|"drawOverlineText_drawGlyphIndexes.png"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QCOMPARE
argument_list|(
name|textLayoutDraw
argument_list|,
name|drawGlyphs
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|drawUnderlinedText
name|void
name|tst_QGlyphRun
operator|::
name|drawUnderlinedText
parameter_list|()
block|{
name|QPixmap
name|textLayoutDraw
argument_list|(
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
name|QPixmap
name|drawGlyphs
argument_list|(
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
name|textLayoutDraw
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
name|drawGlyphs
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
name|QString
name|s
init|=
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"Foobar"
argument_list|)
decl_stmt|;
name|QFont
name|font
decl_stmt|;
name|font
operator|.
name|setUnderline
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QTextLayout
name|layout
argument_list|(
name|s
argument_list|)
decl_stmt|;
name|layout
operator|.
name|setFont
argument_list|(
name|font
argument_list|)
expr_stmt|;
name|layout
operator|.
name|setCacheEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|layout
operator|.
name|beginLayout
argument_list|()
expr_stmt|;
name|layout
operator|.
name|createLine
argument_list|()
expr_stmt|;
name|layout
operator|.
name|endLayout
argument_list|()
expr_stmt|;
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|textLayoutDraw
argument_list|)
decl_stmt|;
name|layout
operator|.
name|draw
argument_list|(
operator|&
name|p
argument_list|,
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|QGlyphRun
name|glyphs
init|=
name|layout
operator|.
name|glyphRuns
argument_list|()
operator|.
name|size
argument_list|()
operator|>
literal|0
condition|?
name|layout
operator|.
name|glyphRuns
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
else|:
name|QGlyphRun
argument_list|()
decl_stmt|;
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|drawGlyphs
argument_list|)
decl_stmt|;
name|p
operator|.
name|drawGlyphRun
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|glyphs
argument_list|)
expr_stmt|;
block|}
if|#
directive|if
name|defined
argument_list|(
name|DEBUG_SAVE_IMAGE
argument_list|)
name|textLayoutDraw
operator|.
name|save
argument_list|(
literal|"drawUnderlineText_textLayoutDraw.png"
argument_list|)
expr_stmt|;
name|drawGlyphs
operator|.
name|save
argument_list|(
literal|"drawUnderlineText_drawGlyphIndexes.png"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QCOMPARE
argument_list|(
name|textLayoutDraw
argument_list|,
name|drawGlyphs
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|drawRightToLeft
name|void
name|tst_QGlyphRun
operator|::
name|drawRightToLeft
parameter_list|()
block|{
name|QString
name|s
decl_stmt|;
name|s
operator|.
name|append
argument_list|(
name|QChar
argument_list|(
literal|1575
argument_list|)
argument_list|)
expr_stmt|;
name|s
operator|.
name|append
argument_list|(
name|QChar
argument_list|(
literal|1578
argument_list|)
argument_list|)
expr_stmt|;
name|QPixmap
name|textLayoutDraw
argument_list|(
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
name|QPixmap
name|drawGlyphs
argument_list|(
literal|1000
argument_list|,
literal|1000
argument_list|)
decl_stmt|;
name|textLayoutDraw
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
name|drawGlyphs
operator|.
name|fill
argument_list|(
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
name|QFont
name|font
decl_stmt|;
name|font
operator|.
name|setUnderline
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QTextLayout
name|layout
argument_list|(
name|s
argument_list|)
decl_stmt|;
name|layout
operator|.
name|setFont
argument_list|(
name|font
argument_list|)
expr_stmt|;
name|layout
operator|.
name|setCacheEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|layout
operator|.
name|beginLayout
argument_list|()
expr_stmt|;
name|layout
operator|.
name|createLine
argument_list|()
expr_stmt|;
name|layout
operator|.
name|endLayout
argument_list|()
expr_stmt|;
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|textLayoutDraw
argument_list|)
decl_stmt|;
name|layout
operator|.
name|draw
argument_list|(
operator|&
name|p
argument_list|,
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|QGlyphRun
name|glyphs
init|=
name|layout
operator|.
name|glyphRuns
argument_list|()
operator|.
name|size
argument_list|()
operator|>
literal|0
condition|?
name|layout
operator|.
name|glyphRuns
argument_list|()
operator|.
name|at
argument_list|(
literal|0
argument_list|)
else|:
name|QGlyphRun
argument_list|()
decl_stmt|;
block|{
name|QPainter
name|p
argument_list|(
operator|&
name|drawGlyphs
argument_list|)
decl_stmt|;
name|p
operator|.
name|drawGlyphRun
argument_list|(
name|QPointF
argument_list|(
literal|50
argument_list|,
literal|50
argument_list|)
argument_list|,
name|glyphs
argument_list|)
expr_stmt|;
block|}
if|#
directive|if
name|defined
argument_list|(
name|DEBUG_SAVE_IMAGE
argument_list|)
name|textLayoutDraw
operator|.
name|save
argument_list|(
literal|"drawRightToLeft_textLayoutDraw.png"
argument_list|)
expr_stmt|;
name|drawGlyphs
operator|.
name|save
argument_list|(
literal|"drawRightToLeft_drawGlyphIndexes.png"
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QCOMPARE
argument_list|(
name|textLayoutDraw
argument_list|,
name|drawGlyphs
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|boundingRect
name|void
name|tst_QGlyphRun
operator|::
name|boundingRect
parameter_list|()
block|{
name|QString
name|s
argument_list|(
name|QLatin1String
argument_list|(
literal|"AbCdE"
argument_list|)
argument_list|)
decl_stmt|;
name|QRawFont
name|rawFont
argument_list|(
name|QRawFont
operator|::
name|fromFont
argument_list|(
name|QFont
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|rawFont
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
name|QVector
argument_list|<
name|quint32
argument_list|>
name|glyphIndexes
init|=
name|rawFont
operator|.
name|glyphIndexesForString
argument_list|(
name|s
argument_list|)
decl_stmt|;
name|QVector
argument_list|<
name|QPointF
argument_list|>
name|positions
init|=
name|rawFont
operator|.
name|advancesForGlyphIndexes
argument_list|(
name|glyphIndexes
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|glyphIndexes
operator|.
name|size
argument_list|()
argument_list|,
name|s
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|positions
operator|.
name|size
argument_list|()
argument_list|,
name|glyphIndexes
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|QGlyphRun
name|glyphs
decl_stmt|;
name|glyphs
operator|.
name|setRawFont
argument_list|(
name|rawFont
argument_list|)
expr_stmt|;
name|glyphs
operator|.
name|setGlyphIndexes
argument_list|(
name|glyphIndexes
argument_list|)
expr_stmt|;
name|glyphs
operator|.
name|setPositions
argument_list|(
name|positions
argument_list|)
expr_stmt|;
name|QRectF
name|boundingRect
init|=
name|glyphs
operator|.
name|boundingRect
argument_list|()
decl_stmt|;
name|glyphs
operator|.
name|clear
argument_list|()
expr_stmt|;
name|glyphs
operator|.
name|setRawFont
argument_list|(
name|rawFont
argument_list|)
expr_stmt|;
name|glyphs
operator|.
name|setRawData
argument_list|(
name|glyphIndexes
operator|.
name|constData
argument_list|()
argument_list|,
name|positions
operator|.
name|constData
argument_list|()
argument_list|,
name|glyphIndexes
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|glyphs
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|boundingRect
argument_list|)
expr_stmt|;
name|boundingRect
operator|=
name|QRectF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|,
literal|1
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|glyphs
operator|.
name|setBoundingRect
argument_list|(
name|boundingRect
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|glyphs
operator|.
name|boundingRect
argument_list|()
argument_list|,
name|boundingRect
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|// QT_NO_RAWFONT
end_comment
begin_macro
name|QTEST_MAIN
argument_list|(
argument|tst_QGlyphRun
argument_list|)
end_macro
begin_include
include|#
directive|include
file|"tst_qglyphrun.moc"
end_include
end_unit
