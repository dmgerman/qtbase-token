begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2013 Digia Plc and/or its subsidiary(-ies). ** Contact: http://www.qt-project.org/legal ** ** This file is part of the test suite of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL$ ** Commercial License Usage ** Licensees holding valid commercial Qt licenses may use this file in ** accordance with the commercial license agreement provided with the ** Software or, alternatively, in accordance with the terms contained in ** a written agreement between you and Digia.  For licensing terms and ** conditions see http://qt.digia.com/licensing.  For further information ** use the contact form at http://qt.digia.com/contact-us. ** ** GNU Lesser General Public License Usage ** Alternatively, this file may be used under the terms of the GNU Lesser ** General Public License version 2.1 as published by the Free Software ** Foundation and appearing in the file LICENSE.LGPL included in the ** packaging of this file.  Please review the following information to ** ensure the GNU Lesser General Public License version 2.1 requirements ** will be met: http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html. ** ** In addition, as a special exception, Digia gives you certain additional ** rights.  These rights are described in the Digia Qt LGPL Exception ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package. ** ** GNU General Public License Usage ** Alternatively, this file may be used under the terms of the GNU ** General Public License version 3.0 as published by the Free Software ** Foundation and appearing in the file LICENSE.GPL included in the ** packaging of this file.  Please review the following information to ** ensure the GNU General Public License version 3.0 requirements will be ** met: http://www.gnu.org/copyleft/gpl.html. ** ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<QtTest/QtTest>
end_include
begin_include
include|#
directive|include
file|<qprinter.h>
end_include
begin_include
include|#
directive|include
file|<qpagesetupdialog.h>
end_include
begin_include
include|#
directive|include
file|<qpainter.h>
end_include
begin_include
include|#
directive|include
file|<qprintdialog.h>
end_include
begin_include
include|#
directive|include
file|<qprinterinfo.h>
end_include
begin_include
include|#
directive|include
file|<qvariant.h>
end_include
begin_include
include|#
directive|include
file|<qpainter.h>
end_include
begin_include
include|#
directive|include
file|<qprintengine.h>
end_include
begin_include
include|#
directive|include
file|<math.h>
end_include
begin_ifdef
ifdef|#
directive|ifdef
name|Q_OS_WIN
end_ifdef
begin_include
include|#
directive|include
file|<windows.h>
end_include
begin_endif
endif|#
directive|endif
end_endif
begin_macro
name|QT_FORWARD_DECLARE_CLASS
argument_list|(
argument|QPrinter
argument_list|)
end_macro
begin_comment
comment|// Helper class to make sure temp files are cleaned up after test complete
end_comment
begin_class
DECL|class|TempFileCleanup
class|class
name|TempFileCleanup
block|{
public|public:
DECL|function|TempFileCleanup
name|TempFileCleanup
parameter_list|(
specifier|const
name|QString
modifier|&
name|file
parameter_list|)
member_init_list|:
name|m_file
argument_list|(
name|file
argument_list|)
block|{     }
DECL|function|~TempFileCleanup
name|~
name|TempFileCleanup
parameter_list|()
block|{
name|QFile
operator|::
name|remove
argument_list|(
name|m_file
argument_list|)
expr_stmt|;
block|}
private|private:
DECL|member|m_file
name|QString
name|m_file
decl_stmt|;
block|}
class|;
end_class
begin_class
DECL|class|tst_QPrinter
class|class
name|tst_QPrinter
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
public|public
name|slots
public|:
ifdef|#
directive|ifdef
name|QT_NO_PRINTER
name|void
name|initTestCase
parameter_list|()
function_decl|;
name|void
name|cleanupTestCase
parameter_list|()
function_decl|;
else|#
directive|else
private|private
name|slots
private|:
name|void
name|getSetCheck
parameter_list|()
function_decl|;
comment|// Add your testfunctions and testdata create functions here
ifdef|#
directive|ifdef
name|Q_OS_WIN
name|void
name|testPageSize
parameter_list|()
function_decl|;
name|void
name|testNonExistentPrinter
parameter_list|()
function_decl|;
endif|#
directive|endif
name|void
name|testPageRectAndPaperRect
parameter_list|()
function_decl|;
name|void
name|testPageRectAndPaperRect_data
parameter_list|()
function_decl|;
name|void
name|testSetOptions
parameter_list|()
function_decl|;
name|void
name|testMargins_data
parameter_list|()
function_decl|;
name|void
name|testMargins
parameter_list|()
function_decl|;
name|void
name|testPageSetupDialog
parameter_list|()
function_decl|;
name|void
name|testMulitpleSets_data
parameter_list|()
function_decl|;
name|void
name|testMulitpleSets
parameter_list|()
function_decl|;
name|void
name|testPageMargins_data
parameter_list|()
function_decl|;
name|void
name|testPageMargins
parameter_list|()
function_decl|;
name|void
name|changingOutputFormat
parameter_list|()
function_decl|;
name|void
name|outputFormatFromSuffix
parameter_list|()
function_decl|;
name|void
name|setGetPaperSize
parameter_list|()
function_decl|;
name|void
name|valuePreservation
parameter_list|()
function_decl|;
name|void
name|errorReporting
parameter_list|()
function_decl|;
name|void
name|testCustomPageSizes
parameter_list|()
function_decl|;
name|void
name|customPaperSizeAndMargins_data
parameter_list|()
function_decl|;
name|void
name|customPaperSizeAndMargins
parameter_list|()
function_decl|;
if|#
directive|if
operator|!
name|defined
argument_list|(
name|QT_NO_COMPLETER
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|QT_NO_FILEDIALOG
argument_list|)
name|void
name|printDialogCompleter
parameter_list|()
function_decl|;
endif|#
directive|endif
name|void
name|testCopyCount
parameter_list|()
function_decl|;
name|void
name|testCurrentPage
parameter_list|()
function_decl|;
name|void
name|taskQTBUG4497_reusePrinterOnDifferentFiles
parameter_list|()
function_decl|;
name|void
name|testPdfTitle
parameter_list|()
function_decl|;
endif|#
directive|endif
block|}
class|;
end_class
begin_ifdef
ifdef|#
directive|ifdef
name|QT_NO_PRINTER
end_ifdef
begin_function
DECL|function|initTestCase
name|void
name|tst_QPrinter
operator|::
name|initTestCase
parameter_list|()
block|{
name|QSKIP
argument_list|(
literal|"This test requires printing support"
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|cleanupTestCase
name|void
name|tst_QPrinter
operator|::
name|cleanupTestCase
parameter_list|()
block|{
name|QSKIP
argument_list|(
literal|"This test requires printing support"
argument_list|)
expr_stmt|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|// Testing get/set functions
end_comment
begin_function
DECL|function|getSetCheck
name|void
name|tst_QPrinter
operator|::
name|getSetCheck
parameter_list|()
block|{
name|QPrinter
name|obj1
decl_stmt|;
comment|// OutputFormat QPrinter::outputFormat()
comment|// void QPrinter::setOutputFormat(OutputFormat)
name|obj1
operator|.
name|setOutputFormat
argument_list|(
name|QPrinter
operator|::
name|OutputFormat
argument_list|(
name|QPrinter
operator|::
name|PdfFormat
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QPrinter
operator|::
name|OutputFormat
argument_list|(
name|QPrinter
operator|::
name|PdfFormat
argument_list|)
argument_list|,
name|obj1
operator|.
name|outputFormat
argument_list|()
argument_list|)
expr_stmt|;
comment|// bool QPrinter::collateCopies()
comment|// void QPrinter::setCollateCopies(bool)
name|obj1
operator|.
name|setCollateCopies
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
literal|false
argument_list|,
name|obj1
operator|.
name|collateCopies
argument_list|()
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setCollateCopies
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
literal|true
argument_list|,
name|obj1
operator|.
name|collateCopies
argument_list|()
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setColorMode
argument_list|(
name|QPrinter
operator|::
name|GrayScale
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|colorMode
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|GrayScale
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setColorMode
argument_list|(
name|QPrinter
operator|::
name|Color
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|colorMode
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|Color
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setCreator
argument_list|(
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"RandomQtUser"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|creator
argument_list|()
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"RandomQtUser"
argument_list|)
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setDocName
argument_list|(
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"RandomQtDocument"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|docName
argument_list|()
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"RandomQtDocument"
argument_list|)
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setDoubleSidedPrinting
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|doubleSidedPrinting
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setDoubleSidedPrinting
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|doubleSidedPrinting
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setFromTo
argument_list|(
literal|1
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|fromPage
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|toPage
argument_list|()
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setFullPage
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|fullPage
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setFullPage
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|fullPage
argument_list|()
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setOrientation
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|orientation
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|Landscape
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setOrientation
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|orientation
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|Portrait
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setOutputFileName
argument_list|(
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"RandomQtName"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|outputFileName
argument_list|()
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"RandomQtName"
argument_list|)
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setPageOrder
argument_list|(
name|QPrinter
operator|::
name|FirstPageFirst
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|pageOrder
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|FirstPageFirst
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setPageOrder
argument_list|(
name|QPrinter
operator|::
name|LastPageFirst
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|pageOrder
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|LastPageFirst
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setPaperSource
argument_list|(
name|QPrinter
operator|::
name|Cassette
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|paperSource
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|Cassette
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setPaperSource
argument_list|(
name|QPrinter
operator|::
name|Middle
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|paperSource
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|Middle
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|Q_OS_UNIX
name|obj1
operator|.
name|setPrintProgram
argument_list|(
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"/bin/true"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|printProgram
argument_list|()
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"/bin/true"
argument_list|)
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setPrinterSelectionOption
argument_list|(
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"--option"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|printerSelectionOption
argument_list|()
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"--option"
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|obj1
operator|.
name|setPrinterName
argument_list|(
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"myPrinter"
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|obj1
operator|.
name|printerName
argument_list|()
argument_list|,
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"myPrinter"
argument_list|)
argument_list|)
expr_stmt|;
comment|// bool QPrinter::fontEmbeddingEnabled()
comment|// void QPrinter::setFontEmbeddingEnabled(bool)
name|obj1
operator|.
name|setFontEmbeddingEnabled
argument_list|(
literal|false
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
literal|false
argument_list|,
name|obj1
operator|.
name|fontEmbeddingEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setFontEmbeddingEnabled
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
literal|true
argument_list|,
name|obj1
operator|.
name|fontEmbeddingEnabled
argument_list|()
argument_list|)
expr_stmt|;
comment|// PageSize QPrinter::pageSize()
comment|// void QPrinter::setPageSize(PageSize)
name|obj1
operator|.
name|setPageSize
argument_list|(
name|QPrinter
operator|::
name|PageSize
argument_list|(
name|QPrinter
operator|::
name|A4
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QPrinter
operator|::
name|PageSize
argument_list|(
name|QPrinter
operator|::
name|A4
argument_list|)
argument_list|,
name|obj1
operator|.
name|pageSize
argument_list|()
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setPageSize
argument_list|(
name|QPrinter
operator|::
name|PageSize
argument_list|(
name|QPrinter
operator|::
name|Letter
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QPrinter
operator|::
name|PageSize
argument_list|(
name|QPrinter
operator|::
name|Letter
argument_list|)
argument_list|,
name|obj1
operator|.
name|pageSize
argument_list|()
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setPageSize
argument_list|(
name|QPrinter
operator|::
name|PageSize
argument_list|(
name|QPrinter
operator|::
name|Legal
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QPrinter
operator|::
name|PageSize
argument_list|(
name|QPrinter
operator|::
name|Legal
argument_list|)
argument_list|,
name|obj1
operator|.
name|pageSize
argument_list|()
argument_list|)
expr_stmt|;
comment|// PrintRange QPrinter::printRange()
comment|// void QPrinter::setPrintRange(PrintRange)
name|obj1
operator|.
name|setPrintRange
argument_list|(
name|QPrinter
operator|::
name|PrintRange
argument_list|(
name|QPrinter
operator|::
name|AllPages
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QPrinter
operator|::
name|PrintRange
argument_list|(
name|QPrinter
operator|::
name|AllPages
argument_list|)
argument_list|,
name|obj1
operator|.
name|printRange
argument_list|()
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setPrintRange
argument_list|(
name|QPrinter
operator|::
name|PrintRange
argument_list|(
name|QPrinter
operator|::
name|Selection
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QPrinter
operator|::
name|PrintRange
argument_list|(
name|QPrinter
operator|::
name|Selection
argument_list|)
argument_list|,
name|obj1
operator|.
name|printRange
argument_list|()
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|setPrintRange
argument_list|(
name|QPrinter
operator|::
name|PrintRange
argument_list|(
name|QPrinter
operator|::
name|PageRange
argument_list|)
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|QPrinter
operator|::
name|PrintRange
argument_list|(
name|QPrinter
operator|::
name|PageRange
argument_list|)
argument_list|,
name|obj1
operator|.
name|printRange
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_define
DECL|macro|MYCOMPARE
define|#
directive|define
name|MYCOMPARE
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
value|QCOMPARE(QVariant((int)a), QVariant((int)b))
end_define
begin_function
DECL|function|testPageSetupDialog
name|void
name|tst_QPrinter
operator|::
name|testPageSetupDialog
parameter_list|()
block|{
comment|// Make sure this doesn't crash at least
block|{
name|QPrinter
name|printer
decl_stmt|;
name|QPageSetupDialog
name|dialog
argument_list|(
operator|&
name|printer
argument_list|)
decl_stmt|;
block|}
block|}
end_function
begin_ifdef
ifdef|#
directive|ifdef
name|Q_OS_WIN
end_ifdef
begin_comment
comment|// QPrinter::winPageSize(): Windows only.
end_comment
begin_function
DECL|function|testPageSize
name|void
name|tst_QPrinter
operator|::
name|testPageSize
parameter_list|()
block|{
name|QPrinter
name|prn
decl_stmt|;
name|prn
operator|.
name|setPageSize
argument_list|(
name|QPrinter
operator|::
name|Letter
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|prn
operator|.
name|pageSize
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|Letter
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|prn
operator|.
name|winPageSize
argument_list|()
argument_list|,
name|DMPAPER_LETTER
argument_list|)
expr_stmt|;
name|prn
operator|.
name|setPageSize
argument_list|(
name|QPrinter
operator|::
name|A4
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|prn
operator|.
name|pageSize
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|A4
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|prn
operator|.
name|winPageSize
argument_list|()
argument_list|,
name|DMPAPER_A4
argument_list|)
expr_stmt|;
name|prn
operator|.
name|setWinPageSize
argument_list|(
name|DMPAPER_LETTER
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|prn
operator|.
name|winPageSize
argument_list|()
argument_list|,
name|DMPAPER_LETTER
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|prn
operator|.
name|pageSize
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|Letter
argument_list|)
expr_stmt|;
name|prn
operator|.
name|setWinPageSize
argument_list|(
name|DMPAPER_A4
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|prn
operator|.
name|winPageSize
argument_list|()
argument_list|,
name|DMPAPER_A4
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|prn
operator|.
name|pageSize
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|A4
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|// Q_OS_WIN
end_comment
begin_function
DECL|function|testPageRectAndPaperRect_data
name|void
name|tst_QPrinter
operator|::
name|testPageRectAndPaperRect_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"orientation"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"withPainter"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"resolution"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"doPaperRect"
argument_list|)
expr_stmt|;
comment|// paperrect
name|QTest
operator|::
name|newRow
argument_list|(
literal|"paperRect0"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
operator|<<
literal|true
operator|<<
literal|300
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"paperRect1"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
operator|<<
literal|false
operator|<<
literal|300
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"paperRect2"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
operator|<<
literal|true
operator|<<
literal|300
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"paperRect3"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
operator|<<
literal|false
operator|<<
literal|300
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"paperRect4"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
operator|<<
literal|true
operator|<<
literal|600
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"paperRect5"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
operator|<<
literal|false
operator|<<
literal|600
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"paperRect6"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
operator|<<
literal|true
operator|<<
literal|600
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"paperRect7"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
operator|<<
literal|false
operator|<<
literal|600
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"paperRect8"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
operator|<<
literal|true
operator|<<
literal|1200
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"paperRect9"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
operator|<<
literal|false
operator|<<
literal|1200
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"paperRect10"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
operator|<<
literal|true
operator|<<
literal|1200
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"paperRect11"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
operator|<<
literal|false
operator|<<
literal|1200
operator|<<
literal|true
expr_stmt|;
comment|// page rect
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pageRect0"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
operator|<<
literal|true
operator|<<
literal|300
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pageRect1"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
operator|<<
literal|false
operator|<<
literal|300
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pageRect2"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
operator|<<
literal|true
operator|<<
literal|300
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pageRect3"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
operator|<<
literal|false
operator|<<
literal|300
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pageRect4"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
operator|<<
literal|true
operator|<<
literal|600
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pageRect5"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
operator|<<
literal|false
operator|<<
literal|600
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pageRect6"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
operator|<<
literal|true
operator|<<
literal|600
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pageRect7"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
operator|<<
literal|false
operator|<<
literal|600
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pageRect8"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
operator|<<
literal|true
operator|<<
literal|1200
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pageRect9"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
operator|<<
literal|false
operator|<<
literal|1200
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pageRect10"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
operator|<<
literal|true
operator|<<
literal|1200
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"pageRect11"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
operator|<<
literal|false
operator|<<
literal|1200
operator|<<
literal|false
expr_stmt|;
block|}
end_function
begin_function
DECL|function|testPageRectAndPaperRect
name|void
name|tst_QPrinter
operator|::
name|testPageRectAndPaperRect
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|withPainter
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|orientation
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|resolution
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|doPaperRect
argument_list|)
expr_stmt|;
name|QPainter
modifier|*
name|painter
init|=
literal|0
decl_stmt|;
name|QPrinter
name|printer
argument_list|(
name|QPrinter
operator|::
name|HighResolution
argument_list|)
decl_stmt|;
name|printer
operator|.
name|setOrientation
argument_list|(
name|QPrinter
operator|::
name|Orientation
argument_list|(
name|orientation
argument_list|)
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFileName
argument_list|(
literal|"silly"
argument_list|)
expr_stmt|;
name|TempFileCleanup
name|tmpFile
argument_list|(
literal|"silly"
argument_list|)
decl_stmt|;
name|QRect
name|pageRect
init|=
name|doPaperRect
condition|?
name|printer
operator|.
name|paperRect
argument_list|()
else|:
name|printer
operator|.
name|pageRect
argument_list|()
decl_stmt|;
name|float
name|inchesX
init|=
name|float
argument_list|(
name|pageRect
operator|.
name|width
argument_list|()
argument_list|)
operator|/
name|float
argument_list|(
name|printer
operator|.
name|resolution
argument_list|()
argument_list|)
decl_stmt|;
name|float
name|inchesY
init|=
name|float
argument_list|(
name|pageRect
operator|.
name|height
argument_list|()
argument_list|)
operator|/
name|float
argument_list|(
name|printer
operator|.
name|resolution
argument_list|()
argument_list|)
decl_stmt|;
name|printer
operator|.
name|setResolution
argument_list|(
name|resolution
argument_list|)
expr_stmt|;
if|if
condition|(
name|withPainter
condition|)
name|painter
operator|=
operator|new
name|QPainter
argument_list|(
operator|&
name|printer
argument_list|)
expr_stmt|;
name|QRect
name|otherRect
init|=
name|doPaperRect
condition|?
name|printer
operator|.
name|paperRect
argument_list|()
else|:
name|printer
operator|.
name|pageRect
argument_list|()
decl_stmt|;
name|float
name|otherInchesX
init|=
name|float
argument_list|(
name|otherRect
operator|.
name|width
argument_list|()
argument_list|)
operator|/
name|float
argument_list|(
name|printer
operator|.
name|resolution
argument_list|()
argument_list|)
decl_stmt|;
name|float
name|otherInchesY
init|=
name|float
argument_list|(
name|otherRect
operator|.
name|height
argument_list|()
argument_list|)
operator|/
name|float
argument_list|(
name|printer
operator|.
name|resolution
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|painter
operator|!=
literal|0
condition|)
operator|delete
name|painter
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|otherInchesX
operator|-
name|inchesX
argument_list|)
operator|<
literal|0.01
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|otherInchesY
operator|-
name|inchesY
argument_list|)
operator|<
literal|0.01
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|printer
operator|.
name|orientation
argument_list|()
operator|==
name|QPrinter
operator|::
name|Portrait
operator|||
name|pageRect
operator|.
name|width
argument_list|()
operator|>
name|pageRect
operator|.
name|height
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|printer
operator|.
name|orientation
argument_list|()
operator|!=
name|QPrinter
operator|::
name|Portrait
operator|||
name|pageRect
operator|.
name|width
argument_list|()
operator|<
name|pageRect
operator|.
name|height
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|testSetOptions
name|void
name|tst_QPrinter
operator|::
name|testSetOptions
parameter_list|()
block|{
name|QPrinter
name|prn
decl_stmt|;
name|QPrintDialog
name|dlg
argument_list|(
operator|&
name|prn
argument_list|)
decl_stmt|;
comment|// Verify default values
name|MYCOMPARE
argument_list|(
name|dlg
operator|.
name|isOptionEnabled
argument_list|(
name|QAbstractPrintDialog
operator|::
name|PrintToFile
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|dlg
operator|.
name|isOptionEnabled
argument_list|(
name|QAbstractPrintDialog
operator|::
name|PrintSelection
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|dlg
operator|.
name|isOptionEnabled
argument_list|(
name|QAbstractPrintDialog
operator|::
name|PrintPageRange
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|dlg
operator|.
name|setEnabledOptions
argument_list|(
name|QAbstractPrintDialog
operator|::
name|PrintPageRange
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|dlg
operator|.
name|isOptionEnabled
argument_list|(
name|QAbstractPrintDialog
operator|::
name|PrintToFile
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|dlg
operator|.
name|isOptionEnabled
argument_list|(
name|QAbstractPrintDialog
operator|::
name|PrintSelection
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|dlg
operator|.
name|isOptionEnabled
argument_list|(
name|QAbstractPrintDialog
operator|::
name|PrintPageRange
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|dlg
operator|.
name|setEnabledOptions
argument_list|(
operator|(
name|QAbstractPrintDialog
operator|::
name|PrintDialogOptions
argument_list|(
name|QAbstractPrintDialog
operator|::
name|PrintSelection
operator||
name|QAbstractPrintDialog
operator|::
name|PrintPageRange
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|dlg
operator|.
name|isOptionEnabled
argument_list|(
name|QAbstractPrintDialog
operator|::
name|PrintToFile
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|dlg
operator|.
name|isOptionEnabled
argument_list|(
name|QAbstractPrintDialog
operator|::
name|PrintSelection
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|dlg
operator|.
name|isOptionEnabled
argument_list|(
name|QAbstractPrintDialog
operator|::
name|PrintPageRange
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|dlg
operator|.
name|setEnabledOptions
argument_list|(
name|QAbstractPrintDialog
operator|::
name|PrintSelection
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|dlg
operator|.
name|isOptionEnabled
argument_list|(
name|QAbstractPrintDialog
operator|::
name|PrintToFile
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|dlg
operator|.
name|isOptionEnabled
argument_list|(
name|QAbstractPrintDialog
operator|::
name|PrintSelection
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|MYCOMPARE
argument_list|(
name|dlg
operator|.
name|isOptionEnabled
argument_list|(
name|QAbstractPrintDialog
operator|::
name|PrintPageRange
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|testMargins_data
name|void
name|tst_QPrinter
operator|::
name|testMargins_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"orientation"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"fullpage"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"pagesize"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"width"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"height"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"withPainter"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"data0"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
operator|<<
literal|true
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|A4
argument_list|)
operator|<<
literal|210
operator|<<
literal|297
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"data1"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
operator|<<
literal|true
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|A4
argument_list|)
operator|<<
literal|297
operator|<<
literal|210
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"data2"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
operator|<<
literal|false
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|A4
argument_list|)
operator|<<
literal|297
operator|<<
literal|210
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"data3"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
operator|<<
literal|false
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|A4
argument_list|)
operator|<<
literal|210
operator|<<
literal|297
operator|<<
literal|false
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"data4"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
operator|<<
literal|true
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|A4
argument_list|)
operator|<<
literal|210
operator|<<
literal|297
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"data5"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
operator|<<
literal|true
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|A4
argument_list|)
operator|<<
literal|297
operator|<<
literal|210
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"data6"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
operator|<<
literal|false
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|A4
argument_list|)
operator|<<
literal|297
operator|<<
literal|210
operator|<<
literal|true
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"data7"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
operator|<<
literal|false
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|A4
argument_list|)
operator|<<
literal|210
operator|<<
literal|297
operator|<<
literal|true
expr_stmt|;
block|}
end_function
begin_function
DECL|function|testMargins
name|void
name|tst_QPrinter
operator|::
name|testMargins
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|withPainter
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|orientation
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|pagesize
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|width
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|height
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|fullpage
argument_list|)
expr_stmt|;
name|Q_UNUSED
argument_list|(
name|width
argument_list|)
expr_stmt|;
name|Q_UNUSED
argument_list|(
name|height
argument_list|)
expr_stmt|;
name|QPrinter
name|printer
decl_stmt|;
name|QPainter
modifier|*
name|painter
init|=
literal|0
decl_stmt|;
name|printer
operator|.
name|setOutputFileName
argument_list|(
literal|"silly"
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOrientation
argument_list|(
operator|(
name|QPrinter
operator|::
name|Orientation
operator|)
name|orientation
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setFullPage
argument_list|(
name|fullpage
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setPageSize
argument_list|(
operator|(
name|QPrinter
operator|::
name|PageSize
operator|)
name|pagesize
argument_list|)
expr_stmt|;
if|if
condition|(
name|withPainter
condition|)
name|painter
operator|=
operator|new
name|QPainter
argument_list|(
operator|&
name|printer
argument_list|)
expr_stmt|;
if|if
condition|(
name|painter
condition|)
operator|delete
name|painter
expr_stmt|;
name|QFile
operator|::
name|remove
argument_list|(
literal|"silly"
argument_list|)
expr_stmt|;
block|}
end_function
begin_ifdef
ifdef|#
directive|ifdef
name|Q_OS_WIN
end_ifdef
begin_comment
comment|// QPrinter::testNonExistentPrinter() is not relevant for this platform
end_comment
begin_function
DECL|function|testNonExistentPrinter
name|void
name|tst_QPrinter
operator|::
name|testNonExistentPrinter
parameter_list|()
block|{
name|QPrinter
name|printer
decl_stmt|;
name|QPainter
name|painter
decl_stmt|;
comment|// Make sure it doesn't crash on setting or getting properties
name|printer
operator|.
name|setPrinterName
argument_list|(
literal|"some non existing printer"
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setPageSize
argument_list|(
name|QPrinter
operator|::
name|A4
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOrientation
argument_list|(
name|QPrinter
operator|::
name|Portrait
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setFullPage
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|printer
operator|.
name|pageSize
argument_list|()
expr_stmt|;
name|printer
operator|.
name|orientation
argument_list|()
expr_stmt|;
name|printer
operator|.
name|fullPage
argument_list|()
expr_stmt|;
name|printer
operator|.
name|setCopyCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|printer
operator|.
name|printerName
argument_list|()
expr_stmt|;
comment|// nor metrics
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printEngine
argument_list|()
operator|->
name|metric
argument_list|(
name|QPaintDevice
operator|::
name|PdmWidth
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printEngine
argument_list|()
operator|->
name|metric
argument_list|(
name|QPaintDevice
operator|::
name|PdmHeight
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printEngine
argument_list|()
operator|->
name|metric
argument_list|(
name|QPaintDevice
operator|::
name|PdmWidthMM
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printEngine
argument_list|()
operator|->
name|metric
argument_list|(
name|QPaintDevice
operator|::
name|PdmHeightMM
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printEngine
argument_list|()
operator|->
name|metric
argument_list|(
name|QPaintDevice
operator|::
name|PdmNumColors
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printEngine
argument_list|()
operator|->
name|metric
argument_list|(
name|QPaintDevice
operator|::
name|PdmDepth
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printEngine
argument_list|()
operator|->
name|metric
argument_list|(
name|QPaintDevice
operator|::
name|PdmDpiX
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printEngine
argument_list|()
operator|->
name|metric
argument_list|(
name|QPaintDevice
operator|::
name|PdmDpiY
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printEngine
argument_list|()
operator|->
name|metric
argument_list|(
name|QPaintDevice
operator|::
name|PdmPhysicalDpiX
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printEngine
argument_list|()
operator|->
name|metric
argument_list|(
name|QPaintDevice
operator|::
name|PdmPhysicalDpiY
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
operator|!
name|painter
operator|.
name|begin
argument_list|(
operator|&
name|printer
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_function
DECL|function|testMulitpleSets_data
name|void
name|tst_QPrinter
operator|::
name|testMulitpleSets_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"resolution"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"pageSize"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"widthMMAfter"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"heightMMAfter"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"lowRes"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|ScreenResolution
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|A4
argument_list|)
operator|<<
literal|210
operator|<<
literal|297
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"lowResLetter"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|ScreenResolution
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Letter
argument_list|)
operator|<<
literal|216
operator|<<
literal|279
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"lowResA5"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|ScreenResolution
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|A5
argument_list|)
operator|<<
literal|148
operator|<<
literal|210
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"midRes"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|PrinterResolution
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|A4
argument_list|)
operator|<<
literal|210
operator|<<
literal|297
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"midResLetter"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|PrinterResolution
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Letter
argument_list|)
operator|<<
literal|216
operator|<<
literal|279
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"midResA5"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|PrinterResolution
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|A5
argument_list|)
operator|<<
literal|148
operator|<<
literal|210
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"highRes"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|HighResolution
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|A4
argument_list|)
operator|<<
literal|210
operator|<<
literal|297
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"highResLetter"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|HighResolution
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|Letter
argument_list|)
operator|<<
literal|216
operator|<<
literal|279
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"highResA5"
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|HighResolution
argument_list|)
operator|<<
name|int
argument_list|(
name|QPrinter
operator|::
name|A5
argument_list|)
operator|<<
literal|148
operator|<<
literal|210
expr_stmt|;
block|}
end_function
begin_function
DECL|function|computePageValue
specifier|static
name|void
name|computePageValue
parameter_list|(
specifier|const
name|QPrinter
modifier|&
name|printer
parameter_list|,
name|int
modifier|&
name|retWidth
parameter_list|,
name|int
modifier|&
name|retHeight
parameter_list|)
block|{
specifier|const
name|double
name|Inch2MM
init|=
literal|25.4
decl_stmt|;
name|double
name|width
init|=
name|double
argument_list|(
name|printer
operator|.
name|paperRect
argument_list|()
operator|.
name|width
argument_list|()
argument_list|)
operator|/
name|printer
operator|.
name|logicalDpiX
argument_list|()
operator|*
name|Inch2MM
decl_stmt|;
name|double
name|height
init|=
name|double
argument_list|(
name|printer
operator|.
name|paperRect
argument_list|()
operator|.
name|height
argument_list|()
argument_list|)
operator|/
name|printer
operator|.
name|logicalDpiY
argument_list|()
operator|*
name|Inch2MM
decl_stmt|;
name|retWidth
operator|=
name|qRound
argument_list|(
name|width
argument_list|)
expr_stmt|;
name|retHeight
operator|=
name|qRound
argument_list|(
name|height
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|testMulitpleSets
name|void
name|tst_QPrinter
operator|::
name|testMulitpleSets
parameter_list|()
block|{
comment|// A very simple test, but Mac needs to have its format "validated" if the format is changed
comment|// This takes care of that.
name|QFETCH
argument_list|(
name|int
argument_list|,
name|resolution
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|pageSize
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|widthMMAfter
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|heightMMAfter
argument_list|)
expr_stmt|;
name|QPrinter
operator|::
name|PrinterMode
name|mode
init|=
name|QPrinter
operator|::
name|PrinterMode
argument_list|(
name|resolution
argument_list|)
decl_stmt|;
name|QPrinter
operator|::
name|PageSize
name|printerPageSize
init|=
name|QPrinter
operator|::
name|PageSize
argument_list|(
name|pageSize
argument_list|)
decl_stmt|;
name|QPrinter
name|printer
argument_list|(
name|mode
argument_list|)
decl_stmt|;
name|printer
operator|.
name|setFullPage
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|int
name|paperWidth
decl_stmt|,
name|paperHeight
decl_stmt|;
comment|//const int Tolerance = 2;
name|computePageValue
argument_list|(
name|printer
argument_list|,
name|paperWidth
argument_list|,
name|paperHeight
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setPageSize
argument_list|(
name|printerPageSize
argument_list|)
expr_stmt|;
if|if
condition|(
name|printer
operator|.
name|pageSize
argument_list|()
operator|!=
name|printerPageSize
condition|)
block|{
name|QSKIP
argument_list|(
literal|"Current page size is not supported on this printer"
argument_list|)
expr_stmt|;
return|return;
block|}
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|printer
operator|.
name|widthMM
argument_list|()
operator|-
name|widthMMAfter
argument_list|)
operator|<=
literal|2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|printer
operator|.
name|heightMM
argument_list|()
operator|-
name|heightMMAfter
argument_list|)
operator|<=
literal|2
argument_list|)
expr_stmt|;
name|computePageValue
argument_list|(
name|printer
argument_list|,
name|paperWidth
argument_list|,
name|paperHeight
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|paperWidth
operator|-
name|widthMMAfter
argument_list|)
operator|<=
literal|2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|paperHeight
operator|-
name|heightMMAfter
argument_list|)
operator|<=
literal|2
argument_list|)
expr_stmt|;
comment|// Set it again and see if it still works.
name|printer
operator|.
name|setPageSize
argument_list|(
name|printerPageSize
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|printer
operator|.
name|widthMM
argument_list|()
operator|-
name|widthMMAfter
argument_list|)
operator|<=
literal|2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|printer
operator|.
name|heightMM
argument_list|()
operator|-
name|heightMMAfter
argument_list|)
operator|<=
literal|2
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOrientation
argument_list|(
name|QPrinter
operator|::
name|Landscape
argument_list|)
expr_stmt|;
name|computePageValue
argument_list|(
name|printer
argument_list|,
name|paperWidth
argument_list|,
name|paperHeight
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|paperWidth
operator|-
name|heightMMAfter
argument_list|)
operator|<=
literal|2
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|paperHeight
operator|-
name|widthMMAfter
argument_list|)
operator|<=
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|changingOutputFormat
name|void
name|tst_QPrinter
operator|::
name|changingOutputFormat
parameter_list|()
block|{
if|#
directive|if
name|QT_VERSION
operator|<
literal|0x050000
name|QPrinter
name|p
decl_stmt|;
name|p
operator|.
name|setOutputFormat
argument_list|(
name|QPrinter
operator|::
name|PostScriptFormat
argument_list|)
expr_stmt|;
name|p
operator|.
name|setPageSize
argument_list|(
name|QPrinter
operator|::
name|A8
argument_list|)
expr_stmt|;
name|p
operator|.
name|setOutputFormat
argument_list|(
name|QPrinter
operator|::
name|PdfFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|p
operator|.
name|pageSize
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|A8
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function
begin_function
DECL|function|outputFormatFromSuffix
name|void
name|tst_QPrinter
operator|::
name|outputFormatFromSuffix
parameter_list|()
block|{
if|if
condition|(
name|QPrinterInfo
operator|::
name|availablePrinters
argument_list|()
operator|.
name|size
argument_list|()
operator|==
literal|0
condition|)
name|QSKIP
argument_list|(
literal|"No printers available."
argument_list|)
expr_stmt|;
name|QPrinter
name|p
decl_stmt|;
name|QVERIFY
argument_list|(
name|p
operator|.
name|outputFormat
argument_list|()
operator|==
name|QPrinter
operator|::
name|NativeFormat
argument_list|)
expr_stmt|;
name|p
operator|.
name|setOutputFileName
argument_list|(
literal|"test.pdf"
argument_list|)
expr_stmt|;
name|TempFileCleanup
name|tmpFile
argument_list|(
literal|"test.pdf"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|p
operator|.
name|outputFormat
argument_list|()
operator|==
name|QPrinter
operator|::
name|PdfFormat
argument_list|)
expr_stmt|;
name|p
operator|.
name|setOutputFileName
argument_list|(
name|QString
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|p
operator|.
name|outputFormat
argument_list|()
operator|==
name|QPrinter
operator|::
name|NativeFormat
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setGetPaperSize
name|void
name|tst_QPrinter
operator|::
name|setGetPaperSize
parameter_list|()
block|{
name|QPrinter
name|p
decl_stmt|;
name|p
operator|.
name|setOutputFormat
argument_list|(
name|QPrinter
operator|::
name|PdfFormat
argument_list|)
expr_stmt|;
name|QSizeF
name|size
argument_list|(
literal|500
argument_list|,
literal|10
argument_list|)
decl_stmt|;
name|p
operator|.
name|setPaperSize
argument_list|(
name|size
argument_list|,
name|QPrinter
operator|::
name|Millimeter
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|p
operator|.
name|paperSize
argument_list|(
name|QPrinter
operator|::
name|Millimeter
argument_list|)
argument_list|,
name|size
argument_list|)
expr_stmt|;
name|QSizeF
name|ptSize
init|=
name|p
operator|.
name|paperSize
argument_list|(
name|QPrinter
operator|::
name|Point
argument_list|)
decl_stmt|;
comment|//qDebug()<< ptSize;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|ptSize
operator|.
name|width
argument_list|()
operator|-
name|size
operator|.
name|width
argument_list|()
operator|*
operator|(
literal|72
operator|/
literal|25.4
operator|)
argument_list|)
operator|<
literal|1E
operator|-
literal|4
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|qAbs
argument_list|(
name|ptSize
operator|.
name|height
argument_list|()
operator|-
name|size
operator|.
name|height
argument_list|()
operator|*
operator|(
literal|72
operator|/
literal|25.4
operator|)
argument_list|)
operator|<
literal|1E
operator|-
literal|4
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|testPageMargins_data
name|void
name|tst_QPrinter
operator|::
name|testPageMargins_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"left"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"top"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"right"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"bottom"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|int
argument_list|>
argument_list|(
literal|"unit"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"data0"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|5.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|6.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|7.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|8.5
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|QPrinter
operator|::
name|Millimeter
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"data1"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|5.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|6.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|7.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|8.5
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|QPrinter
operator|::
name|Point
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"data2"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|5.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|6.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|7.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|8.5
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|QPrinter
operator|::
name|Inch
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"data3"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|5.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|6.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|7.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|8.5
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|QPrinter
operator|::
name|Pica
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"data4"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|5.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|6.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|7.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|8.5
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|QPrinter
operator|::
name|Didot
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"data5"
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|5.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|6.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|7.5
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|8.5
argument_list|)
operator|<<
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|QPrinter
operator|::
name|Cicero
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|testPageMargins
name|void
name|tst_QPrinter
operator|::
name|testPageMargins
parameter_list|()
block|{
name|QPrinter
name|obj1
decl_stmt|;
name|qreal
name|toMillimeters
index|[
literal|6
index|]
decl_stmt|;
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Millimeter
index|]
operator|=
literal|1
expr_stmt|;
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Point
index|]
operator|=
literal|0.352777778
expr_stmt|;
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Inch
index|]
operator|=
literal|25.4
expr_stmt|;
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Pica
index|]
operator|=
literal|4.23333333
expr_stmt|;
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Didot
index|]
operator|=
literal|0.376
expr_stmt|;
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Cicero
index|]
operator|=
literal|4.51166667
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|left
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|top
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|right
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|bottom
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|int
argument_list|,
name|unit
argument_list|)
expr_stmt|;
name|qreal
name|nLeft
decl_stmt|,
name|nTop
decl_stmt|,
name|nRight
decl_stmt|,
name|nBottom
decl_stmt|;
name|obj1
operator|.
name|setPageMargins
argument_list|(
name|left
argument_list|,
name|top
argument_list|,
name|right
argument_list|,
name|bottom
argument_list|,
cast|static_cast
argument_list|<
name|QPrinter
operator|::
name|Unit
argument_list|>
argument_list|(
name|unit
argument_list|)
argument_list|)
expr_stmt|;
name|qreal
name|tolerance
init|=
literal|0.05
decl_stmt|;
name|obj1
operator|.
name|getPageMargins
argument_list|(
operator|&
name|nLeft
argument_list|,
operator|&
name|nTop
argument_list|,
operator|&
name|nRight
argument_list|,
operator|&
name|nBottom
argument_list|,
name|QPrinter
operator|::
name|Millimeter
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|left
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nLeft
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Millimeter
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|top
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nTop
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Millimeter
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|right
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nRight
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Millimeter
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|bottom
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nBottom
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Millimeter
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|getPageMargins
argument_list|(
operator|&
name|nLeft
argument_list|,
operator|&
name|nTop
argument_list|,
operator|&
name|nRight
argument_list|,
operator|&
name|nBottom
argument_list|,
name|QPrinter
operator|::
name|Point
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|left
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nLeft
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Point
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|top
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nTop
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Point
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|right
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nRight
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Point
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|bottom
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nBottom
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Point
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|getPageMargins
argument_list|(
operator|&
name|nLeft
argument_list|,
operator|&
name|nTop
argument_list|,
operator|&
name|nRight
argument_list|,
operator|&
name|nBottom
argument_list|,
name|QPrinter
operator|::
name|Inch
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|left
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nLeft
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Inch
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|top
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nTop
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Inch
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|right
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nRight
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Inch
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|bottom
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nBottom
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Inch
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|getPageMargins
argument_list|(
operator|&
name|nLeft
argument_list|,
operator|&
name|nTop
argument_list|,
operator|&
name|nRight
argument_list|,
operator|&
name|nBottom
argument_list|,
name|QPrinter
operator|::
name|Pica
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|left
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nLeft
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Pica
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|top
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nTop
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Pica
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|right
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nRight
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Pica
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|bottom
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nBottom
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Pica
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|getPageMargins
argument_list|(
operator|&
name|nLeft
argument_list|,
operator|&
name|nTop
argument_list|,
operator|&
name|nRight
argument_list|,
operator|&
name|nBottom
argument_list|,
name|QPrinter
operator|::
name|Didot
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|left
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nLeft
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Didot
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|top
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nTop
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Didot
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|right
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nRight
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Didot
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|bottom
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nBottom
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Didot
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|obj1
operator|.
name|getPageMargins
argument_list|(
operator|&
name|nLeft
argument_list|,
operator|&
name|nTop
argument_list|,
operator|&
name|nRight
argument_list|,
operator|&
name|nBottom
argument_list|,
name|QPrinter
operator|::
name|Cicero
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|left
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nLeft
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Cicero
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|top
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nTop
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Cicero
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|right
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nRight
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Cicero
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|bottom
operator|*
name|toMillimeters
index|[
name|unit
index|]
operator|-
name|nBottom
operator|*
name|toMillimeters
index|[
name|QPrinter
operator|::
name|Cicero
index|]
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|valuePreservation
name|void
name|tst_QPrinter
operator|::
name|valuePreservation
parameter_list|()
block|{
name|QPrinter
operator|::
name|OutputFormat
name|oldFormat
init|=
name|QPrinter
operator|::
name|PdfFormat
decl_stmt|;
name|QPrinter
operator|::
name|OutputFormat
name|newFormat
init|=
name|QPrinter
operator|::
name|NativeFormat
decl_stmt|;
comment|// TODO: Correct?
comment|// Some properties are documented to only be supported by NativeFormat in X11 environment
name|bool
name|doX11Tests
init|=
name|QGuiApplication
operator|::
name|platformName
argument_list|()
operator|.
name|compare
argument_list|(
name|QLatin1String
argument_list|(
literal|"xcb"
argument_list|)
argument_list|,
name|Qt
operator|::
name|CaseInsensitive
argument_list|)
operator|==
literal|0
decl_stmt|;
name|bool
name|windowsPlatform
init|=
name|QGuiApplication
operator|::
name|platformName
argument_list|()
operator|.
name|compare
argument_list|(
name|QLatin1String
argument_list|(
literal|"windows"
argument_list|)
argument_list|,
name|Qt
operator|::
name|CaseInsensitive
argument_list|)
operator|==
literal|0
decl_stmt|;
name|bool
name|manualSourceSupported
init|=
literal|true
decl_stmt|;
ifdef|#
directive|ifdef
name|Q_OS_WIN
comment|// QPrinter::supportedPaperSources() is only available on Windows, so just assuming manual is supported on others.
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QPrinter
operator|::
name|PaperSource
argument_list|>
name|sources
init|=
name|printer
operator|.
name|supportedPaperSources
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|sources
operator|.
name|contains
argument_list|(
name|QPrinter
operator|::
name|Manual
argument_list|)
condition|)
block|{
name|manualSourceSupported
operator|=
literal|false
expr_stmt|;
name|qWarning
argument_list|()
operator|<<
literal|"Manual paper source not supported by native printer, skipping related test."
expr_stmt|;
block|}
endif|#
directive|endif
comment|// Q_OS_WIN
comment|// Querying PPK_CollateCopies is hardcoded to return false with Windows native print engine,
comment|// so skip testing that in Windows.
if|if
condition|(
operator|!
name|windowsPlatform
condition|)
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|bool
name|status
init|=
name|printer
operator|.
name|collateCopies
argument_list|()
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|collateCopies
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setCollateCopies
argument_list|(
operator|!
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|Q_OS_MAC
name|QEXPECT_FAIL
argument_list|(
literal|""
argument_list|,
literal|"QTBUG-26430"
argument_list|,
name|Abort
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|collateCopies
argument_list|()
argument_list|,
operator|!
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|collateCopies
argument_list|()
argument_list|,
operator|!
name|status
argument_list|)
expr_stmt|;
block|}
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QPrinter
operator|::
name|ColorMode
name|status
init|=
name|printer
operator|.
name|colorMode
argument_list|()
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|colorMode
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setColorMode
argument_list|(
name|QPrinter
operator|::
name|ColorMode
argument_list|(
operator|!
name|status
argument_list|)
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|colorMode
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|ColorMode
argument_list|(
operator|!
name|status
argument_list|)
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|colorMode
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|ColorMode
argument_list|(
operator|!
name|status
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|doX11Tests
condition|)
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QString
name|status
init|=
name|printer
operator|.
name|creator
argument_list|()
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|creator
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|status
operator|=
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"Mr. Test"
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setCreator
argument_list|(
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|creator
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|creator
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
block|}
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QString
name|status
init|=
name|printer
operator|.
name|docName
argument_list|()
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|docName
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|status
operator|=
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"Test document"
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setDocName
argument_list|(
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|docName
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|docName
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|doX11Tests
condition|)
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|bool
name|status
init|=
name|printer
operator|.
name|doubleSidedPrinting
argument_list|()
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|doubleSidedPrinting
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setDoubleSidedPrinting
argument_list|(
operator|!
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|doubleSidedPrinting
argument_list|()
argument_list|,
operator|!
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|doubleSidedPrinting
argument_list|()
argument_list|,
operator|!
name|status
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|doX11Tests
condition|)
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|bool
name|status
init|=
name|printer
operator|.
name|fontEmbeddingEnabled
argument_list|()
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|fontEmbeddingEnabled
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setFontEmbeddingEnabled
argument_list|(
operator|!
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|fontEmbeddingEnabled
argument_list|()
argument_list|,
operator|!
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|fontEmbeddingEnabled
argument_list|()
argument_list|,
operator|!
name|status
argument_list|)
expr_stmt|;
block|}
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|bool
name|status
init|=
name|printer
operator|.
name|fullPage
argument_list|()
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|fullPage
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setFullPage
argument_list|(
operator|!
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|fullPage
argument_list|()
argument_list|,
operator|!
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|fullPage
argument_list|()
argument_list|,
operator|!
name|status
argument_list|)
expr_stmt|;
block|}
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QPrinter
operator|::
name|Orientation
name|status
init|=
name|printer
operator|.
name|orientation
argument_list|()
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|orientation
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOrientation
argument_list|(
name|QPrinter
operator|::
name|Orientation
argument_list|(
operator|!
name|status
argument_list|)
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|orientation
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|Orientation
argument_list|(
operator|!
name|status
argument_list|)
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|orientation
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|Orientation
argument_list|(
operator|!
name|status
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QString
name|status
init|=
name|printer
operator|.
name|outputFileName
argument_list|()
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|outputFileName
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|status
operator|=
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"Test file"
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFileName
argument_list|(
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|outputFileName
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|outputFileName
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|doX11Tests
condition|)
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QPrinter
operator|::
name|PageOrder
name|status
init|=
name|printer
operator|.
name|pageOrder
argument_list|()
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|pageOrder
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setPageOrder
argument_list|(
name|QPrinter
operator|::
name|PageOrder
argument_list|(
operator|!
name|status
argument_list|)
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|pageOrder
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|PageOrder
argument_list|(
operator|!
name|status
argument_list|)
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|pageOrder
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|PageOrder
argument_list|(
operator|!
name|status
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QPrinter
operator|::
name|PageSize
name|status
init|=
name|printer
operator|.
name|pageSize
argument_list|()
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|pageSize
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setPageSize
argument_list|(
name|QPrinter
operator|::
name|B5
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|pageSize
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|B5
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|pageSize
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|B5
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|manualSourceSupported
condition|)
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QPrinter
operator|::
name|PaperSource
name|status
init|=
name|printer
operator|.
name|paperSource
argument_list|()
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|paperSource
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setPaperSource
argument_list|(
name|QPrinter
operator|::
name|Manual
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|paperSource
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|Manual
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|paperSource
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|Manual
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|doX11Tests
condition|)
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QString
name|status
init|=
name|printer
operator|.
name|printProgram
argument_list|()
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printProgram
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|status
operator|=
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"/usr/local/bin/lpr"
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setPrintProgram
argument_list|(
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printProgram
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printProgram
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
block|}
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QPrinter
operator|::
name|PrintRange
name|status
init|=
name|printer
operator|.
name|printRange
argument_list|()
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printRange
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setPrintRange
argument_list|(
name|QPrinter
operator|::
name|PrintRange
argument_list|(
operator|!
name|status
argument_list|)
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printRange
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|PrintRange
argument_list|(
operator|!
name|status
argument_list|)
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printRange
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|PrintRange
argument_list|(
operator|!
name|status
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QString
name|status
init|=
name|printer
operator|.
name|printerName
argument_list|()
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printerName
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|status
operator|=
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"SuperDuperPrinter"
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setPrinterName
argument_list|(
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printerName
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printerName
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
block|}
comment|// QPrinter::printerSelectionOption is explicitly documented not to be available on Windows.
ifndef|#
directive|ifndef
name|Q_OS_WIN
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QString
name|status
init|=
name|printer
operator|.
name|printerSelectionOption
argument_list|()
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printerSelectionOption
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|status
operator|=
name|QString
operator|::
name|fromLatin1
argument_list|(
literal|"Optional option"
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setPrinterSelectionOption
argument_list|(
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printerSelectionOption
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printerSelectionOption
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|// Q_OS_WIN
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|int
name|status
init|=
name|printer
operator|.
name|resolution
argument_list|()
decl_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|resolution
argument_list|()
argument_list|,
name|status
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setResolution
argument_list|(
name|status
operator|-
literal|150
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|newFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|resolution
argument_list|()
argument_list|,
name|status
operator|-
literal|150
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setOutputFormat
argument_list|(
name|oldFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|resolution
argument_list|()
argument_list|,
name|status
operator|-
literal|150
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|errorReporting
name|void
name|tst_QPrinter
operator|::
name|errorReporting
parameter_list|()
block|{
name|QPrinter
name|p
decl_stmt|;
name|p
operator|.
name|setOutputFormat
argument_list|(
name|QPrinter
operator|::
name|PdfFormat
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|p
operator|.
name|isValid
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QPainter
name|painter
decl_stmt|;
ifndef|#
directive|ifndef
name|Q_OS_WIN
comment|// not sure how to choose a never-writable file on windows.  But its QFile behavior anyway, so lets rely on it failing elsewhere
name|p
operator|.
name|setOutputFileName
argument_list|(
literal|"/foobar/nonwritable.pdf"
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|painter
operator|.
name|begin
argument_list|(
operator|&
name|p
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
comment|// it should check the output file is writable
endif|#
directive|endif
name|p
operator|.
name|setOutputFileName
argument_list|(
literal|"test.pdf"
argument_list|)
expr_stmt|;
name|TempFileCleanup
name|tmpFile
argument_list|(
literal|"test.pdf"
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|painter
operator|.
name|begin
argument_list|(
operator|&
name|p
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
comment|// it should check the output
name|QCOMPARE
argument_list|(
name|p
operator|.
name|isValid
argument_list|()
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|testCustomPageSizes
name|void
name|tst_QPrinter
operator|::
name|testCustomPageSizes
parameter_list|()
block|{
name|QPrinter
name|p
decl_stmt|;
name|QSizeF
name|customSize
argument_list|(
literal|8.5
argument_list|,
literal|11.0
argument_list|)
decl_stmt|;
name|p
operator|.
name|setPaperSize
argument_list|(
name|customSize
argument_list|,
name|QPrinter
operator|::
name|Inch
argument_list|)
expr_stmt|;
name|QSizeF
name|paperSize
init|=
name|p
operator|.
name|paperSize
argument_list|(
name|QPrinter
operator|::
name|Inch
argument_list|)
decl_stmt|;
name|QCOMPARE
argument_list|(
name|paperSize
argument_list|,
name|customSize
argument_list|)
expr_stmt|;
name|QPrinter
name|p2
argument_list|(
name|QPrinter
operator|::
name|HighResolution
argument_list|)
decl_stmt|;
name|p2
operator|.
name|setPaperSize
argument_list|(
name|customSize
argument_list|,
name|QPrinter
operator|::
name|Inch
argument_list|)
expr_stmt|;
name|paperSize
operator|=
name|p
operator|.
name|paperSize
argument_list|(
name|QPrinter
operator|::
name|Inch
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|paperSize
argument_list|,
name|customSize
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|customPaperSizeAndMargins_data
name|void
name|tst_QPrinter
operator|::
name|customPaperSizeAndMargins_data
parameter_list|()
block|{
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"pdf"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|bool
argument_list|>
argument_list|(
literal|"before"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"left"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"top"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"right"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|addColumn
argument_list|<
name|qreal
argument_list|>
argument_list|(
literal|"bottom"
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"beforeNoPDF"
argument_list|)
operator|<<
literal|false
operator|<<
literal|true
operator|<<
name|qreal
argument_list|(
literal|2
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|2
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|2
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"beforePDF"
argument_list|)
operator|<<
literal|true
operator|<<
literal|true
operator|<<
name|qreal
argument_list|(
literal|2
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|2
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|2
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"afterNoPDF"
argument_list|)
operator|<<
literal|false
operator|<<
literal|false
operator|<<
name|qreal
argument_list|(
literal|2
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|2
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|2
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|newRow
argument_list|(
literal|"afterAfterPDF"
argument_list|)
operator|<<
literal|true
operator|<<
literal|false
operator|<<
name|qreal
argument_list|(
literal|2
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|2
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|2
argument_list|)
operator|<<
name|qreal
argument_list|(
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|customPaperSizeAndMargins
name|void
name|tst_QPrinter
operator|::
name|customPaperSizeAndMargins
parameter_list|()
block|{
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|pdf
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|bool
argument_list|,
name|before
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|left
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|top
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|right
argument_list|)
expr_stmt|;
name|QFETCH
argument_list|(
name|qreal
argument_list|,
name|bottom
argument_list|)
expr_stmt|;
name|qreal
name|tolerance
init|=
literal|0.05
decl_stmt|;
name|qreal
name|getLeft
init|=
literal|0
decl_stmt|;
name|qreal
name|getRight
init|=
literal|0
decl_stmt|;
name|qreal
name|getTop
init|=
literal|0
decl_stmt|;
name|qreal
name|getBottom
init|=
literal|0
decl_stmt|;
name|QSizeF
name|customSize
argument_list|(
literal|8.5
argument_list|,
literal|11.0
argument_list|)
decl_stmt|;
name|QPrinter
name|p
decl_stmt|;
if|if
condition|(
name|pdf
condition|)
name|p
operator|.
name|setOutputFormat
argument_list|(
name|QPrinter
operator|::
name|PdfFormat
argument_list|)
expr_stmt|;
if|if
condition|(
name|before
condition|)
name|p
operator|.
name|setPageMargins
argument_list|(
name|left
argument_list|,
name|top
argument_list|,
name|right
argument_list|,
name|bottom
argument_list|,
name|QPrinter
operator|::
name|Millimeter
argument_list|)
expr_stmt|;
name|p
operator|.
name|setPaperSize
argument_list|(
name|customSize
argument_list|,
name|QPrinter
operator|::
name|Millimeter
argument_list|)
expr_stmt|;
name|p
operator|.
name|getPageMargins
argument_list|(
operator|&
name|getLeft
argument_list|,
operator|&
name|getTop
argument_list|,
operator|&
name|getRight
argument_list|,
operator|&
name|getBottom
argument_list|,
name|QPrinter
operator|::
name|Millimeter
argument_list|)
expr_stmt|;
if|if
condition|(
name|before
condition|)
block|{
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|left
operator|-
name|getLeft
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|left
operator|-
name|getTop
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|left
operator|-
name|getRight
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|left
operator|-
name|getBottom
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|QVERIFY
argument_list|(
name|getLeft
operator|==
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|getTop
operator|==
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|getRight
operator|==
literal|0
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|getBottom
operator|==
literal|0
argument_list|)
expr_stmt|;
name|p
operator|.
name|setPageMargins
argument_list|(
name|left
argument_list|,
name|top
argument_list|,
name|right
argument_list|,
name|bottom
argument_list|,
name|QPrinter
operator|::
name|Millimeter
argument_list|)
expr_stmt|;
name|p
operator|.
name|getPageMargins
argument_list|(
operator|&
name|getLeft
argument_list|,
operator|&
name|getTop
argument_list|,
operator|&
name|getRight
argument_list|,
operator|&
name|getBottom
argument_list|,
name|QPrinter
operator|::
name|Millimeter
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|left
operator|-
name|getLeft
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|left
operator|-
name|getTop
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|left
operator|-
name|getRight
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|fabs
argument_list|(
name|left
operator|-
name|getBottom
argument_list|)
operator|<
name|tolerance
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|QT_NO_COMPLETER
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|QT_NO_FILEDIALOG
argument_list|)
end_if
begin_function
DECL|function|printDialogCompleter
name|void
name|tst_QPrinter
operator|::
name|printDialogCompleter
parameter_list|()
block|{
name|QPrintDialog
name|dialog
decl_stmt|;
name|dialog
operator|.
name|printer
argument_list|()
operator|->
name|setOutputFileName
argument_list|(
literal|"file.pdf"
argument_list|)
expr_stmt|;
name|TempFileCleanup
name|tmpFile
argument_list|(
literal|"file.pdf"
argument_list|)
decl_stmt|;
name|dialog
operator|.
name|setEnabledOptions
argument_list|(
name|QAbstractPrintDialog
operator|::
name|PrintToFile
argument_list|)
expr_stmt|;
name|dialog
operator|.
name|show
argument_list|()
expr_stmt|;
name|QTest
operator|::
name|qWait
argument_list|(
literal|100
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|dialog
argument_list|,
name|Qt
operator|::
name|Key_Tab
argument_list|)
expr_stmt|;
name|QTest
operator|::
name|keyClick
argument_list|(
operator|&
name|dialog
argument_list|,
literal|'P'
argument_list|)
expr_stmt|;
comment|// The test passes if it doesn't crash.
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_function
DECL|function|testCopyCount
name|void
name|tst_QPrinter
operator|::
name|testCopyCount
parameter_list|()
block|{
name|QPrinter
name|p
decl_stmt|;
name|p
operator|.
name|setCopyCount
argument_list|(
literal|15
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|p
operator|.
name|copyCount
argument_list|()
argument_list|,
literal|15
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|printPage
specifier|static
name|void
name|printPage
parameter_list|(
name|QPainter
modifier|*
name|painter
parameter_list|)
block|{
name|painter
operator|->
name|setPen
argument_list|(
name|QPen
argument_list|(
name|Qt
operator|::
name|black
argument_list|,
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|painter
operator|->
name|drawRect
argument_list|(
literal|50
argument_list|,
literal|60
argument_list|,
literal|70
argument_list|,
literal|80
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|taskQTBUG4497_reusePrinterOnDifferentFiles
name|void
name|tst_QPrinter
operator|::
name|taskQTBUG4497_reusePrinterOnDifferentFiles
parameter_list|()
block|{
name|TempFileCleanup
name|tmpFile1
argument_list|(
literal|"out1.pdf"
argument_list|)
decl_stmt|;
name|TempFileCleanup
name|tmpFile2
argument_list|(
literal|"out2.pdf"
argument_list|)
decl_stmt|;
name|QPrinter
name|printer
decl_stmt|;
block|{
name|printer
operator|.
name|setOutputFileName
argument_list|(
literal|"out1.pdf"
argument_list|)
expr_stmt|;
name|QPainter
name|painter
argument_list|(
operator|&
name|printer
argument_list|)
decl_stmt|;
name|printPage
argument_list|(
operator|&
name|painter
argument_list|)
expr_stmt|;
block|}
block|{
name|printer
operator|.
name|setOutputFileName
argument_list|(
literal|"out2.pdf"
argument_list|)
expr_stmt|;
name|QPainter
name|painter
argument_list|(
operator|&
name|printer
argument_list|)
decl_stmt|;
name|printPage
argument_list|(
operator|&
name|painter
argument_list|)
expr_stmt|;
block|}
name|QFile
name|file1
argument_list|(
literal|"out1.pdf"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|file1
operator|.
name|open
argument_list|(
name|QIODevice
operator|::
name|ReadOnly
argument_list|)
argument_list|)
expr_stmt|;
name|QFile
name|file2
argument_list|(
literal|"out2.pdf"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|file2
operator|.
name|open
argument_list|(
name|QIODevice
operator|::
name|ReadOnly
argument_list|)
argument_list|)
expr_stmt|;
while|while
condition|(
operator|!
name|file1
operator|.
name|atEnd
argument_list|()
operator|&&
operator|!
name|file2
operator|.
name|atEnd
argument_list|()
condition|)
block|{
name|QByteArray
name|file1Line
init|=
name|file1
operator|.
name|readLine
argument_list|()
decl_stmt|;
name|QByteArray
name|file2Line
init|=
name|file2
operator|.
name|readLine
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|file1Line
operator|.
name|startsWith
argument_list|(
literal|"%%CreationDate"
argument_list|)
condition|)
name|QCOMPARE
argument_list|(
name|file1Line
argument_list|,
name|file2Line
argument_list|)
expr_stmt|;
block|}
name|QVERIFY
argument_list|(
name|file1
operator|.
name|atEnd
argument_list|()
argument_list|)
expr_stmt|;
name|QVERIFY
argument_list|(
name|file2
operator|.
name|atEnd
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|testCurrentPage
name|void
name|tst_QPrinter
operator|::
name|testCurrentPage
parameter_list|()
block|{
name|QPrinter
name|printer
decl_stmt|;
name|printer
operator|.
name|setFromTo
argument_list|(
literal|1
argument_list|,
literal|10
argument_list|)
expr_stmt|;
comment|// Test set print range
name|printer
operator|.
name|setPrintRange
argument_list|(
name|QPrinter
operator|::
name|CurrentPage
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|printRange
argument_list|()
argument_list|,
name|QPrinter
operator|::
name|CurrentPage
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|fromPage
argument_list|()
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|printer
operator|.
name|toPage
argument_list|()
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|QPrintDialog
name|dialog
argument_list|(
operator|&
name|printer
argument_list|)
decl_stmt|;
comment|// Test default Current Page option to off
name|QCOMPARE
argument_list|(
name|dialog
operator|.
name|isOptionEnabled
argument_list|(
name|QPrintDialog
operator|::
name|PrintCurrentPage
argument_list|)
argument_list|,
literal|false
argument_list|)
expr_stmt|;
comment|// Test enable Current Page option
name|dialog
operator|.
name|setOption
argument_list|(
name|QPrintDialog
operator|::
name|PrintCurrentPage
argument_list|)
expr_stmt|;
name|QCOMPARE
argument_list|(
name|dialog
operator|.
name|isOptionEnabled
argument_list|(
name|QPrintDialog
operator|::
name|PrintCurrentPage
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|testPdfTitle
name|void
name|tst_QPrinter
operator|::
name|testPdfTitle
parameter_list|()
block|{
comment|// Check the document name is represented correctly in produced pdf
block|{
name|QPainter
name|painter
decl_stmt|;
name|QPrinter
name|printer
decl_stmt|;
comment|// This string is just the UTF-8 encoding of the string: \()f&oslash; hiragana o
specifier|const
name|unsigned
name|char
name|titleBuf
index|[]
init|=
block|{
literal|0x5c
block|,
literal|0x28
block|,
literal|0x29
block|,
literal|0x66
block|,
literal|0xc3
block|,
literal|0xb8
block|,
literal|0xe3
block|,
literal|0x81
block|,
literal|0x8a
block|,
literal|0x00
block|}
decl_stmt|;
specifier|const
name|char
modifier|*
name|title
init|=
cast|reinterpret_cast
argument_list|<
specifier|const
name|char
operator|*
argument_list|>
argument_list|(
name|titleBuf
argument_list|)
decl_stmt|;
name|printer
operator|.
name|setOutputFileName
argument_list|(
literal|"file.pdf"
argument_list|)
expr_stmt|;
name|printer
operator|.
name|setDocName
argument_list|(
name|QString
operator|::
name|fromUtf8
argument_list|(
name|title
argument_list|)
argument_list|)
expr_stmt|;
name|painter
operator|.
name|begin
argument_list|(
operator|&
name|printer
argument_list|)
expr_stmt|;
name|painter
operator|.
name|end
argument_list|()
expr_stmt|;
block|}
name|TempFileCleanup
name|tmpFile
argument_list|(
literal|"file.pdf"
argument_list|)
decl_stmt|;
name|QFile
name|file
argument_list|(
literal|"file.pdf"
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|file
operator|.
name|open
argument_list|(
name|QIODevice
operator|::
name|ReadOnly
argument_list|)
argument_list|)
expr_stmt|;
comment|// The we expect the title to appear in the PDF as:
comment|// ASCII('\title (') UTF16(\\\(\)f&oslash; hiragana o) ASCII(')').
comment|// which has the following binary representation
specifier|const
name|unsigned
name|char
name|expectedBuf
index|[]
init|=
block|{
literal|0x2f
block|,
literal|0x54
block|,
literal|0x69
block|,
literal|0x74
block|,
literal|0x6c
block|,
literal|0x65
block|,
literal|0x20
block|,
literal|0x28
block|,
literal|0xfe
block|,
literal|0xff
block|,
literal|0x00
block|,
literal|0x5c
block|,
literal|0x5c
block|,
literal|0x00
block|,
literal|0x5c
block|,
literal|0x28
block|,
literal|0x00
block|,
literal|0x5c
block|,
literal|0x29
block|,
literal|0x00
block|,
literal|0x66
block|,
literal|0x00
block|,
literal|0xf8
block|,
literal|0x30
block|,
literal|0x4a
block|,
literal|0x29
block|}
decl_stmt|;
specifier|const
name|char
modifier|*
name|expected
init|=
cast|reinterpret_cast
argument_list|<
specifier|const
name|char
operator|*
argument_list|>
argument_list|(
name|expectedBuf
argument_list|)
decl_stmt|;
name|QVERIFY
argument_list|(
name|file
operator|.
name|readAll
argument_list|()
operator|.
name|contains
argument_list|(
name|QByteArray
argument_list|(
name|expected
argument_list|,
literal|26
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|// QT_NO_PRINTER
end_comment
begin_macro
name|QTEST_MAIN
argument_list|(
argument|tst_QPrinter
argument_list|)
end_macro
begin_include
include|#
directive|include
file|"tst_qprinter.moc"
end_include
end_unit
