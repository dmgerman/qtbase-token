begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2015 The Qt Company Ltd. ** Contact: http://www.qt.io/licensing/ ** ** This file is part of the test suite of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL21$ ** Commercial License Usage ** Licensees holding valid commercial Qt licenses may use this file in ** accordance with the commercial license agreement provided with the ** Software or, alternatively, in accordance with the terms contained in ** a written agreement between you and The Qt Company. For licensing terms ** and conditions see http://www.qt.io/terms-conditions. For further ** information use the contact form at http://www.qt.io/contact-us. ** ** GNU Lesser General Public License Usage ** Alternatively, this file may be used under the terms of the GNU Lesser ** General Public License version 2.1 or version 3 as published by the Free ** Software Foundation and appearing in the file LICENSE.LGPLv21 and ** LICENSE.LGPLv3 included in the packaging of this file. Please review the ** following information to ensure the GNU Lesser General Public License ** requirements will be met: https://www.gnu.org/licenses/lgpl.html and ** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html. ** ** As a special exception, The Qt Company gives you certain additional ** rights. These rights are described in The Qt Company LGPL Exception ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package. ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<QApplication>
end_include
begin_include
include|#
directive|include
file|<QLabel>
end_include
begin_include
include|#
directive|include
file|<QMenu>
end_include
begin_include
include|#
directive|include
file|<QMenuBar>
end_include
begin_include
include|#
directive|include
file|<QAction>
end_include
begin_include
include|#
directive|include
file|<QMainWindow>
end_include
begin_include
include|#
directive|include
file|<QSplitter>
end_include
begin_include
include|#
directive|include
file|<QToolBar>
end_include
begin_include
include|#
directive|include
file|<QVector>
end_include
begin_include
include|#
directive|include
file|<QCommandLineOption>
end_include
begin_include
include|#
directive|include
file|<QCommandLineParser>
end_include
begin_include
include|#
directive|include
file|<QPlainTextEdit>
end_include
begin_include
include|#
directive|include
file|<QPainter>
end_include
begin_include
include|#
directive|include
file|<QPainterPath>
end_include
begin_include
include|#
directive|include
file|<QPaintEvent>
end_include
begin_include
include|#
directive|include
file|<QScreen>
end_include
begin_include
include|#
directive|include
file|<QDebug>
end_include
begin_include
include|#
directive|include
file|<QTextStream>
end_include
begin_decl_stmt
DECL|variable|optIgnoreTouch
name|bool
name|optIgnoreTouch
init|=
literal|false
decl_stmt|;
end_decl_stmt
begin_function
DECL|function|operator <<
name|QDebug
name|operator
name|<<
parameter_list|(
name|QDebug
name|debug
parameter_list|,
specifier|const
name|QTouchDevice
modifier|*
name|d
parameter_list|)
block|{
name|QDebugStateSaver
name|saver
argument_list|(
name|debug
argument_list|)
decl_stmt|;
name|debug
operator|.
name|nospace
argument_list|()
expr_stmt|;
name|debug
operator|<<
literal|"QTouchDevice("
operator|<<
name|d
operator|->
name|name
argument_list|()
operator|<<
literal|','
expr_stmt|;
switch|switch
condition|(
name|d
operator|->
name|type
argument_list|()
condition|)
block|{
case|case
name|QTouchDevice
operator|::
name|TouchScreen
case|:
name|debug
operator|<<
literal|"TouchScreen"
expr_stmt|;
break|break;
case|case
name|QTouchDevice
operator|::
name|TouchPad
case|:
name|debug
operator|<<
literal|"TouchPad"
expr_stmt|;
break|break;
block|}
name|debug
operator|<<
literal|", capabilities="
operator|<<
name|d
operator|->
name|capabilities
argument_list|()
operator|<<
literal|", maximumTouchPoints="
operator|<<
name|d
operator|->
name|maximumTouchPoints
argument_list|()
operator|<<
literal|')'
expr_stmt|;
return|return
name|debug
return|;
block|}
end_function
begin_typedef
DECL|typedef|EventTypeVector
typedef|typedef
name|QVector
argument_list|<
name|QEvent
operator|::
name|Type
argument_list|>
name|EventTypeVector
typedef|;
end_typedef
begin_class
DECL|class|EventFilter
class|class
name|EventFilter
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
public|public:
DECL|function|EventFilter
specifier|explicit
name|EventFilter
parameter_list|(
specifier|const
name|EventTypeVector
modifier|&
name|types
parameter_list|,
name|QObject
modifier|*
name|p
parameter_list|)
member_init_list|:
name|QObject
argument_list|(
name|p
argument_list|)
member_init_list|,
name|m_types
argument_list|(
name|types
argument_list|)
block|{}
DECL|member|Q_DECL_OVERRIDE
name|bool
name|eventFilter
parameter_list|(
name|QObject
modifier|*
parameter_list|,
name|QEvent
modifier|*
parameter_list|)
name|Q_DECL_OVERRIDE
function_decl|;
signals|signals:
name|void
name|eventReceived
parameter_list|(
specifier|const
name|QString
modifier|&
parameter_list|)
function_decl|;
private|private:
DECL|member|m_types
specifier|const
name|EventTypeVector
name|m_types
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|eventFilter
name|bool
name|EventFilter
operator|::
name|eventFilter
parameter_list|(
name|QObject
modifier|*
name|o
parameter_list|,
name|QEvent
modifier|*
name|e
parameter_list|)
block|{
specifier|static
name|int
name|n
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|m_types
operator|.
name|contains
argument_list|(
name|e
operator|->
name|type
argument_list|()
argument_list|)
condition|)
block|{
name|QString
name|message
decl_stmt|;
name|QDebug
argument_list|(
operator|&
name|message
argument_list|)
operator|<<
literal|'#'
operator|<<
name|n
operator|++
operator|<<
literal|' '
operator|<<
name|o
operator|->
name|objectName
argument_list|()
operator|<<
literal|' '
operator|<<
name|e
expr_stmt|;
emit|emit
name|eventReceived
argument_list|(
name|message
argument_list|)
emit|;
block|}
return|return
literal|false
return|;
block|}
end_function
begin_enum
DECL|enum|PointType
enum|enum
name|PointType
block|{
DECL|enumerator|TouchPoint
name|TouchPoint
block|,
DECL|enumerator|MousePress
name|MousePress
block|,
DECL|enumerator|MouseRelease
name|MouseRelease
block|}
enum|;
end_enum
begin_struct
DECL|struct|Point
struct|struct
name|Point
block|{
DECL|function|Point
name|Point
parameter_list|(
specifier|const
name|QPointF
modifier|&
name|p
init|=
name|QPoint
argument_list|()
parameter_list|,
name|PointType
name|t
init|=
name|TouchPoint
parameter_list|,
name|Qt
operator|::
name|MouseEventSource
name|s
init|=
name|Qt
operator|::
name|MouseEventNotSynthesized
parameter_list|)
member_init_list|:
name|pos
argument_list|(
name|p
argument_list|)
member_init_list|,
name|type
argument_list|(
name|t
argument_list|)
member_init_list|,
name|source
argument_list|(
name|s
argument_list|)
block|{}
name|QColor
name|color
parameter_list|()
specifier|const
function_decl|;
DECL|member|pos
name|QPointF
name|pos
decl_stmt|;
DECL|member|type
name|PointType
name|type
decl_stmt|;
DECL|member|source
name|Qt
operator|::
name|MouseEventSource
name|source
decl_stmt|;
block|}
struct|;
end_struct
begin_function
DECL|function|color
name|QColor
name|Point
operator|::
name|color
parameter_list|()
specifier|const
block|{
name|Qt
operator|::
name|GlobalColor
name|globalColor
init|=
name|Qt
operator|::
name|black
decl_stmt|;
if|if
condition|(
name|type
operator|!=
name|TouchPoint
condition|)
block|{
switch|switch
condition|(
name|source
condition|)
block|{
case|case
name|Qt
operator|::
name|MouseEventSynthesizedBySystem
case|:
name|globalColor
operator|=
name|Qt
operator|::
name|red
expr_stmt|;
break|break;
case|case
name|Qt
operator|::
name|MouseEventSynthesizedByQt
case|:
name|globalColor
operator|=
name|Qt
operator|::
name|blue
expr_stmt|;
break|break;
case|case
name|Qt
operator|::
name|MouseEventNotSynthesized
case|:
break|break;
block|}
block|}
specifier|const
name|QColor
name|result
argument_list|(
name|globalColor
argument_list|)
decl_stmt|;
return|return
name|type
operator|==
name|MousePress
condition|?
name|result
operator|.
name|lighter
argument_list|()
else|:
name|result
return|;
block|}
end_function
begin_class
DECL|class|TouchTestWidget
class|class
name|TouchTestWidget
super|:
specifier|public
name|QWidget
block|{
name|Q_OBJECT
name|Q_PROPERTY
parameter_list|(
name|bool
name|drawPoints
name|READ
name|drawPoints
name|WRITE
name|setDrawPoints
parameter_list|)
specifier|public
private|:
DECL|function|TouchTestWidget
specifier|explicit
name|TouchTestWidget
parameter_list|(
name|QWidget
modifier|*
name|parent
init|=
literal|0
parameter_list|)
member_init_list|:
name|QWidget
argument_list|(
name|parent
argument_list|)
member_init_list|,
name|m_drawPoints
argument_list|(
literal|true
argument_list|)
block|{
name|setAttribute
argument_list|(
name|Qt
operator|::
name|WA_AcceptTouchEvents
argument_list|)
expr_stmt|;
block|}
DECL|function|drawPoints
name|bool
name|drawPoints
parameter_list|()
specifier|const
block|{
return|return
name|m_drawPoints
return|;
block|}
public|public
name|slots
public|:
name|void
name|clearPoints
parameter_list|()
function_decl|;
name|void
name|setDrawPoints
parameter_list|(
name|bool
name|drawPoints
parameter_list|)
function_decl|;
protected|protected:
DECL|member|Q_DECL_OVERRIDE
name|bool
name|event
parameter_list|(
name|QEvent
modifier|*
name|event
parameter_list|)
name|Q_DECL_OVERRIDE
function_decl|;
DECL|member|Q_DECL_OVERRIDE
name|void
name|paintEvent
parameter_list|(
name|QPaintEvent
modifier|*
parameter_list|)
name|Q_DECL_OVERRIDE
function_decl|;
private|private:
DECL|member|m_points
name|QVector
argument_list|<
name|Point
argument_list|>
name|m_points
decl_stmt|;
DECL|member|m_drawPoints
name|bool
name|m_drawPoints
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|clearPoints
name|void
name|TouchTestWidget
operator|::
name|clearPoints
parameter_list|()
block|{
if|if
condition|(
operator|!
name|m_points
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|m_points
operator|.
name|clear
argument_list|()
expr_stmt|;
name|update
argument_list|()
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|setDrawPoints
name|void
name|TouchTestWidget
operator|::
name|setDrawPoints
parameter_list|(
name|bool
name|drawPoints
parameter_list|)
block|{
if|if
condition|(
name|m_drawPoints
operator|!=
name|drawPoints
condition|)
block|{
name|clearPoints
argument_list|()
expr_stmt|;
name|m_drawPoints
operator|=
name|drawPoints
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|event
name|bool
name|TouchTestWidget
operator|::
name|event
parameter_list|(
name|QEvent
modifier|*
name|event
parameter_list|)
block|{
specifier|const
name|QEvent
operator|::
name|Type
name|type
init|=
name|event
operator|->
name|type
argument_list|()
decl_stmt|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|QEvent
operator|::
name|MouseButtonPress
case|:
case|case
name|QEvent
operator|::
name|MouseButtonRelease
case|:
if|if
condition|(
name|m_drawPoints
condition|)
block|{
specifier|const
name|QMouseEvent
modifier|*
name|me
init|=
cast|static_cast
argument_list|<
specifier|const
name|QMouseEvent
operator|*
argument_list|>
argument_list|(
name|event
argument_list|)
decl_stmt|;
name|m_points
operator|.
name|append
argument_list|(
name|Point
argument_list|(
name|me
operator|->
name|localPos
argument_list|()
argument_list|,
name|type
operator|==
name|QEvent
operator|::
name|MouseButtonPress
condition|?
name|MousePress
else|:
name|MouseRelease
argument_list|,
name|me
operator|->
name|source
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|update
argument_list|()
expr_stmt|;
block|}
break|break;
case|case
name|QEvent
operator|::
name|TouchBegin
case|:
case|case
name|QEvent
operator|::
name|TouchUpdate
case|:
if|if
condition|(
name|m_drawPoints
condition|)
block|{
foreach|foreach
control|(
specifier|const
name|QTouchEvent
operator|::
name|TouchPoint
modifier|&
name|p
decl|,
cast|static_cast
argument_list|<
specifier|const
name|QTouchEvent
operator|*
argument_list|>
argument_list|(
name|event
argument_list|)
operator|->
name|touchPoints
argument_list|()
control|)
name|m_points
operator|.
name|append
argument_list|(
name|Point
argument_list|(
name|p
operator|.
name|pos
argument_list|()
argument_list|,
name|TouchPoint
argument_list|)
argument_list|)
expr_stmt|;
name|update
argument_list|()
expr_stmt|;
block|}
case|case
name|QEvent
operator|::
name|TouchEnd
case|:
if|if
condition|(
name|optIgnoreTouch
condition|)
name|event
operator|->
name|ignore
argument_list|()
expr_stmt|;
else|else
name|event
operator|->
name|accept
argument_list|()
expr_stmt|;
return|return
literal|true
return|;
default|default:
break|break;
block|}
return|return
name|QWidget
operator|::
name|event
argument_list|(
name|event
argument_list|)
return|;
block|}
end_function
begin_function
DECL|function|paintEvent
name|void
name|TouchTestWidget
operator|::
name|paintEvent
parameter_list|(
name|QPaintEvent
modifier|*
parameter_list|)
block|{
comment|// Draw touch points as dots, mouse press as light filled circles, mouse release as circles.
name|QPainter
name|painter
argument_list|(
name|this
argument_list|)
decl_stmt|;
specifier|const
name|QRectF
name|geom
init|=
name|QRectF
argument_list|(
name|QPointF
argument_list|(
literal|0
argument_list|,
literal|0
argument_list|)
argument_list|,
name|QSizeF
argument_list|(
name|size
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|painter
operator|.
name|fillRect
argument_list|(
name|geom
argument_list|,
name|Qt
operator|::
name|white
argument_list|)
expr_stmt|;
name|painter
operator|.
name|drawRect
argument_list|(
name|QRectF
argument_list|(
name|geom
operator|.
name|topLeft
argument_list|()
argument_list|,
name|geom
operator|.
name|bottomRight
argument_list|()
operator|-
name|QPointF
argument_list|(
literal|1
argument_list|,
literal|1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
foreach|foreach
control|(
specifier|const
name|Point
modifier|&
name|point
decl|,
name|m_points
control|)
block|{
if|if
condition|(
name|geom
operator|.
name|contains
argument_list|(
name|point
operator|.
name|pos
argument_list|)
condition|)
block|{
name|QPainterPath
name|painterPath
decl_stmt|;
specifier|const
name|qreal
name|radius
init|=
name|point
operator|.
name|type
operator|==
name|TouchPoint
condition|?
literal|1
else|:
literal|4
decl_stmt|;
name|painterPath
operator|.
name|addEllipse
argument_list|(
name|point
operator|.
name|pos
argument_list|,
name|radius
argument_list|,
name|radius
argument_list|)
expr_stmt|;
if|if
condition|(
name|point
operator|.
name|type
operator|==
name|MouseRelease
condition|)
name|painter
operator|.
name|strokePath
argument_list|(
name|painterPath
argument_list|,
name|QPen
argument_list|(
name|point
operator|.
name|color
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
else|else
name|painter
operator|.
name|fillPath
argument_list|(
name|painterPath
argument_list|,
name|point
operator|.
name|color
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function
begin_class
DECL|class|MainWindow
class|class
name|MainWindow
super|:
specifier|public
name|QMainWindow
block|{
name|Q_OBJECT
public|public:
name|MainWindow
parameter_list|()
constructor_decl|;
DECL|function|touchWidget
name|QWidget
modifier|*
name|touchWidget
parameter_list|()
specifier|const
block|{
return|return
name|m_touchWidget
return|;
block|}
public|public
name|slots
public|:
DECL|function|appendToLog
name|void
name|appendToLog
parameter_list|(
specifier|const
name|QString
modifier|&
name|text
parameter_list|)
block|{
name|m_logTextEdit
operator|->
name|appendPlainText
argument_list|(
name|text
argument_list|)
expr_stmt|;
block|}
name|void
name|dumpTouchDevices
parameter_list|()
function_decl|;
private|private:
DECL|member|m_touchWidget
name|TouchTestWidget
modifier|*
name|m_touchWidget
decl_stmt|;
DECL|member|m_logTextEdit
name|QPlainTextEdit
modifier|*
name|m_logTextEdit
decl_stmt|;
block|}
class|;
end_class
begin_constructor
DECL|function|MainWindow
name|MainWindow
operator|::
name|MainWindow
parameter_list|()
member_init_list|:
name|m_touchWidget
argument_list|(
operator|new
name|TouchTestWidget
argument_list|)
member_init_list|,
name|m_logTextEdit
argument_list|(
operator|new
name|QPlainTextEdit
argument_list|)
block|{
name|setWindowTitle
argument_list|(
name|QStringLiteral
argument_list|(
literal|"Touch Event Tester "
argument_list|)
operator|+
name|QT_VERSION_STR
argument_list|)
expr_stmt|;
name|setObjectName
argument_list|(
literal|"MainWin"
argument_list|)
expr_stmt|;
name|QToolBar
modifier|*
name|toolBar
init|=
operator|new
name|QToolBar
argument_list|(
name|this
argument_list|)
decl_stmt|;
name|addToolBar
argument_list|(
name|Qt
operator|::
name|TopToolBarArea
argument_list|,
name|toolBar
argument_list|)
expr_stmt|;
name|QMenu
modifier|*
name|fileMenu
init|=
name|menuBar
argument_list|()
operator|->
name|addMenu
argument_list|(
literal|"File"
argument_list|)
decl_stmt|;
name|QAction
modifier|*
name|dumpDeviceAction
init|=
name|fileMenu
operator|->
name|addAction
argument_list|(
name|QStringLiteral
argument_list|(
literal|"Dump devices"
argument_list|)
argument_list|)
decl_stmt|;
name|dumpDeviceAction
operator|->
name|setShortcut
argument_list|(
name|QKeySequence
argument_list|(
name|Qt
operator|::
name|CTRL
operator|+
name|Qt
operator|::
name|Key_D
argument_list|)
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|dumpDeviceAction
argument_list|,
name|SIGNAL
argument_list|(
name|triggered
argument_list|()
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|dumpTouchDevices
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|toolBar
operator|->
name|addAction
argument_list|(
name|dumpDeviceAction
argument_list|)
expr_stmt|;
name|QAction
modifier|*
name|clearLogAction
init|=
name|fileMenu
operator|->
name|addAction
argument_list|(
name|QStringLiteral
argument_list|(
literal|"Clear Log"
argument_list|)
argument_list|)
decl_stmt|;
name|clearLogAction
operator|->
name|setShortcut
argument_list|(
name|QKeySequence
argument_list|(
name|Qt
operator|::
name|CTRL
operator|+
name|Qt
operator|::
name|Key_L
argument_list|)
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|clearLogAction
argument_list|,
name|SIGNAL
argument_list|(
name|triggered
argument_list|()
argument_list|)
argument_list|,
name|m_logTextEdit
argument_list|,
name|SLOT
argument_list|(
name|clear
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|toolBar
operator|->
name|addAction
argument_list|(
name|clearLogAction
argument_list|)
expr_stmt|;
name|QAction
modifier|*
name|toggleDrawPointAction
init|=
name|fileMenu
operator|->
name|addAction
argument_list|(
name|QStringLiteral
argument_list|(
literal|"Draw Points"
argument_list|)
argument_list|)
decl_stmt|;
name|toggleDrawPointAction
operator|->
name|setCheckable
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|toggleDrawPointAction
operator|->
name|setChecked
argument_list|(
name|m_touchWidget
operator|->
name|drawPoints
argument_list|()
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|toggleDrawPointAction
argument_list|,
name|SIGNAL
argument_list|(
name|toggled
argument_list|(
name|bool
argument_list|)
argument_list|)
argument_list|,
name|m_touchWidget
argument_list|,
name|SLOT
argument_list|(
name|setDrawPoints
argument_list|(
name|bool
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|toolBar
operator|->
name|addAction
argument_list|(
name|toggleDrawPointAction
argument_list|)
expr_stmt|;
name|QAction
modifier|*
name|clearPointAction
init|=
name|fileMenu
operator|->
name|addAction
argument_list|(
name|QStringLiteral
argument_list|(
literal|"Clear Points"
argument_list|)
argument_list|)
decl_stmt|;
name|clearPointAction
operator|->
name|setShortcut
argument_list|(
name|QKeySequence
argument_list|(
name|Qt
operator|::
name|CTRL
operator|+
name|Qt
operator|::
name|Key_P
argument_list|)
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|clearPointAction
argument_list|,
name|SIGNAL
argument_list|(
name|triggered
argument_list|()
argument_list|)
argument_list|,
name|m_touchWidget
argument_list|,
name|SLOT
argument_list|(
name|clearPoints
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|toolBar
operator|->
name|addAction
argument_list|(
name|clearPointAction
argument_list|)
expr_stmt|;
name|QAction
modifier|*
name|quitAction
init|=
name|fileMenu
operator|->
name|addAction
argument_list|(
name|QStringLiteral
argument_list|(
literal|"Quit"
argument_list|)
argument_list|)
decl_stmt|;
name|quitAction
operator|->
name|setShortcut
argument_list|(
name|QKeySequence
argument_list|(
name|Qt
operator|::
name|CTRL
operator|+
name|Qt
operator|::
name|Key_Q
argument_list|)
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|quitAction
argument_list|,
name|SIGNAL
argument_list|(
name|triggered
argument_list|()
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|close
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|toolBar
operator|->
name|addAction
argument_list|(
name|quitAction
argument_list|)
expr_stmt|;
name|QSplitter
modifier|*
name|mainSplitter
init|=
operator|new
name|QSplitter
argument_list|(
name|Qt
operator|::
name|Vertical
argument_list|,
name|this
argument_list|)
decl_stmt|;
name|m_touchWidget
operator|->
name|setObjectName
argument_list|(
name|QStringLiteral
argument_list|(
literal|"TouchWidget"
argument_list|)
argument_list|)
expr_stmt|;
name|mainSplitter
operator|->
name|addWidget
argument_list|(
name|m_touchWidget
argument_list|)
expr_stmt|;
name|m_logTextEdit
operator|->
name|setObjectName
argument_list|(
name|QStringLiteral
argument_list|(
literal|"LogTextEdit"
argument_list|)
argument_list|)
expr_stmt|;
name|mainSplitter
operator|->
name|addWidget
argument_list|(
name|m_logTextEdit
argument_list|)
expr_stmt|;
name|setCentralWidget
argument_list|(
name|mainSplitter
argument_list|)
expr_stmt|;
name|dumpTouchDevices
argument_list|()
expr_stmt|;
block|}
end_constructor
begin_function
DECL|function|dumpTouchDevices
name|void
name|MainWindow
operator|::
name|dumpTouchDevices
parameter_list|()
block|{
name|QString
name|message
decl_stmt|;
name|QDebug
name|debug
argument_list|(
operator|&
name|message
argument_list|)
decl_stmt|;
specifier|const
name|QList
argument_list|<
specifier|const
name|QTouchDevice
modifier|*
argument_list|>
name|devices
init|=
name|QTouchDevice
operator|::
name|devices
argument_list|()
decl_stmt|;
name|debug
operator|<<
name|devices
operator|.
name|size
argument_list|()
operator|<<
literal|"Device(s):\n"
expr_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|devices
operator|.
name|size
argument_list|()
condition|;
operator|++
name|i
control|)
name|debug
operator|<<
literal|"Device #"
operator|<<
name|i
operator|<<
name|devices
operator|.
name|at
argument_list|(
name|i
argument_list|)
operator|<<
literal|'\n'
expr_stmt|;
name|appendToLog
argument_list|(
name|message
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|main
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
name|argv
index|[]
parameter_list|)
block|{
name|QApplication
name|a
argument_list|(
name|argc
argument_list|,
name|argv
argument_list|)
decl_stmt|;
name|QCommandLineParser
name|parser
decl_stmt|;
name|parser
operator|.
name|setApplicationDescription
argument_list|(
name|QStringLiteral
argument_list|(
literal|"Touch/Mouse tester"
argument_list|)
argument_list|)
expr_stmt|;
name|parser
operator|.
name|addHelpOption
argument_list|()
expr_stmt|;
specifier|const
name|QCommandLineOption
name|mouseMoveOption
argument_list|(
name|QStringLiteral
argument_list|(
literal|"mousemove"
argument_list|)
argument_list|,
name|QStringLiteral
argument_list|(
literal|"Log mouse move events"
argument_list|)
argument_list|)
decl_stmt|;
name|parser
operator|.
name|addOption
argument_list|(
name|mouseMoveOption
argument_list|)
expr_stmt|;
specifier|const
name|QCommandLineOption
name|globalFilterOption
argument_list|(
name|QStringLiteral
argument_list|(
literal|"global"
argument_list|)
argument_list|,
name|QStringLiteral
argument_list|(
literal|"Global event filter"
argument_list|)
argument_list|)
decl_stmt|;
name|parser
operator|.
name|addOption
argument_list|(
name|globalFilterOption
argument_list|)
expr_stmt|;
specifier|const
name|QCommandLineOption
name|ignoreTouchOption
argument_list|(
name|QStringLiteral
argument_list|(
literal|"ignore"
argument_list|)
argument_list|,
name|QStringLiteral
argument_list|(
literal|"Ignore touch events (for testing mouse emulation)."
argument_list|)
argument_list|)
decl_stmt|;
name|parser
operator|.
name|addOption
argument_list|(
name|ignoreTouchOption
argument_list|)
expr_stmt|;
name|parser
operator|.
name|process
argument_list|(
name|QApplication
operator|::
name|arguments
argument_list|()
argument_list|)
expr_stmt|;
name|optIgnoreTouch
operator|=
name|parser
operator|.
name|isSet
argument_list|(
name|ignoreTouchOption
argument_list|)
expr_stmt|;
name|MainWindow
name|w
decl_stmt|;
specifier|const
name|QSize
name|screenSize
init|=
name|QGuiApplication
operator|::
name|primaryScreen
argument_list|()
operator|->
name|availableGeometry
argument_list|()
operator|.
name|size
argument_list|()
decl_stmt|;
name|w
operator|.
name|resize
argument_list|(
name|screenSize
operator|/
literal|2
argument_list|)
expr_stmt|;
specifier|const
name|QSize
name|sizeDiff
init|=
name|screenSize
operator|-
name|w
operator|.
name|size
argument_list|()
decl_stmt|;
name|w
operator|.
name|move
argument_list|(
name|sizeDiff
operator|.
name|width
argument_list|()
operator|/
literal|2
argument_list|,
name|sizeDiff
operator|.
name|height
argument_list|()
operator|/
literal|2
argument_list|)
expr_stmt|;
name|w
operator|.
name|show
argument_list|()
expr_stmt|;
name|EventTypeVector
name|eventTypes
decl_stmt|;
name|eventTypes
operator|<<
name|QEvent
operator|::
name|MouseButtonPress
operator|<<
name|QEvent
operator|::
name|MouseButtonRelease
operator|<<
name|QEvent
operator|::
name|MouseButtonDblClick
operator|<<
name|QEvent
operator|::
name|TouchBegin
operator|<<
name|QEvent
operator|::
name|TouchUpdate
operator|<<
name|QEvent
operator|::
name|TouchEnd
expr_stmt|;
if|if
condition|(
name|parser
operator|.
name|isSet
argument_list|(
name|mouseMoveOption
argument_list|)
condition|)
name|eventTypes
operator|<<
name|QEvent
operator|::
name|MouseMove
expr_stmt|;
name|QObject
modifier|*
name|filterTarget
init|=
name|parser
operator|.
name|isSet
argument_list|(
name|globalFilterOption
argument_list|)
condition|?
cast|static_cast
argument_list|<
name|QObject
operator|*
argument_list|>
argument_list|(
operator|&
name|a
argument_list|)
else|:
cast|static_cast
argument_list|<
name|QObject
operator|*
argument_list|>
argument_list|(
name|w
operator|.
name|touchWidget
argument_list|()
argument_list|)
decl_stmt|;
name|EventFilter
modifier|*
name|filter
init|=
operator|new
name|EventFilter
argument_list|(
name|eventTypes
argument_list|,
name|filterTarget
argument_list|)
decl_stmt|;
name|filterTarget
operator|->
name|installEventFilter
argument_list|(
name|filter
argument_list|)
expr_stmt|;
name|QObject
operator|::
name|connect
argument_list|(
name|filter
argument_list|,
name|SIGNAL
argument_list|(
name|eventReceived
argument_list|(
name|QString
argument_list|)
argument_list|)
argument_list|,
operator|&
name|w
argument_list|,
name|SLOT
argument_list|(
name|appendToLog
argument_list|(
name|QString
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|a
operator|.
name|exec
argument_list|()
return|;
block|}
end_function
begin_include
include|#
directive|include
file|"main.moc"
end_include
end_unit
