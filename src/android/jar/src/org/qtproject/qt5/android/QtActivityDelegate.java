begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2013 Digia Plc and/or its subsidiary(-ies). ** Copyright (C) 2012 BogDan Vatra<bogdan@kde.org> ** Contact: http://www.qt-project.org/legal ** ** This file is part of the Android port of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL$ ** Commercial License Usage ** Licensees holding valid commercial Qt licenses may use this file in ** accordance with the commercial license agreement provided with the ** Software or, alternatively, in accordance with the terms contained in ** a written agreement between you and Digia.  For licensing terms and ** conditions see http://qt.digia.com/licensing.  For further information ** use the contact form at http://qt.digia.com/contact-us. ** ** GNU Lesser General Public License Usage ** Alternatively, this file may be used under the terms of the GNU Lesser ** General Public License version 2.1 as published by the Free Software ** Foundation and appearing in the file LICENSE.LGPL included in the ** packaging of this file.  Please review the following information to ** ensure the GNU Lesser General Public License version 2.1 requirements ** will be met: http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html. ** ** In addition, as a special exception, Digia gives you certain additional ** rights.  These rights are described in the Digia Qt LGPL Exception ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package. ** ** GNU General Public License Usage ** Alternatively, this file may be used under the terms of the GNU ** General Public License version 3.0 as published by the Free Software ** Foundation and appearing in the file LICENSE.GPL included in the ** packaging of this file.  Please review the following information to ** ensure the GNU General Public License version 3.0 requirements will be ** met: http://www.gnu.org/copyleft/gpl.html. ** ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_package
DECL|package|org.qtproject.qt5.android
package|package
name|org
operator|.
name|qtproject
operator|.
name|qt5
operator|.
name|android
package|;
end_package
begin_import
import|import
name|java
operator|.
name|io
operator|.
name|File
import|;
end_import
begin_import
import|import
name|java
operator|.
name|io
operator|.
name|FileWriter
import|;
end_import
begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import
begin_import
import|import
name|java
operator|.
name|lang
operator|.
name|reflect
operator|.
name|Method
import|;
end_import
begin_import
import|import
name|java
operator|.
name|util
operator|.
name|ArrayList
import|;
end_import
begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Iterator
import|;
end_import
begin_import
import|import
name|android
operator|.
name|app
operator|.
name|Activity
import|;
end_import
begin_import
import|import
name|android
operator|.
name|content
operator|.
name|Context
import|;
end_import
begin_import
import|import
name|android
operator|.
name|content
operator|.
name|pm
operator|.
name|PackageManager
import|;
end_import
begin_import
import|import
name|android
operator|.
name|content
operator|.
name|pm
operator|.
name|PackageManager
operator|.
name|NameNotFoundException
import|;
end_import
begin_import
import|import
name|android
operator|.
name|content
operator|.
name|res
operator|.
name|Configuration
import|;
end_import
begin_import
import|import
name|android
operator|.
name|graphics
operator|.
name|Rect
import|;
end_import
begin_import
import|import
name|android
operator|.
name|os
operator|.
name|Build
import|;
end_import
begin_import
import|import
name|android
operator|.
name|os
operator|.
name|Bundle
import|;
end_import
begin_import
import|import
name|android
operator|.
name|text
operator|.
name|method
operator|.
name|MetaKeyKeyListener
import|;
end_import
begin_import
import|import
name|android
operator|.
name|util
operator|.
name|DisplayMetrics
import|;
end_import
begin_import
import|import
name|android
operator|.
name|util
operator|.
name|Log
import|;
end_import
begin_import
import|import
name|android
operator|.
name|view
operator|.
name|ContextMenu
import|;
end_import
begin_import
import|import
name|android
operator|.
name|view
operator|.
name|ContextMenu
operator|.
name|ContextMenuInfo
import|;
end_import
begin_import
import|import
name|android
operator|.
name|view
operator|.
name|KeyCharacterMap
import|;
end_import
begin_import
import|import
name|android
operator|.
name|view
operator|.
name|KeyEvent
import|;
end_import
begin_import
import|import
name|android
operator|.
name|view
operator|.
name|Menu
import|;
end_import
begin_import
import|import
name|android
operator|.
name|view
operator|.
name|MenuItem
import|;
end_import
begin_import
import|import
name|android
operator|.
name|view
operator|.
name|View
import|;
end_import
begin_import
import|import
name|android
operator|.
name|view
operator|.
name|ViewGroup
import|;
end_import
begin_import
import|import
name|android
operator|.
name|view
operator|.
name|WindowManager
import|;
end_import
begin_import
import|import
name|android
operator|.
name|view
operator|.
name|inputmethod
operator|.
name|InputMethodManager
import|;
end_import
begin_class
DECL|class|QtActivityDelegate
specifier|public
class|class
name|QtActivityDelegate
block|{
DECL|field|m_activity
specifier|private
name|Activity
name|m_activity
init|=
literal|null
decl_stmt|;
DECL|field|m_super_dispatchKeyEvent
specifier|private
name|Method
name|m_super_dispatchKeyEvent
init|=
literal|null
decl_stmt|;
DECL|field|m_super_onRestoreInstanceState
specifier|private
name|Method
name|m_super_onRestoreInstanceState
init|=
literal|null
decl_stmt|;
DECL|field|m_super_onRetainNonConfigurationInstance
specifier|private
name|Method
name|m_super_onRetainNonConfigurationInstance
init|=
literal|null
decl_stmt|;
DECL|field|m_super_onSaveInstanceState
specifier|private
name|Method
name|m_super_onSaveInstanceState
init|=
literal|null
decl_stmt|;
DECL|field|m_super_onKeyDown
specifier|private
name|Method
name|m_super_onKeyDown
init|=
literal|null
decl_stmt|;
DECL|field|m_super_onKeyUp
specifier|private
name|Method
name|m_super_onKeyUp
init|=
literal|null
decl_stmt|;
DECL|field|m_super_onConfigurationChanged
specifier|private
name|Method
name|m_super_onConfigurationChanged
init|=
literal|null
decl_stmt|;
DECL|field|NATIVE_LIBRARIES_KEY
specifier|private
specifier|static
specifier|final
name|String
name|NATIVE_LIBRARIES_KEY
init|=
literal|"native.libraries"
decl_stmt|;
DECL|field|BUNDLED_LIBRARIES_KEY
specifier|private
specifier|static
specifier|final
name|String
name|BUNDLED_LIBRARIES_KEY
init|=
literal|"bundled.libraries"
decl_stmt|;
DECL|field|MAIN_LIBRARY_KEY
specifier|private
specifier|static
specifier|final
name|String
name|MAIN_LIBRARY_KEY
init|=
literal|"main.library"
decl_stmt|;
DECL|field|ENVIRONMENT_VARIABLES_KEY
specifier|private
specifier|static
specifier|final
name|String
name|ENVIRONMENT_VARIABLES_KEY
init|=
literal|"environment.variables"
decl_stmt|;
DECL|field|APPLICATION_PARAMETERS_KEY
specifier|private
specifier|static
specifier|final
name|String
name|APPLICATION_PARAMETERS_KEY
init|=
literal|"application.parameters"
decl_stmt|;
DECL|field|STATIC_INIT_CLASSES_KEY
specifier|private
specifier|static
specifier|final
name|String
name|STATIC_INIT_CLASSES_KEY
init|=
literal|"static.init.classes"
decl_stmt|;
DECL|field|NECESSITAS_API_LEVEL_KEY
specifier|private
specifier|static
specifier|final
name|String
name|NECESSITAS_API_LEVEL_KEY
init|=
literal|"necessitas.api.level"
decl_stmt|;
DECL|field|m_environmentVariables
specifier|private
specifier|static
name|String
name|m_environmentVariables
init|=
literal|null
decl_stmt|;
DECL|field|m_applicationParameters
specifier|private
specifier|static
name|String
name|m_applicationParameters
init|=
literal|null
decl_stmt|;
DECL|field|m_currentOrientation
specifier|private
name|int
name|m_currentOrientation
init|=
name|Configuration
operator|.
name|ORIENTATION_UNDEFINED
decl_stmt|;
DECL|field|m_mainLib
specifier|private
name|String
name|m_mainLib
decl_stmt|;
DECL|field|m_metaState
specifier|private
name|long
name|m_metaState
decl_stmt|;
DECL|field|m_lastChar
specifier|private
name|int
name|m_lastChar
init|=
literal|0
decl_stmt|;
DECL|field|m_fullScreen
specifier|private
name|boolean
name|m_fullScreen
init|=
literal|false
decl_stmt|;
DECL|field|m_started
specifier|private
name|boolean
name|m_started
init|=
literal|false
decl_stmt|;
DECL|field|m_surface
specifier|private
name|QtSurface
name|m_surface
init|=
literal|null
decl_stmt|;
DECL|field|m_layout
specifier|private
name|QtLayout
name|m_layout
init|=
literal|null
decl_stmt|;
DECL|field|m_editText
specifier|private
name|QtEditText
name|m_editText
init|=
literal|null
decl_stmt|;
DECL|field|m_imm
specifier|private
name|InputMethodManager
name|m_imm
init|=
literal|null
decl_stmt|;
DECL|field|m_quitApp
specifier|private
name|boolean
name|m_quitApp
init|=
literal|true
decl_stmt|;
DECL|field|m_debuggerProcess
specifier|private
name|Process
name|m_debuggerProcess
init|=
literal|null
decl_stmt|;
comment|// debugger process
DECL|field|m_keyboardIsVisible
specifier|public
name|boolean
name|m_keyboardIsVisible
init|=
literal|false
decl_stmt|;
DECL|field|m_keyboardIsHiding
specifier|public
name|boolean
name|m_keyboardIsHiding
init|=
literal|false
decl_stmt|;
DECL|method|getQtLayout
specifier|public
name|QtLayout
name|getQtLayout
parameter_list|()
block|{
return|return
name|m_layout
return|;
block|}
DECL|method|getQtSurface
specifier|public
name|QtSurface
name|getQtSurface
parameter_list|()
block|{
return|return
name|m_surface
return|;
block|}
DECL|method|redrawWindow
specifier|public
name|void
name|redrawWindow
parameter_list|(
name|int
name|left
parameter_list|,
name|int
name|top
parameter_list|,
name|int
name|right
parameter_list|,
name|int
name|bottom
parameter_list|)
block|{
name|m_surface
operator|.
name|drawBitmap
argument_list|(
operator|new
name|Rect
argument_list|(
name|left
argument_list|,
name|top
argument_list|,
name|right
argument_list|,
name|bottom
argument_list|)
argument_list|)
expr_stmt|;
block|}
DECL|method|setFullScreen
specifier|public
name|void
name|setFullScreen
parameter_list|(
name|boolean
name|enterFullScreen
parameter_list|)
block|{
if|if
condition|(
name|m_fullScreen
operator|==
name|enterFullScreen
condition|)
return|return;
if|if
condition|(
name|m_fullScreen
operator|=
name|enterFullScreen
condition|)
block|{
name|m_activity
operator|.
name|getWindow
argument_list|()
operator|.
name|addFlags
argument_list|(
name|WindowManager
operator|.
name|LayoutParams
operator|.
name|FLAG_FULLSCREEN
argument_list|)
expr_stmt|;
name|m_activity
operator|.
name|getWindow
argument_list|()
operator|.
name|clearFlags
argument_list|(
name|WindowManager
operator|.
name|LayoutParams
operator|.
name|FLAG_FORCE_NOT_FULLSCREEN
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|m_activity
operator|.
name|getWindow
argument_list|()
operator|.
name|addFlags
argument_list|(
name|WindowManager
operator|.
name|LayoutParams
operator|.
name|FLAG_FORCE_NOT_FULLSCREEN
argument_list|)
expr_stmt|;
name|m_activity
operator|.
name|getWindow
argument_list|()
operator|.
name|clearFlags
argument_list|(
name|WindowManager
operator|.
name|LayoutParams
operator|.
name|FLAG_FULLSCREEN
argument_list|)
expr_stmt|;
block|}
block|}
comment|// case status
DECL|field|ImhNoAutoUppercase
specifier|private
specifier|final
name|int
name|ImhNoAutoUppercase
init|=
literal|0x2
decl_stmt|;
DECL|field|ImhPreferUppercase
specifier|private
specifier|final
name|int
name|ImhPreferUppercase
init|=
literal|0x8
decl_stmt|;
annotation|@
name|SuppressWarnings
argument_list|(
literal|"unused"
argument_list|)
DECL|field|ImhPreferLowercase
specifier|private
specifier|final
name|int
name|ImhPreferLowercase
init|=
literal|0x10
decl_stmt|;
DECL|field|ImhUppercaseOnly
specifier|private
specifier|final
name|int
name|ImhUppercaseOnly
init|=
literal|0x40000
decl_stmt|;
DECL|field|ImhLowercaseOnly
specifier|private
specifier|final
name|int
name|ImhLowercaseOnly
init|=
literal|0x80000
decl_stmt|;
comment|// options
DECL|field|ImhNoPredictiveText
specifier|private
specifier|final
name|int
name|ImhNoPredictiveText
init|=
literal|0x20
decl_stmt|;
comment|// layout
DECL|field|ImhHiddenText
specifier|private
specifier|final
name|int
name|ImhHiddenText
init|=
literal|0x1
decl_stmt|;
DECL|field|ImhPreferNumbers
specifier|private
specifier|final
name|int
name|ImhPreferNumbers
init|=
literal|0x4
decl_stmt|;
DECL|field|ImhMultiLine
specifier|private
specifier|final
name|int
name|ImhMultiLine
init|=
literal|0x400
decl_stmt|;
DECL|field|ImhDigitsOnly
specifier|private
specifier|final
name|int
name|ImhDigitsOnly
init|=
literal|0x10000
decl_stmt|;
DECL|field|ImhFormattedNumbersOnly
specifier|private
specifier|final
name|int
name|ImhFormattedNumbersOnly
init|=
literal|0x20000
decl_stmt|;
DECL|field|ImhDialableCharactersOnly
specifier|private
specifier|final
name|int
name|ImhDialableCharactersOnly
init|=
literal|0x100000
decl_stmt|;
DECL|field|ImhEmailCharactersOnly
specifier|private
specifier|final
name|int
name|ImhEmailCharactersOnly
init|=
literal|0x200000
decl_stmt|;
DECL|field|ImhUrlCharactersOnly
specifier|private
specifier|final
name|int
name|ImhUrlCharactersOnly
init|=
literal|0x400000
decl_stmt|;
DECL|method|resetSoftwareKeyboard
specifier|public
name|void
name|resetSoftwareKeyboard
parameter_list|()
block|{
if|if
condition|(
name|m_imm
operator|==
literal|null
condition|)
return|return;
name|m_editText
operator|.
name|postDelayed
argument_list|(
operator|new
name|Runnable
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|run
parameter_list|()
block|{
name|m_imm
operator|.
name|restartInput
argument_list|(
name|m_editText
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|,
literal|5
argument_list|)
expr_stmt|;
block|}
DECL|method|showSoftwareKeyboard
specifier|public
name|void
name|showSoftwareKeyboard
parameter_list|(
name|int
name|x
parameter_list|,
name|int
name|y
parameter_list|,
name|int
name|width
parameter_list|,
name|int
name|height
parameter_list|,
name|int
name|inputHints
parameter_list|)
block|{
if|if
condition|(
name|m_imm
operator|==
literal|null
condition|)
return|return;
if|if
condition|(
name|height
operator|>
name|m_surface
operator|.
name|getHeight
argument_list|()
operator|*
literal|2
operator|/
literal|3
condition|)
name|m_activity
operator|.
name|getWindow
argument_list|()
operator|.
name|setSoftInputMode
argument_list|(
name|WindowManager
operator|.
name|LayoutParams
operator|.
name|SOFT_INPUT_STATE_UNCHANGED
operator||
name|WindowManager
operator|.
name|LayoutParams
operator|.
name|SOFT_INPUT_ADJUST_RESIZE
argument_list|)
expr_stmt|;
else|else
name|m_activity
operator|.
name|getWindow
argument_list|()
operator|.
name|setSoftInputMode
argument_list|(
name|WindowManager
operator|.
name|LayoutParams
operator|.
name|SOFT_INPUT_STATE_UNCHANGED
operator||
name|WindowManager
operator|.
name|LayoutParams
operator|.
name|SOFT_INPUT_ADJUST_PAN
argument_list|)
expr_stmt|;
name|int
name|initialCapsMode
init|=
literal|0
decl_stmt|;
name|int
name|imeOptions
init|=
name|android
operator|.
name|view
operator|.
name|inputmethod
operator|.
name|EditorInfo
operator|.
name|IME_ACTION_DONE
decl_stmt|;
name|int
name|inputType
init|=
name|android
operator|.
name|text
operator|.
name|InputType
operator|.
name|TYPE_CLASS_TEXT
decl_stmt|;
if|if
condition|(
operator|(
name|inputHints
operator|&
name|ImhMultiLine
operator|)
operator|!=
literal|0
condition|)
block|{
name|inputType
operator|=
name|android
operator|.
name|text
operator|.
name|InputType
operator|.
name|TYPE_CLASS_TEXT
operator||
name|android
operator|.
name|text
operator|.
name|InputType
operator|.
name|TYPE_TEXT_FLAG_MULTI_LINE
expr_stmt|;
name|imeOptions
operator|=
name|android
operator|.
name|view
operator|.
name|inputmethod
operator|.
name|EditorInfo
operator|.
name|IME_FLAG_NO_ENTER_ACTION
expr_stmt|;
block|}
if|if
condition|(
operator|(
operator|(
name|inputHints
operator|&
name|ImhNoAutoUppercase
operator|)
operator|!=
literal|0
operator|||
operator|(
name|inputHints
operator|&
name|ImhPreferUppercase
operator|)
operator|!=
literal|0
operator|)
operator|&&
operator|(
name|inputHints
operator|&
name|ImhLowercaseOnly
operator|)
operator|==
literal|0
condition|)
block|{
name|initialCapsMode
operator|=
name|android
operator|.
name|text
operator|.
name|TextUtils
operator|.
name|CAP_MODE_SENTENCES
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|inputHints
operator|&
name|ImhUppercaseOnly
operator|)
operator|!=
literal|0
condition|)
name|initialCapsMode
operator|=
name|android
operator|.
name|text
operator|.
name|TextUtils
operator|.
name|CAP_MODE_CHARACTERS
expr_stmt|;
if|if
condition|(
operator|(
name|inputHints
operator|&
name|ImhHiddenText
operator|)
operator|!=
literal|0
condition|)
name|inputType
operator|=
name|android
operator|.
name|text
operator|.
name|InputType
operator|.
name|TYPE_TEXT_VARIATION_PASSWORD
expr_stmt|;
if|if
condition|(
operator|(
name|inputHints
operator|&
name|ImhPreferNumbers
operator|)
operator|!=
literal|0
condition|)
name|inputType
operator|=
name|android
operator|.
name|text
operator|.
name|InputType
operator|.
name|TYPE_CLASS_NUMBER
expr_stmt|;
if|if
condition|(
operator|(
name|inputHints
operator|&
name|ImhDigitsOnly
operator|)
operator|!=
literal|0
condition|)
name|inputType
operator|=
name|android
operator|.
name|text
operator|.
name|InputType
operator|.
name|TYPE_CLASS_NUMBER
expr_stmt|;
if|if
condition|(
operator|(
name|inputHints
operator|&
name|ImhFormattedNumbersOnly
operator|)
operator|!=
literal|0
condition|)
block|{
name|inputType
operator|=
name|android
operator|.
name|text
operator|.
name|InputType
operator|.
name|TYPE_CLASS_NUMBER
operator||
name|android
operator|.
name|text
operator|.
name|InputType
operator|.
name|TYPE_NUMBER_FLAG_DECIMAL
operator||
name|android
operator|.
name|text
operator|.
name|InputType
operator|.
name|TYPE_NUMBER_FLAG_SIGNED
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|inputHints
operator|&
name|ImhDialableCharactersOnly
operator|)
operator|!=
literal|0
condition|)
name|inputType
operator|=
name|android
operator|.
name|text
operator|.
name|InputType
operator|.
name|TYPE_CLASS_PHONE
expr_stmt|;
if|if
condition|(
operator|(
name|inputHints
operator|&
name|ImhEmailCharactersOnly
operator|)
operator|!=
literal|0
condition|)
name|inputType
operator|=
name|android
operator|.
name|text
operator|.
name|InputType
operator|.
name|TYPE_TEXT_VARIATION_EMAIL_ADDRESS
expr_stmt|;
if|if
condition|(
operator|(
name|inputHints
operator|&
name|ImhUrlCharactersOnly
operator|)
operator|!=
literal|0
condition|)
block|{
name|inputType
operator|=
name|android
operator|.
name|text
operator|.
name|InputType
operator|.
name|TYPE_TEXT_VARIATION_URI
expr_stmt|;
name|imeOptions
operator|=
name|android
operator|.
name|view
operator|.
name|inputmethod
operator|.
name|EditorInfo
operator|.
name|IME_ACTION_GO
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|inputHints
operator|&
name|ImhNoPredictiveText
operator|)
operator|!=
literal|0
condition|)
block|{
comment|//android.text.InputType.TYPE_TEXT_FLAG_NO_SUGGESTIONS | android.text.InputType.TYPE_CLASS_TEXT;
name|inputType
operator|=
name|android
operator|.
name|text
operator|.
name|InputType
operator|.
name|TYPE_CLASS_TEXT
operator||
name|android
operator|.
name|text
operator|.
name|InputType
operator|.
name|TYPE_TEXT_VARIATION_VISIBLE_PASSWORD
expr_stmt|;
block|}
name|m_editText
operator|.
name|setInitialCapsMode
argument_list|(
name|initialCapsMode
argument_list|)
expr_stmt|;
name|m_editText
operator|.
name|setImeOptions
argument_list|(
name|imeOptions
argument_list|)
expr_stmt|;
name|m_editText
operator|.
name|setInputType
argument_list|(
name|inputType
argument_list|)
expr_stmt|;
name|m_layout
operator|.
name|removeView
argument_list|(
name|m_editText
argument_list|)
expr_stmt|;
name|m_layout
operator|.
name|addView
argument_list|(
name|m_editText
argument_list|,
operator|new
name|QtLayout
operator|.
name|LayoutParams
argument_list|(
name|width
argument_list|,
name|height
argument_list|,
name|x
argument_list|,
name|y
argument_list|)
argument_list|)
expr_stmt|;
name|m_editText
operator|.
name|bringToFront
argument_list|()
expr_stmt|;
name|m_editText
operator|.
name|requestFocus
argument_list|()
expr_stmt|;
name|m_editText
operator|.
name|postDelayed
argument_list|(
operator|new
name|Runnable
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|run
parameter_list|()
block|{
name|m_imm
operator|.
name|showSoftInput
argument_list|(
name|m_editText
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|m_keyboardIsVisible
operator|=
literal|true
expr_stmt|;
name|m_keyboardIsHiding
operator|=
literal|false
expr_stmt|;
name|m_editText
operator|.
name|postDelayed
argument_list|(
operator|new
name|Runnable
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|run
parameter_list|()
block|{
name|m_imm
operator|.
name|restartInput
argument_list|(
name|m_editText
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|,
literal|25
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|,
literal|15
argument_list|)
expr_stmt|;
block|}
DECL|method|hideSoftwareKeyboard
specifier|public
name|void
name|hideSoftwareKeyboard
parameter_list|()
block|{
if|if
condition|(
name|m_imm
operator|==
literal|null
condition|)
return|return;
name|m_imm
operator|.
name|hideSoftInputFromWindow
argument_list|(
name|m_editText
operator|.
name|getWindowToken
argument_list|()
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|m_keyboardIsVisible
operator|=
literal|false
expr_stmt|;
name|m_keyboardIsHiding
operator|=
literal|false
expr_stmt|;
block|}
DECL|method|isSoftwareKeyboardVisible
specifier|public
name|boolean
name|isSoftwareKeyboardVisible
parameter_list|()
block|{
return|return
name|m_keyboardIsVisible
return|;
block|}
DECL|method|getAppIconSize
name|String
name|getAppIconSize
parameter_list|(
name|Activity
name|a
parameter_list|)
block|{
name|int
name|size
init|=
name|a
operator|.
name|getResources
argument_list|()
operator|.
name|getDimensionPixelSize
argument_list|(
name|android
operator|.
name|R
operator|.
name|dimen
operator|.
name|app_icon_size
argument_list|)
decl_stmt|;
if|if
condition|(
name|size
argument_list|<
literal|36
operator|||
name|size
argument_list|>
literal|512
condition|)
block|{
comment|// check size sanity
name|DisplayMetrics
name|metrics
init|=
operator|new
name|DisplayMetrics
argument_list|()
decl_stmt|;
name|a
operator|.
name|getWindowManager
argument_list|()
operator|.
name|getDefaultDisplay
argument_list|()
operator|.
name|getMetrics
argument_list|(
name|metrics
argument_list|)
expr_stmt|;
name|size
operator|=
name|metrics
operator|.
name|densityDpi
operator|/
literal|10
operator|*
literal|3
expr_stmt|;
if|if
condition|(
name|size
operator|<
literal|36
condition|)
name|size
operator|=
literal|36
expr_stmt|;
if|if
condition|(
name|size
operator|>
literal|512
condition|)
name|size
operator|=
literal|512
expr_stmt|;
block|}
return|return
literal|"\tQT_ANDROID_APP_ICON_SIZE="
operator|+
name|size
return|;
block|}
DECL|method|updateSelection
specifier|public
name|void
name|updateSelection
parameter_list|(
name|int
name|selStart
parameter_list|,
name|int
name|selEnd
parameter_list|,
name|int
name|candidatesStart
parameter_list|,
name|int
name|candidatesEnd
parameter_list|)
block|{
if|if
condition|(
name|m_imm
operator|==
literal|null
condition|)
return|return;
name|m_imm
operator|.
name|updateSelection
argument_list|(
name|m_editText
argument_list|,
name|selStart
argument_list|,
name|selEnd
argument_list|,
name|candidatesStart
argument_list|,
name|candidatesEnd
argument_list|)
expr_stmt|;
block|}
DECL|method|loadApplication
specifier|public
name|boolean
name|loadApplication
parameter_list|(
name|Activity
name|activity
parameter_list|,
name|ClassLoader
name|classLoader
parameter_list|,
name|Bundle
name|loaderParams
parameter_list|)
block|{
comment|/// check parameters integrity
if|if
condition|(
operator|!
name|loaderParams
operator|.
name|containsKey
argument_list|(
name|NATIVE_LIBRARIES_KEY
argument_list|)
operator|||
operator|!
name|loaderParams
operator|.
name|containsKey
argument_list|(
name|BUNDLED_LIBRARIES_KEY
argument_list|)
operator|||
operator|!
name|loaderParams
operator|.
name|containsKey
argument_list|(
name|ENVIRONMENT_VARIABLES_KEY
argument_list|)
condition|)
block|{
return|return
literal|false
return|;
block|}
name|m_activity
operator|=
name|activity
expr_stmt|;
name|QtNative
operator|.
name|setActivity
argument_list|(
name|m_activity
argument_list|,
name|this
argument_list|)
expr_stmt|;
name|QtNative
operator|.
name|setClassLoader
argument_list|(
name|classLoader
argument_list|)
expr_stmt|;
if|if
condition|(
name|loaderParams
operator|.
name|containsKey
argument_list|(
name|STATIC_INIT_CLASSES_KEY
argument_list|)
condition|)
block|{
for|for
control|(
name|String
name|className
range|:
name|loaderParams
operator|.
name|getStringArray
argument_list|(
name|STATIC_INIT_CLASSES_KEY
argument_list|)
control|)
block|{
if|if
condition|(
name|className
operator|.
name|length
argument_list|()
operator|==
literal|0
condition|)
continue|continue;
try|try
block|{
annotation|@
name|SuppressWarnings
argument_list|(
literal|"rawtypes"
argument_list|)
name|Class
name|initClass
init|=
name|classLoader
operator|.
name|loadClass
argument_list|(
name|className
argument_list|)
decl_stmt|;
name|Object
name|staticInitDataObject
init|=
name|initClass
operator|.
name|newInstance
argument_list|()
decl_stmt|;
comment|// create an instance
name|Method
name|m
init|=
name|initClass
operator|.
name|getMethod
argument_list|(
literal|"setActivity"
argument_list|,
name|Activity
operator|.
name|class
argument_list|,
name|Object
operator|.
name|class
argument_list|)
decl_stmt|;
name|m
operator|.
name|invoke
argument_list|(
name|staticInitDataObject
argument_list|,
name|m_activity
argument_list|,
name|this
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
block|}
block|}
block|}
name|QtNative
operator|.
name|loadQtLibraries
argument_list|(
name|loaderParams
operator|.
name|getStringArrayList
argument_list|(
name|NATIVE_LIBRARIES_KEY
argument_list|)
argument_list|)
expr_stmt|;
name|ArrayList
argument_list|<
name|String
argument_list|>
name|libraries
init|=
name|loaderParams
operator|.
name|getStringArrayList
argument_list|(
name|BUNDLED_LIBRARIES_KEY
argument_list|)
decl_stmt|;
name|QtNative
operator|.
name|loadBundledLibraries
argument_list|(
name|libraries
argument_list|,
name|QtNativeLibrariesDir
operator|.
name|nativeLibrariesDir
argument_list|(
name|m_activity
argument_list|)
argument_list|)
expr_stmt|;
name|m_mainLib
operator|=
name|loaderParams
operator|.
name|getString
argument_list|(
name|MAIN_LIBRARY_KEY
argument_list|)
expr_stmt|;
comment|// older apps provide the main library as the last bundled library; look for this if the main library isn't provided
if|if
condition|(
literal|null
operator|==
name|m_mainLib
operator|&&
name|libraries
operator|.
name|size
argument_list|()
operator|>
literal|0
condition|)
name|m_mainLib
operator|=
name|libraries
operator|.
name|get
argument_list|(
name|libraries
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
expr_stmt|;
try|try
block|{
name|m_super_dispatchKeyEvent
operator|=
name|m_activity
operator|.
name|getClass
argument_list|()
operator|.
name|getMethod
argument_list|(
literal|"super_dispatchKeyEvent"
argument_list|,
name|KeyEvent
operator|.
name|class
argument_list|)
expr_stmt|;
name|m_super_onRestoreInstanceState
operator|=
name|m_activity
operator|.
name|getClass
argument_list|()
operator|.
name|getMethod
argument_list|(
literal|"super_onRestoreInstanceState"
argument_list|,
name|Bundle
operator|.
name|class
argument_list|)
expr_stmt|;
name|m_super_onRetainNonConfigurationInstance
operator|=
name|m_activity
operator|.
name|getClass
argument_list|()
operator|.
name|getMethod
argument_list|(
literal|"super_onRetainNonConfigurationInstance"
argument_list|)
expr_stmt|;
name|m_super_onSaveInstanceState
operator|=
name|m_activity
operator|.
name|getClass
argument_list|()
operator|.
name|getMethod
argument_list|(
literal|"super_onSaveInstanceState"
argument_list|,
name|Bundle
operator|.
name|class
argument_list|)
expr_stmt|;
name|m_super_onKeyDown
operator|=
name|m_activity
operator|.
name|getClass
argument_list|()
operator|.
name|getMethod
argument_list|(
literal|"super_onKeyDown"
argument_list|,
name|Integer
operator|.
name|TYPE
argument_list|,
name|KeyEvent
operator|.
name|class
argument_list|)
expr_stmt|;
name|m_super_onKeyUp
operator|=
name|m_activity
operator|.
name|getClass
argument_list|()
operator|.
name|getMethod
argument_list|(
literal|"super_onKeyUp"
argument_list|,
name|Integer
operator|.
name|TYPE
argument_list|,
name|KeyEvent
operator|.
name|class
argument_list|)
expr_stmt|;
name|m_super_onConfigurationChanged
operator|=
name|m_activity
operator|.
name|getClass
argument_list|()
operator|.
name|getMethod
argument_list|(
literal|"super_onConfigurationChanged"
argument_list|,
name|Configuration
operator|.
name|class
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
return|return
literal|false
return|;
block|}
name|int
name|necessitasApiLevel
init|=
literal|1
decl_stmt|;
if|if
condition|(
name|loaderParams
operator|.
name|containsKey
argument_list|(
name|NECESSITAS_API_LEVEL_KEY
argument_list|)
condition|)
name|necessitasApiLevel
operator|=
name|loaderParams
operator|.
name|getInt
argument_list|(
name|NECESSITAS_API_LEVEL_KEY
argument_list|)
expr_stmt|;
name|m_environmentVariables
operator|=
name|loaderParams
operator|.
name|getString
argument_list|(
name|ENVIRONMENT_VARIABLES_KEY
argument_list|)
expr_stmt|;
name|String
name|additionalEnvironmentVariables
init|=
literal|"QT_ANDROID_FONTS_MONOSPACE=Droid Sans Mono;Droid Sans;Droid Sans Fallback"
operator|+
literal|"\tNECESSITAS_API_LEVEL="
operator|+
name|necessitasApiLevel
operator|+
literal|"\tHOME="
operator|+
name|m_activity
operator|.
name|getFilesDir
argument_list|()
operator|.
name|getAbsolutePath
argument_list|()
operator|+
literal|"\tTMPDIR="
operator|+
name|m_activity
operator|.
name|getFilesDir
argument_list|()
operator|.
name|getAbsolutePath
argument_list|()
decl_stmt|;
if|if
condition|(
name|android
operator|.
name|os
operator|.
name|Build
operator|.
name|VERSION
operator|.
name|SDK_INT
operator|<
literal|14
condition|)
name|additionalEnvironmentVariables
operator|+=
literal|"\tQT_ANDROID_FONTS=Droid Sans;Droid Sans Fallback"
expr_stmt|;
else|else
name|additionalEnvironmentVariables
operator|+=
literal|"\tQT_ANDROID_FONTS=Roboto;Droid Sans;Droid Sans Fallback"
expr_stmt|;
name|additionalEnvironmentVariables
operator|+=
name|getAppIconSize
argument_list|(
name|activity
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_environmentVariables
operator|!=
literal|null
operator|&&
name|m_environmentVariables
operator|.
name|length
argument_list|()
operator|>
literal|0
condition|)
name|m_environmentVariables
operator|=
name|additionalEnvironmentVariables
operator|+
literal|"\t"
operator|+
name|m_environmentVariables
expr_stmt|;
else|else
name|m_environmentVariables
operator|=
name|additionalEnvironmentVariables
expr_stmt|;
if|if
condition|(
name|loaderParams
operator|.
name|containsKey
argument_list|(
name|APPLICATION_PARAMETERS_KEY
argument_list|)
condition|)
name|m_applicationParameters
operator|=
name|loaderParams
operator|.
name|getString
argument_list|(
name|APPLICATION_PARAMETERS_KEY
argument_list|)
expr_stmt|;
else|else
name|m_applicationParameters
operator|=
literal|""
expr_stmt|;
return|return
literal|true
return|;
block|}
DECL|method|debugLog
specifier|public
name|void
name|debugLog
parameter_list|(
name|String
name|msg
parameter_list|)
block|{
name|Log
operator|.
name|i
argument_list|(
name|QtNative
operator|.
name|QtTAG
argument_list|,
literal|"DEBUGGER: "
operator|+
name|msg
argument_list|)
expr_stmt|;
block|}
DECL|method|startApplication
specifier|public
name|boolean
name|startApplication
parameter_list|()
block|{
comment|// start application
try|try
block|{
comment|// FIXME turn on debuggable check
comment|// if the applications is debuggable and it has a native debug request
name|Bundle
name|extras
init|=
name|m_activity
operator|.
name|getIntent
argument_list|()
operator|.
name|getExtras
argument_list|()
decl_stmt|;
if|if
condition|(
comment|/*(ai.flags&ApplicationInfo.FLAG_DEBUGGABLE) != 0&&*/
name|extras
operator|!=
literal|null
operator|&&
name|extras
operator|.
name|containsKey
argument_list|(
literal|"native_debug"
argument_list|)
operator|&&
name|extras
operator|.
name|getString
argument_list|(
literal|"native_debug"
argument_list|)
operator|.
name|equals
argument_list|(
literal|"true"
argument_list|)
condition|)
block|{
try|try
block|{
name|String
name|packagePath
init|=
name|m_activity
operator|.
name|getPackageManager
argument_list|()
operator|.
name|getApplicationInfo
argument_list|(
name|m_activity
operator|.
name|getPackageName
argument_list|()
argument_list|,
name|PackageManager
operator|.
name|GET_CONFIGURATIONS
argument_list|)
operator|.
name|dataDir
operator|+
literal|"/"
decl_stmt|;
name|String
name|gdbserverPath
init|=
name|extras
operator|.
name|containsKey
argument_list|(
literal|"gdbserver_path"
argument_list|)
condition|?
name|extras
operator|.
name|getString
argument_list|(
literal|"gdbserver_path"
argument_list|)
else|:
name|packagePath
operator|+
literal|"lib/gdbserver "
decl_stmt|;
name|String
name|socket
init|=
name|extras
operator|.
name|containsKey
argument_list|(
literal|"gdbserver_socket"
argument_list|)
condition|?
name|extras
operator|.
name|getString
argument_list|(
literal|"gdbserver_socket"
argument_list|)
else|:
literal|"+debug-socket"
decl_stmt|;
comment|// start debugger
name|m_debuggerProcess
operator|=
name|Runtime
operator|.
name|getRuntime
argument_list|()
operator|.
name|exec
argument_list|(
name|gdbserverPath
operator|+
name|socket
operator|+
literal|" --attach "
operator|+
name|android
operator|.
name|os
operator|.
name|Process
operator|.
name|myPid
argument_list|()
argument_list|,
literal|null
argument_list|,
operator|new
name|File
argument_list|(
name|packagePath
argument_list|)
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
name|Log
operator|.
name|e
argument_list|(
name|QtNative
operator|.
name|QtTAG
argument_list|,
literal|"Can't start debugger"
operator|+
name|ioe
operator|.
name|getMessage
argument_list|()
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SecurityException
name|se
parameter_list|)
block|{
name|Log
operator|.
name|e
argument_list|(
name|QtNative
operator|.
name|QtTAG
argument_list|,
literal|"Can't start debugger"
operator|+
name|se
operator|.
name|getMessage
argument_list|()
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|NameNotFoundException
name|e
parameter_list|)
block|{
name|Log
operator|.
name|e
argument_list|(
name|QtNative
operator|.
name|QtTAG
argument_list|,
literal|"Can't start debugger"
operator|+
name|e
operator|.
name|getMessage
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
comment|/*(ai.flags&ApplicationInfo.FLAG_DEBUGGABLE) != 0&&*/
name|extras
operator|!=
literal|null
operator|&&
name|extras
operator|.
name|containsKey
argument_list|(
literal|"debug_ping"
argument_list|)
operator|&&
name|extras
operator|.
name|getString
argument_list|(
literal|"debug_ping"
argument_list|)
operator|.
name|equals
argument_list|(
literal|"true"
argument_list|)
condition|)
block|{
try|try
block|{
name|debugLog
argument_list|(
literal|"extra parameters: "
operator|+
name|extras
argument_list|)
expr_stmt|;
name|String
name|packageName
init|=
name|m_activity
operator|.
name|getPackageName
argument_list|()
decl_stmt|;
name|String
name|pingFile
init|=
name|extras
operator|.
name|getString
argument_list|(
literal|"ping_file"
argument_list|)
decl_stmt|;
name|String
name|pongFile
init|=
name|extras
operator|.
name|getString
argument_list|(
literal|"pong_file"
argument_list|)
decl_stmt|;
name|String
name|gdbserverSocket
init|=
name|extras
operator|.
name|getString
argument_list|(
literal|"gdbserver_socket"
argument_list|)
decl_stmt|;
name|String
name|gdbserverCommand
init|=
name|extras
operator|.
name|getString
argument_list|(
literal|"gdbserver_command"
argument_list|)
decl_stmt|;
name|boolean
name|usePing
init|=
name|pingFile
operator|!=
literal|null
decl_stmt|;
name|boolean
name|usePong
init|=
name|pongFile
operator|!=
literal|null
decl_stmt|;
name|boolean
name|useSocket
init|=
name|gdbserverSocket
operator|!=
literal|null
decl_stmt|;
name|int
name|napTime
init|=
literal|200
decl_stmt|;
comment|// milliseconds between file accesses
name|int
name|timeOut
init|=
literal|30000
decl_stmt|;
comment|// ms until we give up on ping and pong
name|int
name|maxAttempts
init|=
name|timeOut
operator|/
name|napTime
decl_stmt|;
if|if
condition|(
name|usePing
condition|)
block|{
name|debugLog
argument_list|(
literal|"removing ping file "
operator|+
name|pingFile
argument_list|)
expr_stmt|;
name|File
name|ping
init|=
operator|new
name|File
argument_list|(
name|pingFile
argument_list|)
decl_stmt|;
if|if
condition|(
name|ping
operator|.
name|exists
argument_list|()
condition|)
block|{
if|if
condition|(
operator|!
name|ping
operator|.
name|delete
argument_list|()
condition|)
name|debugLog
argument_list|(
literal|"ping file cannot be deleted"
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|usePong
condition|)
block|{
name|debugLog
argument_list|(
literal|"removing pong file "
operator|+
name|pongFile
argument_list|)
expr_stmt|;
name|File
name|pong
init|=
operator|new
name|File
argument_list|(
name|pongFile
argument_list|)
decl_stmt|;
if|if
condition|(
name|pong
operator|.
name|exists
argument_list|()
condition|)
block|{
if|if
condition|(
operator|!
name|pong
operator|.
name|delete
argument_list|()
condition|)
name|debugLog
argument_list|(
literal|"pong file cannot be deleted"
argument_list|)
expr_stmt|;
block|}
block|}
name|debugLog
argument_list|(
literal|"starting "
operator|+
name|gdbserverCommand
argument_list|)
expr_stmt|;
name|m_debuggerProcess
operator|=
name|Runtime
operator|.
name|getRuntime
argument_list|()
operator|.
name|exec
argument_list|(
name|gdbserverCommand
argument_list|)
expr_stmt|;
name|debugLog
argument_list|(
literal|"gdbserver started"
argument_list|)
expr_stmt|;
if|if
condition|(
name|useSocket
condition|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|maxAttempts
condition|;
operator|++
name|i
control|)
block|{
name|debugLog
argument_list|(
literal|"waiting for socket at "
operator|+
name|gdbserverSocket
operator|+
literal|", attempt "
operator|+
name|i
argument_list|)
expr_stmt|;
name|File
name|file
init|=
operator|new
name|File
argument_list|(
name|gdbserverSocket
argument_list|)
decl_stmt|;
if|if
condition|(
name|file
operator|.
name|exists
argument_list|()
condition|)
block|{
name|file
operator|.
name|setReadable
argument_list|(
literal|true
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|file
operator|.
name|setWritable
argument_list|(
literal|true
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|file
operator|.
name|setExecutable
argument_list|(
literal|true
argument_list|,
literal|false
argument_list|)
expr_stmt|;
break|break;
block|}
name|Thread
operator|.
name|sleep
argument_list|(
name|napTime
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|i
operator|==
name|maxAttempts
condition|)
block|{
name|debugLog
argument_list|(
literal|"time out when waiting for socket"
argument_list|)
expr_stmt|;
return|return
literal|false
return|;
block|}
name|debugLog
argument_list|(
literal|"socket ok"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|debugLog
argument_list|(
literal|"socket not used"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|usePing
condition|)
block|{
comment|// Tell we are ready.
name|debugLog
argument_list|(
literal|"writing ping at "
operator|+
name|pingFile
argument_list|)
expr_stmt|;
name|FileWriter
name|writer
init|=
operator|new
name|FileWriter
argument_list|(
name|pingFile
argument_list|)
decl_stmt|;
name|writer
operator|.
name|write
argument_list|(
literal|""
operator|+
name|android
operator|.
name|os
operator|.
name|Process
operator|.
name|myPid
argument_list|()
argument_list|)
expr_stmt|;
name|writer
operator|.
name|close
argument_list|()
expr_stmt|;
name|File
name|file
init|=
operator|new
name|File
argument_list|(
name|pingFile
argument_list|)
decl_stmt|;
name|file
operator|.
name|setReadable
argument_list|(
literal|true
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|file
operator|.
name|setWritable
argument_list|(
literal|true
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|file
operator|.
name|setExecutable
argument_list|(
literal|true
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|debugLog
argument_list|(
literal|"wrote ping"
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|debugLog
argument_list|(
literal|"ping not requested"
argument_list|)
expr_stmt|;
block|}
comment|// Wait until other side is ready.
if|if
condition|(
name|usePong
condition|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|maxAttempts
condition|;
operator|++
name|i
control|)
block|{
name|debugLog
argument_list|(
literal|"waiting for pong at "
operator|+
name|pongFile
operator|+
literal|", attempt "
operator|+
name|i
argument_list|)
expr_stmt|;
name|File
name|file
init|=
operator|new
name|File
argument_list|(
name|pongFile
argument_list|)
decl_stmt|;
if|if
condition|(
name|file
operator|.
name|exists
argument_list|()
condition|)
block|{
name|file
operator|.
name|delete
argument_list|()
expr_stmt|;
break|break;
block|}
name|debugLog
argument_list|(
literal|"go to sleep"
argument_list|)
expr_stmt|;
name|Thread
operator|.
name|sleep
argument_list|(
name|napTime
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|i
operator|==
name|maxAttempts
condition|)
block|{
name|debugLog
argument_list|(
literal|"time out when waiting for pong file"
argument_list|)
expr_stmt|;
return|return
literal|false
return|;
block|}
name|debugLog
argument_list|(
literal|"got pong "
operator|+
name|pongFile
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|debugLog
argument_list|(
literal|"pong not requested"
argument_list|)
expr_stmt|;
block|}
block|}
catch|catch
parameter_list|(
name|IOException
name|ioe
parameter_list|)
block|{
name|Log
operator|.
name|e
argument_list|(
name|QtNative
operator|.
name|QtTAG
argument_list|,
literal|"Can't start debugger"
operator|+
name|ioe
operator|.
name|getMessage
argument_list|()
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|SecurityException
name|se
parameter_list|)
block|{
name|Log
operator|.
name|e
argument_list|(
name|QtNative
operator|.
name|QtTAG
argument_list|,
literal|"Can't start debugger"
operator|+
name|se
operator|.
name|getMessage
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
comment|/*(ai.flags&ApplicationInfo.FLAG_DEBUGGABLE) != 0&&*/
name|extras
operator|!=
literal|null
operator|&&
name|extras
operator|.
name|containsKey
argument_list|(
literal|"qml_debug"
argument_list|)
operator|&&
name|extras
operator|.
name|getString
argument_list|(
literal|"qml_debug"
argument_list|)
operator|.
name|equals
argument_list|(
literal|"true"
argument_list|)
condition|)
block|{
name|String
name|qmljsdebugger
decl_stmt|;
if|if
condition|(
name|extras
operator|.
name|containsKey
argument_list|(
literal|"qmljsdebugger"
argument_list|)
condition|)
block|{
name|qmljsdebugger
operator|=
name|extras
operator|.
name|getString
argument_list|(
literal|"qmljsdebugger"
argument_list|)
expr_stmt|;
name|qmljsdebugger
operator|.
name|replaceAll
argument_list|(
literal|"\\s"
argument_list|,
literal|""
argument_list|)
expr_stmt|;
comment|// remove whitespace for security
block|}
else|else
block|{
name|qmljsdebugger
operator|=
literal|"port:3768"
expr_stmt|;
block|}
name|m_applicationParameters
operator|+=
literal|"\t-qmljsdebugger="
operator|+
name|qmljsdebugger
expr_stmt|;
block|}
if|if
condition|(
literal|null
operator|==
name|m_surface
condition|)
name|onCreate
argument_list|(
literal|null
argument_list|)
expr_stmt|;
name|String
name|nativeLibraryDir
init|=
name|QtNativeLibrariesDir
operator|.
name|nativeLibrariesDir
argument_list|(
name|m_activity
argument_list|)
decl_stmt|;
name|m_surface
operator|.
name|applicationStarted
argument_list|(
name|QtNative
operator|.
name|startApplication
argument_list|(
name|m_applicationParameters
argument_list|,
name|m_environmentVariables
argument_list|,
name|m_mainLib
argument_list|,
name|nativeLibraryDir
argument_list|)
argument_list|)
expr_stmt|;
name|m_started
operator|=
literal|true
expr_stmt|;
return|return
literal|true
return|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
return|return
literal|false
return|;
block|}
block|}
DECL|method|onTerminate
specifier|public
name|void
name|onTerminate
parameter_list|()
block|{
name|QtNative
operator|.
name|terminateQt
argument_list|()
expr_stmt|;
block|}
DECL|method|onCreate
specifier|public
name|void
name|onCreate
parameter_list|(
name|Bundle
name|savedInstanceState
parameter_list|)
block|{
name|m_quitApp
operator|=
literal|true
expr_stmt|;
if|if
condition|(
literal|null
operator|==
name|savedInstanceState
condition|)
block|{
name|DisplayMetrics
name|metrics
init|=
operator|new
name|DisplayMetrics
argument_list|()
decl_stmt|;
name|m_activity
operator|.
name|getWindowManager
argument_list|()
operator|.
name|getDefaultDisplay
argument_list|()
operator|.
name|getMetrics
argument_list|(
name|metrics
argument_list|)
expr_stmt|;
name|QtNative
operator|.
name|setApplicationDisplayMetrics
argument_list|(
name|metrics
operator|.
name|widthPixels
argument_list|,
name|metrics
operator|.
name|heightPixels
argument_list|,
name|metrics
operator|.
name|widthPixels
argument_list|,
name|metrics
operator|.
name|heightPixels
argument_list|,
name|metrics
operator|.
name|xdpi
argument_list|,
name|metrics
operator|.
name|ydpi
argument_list|,
name|metrics
operator|.
name|scaledDensity
argument_list|)
expr_stmt|;
block|}
name|m_layout
operator|=
operator|new
name|QtLayout
argument_list|(
name|m_activity
argument_list|)
expr_stmt|;
name|m_surface
operator|=
operator|new
name|QtSurface
argument_list|(
name|m_activity
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|m_editText
operator|=
operator|new
name|QtEditText
argument_list|(
name|m_activity
argument_list|)
expr_stmt|;
name|m_imm
operator|=
operator|(
name|InputMethodManager
operator|)
name|m_activity
operator|.
name|getSystemService
argument_list|(
name|Context
operator|.
name|INPUT_METHOD_SERVICE
argument_list|)
expr_stmt|;
name|m_layout
operator|.
name|addView
argument_list|(
name|m_surface
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|m_activity
operator|.
name|setContentView
argument_list|(
name|m_layout
argument_list|,
operator|new
name|ViewGroup
operator|.
name|LayoutParams
argument_list|(
name|ViewGroup
operator|.
name|LayoutParams
operator|.
name|FILL_PARENT
argument_list|,
name|ViewGroup
operator|.
name|LayoutParams
operator|.
name|FILL_PARENT
argument_list|)
argument_list|)
expr_stmt|;
name|m_layout
operator|.
name|bringChildToFront
argument_list|(
name|m_surface
argument_list|)
expr_stmt|;
name|m_activity
operator|.
name|registerForContextMenu
argument_list|(
name|m_layout
argument_list|)
expr_stmt|;
name|m_currentOrientation
operator|=
name|m_activity
operator|.
name|getResources
argument_list|()
operator|.
name|getConfiguration
argument_list|()
operator|.
name|orientation
expr_stmt|;
block|}
DECL|method|onConfigurationChanged
specifier|public
name|void
name|onConfigurationChanged
parameter_list|(
name|Configuration
name|configuration
parameter_list|)
block|{
try|try
block|{
name|m_super_onConfigurationChanged
operator|.
name|invoke
argument_list|(
name|m_activity
argument_list|,
name|configuration
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|configuration
operator|.
name|orientation
operator|!=
name|m_currentOrientation
operator|&&
name|m_currentOrientation
operator|!=
name|Configuration
operator|.
name|ORIENTATION_UNDEFINED
condition|)
block|{
name|QtNative
operator|.
name|handleOrientationChanged
argument_list|(
name|configuration
operator|.
name|orientation
argument_list|)
expr_stmt|;
block|}
name|m_currentOrientation
operator|=
name|configuration
operator|.
name|orientation
expr_stmt|;
block|}
DECL|method|onDestroy
specifier|public
name|void
name|onDestroy
parameter_list|()
block|{
if|if
condition|(
name|m_quitApp
condition|)
block|{
if|if
condition|(
name|m_debuggerProcess
operator|!=
literal|null
condition|)
name|m_debuggerProcess
operator|.
name|destroy
argument_list|()
expr_stmt|;
name|System
operator|.
name|exit
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|// FIXME remove it or find a better way
block|}
block|}
DECL|method|onRestoreInstanceState
specifier|public
name|void
name|onRestoreInstanceState
parameter_list|(
name|Bundle
name|savedInstanceState
parameter_list|)
block|{
try|try
block|{
name|m_super_onRestoreInstanceState
operator|.
name|invoke
argument_list|(
name|m_activity
argument_list|,
name|savedInstanceState
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
block|}
comment|//        setFullScreen(savedInstanceState.getBoolean("FullScreen"));
name|m_started
operator|=
name|savedInstanceState
operator|.
name|getBoolean
argument_list|(
literal|"Started"
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_started
condition|)
name|m_surface
operator|.
name|applicationStarted
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
DECL|method|onResume
specifier|public
name|void
name|onResume
parameter_list|()
block|{
comment|// fire all lostActions
synchronized|synchronized
init|(
name|QtNative
operator|.
name|m_mainActivityMutex
init|)
block|{
name|Iterator
argument_list|<
name|Runnable
argument_list|>
name|itr
init|=
name|QtNative
operator|.
name|getLostActions
argument_list|()
operator|.
name|iterator
argument_list|()
decl_stmt|;
while|while
condition|(
name|itr
operator|.
name|hasNext
argument_list|()
condition|)
name|m_activity
operator|.
name|runOnUiThread
argument_list|(
name|itr
operator|.
name|next
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_started
condition|)
block|{
name|QtNative
operator|.
name|clearLostActions
argument_list|()
expr_stmt|;
name|QtNative
operator|.
name|updateWindow
argument_list|()
expr_stmt|;
block|}
block|}
block|}
DECL|method|onRetainNonConfigurationInstance
specifier|public
name|Object
name|onRetainNonConfigurationInstance
parameter_list|()
block|{
try|try
block|{
name|m_super_onRetainNonConfigurationInstance
operator|.
name|invoke
argument_list|(
name|m_activity
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
block|}
name|m_quitApp
operator|=
literal|false
expr_stmt|;
return|return
literal|true
return|;
block|}
DECL|method|onSaveInstanceState
specifier|public
name|void
name|onSaveInstanceState
parameter_list|(
name|Bundle
name|outState
parameter_list|)
block|{
try|try
block|{
name|m_super_onSaveInstanceState
operator|.
name|invoke
argument_list|(
name|m_activity
argument_list|,
name|outState
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
block|}
name|outState
operator|.
name|putBoolean
argument_list|(
literal|"FullScreen"
argument_list|,
name|m_fullScreen
argument_list|)
expr_stmt|;
name|outState
operator|.
name|putBoolean
argument_list|(
literal|"Started"
argument_list|,
name|m_started
argument_list|)
expr_stmt|;
block|}
DECL|method|onKeyDown
specifier|public
name|boolean
name|onKeyDown
parameter_list|(
name|int
name|keyCode
parameter_list|,
name|KeyEvent
name|event
parameter_list|)
block|{
if|if
condition|(
operator|!
name|m_started
condition|)
return|return
literal|false
return|;
if|if
condition|(
name|keyCode
operator|==
name|KeyEvent
operator|.
name|KEYCODE_MENU
condition|)
block|{
try|try
block|{
return|return
operator|(
name|Boolean
operator|)
name|m_super_onKeyDown
operator|.
name|invoke
argument_list|(
name|m_activity
argument_list|,
name|keyCode
argument_list|,
name|event
argument_list|)
return|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
return|return
literal|false
return|;
block|}
block|}
name|m_metaState
operator|=
name|MetaKeyKeyListener
operator|.
name|handleKeyDown
argument_list|(
name|m_metaState
argument_list|,
name|keyCode
argument_list|,
name|event
argument_list|)
expr_stmt|;
name|int
name|c
init|=
name|event
operator|.
name|getUnicodeChar
argument_list|(
name|MetaKeyKeyListener
operator|.
name|getMetaState
argument_list|(
name|m_metaState
argument_list|)
argument_list|)
decl_stmt|;
name|int
name|lc
init|=
name|c
decl_stmt|;
name|m_metaState
operator|=
name|MetaKeyKeyListener
operator|.
name|adjustMetaAfterKeypress
argument_list|(
name|m_metaState
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|c
operator|&
name|KeyCharacterMap
operator|.
name|COMBINING_ACCENT
operator|)
operator|!=
literal|0
condition|)
block|{
name|c
operator|=
name|c
operator|&
name|KeyCharacterMap
operator|.
name|COMBINING_ACCENT_MASK
expr_stmt|;
name|int
name|composed
init|=
name|KeyEvent
operator|.
name|getDeadChar
argument_list|(
name|m_lastChar
argument_list|,
name|c
argument_list|)
decl_stmt|;
name|c
operator|=
name|composed
expr_stmt|;
block|}
name|m_lastChar
operator|=
name|lc
expr_stmt|;
if|if
condition|(
name|keyCode
operator|!=
name|KeyEvent
operator|.
name|KEYCODE_BACK
condition|)
name|QtNative
operator|.
name|keyDown
argument_list|(
name|keyCode
argument_list|,
name|c
argument_list|,
name|event
operator|.
name|getMetaState
argument_list|()
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
DECL|method|onKeyUp
specifier|public
name|boolean
name|onKeyUp
parameter_list|(
name|int
name|keyCode
parameter_list|,
name|KeyEvent
name|event
parameter_list|)
block|{
if|if
condition|(
operator|!
name|m_started
condition|)
return|return
literal|false
return|;
if|if
condition|(
name|keyCode
operator|==
name|KeyEvent
operator|.
name|KEYCODE_MENU
condition|)
block|{
try|try
block|{
return|return
operator|(
name|Boolean
operator|)
name|m_super_onKeyUp
operator|.
name|invoke
argument_list|(
name|m_activity
argument_list|,
name|keyCode
argument_list|,
name|event
argument_list|)
return|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
return|return
literal|false
return|;
block|}
block|}
if|if
condition|(
name|keyCode
operator|==
name|KeyEvent
operator|.
name|KEYCODE_BACK
operator|&&
name|m_keyboardIsVisible
condition|)
block|{
if|if
condition|(
operator|!
name|m_keyboardIsHiding
condition|)
name|hideSoftwareKeyboard
argument_list|()
expr_stmt|;
return|return
literal|true
return|;
block|}
name|m_metaState
operator|=
name|MetaKeyKeyListener
operator|.
name|handleKeyUp
argument_list|(
name|m_metaState
argument_list|,
name|keyCode
argument_list|,
name|event
argument_list|)
expr_stmt|;
name|QtNative
operator|.
name|keyUp
argument_list|(
name|keyCode
argument_list|,
name|event
operator|.
name|getUnicodeChar
argument_list|()
argument_list|,
name|event
operator|.
name|getMetaState
argument_list|()
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
DECL|method|dispatchKeyEvent
specifier|public
name|boolean
name|dispatchKeyEvent
parameter_list|(
name|KeyEvent
name|event
parameter_list|)
block|{
if|if
condition|(
name|m_started
operator|&&
name|event
operator|.
name|getAction
argument_list|()
operator|==
name|KeyEvent
operator|.
name|ACTION_MULTIPLE
operator|&&
name|event
operator|.
name|getCharacters
argument_list|()
operator|!=
literal|null
operator|&&
name|event
operator|.
name|getCharacters
argument_list|()
operator|.
name|length
argument_list|()
operator|==
literal|1
operator|&&
name|event
operator|.
name|getKeyCode
argument_list|()
operator|==
literal|0
condition|)
block|{
name|QtNative
operator|.
name|keyDown
argument_list|(
literal|0
argument_list|,
name|event
operator|.
name|getCharacters
argument_list|()
operator|.
name|charAt
argument_list|(
literal|0
argument_list|)
argument_list|,
name|event
operator|.
name|getMetaState
argument_list|()
argument_list|)
expr_stmt|;
name|QtNative
operator|.
name|keyUp
argument_list|(
literal|0
argument_list|,
name|event
operator|.
name|getCharacters
argument_list|()
operator|.
name|charAt
argument_list|(
literal|0
argument_list|)
argument_list|,
name|event
operator|.
name|getMetaState
argument_list|()
argument_list|)
expr_stmt|;
block|}
try|try
block|{
return|return
operator|(
name|Boolean
operator|)
name|m_super_dispatchKeyEvent
operator|.
name|invoke
argument_list|(
name|m_activity
argument_list|,
name|event
argument_list|)
return|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
name|e
operator|.
name|printStackTrace
argument_list|()
expr_stmt|;
block|}
return|return
literal|false
return|;
block|}
DECL|field|m_opionsMenuIsVisible
specifier|private
name|boolean
name|m_opionsMenuIsVisible
init|=
literal|false
decl_stmt|;
DECL|method|onCreateOptionsMenu
specifier|public
name|boolean
name|onCreateOptionsMenu
parameter_list|(
name|Menu
name|menu
parameter_list|)
block|{
name|menu
operator|.
name|clear
argument_list|()
expr_stmt|;
return|return
literal|true
return|;
block|}
DECL|method|onPrepareOptionsMenu
specifier|public
name|boolean
name|onPrepareOptionsMenu
parameter_list|(
name|Menu
name|menu
parameter_list|)
block|{
name|m_opionsMenuIsVisible
operator|=
literal|true
expr_stmt|;
return|return
name|QtNative
operator|.
name|onPrepareOptionsMenu
argument_list|(
name|menu
argument_list|)
return|;
block|}
DECL|method|onOptionsItemSelected
specifier|public
name|boolean
name|onOptionsItemSelected
parameter_list|(
name|MenuItem
name|item
parameter_list|)
block|{
return|return
name|QtNative
operator|.
name|onOptionsItemSelected
argument_list|(
name|item
operator|.
name|getItemId
argument_list|()
argument_list|,
name|item
operator|.
name|isChecked
argument_list|()
argument_list|)
return|;
block|}
DECL|method|onOptionsMenuClosed
specifier|public
name|void
name|onOptionsMenuClosed
parameter_list|(
name|Menu
name|menu
parameter_list|)
block|{
name|m_opionsMenuIsVisible
operator|=
literal|false
expr_stmt|;
name|QtNative
operator|.
name|onOptionsMenuClosed
argument_list|(
name|menu
argument_list|)
expr_stmt|;
block|}
DECL|method|resetOptionsMenu
specifier|public
name|void
name|resetOptionsMenu
parameter_list|()
block|{
if|if
condition|(
name|m_opionsMenuIsVisible
condition|)
name|m_activity
operator|.
name|closeOptionsMenu
argument_list|()
expr_stmt|;
block|}
DECL|field|m_contextMenuVisible
specifier|private
name|boolean
name|m_contextMenuVisible
init|=
literal|false
decl_stmt|;
DECL|method|onCreateContextMenu
specifier|public
name|void
name|onCreateContextMenu
parameter_list|(
name|ContextMenu
name|menu
parameter_list|,
name|View
name|v
parameter_list|,
name|ContextMenuInfo
name|menuInfo
parameter_list|)
block|{
name|menu
operator|.
name|clearHeader
argument_list|()
expr_stmt|;
name|QtNative
operator|.
name|onCreateContextMenu
argument_list|(
name|menu
argument_list|)
expr_stmt|;
name|m_contextMenuVisible
operator|=
literal|true
expr_stmt|;
block|}
DECL|method|onContextMenuClosed
specifier|public
name|void
name|onContextMenuClosed
parameter_list|(
name|Menu
name|menu
parameter_list|)
block|{
if|if
condition|(
operator|!
name|m_contextMenuVisible
condition|)
block|{
name|Log
operator|.
name|e
argument_list|(
name|QtNative
operator|.
name|QtTAG
argument_list|,
literal|"invalid onContextMenuClosed call"
argument_list|)
expr_stmt|;
return|return;
block|}
name|m_contextMenuVisible
operator|=
literal|false
expr_stmt|;
name|QtNative
operator|.
name|onContextMenuClosed
argument_list|(
name|menu
argument_list|)
expr_stmt|;
block|}
DECL|method|onContextItemSelected
specifier|public
name|boolean
name|onContextItemSelected
parameter_list|(
name|MenuItem
name|item
parameter_list|)
block|{
return|return
name|QtNative
operator|.
name|onContextItemSelected
argument_list|(
name|item
operator|.
name|getItemId
argument_list|()
argument_list|,
name|item
operator|.
name|isChecked
argument_list|()
argument_list|)
return|;
block|}
DECL|method|openContextMenu
specifier|public
name|void
name|openContextMenu
parameter_list|()
block|{
name|m_layout
operator|.
name|postDelayed
argument_list|(
operator|new
name|Runnable
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|run
parameter_list|()
block|{
name|m_activity
operator|.
name|openContextMenu
argument_list|(
name|m_layout
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|,
literal|10
argument_list|)
expr_stmt|;
block|}
DECL|method|closeContextMenu
specifier|public
name|void
name|closeContextMenu
parameter_list|()
block|{
name|m_activity
operator|.
name|closeContextMenu
argument_list|()
expr_stmt|;
block|}
block|}
end_class
end_unit
