begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2016 The Qt Company Ltd. ** Contact: https://www.qt.io/licensing/ ** ** This file is part of the QtGui module of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL$ ** Commercial License Usage ** Licensees holding valid commercial Qt licenses may use this file in ** accordance with the commercial license agreement provided with the ** Software or, alternatively, in accordance with the terms contained in ** a written agreement between you and The Qt Company. For licensing terms ** and conditions see https://www.qt.io/terms-conditions. For further ** information use the contact form at https://www.qt.io/contact-us. ** ** GNU Lesser General Public License Usage ** Alternatively, this file may be used under the terms of the GNU Lesser ** General Public License version 3 as published by the Free Software ** Foundation and appearing in the file LICENSE.LGPL3 included in the ** packaging of this file. Please review the following information to ** ensure the GNU Lesser General Public License version 3 requirements ** will be met: https://www.gnu.org/licenses/lgpl-3.0.html. ** ** GNU General Public License Usage ** Alternatively, this file may be used under the terms of the GNU ** General Public License version 2.0 or (at your option) the GNU General ** Public license version 3 or any later version approved by the KDE Free ** Qt Foundation. The licenses are as published by the Free Software ** Foundation and appearing in the file LICENSE.GPL2 and LICENSE.GPL3 ** included in the packaging of this file. Please review the following ** information to ensure the GNU General Public License requirements will ** be met: https://www.gnu.org/licenses/gpl-2.0.html and ** https://www.gnu.org/licenses/gpl-3.0.html. ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_include
include|#
directive|include
file|"qimagescale_p.h"
end_include
begin_include
include|#
directive|include
file|"qimage.h"
end_include
begin_include
include|#
directive|include
file|<private/qsimd_p.h>
end_include
begin_if
if|#
directive|if
name|defined
argument_list|(
name|__ARM_NEON__
argument_list|)
end_if
begin_macro
name|QT_BEGIN_NAMESPACE
end_macro
begin_using
using|using
namespace|namespace
name|QImageScale
namespace|;
end_using
begin_function
DECL|function|qt_qimageScaleAARGBA_helper
specifier|inline
specifier|static
name|uint32x4_t
name|qt_qimageScaleAARGBA_helper
parameter_list|(
specifier|const
name|unsigned
name|int
modifier|*
name|pix
parameter_list|,
name|int
name|xyap
parameter_list|,
name|int
name|Cxy
parameter_list|,
name|int
name|step
parameter_list|)
block|{
name|uint32x2_t
name|vpix32
init|=
name|vmov_n_u32
argument_list|(
operator|*
name|pix
argument_list|)
decl_stmt|;
name|uint16x4_t
name|vpix16
init|=
name|vget_low_u16
argument_list|(
name|vmovl_u8
argument_list|(
name|vreinterpret_u8_u32
argument_list|(
name|vpix32
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
name|uint32x4_t
name|vx
init|=
name|vmull_n_u16
argument_list|(
name|vpix16
argument_list|,
name|xyap
argument_list|)
decl_stmt|;
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
operator|(
literal|1
operator|<<
literal|14
operator|)
operator|-
name|xyap
init|;
name|i
operator|>
name|Cxy
condition|;
name|i
operator|-=
name|Cxy
control|)
block|{
name|pix
operator|+=
name|step
expr_stmt|;
name|vpix32
operator|=
name|vmov_n_u32
argument_list|(
operator|*
name|pix
argument_list|)
expr_stmt|;
name|vpix16
operator|=
name|vget_low_u16
argument_list|(
name|vmovl_u8
argument_list|(
name|vreinterpret_u8_u32
argument_list|(
name|vpix32
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|vx
operator|=
name|vaddq_u32
argument_list|(
name|vx
argument_list|,
name|vmull_n_u16
argument_list|(
name|vpix16
argument_list|,
name|Cxy
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|pix
operator|+=
name|step
expr_stmt|;
name|vpix32
operator|=
name|vmov_n_u32
argument_list|(
operator|*
name|pix
argument_list|)
expr_stmt|;
name|vpix16
operator|=
name|vget_low_u16
argument_list|(
name|vmovl_u8
argument_list|(
name|vreinterpret_u8_u32
argument_list|(
name|vpix32
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|vx
operator|=
name|vaddq_u32
argument_list|(
name|vx
argument_list|,
name|vmull_n_u16
argument_list|(
name|vpix16
argument_list|,
name|i
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|vx
return|;
block|}
end_function
begin_function
template|template
parameter_list|<
name|bool
name|RGB
parameter_list|>
DECL|function|qt_qimageScaleAARGBA_up_x_down_y_neon
name|void
name|qt_qimageScaleAARGBA_up_x_down_y_neon
parameter_list|(
name|QImageScaleInfo
modifier|*
name|isi
parameter_list|,
name|unsigned
name|int
modifier|*
name|dest
parameter_list|,
name|int
name|dw
parameter_list|,
name|int
name|dh
parameter_list|,
name|int
name|dow
parameter_list|,
name|int
name|sow
parameter_list|)
block|{
specifier|const
name|unsigned
name|int
modifier|*
modifier|*
name|ypoints
init|=
name|isi
operator|->
name|ypoints
decl_stmt|;
name|int
modifier|*
name|xpoints
init|=
name|isi
operator|->
name|xpoints
decl_stmt|;
name|int
modifier|*
name|xapoints
init|=
name|isi
operator|->
name|xapoints
decl_stmt|;
name|int
modifier|*
name|yapoints
init|=
name|isi
operator|->
name|yapoints
decl_stmt|;
comment|/* go through every scanline in the output buffer */
for|for
control|(
name|int
name|y
init|=
literal|0
init|;
name|y
operator|<
name|dh
condition|;
name|y
operator|++
control|)
block|{
name|int
name|Cy
init|=
name|yapoints
index|[
name|y
index|]
operator|>>
literal|16
decl_stmt|;
name|int
name|yap
init|=
name|yapoints
index|[
name|y
index|]
operator|&
literal|0xffff
decl_stmt|;
name|unsigned
name|int
modifier|*
name|dptr
init|=
name|dest
operator|+
operator|(
name|y
operator|*
name|dow
operator|)
decl_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
name|dw
condition|;
name|x
operator|++
control|)
block|{
specifier|const
name|unsigned
name|int
modifier|*
name|sptr
init|=
name|ypoints
index|[
name|y
index|]
operator|+
name|xpoints
index|[
name|x
index|]
decl_stmt|;
name|uint32x4_t
name|vx
init|=
name|qt_qimageScaleAARGBA_helper
argument_list|(
name|sptr
argument_list|,
name|yap
argument_list|,
name|Cy
argument_list|,
name|sow
argument_list|)
decl_stmt|;
name|int
name|xap
init|=
name|xapoints
index|[
name|x
index|]
decl_stmt|;
if|if
condition|(
name|xap
operator|>
literal|0
condition|)
block|{
name|uint32x4_t
name|vr
init|=
name|qt_qimageScaleAARGBA_helper
argument_list|(
name|sptr
operator|+
literal|1
argument_list|,
name|yap
argument_list|,
name|Cy
argument_list|,
name|sow
argument_list|)
decl_stmt|;
name|vx
operator|=
name|vmulq_n_u32
argument_list|(
name|vx
argument_list|,
literal|256
operator|-
name|xap
argument_list|)
expr_stmt|;
name|vr
operator|=
name|vmulq_n_u32
argument_list|(
name|vr
argument_list|,
name|xap
argument_list|)
expr_stmt|;
name|vx
operator|=
name|vaddq_u32
argument_list|(
name|vx
argument_list|,
name|vr
argument_list|)
expr_stmt|;
name|vx
operator|=
name|vshrq_n_u32
argument_list|(
name|vx
argument_list|,
literal|8
argument_list|)
expr_stmt|;
block|}
name|vx
operator|=
name|vshrq_n_u32
argument_list|(
name|vx
argument_list|,
literal|14
argument_list|)
expr_stmt|;
specifier|const
name|uint16x4_t
name|vx16
init|=
name|vmovn_u32
argument_list|(
name|vx
argument_list|)
decl_stmt|;
specifier|const
name|uint8x8_t
name|vx8
init|=
name|vmovn_u16
argument_list|(
name|vcombine_u16
argument_list|(
name|vx16
argument_list|,
name|vx16
argument_list|)
argument_list|)
decl_stmt|;
operator|*
name|dptr
operator|=
name|vget_lane_u32
argument_list|(
name|vreinterpret_u32_u8
argument_list|(
name|vx8
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|RGB
condition|)
operator|*
name|dptr
operator||=
literal|0xff000000
expr_stmt|;
name|dptr
operator|++
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function
template|template
parameter_list|<
name|bool
name|RGB
parameter_list|>
DECL|function|qt_qimageScaleAARGBA_down_x_up_y_neon
name|void
name|qt_qimageScaleAARGBA_down_x_up_y_neon
parameter_list|(
name|QImageScaleInfo
modifier|*
name|isi
parameter_list|,
name|unsigned
name|int
modifier|*
name|dest
parameter_list|,
name|int
name|dw
parameter_list|,
name|int
name|dh
parameter_list|,
name|int
name|dow
parameter_list|,
name|int
name|sow
parameter_list|)
block|{
specifier|const
name|unsigned
name|int
modifier|*
modifier|*
name|ypoints
init|=
name|isi
operator|->
name|ypoints
decl_stmt|;
name|int
modifier|*
name|xpoints
init|=
name|isi
operator|->
name|xpoints
decl_stmt|;
name|int
modifier|*
name|xapoints
init|=
name|isi
operator|->
name|xapoints
decl_stmt|;
name|int
modifier|*
name|yapoints
init|=
name|isi
operator|->
name|yapoints
decl_stmt|;
comment|/* go through every scanline in the output buffer */
for|for
control|(
name|int
name|y
init|=
literal|0
init|;
name|y
operator|<
name|dh
condition|;
name|y
operator|++
control|)
block|{
name|unsigned
name|int
modifier|*
name|dptr
init|=
name|dest
operator|+
operator|(
name|y
operator|*
name|dow
operator|)
decl_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
name|dw
condition|;
name|x
operator|++
control|)
block|{
name|int
name|Cx
init|=
name|xapoints
index|[
name|x
index|]
operator|>>
literal|16
decl_stmt|;
name|int
name|xap
init|=
name|xapoints
index|[
name|x
index|]
operator|&
literal|0xffff
decl_stmt|;
specifier|const
name|unsigned
name|int
modifier|*
name|sptr
init|=
name|ypoints
index|[
name|y
index|]
operator|+
name|xpoints
index|[
name|x
index|]
decl_stmt|;
name|uint32x4_t
name|vx
init|=
name|qt_qimageScaleAARGBA_helper
argument_list|(
name|sptr
argument_list|,
name|xap
argument_list|,
name|Cx
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|int
name|yap
init|=
name|yapoints
index|[
name|y
index|]
decl_stmt|;
if|if
condition|(
name|yap
operator|>
literal|0
condition|)
block|{
name|uint32x4_t
name|vr
init|=
name|qt_qimageScaleAARGBA_helper
argument_list|(
name|sptr
operator|+
name|sow
argument_list|,
name|xap
argument_list|,
name|Cx
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|vx
operator|=
name|vmulq_n_u32
argument_list|(
name|vx
argument_list|,
literal|256
operator|-
name|yap
argument_list|)
expr_stmt|;
name|vr
operator|=
name|vmulq_n_u32
argument_list|(
name|vr
argument_list|,
name|yap
argument_list|)
expr_stmt|;
name|vx
operator|=
name|vaddq_u32
argument_list|(
name|vx
argument_list|,
name|vr
argument_list|)
expr_stmt|;
name|vx
operator|=
name|vshrq_n_u32
argument_list|(
name|vx
argument_list|,
literal|8
argument_list|)
expr_stmt|;
block|}
name|vx
operator|=
name|vshrq_n_u32
argument_list|(
name|vx
argument_list|,
literal|14
argument_list|)
expr_stmt|;
specifier|const
name|uint16x4_t
name|vx16
init|=
name|vmovn_u32
argument_list|(
name|vx
argument_list|)
decl_stmt|;
specifier|const
name|uint8x8_t
name|vx8
init|=
name|vmovn_u16
argument_list|(
name|vcombine_u16
argument_list|(
name|vx16
argument_list|,
name|vx16
argument_list|)
argument_list|)
decl_stmt|;
operator|*
name|dptr
operator|=
name|vget_lane_u32
argument_list|(
name|vreinterpret_u32_u8
argument_list|(
name|vx8
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|RGB
condition|)
operator|*
name|dptr
operator||=
literal|0xff000000
expr_stmt|;
name|dptr
operator|++
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function
template|template
parameter_list|<
name|bool
name|RGB
parameter_list|>
DECL|function|qt_qimageScaleAARGBA_down_xy_neon
name|void
name|qt_qimageScaleAARGBA_down_xy_neon
parameter_list|(
name|QImageScaleInfo
modifier|*
name|isi
parameter_list|,
name|unsigned
name|int
modifier|*
name|dest
parameter_list|,
name|int
name|dw
parameter_list|,
name|int
name|dh
parameter_list|,
name|int
name|dow
parameter_list|,
name|int
name|sow
parameter_list|)
block|{
specifier|const
name|unsigned
name|int
modifier|*
modifier|*
name|ypoints
init|=
name|isi
operator|->
name|ypoints
decl_stmt|;
name|int
modifier|*
name|xpoints
init|=
name|isi
operator|->
name|xpoints
decl_stmt|;
name|int
modifier|*
name|xapoints
init|=
name|isi
operator|->
name|xapoints
decl_stmt|;
name|int
modifier|*
name|yapoints
init|=
name|isi
operator|->
name|yapoints
decl_stmt|;
for|for
control|(
name|int
name|y
init|=
literal|0
init|;
name|y
operator|<
name|dh
condition|;
name|y
operator|++
control|)
block|{
name|int
name|Cy
init|=
name|yapoints
index|[
name|y
index|]
operator|>>
literal|16
decl_stmt|;
name|int
name|yap
init|=
name|yapoints
index|[
name|y
index|]
operator|&
literal|0xffff
decl_stmt|;
name|unsigned
name|int
modifier|*
name|dptr
init|=
name|dest
operator|+
operator|(
name|y
operator|*
name|dow
operator|)
decl_stmt|;
for|for
control|(
name|int
name|x
init|=
literal|0
init|;
name|x
operator|<
name|dw
condition|;
name|x
operator|++
control|)
block|{
specifier|const
name|int
name|Cx
init|=
name|xapoints
index|[
name|x
index|]
operator|>>
literal|16
decl_stmt|;
specifier|const
name|int
name|xap
init|=
name|xapoints
index|[
name|x
index|]
operator|&
literal|0xffff
decl_stmt|;
specifier|const
name|unsigned
name|int
modifier|*
name|sptr
init|=
name|ypoints
index|[
name|y
index|]
operator|+
name|xpoints
index|[
name|x
index|]
decl_stmt|;
name|uint32x4_t
name|vx
init|=
name|qt_qimageScaleAARGBA_helper
argument_list|(
name|sptr
argument_list|,
name|xap
argument_list|,
name|Cx
argument_list|,
literal|1
argument_list|)
decl_stmt|;
name|vx
operator|=
name|vshrq_n_u32
argument_list|(
name|vx
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|uint32x4_t
name|vr
init|=
name|vmulq_n_u32
argument_list|(
name|vx
argument_list|,
name|yap
argument_list|)
decl_stmt|;
name|int
name|j
decl_stmt|;
for|for
control|(
name|j
operator|=
operator|(
literal|1
operator|<<
literal|14
operator|)
operator|-
name|yap
init|;
name|j
operator|>
name|Cy
condition|;
name|j
operator|-=
name|Cy
control|)
block|{
name|sptr
operator|+=
name|sow
expr_stmt|;
name|vx
operator|=
name|qt_qimageScaleAARGBA_helper
argument_list|(
name|sptr
argument_list|,
name|xap
argument_list|,
name|Cx
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|vx
operator|=
name|vshrq_n_u32
argument_list|(
name|vx
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|vx
operator|=
name|vmulq_n_u32
argument_list|(
name|vx
argument_list|,
name|Cy
argument_list|)
expr_stmt|;
name|vr
operator|=
name|vaddq_u32
argument_list|(
name|vr
argument_list|,
name|vx
argument_list|)
expr_stmt|;
block|}
name|sptr
operator|+=
name|sow
expr_stmt|;
name|vx
operator|=
name|qt_qimageScaleAARGBA_helper
argument_list|(
name|sptr
argument_list|,
name|xap
argument_list|,
name|Cx
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|vx
operator|=
name|vshrq_n_u32
argument_list|(
name|vx
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|vx
operator|=
name|vmulq_n_u32
argument_list|(
name|vx
argument_list|,
name|j
argument_list|)
expr_stmt|;
name|vr
operator|=
name|vaddq_u32
argument_list|(
name|vr
argument_list|,
name|vx
argument_list|)
expr_stmt|;
name|vx
operator|=
name|vshrq_n_u32
argument_list|(
name|vr
argument_list|,
literal|24
argument_list|)
expr_stmt|;
specifier|const
name|uint16x4_t
name|vx16
init|=
name|vmovn_u32
argument_list|(
name|vx
argument_list|)
decl_stmt|;
specifier|const
name|uint8x8_t
name|vx8
init|=
name|vmovn_u16
argument_list|(
name|vcombine_u16
argument_list|(
name|vx16
argument_list|,
name|vx16
argument_list|)
argument_list|)
decl_stmt|;
operator|*
name|dptr
operator|=
name|vget_lane_u32
argument_list|(
name|vreinterpret_u32_u8
argument_list|(
name|vx8
argument_list|)
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|RGB
condition|)
operator|*
name|dptr
operator||=
literal|0xff000000
expr_stmt|;
name|dptr
operator|++
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function_decl
specifier|template
name|void
name|qt_qimageScaleAARGBA_up_x_down_y_neon
argument_list|<
literal|false
argument_list|>
parameter_list|(
name|QImageScaleInfo
modifier|*
name|isi
parameter_list|,
name|unsigned
name|int
modifier|*
name|dest
parameter_list|,
name|int
name|dw
parameter_list|,
name|int
name|dh
parameter_list|,
name|int
name|dow
parameter_list|,
name|int
name|sow
parameter_list|)
function_decl|;
end_function_decl
begin_function_decl
specifier|template
name|void
name|qt_qimageScaleAARGBA_up_x_down_y_neon
argument_list|<
literal|true
argument_list|>
parameter_list|(
name|QImageScaleInfo
modifier|*
name|isi
parameter_list|,
name|unsigned
name|int
modifier|*
name|dest
parameter_list|,
name|int
name|dw
parameter_list|,
name|int
name|dh
parameter_list|,
name|int
name|dow
parameter_list|,
name|int
name|sow
parameter_list|)
function_decl|;
end_function_decl
begin_function_decl
specifier|template
name|void
name|qt_qimageScaleAARGBA_down_x_up_y_neon
argument_list|<
literal|false
argument_list|>
parameter_list|(
name|QImageScaleInfo
modifier|*
name|isi
parameter_list|,
name|unsigned
name|int
modifier|*
name|dest
parameter_list|,
name|int
name|dw
parameter_list|,
name|int
name|dh
parameter_list|,
name|int
name|dow
parameter_list|,
name|int
name|sow
parameter_list|)
function_decl|;
end_function_decl
begin_function_decl
specifier|template
name|void
name|qt_qimageScaleAARGBA_down_x_up_y_neon
argument_list|<
literal|true
argument_list|>
parameter_list|(
name|QImageScaleInfo
modifier|*
name|isi
parameter_list|,
name|unsigned
name|int
modifier|*
name|dest
parameter_list|,
name|int
name|dw
parameter_list|,
name|int
name|dh
parameter_list|,
name|int
name|dow
parameter_list|,
name|int
name|sow
parameter_list|)
function_decl|;
end_function_decl
begin_function_decl
specifier|template
name|void
name|qt_qimageScaleAARGBA_down_xy_neon
argument_list|<
literal|false
argument_list|>
parameter_list|(
name|QImageScaleInfo
modifier|*
name|isi
parameter_list|,
name|unsigned
name|int
modifier|*
name|dest
parameter_list|,
name|int
name|dw
parameter_list|,
name|int
name|dh
parameter_list|,
name|int
name|dow
parameter_list|,
name|int
name|sow
parameter_list|)
function_decl|;
end_function_decl
begin_function_decl
specifier|template
name|void
name|qt_qimageScaleAARGBA_down_xy_neon
argument_list|<
literal|true
argument_list|>
parameter_list|(
name|QImageScaleInfo
modifier|*
name|isi
parameter_list|,
name|unsigned
name|int
modifier|*
name|dest
parameter_list|,
name|int
name|dw
parameter_list|,
name|int
name|dh
parameter_list|,
name|int
name|dow
parameter_list|,
name|int
name|sow
parameter_list|)
function_decl|;
end_function_decl
begin_macro
name|QT_END_NAMESPACE
end_macro
begin_endif
endif|#
directive|endif
end_endif
end_unit
