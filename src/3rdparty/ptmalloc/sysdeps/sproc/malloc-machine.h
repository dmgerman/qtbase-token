begin_unit
begin_comment
comment|/* Basic platform-independent macro definitions for mutexes,    thread-specific data and parameters for malloc.    SGI threads (sprocs) version.    Copyright (C) 2004 Wolfram Gloger<wg@malloc.de>.  Permission to use, copy, modify, distribute, and sell this software and its documentation for any purpose is hereby granted without fee, provided that (i) the above copyright notices and this permission notice appear in all copies of the software and related documentation, and (ii) the name of Wolfram Gloger may not be used in any advertising or publicity relating to the software.  THE SOFTWARE IS PROVIDED "AS-IS" AND WITHOUT WARRANTY OF ANY KIND, EXPRESS, IMPLIED OR OTHERWISE, INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL WOLFRAM GLOGER BE LIABLE FOR ANY SPECIAL, INCIDENTAL, INDIRECT OR CONSEQUENTIAL DAMAGES OF ANY KIND, OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER OR NOT ADVISED OF THE POSSIBILITY OF DAMAGE, AND ON ANY THEORY OF LIABILITY, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE. */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|_SPROC_MALLOC_MACHINE_H
end_ifndef
begin_define
DECL|macro|_SPROC_MALLOC_MACHINE_H
define|#
directive|define
name|_SPROC_MALLOC_MACHINE_H
end_define
begin_include
include|#
directive|include
file|<sys/wait.h>
end_include
begin_include
include|#
directive|include
file|<sys/types.h>
end_include
begin_include
include|#
directive|include
file|<sys/prctl.h>
end_include
begin_include
include|#
directive|include
file|<abi_mutex.h>
end_include
begin_typedef
DECL|typedef|mutex_t
typedef|typedef
name|abilock_t
name|mutex_t
typedef|;
end_typedef
begin_define
DECL|macro|MUTEX_INITIALIZER
define|#
directive|define
name|MUTEX_INITIALIZER
value|{ 0 }
end_define
begin_define
DECL|macro|mutex_init
define|#
directive|define
name|mutex_init
parameter_list|(
name|m
parameter_list|)
value|init_lock(m)
end_define
begin_define
DECL|macro|mutex_lock
define|#
directive|define
name|mutex_lock
parameter_list|(
name|m
parameter_list|)
value|(spin_lock(m), 0)
end_define
begin_define
DECL|macro|mutex_trylock
define|#
directive|define
name|mutex_trylock
parameter_list|(
name|m
parameter_list|)
value|acquire_lock(m)
end_define
begin_define
DECL|macro|mutex_unlock
define|#
directive|define
name|mutex_unlock
parameter_list|(
name|m
parameter_list|)
value|release_lock(m)
end_define
begin_typedef
DECL|typedef|tsd_key_t
typedef|typedef
name|int
name|tsd_key_t
typedef|;
end_typedef
begin_decl_stmt
DECL|variable|tsd_key_next
name|int
name|tsd_key_next
decl_stmt|;
end_decl_stmt
begin_define
DECL|macro|tsd_key_create
define|#
directive|define
name|tsd_key_create
parameter_list|(
name|key
parameter_list|,
name|destr
parameter_list|)
value|((*key) = tsd_key_next++)
end_define
begin_define
DECL|macro|tsd_setspecific
define|#
directive|define
name|tsd_setspecific
parameter_list|(
name|key
parameter_list|,
name|data
parameter_list|)
value|(((void **)(&PRDA->usr_prda))[key] = data)
end_define
begin_define
DECL|macro|tsd_getspecific
define|#
directive|define
name|tsd_getspecific
parameter_list|(
name|key
parameter_list|,
name|vptr
parameter_list|)
value|(vptr = ((void **)(&PRDA->usr_prda))[key])
end_define
begin_define
DECL|macro|thread_atfork
define|#
directive|define
name|thread_atfork
parameter_list|(
name|prepare
parameter_list|,
name|parent
parameter_list|,
name|child
parameter_list|)
value|do {} while(0)
end_define
begin_include
include|#
directive|include
file|<sysdeps/generic/malloc-machine.h>
end_include
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* !defined(_SPROC_MALLOC_MACHINE_H) */
end_comment
end_unit
