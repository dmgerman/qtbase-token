begin_unit
begin_comment
comment|/*  * Copyright Â© 2012 Intel Corporation  *  * Permission is hereby granted, free of charge, to any person obtaining a  * copy of this software and associated documentation files (the "Software"),  * to deal in the Software without restriction, including without limitation  * the rights to use, copy, modify, merge, publish, distribute, sublicense,  * and/or sell copies of the Software, and to permit persons to whom the  * Software is furnished to do so, subject to the following conditions:  *  * The above copyright notice and this permission notice (including the next  * paragraph) shall be included in all copies or substantial portions of the  * Software.  *  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR  * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,  * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL  * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER  * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING  * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER  * DEALINGS IN THE SOFTWARE.  *  * Author: Daniel Stone<daniel@fooishbar.org>  */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|CONTEXT_H
end_ifndef
begin_define
DECL|macro|CONTEXT_H
define|#
directive|define
name|CONTEXT_H
end_define
begin_include
include|#
directive|include
file|"atom.h"
end_include
begin_struct
DECL|struct|xkb_context
struct|struct
name|xkb_context
block|{
DECL|member|refcnt
name|int
name|refcnt
decl_stmt|;
DECL|member|log_fn
name|ATTR_PRINTF
argument_list|(
literal|3
argument_list|,
literal|0
argument_list|)
name|void
function_decl|(
modifier|*
name|log_fn
function_decl|)
parameter_list|(
name|struct
name|xkb_context
modifier|*
name|ctx
parameter_list|,
name|enum
name|xkb_log_level
name|level
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
name|va_list
name|args
parameter_list|)
function_decl|;
DECL|member|log_level
name|enum
name|xkb_log_level
name|log_level
decl_stmt|;
DECL|member|log_verbosity
name|int
name|log_verbosity
decl_stmt|;
DECL|member|user_data
name|void
modifier|*
name|user_data
decl_stmt|;
DECL|member|names_dflt
name|struct
name|xkb_rule_names
name|names_dflt
decl_stmt|;
DECL|member|includes
name|darray
argument_list|(
argument|char *
argument_list|)
name|includes
expr_stmt|;
DECL|member|failed_includes
name|darray
argument_list|(
argument|char *
argument_list|)
name|failed_includes
expr_stmt|;
DECL|member|atom_table
name|struct
name|atom_table
modifier|*
name|atom_table
decl_stmt|;
comment|/* Buffer for the *Text() functions. */
DECL|member|text_buffer
name|char
name|text_buffer
index|[
literal|2048
index|]
decl_stmt|;
DECL|member|text_next
name|size_t
name|text_next
decl_stmt|;
DECL|member|use_environment_names
name|unsigned
name|int
name|use_environment_names
range|:
literal|1
decl_stmt|;
block|}
struct|;
end_struct
begin_function_decl
name|unsigned
name|int
name|xkb_context_num_failed_include_paths
parameter_list|(
name|struct
name|xkb_context
modifier|*
name|ctx
parameter_list|)
function_decl|;
end_function_decl
begin_function_decl
specifier|const
name|char
modifier|*
name|xkb_context_failed_include_path_get
parameter_list|(
name|struct
name|xkb_context
modifier|*
name|ctx
parameter_list|,
name|unsigned
name|int
name|idx
parameter_list|)
function_decl|;
end_function_decl
begin_comment
comment|/*  * Returns XKB_ATOM_NONE if @string was not previously interned,  * otherwise returns the atom.  */
end_comment
begin_function_decl
name|xkb_atom_t
name|xkb_atom_lookup
parameter_list|(
name|struct
name|xkb_context
modifier|*
name|ctx
parameter_list|,
specifier|const
name|char
modifier|*
name|string
parameter_list|)
function_decl|;
end_function_decl
begin_function_decl
name|xkb_atom_t
name|xkb_atom_intern
parameter_list|(
name|struct
name|xkb_context
modifier|*
name|ctx
parameter_list|,
specifier|const
name|char
modifier|*
name|string
parameter_list|,
name|size_t
name|len
parameter_list|)
function_decl|;
end_function_decl
begin_define
DECL|macro|xkb_atom_intern_literal
define|#
directive|define
name|xkb_atom_intern_literal
parameter_list|(
name|ctx
parameter_list|,
name|literal
parameter_list|)
define|\
value|xkb_atom_intern((ctx), (literal), sizeof(literal) - 1)
end_define
begin_comment
comment|/**  * If @string is dynamically allocated, NUL-terminated, free'd immediately  * after being interned, and not used afterwards, use this function  * instead of xkb_atom_intern to avoid some unnecessary allocations.  * The caller should not use or free the passed in string afterwards.  */
end_comment
begin_function_decl
name|xkb_atom_t
name|xkb_atom_steal
parameter_list|(
name|struct
name|xkb_context
modifier|*
name|ctx
parameter_list|,
name|char
modifier|*
name|string
parameter_list|)
function_decl|;
end_function_decl
begin_function_decl
specifier|const
name|char
modifier|*
name|xkb_atom_text
parameter_list|(
name|struct
name|xkb_context
modifier|*
name|ctx
parameter_list|,
name|xkb_atom_t
name|atom
parameter_list|)
function_decl|;
end_function_decl
begin_function_decl
name|char
modifier|*
name|xkb_context_get_buffer
parameter_list|(
name|struct
name|xkb_context
modifier|*
name|ctx
parameter_list|,
name|size_t
name|size
parameter_list|)
function_decl|;
end_function_decl
begin_macro
name|ATTR_PRINTF
argument_list|(
literal|4
argument_list|,
literal|5
argument_list|)
end_macro
begin_function_decl
name|void
name|xkb_log
parameter_list|(
name|struct
name|xkb_context
modifier|*
name|ctx
parameter_list|,
name|enum
name|xkb_log_level
name|level
parameter_list|,
name|int
name|verbosity
parameter_list|,
specifier|const
name|char
modifier|*
name|fmt
parameter_list|,
modifier|...
parameter_list|)
function_decl|;
end_function_decl
begin_function_decl
name|void
name|xkb_context_sanitize_rule_names
parameter_list|(
name|struct
name|xkb_context
modifier|*
name|ctx
parameter_list|,
name|struct
name|xkb_rule_names
modifier|*
name|rmlvo
parameter_list|)
function_decl|;
end_function_decl
begin_comment
comment|/*  * The format is not part of the argument list in order to avoid the  * "ISO C99 requires rest arguments to be used" warning when only the  * format is supplied without arguments. Not supplying it would still  * result in an error, though.  */
end_comment
begin_define
DECL|macro|log_dbg
define|#
directive|define
name|log_dbg
parameter_list|(
name|ctx
parameter_list|,
modifier|...
parameter_list|)
define|\
value|xkb_log((ctx), XKB_LOG_LEVEL_DEBUG, 0, __VA_ARGS__)
end_define
begin_define
DECL|macro|log_info
define|#
directive|define
name|log_info
parameter_list|(
name|ctx
parameter_list|,
modifier|...
parameter_list|)
define|\
value|xkb_log((ctx), XKB_LOG_LEVEL_INFO, 0, __VA_ARGS__)
end_define
begin_define
DECL|macro|log_warn
define|#
directive|define
name|log_warn
parameter_list|(
name|ctx
parameter_list|,
modifier|...
parameter_list|)
define|\
value|xkb_log((ctx), XKB_LOG_LEVEL_WARNING, 0,  __VA_ARGS__)
end_define
begin_define
DECL|macro|log_err
define|#
directive|define
name|log_err
parameter_list|(
name|ctx
parameter_list|,
modifier|...
parameter_list|)
define|\
value|xkb_log((ctx), XKB_LOG_LEVEL_ERROR, 0,  __VA_ARGS__)
end_define
begin_define
DECL|macro|log_wsgo
define|#
directive|define
name|log_wsgo
parameter_list|(
name|ctx
parameter_list|,
modifier|...
parameter_list|)
define|\
value|xkb_log((ctx), XKB_LOG_LEVEL_CRITICAL, 0, __VA_ARGS__)
end_define
begin_define
DECL|macro|log_vrb
define|#
directive|define
name|log_vrb
parameter_list|(
name|ctx
parameter_list|,
name|vrb
parameter_list|,
modifier|...
parameter_list|)
define|\
value|xkb_log((ctx), XKB_LOG_LEVEL_WARNING, (vrb), __VA_ARGS__)
end_define
begin_comment
comment|/*  * Variants which are prefixed by the name of the function they're  * called from.  * Here we must have the silly 1 variant.  */
end_comment
begin_define
DECL|macro|log_err_func
define|#
directive|define
name|log_err_func
parameter_list|(
name|ctx
parameter_list|,
name|fmt
parameter_list|,
modifier|...
parameter_list|)
define|\
value|log_err(ctx, "%s: " fmt, __func__, __VA_ARGS__)
end_define
begin_define
DECL|macro|log_err_func1
define|#
directive|define
name|log_err_func1
parameter_list|(
name|ctx
parameter_list|,
name|fmt
parameter_list|)
define|\
value|log_err(ctx, "%s: " fmt, __func__)
end_define
begin_endif
endif|#
directive|endif
end_endif
end_unit
