begin_unit
begin_comment
comment|/* $Id: tif_print.c,v 1.36.2.2 2009-09-17 18:00:28 bfriesen Exp $ */
end_comment
begin_comment
comment|/*  * Copyright (c) 1988-1997 Sam Leffler  * Copyright (c) 1991-1997 Silicon Graphics, Inc.  *  * Permission to use, copy, modify, distribute, and sell this software and   * its documentation for any purpose is hereby granted without fee, provided  * that (i) the above copyright notices and this permission notice appear in  * all copies of the software and related documentation, and (ii) the names of  * Sam Leffler and Silicon Graphics may not be used in any advertising or  * publicity relating to the software without the specific, prior written  * permission of Sam Leffler and Silicon Graphics.  *   * THE SOFTWARE IS PROVIDED "AS-IS" AND WITHOUT WARRANTY OF ANY KIND,   * EXPRESS, IMPLIED OR OTHERWISE, INCLUDING WITHOUT LIMITATION, ANY   * WARRANTY OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.    *   * IN NO EVENT SHALL SAM LEFFLER OR SILICON GRAPHICS BE LIABLE FOR  * ANY SPECIAL, INCIDENTAL, INDIRECT OR CONSEQUENTIAL DAMAGES OF ANY KIND,  * OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS,  * WHETHER OR NOT ADVISED OF THE POSSIBILITY OF DAMAGE, AND ON ANY THEORY OF   * LIABILITY, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE   * OF THIS SOFTWARE.  */
end_comment
begin_comment
comment|/*  * TIFF Library.  *  * Directory Printing Support  */
end_comment
begin_include
include|#
directive|include
file|"tiffiop.h"
end_include
begin_include
include|#
directive|include
file|<stdio.h>
end_include
begin_include
include|#
directive|include
file|<string.h>
end_include
begin_include
include|#
directive|include
file|<ctype.h>
end_include
begin_decl_stmt
DECL|variable|photoNames
specifier|static
specifier|const
name|char
modifier|*
name|photoNames
index|[]
init|=
block|{
literal|"min-is-white"
block|,
comment|/* PHOTOMETRIC_MINISWHITE */
literal|"min-is-black"
block|,
comment|/* PHOTOMETRIC_MINISBLACK */
literal|"RGB color"
block|,
comment|/* PHOTOMETRIC_RGB */
literal|"palette color (RGB from colormap)"
block|,
comment|/* PHOTOMETRIC_PALETTE */
literal|"transparency mask"
block|,
comment|/* PHOTOMETRIC_MASK */
literal|"separated"
block|,
comment|/* PHOTOMETRIC_SEPARATED */
literal|"YCbCr"
block|,
comment|/* PHOTOMETRIC_YCBCR */
literal|"7 (0x7)"
block|,
literal|"CIE L*a*b*"
block|,
comment|/* PHOTOMETRIC_CIELAB */
block|}
decl_stmt|;
end_decl_stmt
begin_define
DECL|macro|NPHOTONAMES
define|#
directive|define
name|NPHOTONAMES
value|(sizeof (photoNames) / sizeof (photoNames[0]))
end_define
begin_decl_stmt
DECL|variable|orientNames
specifier|static
specifier|const
name|char
modifier|*
name|orientNames
index|[]
init|=
block|{
literal|"0 (0x0)"
block|,
literal|"row 0 top, col 0 lhs"
block|,
comment|/* ORIENTATION_TOPLEFT */
literal|"row 0 top, col 0 rhs"
block|,
comment|/* ORIENTATION_TOPRIGHT */
literal|"row 0 bottom, col 0 rhs"
block|,
comment|/* ORIENTATION_BOTRIGHT */
literal|"row 0 bottom, col 0 lhs"
block|,
comment|/* ORIENTATION_BOTLEFT */
literal|"row 0 lhs, col 0 top"
block|,
comment|/* ORIENTATION_LEFTTOP */
literal|"row 0 rhs, col 0 top"
block|,
comment|/* ORIENTATION_RIGHTTOP */
literal|"row 0 rhs, col 0 bottom"
block|,
comment|/* ORIENTATION_RIGHTBOT */
literal|"row 0 lhs, col 0 bottom"
block|,
comment|/* ORIENTATION_LEFTBOT */
block|}
decl_stmt|;
end_decl_stmt
begin_define
DECL|macro|NORIENTNAMES
define|#
directive|define
name|NORIENTNAMES
value|(sizeof (orientNames) / sizeof (orientNames[0]))
end_define
begin_function
specifier|static
name|void
DECL|function|_TIFFPrintField
name|_TIFFPrintField
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|,
specifier|const
name|TIFFFieldInfo
modifier|*
name|fip
parameter_list|,
name|uint32
name|value_count
parameter_list|,
name|void
modifier|*
name|raw_data
parameter_list|)
block|{
name|uint32
name|j
decl_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  %s: "
argument_list|,
name|fip
operator|->
name|field_name
argument_list|)
expr_stmt|;
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
name|value_count
condition|;
name|j
operator|++
control|)
block|{
if|if
condition|(
name|fip
operator|->
name|field_type
operator|==
name|TIFF_BYTE
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%u"
argument_list|,
operator|(
operator|(
name|uint8
operator|*
operator|)
name|raw_data
operator|)
index|[
name|j
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|fip
operator|->
name|field_type
operator|==
name|TIFF_UNDEFINED
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%x"
argument_list|,
call|(
name|unsigned
name|int
call|)
argument_list|(
operator|(
name|unsigned
name|char
operator|*
operator|)
name|raw_data
argument_list|)
index|[
name|j
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|fip
operator|->
name|field_type
operator|==
name|TIFF_SBYTE
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%d"
argument_list|,
operator|(
operator|(
name|int8
operator|*
operator|)
name|raw_data
operator|)
index|[
name|j
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|fip
operator|->
name|field_type
operator|==
name|TIFF_SHORT
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%u"
argument_list|,
operator|(
operator|(
name|uint16
operator|*
operator|)
name|raw_data
operator|)
index|[
name|j
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|fip
operator|->
name|field_type
operator|==
name|TIFF_SSHORT
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%d"
argument_list|,
operator|(
operator|(
name|int16
operator|*
operator|)
name|raw_data
operator|)
index|[
name|j
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|fip
operator|->
name|field_type
operator|==
name|TIFF_LONG
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%lu"
argument_list|,
call|(
name|unsigned
name|long
call|)
argument_list|(
operator|(
name|uint32
operator|*
operator|)
name|raw_data
argument_list|)
index|[
name|j
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|fip
operator|->
name|field_type
operator|==
name|TIFF_SLONG
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%ld"
argument_list|,
call|(
name|long
call|)
argument_list|(
operator|(
name|int32
operator|*
operator|)
name|raw_data
argument_list|)
index|[
name|j
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|fip
operator|->
name|field_type
operator|==
name|TIFF_RATIONAL
operator|||
name|fip
operator|->
name|field_type
operator|==
name|TIFF_SRATIONAL
operator|||
name|fip
operator|->
name|field_type
operator|==
name|TIFF_FLOAT
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%f"
argument_list|,
operator|(
operator|(
name|float
operator|*
operator|)
name|raw_data
operator|)
index|[
name|j
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|fip
operator|->
name|field_type
operator|==
name|TIFF_IFD
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"0x%ulx"
argument_list|,
operator|(
operator|(
name|uint32
operator|*
operator|)
name|raw_data
operator|)
index|[
name|j
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|fip
operator|->
name|field_type
operator|==
name|TIFF_ASCII
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%s"
argument_list|,
operator|(
name|char
operator|*
operator|)
name|raw_data
argument_list|)
expr_stmt|;
break|break;
block|}
elseif|else
if|if
condition|(
name|fip
operator|->
name|field_type
operator|==
name|TIFF_DOUBLE
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%f"
argument_list|,
operator|(
operator|(
name|double
operator|*
operator|)
name|raw_data
operator|)
index|[
name|j
index|]
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|fip
operator|->
name|field_type
operator|==
name|TIFF_FLOAT
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%f"
argument_list|,
operator|(
operator|(
name|float
operator|*
operator|)
name|raw_data
operator|)
index|[
name|j
index|]
argument_list|)
expr_stmt|;
else|else
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"<unsupported data type in TIFFPrint>"
argument_list|)
expr_stmt|;
break|break;
block|}
if|if
condition|(
name|j
operator|<
name|value_count
operator|-
literal|1
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|","
argument_list|)
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
specifier|static
name|int
DECL|function|_TIFFPrettyPrintField
name|_TIFFPrettyPrintField
parameter_list|(
name|TIFF
modifier|*
name|tif
parameter_list|,
name|FILE
modifier|*
name|fd
parameter_list|,
name|ttag_t
name|tag
parameter_list|,
name|uint32
name|value_count
parameter_list|,
name|void
modifier|*
name|raw_data
parameter_list|)
block|{
name|TIFFDirectory
modifier|*
name|td
init|=
operator|&
name|tif
operator|->
name|tif_dir
decl_stmt|;
switch|switch
condition|(
name|tag
condition|)
block|{
case|case
name|TIFFTAG_INKSET
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Ink Set: "
argument_list|)
expr_stmt|;
switch|switch
condition|(
operator|*
operator|(
operator|(
name|uint16
operator|*
operator|)
name|raw_data
operator|)
condition|)
block|{
case|case
name|INKSET_CMYK
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"CMYK\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%u (0x%x)\n"
argument_list|,
operator|*
operator|(
operator|(
name|uint16
operator|*
operator|)
name|raw_data
operator|)
argument_list|,
operator|*
operator|(
operator|(
name|uint16
operator|*
operator|)
name|raw_data
operator|)
argument_list|)
expr_stmt|;
break|break;
block|}
return|return
literal|1
return|;
case|case
name|TIFFTAG_DOTRANGE
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Dot Range: %u-%u\n"
argument_list|,
operator|(
operator|(
name|uint16
operator|*
operator|)
name|raw_data
operator|)
index|[
literal|0
index|]
argument_list|,
operator|(
operator|(
name|uint16
operator|*
operator|)
name|raw_data
operator|)
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|TIFFTAG_WHITEPOINT
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  White Point: %g-%g\n"
argument_list|,
operator|(
operator|(
name|float
operator|*
operator|)
name|raw_data
operator|)
index|[
literal|0
index|]
argument_list|,
operator|(
operator|(
name|float
operator|*
operator|)
name|raw_data
operator|)
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|TIFFTAG_REFERENCEBLACKWHITE
case|:
block|{
name|uint16
name|i
decl_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Reference Black/White:\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|td
operator|->
name|td_samplesperpixel
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"    %2d: %5g %5g\n"
argument_list|,
name|i
argument_list|,
operator|(
operator|(
name|float
operator|*
operator|)
name|raw_data
operator|)
index|[
literal|2
operator|*
name|i
operator|+
literal|0
index|]
argument_list|,
operator|(
operator|(
name|float
operator|*
operator|)
name|raw_data
operator|)
index|[
literal|2
operator|*
name|i
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
case|case
name|TIFFTAG_XMLPACKET
case|:
block|{
name|uint32
name|i
decl_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  XMLPacket (XMP Metadata):\n"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|value_count
condition|;
name|i
operator|++
control|)
name|fputc
argument_list|(
operator|(
operator|(
name|char
operator|*
operator|)
name|raw_data
operator|)
index|[
name|i
index|]
argument_list|,
name|fd
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
case|case
name|TIFFTAG_RICHTIFFIPTC
case|:
comment|/* 			 * XXX: for some weird reason RichTIFFIPTC tag 			 * defined as array of LONG values. 			 */
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  RichTIFFIPTC Data:<present>, %lu bytes\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|value_count
operator|*
literal|4
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|TIFFTAG_PHOTOSHOP
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Photoshop Data:<present>, %lu bytes\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|value_count
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|TIFFTAG_ICCPROFILE
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  ICC Profile:<present>, %lu bytes\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|value_count
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
case|case
name|TIFFTAG_STONITS
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Sample to Nits conversion factor: %.4e\n"
argument_list|,
operator|*
operator|(
operator|(
name|double
operator|*
operator|)
name|raw_data
operator|)
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
return|return
literal|0
return|;
block|}
end_function
begin_comment
comment|/*  * Print the contents of the current directory  * to the specified stdio file stream.  */
end_comment
begin_function
name|void
DECL|function|TIFFPrintDirectory
name|TIFFPrintDirectory
parameter_list|(
name|TIFF
modifier|*
name|tif
parameter_list|,
name|FILE
modifier|*
name|fd
parameter_list|,
name|long
name|flags
parameter_list|)
block|{
name|TIFFDirectory
modifier|*
name|td
init|=
operator|&
name|tif
operator|->
name|tif_dir
decl_stmt|;
name|char
modifier|*
name|sep
decl_stmt|;
name|uint16
name|i
decl_stmt|;
name|long
name|l
decl_stmt|,
name|n
decl_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"TIFF Directory at offset 0x%lx (%lu)\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|tif
operator|->
name|tif_diroff
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|tif
operator|->
name|tif_diroff
argument_list|)
expr_stmt|;
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_SUBFILETYPE
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Subfile Type:"
argument_list|)
expr_stmt|;
name|sep
operator|=
literal|" "
expr_stmt|;
if|if
condition|(
name|td
operator|->
name|td_subfiletype
operator|&
name|FILETYPE_REDUCEDIMAGE
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%sreduced-resolution image"
argument_list|,
name|sep
argument_list|)
expr_stmt|;
name|sep
operator|=
literal|"/"
expr_stmt|;
block|}
if|if
condition|(
name|td
operator|->
name|td_subfiletype
operator|&
name|FILETYPE_PAGE
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%smulti-page document"
argument_list|,
name|sep
argument_list|)
expr_stmt|;
name|sep
operator|=
literal|"/"
expr_stmt|;
block|}
if|if
condition|(
name|td
operator|->
name|td_subfiletype
operator|&
name|FILETYPE_MASK
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%stransparency mask"
argument_list|,
name|sep
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|" (%lu = 0x%lx)\n"
argument_list|,
operator|(
name|long
operator|)
name|td
operator|->
name|td_subfiletype
argument_list|,
operator|(
name|long
operator|)
name|td
operator|->
name|td_subfiletype
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_IMAGEDIMENSIONS
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Image Width: %lu Image Length: %lu"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|td
operator|->
name|td_imagewidth
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|td
operator|->
name|td_imagelength
argument_list|)
expr_stmt|;
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_IMAGEDEPTH
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|" Image Depth: %lu"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|td
operator|->
name|td_imagedepth
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_TILEDIMENSIONS
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Tile Width: %lu Tile Length: %lu"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|td
operator|->
name|td_tilewidth
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|td
operator|->
name|td_tilelength
argument_list|)
expr_stmt|;
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_TILEDEPTH
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|" Tile Depth: %lu"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|td
operator|->
name|td_tiledepth
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_RESOLUTION
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Resolution: %g, %g"
argument_list|,
name|td
operator|->
name|td_xresolution
argument_list|,
name|td
operator|->
name|td_yresolution
argument_list|)
expr_stmt|;
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_RESOLUTIONUNIT
argument_list|)
condition|)
block|{
switch|switch
condition|(
name|td
operator|->
name|td_resolutionunit
condition|)
block|{
case|case
name|RESUNIT_NONE
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|" (unitless)"
argument_list|)
expr_stmt|;
break|break;
case|case
name|RESUNIT_INCH
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|" pixels/inch"
argument_list|)
expr_stmt|;
break|break;
case|case
name|RESUNIT_CENTIMETER
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|" pixels/cm"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|" (unit %u = 0x%x)"
argument_list|,
name|td
operator|->
name|td_resolutionunit
argument_list|,
name|td
operator|->
name|td_resolutionunit
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_POSITION
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Position: %g, %g\n"
argument_list|,
name|td
operator|->
name|td_xposition
argument_list|,
name|td
operator|->
name|td_yposition
argument_list|)
expr_stmt|;
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_BITSPERSAMPLE
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Bits/Sample: %u\n"
argument_list|,
name|td
operator|->
name|td_bitspersample
argument_list|)
expr_stmt|;
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_SAMPLEFORMAT
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Sample Format: "
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|td
operator|->
name|td_sampleformat
condition|)
block|{
case|case
name|SAMPLEFORMAT_VOID
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"void\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAMPLEFORMAT_INT
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"signed integer\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAMPLEFORMAT_UINT
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"unsigned integer\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAMPLEFORMAT_IEEEFP
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"IEEE floating point\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAMPLEFORMAT_COMPLEXINT
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"complex signed integer\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|SAMPLEFORMAT_COMPLEXIEEEFP
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"complex IEEE floating point\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%u (0x%x)\n"
argument_list|,
name|td
operator|->
name|td_sampleformat
argument_list|,
name|td
operator|->
name|td_sampleformat
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_COMPRESSION
argument_list|)
condition|)
block|{
specifier|const
name|TIFFCodec
modifier|*
name|c
init|=
name|TIFFFindCODEC
argument_list|(
name|td
operator|->
name|td_compression
argument_list|)
decl_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Compression Scheme: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|c
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%s\n"
argument_list|,
name|c
operator|->
name|name
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%u (0x%x)\n"
argument_list|,
name|td
operator|->
name|td_compression
argument_list|,
name|td
operator|->
name|td_compression
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_PHOTOMETRIC
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Photometric Interpretation: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|td
operator|->
name|td_photometric
operator|<
name|NPHOTONAMES
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%s\n"
argument_list|,
name|photoNames
index|[
name|td
operator|->
name|td_photometric
index|]
argument_list|)
expr_stmt|;
else|else
block|{
switch|switch
condition|(
name|td
operator|->
name|td_photometric
condition|)
block|{
case|case
name|PHOTOMETRIC_LOGL
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"CIE Log2(L)\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PHOTOMETRIC_LOGLUV
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"CIE Log2(L) (u',v')\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%u (0x%x)\n"
argument_list|,
name|td
operator|->
name|td_photometric
argument_list|,
name|td
operator|->
name|td_photometric
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_EXTRASAMPLES
argument_list|)
operator|&&
name|td
operator|->
name|td_extrasamples
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Extra Samples: %u<"
argument_list|,
name|td
operator|->
name|td_extrasamples
argument_list|)
expr_stmt|;
name|sep
operator|=
literal|""
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|td
operator|->
name|td_extrasamples
condition|;
name|i
operator|++
control|)
block|{
switch|switch
condition|(
name|td
operator|->
name|td_sampleinfo
index|[
name|i
index|]
condition|)
block|{
case|case
name|EXTRASAMPLE_UNSPECIFIED
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%sunspecified"
argument_list|,
name|sep
argument_list|)
expr_stmt|;
break|break;
case|case
name|EXTRASAMPLE_ASSOCALPHA
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%sassoc-alpha"
argument_list|,
name|sep
argument_list|)
expr_stmt|;
break|break;
case|case
name|EXTRASAMPLE_UNASSALPHA
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%sunassoc-alpha"
argument_list|,
name|sep
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%s%u (0x%x)"
argument_list|,
name|sep
argument_list|,
name|td
operator|->
name|td_sampleinfo
index|[
name|i
index|]
argument_list|,
name|td
operator|->
name|td_sampleinfo
index|[
name|i
index|]
argument_list|)
expr_stmt|;
break|break;
block|}
name|sep
operator|=
literal|", "
expr_stmt|;
block|}
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|">\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_INKNAMES
argument_list|)
condition|)
block|{
name|char
modifier|*
name|cp
decl_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Ink Names: "
argument_list|)
expr_stmt|;
name|i
operator|=
name|td
operator|->
name|td_samplesperpixel
expr_stmt|;
name|sep
operator|=
literal|""
expr_stmt|;
for|for
control|(
name|cp
operator|=
name|td
operator|->
name|td_inknames
init|;
name|i
operator|>
literal|0
condition|;
name|cp
operator|=
name|strchr
argument_list|(
name|cp
argument_list|,
literal|'\0'
argument_list|)
operator|+
literal|1
operator|,
name|i
operator|--
control|)
block|{
name|fputs
argument_list|(
name|sep
argument_list|,
name|fd
argument_list|)
expr_stmt|;
name|_TIFFprintAscii
argument_list|(
name|fd
argument_list|,
name|cp
argument_list|)
expr_stmt|;
name|sep
operator|=
literal|", "
expr_stmt|;
block|}
name|fputs
argument_list|(
literal|"\n"
argument_list|,
name|fd
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_THRESHHOLDING
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Thresholding: "
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|td
operator|->
name|td_threshholding
condition|)
block|{
case|case
name|THRESHHOLD_BILEVEL
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"bilevel art scan\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|THRESHHOLD_HALFTONE
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"halftone or dithered scan\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|THRESHHOLD_ERRORDIFFUSE
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"error diffused\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%u (0x%x)\n"
argument_list|,
name|td
operator|->
name|td_threshholding
argument_list|,
name|td
operator|->
name|td_threshholding
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_FILLORDER
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  FillOrder: "
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|td
operator|->
name|td_fillorder
condition|)
block|{
case|case
name|FILLORDER_MSB2LSB
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"msb-to-lsb\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|FILLORDER_LSB2MSB
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"lsb-to-msb\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%u (0x%x)\n"
argument_list|,
name|td
operator|->
name|td_fillorder
argument_list|,
name|td
operator|->
name|td_fillorder
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_YCBCRSUBSAMPLING
argument_list|)
condition|)
block|{
comment|/*              * For hacky reasons (see tif_jpeg.c - JPEGFixupTestSubsampling),              * we need to fetch this rather than trust what is in our              * structures.              */
name|uint16
name|subsampling
index|[
literal|2
index|]
decl_stmt|;
name|TIFFGetField
argument_list|(
name|tif
argument_list|,
name|TIFFTAG_YCBCRSUBSAMPLING
argument_list|,
name|subsampling
operator|+
literal|0
argument_list|,
name|subsampling
operator|+
literal|1
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  YCbCr Subsampling: %u, %u\n"
argument_list|,
name|subsampling
index|[
literal|0
index|]
argument_list|,
name|subsampling
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_YCBCRPOSITIONING
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  YCbCr Positioning: "
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|td
operator|->
name|td_ycbcrpositioning
condition|)
block|{
case|case
name|YCBCRPOSITION_CENTERED
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"centered\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|YCBCRPOSITION_COSITED
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"cosited\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%u (0x%x)\n"
argument_list|,
name|td
operator|->
name|td_ycbcrpositioning
argument_list|,
name|td
operator|->
name|td_ycbcrpositioning
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_HALFTONEHINTS
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Halftone Hints: light %u dark %u\n"
argument_list|,
name|td
operator|->
name|td_halftonehints
index|[
literal|0
index|]
argument_list|,
name|td
operator|->
name|td_halftonehints
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_ORIENTATION
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Orientation: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|td
operator|->
name|td_orientation
operator|<
name|NORIENTNAMES
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%s\n"
argument_list|,
name|orientNames
index|[
name|td
operator|->
name|td_orientation
index|]
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%u (0x%x)\n"
argument_list|,
name|td
operator|->
name|td_orientation
argument_list|,
name|td
operator|->
name|td_orientation
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_SAMPLESPERPIXEL
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Samples/Pixel: %u\n"
argument_list|,
name|td
operator|->
name|td_samplesperpixel
argument_list|)
expr_stmt|;
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_ROWSPERSTRIP
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Rows/Strip: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|td
operator|->
name|td_rowsperstrip
operator|==
operator|(
name|uint32
operator|)
operator|-
literal|1
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"(infinite)\n"
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%lu\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|td
operator|->
name|td_rowsperstrip
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_MINSAMPLEVALUE
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Min Sample Value: %u\n"
argument_list|,
name|td
operator|->
name|td_minsamplevalue
argument_list|)
expr_stmt|;
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_MAXSAMPLEVALUE
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Max Sample Value: %u\n"
argument_list|,
name|td
operator|->
name|td_maxsamplevalue
argument_list|)
expr_stmt|;
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_SMINSAMPLEVALUE
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  SMin Sample Value: %g\n"
argument_list|,
name|td
operator|->
name|td_sminsamplevalue
argument_list|)
expr_stmt|;
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_SMAXSAMPLEVALUE
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  SMax Sample Value: %g\n"
argument_list|,
name|td
operator|->
name|td_smaxsamplevalue
argument_list|)
expr_stmt|;
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_PLANARCONFIG
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Planar Configuration: "
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|td
operator|->
name|td_planarconfig
condition|)
block|{
case|case
name|PLANARCONFIG_CONTIG
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"single image plane\n"
argument_list|)
expr_stmt|;
break|break;
case|case
name|PLANARCONFIG_SEPARATE
case|:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"separate image planes\n"
argument_list|)
expr_stmt|;
break|break;
default|default:
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"%u (0x%x)\n"
argument_list|,
name|td
operator|->
name|td_planarconfig
argument_list|,
name|td
operator|->
name|td_planarconfig
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_PAGENUMBER
argument_list|)
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Page Number: %u-%u\n"
argument_list|,
name|td
operator|->
name|td_pagenumber
index|[
literal|0
index|]
argument_list|,
name|td
operator|->
name|td_pagenumber
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_COLORMAP
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Color Map: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|TIFFPRINT_COLORMAP
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|n
operator|=
literal|1L
operator|<<
name|td
operator|->
name|td_bitspersample
expr_stmt|;
for|for
control|(
name|l
operator|=
literal|0
init|;
name|l
operator|<
name|n
condition|;
name|l
operator|++
control|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"   %5lu: %5u %5u %5u\n"
argument_list|,
name|l
argument_list|,
name|td
operator|->
name|td_colormap
index|[
literal|0
index|]
index|[
name|l
index|]
argument_list|,
name|td
operator|->
name|td_colormap
index|[
literal|1
index|]
index|[
name|l
index|]
argument_list|,
name|td
operator|->
name|td_colormap
index|[
literal|2
index|]
index|[
name|l
index|]
argument_list|)
expr_stmt|;
block|}
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"(present)\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_TRANSFERFUNCTION
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Transfer Function: "
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|TIFFPRINT_CURVES
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"\n"
argument_list|)
expr_stmt|;
name|n
operator|=
literal|1L
operator|<<
name|td
operator|->
name|td_bitspersample
expr_stmt|;
for|for
control|(
name|l
operator|=
literal|0
init|;
name|l
operator|<
name|n
condition|;
name|l
operator|++
control|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"    %2lu: %5u"
argument_list|,
name|l
argument_list|,
name|td
operator|->
name|td_transferfunction
index|[
literal|0
index|]
index|[
name|l
index|]
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|1
init|;
name|i
operator|<
name|td
operator|->
name|td_samplesperpixel
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|" %5u"
argument_list|,
name|td
operator|->
name|td_transferfunction
index|[
name|i
index|]
index|[
name|l
index|]
argument_list|)
expr_stmt|;
name|fputc
argument_list|(
literal|'\n'
argument_list|,
name|fd
argument_list|)
expr_stmt|;
block|}
block|}
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"(present)\n"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_SUBIFD
argument_list|)
operator|&&
operator|(
name|td
operator|->
name|td_subifd
operator|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  SubIFD Offsets:"
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|td
operator|->
name|td_nsubifd
condition|;
name|i
operator|++
control|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|" %5lu"
argument_list|,
operator|(
name|long
operator|)
name|td
operator|->
name|td_subifd
index|[
name|i
index|]
argument_list|)
expr_stmt|;
name|fputc
argument_list|(
literal|'\n'
argument_list|,
name|fd
argument_list|)
expr_stmt|;
block|}
comment|/*         ** Custom tag support.         */
block|{
name|int
name|i
decl_stmt|;
name|short
name|count
decl_stmt|;
name|count
operator|=
operator|(
name|short
operator|)
name|TIFFGetTagListCount
argument_list|(
name|tif
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|count
condition|;
name|i
operator|++
control|)
block|{
name|ttag_t
name|tag
init|=
name|TIFFGetTagListEntry
argument_list|(
name|tif
argument_list|,
name|i
argument_list|)
decl_stmt|;
specifier|const
name|TIFFFieldInfo
modifier|*
name|fip
decl_stmt|;
name|uint32
name|value_count
decl_stmt|;
name|int
name|mem_alloc
init|=
literal|0
decl_stmt|;
name|void
modifier|*
name|raw_data
decl_stmt|;
name|fip
operator|=
name|TIFFFieldWithTag
argument_list|(
name|tif
argument_list|,
name|tag
argument_list|)
expr_stmt|;
if|if
condition|(
name|fip
operator|==
name|NULL
condition|)
continue|continue;
if|if
condition|(
name|fip
operator|->
name|field_passcount
condition|)
block|{
if|if
condition|(
name|TIFFGetField
argument_list|(
name|tif
argument_list|,
name|tag
argument_list|,
operator|&
name|value_count
argument_list|,
operator|&
name|raw_data
argument_list|)
operator|!=
literal|1
condition|)
continue|continue;
block|}
else|else
block|{
if|if
condition|(
name|fip
operator|->
name|field_readcount
operator|==
name|TIFF_VARIABLE
operator|||
name|fip
operator|->
name|field_readcount
operator|==
name|TIFF_VARIABLE2
condition|)
name|value_count
operator|=
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|fip
operator|->
name|field_readcount
operator|==
name|TIFF_SPP
condition|)
name|value_count
operator|=
name|td
operator|->
name|td_samplesperpixel
expr_stmt|;
else|else
name|value_count
operator|=
name|fip
operator|->
name|field_readcount
expr_stmt|;
if|if
condition|(
operator|(
name|fip
operator|->
name|field_type
operator|==
name|TIFF_ASCII
operator|||
name|fip
operator|->
name|field_readcount
operator|==
name|TIFF_VARIABLE
operator|||
name|fip
operator|->
name|field_readcount
operator|==
name|TIFF_VARIABLE2
operator|||
name|fip
operator|->
name|field_readcount
operator|==
name|TIFF_SPP
operator|||
name|value_count
operator|>
literal|1
operator|)
operator|&&
name|fip
operator|->
name|field_tag
operator|!=
name|TIFFTAG_PAGENUMBER
operator|&&
name|fip
operator|->
name|field_tag
operator|!=
name|TIFFTAG_HALFTONEHINTS
operator|&&
name|fip
operator|->
name|field_tag
operator|!=
name|TIFFTAG_YCBCRSUBSAMPLING
operator|&&
name|fip
operator|->
name|field_tag
operator|!=
name|TIFFTAG_DOTRANGE
condition|)
block|{
if|if
condition|(
name|TIFFGetField
argument_list|(
name|tif
argument_list|,
name|tag
argument_list|,
operator|&
name|raw_data
argument_list|)
operator|!=
literal|1
condition|)
continue|continue;
block|}
elseif|else
if|if
condition|(
name|fip
operator|->
name|field_tag
operator|!=
name|TIFFTAG_PAGENUMBER
operator|&&
name|fip
operator|->
name|field_tag
operator|!=
name|TIFFTAG_HALFTONEHINTS
operator|&&
name|fip
operator|->
name|field_tag
operator|!=
name|TIFFTAG_YCBCRSUBSAMPLING
operator|&&
name|fip
operator|->
name|field_tag
operator|!=
name|TIFFTAG_DOTRANGE
condition|)
block|{
name|raw_data
operator|=
name|_TIFFmalloc
argument_list|(
name|_TIFFDataSize
argument_list|(
name|fip
operator|->
name|field_type
argument_list|)
operator|*
name|value_count
argument_list|)
expr_stmt|;
name|mem_alloc
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|TIFFGetField
argument_list|(
name|tif
argument_list|,
name|tag
argument_list|,
name|raw_data
argument_list|)
operator|!=
literal|1
condition|)
block|{
name|_TIFFfree
argument_list|(
name|raw_data
argument_list|)
expr_stmt|;
continue|continue;
block|}
block|}
else|else
block|{
comment|/*  				 * XXX: Should be fixed and removed, see the 				 * notes related to TIFFTAG_PAGENUMBER, 				 * TIFFTAG_HALFTONEHINTS, 				 * TIFFTAG_YCBCRSUBSAMPLING and 				 * TIFFTAG_DOTRANGE tags in tif_dir.c. */
name|char
modifier|*
name|tmp
decl_stmt|;
name|raw_data
operator|=
name|_TIFFmalloc
argument_list|(
name|_TIFFDataSize
argument_list|(
name|fip
operator|->
name|field_type
argument_list|)
operator|*
name|value_count
argument_list|)
expr_stmt|;
name|tmp
operator|=
name|raw_data
expr_stmt|;
name|mem_alloc
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|TIFFGetField
argument_list|(
name|tif
argument_list|,
name|tag
argument_list|,
name|tmp
argument_list|,
name|tmp
operator|+
name|_TIFFDataSize
argument_list|(
name|fip
operator|->
name|field_type
argument_list|)
argument_list|)
operator|!=
literal|1
condition|)
block|{
name|_TIFFfree
argument_list|(
name|raw_data
argument_list|)
expr_stmt|;
continue|continue;
block|}
block|}
block|}
comment|/* 		 * Catch the tags which needs to be specially handled and 		 * pretty print them. If tag not handled in 		 * _TIFFPrettyPrintField() fall down and print it as any other 		 * tag. 		 */
if|if
condition|(
name|_TIFFPrettyPrintField
argument_list|(
name|tif
argument_list|,
name|fd
argument_list|,
name|tag
argument_list|,
name|value_count
argument_list|,
name|raw_data
argument_list|)
condition|)
block|{
if|if
condition|(
name|mem_alloc
condition|)
name|_TIFFfree
argument_list|(
name|raw_data
argument_list|)
expr_stmt|;
continue|continue;
block|}
else|else
name|_TIFFPrintField
argument_list|(
name|fd
argument_list|,
name|fip
argument_list|,
name|value_count
argument_list|,
name|raw_data
argument_list|)
expr_stmt|;
if|if
condition|(
name|mem_alloc
condition|)
name|_TIFFfree
argument_list|(
name|raw_data
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|tif
operator|->
name|tif_tagmethods
operator|.
name|printdir
condition|)
call|(
modifier|*
name|tif
operator|->
name|tif_tagmethods
operator|.
name|printdir
call|)
argument_list|(
name|tif
argument_list|,
name|fd
argument_list|,
name|flags
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|flags
operator|&
name|TIFFPRINT_STRIPS
operator|)
operator|&&
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_STRIPOFFSETS
argument_list|)
condition|)
block|{
name|tstrip_t
name|s
decl_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  %lu %s:\n"
argument_list|,
operator|(
name|long
operator|)
name|td
operator|->
name|td_nstrips
argument_list|,
name|isTiled
argument_list|(
name|tif
argument_list|)
condition|?
literal|"Tiles"
else|:
literal|"Strips"
argument_list|)
expr_stmt|;
for|for
control|(
name|s
operator|=
literal|0
init|;
name|s
operator|<
name|td
operator|->
name|td_nstrips
condition|;
name|s
operator|++
control|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"    %3lu: [%8lu, %8lu]\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|s
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|td
operator|->
name|td_stripoffset
index|[
name|s
index|]
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|td
operator|->
name|td_stripbytecount
index|[
name|s
index|]
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
name|void
DECL|function|_TIFFprintAscii
name|_TIFFprintAscii
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|,
specifier|const
name|char
modifier|*
name|cp
parameter_list|)
block|{
for|for
control|(
init|;
operator|*
name|cp
operator|!=
literal|'\0'
condition|;
name|cp
operator|++
control|)
block|{
specifier|const
name|char
modifier|*
name|tp
decl_stmt|;
if|if
condition|(
name|isprint
argument_list|(
operator|(
name|int
operator|)
operator|*
name|cp
argument_list|)
condition|)
block|{
name|fputc
argument_list|(
operator|*
name|cp
argument_list|,
name|fd
argument_list|)
expr_stmt|;
continue|continue;
block|}
for|for
control|(
name|tp
operator|=
literal|"\tt\bb\rr\nn\vv"
init|;
operator|*
name|tp
condition|;
name|tp
operator|++
control|)
if|if
condition|(
operator|*
name|tp
operator|++
operator|==
operator|*
name|cp
condition|)
break|break;
if|if
condition|(
operator|*
name|tp
condition|)
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"\\%c"
argument_list|,
operator|*
name|tp
argument_list|)
expr_stmt|;
else|else
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"\\%03o"
argument_list|,
operator|*
name|cp
operator|&
literal|0xff
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
name|void
DECL|function|_TIFFprintAsciiTag
name|_TIFFprintAsciiTag
parameter_list|(
name|FILE
modifier|*
name|fd
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|,
specifier|const
name|char
modifier|*
name|value
parameter_list|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  %s: \""
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|_TIFFprintAscii
argument_list|(
name|fd
argument_list|,
name|value
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"\"\n"
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|/* vim: set ts=8 sts=8 sw=8 noet: */
end_comment
end_unit
