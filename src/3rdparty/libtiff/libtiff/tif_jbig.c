begin_unit
begin_comment
comment|/* $Id: tif_jbig.c,v 1.2.2.2 2008-10-21 13:13:07 dron Exp $ */
end_comment
begin_comment
comment|/*  * Copyright (c) 1988-1997 Sam Leffler  * Copyright (c) 1991-1997 Silicon Graphics, Inc.  *  * Permission to use, copy, modify, distribute, and sell this software and   * its documentation for any purpose is hereby granted without fee, provided  * that (i) the above copyright notices and this permission notice appear in  * all copies of the software and related documentation, and (ii) the names of  * Sam Leffler and Silicon Graphics may not be used in any advertising or  * publicity relating to the software without the specific, prior written  * permission of Sam Leffler and Silicon Graphics.  *   * THE SOFTWARE IS PROVIDED "AS-IS" AND WITHOUT WARRANTY OF ANY KIND,   * EXPRESS, IMPLIED OR OTHERWISE, INCLUDING WITHOUT LIMITATION, ANY   * WARRANTY OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.    *   * IN NO EVENT SHALL SAM LEFFLER OR SILICON GRAPHICS BE LIABLE FOR  * ANY SPECIAL, INCIDENTAL, INDIRECT OR CONSEQUENTIAL DAMAGES OF ANY KIND,  * OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS,  * WHETHER OR NOT ADVISED OF THE POSSIBILITY OF DAMAGE, AND ON ANY THEORY OF   * LIABILITY, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE   * OF THIS SOFTWARE.  */
end_comment
begin_comment
comment|/*  * TIFF Library.  *  * JBIG Compression Algorithm Support.  * Contributed by Lee Howard<faxguy@deanox.com>  *   */
end_comment
begin_include
include|#
directive|include
file|"tiffiop.h"
end_include
begin_ifdef
ifdef|#
directive|ifdef
name|JBIG_SUPPORT
end_ifdef
begin_include
include|#
directive|include
file|"jbig.h"
end_include
begin_typedef
typedef|typedef
struct|struct
block|{
DECL|member|recvparams
name|uint32
name|recvparams
decl_stmt|;
comment|/* encoded Class 2 session params             */
DECL|member|subaddress
name|char
modifier|*
name|subaddress
decl_stmt|;
comment|/* subaddress string                          */
DECL|member|recvtime
name|uint32
name|recvtime
decl_stmt|;
comment|/* time spend receiving in seconds            */
DECL|member|faxdcs
name|char
modifier|*
name|faxdcs
decl_stmt|;
comment|/* encoded fax parameters (DCS, Table 2/T.30) */
DECL|member|vgetparent
name|TIFFVGetMethod
name|vgetparent
decl_stmt|;
DECL|member|vsetparent
name|TIFFVSetMethod
name|vsetparent
decl_stmt|;
block|}
DECL|typedef|JBIGState
name|JBIGState
typedef|;
end_typedef
begin_define
DECL|macro|GetJBIGState
define|#
directive|define
name|GetJBIGState
parameter_list|(
name|tif
parameter_list|)
value|((JBIGState*)(tif)->tif_data)
end_define
begin_define
DECL|macro|FIELD_RECVPARAMS
define|#
directive|define
name|FIELD_RECVPARAMS
value|(FIELD_CODEC+0)
end_define
begin_define
DECL|macro|FIELD_SUBADDRESS
define|#
directive|define
name|FIELD_SUBADDRESS
value|(FIELD_CODEC+1)
end_define
begin_define
DECL|macro|FIELD_RECVTIME
define|#
directive|define
name|FIELD_RECVTIME
value|(FIELD_CODEC+2)
end_define
begin_define
DECL|macro|FIELD_FAXDCS
define|#
directive|define
name|FIELD_FAXDCS
value|(FIELD_CODEC+3)
end_define
begin_decl_stmt
DECL|variable|jbigFieldInfo
specifier|static
specifier|const
name|TIFFFieldInfo
name|jbigFieldInfo
index|[]
init|=
block|{
block|{
name|TIFFTAG_FAXRECVPARAMS
block|,
literal|1
block|,
literal|1
block|,
name|TIFF_LONG
block|,
name|FIELD_RECVPARAMS
block|,
name|TRUE
block|,
name|FALSE
block|,
literal|"FaxRecvParams"
block|}
block|,
block|{
name|TIFFTAG_FAXSUBADDRESS
block|,
operator|-
literal|1
block|,
operator|-
literal|1
block|,
name|TIFF_ASCII
block|,
name|FIELD_SUBADDRESS
block|,
name|TRUE
block|,
name|FALSE
block|,
literal|"FaxSubAddress"
block|}
block|,
block|{
name|TIFFTAG_FAXRECVTIME
block|,
literal|1
block|,
literal|1
block|,
name|TIFF_LONG
block|,
name|FIELD_RECVTIME
block|,
name|TRUE
block|,
name|FALSE
block|,
literal|"FaxRecvTime"
block|}
block|,
block|{
name|TIFFTAG_FAXDCS
block|,
operator|-
literal|1
block|,
operator|-
literal|1
block|,
name|TIFF_ASCII
block|,
name|FIELD_FAXDCS
block|,
name|TRUE
block|,
name|FALSE
block|,
literal|"FaxDcs"
block|}
block|, }
decl_stmt|;
end_decl_stmt
begin_function
DECL|function|JBIGSetupDecode
specifier|static
name|int
name|JBIGSetupDecode
parameter_list|(
name|TIFF
modifier|*
name|tif
parameter_list|)
block|{
if|if
condition|(
name|TIFFNumberOfStrips
argument_list|(
name|tif
argument_list|)
operator|!=
literal|1
condition|)
block|{
name|TIFFError
argument_list|(
literal|"JBIG"
argument_list|,
literal|"Multistrip images not supported in decoder"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function
begin_function
DECL|function|JBIGDecode
specifier|static
name|int
name|JBIGDecode
parameter_list|(
name|TIFF
modifier|*
name|tif
parameter_list|,
name|tidata_t
name|buffer
parameter_list|,
name|tsize_t
name|size
parameter_list|,
name|tsample_t
name|s
parameter_list|)
block|{
name|struct
name|jbg_dec_state
name|decoder
decl_stmt|;
name|int
name|decodeStatus
init|=
literal|0
decl_stmt|;
name|unsigned
name|char
modifier|*
name|pImage
init|=
name|NULL
decl_stmt|;
operator|(
name|void
operator|)
name|size
operator|,
operator|(
name|void
operator|)
name|s
expr_stmt|;
if|if
condition|(
name|isFillOrder
argument_list|(
name|tif
argument_list|,
name|tif
operator|->
name|tif_dir
operator|.
name|td_fillorder
argument_list|)
condition|)
block|{
name|TIFFReverseBits
argument_list|(
name|tif
operator|->
name|tif_rawdata
argument_list|,
name|tif
operator|->
name|tif_rawdatasize
argument_list|)
expr_stmt|;
block|}
name|jbg_dec_init
argument_list|(
operator|&
name|decoder
argument_list|)
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|HAVE_JBG_NEWLEN
argument_list|)
name|jbg_newlen
argument_list|(
name|tif
operator|->
name|tif_rawdata
argument_list|,
name|tif
operator|->
name|tif_rawdatasize
argument_list|)
expr_stmt|;
comment|/*          * I do not check the return status of jbg_newlen because even if this          * function fails it does not necessarily mean that decoding the image          * will fail.  It is generally only needed for received fax images          * that do not contain the actual length of the image in the BIE          * header.  I do not log when an error occurs because that will cause          * problems when converting JBIG encoded TIFF's to           * PostScript.  As long as the actual image length is contained in the          * BIE header jbg_dec_in should succeed.          */
endif|#
directive|endif
comment|/* HAVE_JBG_NEWLEN */
name|decodeStatus
operator|=
name|jbg_dec_in
argument_list|(
operator|&
name|decoder
argument_list|,
name|tif
operator|->
name|tif_rawdata
argument_list|,
name|tif
operator|->
name|tif_rawdatasize
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
if|if
condition|(
name|JBG_EOK
operator|!=
name|decodeStatus
condition|)
block|{
comment|/* 		 * XXX: JBG_EN constant was defined in pre-2.0 releases of the 		 * JBIG-KIT. Since the 2.0 the error reporting functions were 		 * changed. We will handle both cases here. 		 */
name|TIFFError
argument_list|(
literal|"JBIG"
argument_list|,
literal|"Error (%d) decoding: %s"
argument_list|,
name|decodeStatus
argument_list|,
if|#
directive|if
name|defined
argument_list|(
name|JBG_EN
argument_list|)
name|jbg_strerror
argument_list|(
argument|decodeStatus
argument_list|,
argument|JBG_EN
argument_list|)
else|#
directive|else
name|jbg_strerror
argument_list|(
name|decodeStatus
argument_list|)
endif|#
directive|endif
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|pImage
operator|=
name|jbg_dec_getimage
argument_list|(
operator|&
name|decoder
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|_TIFFmemcpy
argument_list|(
name|buffer
argument_list|,
name|pImage
argument_list|,
name|jbg_dec_getsize
argument_list|(
operator|&
name|decoder
argument_list|)
argument_list|)
expr_stmt|;
name|jbg_dec_free
argument_list|(
operator|&
name|decoder
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function
begin_function
DECL|function|JBIGSetupEncode
specifier|static
name|int
name|JBIGSetupEncode
parameter_list|(
name|TIFF
modifier|*
name|tif
parameter_list|)
block|{
if|if
condition|(
name|TIFFNumberOfStrips
argument_list|(
name|tif
argument_list|)
operator|!=
literal|1
condition|)
block|{
name|TIFFError
argument_list|(
literal|"JBIG"
argument_list|,
literal|"Multistrip images not supported in encoder"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
literal|1
return|;
block|}
end_function
begin_function
DECL|function|JBIGCopyEncodedData
specifier|static
name|int
name|JBIGCopyEncodedData
parameter_list|(
name|TIFF
modifier|*
name|tif
parameter_list|,
name|tidata_t
name|pp
parameter_list|,
name|tsize_t
name|cc
parameter_list|,
name|tsample_t
name|s
parameter_list|)
block|{
operator|(
name|void
operator|)
name|s
expr_stmt|;
while|while
condition|(
name|cc
operator|>
literal|0
condition|)
block|{
name|tsize_t
name|n
init|=
name|cc
decl_stmt|;
if|if
condition|(
name|tif
operator|->
name|tif_rawcc
operator|+
name|n
operator|>
name|tif
operator|->
name|tif_rawdatasize
condition|)
block|{
name|n
operator|=
name|tif
operator|->
name|tif_rawdatasize
operator|-
name|tif
operator|->
name|tif_rawcc
expr_stmt|;
block|}
name|assert
argument_list|(
name|n
operator|>
literal|0
argument_list|)
expr_stmt|;
name|_TIFFmemcpy
argument_list|(
name|tif
operator|->
name|tif_rawcp
argument_list|,
name|pp
argument_list|,
name|n
argument_list|)
expr_stmt|;
name|tif
operator|->
name|tif_rawcp
operator|+=
name|n
expr_stmt|;
name|tif
operator|->
name|tif_rawcc
operator|+=
name|n
expr_stmt|;
name|pp
operator|+=
name|n
expr_stmt|;
name|cc
operator|-=
name|n
expr_stmt|;
if|if
condition|(
name|tif
operator|->
name|tif_rawcc
operator|>=
name|tif
operator|->
name|tif_rawdatasize
operator|&&
operator|!
name|TIFFFlushData1
argument_list|(
name|tif
argument_list|)
condition|)
block|{
return|return
operator|(
operator|-
literal|1
operator|)
return|;
block|}
block|}
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function
begin_function
DECL|function|JBIGOutputBie
specifier|static
name|void
name|JBIGOutputBie
parameter_list|(
name|unsigned
name|char
modifier|*
name|buffer
parameter_list|,
name|size_t
name|len
parameter_list|,
name|void
modifier|*
name|userData
parameter_list|)
block|{
name|TIFF
modifier|*
name|tif
init|=
operator|(
name|TIFF
operator|*
operator|)
name|userData
decl_stmt|;
if|if
condition|(
name|isFillOrder
argument_list|(
name|tif
argument_list|,
name|tif
operator|->
name|tif_dir
operator|.
name|td_fillorder
argument_list|)
condition|)
block|{
name|TIFFReverseBits
argument_list|(
name|buffer
argument_list|,
name|len
argument_list|)
expr_stmt|;
block|}
name|JBIGCopyEncodedData
argument_list|(
name|tif
argument_list|,
name|buffer
argument_list|,
name|len
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|JBIGEncode
specifier|static
name|int
name|JBIGEncode
parameter_list|(
name|TIFF
modifier|*
name|tif
parameter_list|,
name|tidata_t
name|buffer
parameter_list|,
name|tsize_t
name|size
parameter_list|,
name|tsample_t
name|s
parameter_list|)
block|{
name|TIFFDirectory
modifier|*
name|dir
init|=
operator|&
name|tif
operator|->
name|tif_dir
decl_stmt|;
name|struct
name|jbg_enc_state
name|encoder
decl_stmt|;
operator|(
name|void
operator|)
name|size
operator|,
operator|(
name|void
operator|)
name|s
expr_stmt|;
name|jbg_enc_init
argument_list|(
operator|&
name|encoder
argument_list|,
name|dir
operator|->
name|td_imagewidth
argument_list|,
name|dir
operator|->
name|td_imagelength
argument_list|,
literal|1
argument_list|,
operator|&
name|buffer
argument_list|,
name|JBIGOutputBie
argument_list|,
name|tif
argument_list|)
expr_stmt|;
comment|/*           * jbg_enc_out does the "real" encoding.  As data is encoded,          * JBIGOutputBie is called, which writes the data to the directory.          */
name|jbg_enc_out
argument_list|(
operator|&
name|encoder
argument_list|)
expr_stmt|;
name|jbg_enc_free
argument_list|(
operator|&
name|encoder
argument_list|)
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function
begin_function
DECL|function|JBIGCleanup
specifier|static
name|void
name|JBIGCleanup
parameter_list|(
name|TIFF
modifier|*
name|tif
parameter_list|)
block|{
name|JBIGState
modifier|*
name|sp
init|=
name|GetJBIGState
argument_list|(
name|tif
argument_list|)
decl_stmt|;
name|assert
argument_list|(
name|sp
operator|!=
literal|0
argument_list|)
expr_stmt|;
name|tif
operator|->
name|tif_tagmethods
operator|.
name|vgetfield
operator|=
name|sp
operator|->
name|vgetparent
expr_stmt|;
name|tif
operator|->
name|tif_tagmethods
operator|.
name|vsetfield
operator|=
name|sp
operator|->
name|vsetparent
expr_stmt|;
name|_TIFFfree
argument_list|(
name|tif
operator|->
name|tif_data
argument_list|)
expr_stmt|;
name|tif
operator|->
name|tif_data
operator|=
name|NULL
expr_stmt|;
name|_TIFFSetDefaultCompressionState
argument_list|(
name|tif
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|JBIGPrintDir
specifier|static
name|void
name|JBIGPrintDir
parameter_list|(
name|TIFF
modifier|*
name|tif
parameter_list|,
name|FILE
modifier|*
name|fd
parameter_list|,
name|long
name|flags
parameter_list|)
block|{
name|JBIGState
modifier|*
name|codec
init|=
name|GetJBIGState
argument_list|(
name|tif
argument_list|)
decl_stmt|;
operator|(
name|void
operator|)
name|flags
expr_stmt|;
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_RECVPARAMS
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Fax Receive Parameters: %08lx\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|codec
operator|->
name|recvparams
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_SUBADDRESS
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Fax SubAddress: %s\n"
argument_list|,
name|codec
operator|->
name|subaddress
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_RECVTIME
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Fax Receive Time: %lu secs\n"
argument_list|,
operator|(
name|unsigned
name|long
operator|)
name|codec
operator|->
name|recvtime
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|TIFFFieldSet
argument_list|(
name|tif
argument_list|,
name|FIELD_FAXDCS
argument_list|)
condition|)
block|{
name|fprintf
argument_list|(
name|fd
argument_list|,
literal|"  Fax DCS: %s\n"
argument_list|,
name|codec
operator|->
name|faxdcs
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|JBIGVGetField
specifier|static
name|int
name|JBIGVGetField
parameter_list|(
name|TIFF
modifier|*
name|tif
parameter_list|,
name|ttag_t
name|tag
parameter_list|,
name|va_list
name|ap
parameter_list|)
block|{
name|JBIGState
modifier|*
name|codec
init|=
name|GetJBIGState
argument_list|(
name|tif
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|tag
condition|)
block|{
case|case
name|TIFFTAG_FAXRECVPARAMS
case|:
operator|*
name|va_arg
argument_list|(
name|ap
argument_list|,
name|uint32
operator|*
argument_list|)
operator|=
name|codec
operator|->
name|recvparams
expr_stmt|;
break|break;
case|case
name|TIFFTAG_FAXSUBADDRESS
case|:
operator|*
name|va_arg
argument_list|(
name|ap
argument_list|,
name|char
operator|*
operator|*
argument_list|)
operator|=
name|codec
operator|->
name|subaddress
expr_stmt|;
break|break;
case|case
name|TIFFTAG_FAXRECVTIME
case|:
operator|*
name|va_arg
argument_list|(
name|ap
argument_list|,
name|uint32
operator|*
argument_list|)
operator|=
name|codec
operator|->
name|recvtime
expr_stmt|;
break|break;
case|case
name|TIFFTAG_FAXDCS
case|:
operator|*
name|va_arg
argument_list|(
name|ap
argument_list|,
name|char
operator|*
operator|*
argument_list|)
operator|=
name|codec
operator|->
name|faxdcs
expr_stmt|;
break|break;
default|default:
return|return
call|(
modifier|*
name|codec
operator|->
name|vgetparent
call|)
argument_list|(
name|tif
argument_list|,
name|tag
argument_list|,
name|ap
argument_list|)
return|;
block|}
return|return
literal|1
return|;
block|}
end_function
begin_function
DECL|function|JBIGVSetField
specifier|static
name|int
name|JBIGVSetField
parameter_list|(
name|TIFF
modifier|*
name|tif
parameter_list|,
name|ttag_t
name|tag
parameter_list|,
name|va_list
name|ap
parameter_list|)
block|{
name|JBIGState
modifier|*
name|codec
init|=
name|GetJBIGState
argument_list|(
name|tif
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|tag
condition|)
block|{
case|case
name|TIFFTAG_FAXRECVPARAMS
case|:
name|codec
operator|->
name|recvparams
operator|=
name|va_arg
argument_list|(
name|ap
argument_list|,
name|uint32
argument_list|)
expr_stmt|;
break|break;
case|case
name|TIFFTAG_FAXSUBADDRESS
case|:
name|_TIFFsetString
argument_list|(
operator|&
name|codec
operator|->
name|subaddress
argument_list|,
name|va_arg
argument_list|(
name|ap
argument_list|,
name|char
operator|*
argument_list|)
argument_list|)
expr_stmt|;
break|break;
case|case
name|TIFFTAG_FAXRECVTIME
case|:
name|codec
operator|->
name|recvtime
operator|=
name|va_arg
argument_list|(
name|ap
argument_list|,
name|uint32
argument_list|)
expr_stmt|;
break|break;
case|case
name|TIFFTAG_FAXDCS
case|:
name|_TIFFsetString
argument_list|(
operator|&
name|codec
operator|->
name|faxdcs
argument_list|,
name|va_arg
argument_list|(
name|ap
argument_list|,
name|char
operator|*
argument_list|)
argument_list|)
expr_stmt|;
break|break;
default|default:
return|return
call|(
modifier|*
name|codec
operator|->
name|vsetparent
call|)
argument_list|(
name|tif
argument_list|,
name|tag
argument_list|,
name|ap
argument_list|)
return|;
block|}
name|TIFFSetFieldBit
argument_list|(
name|tif
argument_list|,
name|_TIFFFieldWithTag
argument_list|(
name|tif
argument_list|,
name|tag
argument_list|)
operator|->
name|field_bit
argument_list|)
expr_stmt|;
name|tif
operator|->
name|tif_flags
operator||=
name|TIFF_DIRTYDIRECT
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function
begin_function
DECL|function|TIFFInitJBIG
name|int
name|TIFFInitJBIG
parameter_list|(
name|TIFF
modifier|*
name|tif
parameter_list|,
name|int
name|scheme
parameter_list|)
block|{
name|JBIGState
modifier|*
name|codec
init|=
name|NULL
decl_stmt|;
name|assert
argument_list|(
name|scheme
operator|==
name|COMPRESSION_JBIG
argument_list|)
expr_stmt|;
comment|/* 	 * Merge codec-specific tag information. 	 */
if|if
condition|(
operator|!
name|_TIFFMergeFieldInfo
argument_list|(
name|tif
argument_list|,
name|jbigFieldInfo
argument_list|,
name|TIFFArrayCount
argument_list|(
name|jbigFieldInfo
argument_list|)
argument_list|)
condition|)
block|{
name|TIFFErrorExt
argument_list|(
name|tif
operator|->
name|tif_clientdata
argument_list|,
literal|"TIFFInitJBIG"
argument_list|,
literal|"Merging JBIG codec-specific tags failed"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
comment|/* Allocate memory for the JBIGState structure.*/
name|tif
operator|->
name|tif_data
operator|=
operator|(
name|tdata_t
operator|)
name|_TIFFmalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|JBIGState
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|tif
operator|->
name|tif_data
operator|==
name|NULL
condition|)
block|{
name|TIFFError
argument_list|(
literal|"TIFFInitJBIG"
argument_list|,
literal|"Not enough memory for JBIGState"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|_TIFFmemset
argument_list|(
name|tif
operator|->
name|tif_data
argument_list|,
literal|0
argument_list|,
sizeof|sizeof
argument_list|(
name|JBIGState
argument_list|)
argument_list|)
expr_stmt|;
name|codec
operator|=
name|GetJBIGState
argument_list|(
name|tif
argument_list|)
expr_stmt|;
comment|/* Initialize codec private fields */
name|codec
operator|->
name|recvparams
operator|=
literal|0
expr_stmt|;
name|codec
operator|->
name|subaddress
operator|=
name|NULL
expr_stmt|;
name|codec
operator|->
name|faxdcs
operator|=
name|NULL
expr_stmt|;
name|codec
operator|->
name|recvtime
operator|=
literal|0
expr_stmt|;
comment|/*  	 * Override parent get/set field methods. 	 */
name|codec
operator|->
name|vgetparent
operator|=
name|tif
operator|->
name|tif_tagmethods
operator|.
name|vgetfield
expr_stmt|;
name|codec
operator|->
name|vsetparent
operator|=
name|tif
operator|->
name|tif_tagmethods
operator|.
name|vsetfield
expr_stmt|;
name|tif
operator|->
name|tif_tagmethods
operator|.
name|vgetfield
operator|=
name|JBIGVGetField
expr_stmt|;
name|tif
operator|->
name|tif_tagmethods
operator|.
name|vsetfield
operator|=
name|JBIGVSetField
expr_stmt|;
name|tif
operator|->
name|tif_tagmethods
operator|.
name|printdir
operator|=
name|JBIGPrintDir
expr_stmt|;
comment|/*          * These flags are set so the JBIG Codec can control when to reverse          * bits and when not to and to allow the jbig decoder and bit reverser          * to write to memory when necessary.          */
name|tif
operator|->
name|tif_flags
operator||=
name|TIFF_NOBITREV
expr_stmt|;
name|tif
operator|->
name|tif_flags
operator|&=
operator|~
name|TIFF_MAPPED
expr_stmt|;
comment|/* Setup the function pointers for encode, decode, and cleanup. */
name|tif
operator|->
name|tif_setupdecode
operator|=
name|JBIGSetupDecode
expr_stmt|;
name|tif
operator|->
name|tif_decodestrip
operator|=
name|JBIGDecode
expr_stmt|;
name|tif
operator|->
name|tif_setupencode
operator|=
name|JBIGSetupEncode
expr_stmt|;
name|tif
operator|->
name|tif_encodestrip
operator|=
name|JBIGEncode
expr_stmt|;
name|tif
operator|->
name|tif_cleanup
operator|=
name|JBIGCleanup
expr_stmt|;
return|return
literal|1
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* JBIG_SUPPORT */
end_comment
begin_comment
comment|/* vim: set ts=8 sts=8 sw=8 noet: */
end_comment
end_unit
