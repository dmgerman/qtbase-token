begin_unit
begin_comment
comment|/* $Header: /cvs/maptools/cvsroot/libtiff/libtiff/tif_extension.c,v 1.4 2004/10/02 13:29:41 dron Exp $ */
end_comment
begin_comment
comment|/*  * Copyright (c) 1988-1997 Sam Leffler  * Copyright (c) 1991-1997 Silicon Graphics, Inc.  *  * Permission to use, copy, modify, distribute, and sell this software and   * its documentation for any purpose is hereby granted without fee, provided  * that (i) the above copyright notices and this permission notice appear in  * all copies of the software and related documentation, and (ii) the names of  * Sam Leffler and Silicon Graphics may not be used in any advertising or  * publicity relating to the software without the specific, prior written  * permission of Sam Leffler and Silicon Graphics.  *   * THE SOFTWARE IS PROVIDED "AS-IS" AND WITHOUT WARRANTY OF ANY KIND,   * EXPRESS, IMPLIED OR OTHERWISE, INCLUDING WITHOUT LIMITATION, ANY   * WARRANTY OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.    *   * IN NO EVENT SHALL SAM LEFFLER OR SILICON GRAPHICS BE LIABLE FOR  * ANY SPECIAL, INCIDENTAL, INDIRECT OR CONSEQUENTIAL DAMAGES OF ANY KIND,  * OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS,  * WHETHER OR NOT ADVISED OF THE POSSIBILITY OF DAMAGE, AND ON ANY THEORY OF   * LIABILITY, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE   * OF THIS SOFTWARE.  */
end_comment
begin_comment
comment|/*  * TIFF Library.  *  * Various routines support external extension of the tag set, and other  * application extension capabilities.   */
end_comment
begin_include
include|#
directive|include
file|"tiffiop.h"
end_include
begin_function
DECL|function|TIFFGetTagListCount
name|int
name|TIFFGetTagListCount
parameter_list|(
name|TIFF
modifier|*
name|tif
parameter_list|)
block|{
name|TIFFDirectory
modifier|*
name|td
init|=
operator|&
name|tif
operator|->
name|tif_dir
decl_stmt|;
return|return
name|td
operator|->
name|td_customValueCount
return|;
block|}
end_function
begin_function
DECL|function|TIFFGetTagListEntry
name|ttag_t
name|TIFFGetTagListEntry
parameter_list|(
name|TIFF
modifier|*
name|tif
parameter_list|,
name|int
name|tag_index
parameter_list|)
block|{
name|TIFFDirectory
modifier|*
name|td
init|=
operator|&
name|tif
operator|->
name|tif_dir
decl_stmt|;
if|if
condition|(
name|tag_index
operator|<
literal|0
operator|||
name|tag_index
operator|>=
name|td
operator|->
name|td_customValueCount
condition|)
return|return
operator|(
name|ttag_t
operator|)
operator|-
literal|1
return|;
else|else
return|return
name|td
operator|->
name|td_customValues
index|[
name|tag_index
index|]
operator|.
name|info
operator|->
name|field_tag
return|;
block|}
end_function
begin_comment
comment|/* ** This provides read/write access to the TIFFTagMethods within the TIFF ** structure to application code without giving access to the private ** TIFF structure. */
end_comment
begin_function
DECL|function|TIFFAccessTagMethods
name|TIFFTagMethods
modifier|*
name|TIFFAccessTagMethods
parameter_list|(
name|TIFF
modifier|*
name|tif
parameter_list|)
block|{
return|return
operator|&
operator|(
name|tif
operator|->
name|tif_tagmethods
operator|)
return|;
block|}
end_function
begin_function
DECL|function|TIFFGetClientInfo
name|void
modifier|*
name|TIFFGetClientInfo
parameter_list|(
name|TIFF
modifier|*
name|tif
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|)
block|{
name|TIFFClientInfoLink
modifier|*
name|link
init|=
name|tif
operator|->
name|tif_clientinfo
decl_stmt|;
while|while
condition|(
name|link
operator|!=
name|NULL
operator|&&
name|strcmp
argument_list|(
name|link
operator|->
name|name
argument_list|,
name|name
argument_list|)
operator|!=
literal|0
condition|)
name|link
operator|=
name|link
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|link
operator|!=
name|NULL
condition|)
return|return
name|link
operator|->
name|data
return|;
else|else
return|return
name|NULL
return|;
block|}
end_function
begin_function
DECL|function|TIFFSetClientInfo
name|void
name|TIFFSetClientInfo
parameter_list|(
name|TIFF
modifier|*
name|tif
parameter_list|,
name|void
modifier|*
name|data
parameter_list|,
specifier|const
name|char
modifier|*
name|name
parameter_list|)
block|{
name|TIFFClientInfoLink
modifier|*
name|link
init|=
name|tif
operator|->
name|tif_clientinfo
decl_stmt|;
comment|/*     ** Do we have an existing link with this name?  If so, just     ** set it.     */
while|while
condition|(
name|link
operator|!=
name|NULL
operator|&&
name|strcmp
argument_list|(
name|link
operator|->
name|name
argument_list|,
name|name
argument_list|)
operator|!=
literal|0
condition|)
name|link
operator|=
name|link
operator|->
name|next
expr_stmt|;
if|if
condition|(
name|link
operator|!=
name|NULL
condition|)
block|{
name|link
operator|->
name|data
operator|=
name|data
expr_stmt|;
return|return;
block|}
comment|/*     ** Create a new link.     */
name|link
operator|=
operator|(
name|TIFFClientInfoLink
operator|*
operator|)
name|_TIFFmalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|TIFFClientInfoLink
argument_list|)
argument_list|)
expr_stmt|;
name|assert
argument_list|(
name|link
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|link
operator|->
name|next
operator|=
name|tif
operator|->
name|tif_clientinfo
expr_stmt|;
name|link
operator|->
name|name
operator|=
operator|(
name|char
operator|*
operator|)
name|_TIFFmalloc
argument_list|(
name|strlen
argument_list|(
name|name
argument_list|)
operator|+
literal|1
argument_list|)
expr_stmt|;
name|assert
argument_list|(
name|link
operator|->
name|name
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|strcpy
argument_list|(
name|link
operator|->
name|name
argument_list|,
name|name
argument_list|)
expr_stmt|;
name|link
operator|->
name|data
operator|=
name|data
expr_stmt|;
name|tif
operator|->
name|tif_clientinfo
operator|=
name|link
expr_stmt|;
block|}
end_function
end_unit
