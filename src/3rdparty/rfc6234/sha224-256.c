begin_unit
begin_comment
comment|/************************* sha224-256.c ************************/
end_comment
begin_comment
comment|/***************** See RFC 6234 for details. *******************/
end_comment
begin_comment
comment|/* Copyright (c) 2011 IETF Trust and the persons identified as */
end_comment
begin_comment
comment|/* authors of the code.  All rights reserved.                  */
end_comment
begin_comment
comment|/* See sha.h for terms of use and redistribution.              */
end_comment
begin_comment
comment|/*  * Description:  *   This file implements the Secure Hash Algorithms SHA-224 and  *   SHA-256 as defined in the U.S. National Institute of Standards  *   and Technology Federal Information Processing Standards  *   Publication (FIPS PUB) 180-3 published in October 2008  *   and formerly defined in its predecessors, FIPS PUB 180-1  *   and FIP PUB 180-2.  *  *   A combined document showing all algorithms is available at  *       http://csrc.nist.gov/publications/fips/  *              fips180-3/fips180-3_final.pdf  *  *   The SHA-224 and SHA-256 algorithms produce 224-bit and 256-bit  *   message digests for a given data stream.  It should take about  *   2**n steps to find a message with the same digest as a given  *   message and 2**(n/2) to find any two messages with the same  *   digest, when n is the digest size in bits.  Therefore, this  *   algorithm can serve as a means of providing a  *   "fingerprint" for a message.  *  * Portability Issues:  *   SHA-224 and SHA-256 are defined in terms of 32-bit "words".  *   This code uses<stdint.h> (included via "sha.h") to define 32-  *   and 8-bit unsigned integer types.  If your C compiler does not  *   support 32-bit unsigned integers, this code is not  *   appropriate.  *  * Caveats:  *   SHA-224 and SHA-256 are designed to work with messages less  *   than 2^64 bits long.  This implementation uses SHA224/256Input()  *   to hash the bits that are a multiple of the size of an 8-bit  *   octet, and then optionally uses SHA224/256FinalBits()  *   to hash the final few bits of the input.  */
end_comment
begin_include
include|#
directive|include
file|"sha.h"
end_include
begin_include
include|#
directive|include
file|"sha-private.h"
end_include
begin_comment
comment|/* Define the SHA shift, rotate left, and rotate right macros */
end_comment
begin_define
DECL|macro|SHA256_SHR
define|#
directive|define
name|SHA256_SHR
parameter_list|(
name|bits
parameter_list|,
name|word
parameter_list|)
value|((word)>> (bits))
end_define
begin_define
DECL|macro|SHA256_ROTL
define|#
directive|define
name|SHA256_ROTL
parameter_list|(
name|bits
parameter_list|,
name|word
parameter_list|)
define|\
value|(((word)<< (bits)) | ((word)>> (32-(bits))))
end_define
begin_define
DECL|macro|SHA256_ROTR
define|#
directive|define
name|SHA256_ROTR
parameter_list|(
name|bits
parameter_list|,
name|word
parameter_list|)
define|\
value|(((word)>> (bits)) | ((word)<< (32-(bits))))
end_define
begin_comment
comment|/* Define the SHA SIGMA and sigma macros */
end_comment
begin_define
DECL|macro|SHA256_SIGMA0
define|#
directive|define
name|SHA256_SIGMA0
parameter_list|(
name|word
parameter_list|)
define|\
value|(SHA256_ROTR( 2,word) ^ SHA256_ROTR(13,word) ^ SHA256_ROTR(22,word))
end_define
begin_define
DECL|macro|SHA256_SIGMA1
define|#
directive|define
name|SHA256_SIGMA1
parameter_list|(
name|word
parameter_list|)
define|\
value|(SHA256_ROTR( 6,word) ^ SHA256_ROTR(11,word) ^ SHA256_ROTR(25,word))
end_define
begin_define
DECL|macro|SHA256_sigma0
define|#
directive|define
name|SHA256_sigma0
parameter_list|(
name|word
parameter_list|)
define|\
value|(SHA256_ROTR( 7,word) ^ SHA256_ROTR(18,word) ^ SHA256_SHR( 3,word))
end_define
begin_define
DECL|macro|SHA256_sigma1
define|#
directive|define
name|SHA256_sigma1
parameter_list|(
name|word
parameter_list|)
define|\
value|(SHA256_ROTR(17,word) ^ SHA256_ROTR(19,word) ^ SHA256_SHR(10,word))
end_define
begin_comment
comment|/*  * Add "length" to the length.  * Set Corrupted when overflow has occurred.  */
end_comment
begin_comment
comment|/* addTemp commented out by Nokia, static variables are not thread-safe */
end_comment
begin_comment
comment|/* static uint32_t addTemp; */
end_comment
begin_comment
comment|/* 'M' appended to Macro name by Nokia */
end_comment
begin_define
DECL|macro|SHA224_256AddLengthM
define|#
directive|define
name|SHA224_256AddLengthM
parameter_list|(
name|context
parameter_list|,
name|length
parameter_list|)
define|\
value|(addTemp = (context)->Length_Low, (context)->Corrupted = \     (((context)->Length_Low += (length))< addTemp)&&     \     (++(context)->Length_High == 0) ? shaInputTooLong :    \                                       (context)->Corrupted )
end_define
begin_comment
comment|/* Local Function Prototypes */
end_comment
begin_function_decl
specifier|static
name|int
name|SHA224_256Reset
parameter_list|(
name|SHA256Context
modifier|*
name|context
parameter_list|,
name|uint32_t
modifier|*
name|H0
parameter_list|)
function_decl|;
end_function_decl
begin_function_decl
specifier|static
name|void
name|SHA224_256ProcessMessageBlock
parameter_list|(
name|SHA256Context
modifier|*
name|context
parameter_list|)
function_decl|;
end_function_decl
begin_function_decl
specifier|static
name|void
name|SHA224_256Finalize
parameter_list|(
name|SHA256Context
modifier|*
name|context
parameter_list|,
name|uint8_t
name|Pad_Byte
parameter_list|)
function_decl|;
end_function_decl
begin_function_decl
specifier|static
name|void
name|SHA224_256PadMessage
parameter_list|(
name|SHA256Context
modifier|*
name|context
parameter_list|,
name|uint8_t
name|Pad_Byte
parameter_list|)
function_decl|;
end_function_decl
begin_function_decl
specifier|static
name|int
name|SHA224_256ResultN
parameter_list|(
name|SHA256Context
modifier|*
name|context
parameter_list|,
name|uint8_t
name|Message_Digest
index|[ ]
parameter_list|,
name|int
name|HashSize
parameter_list|)
function_decl|;
end_function_decl
begin_comment
comment|/* Initial Hash Values: FIPS 180-3 section 5.3.2 */
end_comment
begin_decl_stmt
DECL|variable|SHA224_H0
specifier|static
name|uint32_t
name|SHA224_H0
index|[
name|SHA256HashSize
operator|/
literal|4
index|]
init|=
block|{
literal|0xC1059ED8
block|,
literal|0x367CD507
block|,
literal|0x3070DD17
block|,
literal|0xF70E5939
block|,
literal|0xFFC00B31
block|,
literal|0x68581511
block|,
literal|0x64F98FA7
block|,
literal|0xBEFA4FA4
block|}
decl_stmt|;
end_decl_stmt
begin_comment
comment|/* Initial Hash Values: FIPS 180-3 section 5.3.3 */
end_comment
begin_decl_stmt
DECL|variable|SHA256_H0
specifier|static
name|uint32_t
name|SHA256_H0
index|[
name|SHA256HashSize
operator|/
literal|4
index|]
init|=
block|{
literal|0x6A09E667
block|,
literal|0xBB67AE85
block|,
literal|0x3C6EF372
block|,
literal|0xA54FF53A
block|,
literal|0x510E527F
block|,
literal|0x9B05688C
block|,
literal|0x1F83D9AB
block|,
literal|0x5BE0CD19
block|}
decl_stmt|;
end_decl_stmt
begin_comment
comment|/*  * SHA224Reset  *  * Description:  *   This function will initialize the SHA224Context in preparation  *   for computing a new SHA224 message digest.  *  * Parameters:  *   context: [in/out]  *     The context to reset.  *  * Returns:  *   sha Error Code.  */
end_comment
begin_function
DECL|function|SHA224Reset
name|int
name|SHA224Reset
parameter_list|(
name|SHA224Context
modifier|*
name|context
parameter_list|)
block|{
return|return
name|SHA224_256Reset
argument_list|(
name|context
argument_list|,
name|SHA224_H0
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/*  * SHA224Input  *  * Description:  *   This function accepts an array of octets as the next portion  *   of the message.  *  * Parameters:  *   context: [in/out]  *     The SHA context to update.  *   message_array[ ]: [in]  *     An array of octets representing the next portion of  *     the message.  *   length: [in]  *     The length of the message in message_array.  *  * Returns:  *   sha Error Code.  *  */
end_comment
begin_function
DECL|function|SHA224Input
name|int
name|SHA224Input
parameter_list|(
name|SHA224Context
modifier|*
name|context
parameter_list|,
specifier|const
name|uint8_t
modifier|*
name|message_array
parameter_list|,
name|unsigned
name|int
name|length
parameter_list|)
block|{
return|return
name|SHA256Input
argument_list|(
name|context
argument_list|,
name|message_array
argument_list|,
name|length
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/*  * SHA224FinalBits  *  * Description:  *   This function will add in any final bits of the message.  *  * Parameters:  *   context: [in/out]  *     The SHA context to update.  *   message_bits: [in]  *     The final bits of the message, in the upper portion of the  *     byte.  (Use 0b###00000 instead of 0b00000### to input the  *     three bits ###.)  *   length: [in]  *     The number of bits in message_bits, between 1 and 7.  *  * Returns:  *   sha Error Code.  */
end_comment
begin_function
DECL|function|SHA224FinalBits
name|int
name|SHA224FinalBits
parameter_list|(
name|SHA224Context
modifier|*
name|context
parameter_list|,
name|uint8_t
name|message_bits
parameter_list|,
name|unsigned
name|int
name|length
parameter_list|)
block|{
return|return
name|SHA256FinalBits
argument_list|(
name|context
argument_list|,
name|message_bits
argument_list|,
name|length
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/*  * SHA224Result  *  * Description:  *   This function will return the 224-bit message digest  *   into the Message_Digest array provided by the caller.  *   NOTE:  *    The first octet of hash is stored in the element with index 0,  *    the last octet of hash in the element with index 27.  *  * Parameters:  *   context: [in/out]  *     The context to use to calculate the SHA hash.  *   Message_Digest[ ]: [out]  *     Where the digest is returned.  *  * Returns:  *   sha Error Code.  */
end_comment
begin_function
DECL|function|SHA224Result
name|int
name|SHA224Result
parameter_list|(
name|SHA224Context
modifier|*
name|context
parameter_list|,
name|uint8_t
name|Message_Digest
index|[
name|SHA224HashSize
index|]
parameter_list|)
block|{
return|return
name|SHA224_256ResultN
argument_list|(
name|context
argument_list|,
name|Message_Digest
argument_list|,
name|SHA224HashSize
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/*  * SHA256Reset  *  * Description:  *   This function will initialize the SHA256Context in preparation  *   for computing a new SHA256 message digest.  *  * Parameters:  *   context: [in/out]  *     The context to reset.  *  * Returns:  *   sha Error Code.  */
end_comment
begin_function
DECL|function|SHA256Reset
name|int
name|SHA256Reset
parameter_list|(
name|SHA256Context
modifier|*
name|context
parameter_list|)
block|{
return|return
name|SHA224_256Reset
argument_list|(
name|context
argument_list|,
name|SHA256_H0
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/*  * SHA256Input  *  * Description:  *   This function accepts an array of octets as the next portion  *   of the message.  *  * Parameters:  *   context: [in/out]  *     The SHA context to update.  *   message_array[ ]: [in]  *     An array of octets representing the next portion of  *     the message.  *   length: [in]  *     The length of the message in message_array.  *  * Returns:  *   sha Error Code.  */
end_comment
begin_function
DECL|function|SHA256Input
name|int
name|SHA256Input
parameter_list|(
name|SHA256Context
modifier|*
name|context
parameter_list|,
specifier|const
name|uint8_t
modifier|*
name|message_array
parameter_list|,
name|unsigned
name|int
name|length
parameter_list|)
block|{
if|if
condition|(
operator|!
name|context
condition|)
return|return
name|shaNull
return|;
if|if
condition|(
operator|!
name|length
condition|)
return|return
name|shaSuccess
return|;
if|if
condition|(
operator|!
name|message_array
condition|)
return|return
name|shaNull
return|;
if|if
condition|(
name|context
operator|->
name|Computed
condition|)
return|return
name|context
operator|->
name|Corrupted
operator|=
name|shaStateError
return|;
if|if
condition|(
name|context
operator|->
name|Corrupted
condition|)
return|return
name|context
operator|->
name|Corrupted
return|;
while|while
condition|(
name|length
operator|--
condition|)
block|{
name|context
operator|->
name|Message_Block
index|[
name|context
operator|->
name|Message_Block_Index
operator|++
index|]
operator|=
operator|*
name|message_array
expr_stmt|;
if|if
condition|(
operator|(
name|SHA224_256AddLength
argument_list|(
name|context
argument_list|,
literal|8
argument_list|)
operator|==
name|shaSuccess
operator|)
operator|&&
operator|(
name|context
operator|->
name|Message_Block_Index
operator|==
name|SHA256_Message_Block_Size
operator|)
condition|)
name|SHA224_256ProcessMessageBlock
argument_list|(
name|context
argument_list|)
expr_stmt|;
name|message_array
operator|++
expr_stmt|;
block|}
return|return
name|context
operator|->
name|Corrupted
return|;
block|}
end_function
begin_comment
comment|/*  * SHA256FinalBits  *  * Description:  *   This function will add in any final bits of the message.  *  * Parameters:  *   context: [in/out]  *     The SHA context to update.  *   message_bits: [in]  *     The final bits of the message, in the upper portion of the  *     byte.  (Use 0b###00000 instead of 0b00000### to input the  *     three bits ###.)  *   length: [in]  *     The number of bits in message_bits, between 1 and 7.  *  * Returns:  *   sha Error Code.  */
end_comment
begin_function
DECL|function|SHA256FinalBits
name|int
name|SHA256FinalBits
parameter_list|(
name|SHA256Context
modifier|*
name|context
parameter_list|,
name|uint8_t
name|message_bits
parameter_list|,
name|unsigned
name|int
name|length
parameter_list|)
block|{
specifier|static
name|uint8_t
name|masks
index|[
literal|8
index|]
init|=
block|{
comment|/* 0 0b00000000 */
literal|0x00
block|,
comment|/* 1 0b10000000 */
literal|0x80
block|,
comment|/* 2 0b11000000 */
literal|0xC0
block|,
comment|/* 3 0b11100000 */
literal|0xE0
block|,
comment|/* 4 0b11110000 */
literal|0xF0
block|,
comment|/* 5 0b11111000 */
literal|0xF8
block|,
comment|/* 6 0b11111100 */
literal|0xFC
block|,
comment|/* 7 0b11111110 */
literal|0xFE
block|}
decl_stmt|;
specifier|static
name|uint8_t
name|markbit
index|[
literal|8
index|]
init|=
block|{
comment|/* 0 0b10000000 */
literal|0x80
block|,
comment|/* 1 0b01000000 */
literal|0x40
block|,
comment|/* 2 0b00100000 */
literal|0x20
block|,
comment|/* 3 0b00010000 */
literal|0x10
block|,
comment|/* 4 0b00001000 */
literal|0x08
block|,
comment|/* 5 0b00000100 */
literal|0x04
block|,
comment|/* 6 0b00000010 */
literal|0x02
block|,
comment|/* 7 0b00000001 */
literal|0x01
block|}
decl_stmt|;
if|if
condition|(
operator|!
name|context
condition|)
return|return
name|shaNull
return|;
if|if
condition|(
operator|!
name|length
condition|)
return|return
name|shaSuccess
return|;
if|if
condition|(
name|context
operator|->
name|Corrupted
condition|)
return|return
name|context
operator|->
name|Corrupted
return|;
if|if
condition|(
name|context
operator|->
name|Computed
condition|)
return|return
name|context
operator|->
name|Corrupted
operator|=
name|shaStateError
return|;
if|if
condition|(
name|length
operator|>=
literal|8
condition|)
return|return
name|context
operator|->
name|Corrupted
operator|=
name|shaBadParam
return|;
name|SHA224_256AddLength
argument_list|(
name|context
argument_list|,
name|length
argument_list|)
expr_stmt|;
name|SHA224_256Finalize
argument_list|(
name|context
argument_list|,
call|(
name|uint8_t
call|)
argument_list|(
operator|(
name|message_bits
operator|&
name|masks
index|[
name|length
index|]
operator|)
operator||
name|markbit
index|[
name|length
index|]
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|context
operator|->
name|Corrupted
return|;
block|}
end_function
begin_comment
comment|/*  * SHA256Result  *  * Description:  *   This function will return the 256-bit message digest  *   into the Message_Digest array provided by the caller.  *   NOTE:  *    The first octet of hash is stored in the element with index 0,  *    the last octet of hash in the element with index 31.  *  * Parameters:  *   context: [in/out]  *     The context to use to calculate the SHA hash.  *   Message_Digest[ ]: [out]  *     Where the digest is returned.  *  * Returns:  *   sha Error Code.  */
end_comment
begin_function
DECL|function|SHA256Result
name|int
name|SHA256Result
parameter_list|(
name|SHA256Context
modifier|*
name|context
parameter_list|,
name|uint8_t
name|Message_Digest
index|[
name|SHA256HashSize
index|]
parameter_list|)
block|{
return|return
name|SHA224_256ResultN
argument_list|(
name|context
argument_list|,
name|Message_Digest
argument_list|,
name|SHA256HashSize
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/*  * SHA224_256Reset  *  * Description:  *   This helper function will initialize the SHA256Context in  *   preparation for computing a new SHA-224 or SHA-256 message digest.  *  * Parameters:  *   context: [in/out]  *     The context to reset.  *   H0[ ]: [in]  *     The initial hash value array to use.  *  * Returns:  *   sha Error Code.  */
end_comment
begin_function
DECL|function|SHA224_256Reset
specifier|static
name|int
name|SHA224_256Reset
parameter_list|(
name|SHA256Context
modifier|*
name|context
parameter_list|,
name|uint32_t
modifier|*
name|H0
parameter_list|)
block|{
if|if
condition|(
operator|!
name|context
condition|)
return|return
name|shaNull
return|;
name|context
operator|->
name|Length_High
operator|=
name|context
operator|->
name|Length_Low
operator|=
literal|0
expr_stmt|;
name|context
operator|->
name|Message_Block_Index
operator|=
literal|0
expr_stmt|;
name|context
operator|->
name|Intermediate_Hash
index|[
literal|0
index|]
operator|=
name|H0
index|[
literal|0
index|]
expr_stmt|;
name|context
operator|->
name|Intermediate_Hash
index|[
literal|1
index|]
operator|=
name|H0
index|[
literal|1
index|]
expr_stmt|;
name|context
operator|->
name|Intermediate_Hash
index|[
literal|2
index|]
operator|=
name|H0
index|[
literal|2
index|]
expr_stmt|;
name|context
operator|->
name|Intermediate_Hash
index|[
literal|3
index|]
operator|=
name|H0
index|[
literal|3
index|]
expr_stmt|;
name|context
operator|->
name|Intermediate_Hash
index|[
literal|4
index|]
operator|=
name|H0
index|[
literal|4
index|]
expr_stmt|;
name|context
operator|->
name|Intermediate_Hash
index|[
literal|5
index|]
operator|=
name|H0
index|[
literal|5
index|]
expr_stmt|;
name|context
operator|->
name|Intermediate_Hash
index|[
literal|6
index|]
operator|=
name|H0
index|[
literal|6
index|]
expr_stmt|;
name|context
operator|->
name|Intermediate_Hash
index|[
literal|7
index|]
operator|=
name|H0
index|[
literal|7
index|]
expr_stmt|;
name|context
operator|->
name|Computed
operator|=
literal|0
expr_stmt|;
name|context
operator|->
name|Corrupted
operator|=
name|shaSuccess
expr_stmt|;
return|return
name|shaSuccess
return|;
block|}
end_function
begin_comment
comment|/*  * SHA224_256ProcessMessageBlock  *  * Description:  *   This helper function will process the next 512 bits of the  *   message stored in the Message_Block array.  *  * Parameters:  *   context: [in/out]  *     The SHA context to update.  *  * Returns:  *   Nothing.  *  * Comments:  *   Many of the variable names in this code, especially the  *   single character names, were used because those were the  *   names used in the Secure Hash Standard.  */
end_comment
begin_function
DECL|function|SHA224_256ProcessMessageBlock
specifier|static
name|void
name|SHA224_256ProcessMessageBlock
parameter_list|(
name|SHA256Context
modifier|*
name|context
parameter_list|)
block|{
comment|/* Constants defined in FIPS 180-3, section 4.2.2 */
specifier|static
specifier|const
name|uint32_t
name|K
index|[
literal|64
index|]
init|=
block|{
literal|0x428a2f98
block|,
literal|0x71374491
block|,
literal|0xb5c0fbcf
block|,
literal|0xe9b5dba5
block|,
literal|0x3956c25b
block|,
literal|0x59f111f1
block|,
literal|0x923f82a4
block|,
literal|0xab1c5ed5
block|,
literal|0xd807aa98
block|,
literal|0x12835b01
block|,
literal|0x243185be
block|,
literal|0x550c7dc3
block|,
literal|0x72be5d74
block|,
literal|0x80deb1fe
block|,
literal|0x9bdc06a7
block|,
literal|0xc19bf174
block|,
literal|0xe49b69c1
block|,
literal|0xefbe4786
block|,
literal|0x0fc19dc6
block|,
literal|0x240ca1cc
block|,
literal|0x2de92c6f
block|,
literal|0x4a7484aa
block|,
literal|0x5cb0a9dc
block|,
literal|0x76f988da
block|,
literal|0x983e5152
block|,
literal|0xa831c66d
block|,
literal|0xb00327c8
block|,
literal|0xbf597fc7
block|,
literal|0xc6e00bf3
block|,
literal|0xd5a79147
block|,
literal|0x06ca6351
block|,
literal|0x14292967
block|,
literal|0x27b70a85
block|,
literal|0x2e1b2138
block|,
literal|0x4d2c6dfc
block|,
literal|0x53380d13
block|,
literal|0x650a7354
block|,
literal|0x766a0abb
block|,
literal|0x81c2c92e
block|,
literal|0x92722c85
block|,
literal|0xa2bfe8a1
block|,
literal|0xa81a664b
block|,
literal|0xc24b8b70
block|,
literal|0xc76c51a3
block|,
literal|0xd192e819
block|,
literal|0xd6990624
block|,
literal|0xf40e3585
block|,
literal|0x106aa070
block|,
literal|0x19a4c116
block|,
literal|0x1e376c08
block|,
literal|0x2748774c
block|,
literal|0x34b0bcb5
block|,
literal|0x391c0cb3
block|,
literal|0x4ed8aa4a
block|,
literal|0x5b9cca4f
block|,
literal|0x682e6ff3
block|,
literal|0x748f82ee
block|,
literal|0x78a5636f
block|,
literal|0x84c87814
block|,
literal|0x8cc70208
block|,
literal|0x90befffa
block|,
literal|0xa4506ceb
block|,
literal|0xbef9a3f7
block|,
literal|0xc67178f2
block|}
decl_stmt|;
name|int
name|t
decl_stmt|,
name|t4
decl_stmt|;
comment|/* Loop counter */
name|uint32_t
name|temp1
decl_stmt|,
name|temp2
decl_stmt|;
comment|/* Temporary word value */
name|uint32_t
name|W
index|[
literal|64
index|]
decl_stmt|;
comment|/* Word sequence */
name|uint32_t
name|A
decl_stmt|,
name|B
decl_stmt|,
name|C
decl_stmt|,
name|D
decl_stmt|,
name|E
decl_stmt|,
name|F
decl_stmt|,
name|G
decl_stmt|,
name|H
decl_stmt|;
comment|/* Word buffers */
comment|/*    * Initialize the first 16 words in the array W    */
for|for
control|(
name|t
operator|=
name|t4
operator|=
literal|0
init|;
name|t
operator|<
literal|16
condition|;
name|t
operator|++
operator|,
name|t4
operator|+=
literal|4
control|)
name|W
index|[
name|t
index|]
operator|=
operator|(
operator|(
operator|(
name|uint32_t
operator|)
name|context
operator|->
name|Message_Block
index|[
name|t4
index|]
operator|)
operator|<<
literal|24
operator|)
operator||
operator|(
operator|(
operator|(
name|uint32_t
operator|)
name|context
operator|->
name|Message_Block
index|[
name|t4
operator|+
literal|1
index|]
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
operator|(
name|uint32_t
operator|)
name|context
operator|->
name|Message_Block
index|[
name|t4
operator|+
literal|2
index|]
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
operator|(
operator|(
name|uint32_t
operator|)
name|context
operator|->
name|Message_Block
index|[
name|t4
operator|+
literal|3
index|]
operator|)
operator|)
expr_stmt|;
for|for
control|(
name|t
operator|=
literal|16
init|;
name|t
operator|<
literal|64
condition|;
name|t
operator|++
control|)
name|W
index|[
name|t
index|]
operator|=
name|SHA256_sigma1
argument_list|(
name|W
index|[
name|t
operator|-
literal|2
index|]
argument_list|)
operator|+
name|W
index|[
name|t
operator|-
literal|7
index|]
operator|+
name|SHA256_sigma0
argument_list|(
name|W
index|[
name|t
operator|-
literal|15
index|]
argument_list|)
operator|+
name|W
index|[
name|t
operator|-
literal|16
index|]
expr_stmt|;
name|A
operator|=
name|context
operator|->
name|Intermediate_Hash
index|[
literal|0
index|]
expr_stmt|;
name|B
operator|=
name|context
operator|->
name|Intermediate_Hash
index|[
literal|1
index|]
expr_stmt|;
name|C
operator|=
name|context
operator|->
name|Intermediate_Hash
index|[
literal|2
index|]
expr_stmt|;
name|D
operator|=
name|context
operator|->
name|Intermediate_Hash
index|[
literal|3
index|]
expr_stmt|;
name|E
operator|=
name|context
operator|->
name|Intermediate_Hash
index|[
literal|4
index|]
expr_stmt|;
name|F
operator|=
name|context
operator|->
name|Intermediate_Hash
index|[
literal|5
index|]
expr_stmt|;
name|G
operator|=
name|context
operator|->
name|Intermediate_Hash
index|[
literal|6
index|]
expr_stmt|;
name|H
operator|=
name|context
operator|->
name|Intermediate_Hash
index|[
literal|7
index|]
expr_stmt|;
for|for
control|(
name|t
operator|=
literal|0
init|;
name|t
operator|<
literal|64
condition|;
name|t
operator|++
control|)
block|{
name|temp1
operator|=
name|H
operator|+
name|SHA256_SIGMA1
argument_list|(
name|E
argument_list|)
operator|+
name|SHA_Ch
argument_list|(
name|E
argument_list|,
name|F
argument_list|,
name|G
argument_list|)
operator|+
name|K
index|[
name|t
index|]
operator|+
name|W
index|[
name|t
index|]
expr_stmt|;
name|temp2
operator|=
name|SHA256_SIGMA0
argument_list|(
name|A
argument_list|)
operator|+
name|SHA_Maj
argument_list|(
name|A
argument_list|,
name|B
argument_list|,
name|C
argument_list|)
expr_stmt|;
name|H
operator|=
name|G
expr_stmt|;
name|G
operator|=
name|F
expr_stmt|;
name|F
operator|=
name|E
expr_stmt|;
name|E
operator|=
name|D
operator|+
name|temp1
expr_stmt|;
name|D
operator|=
name|C
expr_stmt|;
name|C
operator|=
name|B
expr_stmt|;
name|B
operator|=
name|A
expr_stmt|;
name|A
operator|=
name|temp1
operator|+
name|temp2
expr_stmt|;
block|}
name|context
operator|->
name|Intermediate_Hash
index|[
literal|0
index|]
operator|+=
name|A
expr_stmt|;
name|context
operator|->
name|Intermediate_Hash
index|[
literal|1
index|]
operator|+=
name|B
expr_stmt|;
name|context
operator|->
name|Intermediate_Hash
index|[
literal|2
index|]
operator|+=
name|C
expr_stmt|;
name|context
operator|->
name|Intermediate_Hash
index|[
literal|3
index|]
operator|+=
name|D
expr_stmt|;
name|context
operator|->
name|Intermediate_Hash
index|[
literal|4
index|]
operator|+=
name|E
expr_stmt|;
name|context
operator|->
name|Intermediate_Hash
index|[
literal|5
index|]
operator|+=
name|F
expr_stmt|;
name|context
operator|->
name|Intermediate_Hash
index|[
literal|6
index|]
operator|+=
name|G
expr_stmt|;
name|context
operator|->
name|Intermediate_Hash
index|[
literal|7
index|]
operator|+=
name|H
expr_stmt|;
name|context
operator|->
name|Message_Block_Index
operator|=
literal|0
expr_stmt|;
block|}
end_function
begin_comment
comment|/*  * SHA224_256Finalize  *  * Description:  *   This helper function finishes off the digest calculations.  *  * Parameters:  *   context: [in/out]  *     The SHA context to update.  *   Pad_Byte: [in]  *     The last byte to add to the message block before the 0-padding  *     and length.  This will contain the last bits of the message  *     followed by another single bit.  If the message was an  *     exact multiple of 8-bits long, Pad_Byte will be 0x80.  *  * Returns:  *   sha Error Code.  */
end_comment
begin_function
DECL|function|SHA224_256Finalize
specifier|static
name|void
name|SHA224_256Finalize
parameter_list|(
name|SHA256Context
modifier|*
name|context
parameter_list|,
name|uint8_t
name|Pad_Byte
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
name|SHA224_256PadMessage
argument_list|(
name|context
argument_list|,
name|Pad_Byte
argument_list|)
expr_stmt|;
comment|/* message may be sensitive, so clear it out */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|SHA256_Message_Block_Size
condition|;
operator|++
name|i
control|)
name|context
operator|->
name|Message_Block
index|[
name|i
index|]
operator|=
literal|0
expr_stmt|;
name|context
operator|->
name|Length_High
operator|=
literal|0
expr_stmt|;
comment|/* and clear length */
name|context
operator|->
name|Length_Low
operator|=
literal|0
expr_stmt|;
name|context
operator|->
name|Computed
operator|=
literal|1
expr_stmt|;
block|}
end_function
begin_comment
comment|/*  * SHA224_256PadMessage  *  * Description:  *   According to the standard, the message must be padded to the next  *   even multiple of 512 bits.  The first padding bit must be a '1'.  *   The last 64 bits represent the length of the original message.  *   All bits in between should be 0.  This helper function will pad  *   the message according to those rules by filling the  *   Message_Block array accordingly.  When it returns, it can be  *   assumed that the message digest has been computed.  *  * Parameters:  *   context: [in/out]  *     The context to pad.  *   Pad_Byte: [in]  *     The last byte to add to the message block before the 0-padding  *     and length.  This will contain the last bits of the message  *     followed by another single bit.  If the message was an  *     exact multiple of 8-bits long, Pad_Byte will be 0x80.  *  * Returns:  *   Nothing.  */
end_comment
begin_function
DECL|function|SHA224_256PadMessage
specifier|static
name|void
name|SHA224_256PadMessage
parameter_list|(
name|SHA256Context
modifier|*
name|context
parameter_list|,
name|uint8_t
name|Pad_Byte
parameter_list|)
block|{
comment|/*    * Check to see if the current message block is too small to hold    * the initial padding bits and length.  If so, we will pad the    * block, process it, and then continue padding into a second    * block.    */
if|if
condition|(
name|context
operator|->
name|Message_Block_Index
operator|>=
operator|(
name|SHA256_Message_Block_Size
operator|-
literal|8
operator|)
condition|)
block|{
name|context
operator|->
name|Message_Block
index|[
name|context
operator|->
name|Message_Block_Index
operator|++
index|]
operator|=
name|Pad_Byte
expr_stmt|;
while|while
condition|(
name|context
operator|->
name|Message_Block_Index
operator|<
name|SHA256_Message_Block_Size
condition|)
name|context
operator|->
name|Message_Block
index|[
name|context
operator|->
name|Message_Block_Index
operator|++
index|]
operator|=
literal|0
expr_stmt|;
name|SHA224_256ProcessMessageBlock
argument_list|(
name|context
argument_list|)
expr_stmt|;
block|}
else|else
name|context
operator|->
name|Message_Block
index|[
name|context
operator|->
name|Message_Block_Index
operator|++
index|]
operator|=
name|Pad_Byte
expr_stmt|;
while|while
condition|(
name|context
operator|->
name|Message_Block_Index
operator|<
operator|(
name|SHA256_Message_Block_Size
operator|-
literal|8
operator|)
condition|)
name|context
operator|->
name|Message_Block
index|[
name|context
operator|->
name|Message_Block_Index
operator|++
index|]
operator|=
literal|0
expr_stmt|;
comment|/*    * Store the message length as the last 8 octets    */
name|context
operator|->
name|Message_Block
index|[
literal|56
index|]
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|context
operator|->
name|Length_High
operator|>>
literal|24
argument_list|)
expr_stmt|;
name|context
operator|->
name|Message_Block
index|[
literal|57
index|]
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|context
operator|->
name|Length_High
operator|>>
literal|16
argument_list|)
expr_stmt|;
name|context
operator|->
name|Message_Block
index|[
literal|58
index|]
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|context
operator|->
name|Length_High
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|context
operator|->
name|Message_Block
index|[
literal|59
index|]
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|context
operator|->
name|Length_High
argument_list|)
expr_stmt|;
name|context
operator|->
name|Message_Block
index|[
literal|60
index|]
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|context
operator|->
name|Length_Low
operator|>>
literal|24
argument_list|)
expr_stmt|;
name|context
operator|->
name|Message_Block
index|[
literal|61
index|]
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|context
operator|->
name|Length_Low
operator|>>
literal|16
argument_list|)
expr_stmt|;
name|context
operator|->
name|Message_Block
index|[
literal|62
index|]
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|context
operator|->
name|Length_Low
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|context
operator|->
name|Message_Block
index|[
literal|63
index|]
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|context
operator|->
name|Length_Low
argument_list|)
expr_stmt|;
name|SHA224_256ProcessMessageBlock
argument_list|(
name|context
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|/*  * SHA224_256ResultN  *  * Description:  *   This helper function will return the 224-bit or 256-bit message  *   digest into the Message_Digest array provided by the caller.  *   NOTE:  *    The first octet of hash is stored in the element with index 0,  *    the last octet of hash in the element with index 27/31.  *  * Parameters:  *   context: [in/out]  *     The context to use to calculate the SHA hash.  *   Message_Digest[ ]: [out]  *     Where the digest is returned.  *   HashSize: [in]  *     The size of the hash, either 28 or 32.  *  * Returns:  *   sha Error Code.  */
end_comment
begin_function
DECL|function|SHA224_256ResultN
specifier|static
name|int
name|SHA224_256ResultN
parameter_list|(
name|SHA256Context
modifier|*
name|context
parameter_list|,
name|uint8_t
name|Message_Digest
index|[ ]
parameter_list|,
name|int
name|HashSize
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
if|if
condition|(
operator|!
name|context
condition|)
return|return
name|shaNull
return|;
if|if
condition|(
operator|!
name|Message_Digest
condition|)
return|return
name|shaNull
return|;
if|if
condition|(
name|context
operator|->
name|Corrupted
condition|)
return|return
name|context
operator|->
name|Corrupted
return|;
if|if
condition|(
operator|!
name|context
operator|->
name|Computed
condition|)
name|SHA224_256Finalize
argument_list|(
name|context
argument_list|,
literal|0x80
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|HashSize
condition|;
operator|++
name|i
control|)
name|Message_Digest
index|[
name|i
index|]
operator|=
call|(
name|uint8_t
call|)
argument_list|(
name|context
operator|->
name|Intermediate_Hash
index|[
name|i
operator|>>
literal|2
index|]
operator|>>
literal|8
operator|*
operator|(
literal|3
operator|-
operator|(
name|i
operator|&
literal|0x03
operator|)
operator|)
argument_list|)
expr_stmt|;
return|return
name|shaSuccess
return|;
block|}
end_function
end_unit
