begin_unit
begin_comment
comment|/*  *    Stack-less Just-In-Time compiler  *  *    Copyright 2009-2012 Zoltan Herczeg (hzmester@freemail.hu). All rights reserved.  *  * Redistribution and use in source and binary forms, with or without modification, are  * permitted provided that the following conditions are met:  *  *   1. Redistributions of source code must retain the above copyright notice, this list of  *      conditions and the following disclaimer.  *  *   2. Redistributions in binary form must reproduce the above copyright notice, this list  *      of conditions and the following disclaimer in the documentation and/or other materials  *      provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER(S) AND CONTRIBUTORS ``AS IS'' AND ANY  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT  * SHALL THE COPYRIGHT HOLDER(S) OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,  * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED  * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR  * BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN  * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment
begin_function
DECL|function|load_immediate
specifier|static
name|sljit_si
name|load_immediate
parameter_list|(
name|struct
name|sljit_compiler
modifier|*
name|compiler
parameter_list|,
name|sljit_si
name|dst
parameter_list|,
name|sljit_sw
name|imm
parameter_list|)
block|{
if|if
condition|(
name|imm
operator|<=
name|SIMM_MAX
operator|&&
name|imm
operator|>=
name|SIMM_MIN
condition|)
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|OR
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
literal|0
argument_list|)
operator||
name|IMM
argument_list|(
name|imm
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
argument_list|)
return|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SETHI
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
operator|(
operator|(
name|imm
operator|>>
literal|10
operator|)
operator|&
literal|0x3fffff
operator|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|imm
operator|&
literal|0x3ff
operator|)
condition|?
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|OR
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|dst
argument_list|)
operator||
name|IMM_ARG
operator||
operator|(
name|imm
operator|&
literal|0x3ff
operator|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
argument_list|)
else|:
name|SLJIT_SUCCESS
return|;
block|}
end_function
begin_define
DECL|macro|ARG2
define|#
directive|define
name|ARG2
parameter_list|(
name|flags
parameter_list|,
name|src2
parameter_list|)
value|((flags& SRC2_IMM) ? IMM(src2) : S2(src2))
end_define
begin_function
DECL|function|emit_single_op
specifier|static
name|SLJIT_INLINE
name|sljit_si
name|emit_single_op
parameter_list|(
name|struct
name|sljit_compiler
modifier|*
name|compiler
parameter_list|,
name|sljit_si
name|op
parameter_list|,
name|sljit_si
name|flags
parameter_list|,
name|sljit_si
name|dst
parameter_list|,
name|sljit_si
name|src1
parameter_list|,
name|sljit_sw
name|src2
parameter_list|)
block|{
name|SLJIT_COMPILE_ASSERT
argument_list|(
name|ICC_IS_SET
operator|==
name|SET_FLAGS
argument_list|,
name|icc_is_set_and_set_flags_must_be_the_same
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SLJIT_MOV
case|:
case|case
name|SLJIT_MOV_UI
case|:
case|case
name|SLJIT_MOV_SI
case|:
case|case
name|SLJIT_MOV_P
case|:
name|SLJIT_ASSERT
argument_list|(
name|src1
operator|==
name|TMP_REG1
operator|&&
operator|!
operator|(
name|flags
operator|&
name|SRC2_IMM
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|dst
operator|!=
name|src2
condition|)
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|OR
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
literal|0
argument_list|)
operator||
name|S2
argument_list|(
name|src2
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
argument_list|)
return|;
return|return
name|SLJIT_SUCCESS
return|;
case|case
name|SLJIT_MOV_UB
case|:
case|case
name|SLJIT_MOV_SB
case|:
name|SLJIT_ASSERT
argument_list|(
name|src1
operator|==
name|TMP_REG1
operator|&&
operator|!
operator|(
name|flags
operator|&
name|SRC2_IMM
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|flags
operator|&
operator|(
name|REG_DEST
operator||
name|REG2_SOURCE
operator|)
operator|)
operator|==
operator|(
name|REG_DEST
operator||
name|REG2_SOURCE
operator|)
condition|)
block|{
if|if
condition|(
name|op
operator|==
name|SLJIT_MOV_UB
condition|)
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|AND
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|src2
argument_list|)
operator||
name|IMM
argument_list|(
literal|0xff
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
argument_list|)
return|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SLL
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|src2
argument_list|)
operator||
name|IMM
argument_list|(
literal|24
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SRA
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|dst
argument_list|)
operator||
name|IMM
argument_list|(
literal|24
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|dst
operator|!=
name|src2
condition|)
name|SLJIT_ASSERT_STOP
argument_list|()
expr_stmt|;
return|return
name|SLJIT_SUCCESS
return|;
case|case
name|SLJIT_MOV_UH
case|:
case|case
name|SLJIT_MOV_SH
case|:
name|SLJIT_ASSERT
argument_list|(
name|src1
operator|==
name|TMP_REG1
operator|&&
operator|!
operator|(
name|flags
operator|&
name|SRC2_IMM
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|flags
operator|&
operator|(
name|REG_DEST
operator||
name|REG2_SOURCE
operator|)
operator|)
operator|==
operator|(
name|REG_DEST
operator||
name|REG2_SOURCE
operator|)
condition|)
block|{
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SLL
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|src2
argument_list|)
operator||
name|IMM
argument_list|(
literal|16
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
operator|(
name|op
operator|==
name|SLJIT_MOV_SH
condition|?
name|SRA
else|:
name|SRL
operator|)
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|dst
argument_list|)
operator||
name|IMM
argument_list|(
literal|16
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
name|dst
operator|!=
name|src2
condition|)
name|SLJIT_ASSERT_STOP
argument_list|()
expr_stmt|;
return|return
name|SLJIT_SUCCESS
return|;
case|case
name|SLJIT_NOT
case|:
name|SLJIT_ASSERT
argument_list|(
name|src1
operator|==
name|TMP_REG1
operator|&&
operator|!
operator|(
name|flags
operator|&
name|SRC2_IMM
operator|)
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|XNOR
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
literal|0
argument_list|)
operator||
name|S2
argument_list|(
name|src2
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
argument_list|)
return|;
case|case
name|SLJIT_CLZ
case|:
name|SLJIT_ASSERT
argument_list|(
name|src1
operator|==
name|TMP_REG1
operator|&&
operator|!
operator|(
name|flags
operator|&
name|SRC2_IMM
operator|)
argument_list|)
expr_stmt|;
comment|/* sparc 32 does not support SLJIT_KEEP_FLAGS. Not sure I can fix this. */
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SUB
operator||
name|SET_FLAGS
operator||
name|D
argument_list|(
literal|0
argument_list|)
operator||
name|S1
argument_list|(
name|src2
argument_list|)
operator||
name|S2
argument_list|(
literal|0
argument_list|)
argument_list|,
name|SET_FLAGS
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|OR
operator||
name|D
argument_list|(
name|TMP_REG1
argument_list|)
operator||
name|S1
argument_list|(
literal|0
argument_list|)
operator||
name|S2
argument_list|(
name|src2
argument_list|)
argument_list|,
name|DR
argument_list|(
name|TMP_REG1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|BICC
operator||
name|DA
argument_list|(
literal|0x1
argument_list|)
operator||
operator|(
literal|7
operator|&
name|DISP_MASK
operator|)
argument_list|,
name|UNMOVABLE_INS
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|OR
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
literal|0
argument_list|)
operator||
name|IMM
argument_list|(
literal|32
argument_list|)
argument_list|,
name|UNMOVABLE_INS
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|OR
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
literal|0
argument_list|)
operator||
name|IMM
argument_list|(
operator|-
literal|1
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/* Loop. */
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SUB
operator||
name|SET_FLAGS
operator||
name|D
argument_list|(
literal|0
argument_list|)
operator||
name|S1
argument_list|(
name|TMP_REG1
argument_list|)
operator||
name|S2
argument_list|(
literal|0
argument_list|)
argument_list|,
name|SET_FLAGS
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SLL
operator||
name|D
argument_list|(
name|TMP_REG1
argument_list|)
operator||
name|S1
argument_list|(
name|TMP_REG1
argument_list|)
operator||
name|IMM
argument_list|(
literal|1
argument_list|)
argument_list|,
name|DR
argument_list|(
name|TMP_REG1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|BICC
operator||
name|DA
argument_list|(
literal|0xe
argument_list|)
operator||
operator|(
operator|-
literal|2
operator|&
name|DISP_MASK
operator|)
argument_list|,
name|UNMOVABLE_INS
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADD
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|dst
argument_list|)
operator||
name|IMM
argument_list|(
literal|1
argument_list|)
argument_list|,
name|UNMOVABLE_INS
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
argument_list|)
return|;
case|case
name|SLJIT_ADD
case|:
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADD
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|src1
argument_list|)
operator||
name|ARG2
argument_list|(
name|flags
argument_list|,
name|src2
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
argument_list|)
return|;
case|case
name|SLJIT_ADDC
case|:
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDC
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|src1
argument_list|)
operator||
name|ARG2
argument_list|(
name|flags
argument_list|,
name|src2
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
argument_list|)
return|;
case|case
name|SLJIT_SUB
case|:
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SUB
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|src1
argument_list|)
operator||
name|ARG2
argument_list|(
name|flags
argument_list|,
name|src2
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
argument_list|)
return|;
case|case
name|SLJIT_SUBC
case|:
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SUBC
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|src1
argument_list|)
operator||
name|ARG2
argument_list|(
name|flags
argument_list|,
name|src2
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
argument_list|)
return|;
case|case
name|SLJIT_MUL
case|:
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SMUL
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|src1
argument_list|)
operator||
name|ARG2
argument_list|(
name|flags
argument_list|,
name|src2
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
condition|)
return|return
name|SLJIT_SUCCESS
return|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SRA
operator||
name|D
argument_list|(
name|TMP_REG1
argument_list|)
operator||
name|S1
argument_list|(
name|dst
argument_list|)
operator||
name|IMM
argument_list|(
literal|31
argument_list|)
argument_list|,
name|DR
argument_list|(
name|TMP_REG1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|RDY
operator||
name|D
argument_list|(
name|TMP_LINK
argument_list|)
argument_list|,
name|DR
argument_list|(
name|TMP_LINK
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SUB
operator||
name|SET_FLAGS
operator||
name|D
argument_list|(
literal|0
argument_list|)
operator||
name|S1
argument_list|(
name|TMP_REG1
argument_list|)
operator||
name|S2
argument_list|(
name|TMP_LINK
argument_list|)
argument_list|,
name|MOVABLE_INS
operator||
name|SET_FLAGS
argument_list|)
return|;
case|case
name|SLJIT_AND
case|:
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|AND
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|src1
argument_list|)
operator||
name|ARG2
argument_list|(
name|flags
argument_list|,
name|src2
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
argument_list|)
return|;
case|case
name|SLJIT_OR
case|:
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|OR
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|src1
argument_list|)
operator||
name|ARG2
argument_list|(
name|flags
argument_list|,
name|src2
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
argument_list|)
return|;
case|case
name|SLJIT_XOR
case|:
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|XOR
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|src1
argument_list|)
operator||
name|ARG2
argument_list|(
name|flags
argument_list|,
name|src2
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
operator||
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
argument_list|)
return|;
case|case
name|SLJIT_SHL
case|:
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SLL
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|src1
argument_list|)
operator||
name|ARG2
argument_list|(
name|flags
argument_list|,
name|src2
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|!
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
condition|?
name|SLJIT_SUCCESS
else|:
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SUB
operator||
name|SET_FLAGS
operator||
name|D
argument_list|(
literal|0
argument_list|)
operator||
name|S1
argument_list|(
name|dst
argument_list|)
operator||
name|S2
argument_list|(
literal|0
argument_list|)
argument_list|,
name|SET_FLAGS
argument_list|)
return|;
case|case
name|SLJIT_LSHR
case|:
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SRL
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|src1
argument_list|)
operator||
name|ARG2
argument_list|(
name|flags
argument_list|,
name|src2
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|!
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
condition|?
name|SLJIT_SUCCESS
else|:
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SUB
operator||
name|SET_FLAGS
operator||
name|D
argument_list|(
literal|0
argument_list|)
operator||
name|S1
argument_list|(
name|dst
argument_list|)
operator||
name|S2
argument_list|(
literal|0
argument_list|)
argument_list|,
name|SET_FLAGS
argument_list|)
return|;
case|case
name|SLJIT_ASHR
case|:
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SRA
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|src1
argument_list|)
operator||
name|ARG2
argument_list|(
name|flags
argument_list|,
name|src2
argument_list|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|!
operator|(
name|flags
operator|&
name|SET_FLAGS
operator|)
condition|?
name|SLJIT_SUCCESS
else|:
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SUB
operator||
name|SET_FLAGS
operator||
name|D
argument_list|(
literal|0
argument_list|)
operator||
name|S1
argument_list|(
name|dst
argument_list|)
operator||
name|S2
argument_list|(
literal|0
argument_list|)
argument_list|,
name|SET_FLAGS
argument_list|)
return|;
block|}
name|SLJIT_ASSERT_STOP
argument_list|()
expr_stmt|;
return|return
name|SLJIT_SUCCESS
return|;
block|}
end_function
begin_function
DECL|function|emit_const
specifier|static
name|SLJIT_INLINE
name|sljit_si
name|emit_const
parameter_list|(
name|struct
name|sljit_compiler
modifier|*
name|compiler
parameter_list|,
name|sljit_si
name|dst
parameter_list|,
name|sljit_sw
name|init_value
parameter_list|)
block|{
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SETHI
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
operator|(
operator|(
name|init_value
operator|>>
literal|10
operator|)
operator|&
literal|0x3fffff
operator|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|OR
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|S1
argument_list|(
name|dst
argument_list|)
operator||
name|IMM_ARG
operator||
operator|(
name|init_value
operator|&
literal|0x3ff
operator|)
argument_list|,
name|DR
argument_list|(
name|dst
argument_list|)
argument_list|)
return|;
block|}
end_function
begin_function
DECL|function|sljit_set_jump_addr
name|SLJIT_API_FUNC_ATTRIBUTE
name|void
name|sljit_set_jump_addr
parameter_list|(
name|sljit_uw
name|addr
parameter_list|,
name|sljit_uw
name|new_addr
parameter_list|)
block|{
name|sljit_ins
modifier|*
name|inst
init|=
operator|(
name|sljit_ins
operator|*
operator|)
name|addr
decl_stmt|;
name|inst
index|[
literal|0
index|]
operator|=
operator|(
name|inst
index|[
literal|0
index|]
operator|&
literal|0xffc00000
operator|)
operator||
operator|(
operator|(
name|new_addr
operator|>>
literal|10
operator|)
operator|&
literal|0x3fffff
operator|)
expr_stmt|;
name|inst
index|[
literal|1
index|]
operator|=
operator|(
name|inst
index|[
literal|1
index|]
operator|&
literal|0xfffffc00
operator|)
operator||
operator|(
name|new_addr
operator|&
literal|0x3ff
operator|)
expr_stmt|;
name|SLJIT_CACHE_FLUSH
argument_list|(
name|inst
argument_list|,
name|inst
operator|+
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sljit_set_const
name|SLJIT_API_FUNC_ATTRIBUTE
name|void
name|sljit_set_const
parameter_list|(
name|sljit_uw
name|addr
parameter_list|,
name|sljit_sw
name|new_constant
parameter_list|)
block|{
name|sljit_ins
modifier|*
name|inst
init|=
operator|(
name|sljit_ins
operator|*
operator|)
name|addr
decl_stmt|;
name|inst
index|[
literal|0
index|]
operator|=
operator|(
name|inst
index|[
literal|0
index|]
operator|&
literal|0xffc00000
operator|)
operator||
operator|(
operator|(
name|new_constant
operator|>>
literal|10
operator|)
operator|&
literal|0x3fffff
operator|)
expr_stmt|;
name|inst
index|[
literal|1
index|]
operator|=
operator|(
name|inst
index|[
literal|1
index|]
operator|&
literal|0xfffffc00
operator|)
operator||
operator|(
name|new_constant
operator|&
literal|0x3ff
operator|)
expr_stmt|;
name|SLJIT_CACHE_FLUSH
argument_list|(
name|inst
argument_list|,
name|inst
operator|+
literal|2
argument_list|)
expr_stmt|;
block|}
end_function
end_unit
