begin_unit
begin_comment
comment|/*  *    Stack-less Just-In-Time compiler  *  *    Copyright 2009-2012 Zoltan Herczeg (hzmester@freemail.hu). All rights reserved.  *  * Redistribution and use in source and binary forms, with or without modification, are  * permitted provided that the following conditions are met:  *  *   1. Redistributions of source code must retain the above copyright notice, this list of  *      conditions and the following disclaimer.  *  *   2. Redistributions in binary form must reproduce the above copyright notice, this list  *      of conditions and the following disclaimer in the documentation and/or other materials  *      provided with the distribution.  *  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER(S) AND CONTRIBUTORS ``AS IS'' AND ANY  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT  * SHALL THE COPYRIGHT HOLDER(S) OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,  * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED  * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR  * BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN  * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  */
end_comment
begin_comment
comment|/* ppc 64-bit arch dependent functions. */
end_comment
begin_if
if|#
directive|if
name|defined
argument_list|(
name|__GNUC__
argument_list|)
operator|||
operator|(
name|defined
argument_list|(
name|__IBM_GCC_ASM
argument_list|)
operator|&&
name|__IBM_GCC_ASM
operator|)
end_if
begin_define
DECL|macro|ASM_SLJIT_CLZ
define|#
directive|define
name|ASM_SLJIT_CLZ
parameter_list|(
name|src
parameter_list|,
name|dst
parameter_list|)
define|\
value|__asm__ volatile ( "cntlzd %0, %1" : "=r"(dst) : "r"(src) )
end_define
begin_elif
elif|#
directive|elif
name|defined
argument_list|(
name|__xlc__
argument_list|)
end_elif
begin_error
error|#
directive|error
literal|"Please enable GCC syntax for inline assembly statements"
end_error
begin_else
else|#
directive|else
end_else
begin_error
error|#
directive|error
literal|"Must implement count leading zeroes"
end_error
begin_endif
endif|#
directive|endif
end_endif
begin_define
DECL|macro|RLDI
define|#
directive|define
name|RLDI
parameter_list|(
name|dst
parameter_list|,
name|src
parameter_list|,
name|sh
parameter_list|,
name|mb
parameter_list|,
name|type
parameter_list|)
define|\
value|(HI(30) | S(src) | A(dst) | ((type)<< 2) | (((sh)& 0x1f)<< 11) | (((sh)& 0x20)>> 4) | (((mb)& 0x1f)<< 6) | ((mb)& 0x20))
end_define
begin_define
DECL|macro|PUSH_RLDICR
define|#
directive|define
name|PUSH_RLDICR
parameter_list|(
name|reg
parameter_list|,
name|shift
parameter_list|)
define|\
value|push_inst(compiler, RLDI(reg, reg, 63 - shift, shift, 1))
end_define
begin_function
DECL|function|load_immediate
specifier|static
name|sljit_si
name|load_immediate
parameter_list|(
name|struct
name|sljit_compiler
modifier|*
name|compiler
parameter_list|,
name|sljit_si
name|reg
parameter_list|,
name|sljit_sw
name|imm
parameter_list|)
block|{
name|sljit_uw
name|tmp
decl_stmt|;
name|sljit_uw
name|shift
decl_stmt|;
name|sljit_uw
name|tmp2
decl_stmt|;
name|sljit_uw
name|shift2
decl_stmt|;
if|if
condition|(
name|imm
operator|<=
name|SIMM_MAX
operator|&&
name|imm
operator|>=
name|SIMM_MIN
condition|)
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDI
operator||
name|D
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
literal|0
argument_list|)
operator||
name|IMM
argument_list|(
name|imm
argument_list|)
argument_list|)
return|;
if|if
condition|(
operator|!
operator|(
name|imm
operator|&
operator|~
literal|0xffff
operator|)
condition|)
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ORI
operator||
name|S
argument_list|(
name|ZERO_REG
argument_list|)
operator||
name|A
argument_list|(
name|reg
argument_list|)
operator||
name|IMM
argument_list|(
name|imm
argument_list|)
argument_list|)
return|;
if|if
condition|(
name|imm
operator|<=
name|SLJIT_W
argument_list|(
literal|0x7fffffff
argument_list|)
operator|&&
name|imm
operator|>=
name|SLJIT_W
argument_list|(
operator|-
literal|0x80000000
argument_list|)
condition|)
block|{
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDIS
operator||
name|D
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
literal|0
argument_list|)
operator||
name|IMM
argument_list|(
name|imm
operator|>>
literal|16
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|imm
operator|&
literal|0xffff
operator|)
condition|?
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ORI
operator||
name|S
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
name|reg
argument_list|)
operator||
name|IMM
argument_list|(
name|imm
argument_list|)
argument_list|)
else|:
name|SLJIT_SUCCESS
return|;
block|}
comment|/* Count leading zeroes. */
name|tmp
operator|=
operator|(
name|imm
operator|>=
literal|0
operator|)
condition|?
name|imm
else|:
operator|~
name|imm
expr_stmt|;
name|ASM_SLJIT_CLZ
argument_list|(
name|tmp
argument_list|,
name|shift
argument_list|)
expr_stmt|;
name|SLJIT_ASSERT
argument_list|(
name|shift
operator|>
literal|0
argument_list|)
expr_stmt|;
name|shift
operator|--
expr_stmt|;
name|tmp
operator|=
operator|(
name|imm
operator|<<
name|shift
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|tmp
operator|&
operator|~
literal|0xffff000000000000ul
operator|)
operator|==
literal|0
condition|)
block|{
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDI
operator||
name|D
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
literal|0
argument_list|)
operator||
name|IMM
argument_list|(
name|tmp
operator|>>
literal|48
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|shift
operator|+=
literal|15
expr_stmt|;
return|return
name|PUSH_RLDICR
argument_list|(
name|reg
argument_list|,
name|shift
argument_list|)
return|;
block|}
if|if
condition|(
operator|(
name|tmp
operator|&
operator|~
literal|0xffffffff00000000ul
operator|)
operator|==
literal|0
condition|)
block|{
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDIS
operator||
name|D
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
literal|0
argument_list|)
operator||
name|IMM
argument_list|(
name|tmp
operator|>>
literal|48
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ORI
operator||
name|S
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
name|reg
argument_list|)
operator||
name|IMM
argument_list|(
name|tmp
operator|>>
literal|32
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|shift
operator|+=
literal|31
expr_stmt|;
return|return
name|PUSH_RLDICR
argument_list|(
name|reg
argument_list|,
name|shift
argument_list|)
return|;
block|}
comment|/* Cut out the 16 bit from immediate. */
name|shift
operator|+=
literal|15
expr_stmt|;
name|tmp2
operator|=
name|imm
operator|&
operator|(
operator|(
literal|1ul
operator|<<
operator|(
literal|63
operator|-
name|shift
operator|)
operator|)
operator|-
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|tmp2
operator|<=
literal|0xffff
condition|)
block|{
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDI
operator||
name|D
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
literal|0
argument_list|)
operator||
name|IMM
argument_list|(
name|tmp
operator|>>
literal|48
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|PUSH_RLDICR
argument_list|(
name|reg
argument_list|,
name|shift
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ORI
operator||
name|S
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
name|reg
argument_list|)
operator||
name|tmp2
argument_list|)
return|;
block|}
if|if
condition|(
name|tmp2
operator|<=
literal|0xffffffff
condition|)
block|{
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDI
operator||
name|D
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
literal|0
argument_list|)
operator||
name|IMM
argument_list|(
name|tmp
operator|>>
literal|48
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|PUSH_RLDICR
argument_list|(
name|reg
argument_list|,
name|shift
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ORIS
operator||
name|S
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
name|reg
argument_list|)
operator||
operator|(
name|tmp2
operator|>>
literal|16
operator|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|imm
operator|&
literal|0xffff
operator|)
condition|?
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ORI
operator||
name|S
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
name|reg
argument_list|)
operator||
name|IMM
argument_list|(
name|tmp2
argument_list|)
argument_list|)
else|:
name|SLJIT_SUCCESS
return|;
block|}
name|ASM_SLJIT_CLZ
argument_list|(
name|tmp2
argument_list|,
name|shift2
argument_list|)
expr_stmt|;
name|tmp2
operator|<<=
name|shift2
expr_stmt|;
if|if
condition|(
operator|(
name|tmp2
operator|&
operator|~
literal|0xffff000000000000ul
operator|)
operator|==
literal|0
condition|)
block|{
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDI
operator||
name|D
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
literal|0
argument_list|)
operator||
name|IMM
argument_list|(
name|tmp
operator|>>
literal|48
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|shift2
operator|+=
literal|15
expr_stmt|;
name|shift
operator|+=
operator|(
literal|63
operator|-
name|shift2
operator|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|PUSH_RLDICR
argument_list|(
name|reg
argument_list|,
name|shift
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ORI
operator||
name|S
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
name|reg
argument_list|)
operator||
operator|(
name|tmp2
operator|>>
literal|48
operator|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|PUSH_RLDICR
argument_list|(
name|reg
argument_list|,
name|shift2
argument_list|)
return|;
block|}
comment|/* The general version. */
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDIS
operator||
name|D
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
literal|0
argument_list|)
operator||
name|IMM
argument_list|(
name|imm
operator|>>
literal|48
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ORI
operator||
name|S
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
name|reg
argument_list|)
operator||
name|IMM
argument_list|(
name|imm
operator|>>
literal|32
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|PUSH_RLDICR
argument_list|(
name|reg
argument_list|,
literal|31
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ORIS
operator||
name|S
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
name|reg
argument_list|)
operator||
name|IMM
argument_list|(
name|imm
operator|>>
literal|16
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ORI
operator||
name|S
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
name|reg
argument_list|)
operator||
name|IMM
argument_list|(
name|imm
argument_list|)
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* Simplified mnemonics: clrldi. */
end_comment
begin_define
DECL|macro|INS_CLEAR_LEFT
define|#
directive|define
name|INS_CLEAR_LEFT
parameter_list|(
name|dst
parameter_list|,
name|src
parameter_list|,
name|from
parameter_list|)
define|\
value|(RLDICL | S(src) | A(dst) | ((from)<< 6) | (1<< 5))
end_define
begin_comment
comment|/* Sign extension for integer operations. */
end_comment
begin_define
DECL|macro|UN_EXTS
define|#
directive|define
name|UN_EXTS
parameter_list|()
define|\
value|if ((flags& (ALT_SIGN_EXT | REG2_SOURCE)) == (ALT_SIGN_EXT | REG2_SOURCE)) { \ 		FAIL_IF(push_inst(compiler, EXTSW | S(src2) | A(TMP_REG2))); \ 		src2 = TMP_REG2; \ 	}
end_define
begin_define
DECL|macro|BIN_EXTS
define|#
directive|define
name|BIN_EXTS
parameter_list|()
define|\
value|if (flags& ALT_SIGN_EXT) { \ 		if (flags& REG1_SOURCE) { \ 			FAIL_IF(push_inst(compiler, EXTSW | S(src1) | A(TMP_REG1))); \ 			src1 = TMP_REG1; \ 		} \ 		if (flags& REG2_SOURCE) { \ 			FAIL_IF(push_inst(compiler, EXTSW | S(src2) | A(TMP_REG2))); \ 			src2 = TMP_REG2; \ 		} \ 	}
end_define
begin_define
DECL|macro|BIN_IMM_EXTS
define|#
directive|define
name|BIN_IMM_EXTS
parameter_list|()
define|\
value|if ((flags& (ALT_SIGN_EXT | REG1_SOURCE)) == (ALT_SIGN_EXT | REG1_SOURCE)) { \ 		FAIL_IF(push_inst(compiler, EXTSW | S(src1) | A(TMP_REG1))); \ 		src1 = TMP_REG1; \ 	}
end_define
begin_function
DECL|function|emit_single_op
specifier|static
name|SLJIT_INLINE
name|sljit_si
name|emit_single_op
parameter_list|(
name|struct
name|sljit_compiler
modifier|*
name|compiler
parameter_list|,
name|sljit_si
name|op
parameter_list|,
name|sljit_si
name|flags
parameter_list|,
name|sljit_si
name|dst
parameter_list|,
name|sljit_si
name|src1
parameter_list|,
name|sljit_si
name|src2
parameter_list|)
block|{
switch|switch
condition|(
name|op
condition|)
block|{
case|case
name|SLJIT_MOV
case|:
case|case
name|SLJIT_MOV_P
case|:
name|SLJIT_ASSERT
argument_list|(
name|src1
operator|==
name|TMP_REG1
argument_list|)
expr_stmt|;
if|if
condition|(
name|dst
operator|!=
name|src2
condition|)
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|OR
operator||
name|S
argument_list|(
name|src2
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|B
argument_list|(
name|src2
argument_list|)
argument_list|)
return|;
return|return
name|SLJIT_SUCCESS
return|;
case|case
name|SLJIT_MOV_UI
case|:
case|case
name|SLJIT_MOV_SI
case|:
name|SLJIT_ASSERT
argument_list|(
name|src1
operator|==
name|TMP_REG1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|flags
operator|&
operator|(
name|REG_DEST
operator||
name|REG2_SOURCE
operator|)
operator|)
operator|==
operator|(
name|REG_DEST
operator||
name|REG2_SOURCE
operator|)
condition|)
block|{
if|if
condition|(
name|op
operator|==
name|SLJIT_MOV_SI
condition|)
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|EXTSW
operator||
name|S
argument_list|(
name|src2
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
argument_list|)
return|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|INS_CLEAR_LEFT
argument_list|(
name|dst
argument_list|,
name|src2
argument_list|,
literal|0
argument_list|)
argument_list|)
return|;
block|}
else|else
block|{
name|SLJIT_ASSERT
argument_list|(
name|dst
operator|==
name|src2
argument_list|)
expr_stmt|;
block|}
return|return
name|SLJIT_SUCCESS
return|;
case|case
name|SLJIT_MOV_UB
case|:
case|case
name|SLJIT_MOV_SB
case|:
name|SLJIT_ASSERT
argument_list|(
name|src1
operator|==
name|TMP_REG1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|flags
operator|&
operator|(
name|REG_DEST
operator||
name|REG2_SOURCE
operator|)
operator|)
operator|==
operator|(
name|REG_DEST
operator||
name|REG2_SOURCE
operator|)
condition|)
block|{
if|if
condition|(
name|op
operator|==
name|SLJIT_MOV_SB
condition|)
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|EXTSB
operator||
name|S
argument_list|(
name|src2
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
argument_list|)
return|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|INS_CLEAR_LEFT
argument_list|(
name|dst
argument_list|,
name|src2
argument_list|,
literal|24
argument_list|)
argument_list|)
return|;
block|}
elseif|else
if|if
condition|(
operator|(
name|flags
operator|&
name|REG_DEST
operator|)
operator|&&
name|op
operator|==
name|SLJIT_MOV_SB
condition|)
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|EXTSB
operator||
name|S
argument_list|(
name|src2
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
argument_list|)
return|;
else|else
block|{
name|SLJIT_ASSERT
argument_list|(
name|dst
operator|==
name|src2
argument_list|)
expr_stmt|;
block|}
return|return
name|SLJIT_SUCCESS
return|;
case|case
name|SLJIT_MOV_UH
case|:
case|case
name|SLJIT_MOV_SH
case|:
name|SLJIT_ASSERT
argument_list|(
name|src1
operator|==
name|TMP_REG1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|flags
operator|&
operator|(
name|REG_DEST
operator||
name|REG2_SOURCE
operator|)
operator|)
operator|==
operator|(
name|REG_DEST
operator||
name|REG2_SOURCE
operator|)
condition|)
block|{
if|if
condition|(
name|op
operator|==
name|SLJIT_MOV_SH
condition|)
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|EXTSH
operator||
name|S
argument_list|(
name|src2
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
argument_list|)
return|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|INS_CLEAR_LEFT
argument_list|(
name|dst
argument_list|,
name|src2
argument_list|,
literal|16
argument_list|)
argument_list|)
return|;
block|}
else|else
block|{
name|SLJIT_ASSERT
argument_list|(
name|dst
operator|==
name|src2
argument_list|)
expr_stmt|;
block|}
return|return
name|SLJIT_SUCCESS
return|;
case|case
name|SLJIT_NOT
case|:
name|SLJIT_ASSERT
argument_list|(
name|src1
operator|==
name|TMP_REG1
argument_list|)
expr_stmt|;
name|UN_EXTS
argument_list|()
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|NOR
operator||
name|RC
argument_list|(
name|flags
argument_list|)
operator||
name|S
argument_list|(
name|src2
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|B
argument_list|(
name|src2
argument_list|)
argument_list|)
return|;
case|case
name|SLJIT_NEG
case|:
name|SLJIT_ASSERT
argument_list|(
name|src1
operator|==
name|TMP_REG1
argument_list|)
expr_stmt|;
name|UN_EXTS
argument_list|()
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|NEG
operator||
name|OERC
argument_list|(
name|flags
argument_list|)
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|src2
argument_list|)
argument_list|)
return|;
case|case
name|SLJIT_CLZ
case|:
name|SLJIT_ASSERT
argument_list|(
name|src1
operator|==
name|TMP_REG1
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|ALT_FORM1
condition|)
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|CNTLZW
operator||
name|RC
argument_list|(
name|flags
argument_list|)
operator||
name|S
argument_list|(
name|src2
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
argument_list|)
return|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|CNTLZD
operator||
name|RC
argument_list|(
name|flags
argument_list|)
operator||
name|S
argument_list|(
name|src2
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
argument_list|)
return|;
case|case
name|SLJIT_ADD
case|:
if|if
condition|(
name|flags
operator|&
name|ALT_FORM1
condition|)
block|{
comment|/* Flags does not set: BIN_IMM_EXTS unnecessary. */
name|SLJIT_ASSERT
argument_list|(
name|src2
operator|==
name|TMP_REG2
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDI
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|src1
argument_list|)
operator||
name|compiler
operator|->
name|imm
argument_list|)
return|;
block|}
if|if
condition|(
name|flags
operator|&
name|ALT_FORM2
condition|)
block|{
comment|/* Flags does not set: BIN_IMM_EXTS unnecessary. */
name|SLJIT_ASSERT
argument_list|(
name|src2
operator|==
name|TMP_REG2
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDIS
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|src1
argument_list|)
operator||
name|compiler
operator|->
name|imm
argument_list|)
return|;
block|}
if|if
condition|(
name|flags
operator|&
name|ALT_FORM3
condition|)
block|{
name|SLJIT_ASSERT
argument_list|(
name|src2
operator|==
name|TMP_REG2
argument_list|)
expr_stmt|;
name|BIN_IMM_EXTS
argument_list|()
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDIC
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|src1
argument_list|)
operator||
name|compiler
operator|->
name|imm
argument_list|)
return|;
block|}
if|if
condition|(
name|flags
operator|&
name|ALT_FORM4
condition|)
block|{
comment|/* Flags does not set: BIN_IMM_EXTS unnecessary. */
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDI
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|src1
argument_list|)
operator||
operator|(
name|compiler
operator|->
name|imm
operator|&
literal|0xffff
operator|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDIS
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
operator|(
operator|(
operator|(
name|compiler
operator|->
name|imm
operator|>>
literal|16
operator|)
operator|&
literal|0xffff
operator|)
operator|+
operator|(
operator|(
name|compiler
operator|->
name|imm
operator|>>
literal|15
operator|)
operator|&
literal|0x1
operator|)
operator|)
argument_list|)
return|;
block|}
if|if
condition|(
operator|!
operator|(
name|flags
operator|&
name|ALT_SET_FLAGS
operator|)
condition|)
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADD
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|src1
argument_list|)
operator||
name|B
argument_list|(
name|src2
argument_list|)
argument_list|)
return|;
name|BIN_EXTS
argument_list|()
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDC
operator||
name|OERC
argument_list|(
name|ALT_SET_FLAGS
argument_list|)
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|src1
argument_list|)
operator||
name|B
argument_list|(
name|src2
argument_list|)
argument_list|)
return|;
case|case
name|SLJIT_ADDC
case|:
if|if
condition|(
name|flags
operator|&
name|ALT_FORM1
condition|)
block|{
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|MFXER
operator||
name|D
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDE
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|src1
argument_list|)
operator||
name|B
argument_list|(
name|src2
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|MTXER
operator||
name|S
argument_list|(
literal|0
argument_list|)
argument_list|)
return|;
block|}
name|BIN_EXTS
argument_list|()
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDE
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|src1
argument_list|)
operator||
name|B
argument_list|(
name|src2
argument_list|)
argument_list|)
return|;
case|case
name|SLJIT_SUB
case|:
if|if
condition|(
name|flags
operator|&
name|ALT_FORM1
condition|)
block|{
comment|/* Flags does not set: BIN_IMM_EXTS unnecessary. */
name|SLJIT_ASSERT
argument_list|(
name|src2
operator|==
name|TMP_REG2
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SUBFIC
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|src1
argument_list|)
operator||
name|compiler
operator|->
name|imm
argument_list|)
return|;
block|}
if|if
condition|(
name|flags
operator|&
operator|(
name|ALT_FORM2
operator||
name|ALT_FORM3
operator|)
condition|)
block|{
name|SLJIT_ASSERT
argument_list|(
name|src2
operator|==
name|TMP_REG2
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|ALT_FORM2
condition|)
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|CMPI
operator||
name|CRD
argument_list|(
literal|0
operator||
operator|(
operator|(
name|flags
operator|&
name|ALT_SIGN_EXT
operator|)
condition|?
literal|0
else|:
literal|1
operator|)
argument_list|)
operator||
name|A
argument_list|(
name|src1
argument_list|)
operator||
name|compiler
operator|->
name|imm
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|ALT_FORM3
condition|)
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|CMPLI
operator||
name|CRD
argument_list|(
literal|4
operator||
operator|(
operator|(
name|flags
operator|&
name|ALT_SIGN_EXT
operator|)
condition|?
literal|0
else|:
literal|1
operator|)
argument_list|)
operator||
name|A
argument_list|(
name|src1
argument_list|)
operator||
name|compiler
operator|->
name|imm
argument_list|)
return|;
return|return
name|SLJIT_SUCCESS
return|;
block|}
if|if
condition|(
name|flags
operator|&
operator|(
name|ALT_FORM4
operator||
name|ALT_FORM5
operator|)
condition|)
block|{
if|if
condition|(
name|flags
operator|&
name|ALT_FORM4
condition|)
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|CMPL
operator||
name|CRD
argument_list|(
literal|4
operator||
operator|(
operator|(
name|flags
operator|&
name|ALT_SIGN_EXT
operator|)
condition|?
literal|0
else|:
literal|1
operator|)
argument_list|)
operator||
name|A
argument_list|(
name|src1
argument_list|)
operator||
name|B
argument_list|(
name|src2
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|ALT_FORM5
condition|)
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|CMP
operator||
name|CRD
argument_list|(
literal|0
operator||
operator|(
operator|(
name|flags
operator|&
name|ALT_SIGN_EXT
operator|)
condition|?
literal|0
else|:
literal|1
operator|)
argument_list|)
operator||
name|A
argument_list|(
name|src1
argument_list|)
operator||
name|B
argument_list|(
name|src2
argument_list|)
argument_list|)
return|;
return|return
name|SLJIT_SUCCESS
return|;
block|}
if|if
condition|(
operator|!
operator|(
name|flags
operator|&
name|ALT_SET_FLAGS
operator|)
condition|)
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SUBF
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|src2
argument_list|)
operator||
name|B
argument_list|(
name|src1
argument_list|)
argument_list|)
return|;
name|BIN_EXTS
argument_list|()
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|ALT_FORM6
condition|)
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|CMPL
operator||
name|CRD
argument_list|(
literal|4
operator||
operator|(
operator|(
name|flags
operator|&
name|ALT_SIGN_EXT
operator|)
condition|?
literal|0
else|:
literal|1
operator|)
argument_list|)
operator||
name|A
argument_list|(
name|src1
argument_list|)
operator||
name|B
argument_list|(
name|src2
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SUBFC
operator||
name|OERC
argument_list|(
name|ALT_SET_FLAGS
argument_list|)
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|src2
argument_list|)
operator||
name|B
argument_list|(
name|src1
argument_list|)
argument_list|)
return|;
case|case
name|SLJIT_SUBC
case|:
if|if
condition|(
name|flags
operator|&
name|ALT_FORM1
condition|)
block|{
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|MFXER
operator||
name|D
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SUBFE
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|src2
argument_list|)
operator||
name|B
argument_list|(
name|src1
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|MTXER
operator||
name|S
argument_list|(
literal|0
argument_list|)
argument_list|)
return|;
block|}
name|BIN_EXTS
argument_list|()
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SUBFE
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|src2
argument_list|)
operator||
name|B
argument_list|(
name|src1
argument_list|)
argument_list|)
return|;
case|case
name|SLJIT_MUL
case|:
if|if
condition|(
name|flags
operator|&
name|ALT_FORM1
condition|)
block|{
name|SLJIT_ASSERT
argument_list|(
name|src2
operator|==
name|TMP_REG2
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|MULLI
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|src1
argument_list|)
operator||
name|compiler
operator|->
name|imm
argument_list|)
return|;
block|}
name|BIN_EXTS
argument_list|()
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|ALT_FORM2
condition|)
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|MULLW
operator||
name|OERC
argument_list|(
name|flags
argument_list|)
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|src2
argument_list|)
operator||
name|B
argument_list|(
name|src1
argument_list|)
argument_list|)
return|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|MULLD
operator||
name|OERC
argument_list|(
name|flags
argument_list|)
operator||
name|D
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|src2
argument_list|)
operator||
name|B
argument_list|(
name|src1
argument_list|)
argument_list|)
return|;
case|case
name|SLJIT_AND
case|:
if|if
condition|(
name|flags
operator|&
name|ALT_FORM1
condition|)
block|{
name|SLJIT_ASSERT
argument_list|(
name|src2
operator|==
name|TMP_REG2
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ANDI
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|compiler
operator|->
name|imm
argument_list|)
return|;
block|}
if|if
condition|(
name|flags
operator|&
name|ALT_FORM2
condition|)
block|{
name|SLJIT_ASSERT
argument_list|(
name|src2
operator|==
name|TMP_REG2
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ANDIS
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|compiler
operator|->
name|imm
argument_list|)
return|;
block|}
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|AND
operator||
name|RC
argument_list|(
name|flags
argument_list|)
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|B
argument_list|(
name|src2
argument_list|)
argument_list|)
return|;
case|case
name|SLJIT_OR
case|:
if|if
condition|(
name|flags
operator|&
name|ALT_FORM1
condition|)
block|{
name|SLJIT_ASSERT
argument_list|(
name|src2
operator|==
name|TMP_REG2
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ORI
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|compiler
operator|->
name|imm
argument_list|)
return|;
block|}
if|if
condition|(
name|flags
operator|&
name|ALT_FORM2
condition|)
block|{
name|SLJIT_ASSERT
argument_list|(
name|src2
operator|==
name|TMP_REG2
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ORIS
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|compiler
operator|->
name|imm
argument_list|)
return|;
block|}
if|if
condition|(
name|flags
operator|&
name|ALT_FORM3
condition|)
block|{
name|SLJIT_ASSERT
argument_list|(
name|src2
operator|==
name|TMP_REG2
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ORI
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|IMM
argument_list|(
name|compiler
operator|->
name|imm
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ORIS
operator||
name|S
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|IMM
argument_list|(
name|compiler
operator|->
name|imm
operator|>>
literal|16
argument_list|)
argument_list|)
return|;
block|}
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|OR
operator||
name|RC
argument_list|(
name|flags
argument_list|)
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|B
argument_list|(
name|src2
argument_list|)
argument_list|)
return|;
case|case
name|SLJIT_XOR
case|:
if|if
condition|(
name|flags
operator|&
name|ALT_FORM1
condition|)
block|{
name|SLJIT_ASSERT
argument_list|(
name|src2
operator|==
name|TMP_REG2
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|XORI
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|compiler
operator|->
name|imm
argument_list|)
return|;
block|}
if|if
condition|(
name|flags
operator|&
name|ALT_FORM2
condition|)
block|{
name|SLJIT_ASSERT
argument_list|(
name|src2
operator|==
name|TMP_REG2
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|XORIS
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|compiler
operator|->
name|imm
argument_list|)
return|;
block|}
if|if
condition|(
name|flags
operator|&
name|ALT_FORM3
condition|)
block|{
name|SLJIT_ASSERT
argument_list|(
name|src2
operator|==
name|TMP_REG2
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|XORI
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|IMM
argument_list|(
name|compiler
operator|->
name|imm
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|XORIS
operator||
name|S
argument_list|(
name|dst
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|IMM
argument_list|(
name|compiler
operator|->
name|imm
operator|>>
literal|16
argument_list|)
argument_list|)
return|;
block|}
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|XOR
operator||
name|RC
argument_list|(
name|flags
argument_list|)
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|B
argument_list|(
name|src2
argument_list|)
argument_list|)
return|;
case|case
name|SLJIT_SHL
case|:
if|if
condition|(
name|flags
operator|&
name|ALT_FORM1
condition|)
block|{
name|SLJIT_ASSERT
argument_list|(
name|src2
operator|==
name|TMP_REG2
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|ALT_FORM2
condition|)
block|{
name|compiler
operator|->
name|imm
operator|&=
literal|0x1f
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|RLWINM
operator||
name|RC
argument_list|(
name|flags
argument_list|)
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
operator|(
name|compiler
operator|->
name|imm
operator|<<
literal|11
operator|)
operator||
operator|(
operator|(
literal|31
operator|-
name|compiler
operator|->
name|imm
operator|)
operator|<<
literal|1
operator|)
argument_list|)
return|;
block|}
else|else
block|{
name|compiler
operator|->
name|imm
operator|&=
literal|0x3f
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|RLDI
argument_list|(
name|dst
argument_list|,
name|src1
argument_list|,
name|compiler
operator|->
name|imm
argument_list|,
literal|63
operator|-
name|compiler
operator|->
name|imm
argument_list|,
literal|1
argument_list|)
operator||
name|RC
argument_list|(
name|flags
argument_list|)
argument_list|)
return|;
block|}
block|}
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
operator|(
operator|(
name|flags
operator|&
name|ALT_FORM2
operator|)
condition|?
name|SLW
else|:
name|SLD
operator|)
operator||
name|RC
argument_list|(
name|flags
argument_list|)
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|B
argument_list|(
name|src2
argument_list|)
argument_list|)
return|;
case|case
name|SLJIT_LSHR
case|:
if|if
condition|(
name|flags
operator|&
name|ALT_FORM1
condition|)
block|{
name|SLJIT_ASSERT
argument_list|(
name|src2
operator|==
name|TMP_REG2
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|ALT_FORM2
condition|)
block|{
name|compiler
operator|->
name|imm
operator|&=
literal|0x1f
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|RLWINM
operator||
name|RC
argument_list|(
name|flags
argument_list|)
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
operator|(
operator|(
operator|(
literal|32
operator|-
name|compiler
operator|->
name|imm
operator|)
operator|&
literal|0x1f
operator|)
operator|<<
literal|11
operator|)
operator||
operator|(
name|compiler
operator|->
name|imm
operator|<<
literal|6
operator|)
operator||
operator|(
literal|31
operator|<<
literal|1
operator|)
argument_list|)
return|;
block|}
else|else
block|{
name|compiler
operator|->
name|imm
operator|&=
literal|0x3f
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|RLDI
argument_list|(
name|dst
argument_list|,
name|src1
argument_list|,
literal|64
operator|-
name|compiler
operator|->
name|imm
argument_list|,
name|compiler
operator|->
name|imm
argument_list|,
literal|0
argument_list|)
operator||
name|RC
argument_list|(
name|flags
argument_list|)
argument_list|)
return|;
block|}
block|}
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
operator|(
operator|(
name|flags
operator|&
name|ALT_FORM2
operator|)
condition|?
name|SRW
else|:
name|SRD
operator|)
operator||
name|RC
argument_list|(
name|flags
argument_list|)
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|B
argument_list|(
name|src2
argument_list|)
argument_list|)
return|;
case|case
name|SLJIT_ASHR
case|:
if|if
condition|(
name|flags
operator|&
name|ALT_FORM3
condition|)
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|MFXER
operator||
name|D
argument_list|(
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|ALT_FORM1
condition|)
block|{
name|SLJIT_ASSERT
argument_list|(
name|src2
operator|==
name|TMP_REG2
argument_list|)
expr_stmt|;
if|if
condition|(
name|flags
operator|&
name|ALT_FORM2
condition|)
block|{
name|compiler
operator|->
name|imm
operator|&=
literal|0x1f
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SRAWI
operator||
name|RC
argument_list|(
name|flags
argument_list|)
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
operator|(
name|compiler
operator|->
name|imm
operator|<<
literal|11
operator|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|compiler
operator|->
name|imm
operator|&=
literal|0x3f
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|SRADI
operator||
name|RC
argument_list|(
name|flags
argument_list|)
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
operator|(
operator|(
name|compiler
operator|->
name|imm
operator|&
literal|0x1f
operator|)
operator|<<
literal|11
operator|)
operator||
operator|(
operator|(
name|compiler
operator|->
name|imm
operator|&
literal|0x20
operator|)
operator|>>
literal|4
operator|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
operator|(
operator|(
name|flags
operator|&
name|ALT_FORM2
operator|)
condition|?
name|SRAW
else|:
name|SRAD
operator|)
operator||
name|RC
argument_list|(
name|flags
argument_list|)
operator||
name|S
argument_list|(
name|src1
argument_list|)
operator||
name|A
argument_list|(
name|dst
argument_list|)
operator||
name|B
argument_list|(
name|src2
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
operator|(
name|flags
operator|&
name|ALT_FORM3
operator|)
condition|?
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|MTXER
operator||
name|S
argument_list|(
literal|0
argument_list|)
argument_list|)
else|:
name|SLJIT_SUCCESS
return|;
block|}
name|SLJIT_ASSERT_STOP
argument_list|()
expr_stmt|;
return|return
name|SLJIT_SUCCESS
return|;
block|}
end_function
begin_function
DECL|function|emit_const
specifier|static
name|SLJIT_INLINE
name|sljit_si
name|emit_const
parameter_list|(
name|struct
name|sljit_compiler
modifier|*
name|compiler
parameter_list|,
name|sljit_si
name|reg
parameter_list|,
name|sljit_sw
name|init_value
parameter_list|)
block|{
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ADDIS
operator||
name|D
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
literal|0
argument_list|)
operator||
name|IMM
argument_list|(
name|init_value
operator|>>
literal|48
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ORI
operator||
name|S
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
name|reg
argument_list|)
operator||
name|IMM
argument_list|(
name|init_value
operator|>>
literal|32
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|PUSH_RLDICR
argument_list|(
name|reg
argument_list|,
literal|31
argument_list|)
argument_list|)
expr_stmt|;
name|FAIL_IF
argument_list|(
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ORIS
operator||
name|S
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
name|reg
argument_list|)
operator||
name|IMM
argument_list|(
name|init_value
operator|>>
literal|16
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|push_inst
argument_list|(
name|compiler
argument_list|,
name|ORI
operator||
name|S
argument_list|(
name|reg
argument_list|)
operator||
name|A
argument_list|(
name|reg
argument_list|)
operator||
name|IMM
argument_list|(
name|init_value
argument_list|)
argument_list|)
return|;
block|}
end_function
begin_function
DECL|function|sljit_set_jump_addr
name|SLJIT_API_FUNC_ATTRIBUTE
name|void
name|sljit_set_jump_addr
parameter_list|(
name|sljit_uw
name|addr
parameter_list|,
name|sljit_uw
name|new_addr
parameter_list|)
block|{
name|sljit_ins
modifier|*
name|inst
init|=
operator|(
name|sljit_ins
operator|*
operator|)
name|addr
decl_stmt|;
name|inst
index|[
literal|0
index|]
operator|=
operator|(
name|inst
index|[
literal|0
index|]
operator|&
literal|0xffff0000
operator|)
operator||
operator|(
operator|(
name|new_addr
operator|>>
literal|48
operator|)
operator|&
literal|0xffff
operator|)
expr_stmt|;
name|inst
index|[
literal|1
index|]
operator|=
operator|(
name|inst
index|[
literal|1
index|]
operator|&
literal|0xffff0000
operator|)
operator||
operator|(
operator|(
name|new_addr
operator|>>
literal|32
operator|)
operator|&
literal|0xffff
operator|)
expr_stmt|;
name|inst
index|[
literal|3
index|]
operator|=
operator|(
name|inst
index|[
literal|3
index|]
operator|&
literal|0xffff0000
operator|)
operator||
operator|(
operator|(
name|new_addr
operator|>>
literal|16
operator|)
operator|&
literal|0xffff
operator|)
expr_stmt|;
name|inst
index|[
literal|4
index|]
operator|=
operator|(
name|inst
index|[
literal|4
index|]
operator|&
literal|0xffff0000
operator|)
operator||
operator|(
name|new_addr
operator|&
literal|0xffff
operator|)
expr_stmt|;
name|SLJIT_CACHE_FLUSH
argument_list|(
name|inst
argument_list|,
name|inst
operator|+
literal|5
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|sljit_set_const
name|SLJIT_API_FUNC_ATTRIBUTE
name|void
name|sljit_set_const
parameter_list|(
name|sljit_uw
name|addr
parameter_list|,
name|sljit_sw
name|new_constant
parameter_list|)
block|{
name|sljit_ins
modifier|*
name|inst
init|=
operator|(
name|sljit_ins
operator|*
operator|)
name|addr
decl_stmt|;
name|inst
index|[
literal|0
index|]
operator|=
operator|(
name|inst
index|[
literal|0
index|]
operator|&
literal|0xffff0000
operator|)
operator||
operator|(
operator|(
name|new_constant
operator|>>
literal|48
operator|)
operator|&
literal|0xffff
operator|)
expr_stmt|;
name|inst
index|[
literal|1
index|]
operator|=
operator|(
name|inst
index|[
literal|1
index|]
operator|&
literal|0xffff0000
operator|)
operator||
operator|(
operator|(
name|new_constant
operator|>>
literal|32
operator|)
operator|&
literal|0xffff
operator|)
expr_stmt|;
name|inst
index|[
literal|3
index|]
operator|=
operator|(
name|inst
index|[
literal|3
index|]
operator|&
literal|0xffff0000
operator|)
operator||
operator|(
operator|(
name|new_constant
operator|>>
literal|16
operator|)
operator|&
literal|0xffff
operator|)
expr_stmt|;
name|inst
index|[
literal|4
index|]
operator|=
operator|(
name|inst
index|[
literal|4
index|]
operator|&
literal|0xffff0000
operator|)
operator||
operator|(
name|new_constant
operator|&
literal|0xffff
operator|)
expr_stmt|;
name|SLJIT_CACHE_FLUSH
argument_list|(
name|inst
argument_list|,
name|inst
operator|+
literal|5
argument_list|)
expr_stmt|;
block|}
end_function
end_unit
