begin_unit
begin_comment
comment|//
end_comment
begin_comment
comment|// Copyright (c) 2002-2013 The ANGLE Project Authors. All rights reserved.
end_comment
begin_comment
comment|// Use of this source code is governed by a BSD-style license that can be
end_comment
begin_comment
comment|// found in the LICENSE file.
end_comment
begin_comment
comment|//
end_comment
begin_include
include|#
directive|include
file|"compiler/InitializeGLPosition.h"
end_include
begin_include
include|#
directive|include
file|"compiler/debug.h"
end_include
begin_function
DECL|function|visitAggregate
name|bool
name|InitializeGLPosition
operator|::
name|visitAggregate
parameter_list|(
name|Visit
name|visit
parameter_list|,
name|TIntermAggregate
modifier|*
name|node
parameter_list|)
block|{
name|bool
name|visitChildren
init|=
operator|!
name|mCodeInserted
decl_stmt|;
switch|switch
condition|(
name|node
operator|->
name|getOp
argument_list|()
condition|)
block|{
case|case
name|EOpSequence
case|:
break|break;
case|case
name|EOpFunction
case|:
block|{
comment|// Function definition.
name|ASSERT
argument_list|(
name|visit
operator|==
name|PreVisit
argument_list|)
expr_stmt|;
if|if
condition|(
name|node
operator|->
name|getName
argument_list|()
operator|==
literal|"main("
condition|)
block|{
name|TIntermSequence
modifier|&
name|sequence
init|=
name|node
operator|->
name|getSequence
argument_list|()
decl_stmt|;
name|ASSERT
argument_list|(
operator|(
name|sequence
operator|.
name|size
argument_list|()
operator|==
literal|1
operator|)
operator|||
operator|(
name|sequence
operator|.
name|size
argument_list|()
operator|==
literal|2
operator|)
argument_list|)
expr_stmt|;
name|TIntermAggregate
modifier|*
name|body
init|=
name|NULL
decl_stmt|;
if|if
condition|(
name|sequence
operator|.
name|size
argument_list|()
operator|==
literal|1
condition|)
block|{
name|body
operator|=
operator|new
name|TIntermAggregate
argument_list|(
name|EOpSequence
argument_list|)
expr_stmt|;
name|sequence
operator|.
name|push_back
argument_list|(
name|body
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|body
operator|=
name|sequence
index|[
literal|1
index|]
operator|->
name|getAsAggregate
argument_list|()
expr_stmt|;
block|}
name|ASSERT
argument_list|(
name|body
argument_list|)
expr_stmt|;
name|insertCode
argument_list|(
name|body
operator|->
name|getSequence
argument_list|()
argument_list|)
expr_stmt|;
name|mCodeInserted
operator|=
literal|true
expr_stmt|;
block|}
break|break;
block|}
default|default:
name|visitChildren
operator|=
literal|false
expr_stmt|;
break|break;
block|}
return|return
name|visitChildren
return|;
block|}
end_function
begin_function
DECL|function|insertCode
name|void
name|InitializeGLPosition
operator|::
name|insertCode
parameter_list|(
name|TIntermSequence
modifier|&
name|sequence
parameter_list|)
block|{
name|TIntermBinary
modifier|*
name|binary
init|=
operator|new
name|TIntermBinary
argument_list|(
name|EOpAssign
argument_list|)
decl_stmt|;
name|sequence
operator|.
name|insert
argument_list|(
name|sequence
operator|.
name|begin
argument_list|()
argument_list|,
name|binary
argument_list|)
expr_stmt|;
name|TIntermSymbol
modifier|*
name|left
init|=
operator|new
name|TIntermSymbol
argument_list|(
literal|0
argument_list|,
literal|"gl_Position"
argument_list|,
name|TType
argument_list|(
name|EbtFloat
argument_list|,
name|EbpUndefined
argument_list|,
name|EvqPosition
argument_list|,
literal|4
argument_list|)
argument_list|)
decl_stmt|;
name|binary
operator|->
name|setLeft
argument_list|(
name|left
argument_list|)
expr_stmt|;
name|ConstantUnion
modifier|*
name|u
init|=
operator|new
name|ConstantUnion
index|[
literal|4
index|]
decl_stmt|;
for|for
control|(
name|int
name|ii
init|=
literal|0
init|;
name|ii
operator|<
literal|3
condition|;
operator|++
name|ii
control|)
name|u
index|[
name|ii
index|]
operator|.
name|setFConst
argument_list|(
literal|0.0f
argument_list|)
expr_stmt|;
name|u
index|[
literal|3
index|]
operator|.
name|setFConst
argument_list|(
literal|1.0f
argument_list|)
expr_stmt|;
name|TIntermConstantUnion
modifier|*
name|right
init|=
operator|new
name|TIntermConstantUnion
argument_list|(
name|u
argument_list|,
name|TType
argument_list|(
name|EbtFloat
argument_list|,
name|EbpUndefined
argument_list|,
name|EvqConst
argument_list|,
literal|4
argument_list|)
argument_list|)
decl_stmt|;
name|binary
operator|->
name|setRight
argument_list|(
name|right
argument_list|)
expr_stmt|;
block|}
end_function
end_unit
