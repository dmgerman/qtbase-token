begin_unit
begin_comment
comment|/***************************************************************************/
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  ftcbasic.c                                                             */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*    The FreeType basic cache interface (body).                           */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  Copyright 2003, 2004, 2005, 2006, 2007, 2009 by                        */
end_comment
begin_comment
comment|/*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  This file is part of the FreeType project, and may only be used,       */
end_comment
begin_comment
comment|/*  modified, and distributed under the terms of the FreeType project      */
end_comment
begin_comment
comment|/*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */
end_comment
begin_comment
comment|/*  this file you indicate that you have read the license and              */
end_comment
begin_comment
comment|/*  understand and accept it fully.                                        */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/***************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<ft2build.h>
end_include
begin_include
include|#
directive|include
include|FT_INTERNAL_DEBUG_H
end_include
begin_include
include|#
directive|include
include|FT_CACHE_H
end_include
begin_include
include|#
directive|include
file|"ftcglyph.h"
end_include
begin_include
include|#
directive|include
file|"ftcimage.h"
end_include
begin_include
include|#
directive|include
file|"ftcsbits.h"
end_include
begin_include
include|#
directive|include
file|"ftccback.h"
end_include
begin_include
include|#
directive|include
file|"ftcerror.h"
end_include
begin_define
DECL|macro|FT_COMPONENT
define|#
directive|define
name|FT_COMPONENT
value|trace_cache
end_define
begin_ifdef
ifdef|#
directive|ifdef
name|FT_CONFIG_OPTION_OLD_INTERNALS
end_ifdef
begin_comment
comment|/*    *  These structures correspond to the FTC_Font and FTC_ImageDesc types    *  that were defined in version 2.1.7.    */
end_comment
begin_typedef
DECL|struct|FTC_OldFontRec_
typedef|typedef
struct|struct
name|FTC_OldFontRec_
block|{
DECL|member|face_id
name|FTC_FaceID
name|face_id
decl_stmt|;
DECL|member|pix_width
name|FT_UShort
name|pix_width
decl_stmt|;
DECL|member|pix_height
name|FT_UShort
name|pix_height
decl_stmt|;
block|}
DECL|typedef|FTC_OldFontRec
DECL|typedef|FTC_OldFont
name|FTC_OldFontRec
operator|,
typedef|*
name|FTC_OldFont
typedef|;
end_typedef
begin_typedef
DECL|struct|FTC_OldImageDescRec_
typedef|typedef
struct|struct
name|FTC_OldImageDescRec_
block|{
DECL|member|font
name|FTC_OldFontRec
name|font
decl_stmt|;
DECL|member|flags
name|FT_UInt32
name|flags
decl_stmt|;
block|}
DECL|typedef|FTC_OldImageDescRec
DECL|typedef|FTC_OldImageDesc
name|FTC_OldImageDescRec
operator|,
typedef|*
name|FTC_OldImageDesc
typedef|;
end_typedef
begin_comment
comment|/*    *  Notice that FTC_OldImageDescRec and FTC_ImageTypeRec are nearly    *  identical, bit-wise.  The only difference is that the `width' and    *  `height' fields are expressed as 16-bit integers in the old structure,    *  and as normal `int' in the new one.    *    *  We are going to perform a weird hack to detect which structure is    *  being passed to the image and sbit caches.  If the new structure's    *  `width' is larger than 0x10000, we assume that we are really receiving    *  an FTC_OldImageDesc.    */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* FT_CONFIG_OPTION_OLD_INTERNALS */
end_comment
begin_comment
comment|/*    *  Basic Families    *    */
end_comment
begin_typedef
DECL|struct|FTC_BasicAttrRec_
typedef|typedef
struct|struct
name|FTC_BasicAttrRec_
block|{
DECL|member|scaler
name|FTC_ScalerRec
name|scaler
decl_stmt|;
DECL|member|load_flags
name|FT_UInt
name|load_flags
decl_stmt|;
block|}
DECL|typedef|FTC_BasicAttrRec
DECL|typedef|FTC_BasicAttrs
name|FTC_BasicAttrRec
operator|,
typedef|*
name|FTC_BasicAttrs
typedef|;
end_typedef
begin_define
DECL|macro|FTC_BASIC_ATTR_COMPARE
define|#
directive|define
name|FTC_BASIC_ATTR_COMPARE
parameter_list|(
name|a
parameter_list|,
name|b
parameter_list|)
define|\
value|FT_BOOL( FTC_SCALER_COMPARE(&(a)->scaler,&(b)->scaler )&& \                    (a)->load_flags == (b)->load_flags               )
end_define
begin_define
DECL|macro|FTC_BASIC_ATTR_HASH
define|#
directive|define
name|FTC_BASIC_ATTR_HASH
parameter_list|(
name|a
parameter_list|)
define|\
value|( FTC_SCALER_HASH(&(a)->scaler ) + 31*(a)->load_flags )
end_define
begin_typedef
DECL|struct|FTC_BasicQueryRec_
typedef|typedef
struct|struct
name|FTC_BasicQueryRec_
block|{
DECL|member|gquery
name|FTC_GQueryRec
name|gquery
decl_stmt|;
DECL|member|attrs
name|FTC_BasicAttrRec
name|attrs
decl_stmt|;
block|}
DECL|typedef|FTC_BasicQueryRec
DECL|typedef|FTC_BasicQuery
name|FTC_BasicQueryRec
operator|,
typedef|*
name|FTC_BasicQuery
typedef|;
end_typedef
begin_typedef
DECL|struct|FTC_BasicFamilyRec_
typedef|typedef
struct|struct
name|FTC_BasicFamilyRec_
block|{
DECL|member|family
name|FTC_FamilyRec
name|family
decl_stmt|;
DECL|member|attrs
name|FTC_BasicAttrRec
name|attrs
decl_stmt|;
block|}
DECL|typedef|FTC_BasicFamilyRec
DECL|typedef|FTC_BasicFamily
name|FTC_BasicFamilyRec
operator|,
typedef|*
name|FTC_BasicFamily
typedef|;
end_typedef
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_Bool
argument_list|)
end_macro
begin_macro
name|ftc_basic_family_compare
argument_list|(
argument|FTC_MruNode  ftcfamily
argument_list|,
argument|FT_Pointer   ftcquery
argument_list|)
end_macro
begin_block
block|{
name|FTC_BasicFamily
name|family
init|=
operator|(
name|FTC_BasicFamily
operator|)
name|ftcfamily
decl_stmt|;
name|FTC_BasicQuery
name|query
init|=
operator|(
name|FTC_BasicQuery
operator|)
name|ftcquery
decl_stmt|;
return|return
name|FTC_BASIC_ATTR_COMPARE
argument_list|(
operator|&
name|family
operator|->
name|attrs
argument_list|,
operator|&
name|query
operator|->
name|attrs
argument_list|)
return|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|ftc_basic_family_init
argument_list|(
argument|FTC_MruNode  ftcfamily
argument_list|,
argument|FT_Pointer   ftcquery
argument_list|,
argument|FT_Pointer   ftccache
argument_list|)
end_macro
begin_block
block|{
name|FTC_BasicFamily
name|family
init|=
operator|(
name|FTC_BasicFamily
operator|)
name|ftcfamily
decl_stmt|;
name|FTC_BasicQuery
name|query
init|=
operator|(
name|FTC_BasicQuery
operator|)
name|ftcquery
decl_stmt|;
name|FTC_Cache
name|cache
init|=
operator|(
name|FTC_Cache
operator|)
name|ftccache
decl_stmt|;
name|FTC_Family_Init
argument_list|(
name|FTC_FAMILY
argument_list|(
name|family
argument_list|)
argument_list|,
name|cache
argument_list|)
expr_stmt|;
name|family
operator|->
name|attrs
operator|=
name|query
operator|->
name|attrs
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_UInt
argument_list|)
end_macro
begin_macro
name|ftc_basic_family_get_count
argument_list|(
argument|FTC_Family   ftcfamily
argument_list|,
argument|FTC_Manager  manager
argument_list|)
end_macro
begin_block
block|{
name|FTC_BasicFamily
name|family
init|=
operator|(
name|FTC_BasicFamily
operator|)
name|ftcfamily
decl_stmt|;
name|FT_Error
name|error
decl_stmt|;
name|FT_Face
name|face
decl_stmt|;
name|FT_UInt
name|result
init|=
literal|0
decl_stmt|;
name|error
operator|=
name|FTC_Manager_LookupFace
argument_list|(
name|manager
argument_list|,
name|family
operator|->
name|attrs
operator|.
name|scaler
operator|.
name|face_id
argument_list|,
operator|&
name|face
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
operator|||
operator|!
name|face
condition|)
return|return
name|result
return|;
if|if
condition|(
operator|(
name|FT_ULong
operator|)
name|face
operator|->
name|num_glyphs
operator|>
name|FT_UINT_MAX
operator|||
literal|0
operator|>
name|face
operator|->
name|num_glyphs
condition|)
block|{
name|FT_TRACE1
argument_list|(
operator|(
literal|"ftc_basic_family_get_count: too large number of glyphs "
operator|)
argument_list|)
expr_stmt|;
name|FT_TRACE1
argument_list|(
operator|(
literal|"in this face, truncated\n"
operator|,
name|face
operator|->
name|num_glyphs
operator|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|error
condition|)
name|result
operator|=
operator|(
name|FT_UInt
operator|)
name|face
operator|->
name|num_glyphs
expr_stmt|;
return|return
name|result
return|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|ftc_basic_family_load_bitmap
argument_list|(
argument|FTC_Family   ftcfamily
argument_list|,
argument|FT_UInt      gindex
argument_list|,
argument|FTC_Manager  manager
argument_list|,
argument|FT_Face     *aface
argument_list|)
end_macro
begin_block
block|{
name|FTC_BasicFamily
name|family
init|=
operator|(
name|FTC_BasicFamily
operator|)
name|ftcfamily
decl_stmt|;
name|FT_Error
name|error
decl_stmt|;
name|FT_Size
name|size
decl_stmt|;
name|error
operator|=
name|FTC_Manager_LookupSize
argument_list|(
name|manager
argument_list|,
operator|&
name|family
operator|->
name|attrs
operator|.
name|scaler
argument_list|,
operator|&
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|error
condition|)
block|{
name|FT_Face
name|face
init|=
name|size
operator|->
name|face
decl_stmt|;
name|error
operator|=
name|FT_Load_Glyph
argument_list|(
name|face
argument_list|,
name|gindex
argument_list|,
name|family
operator|->
name|attrs
operator|.
name|load_flags
operator||
name|FT_LOAD_RENDER
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|error
condition|)
operator|*
name|aface
operator|=
name|face
expr_stmt|;
block|}
return|return
name|error
return|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|ftc_basic_family_load_glyph
argument_list|(
argument|FTC_Family  ftcfamily
argument_list|,
argument|FT_UInt     gindex
argument_list|,
argument|FTC_Cache   cache
argument_list|,
argument|FT_Glyph   *aglyph
argument_list|)
end_macro
begin_block
block|{
name|FTC_BasicFamily
name|family
init|=
operator|(
name|FTC_BasicFamily
operator|)
name|ftcfamily
decl_stmt|;
name|FT_Error
name|error
decl_stmt|;
name|FTC_Scaler
name|scaler
init|=
operator|&
name|family
operator|->
name|attrs
operator|.
name|scaler
decl_stmt|;
name|FT_Face
name|face
decl_stmt|;
name|FT_Size
name|size
decl_stmt|;
comment|/* we will now load the glyph image */
name|error
operator|=
name|FTC_Manager_LookupSize
argument_list|(
name|cache
operator|->
name|manager
argument_list|,
name|scaler
argument_list|,
operator|&
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|error
condition|)
block|{
name|face
operator|=
name|size
operator|->
name|face
expr_stmt|;
name|error
operator|=
name|FT_Load_Glyph
argument_list|(
name|face
argument_list|,
name|gindex
argument_list|,
name|family
operator|->
name|attrs
operator|.
name|load_flags
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|error
condition|)
block|{
if|if
condition|(
name|face
operator|->
name|glyph
operator|->
name|format
operator|==
name|FT_GLYPH_FORMAT_BITMAP
operator|||
name|face
operator|->
name|glyph
operator|->
name|format
operator|==
name|FT_GLYPH_FORMAT_OUTLINE
condition|)
block|{
comment|/* ok, copy it */
name|FT_Glyph
name|glyph
decl_stmt|;
name|error
operator|=
name|FT_Get_Glyph
argument_list|(
name|face
operator|->
name|glyph
argument_list|,
operator|&
name|glyph
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|error
condition|)
block|{
operator|*
name|aglyph
operator|=
name|glyph
expr_stmt|;
goto|goto
name|Exit
goto|;
block|}
block|}
else|else
name|error
operator|=
name|FTC_Err_Invalid_Argument
expr_stmt|;
block|}
block|}
name|Exit
label|:
return|return
name|error
return|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_Bool
argument_list|)
end_macro
begin_macro
name|ftc_basic_gnode_compare_faceid
argument_list|(
argument|FTC_Node    ftcgnode
argument_list|,
argument|FT_Pointer  ftcface_id
argument_list|,
argument|FTC_Cache   cache
argument_list|)
end_macro
begin_block
block|{
name|FTC_GNode
name|gnode
init|=
operator|(
name|FTC_GNode
operator|)
name|ftcgnode
decl_stmt|;
name|FTC_FaceID
name|face_id
init|=
operator|(
name|FTC_FaceID
operator|)
name|ftcface_id
decl_stmt|;
name|FTC_BasicFamily
name|family
init|=
operator|(
name|FTC_BasicFamily
operator|)
name|gnode
operator|->
name|family
decl_stmt|;
name|FT_Bool
name|result
decl_stmt|;
name|result
operator|=
name|FT_BOOL
argument_list|(
name|family
operator|->
name|attrs
operator|.
name|scaler
operator|.
name|face_id
operator|==
name|face_id
argument_list|)
expr_stmt|;
if|if
condition|(
name|result
condition|)
block|{
comment|/* we must call this function to avoid this node from appearing        * in later lookups with the same face_id!        */
name|FTC_GNode_UnselectFamily
argument_list|(
name|gnode
argument_list|,
name|cache
argument_list|)
expr_stmt|;
block|}
return|return
name|result
return|;
block|}
end_block
begin_comment
comment|/*   *   * basic image cache   *   */
end_comment
begin_decl_stmt
name|FT_CALLBACK_TABLE_DEF
DECL|variable|ftc_basic_image_family_class
specifier|const
name|FTC_IFamilyClassRec
name|ftc_basic_image_family_class
init|=
block|{
block|{
sizeof|sizeof
argument_list|(
name|FTC_BasicFamilyRec
argument_list|)
block|,
name|ftc_basic_family_compare
block|,
name|ftc_basic_family_init
block|,
literal|0
block|,
comment|/* FTC_MruNode_ResetFunc */
literal|0
comment|/* FTC_MruNode_DoneFunc  */
block|}
block|,
name|ftc_basic_family_load_glyph
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
name|FT_CALLBACK_TABLE_DEF
DECL|variable|ftc_basic_image_cache_class
specifier|const
name|FTC_GCacheClassRec
name|ftc_basic_image_cache_class
init|=
block|{
block|{
name|ftc_inode_new
block|,
name|ftc_inode_weight
block|,
name|ftc_gnode_compare
block|,
name|ftc_basic_gnode_compare_faceid
block|,
name|ftc_inode_free
block|,
sizeof|sizeof
argument_list|(
name|FTC_GCacheRec
argument_list|)
block|,
name|ftc_gcache_init
block|,
name|ftc_gcache_done
block|}
block|,
operator|(
name|FTC_MruListClass
operator|)
operator|&
name|ftc_basic_image_family_class
block|}
decl_stmt|;
end_decl_stmt
begin_comment
comment|/* documentation is in ftcache.h */
end_comment
begin_macro
DECL|function|FT_EXPORT_DEF
name|FT_EXPORT_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|FTC_ImageCache_New
argument_list|(
argument|FTC_Manager      manager
argument_list|,
argument|FTC_ImageCache  *acache
argument_list|)
end_macro
begin_block
block|{
return|return
name|FTC_GCache_New
argument_list|(
name|manager
argument_list|,
operator|&
name|ftc_basic_image_cache_class
argument_list|,
operator|(
name|FTC_GCache
operator|*
operator|)
name|acache
argument_list|)
return|;
block|}
end_block
begin_comment
comment|/* documentation is in ftcache.h */
end_comment
begin_macro
DECL|function|FT_EXPORT_DEF
name|FT_EXPORT_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|FTC_ImageCache_Lookup
argument_list|(
argument|FTC_ImageCache  cache
argument_list|,
argument|FTC_ImageType   type
argument_list|,
argument|FT_UInt         gindex
argument_list|,
argument|FT_Glyph       *aglyph
argument_list|,
argument|FTC_Node       *anode
argument_list|)
end_macro
begin_block
block|{
name|FTC_BasicQueryRec
name|query
decl_stmt|;
name|FTC_Node
name|node
init|=
literal|0
decl_stmt|;
comment|/* make compiler happy */
name|FT_Error
name|error
decl_stmt|;
name|FT_UInt32
name|hash
decl_stmt|;
comment|/* some argument checks are delayed to FTC_Cache_Lookup */
if|if
condition|(
operator|!
name|aglyph
condition|)
block|{
name|error
operator|=
name|FTC_Err_Invalid_Argument
expr_stmt|;
goto|goto
name|Exit
goto|;
block|}
operator|*
name|aglyph
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|anode
condition|)
operator|*
name|anode
operator|=
name|NULL
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|FT_CONFIG_OPTION_OLD_INTERNALS
argument_list|)
operator|&&
operator|(
name|FT_INT_MAX
operator|>
literal|0xFFFFU
operator|)
comment|/*      *  This one is a major hack used to detect whether we are passed a      *  regular FTC_ImageType handle, or a legacy FTC_OldImageDesc one.      */
if|if
condition|(
operator|(
name|FT_ULong
operator|)
name|type
operator|->
name|width
operator|>=
literal|0x10000L
condition|)
block|{
name|FTC_OldImageDesc
name|desc
init|=
operator|(
name|FTC_OldImageDesc
operator|)
name|type
decl_stmt|;
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|face_id
operator|=
name|desc
operator|->
name|font
operator|.
name|face_id
expr_stmt|;
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|width
operator|=
name|desc
operator|->
name|font
operator|.
name|pix_width
expr_stmt|;
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|height
operator|=
name|desc
operator|->
name|font
operator|.
name|pix_height
expr_stmt|;
name|query
operator|.
name|attrs
operator|.
name|load_flags
operator|=
name|desc
operator|->
name|flags
expr_stmt|;
block|}
else|else
endif|#
directive|endif
comment|/* FT_CONFIG_OPTION_OLD_INTERNALS */
block|{
if|if
condition|(
call|(
name|FT_ULong
call|)
argument_list|(
name|type
operator|->
name|flags
operator|-
name|FT_INT_MIN
argument_list|)
operator|>
name|FT_UINT_MAX
condition|)
block|{
name|FT_TRACE1
argument_list|(
operator|(
literal|"FTC_ImageCache_Lookup: higher bits in load_flags"
operator|)
argument_list|)
expr_stmt|;
name|FT_TRACE1
argument_list|(
operator|(
literal|"0x%x are dropped\n"
operator|,
operator|(
name|type
operator|->
name|flags
operator|&
operator|~
operator|(
operator|(
name|FT_ULong
operator|)
name|FT_UINT_MAX
operator|)
operator|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|face_id
operator|=
name|type
operator|->
name|face_id
expr_stmt|;
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|width
operator|=
name|type
operator|->
name|width
expr_stmt|;
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|height
operator|=
name|type
operator|->
name|height
expr_stmt|;
name|query
operator|.
name|attrs
operator|.
name|load_flags
operator|=
operator|(
name|FT_UInt
operator|)
name|type
operator|->
name|flags
expr_stmt|;
block|}
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|pixel
operator|=
literal|1
expr_stmt|;
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|x_res
operator|=
literal|0
expr_stmt|;
comment|/* make compilers happy */
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|y_res
operator|=
literal|0
expr_stmt|;
name|hash
operator|=
name|FTC_BASIC_ATTR_HASH
argument_list|(
operator|&
name|query
operator|.
name|attrs
argument_list|)
operator|+
name|gindex
expr_stmt|;
if|#
directive|if
literal|1
comment|/* inlining is about 50% faster! */
name|FTC_GCACHE_LOOKUP_CMP
argument_list|(
name|cache
argument_list|,
name|ftc_basic_family_compare
argument_list|,
name|FTC_GNode_Compare
argument_list|,
name|hash
argument_list|,
name|gindex
argument_list|,
operator|&
name|query
argument_list|,
name|node
argument_list|,
name|error
argument_list|)
expr_stmt|;
else|#
directive|else
name|error
operator|=
name|FTC_GCache_Lookup
argument_list|(
name|FTC_GCACHE
argument_list|(
name|cache
argument_list|)
argument_list|,
name|hash
argument_list|,
name|gindex
argument_list|,
name|FTC_GQUERY
argument_list|(
operator|&
name|query
argument_list|)
argument_list|,
operator|&
name|node
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|error
condition|)
block|{
operator|*
name|aglyph
operator|=
name|FTC_INODE
argument_list|(
name|node
argument_list|)
operator|->
name|glyph
expr_stmt|;
if|if
condition|(
name|anode
condition|)
block|{
operator|*
name|anode
operator|=
name|node
expr_stmt|;
name|node
operator|->
name|ref_count
operator|++
expr_stmt|;
block|}
block|}
name|Exit
label|:
return|return
name|error
return|;
block|}
end_block
begin_comment
comment|/* documentation is in ftcache.h */
end_comment
begin_macro
DECL|function|FT_EXPORT_DEF
name|FT_EXPORT_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|FTC_ImageCache_LookupScaler
argument_list|(
argument|FTC_ImageCache  cache
argument_list|,
argument|FTC_Scaler      scaler
argument_list|,
argument|FT_ULong        load_flags
argument_list|,
argument|FT_UInt         gindex
argument_list|,
argument|FT_Glyph       *aglyph
argument_list|,
argument|FTC_Node       *anode
argument_list|)
end_macro
begin_block
block|{
name|FTC_BasicQueryRec
name|query
decl_stmt|;
name|FTC_Node
name|node
init|=
literal|0
decl_stmt|;
comment|/* make compiler happy */
name|FT_Error
name|error
decl_stmt|;
name|FT_UInt32
name|hash
decl_stmt|;
comment|/* some argument checks are delayed to FTC_Cache_Lookup */
if|if
condition|(
operator|!
name|aglyph
operator|||
operator|!
name|scaler
condition|)
block|{
name|error
operator|=
name|FTC_Err_Invalid_Argument
expr_stmt|;
goto|goto
name|Exit
goto|;
block|}
operator|*
name|aglyph
operator|=
name|NULL
expr_stmt|;
if|if
condition|(
name|anode
condition|)
operator|*
name|anode
operator|=
name|NULL
expr_stmt|;
comment|/* FT_Load_Glyph(), FT_Load_Char() take FT_UInt flags */
if|if
condition|(
name|load_flags
operator|>
name|FT_UINT_MAX
condition|)
block|{
name|FT_TRACE1
argument_list|(
operator|(
literal|"FTC_ImageCache_LookupScaler: higher bits in load_flags"
operator|)
argument_list|)
expr_stmt|;
name|FT_TRACE1
argument_list|(
operator|(
literal|"0x%x are dropped\n"
operator|,
operator|(
name|load_flags
operator|&
operator|~
operator|(
operator|(
name|FT_ULong
operator|)
name|FT_UINT_MAX
operator|)
operator|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|=
name|scaler
index|[
literal|0
index|]
expr_stmt|;
name|query
operator|.
name|attrs
operator|.
name|load_flags
operator|=
operator|(
name|FT_UInt
operator|)
name|load_flags
expr_stmt|;
name|hash
operator|=
name|FTC_BASIC_ATTR_HASH
argument_list|(
operator|&
name|query
operator|.
name|attrs
argument_list|)
operator|+
name|gindex
expr_stmt|;
name|FTC_GCACHE_LOOKUP_CMP
argument_list|(
name|cache
argument_list|,
name|ftc_basic_family_compare
argument_list|,
name|FTC_GNode_Compare
argument_list|,
name|hash
argument_list|,
name|gindex
argument_list|,
operator|&
name|query
argument_list|,
name|node
argument_list|,
name|error
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|error
condition|)
block|{
operator|*
name|aglyph
operator|=
name|FTC_INODE
argument_list|(
name|node
argument_list|)
operator|->
name|glyph
expr_stmt|;
if|if
condition|(
name|anode
condition|)
block|{
operator|*
name|anode
operator|=
name|node
expr_stmt|;
name|node
operator|->
name|ref_count
operator|++
expr_stmt|;
block|}
block|}
name|Exit
label|:
return|return
name|error
return|;
block|}
end_block
begin_ifdef
ifdef|#
directive|ifdef
name|FT_CONFIG_OPTION_OLD_INTERNALS
end_ifdef
begin_comment
comment|/* yet another backwards-legacy structure */
end_comment
begin_typedef
DECL|struct|FTC_OldImage_Desc_
typedef|typedef
struct|struct
name|FTC_OldImage_Desc_
block|{
DECL|member|font
name|FTC_FontRec
name|font
decl_stmt|;
DECL|member|image_type
name|FT_UInt
name|image_type
decl_stmt|;
block|}
DECL|typedef|FTC_OldImage_Desc
name|FTC_OldImage_Desc
typedef|;
end_typedef
begin_define
DECL|macro|FTC_OLD_IMAGE_FORMAT
define|#
directive|define
name|FTC_OLD_IMAGE_FORMAT
parameter_list|(
name|x
parameter_list|)
value|( (x)& 7 )
end_define
begin_define
DECL|macro|ftc_old_image_format_bitmap
define|#
directive|define
name|ftc_old_image_format_bitmap
value|0x0000
end_define
begin_define
DECL|macro|ftc_old_image_format_outline
define|#
directive|define
name|ftc_old_image_format_outline
value|0x0001
end_define
begin_define
DECL|macro|ftc_old_image_format_mask
define|#
directive|define
name|ftc_old_image_format_mask
value|0x000F
end_define
begin_define
DECL|macro|ftc_old_image_flag_monochrome
define|#
directive|define
name|ftc_old_image_flag_monochrome
value|0x0010
end_define
begin_define
DECL|macro|ftc_old_image_flag_unhinted
define|#
directive|define
name|ftc_old_image_flag_unhinted
value|0x0020
end_define
begin_define
DECL|macro|ftc_old_image_flag_autohinted
define|#
directive|define
name|ftc_old_image_flag_autohinted
value|0x0040
end_define
begin_define
DECL|macro|ftc_old_image_flag_unscaled
define|#
directive|define
name|ftc_old_image_flag_unscaled
value|0x0080
end_define
begin_define
DECL|macro|ftc_old_image_flag_no_sbits
define|#
directive|define
name|ftc_old_image_flag_no_sbits
value|0x0100
end_define
begin_comment
comment|/* monochrome bitmap */
end_comment
begin_define
DECL|macro|ftc_old_image_mono
define|#
directive|define
name|ftc_old_image_mono
value|ftc_old_image_format_bitmap   | \                                        ftc_old_image_flag_monochrome
end_define
begin_comment
comment|/* anti-aliased bitmap */
end_comment
begin_define
DECL|macro|ftc_old_image_grays
define|#
directive|define
name|ftc_old_image_grays
value|ftc_old_image_format_bitmap
end_define
begin_comment
comment|/* scaled outline */
end_comment
begin_define
DECL|macro|ftc_old_image_outline
define|#
directive|define
name|ftc_old_image_outline
value|ftc_old_image_format_outline
end_define
begin_function
specifier|static
name|void
DECL|function|ftc_image_type_from_old_desc
name|ftc_image_type_from_old_desc
parameter_list|(
name|FTC_ImageType
name|typ
parameter_list|,
name|FTC_OldImage_Desc
modifier|*
name|desc
parameter_list|)
block|{
name|typ
operator|->
name|face_id
operator|=
name|desc
operator|->
name|font
operator|.
name|face_id
expr_stmt|;
name|typ
operator|->
name|width
operator|=
name|desc
operator|->
name|font
operator|.
name|pix_width
expr_stmt|;
name|typ
operator|->
name|height
operator|=
name|desc
operator|->
name|font
operator|.
name|pix_height
expr_stmt|;
comment|/* convert image type flags to load flags */
block|{
name|FT_UInt
name|load_flags
init|=
name|FT_LOAD_DEFAULT
decl_stmt|;
name|FT_UInt
name|type
init|=
name|desc
operator|->
name|image_type
decl_stmt|;
comment|/* determine load flags, depending on the font description's */
comment|/* image type                                                */
if|if
condition|(
name|FTC_OLD_IMAGE_FORMAT
argument_list|(
name|type
argument_list|)
operator|==
name|ftc_old_image_format_bitmap
condition|)
block|{
if|if
condition|(
name|type
operator|&
name|ftc_old_image_flag_monochrome
condition|)
name|load_flags
operator||=
name|FT_LOAD_MONOCHROME
expr_stmt|;
comment|/* disable embedded bitmaps loading if necessary */
if|if
condition|(
name|type
operator|&
name|ftc_old_image_flag_no_sbits
condition|)
name|load_flags
operator||=
name|FT_LOAD_NO_BITMAP
expr_stmt|;
block|}
else|else
block|{
comment|/* we want an outline, don't load embedded bitmaps */
name|load_flags
operator||=
name|FT_LOAD_NO_BITMAP
expr_stmt|;
if|if
condition|(
name|type
operator|&
name|ftc_old_image_flag_unscaled
condition|)
name|load_flags
operator||=
name|FT_LOAD_NO_SCALE
expr_stmt|;
block|}
comment|/* always render glyphs to bitmaps */
name|load_flags
operator||=
name|FT_LOAD_RENDER
expr_stmt|;
if|if
condition|(
name|type
operator|&
name|ftc_old_image_flag_unhinted
condition|)
name|load_flags
operator||=
name|FT_LOAD_NO_HINTING
expr_stmt|;
if|if
condition|(
name|type
operator|&
name|ftc_old_image_flag_autohinted
condition|)
name|load_flags
operator||=
name|FT_LOAD_FORCE_AUTOHINT
expr_stmt|;
name|typ
operator|->
name|flags
operator|=
name|load_flags
expr_stmt|;
block|}
block|}
end_function
begin_macro
name|FT_EXPORT
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|FTC_Image_Cache_New
argument_list|(
argument|FTC_Manager      manager
argument_list|,
argument|FTC_ImageCache  *acache
argument_list|)
end_macro
begin_empty_stmt
empty_stmt|;
end_empty_stmt
begin_macro
name|FT_EXPORT
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
DECL|variable|FTC_Image_Cache_Lookup
name|FTC_Image_Cache_Lookup
argument_list|(
argument|FTC_ImageCache      icache
argument_list|,
argument|FTC_OldImage_Desc*  desc
argument_list|,
argument|FT_UInt             gindex
argument_list|,
argument|FT_Glyph           *aglyph
argument_list|)
end_macro
begin_empty_stmt
empty_stmt|;
end_empty_stmt
begin_macro
DECL|function|FT_EXPORT_DEF
name|FT_EXPORT_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|FTC_Image_Cache_New
argument_list|(
argument|FTC_Manager      manager
argument_list|,
argument|FTC_ImageCache  *acache
argument_list|)
end_macro
begin_block
block|{
return|return
name|FTC_ImageCache_New
argument_list|(
name|manager
argument_list|,
operator|(
name|FTC_ImageCache
operator|*
operator|)
name|acache
argument_list|)
return|;
block|}
end_block
begin_macro
DECL|function|FT_EXPORT_DEF
name|FT_EXPORT_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|FTC_Image_Cache_Lookup
argument_list|(
argument|FTC_ImageCache      icache
argument_list|,
argument|FTC_OldImage_Desc*  desc
argument_list|,
argument|FT_UInt             gindex
argument_list|,
argument|FT_Glyph           *aglyph
argument_list|)
end_macro
begin_block
block|{
name|FTC_ImageTypeRec
name|type0
decl_stmt|;
if|if
condition|(
operator|!
name|desc
condition|)
return|return
name|FTC_Err_Invalid_Argument
return|;
name|ftc_image_type_from_old_desc
argument_list|(
operator|&
name|type0
argument_list|,
name|desc
argument_list|)
expr_stmt|;
return|return
name|FTC_ImageCache_Lookup
argument_list|(
operator|(
name|FTC_ImageCache
operator|)
name|icache
argument_list|,
operator|&
name|type0
argument_list|,
name|gindex
argument_list|,
name|aglyph
argument_list|,
name|NULL
argument_list|)
return|;
block|}
end_block
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* FT_CONFIG_OPTION_OLD_INTERNALS */
end_comment
begin_comment
comment|/*   *   * basic small bitmap cache   *   */
end_comment
begin_decl_stmt
name|FT_CALLBACK_TABLE_DEF
DECL|variable|ftc_basic_sbit_family_class
specifier|const
name|FTC_SFamilyClassRec
name|ftc_basic_sbit_family_class
init|=
block|{
block|{
sizeof|sizeof
argument_list|(
name|FTC_BasicFamilyRec
argument_list|)
block|,
name|ftc_basic_family_compare
block|,
name|ftc_basic_family_init
block|,
literal|0
block|,
comment|/* FTC_MruNode_ResetFunc */
literal|0
comment|/* FTC_MruNode_DoneFunc  */
block|}
block|,
name|ftc_basic_family_get_count
block|,
name|ftc_basic_family_load_bitmap
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
name|FT_CALLBACK_TABLE_DEF
DECL|variable|ftc_basic_sbit_cache_class
specifier|const
name|FTC_GCacheClassRec
name|ftc_basic_sbit_cache_class
init|=
block|{
block|{
name|ftc_snode_new
block|,
name|ftc_snode_weight
block|,
name|ftc_snode_compare
block|,
name|ftc_basic_gnode_compare_faceid
block|,
name|ftc_snode_free
block|,
sizeof|sizeof
argument_list|(
name|FTC_GCacheRec
argument_list|)
block|,
name|ftc_gcache_init
block|,
name|ftc_gcache_done
block|}
block|,
operator|(
name|FTC_MruListClass
operator|)
operator|&
name|ftc_basic_sbit_family_class
block|}
decl_stmt|;
end_decl_stmt
begin_comment
comment|/* documentation is in ftcache.h */
end_comment
begin_macro
DECL|function|FT_EXPORT_DEF
name|FT_EXPORT_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|FTC_SBitCache_New
argument_list|(
argument|FTC_Manager     manager
argument_list|,
argument|FTC_SBitCache  *acache
argument_list|)
end_macro
begin_block
block|{
return|return
name|FTC_GCache_New
argument_list|(
name|manager
argument_list|,
operator|&
name|ftc_basic_sbit_cache_class
argument_list|,
operator|(
name|FTC_GCache
operator|*
operator|)
name|acache
argument_list|)
return|;
block|}
end_block
begin_comment
comment|/* documentation is in ftcache.h */
end_comment
begin_macro
DECL|function|FT_EXPORT_DEF
name|FT_EXPORT_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|FTC_SBitCache_Lookup
argument_list|(
argument|FTC_SBitCache  cache
argument_list|,
argument|FTC_ImageType  type
argument_list|,
argument|FT_UInt        gindex
argument_list|,
argument|FTC_SBit      *ansbit
argument_list|,
argument|FTC_Node      *anode
argument_list|)
end_macro
begin_block
block|{
name|FT_Error
name|error
decl_stmt|;
name|FTC_BasicQueryRec
name|query
decl_stmt|;
name|FTC_Node
name|node
init|=
literal|0
decl_stmt|;
comment|/* make compiler happy */
name|FT_UInt32
name|hash
decl_stmt|;
if|if
condition|(
name|anode
condition|)
operator|*
name|anode
operator|=
name|NULL
expr_stmt|;
comment|/* other argument checks delayed to FTC_Cache_Lookup */
if|if
condition|(
operator|!
name|ansbit
condition|)
return|return
name|FTC_Err_Invalid_Argument
return|;
operator|*
name|ansbit
operator|=
name|NULL
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|FT_CONFIG_OPTION_OLD_INTERNALS
argument_list|)
operator|&&
operator|(
name|FT_INT_MAX
operator|>
literal|0xFFFFU
operator|)
comment|/*  This one is a major hack used to detect whether we are passed a      *  regular FTC_ImageType handle, or a legacy FTC_OldImageDesc one.      */
if|if
condition|(
operator|(
name|FT_ULong
operator|)
name|type
operator|->
name|width
operator|>=
literal|0x10000L
condition|)
block|{
name|FTC_OldImageDesc
name|desc
init|=
operator|(
name|FTC_OldImageDesc
operator|)
name|type
decl_stmt|;
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|face_id
operator|=
name|desc
operator|->
name|font
operator|.
name|face_id
expr_stmt|;
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|width
operator|=
name|desc
operator|->
name|font
operator|.
name|pix_width
expr_stmt|;
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|height
operator|=
name|desc
operator|->
name|font
operator|.
name|pix_height
expr_stmt|;
name|query
operator|.
name|attrs
operator|.
name|load_flags
operator|=
name|desc
operator|->
name|flags
expr_stmt|;
block|}
else|else
endif|#
directive|endif
comment|/* FT_CONFIG_OPTION_OLD_INTERNALS */
block|{
if|if
condition|(
call|(
name|FT_ULong
call|)
argument_list|(
name|type
operator|->
name|flags
operator|-
name|FT_INT_MIN
argument_list|)
operator|>
name|FT_UINT_MAX
condition|)
block|{
name|FT_TRACE1
argument_list|(
operator|(
literal|"FTC_ImageCache_Lookup: higher bits in load_flags"
operator|)
argument_list|)
expr_stmt|;
name|FT_TRACE1
argument_list|(
operator|(
literal|"0x%x are dropped\n"
operator|,
operator|(
name|type
operator|->
name|flags
operator|&
operator|~
operator|(
operator|(
name|FT_ULong
operator|)
name|FT_UINT_MAX
operator|)
operator|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|face_id
operator|=
name|type
operator|->
name|face_id
expr_stmt|;
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|width
operator|=
name|type
operator|->
name|width
expr_stmt|;
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|height
operator|=
name|type
operator|->
name|height
expr_stmt|;
name|query
operator|.
name|attrs
operator|.
name|load_flags
operator|=
operator|(
name|FT_UInt
operator|)
name|type
operator|->
name|flags
expr_stmt|;
block|}
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|pixel
operator|=
literal|1
expr_stmt|;
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|x_res
operator|=
literal|0
expr_stmt|;
comment|/* make compilers happy */
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|.
name|y_res
operator|=
literal|0
expr_stmt|;
comment|/* beware, the hash must be the same for all glyph ranges! */
name|hash
operator|=
name|FTC_BASIC_ATTR_HASH
argument_list|(
operator|&
name|query
operator|.
name|attrs
argument_list|)
operator|+
name|gindex
operator|/
name|FTC_SBIT_ITEMS_PER_NODE
expr_stmt|;
if|#
directive|if
literal|1
comment|/* inlining is about 50% faster! */
name|FTC_GCACHE_LOOKUP_CMP
argument_list|(
name|cache
argument_list|,
name|ftc_basic_family_compare
argument_list|,
name|FTC_SNode_Compare
argument_list|,
name|hash
argument_list|,
name|gindex
argument_list|,
operator|&
name|query
argument_list|,
name|node
argument_list|,
name|error
argument_list|)
expr_stmt|;
else|#
directive|else
name|error
operator|=
name|FTC_GCache_Lookup
argument_list|(
name|FTC_GCACHE
argument_list|(
name|cache
argument_list|)
argument_list|,
name|hash
argument_list|,
name|gindex
argument_list|,
name|FTC_GQUERY
argument_list|(
operator|&
name|query
argument_list|)
argument_list|,
operator|&
name|node
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|error
condition|)
goto|goto
name|Exit
goto|;
operator|*
name|ansbit
operator|=
name|FTC_SNODE
argument_list|(
name|node
argument_list|)
operator|->
name|sbits
operator|+
operator|(
name|gindex
operator|-
name|FTC_GNODE
argument_list|(
name|node
argument_list|)
operator|->
name|gindex
operator|)
expr_stmt|;
if|if
condition|(
name|anode
condition|)
block|{
operator|*
name|anode
operator|=
name|node
expr_stmt|;
name|node
operator|->
name|ref_count
operator|++
expr_stmt|;
block|}
name|Exit
label|:
return|return
name|error
return|;
block|}
end_block
begin_comment
comment|/* documentation is in ftcache.h */
end_comment
begin_macro
DECL|function|FT_EXPORT_DEF
name|FT_EXPORT_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|FTC_SBitCache_LookupScaler
argument_list|(
argument|FTC_SBitCache  cache
argument_list|,
argument|FTC_Scaler     scaler
argument_list|,
argument|FT_ULong       load_flags
argument_list|,
argument|FT_UInt        gindex
argument_list|,
argument|FTC_SBit      *ansbit
argument_list|,
argument|FTC_Node      *anode
argument_list|)
end_macro
begin_block
block|{
name|FT_Error
name|error
decl_stmt|;
name|FTC_BasicQueryRec
name|query
decl_stmt|;
name|FTC_Node
name|node
init|=
literal|0
decl_stmt|;
comment|/* make compiler happy */
name|FT_UInt32
name|hash
decl_stmt|;
if|if
condition|(
name|anode
condition|)
operator|*
name|anode
operator|=
name|NULL
expr_stmt|;
comment|/* other argument checks delayed to FTC_Cache_Lookup */
if|if
condition|(
operator|!
name|ansbit
operator|||
operator|!
name|scaler
condition|)
return|return
name|FTC_Err_Invalid_Argument
return|;
operator|*
name|ansbit
operator|=
name|NULL
expr_stmt|;
comment|/* FT_Load_Glyph(), FT_Load_Char() take FT_UInt flags */
if|if
condition|(
name|load_flags
operator|>
name|FT_UINT_MAX
condition|)
block|{
name|FT_TRACE1
argument_list|(
operator|(
literal|"FTC_ImageCache_LookupScaler: higher bits in load_flags"
operator|)
argument_list|)
expr_stmt|;
name|FT_TRACE1
argument_list|(
operator|(
literal|"0x%x are dropped\n"
operator|,
operator|(
name|load_flags
operator|&
operator|~
operator|(
operator|(
name|FT_ULong
operator|)
name|FT_UINT_MAX
operator|)
operator|)
operator|)
argument_list|)
expr_stmt|;
block|}
name|query
operator|.
name|attrs
operator|.
name|scaler
operator|=
name|scaler
index|[
literal|0
index|]
expr_stmt|;
name|query
operator|.
name|attrs
operator|.
name|load_flags
operator|=
operator|(
name|FT_UInt
operator|)
name|load_flags
expr_stmt|;
comment|/* beware, the hash must be the same for all glyph ranges! */
name|hash
operator|=
name|FTC_BASIC_ATTR_HASH
argument_list|(
operator|&
name|query
operator|.
name|attrs
argument_list|)
operator|+
name|gindex
operator|/
name|FTC_SBIT_ITEMS_PER_NODE
expr_stmt|;
name|FTC_GCACHE_LOOKUP_CMP
argument_list|(
name|cache
argument_list|,
name|ftc_basic_family_compare
argument_list|,
name|FTC_SNode_Compare
argument_list|,
name|hash
argument_list|,
name|gindex
argument_list|,
operator|&
name|query
argument_list|,
name|node
argument_list|,
name|error
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
condition|)
goto|goto
name|Exit
goto|;
operator|*
name|ansbit
operator|=
name|FTC_SNODE
argument_list|(
name|node
argument_list|)
operator|->
name|sbits
operator|+
operator|(
name|gindex
operator|-
name|FTC_GNODE
argument_list|(
name|node
argument_list|)
operator|->
name|gindex
operator|)
expr_stmt|;
if|if
condition|(
name|anode
condition|)
block|{
operator|*
name|anode
operator|=
name|node
expr_stmt|;
name|node
operator|->
name|ref_count
operator|++
expr_stmt|;
block|}
name|Exit
label|:
return|return
name|error
return|;
block|}
end_block
begin_ifdef
ifdef|#
directive|ifdef
name|FT_CONFIG_OPTION_OLD_INTERNALS
end_ifdef
begin_macro
name|FT_EXPORT
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|FTC_SBit_Cache_New
argument_list|(
argument|FTC_Manager     manager
argument_list|,
argument|FTC_SBitCache  *acache
argument_list|)
end_macro
begin_empty_stmt
empty_stmt|;
end_empty_stmt
begin_macro
name|FT_EXPORT
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
DECL|variable|FTC_SBit_Cache_Lookup
name|FTC_SBit_Cache_Lookup
argument_list|(
argument|FTC_SBitCache       cache
argument_list|,
argument|FTC_OldImage_Desc*  desc
argument_list|,
argument|FT_UInt             gindex
argument_list|,
argument|FTC_SBit           *ansbit
argument_list|)
end_macro
begin_empty_stmt
empty_stmt|;
end_empty_stmt
begin_macro
DECL|function|FT_EXPORT_DEF
name|FT_EXPORT_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|FTC_SBit_Cache_New
argument_list|(
argument|FTC_Manager     manager
argument_list|,
argument|FTC_SBitCache  *acache
argument_list|)
end_macro
begin_block
block|{
return|return
name|FTC_SBitCache_New
argument_list|(
name|manager
argument_list|,
operator|(
name|FTC_SBitCache
operator|*
operator|)
name|acache
argument_list|)
return|;
block|}
end_block
begin_macro
DECL|function|FT_EXPORT_DEF
name|FT_EXPORT_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|FTC_SBit_Cache_Lookup
argument_list|(
argument|FTC_SBitCache       cache
argument_list|,
argument|FTC_OldImage_Desc*  desc
argument_list|,
argument|FT_UInt             gindex
argument_list|,
argument|FTC_SBit           *ansbit
argument_list|)
end_macro
begin_block
block|{
name|FTC_ImageTypeRec
name|type0
decl_stmt|;
if|if
condition|(
operator|!
name|desc
condition|)
return|return
name|FT_Err_Invalid_Argument
return|;
name|ftc_image_type_from_old_desc
argument_list|(
operator|&
name|type0
argument_list|,
name|desc
argument_list|)
expr_stmt|;
return|return
name|FTC_SBitCache_Lookup
argument_list|(
operator|(
name|FTC_SBitCache
operator|)
name|cache
argument_list|,
operator|&
name|type0
argument_list|,
name|gindex
argument_list|,
name|ansbit
argument_list|,
name|NULL
argument_list|)
return|;
block|}
end_block
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* FT_CONFIG_OPTION_OLD_INTERNALS */
end_comment
begin_comment
comment|/* END */
end_comment
end_unit
