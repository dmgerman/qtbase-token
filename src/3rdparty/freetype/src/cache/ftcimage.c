begin_unit
begin_comment
comment|/***************************************************************************/
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  ftcimage.c                                                             */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*    FreeType Image cache (body).                                         */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  Copyright 2000-2001, 2003, 2004, 2006 by                               */
end_comment
begin_comment
comment|/*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  This file is part of the FreeType project, and may only be used,       */
end_comment
begin_comment
comment|/*  modified, and distributed under the terms of the FreeType project      */
end_comment
begin_comment
comment|/*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */
end_comment
begin_comment
comment|/*  this file you indicate that you have read the license and              */
end_comment
begin_comment
comment|/*  understand and accept it fully.                                        */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/***************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<ft2build.h>
end_include
begin_include
include|#
directive|include
include|FT_CACHE_H
end_include
begin_include
include|#
directive|include
file|"ftcimage.h"
end_include
begin_include
include|#
directive|include
include|FT_INTERNAL_MEMORY_H
end_include
begin_include
include|#
directive|include
file|"ftccback.h"
end_include
begin_include
include|#
directive|include
file|"ftcerror.h"
end_include
begin_comment
comment|/* finalize a given glyph image node */
end_comment
begin_macro
name|FT_LOCAL_DEF
argument_list|(
argument|void
argument_list|)
end_macro
begin_macro
DECL|function|ftc_inode_free
name|ftc_inode_free
argument_list|(
argument|FTC_Node   ftcinode
argument_list|,
argument|FTC_Cache  cache
argument_list|)
end_macro
begin_block
block|{
name|FTC_INode
name|inode
init|=
operator|(
name|FTC_INode
operator|)
name|ftcinode
decl_stmt|;
name|FT_Memory
name|memory
init|=
name|cache
operator|->
name|memory
decl_stmt|;
if|if
condition|(
name|inode
operator|->
name|glyph
condition|)
block|{
name|FT_Done_Glyph
argument_list|(
name|inode
operator|->
name|glyph
argument_list|)
expr_stmt|;
name|inode
operator|->
name|glyph
operator|=
name|NULL
expr_stmt|;
block|}
name|FTC_GNode_Done
argument_list|(
name|FTC_GNODE
argument_list|(
name|inode
argument_list|)
argument_list|,
name|cache
argument_list|)
expr_stmt|;
name|FT_FREE
argument_list|(
name|inode
argument_list|)
expr_stmt|;
block|}
end_block
begin_macro
name|FT_LOCAL_DEF
argument_list|(
argument|void
argument_list|)
end_macro
begin_macro
DECL|function|FTC_INode_Free
name|FTC_INode_Free
argument_list|(
argument|FTC_INode  inode
argument_list|,
argument|FTC_Cache  cache
argument_list|)
end_macro
begin_block
block|{
name|ftc_inode_free
argument_list|(
name|FTC_NODE
argument_list|(
name|inode
argument_list|)
argument_list|,
name|cache
argument_list|)
expr_stmt|;
block|}
end_block
begin_comment
comment|/* initialize a new glyph image node */
end_comment
begin_macro
DECL|function|FT_LOCAL_DEF
name|FT_LOCAL_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|FTC_INode_New
argument_list|(
argument|FTC_INode   *pinode
argument_list|,
argument|FTC_GQuery   gquery
argument_list|,
argument|FTC_Cache    cache
argument_list|)
end_macro
begin_block
block|{
name|FT_Memory
name|memory
init|=
name|cache
operator|->
name|memory
decl_stmt|;
name|FT_Error
name|error
decl_stmt|;
name|FTC_INode
name|inode
decl_stmt|;
if|if
condition|(
operator|!
name|FT_NEW
argument_list|(
name|inode
argument_list|)
condition|)
block|{
name|FTC_GNode
name|gnode
init|=
name|FTC_GNODE
argument_list|(
name|inode
argument_list|)
decl_stmt|;
name|FTC_Family
name|family
init|=
name|gquery
operator|->
name|family
decl_stmt|;
name|FT_UInt
name|gindex
init|=
name|gquery
operator|->
name|gindex
decl_stmt|;
name|FTC_IFamilyClass
name|clazz
init|=
name|FTC_CACHE__IFAMILY_CLASS
argument_list|(
name|cache
argument_list|)
decl_stmt|;
comment|/* initialize its inner fields */
name|FTC_GNode_Init
argument_list|(
name|gnode
argument_list|,
name|gindex
argument_list|,
name|family
argument_list|)
expr_stmt|;
comment|/* we will now load the glyph image */
name|error
operator|=
name|clazz
operator|->
name|family_load_glyph
argument_list|(
name|family
argument_list|,
name|gindex
argument_list|,
name|cache
argument_list|,
operator|&
name|inode
operator|->
name|glyph
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
condition|)
block|{
name|FTC_INode_Free
argument_list|(
name|inode
argument_list|,
name|cache
argument_list|)
expr_stmt|;
name|inode
operator|=
name|NULL
expr_stmt|;
block|}
block|}
operator|*
name|pinode
operator|=
name|inode
expr_stmt|;
return|return
name|error
return|;
block|}
end_block
begin_macro
DECL|function|FT_LOCAL_DEF
name|FT_LOCAL_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|ftc_inode_new
argument_list|(
argument|FTC_Node   *ftcpinode
argument_list|,
argument|FT_Pointer  ftcgquery
argument_list|,
argument|FTC_Cache   cache
argument_list|)
end_macro
begin_block
block|{
name|FTC_INode
modifier|*
name|pinode
init|=
operator|(
name|FTC_INode
operator|*
operator|)
name|ftcpinode
decl_stmt|;
name|FTC_GQuery
name|gquery
init|=
operator|(
name|FTC_GQuery
operator|)
name|ftcgquery
decl_stmt|;
return|return
name|FTC_INode_New
argument_list|(
name|pinode
argument_list|,
name|gquery
argument_list|,
name|cache
argument_list|)
return|;
block|}
end_block
begin_macro
DECL|function|FT_LOCAL_DEF
name|FT_LOCAL_DEF
argument_list|(
argument|FT_Offset
argument_list|)
end_macro
begin_macro
name|ftc_inode_weight
argument_list|(
argument|FTC_Node   ftcinode
argument_list|,
argument|FTC_Cache  ftccache
argument_list|)
end_macro
begin_block
block|{
name|FTC_INode
name|inode
init|=
operator|(
name|FTC_INode
operator|)
name|ftcinode
decl_stmt|;
name|FT_Offset
name|size
init|=
literal|0
decl_stmt|;
name|FT_Glyph
name|glyph
init|=
name|inode
operator|->
name|glyph
decl_stmt|;
name|FT_UNUSED
argument_list|(
name|ftccache
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|glyph
operator|->
name|format
condition|)
block|{
case|case
name|FT_GLYPH_FORMAT_BITMAP
case|:
block|{
name|FT_BitmapGlyph
name|bitg
decl_stmt|;
name|bitg
operator|=
operator|(
name|FT_BitmapGlyph
operator|)
name|glyph
expr_stmt|;
name|size
operator|=
name|bitg
operator|->
name|bitmap
operator|.
name|rows
operator|*
name|ft_labs
argument_list|(
name|bitg
operator|->
name|bitmap
operator|.
name|pitch
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
operator|*
name|bitg
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|FT_GLYPH_FORMAT_OUTLINE
case|:
block|{
name|FT_OutlineGlyph
name|outg
decl_stmt|;
name|outg
operator|=
operator|(
name|FT_OutlineGlyph
operator|)
name|glyph
expr_stmt|;
name|size
operator|=
name|outg
operator|->
name|outline
operator|.
name|n_points
operator|*
operator|(
sizeof|sizeof
argument_list|(
name|FT_Vector
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
name|FT_Byte
argument_list|)
operator|)
operator|+
name|outg
operator|->
name|outline
operator|.
name|n_contours
operator|*
sizeof|sizeof
argument_list|(
name|FT_Short
argument_list|)
operator|+
sizeof|sizeof
argument_list|(
operator|*
name|outg
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
empty_stmt|;
block|}
name|size
operator|+=
sizeof|sizeof
argument_list|(
operator|*
name|inode
argument_list|)
expr_stmt|;
return|return
name|size
return|;
block|}
end_block
begin_if
if|#
directive|if
literal|0
end_if
begin_endif
unit|FT_LOCAL_DEF( FT_Offset )   FTC_INode_Weight( FTC_INode  inode )   {     return ftc_inode_weight( FTC_NODE( inode ), NULL );   }
endif|#
directive|endif
end_endif
begin_comment
comment|/* 0 */
end_comment
begin_comment
comment|/* END */
end_comment
end_unit
