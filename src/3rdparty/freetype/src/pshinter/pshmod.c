begin_unit
begin_comment
comment|/***************************************************************************/
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  pshmod.c                                                               */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*    FreeType PostScript hinter module implementation (body).             */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  Copyright 2001, 2002, 2007 by                                          */
end_comment
begin_comment
comment|/*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  This file is part of the FreeType project, and may only be used,       */
end_comment
begin_comment
comment|/*  modified, and distributed under the terms of the FreeType project      */
end_comment
begin_comment
comment|/*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */
end_comment
begin_comment
comment|/*  this file you indicate that you have read the license and              */
end_comment
begin_comment
comment|/*  understand and accept it fully.                                        */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/***************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<ft2build.h>
end_include
begin_include
include|#
directive|include
include|FT_INTERNAL_OBJECTS_H
end_include
begin_include
include|#
directive|include
file|"pshrec.h"
end_include
begin_include
include|#
directive|include
file|"pshalgo.h"
end_include
begin_comment
comment|/* the Postscript Hinter module structure */
end_comment
begin_typedef
DECL|struct|PS_Hinter_Module_Rec_
typedef|typedef
struct|struct
name|PS_Hinter_Module_Rec_
block|{
DECL|member|root
name|FT_ModuleRec
name|root
decl_stmt|;
DECL|member|ps_hints
name|PS_HintsRec
name|ps_hints
decl_stmt|;
DECL|member|globals_funcs
name|PSH_Globals_FuncsRec
name|globals_funcs
decl_stmt|;
DECL|member|t1_funcs
name|T1_Hints_FuncsRec
name|t1_funcs
decl_stmt|;
DECL|member|t2_funcs
name|T2_Hints_FuncsRec
name|t2_funcs
decl_stmt|;
block|}
DECL|typedef|PS_Hinter_ModuleRec
DECL|typedef|PS_Hinter_Module
name|PS_Hinter_ModuleRec
operator|,
typedef|*
name|PS_Hinter_Module
typedef|;
end_typedef
begin_comment
comment|/* finalize module */
end_comment
begin_macro
name|FT_CALLBACK_DEF
argument_list|(
argument|void
argument_list|)
end_macro
begin_macro
DECL|function|ps_hinter_done
name|ps_hinter_done
argument_list|(
argument|PS_Hinter_Module  module
argument_list|)
end_macro
begin_block
block|{
name|module
operator|->
name|t1_funcs
operator|.
name|hints
operator|=
name|NULL
expr_stmt|;
name|module
operator|->
name|t2_funcs
operator|.
name|hints
operator|=
name|NULL
expr_stmt|;
name|ps_hints_done
argument_list|(
operator|&
name|module
operator|->
name|ps_hints
argument_list|)
expr_stmt|;
block|}
end_block
begin_comment
comment|/* initialize module, create hints recorder and the interface */
end_comment
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|ps_hinter_init
argument_list|(
argument|PS_Hinter_Module  module
argument_list|)
end_macro
begin_block
block|{
name|FT_Memory
name|memory
init|=
name|module
operator|->
name|root
operator|.
name|memory
decl_stmt|;
name|void
modifier|*
name|ph
init|=
operator|&
name|module
operator|->
name|ps_hints
decl_stmt|;
name|ps_hints_init
argument_list|(
operator|&
name|module
operator|->
name|ps_hints
argument_list|,
name|memory
argument_list|)
expr_stmt|;
name|psh_globals_funcs_init
argument_list|(
operator|&
name|module
operator|->
name|globals_funcs
argument_list|)
expr_stmt|;
name|t1_hints_funcs_init
argument_list|(
operator|&
name|module
operator|->
name|t1_funcs
argument_list|)
expr_stmt|;
name|module
operator|->
name|t1_funcs
operator|.
name|hints
operator|=
operator|(
name|T1_Hints
operator|)
name|ph
expr_stmt|;
name|t2_hints_funcs_init
argument_list|(
operator|&
name|module
operator|->
name|t2_funcs
argument_list|)
expr_stmt|;
name|module
operator|->
name|t2_funcs
operator|.
name|hints
operator|=
operator|(
name|T2_Hints
operator|)
name|ph
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block
begin_comment
comment|/* returns global hints interface */
end_comment
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|PSH_Globals_Funcs
argument_list|)
end_macro
begin_macro
name|pshinter_get_globals_funcs
argument_list|(
argument|FT_Module  module
argument_list|)
end_macro
begin_block
block|{
return|return
operator|&
operator|(
operator|(
name|PS_Hinter_Module
operator|)
name|module
operator|)
operator|->
name|globals_funcs
return|;
block|}
end_block
begin_comment
comment|/* return Type 1 hints interface */
end_comment
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|T1_Hints_Funcs
argument_list|)
end_macro
begin_macro
name|pshinter_get_t1_funcs
argument_list|(
argument|FT_Module  module
argument_list|)
end_macro
begin_block
block|{
return|return
operator|&
operator|(
operator|(
name|PS_Hinter_Module
operator|)
name|module
operator|)
operator|->
name|t1_funcs
return|;
block|}
end_block
begin_comment
comment|/* return Type 2 hints interface */
end_comment
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|T2_Hints_Funcs
argument_list|)
end_macro
begin_macro
name|pshinter_get_t2_funcs
argument_list|(
argument|FT_Module  module
argument_list|)
end_macro
begin_block
block|{
return|return
operator|&
operator|(
operator|(
name|PS_Hinter_Module
operator|)
name|module
operator|)
operator|->
name|t2_funcs
return|;
block|}
end_block
begin_decl_stmt
specifier|static
DECL|variable|pshinter_interface
specifier|const
name|PSHinter_Interface
name|pshinter_interface
init|=
block|{
name|pshinter_get_globals_funcs
block|,
name|pshinter_get_t1_funcs
block|,
name|pshinter_get_t2_funcs
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
name|FT_CALLBACK_TABLE_DEF
DECL|variable|pshinter_module_class
specifier|const
name|FT_Module_Class
name|pshinter_module_class
init|=
block|{
literal|0
block|,
sizeof|sizeof
argument_list|(
name|PS_Hinter_ModuleRec
argument_list|)
block|,
literal|"pshinter"
block|,
literal|0x10000L
block|,
literal|0x20000L
block|,
operator|&
name|pshinter_interface
block|,
comment|/* module-specific interface */
operator|(
name|FT_Module_Constructor
operator|)
name|ps_hinter_init
block|,
operator|(
name|FT_Module_Destructor
operator|)
name|ps_hinter_done
block|,
operator|(
name|FT_Module_Requester
operator|)
literal|0
comment|/* no additional interface for now */
block|}
decl_stmt|;
end_decl_stmt
begin_comment
comment|/* END */
end_comment
end_unit
