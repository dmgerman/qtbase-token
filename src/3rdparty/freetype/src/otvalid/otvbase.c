begin_unit
begin_comment
comment|/***************************************************************************/
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  otvbase.c                                                              */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*    OpenType BASE table validation (body).                               */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  Copyright 2004-2015 by                                                 */
end_comment
begin_comment
comment|/*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  This file is part of the FreeType project, and may only be used,       */
end_comment
begin_comment
comment|/*  modified, and distributed under the terms of the FreeType project      */
end_comment
begin_comment
comment|/*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */
end_comment
begin_comment
comment|/*  this file you indicate that you have read the license and              */
end_comment
begin_comment
comment|/*  understand and accept it fully.                                        */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/***************************************************************************/
end_comment
begin_include
include|#
directive|include
file|"otvalid.h"
end_include
begin_include
include|#
directive|include
file|"otvcommn.h"
end_include
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */
end_comment
begin_comment
comment|/* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */
end_comment
begin_comment
comment|/* messages during execution.                                            */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_undef
DECL|macro|FT_COMPONENT
undef|#
directive|undef
name|FT_COMPONENT
end_undef
begin_define
DECL|macro|FT_COMPONENT
define|#
directive|define
name|FT_COMPONENT
value|trace_otvbase
end_define
begin_function
specifier|static
name|void
DECL|function|otv_BaseCoord_validate
name|otv_BaseCoord_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|otvalid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|BaseCoordFormat
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"BaseCoord"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|BaseCoordFormat
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
comment|/* skip Coordinate */
name|OTV_TRACE
argument_list|(
operator|(
literal|" (format %d)\n"
operator|,
name|BaseCoordFormat
operator|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|BaseCoordFormat
condition|)
block|{
case|case
literal|1
case|:
comment|/* BaseCoordFormat1 */
break|break;
case|case
literal|2
case|:
comment|/* BaseCoordFormat2 */
name|OTV_LIMIT_CHECK
argument_list|(
literal|4
argument_list|)
expr_stmt|;
comment|/* ReferenceGlyph, BaseCoordPoint */
break|break;
case|case
literal|3
case|:
comment|/* BaseCoordFormat3 */
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
comment|/* DeviceTable */
name|otv_Device_validate
argument_list|(
name|table
operator|+
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
break|break;
default|default:
name|FT_INVALID_FORMAT
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_function
specifier|static
name|void
DECL|function|otv_BaseTagList_validate
name|otv_BaseTagList_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|otvalid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|BaseTagCount
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"BaseTagList"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|BaseTagCount
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (BaseTagCount = %d)\n"
operator|,
name|BaseTagCount
operator|)
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
name|BaseTagCount
operator|*
literal|4
argument_list|)
expr_stmt|;
comment|/* BaselineTag */
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_function
specifier|static
name|void
DECL|function|otv_BaseValues_validate
name|otv_BaseValues_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|otvalid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|BaseCoordCount
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"BaseValues"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
comment|/* skip DefaultIndex */
name|BaseCoordCount
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (BaseCoordCount = %d)\n"
operator|,
name|BaseCoordCount
operator|)
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
name|BaseCoordCount
operator|*
literal|2
argument_list|)
expr_stmt|;
comment|/* BaseCoord */
for|for
control|(
init|;
name|BaseCoordCount
operator|>
literal|0
condition|;
name|BaseCoordCount
operator|--
control|)
name|otv_BaseCoord_validate
argument_list|(
name|table
operator|+
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_function
specifier|static
name|void
DECL|function|otv_MinMax_validate
name|otv_MinMax_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|otvalid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|table_size
decl_stmt|;
name|FT_UInt
name|FeatMinMaxCount
decl_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|MinCoord
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|MaxCoord
argument_list|)
expr_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"MinMax"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|6
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|MinCoord
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|MaxCoord
argument_list|)
expr_stmt|;
name|FeatMinMaxCount
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (FeatMinMaxCount = %d)\n"
operator|,
name|FeatMinMaxCount
operator|)
argument_list|)
expr_stmt|;
name|table_size
operator|=
name|FeatMinMaxCount
operator|*
literal|8
operator|+
literal|6
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|MinCoord
argument_list|)
expr_stmt|;
if|if
condition|(
name|MinCoord
condition|)
name|otv_BaseCoord_validate
argument_list|(
name|table
operator|+
name|MinCoord
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|MaxCoord
argument_list|)
expr_stmt|;
if|if
condition|(
name|MaxCoord
condition|)
name|otv_BaseCoord_validate
argument_list|(
name|table
operator|+
name|MaxCoord
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
name|FeatMinMaxCount
operator|*
literal|8
argument_list|)
expr_stmt|;
comment|/* FeatMinMaxRecord */
for|for
control|(
init|;
name|FeatMinMaxCount
operator|>
literal|0
condition|;
name|FeatMinMaxCount
operator|--
control|)
block|{
name|p
operator|+=
literal|4
expr_stmt|;
comment|/* skip FeatureTableTag */
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|MinCoord
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|MaxCoord
argument_list|)
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|MinCoord
argument_list|)
expr_stmt|;
if|if
condition|(
name|MinCoord
condition|)
name|otv_BaseCoord_validate
argument_list|(
name|table
operator|+
name|MinCoord
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|MaxCoord
argument_list|)
expr_stmt|;
if|if
condition|(
name|MaxCoord
condition|)
name|otv_BaseCoord_validate
argument_list|(
name|table
operator|+
name|MaxCoord
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_function
specifier|static
name|void
DECL|function|otv_BaseScript_validate
name|otv_BaseScript_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|otvalid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|table_size
decl_stmt|;
name|FT_UInt
name|BaseLangSysCount
decl_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|BaseValues
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|DefaultMinMax
argument_list|)
expr_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"BaseScript"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|6
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|BaseValues
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|DefaultMinMax
argument_list|)
expr_stmt|;
name|BaseLangSysCount
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (BaseLangSysCount = %d)\n"
operator|,
name|BaseLangSysCount
operator|)
argument_list|)
expr_stmt|;
name|table_size
operator|=
name|BaseLangSysCount
operator|*
literal|6
operator|+
literal|6
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|BaseValues
argument_list|)
expr_stmt|;
if|if
condition|(
name|BaseValues
condition|)
name|otv_BaseValues_validate
argument_list|(
name|table
operator|+
name|BaseValues
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|DefaultMinMax
argument_list|)
expr_stmt|;
if|if
condition|(
name|DefaultMinMax
condition|)
name|otv_MinMax_validate
argument_list|(
name|table
operator|+
name|DefaultMinMax
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
name|BaseLangSysCount
operator|*
literal|6
argument_list|)
expr_stmt|;
comment|/* BaseLangSysRecord */
for|for
control|(
init|;
name|BaseLangSysCount
operator|>
literal|0
condition|;
name|BaseLangSysCount
operator|--
control|)
block|{
name|p
operator|+=
literal|4
expr_stmt|;
comment|/* skip BaseLangSysTag */
name|otv_MinMax_validate
argument_list|(
name|table
operator|+
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_function
specifier|static
name|void
DECL|function|otv_BaseScriptList_validate
name|otv_BaseScriptList_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|otvalid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|BaseScriptCount
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"BaseScriptList"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|BaseScriptCount
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (BaseScriptCount = %d)\n"
operator|,
name|BaseScriptCount
operator|)
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
name|BaseScriptCount
operator|*
literal|6
argument_list|)
expr_stmt|;
comment|/* BaseScriptRecord */
for|for
control|(
init|;
name|BaseScriptCount
operator|>
literal|0
condition|;
name|BaseScriptCount
operator|--
control|)
block|{
name|p
operator|+=
literal|4
expr_stmt|;
comment|/* skip BaseScriptTag */
comment|/* BaseScript */
name|otv_BaseScript_validate
argument_list|(
name|table
operator|+
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_function
specifier|static
name|void
DECL|function|otv_Axis_validate
name|otv_Axis_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|otvalid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|table_size
decl_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|BaseTagList
argument_list|)
expr_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"Axis"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|BaseTagList
argument_list|)
expr_stmt|;
name|table_size
operator|=
literal|4
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|BaseTagList
argument_list|)
expr_stmt|;
if|if
condition|(
name|BaseTagList
condition|)
name|otv_BaseTagList_validate
argument_list|(
name|table
operator|+
name|BaseTagList
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
comment|/* BaseScriptList */
name|otv_BaseScriptList_validate
argument_list|(
name|table
operator|+
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_macro
name|FT_LOCAL_DEF
argument_list|(
argument|void
argument_list|)
end_macro
begin_macro
DECL|function|otv_BASE_validate
name|otv_BASE_validate
argument_list|(
argument|FT_Bytes      table
argument_list|,
argument|FT_Validator  ftvalid
argument_list|)
end_macro
begin_block
block|{
name|OTV_ValidatorRec
name|otvalidrec
decl_stmt|;
name|OTV_Validator
name|otvalid
init|=
operator|&
name|otvalidrec
decl_stmt|;
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|table_size
decl_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|HorizAxis
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|VertAxis
argument_list|)
expr_stmt|;
name|otvalid
operator|->
name|root
operator|=
name|ftvalid
expr_stmt|;
name|FT_TRACE3
argument_list|(
operator|(
literal|"validating BASE table\n"
operator|)
argument_list|)
expr_stmt|;
name|OTV_INIT
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|FT_NEXT_ULONG
argument_list|(
name|p
argument_list|)
operator|!=
literal|0x10000UL
condition|)
comment|/* Version */
name|FT_INVALID_FORMAT
expr_stmt|;
name|table_size
operator|=
literal|6
expr_stmt|;
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|HorizAxis
argument_list|)
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|HorizAxis
argument_list|)
expr_stmt|;
if|if
condition|(
name|HorizAxis
condition|)
name|otv_Axis_validate
argument_list|(
name|table
operator|+
name|HorizAxis
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|VertAxis
argument_list|)
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|VertAxis
argument_list|)
expr_stmt|;
if|if
condition|(
name|VertAxis
condition|)
name|otv_Axis_validate
argument_list|(
name|table
operator|+
name|VertAxis
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
name|FT_TRACE4
argument_list|(
operator|(
literal|"\n"
operator|)
argument_list|)
expr_stmt|;
block|}
end_block
begin_comment
comment|/* END */
end_comment
end_unit
