begin_unit
begin_comment
comment|/***************************************************************************/
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  otvmath.c                                                              */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*    OpenType MATH table validation (body).                               */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  Copyright 2007, 2008 by                                                */
end_comment
begin_comment
comment|/*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  Written by George Williams.                                            */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  This file is part of the FreeType project, and may only be used,       */
end_comment
begin_comment
comment|/*  modified, and distributed under the terms of the FreeType project      */
end_comment
begin_comment
comment|/*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */
end_comment
begin_comment
comment|/*  this file you indicate that you have read the license and              */
end_comment
begin_comment
comment|/*  understand and accept it fully.                                        */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/***************************************************************************/
end_comment
begin_include
include|#
directive|include
file|"otvalid.h"
end_include
begin_include
include|#
directive|include
file|"otvcommn.h"
end_include
begin_include
include|#
directive|include
file|"otvgpos.h"
end_include
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */
end_comment
begin_comment
comment|/* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */
end_comment
begin_comment
comment|/* messages during execution.                                            */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_undef
DECL|macro|FT_COMPONENT
undef|#
directive|undef
name|FT_COMPONENT
end_undef
begin_define
DECL|macro|FT_COMPONENT
define|#
directive|define
name|FT_COMPONENT
value|trace_otvmath
end_define
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                  MATH TYPOGRAPHIC CONSTANTS                   *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_MathConstants_validate
name|otv_MathConstants_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|otvalid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|i
decl_stmt|;
name|FT_UInt
name|table_size
decl_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|DeviceTableOffset
argument_list|)
expr_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"MathConstants"
argument_list|)
expr_stmt|;
comment|/* 56 constants, 51 have device tables */
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
operator|*
operator|(
literal|56
operator|+
literal|51
operator|)
argument_list|)
expr_stmt|;
name|table_size
operator|=
literal|2
operator|*
operator|(
literal|56
operator|+
literal|51
operator|)
expr_stmt|;
name|p
operator|+=
literal|4
operator|*
literal|2
expr_stmt|;
comment|/* First 4 constants have no device tables */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
literal|51
condition|;
operator|++
name|i
control|)
block|{
name|p
operator|+=
literal|2
expr_stmt|;
comment|/* skip the value */
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|DeviceTableOffset
argument_list|)
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|DeviceTableOffset
argument_list|)
expr_stmt|;
if|if
condition|(
name|DeviceTableOffset
condition|)
name|otv_Device_validate
argument_list|(
name|table
operator|+
name|DeviceTableOffset
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                   MATH ITALICS CORRECTION                     *****/
end_comment
begin_comment
comment|/*****                 MATH TOP ACCENT ATTACHMENT                    *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_MathItalicsCorrectionInfo_validate
name|otv_MathItalicsCorrectionInfo_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|otvalid
parameter_list|,
name|FT_Int
name|isItalic
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|i
decl_stmt|,
name|cnt
decl_stmt|,
name|table_size
decl_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|Coverage
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|DeviceTableOffset
argument_list|)
expr_stmt|;
name|FT_UNUSED
argument_list|(
name|isItalic
argument_list|)
expr_stmt|;
comment|/* only used if tracing is active */
name|OTV_NAME_ENTER
argument_list|(
name|isItalic
condition|?
literal|"MathItalicsCorrectionInfo"
else|:
literal|"MathTopAccentAttachment"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|Coverage
argument_list|)
expr_stmt|;
name|cnt
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|4
operator|*
name|cnt
argument_list|)
expr_stmt|;
name|table_size
operator|=
literal|4
operator|+
literal|4
operator|*
name|cnt
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|Coverage
argument_list|)
expr_stmt|;
name|otv_Coverage_validate
argument_list|(
name|table
operator|+
name|Coverage
argument_list|,
name|otvalid
argument_list|,
name|cnt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|cnt
condition|;
operator|++
name|i
control|)
block|{
name|p
operator|+=
literal|2
expr_stmt|;
comment|/* Skip the value */
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|DeviceTableOffset
argument_list|)
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|DeviceTableOffset
argument_list|)
expr_stmt|;
if|if
condition|(
name|DeviceTableOffset
condition|)
name|otv_Device_validate
argument_list|(
name|table
operator|+
name|DeviceTableOffset
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                           MATH KERNING                        *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_MathKern_validate
name|otv_MathKern_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|otvalid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|i
decl_stmt|,
name|cnt
decl_stmt|,
name|table_size
decl_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|DeviceTableOffset
argument_list|)
expr_stmt|;
comment|/* OTV_NAME_ENTER( "MathKern" );*/
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|cnt
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|4
operator|*
name|cnt
operator|+
literal|2
argument_list|)
expr_stmt|;
name|table_size
operator|=
literal|4
operator|+
literal|4
operator|*
name|cnt
expr_stmt|;
comment|/* Heights */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|cnt
condition|;
operator|++
name|i
control|)
block|{
name|p
operator|+=
literal|2
expr_stmt|;
comment|/* Skip the value */
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|DeviceTableOffset
argument_list|)
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|DeviceTableOffset
argument_list|)
expr_stmt|;
if|if
condition|(
name|DeviceTableOffset
condition|)
name|otv_Device_validate
argument_list|(
name|table
operator|+
name|DeviceTableOffset
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
block|}
comment|/* One more Kerning value */
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|cnt
operator|+
literal|1
condition|;
operator|++
name|i
control|)
block|{
name|p
operator|+=
literal|2
expr_stmt|;
comment|/* Skip the value */
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|DeviceTableOffset
argument_list|)
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|DeviceTableOffset
argument_list|)
expr_stmt|;
if|if
condition|(
name|DeviceTableOffset
condition|)
name|otv_Device_validate
argument_list|(
name|table
operator|+
name|DeviceTableOffset
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_function
specifier|static
name|void
DECL|function|otv_MathKernInfo_validate
name|otv_MathKernInfo_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|otvalid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|i
decl_stmt|,
name|j
decl_stmt|,
name|cnt
decl_stmt|,
name|table_size
decl_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|Coverage
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|MKRecordOffset
argument_list|)
expr_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"MathKernInfo"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|Coverage
argument_list|)
expr_stmt|;
name|cnt
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|8
operator|*
name|cnt
argument_list|)
expr_stmt|;
name|table_size
operator|=
literal|4
operator|+
literal|8
operator|*
name|cnt
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|Coverage
argument_list|)
expr_stmt|;
name|otv_Coverage_validate
argument_list|(
name|table
operator|+
name|Coverage
argument_list|,
name|otvalid
argument_list|,
name|cnt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|cnt
condition|;
operator|++
name|i
control|)
block|{
for|for
control|(
name|j
operator|=
literal|0
init|;
name|j
operator|<
literal|4
condition|;
operator|++
name|j
control|)
block|{
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|MKRecordOffset
argument_list|)
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|MKRecordOffset
argument_list|)
expr_stmt|;
if|if
condition|(
name|MKRecordOffset
condition|)
name|otv_MathKern_validate
argument_list|(
name|table
operator|+
name|MKRecordOffset
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
block|}
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                         MATH GLYPH INFO                       *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_MathGlyphInfo_validate
name|otv_MathGlyphInfo_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|otvalid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|MathItalicsCorrectionInfo
decl_stmt|,
name|MathTopAccentAttachment
decl_stmt|;
name|FT_UInt
name|ExtendedShapeCoverage
decl_stmt|,
name|MathKernInfo
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"MathGlyphInfo"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|8
argument_list|)
expr_stmt|;
name|MathItalicsCorrectionInfo
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|MathTopAccentAttachment
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ExtendedShapeCoverage
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|MathKernInfo
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|MathItalicsCorrectionInfo
condition|)
name|otv_MathItalicsCorrectionInfo_validate
argument_list|(
name|table
operator|+
name|MathItalicsCorrectionInfo
argument_list|,
name|otvalid
argument_list|,
name|TRUE
argument_list|)
expr_stmt|;
comment|/* Italic correction and Top Accent Attachment have the same format */
if|if
condition|(
name|MathTopAccentAttachment
condition|)
name|otv_MathItalicsCorrectionInfo_validate
argument_list|(
name|table
operator|+
name|MathTopAccentAttachment
argument_list|,
name|otvalid
argument_list|,
name|FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
name|ExtendedShapeCoverage
condition|)
block|{
name|OTV_NAME_ENTER
argument_list|(
literal|"ExtendedShapeCoverage"
argument_list|)
expr_stmt|;
name|otv_Coverage_validate
argument_list|(
name|table
operator|+
name|ExtendedShapeCoverage
argument_list|,
name|otvalid
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|OTV_EXIT
expr_stmt|;
block|}
if|if
condition|(
name|MathKernInfo
condition|)
name|otv_MathKernInfo_validate
argument_list|(
name|table
operator|+
name|MathKernInfo
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                    MATH GLYPH CONSTRUCTION                    *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_GlyphAssembly_validate
name|otv_GlyphAssembly_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|otvalid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|pcnt
decl_stmt|,
name|table_size
decl_stmt|;
name|FT_UInt
name|i
decl_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|DeviceTableOffset
argument_list|)
expr_stmt|;
comment|/* OTV_NAME_ENTER( "GlyphAssembly" ); */
name|OTV_LIMIT_CHECK
argument_list|(
literal|6
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
comment|/* Skip the Italics Correction value */
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|DeviceTableOffset
argument_list|)
expr_stmt|;
name|pcnt
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|8
operator|*
name|pcnt
argument_list|)
expr_stmt|;
name|table_size
operator|=
literal|6
operator|+
literal|8
operator|*
name|pcnt
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|DeviceTableOffset
argument_list|)
expr_stmt|;
if|if
condition|(
name|DeviceTableOffset
condition|)
name|otv_Device_validate
argument_list|(
name|table
operator|+
name|DeviceTableOffset
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|pcnt
condition|;
operator|++
name|i
control|)
block|{
name|FT_UInt
name|gid
decl_stmt|;
name|gid
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|gid
operator|>=
name|otvalid
operator|->
name|glyph_count
condition|)
name|FT_INVALID_GLYPH_ID
expr_stmt|;
name|p
operator|+=
literal|2
operator|*
literal|4
expr_stmt|;
comment|/* skip the Start, End, Full, and Flags fields */
block|}
comment|/* OTV_EXIT; */
block|}
end_function
begin_function
specifier|static
name|void
DECL|function|otv_MathGlyphConstruction_validate
name|otv_MathGlyphConstruction_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|otvalid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|vcnt
decl_stmt|,
name|table_size
decl_stmt|;
name|FT_UInt
name|i
decl_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|GlyphAssembly
argument_list|)
expr_stmt|;
comment|/* OTV_NAME_ENTER( "MathGlyphConstruction" ); */
name|OTV_LIMIT_CHECK
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|GlyphAssembly
argument_list|)
expr_stmt|;
name|vcnt
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|4
operator|*
name|vcnt
argument_list|)
expr_stmt|;
name|table_size
operator|=
literal|4
operator|+
literal|4
operator|*
name|vcnt
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|vcnt
condition|;
operator|++
name|i
control|)
block|{
name|FT_UInt
name|gid
decl_stmt|;
name|gid
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|gid
operator|>=
name|otvalid
operator|->
name|glyph_count
condition|)
name|FT_INVALID_GLYPH_ID
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
comment|/* skip the size */
block|}
name|OTV_SIZE_CHECK
argument_list|(
name|GlyphAssembly
argument_list|)
expr_stmt|;
if|if
condition|(
name|GlyphAssembly
condition|)
name|otv_GlyphAssembly_validate
argument_list|(
name|table
operator|+
name|GlyphAssembly
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
comment|/* OTV_EXIT; */
block|}
end_function
begin_function
specifier|static
name|void
DECL|function|otv_MathVariants_validate
name|otv_MathVariants_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|otvalid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|vcnt
decl_stmt|,
name|hcnt
decl_stmt|,
name|i
decl_stmt|,
name|table_size
decl_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|VCoverage
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|HCoverage
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|Offset
argument_list|)
expr_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"MathVariants"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
comment|/* Skip the MinConnectorOverlap constant */
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|VCoverage
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|HCoverage
argument_list|)
expr_stmt|;
name|vcnt
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|hcnt
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
operator|*
name|vcnt
operator|+
literal|2
operator|*
name|hcnt
argument_list|)
expr_stmt|;
name|table_size
operator|=
literal|10
operator|+
literal|2
operator|*
name|vcnt
operator|+
literal|2
operator|*
name|hcnt
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|VCoverage
argument_list|)
expr_stmt|;
if|if
condition|(
name|VCoverage
condition|)
name|otv_Coverage_validate
argument_list|(
name|table
operator|+
name|VCoverage
argument_list|,
name|otvalid
argument_list|,
name|vcnt
argument_list|)
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|HCoverage
argument_list|)
expr_stmt|;
if|if
condition|(
name|HCoverage
condition|)
name|otv_Coverage_validate
argument_list|(
name|table
operator|+
name|HCoverage
argument_list|,
name|otvalid
argument_list|,
name|hcnt
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|vcnt
condition|;
operator|++
name|i
control|)
block|{
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|Offset
argument_list|)
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|Offset
argument_list|)
expr_stmt|;
name|otv_MathGlyphConstruction_validate
argument_list|(
name|table
operator|+
name|Offset
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|hcnt
condition|;
operator|++
name|i
control|)
block|{
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|Offset
argument_list|)
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|Offset
argument_list|)
expr_stmt|;
name|otv_MathGlyphConstruction_validate
argument_list|(
name|table
operator|+
name|Offset
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                          MATH TABLE                           *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/* sets otvalid->glyph_count */
end_comment
begin_macro
name|FT_LOCAL_DEF
argument_list|(
argument|void
argument_list|)
end_macro
begin_macro
DECL|function|otv_MATH_validate
name|otv_MATH_validate
argument_list|(
argument|FT_Bytes      table
argument_list|,
argument|FT_UInt       glyph_count
argument_list|,
argument|FT_Validator  ftvalid
argument_list|)
end_macro
begin_block
block|{
name|OTV_ValidatorRec
name|otvalidrec
decl_stmt|;
name|OTV_Validator
name|otvalid
init|=
operator|&
name|otvalidrec
decl_stmt|;
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|MathConstants
decl_stmt|,
name|MathGlyphInfo
decl_stmt|,
name|MathVariants
decl_stmt|;
name|otvalid
operator|->
name|root
operator|=
name|ftvalid
expr_stmt|;
name|FT_TRACE3
argument_list|(
operator|(
literal|"validating MATH table\n"
operator|)
argument_list|)
expr_stmt|;
name|OTV_INIT
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|FT_NEXT_ULONG
argument_list|(
name|p
argument_list|)
operator|!=
literal|0x10000UL
condition|)
comment|/* Version */
name|FT_INVALID_FORMAT
expr_stmt|;
name|MathConstants
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|MathGlyphInfo
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|MathVariants
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|otvalid
operator|->
name|glyph_count
operator|=
name|glyph_count
expr_stmt|;
name|otv_MathConstants_validate
argument_list|(
name|table
operator|+
name|MathConstants
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
name|otv_MathGlyphInfo_validate
argument_list|(
name|table
operator|+
name|MathGlyphInfo
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
name|otv_MathVariants_validate
argument_list|(
name|table
operator|+
name|MathVariants
argument_list|,
name|otvalid
argument_list|)
expr_stmt|;
name|FT_TRACE4
argument_list|(
operator|(
literal|"\n"
operator|)
argument_list|)
expr_stmt|;
block|}
end_block
begin_comment
comment|/* END */
end_comment
end_unit
