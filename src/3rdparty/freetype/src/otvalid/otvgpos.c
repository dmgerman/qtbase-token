begin_unit
begin_comment
comment|/***************************************************************************/
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  otvgpos.c                                                              */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*    OpenType GPOS table validation (body).                               */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  Copyright 2002, 2004, 2005, 2006, 2007, 2008 by                        */
end_comment
begin_comment
comment|/*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  This file is part of the FreeType project, and may only be used,       */
end_comment
begin_comment
comment|/*  modified, and distributed under the terms of the FreeType project      */
end_comment
begin_comment
comment|/*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */
end_comment
begin_comment
comment|/*  this file you indicate that you have read the license and              */
end_comment
begin_comment
comment|/*  understand and accept it fully.                                        */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/***************************************************************************/
end_comment
begin_include
include|#
directive|include
file|"otvalid.h"
end_include
begin_include
include|#
directive|include
file|"otvcommn.h"
end_include
begin_include
include|#
directive|include
file|"otvgpos.h"
end_include
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */
end_comment
begin_comment
comment|/* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */
end_comment
begin_comment
comment|/* messages during execution.                                            */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_undef
DECL|macro|FT_COMPONENT
undef|#
directive|undef
name|FT_COMPONENT
end_undef
begin_define
DECL|macro|FT_COMPONENT
define|#
directive|define
name|FT_COMPONENT
value|trace_otvgpos
end_define
begin_function_decl
specifier|static
name|void
name|otv_Anchor_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|valid
parameter_list|)
function_decl|;
end_function_decl
begin_function_decl
specifier|static
name|void
name|otv_MarkArray_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|valid
parameter_list|)
function_decl|;
end_function_decl
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                      UTILITY FUNCTIONS                        *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_define
DECL|macro|BaseArrayFunc
define|#
directive|define
name|BaseArrayFunc
value|otv_x_sxy
end_define
begin_define
DECL|macro|LigatureAttachFunc
define|#
directive|define
name|LigatureAttachFunc
value|otv_x_sxy
end_define
begin_define
DECL|macro|Mark2ArrayFunc
define|#
directive|define
name|Mark2ArrayFunc
value|otv_x_sxy
end_define
begin_comment
comment|/* uses valid->extra1 (counter)                             */
end_comment
begin_comment
comment|/* uses valid->extra2 (boolean to handle NULL anchor field) */
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_x_sxy
name|otv_x_sxy
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|valid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|Count
decl_stmt|,
name|count1
decl_stmt|,
name|table_size
decl_stmt|;
name|OTV_ENTER
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|Count
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (Count = %d)\n"
operator|,
name|Count
operator|)
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
name|Count
operator|*
name|valid
operator|->
name|extra1
operator|*
literal|2
argument_list|)
expr_stmt|;
name|table_size
operator|=
name|Count
operator|*
name|valid
operator|->
name|extra1
operator|*
literal|2
operator|+
literal|2
expr_stmt|;
for|for
control|(
init|;
name|Count
operator|>
literal|0
condition|;
name|Count
operator|--
control|)
for|for
control|(
name|count1
operator|=
name|valid
operator|->
name|extra1
init|;
name|count1
operator|>
literal|0
condition|;
name|count1
operator|--
control|)
block|{
name|OTV_OPTIONAL_TABLE
argument_list|(
name|anchor_offset
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|anchor_offset
argument_list|)
expr_stmt|;
if|if
condition|(
name|valid
operator|->
name|extra2
condition|)
block|{
name|OTV_SIZE_CHECK
argument_list|(
name|anchor_offset
argument_list|)
expr_stmt|;
if|if
condition|(
name|anchor_offset
condition|)
name|otv_Anchor_validate
argument_list|(
name|table
operator|+
name|anchor_offset
argument_list|,
name|valid
argument_list|)
expr_stmt|;
block|}
else|else
name|otv_Anchor_validate
argument_list|(
name|table
operator|+
name|anchor_offset
argument_list|,
name|valid
argument_list|)
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_define
DECL|macro|MarkBasePosFormat1Func
define|#
directive|define
name|MarkBasePosFormat1Func
value|otv_u_O_O_u_O_O
end_define
begin_define
DECL|macro|MarkLigPosFormat1Func
define|#
directive|define
name|MarkLigPosFormat1Func
value|otv_u_O_O_u_O_O
end_define
begin_define
DECL|macro|MarkMarkPosFormat1Func
define|#
directive|define
name|MarkMarkPosFormat1Func
value|otv_u_O_O_u_O_O
end_define
begin_comment
comment|/* sets valid->extra1 (class count) */
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_u_O_O_u_O_O
name|otv_u_O_O_u_O_O
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|valid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|Coverage1
decl_stmt|,
name|Coverage2
decl_stmt|,
name|ClassCount
decl_stmt|;
name|FT_UInt
name|Array1
decl_stmt|,
name|Array2
decl_stmt|;
name|OTV_Validate_Func
name|func
decl_stmt|;
name|OTV_ENTER
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
comment|/* skip PosFormat */
name|OTV_LIMIT_CHECK
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|Coverage1
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|Coverage2
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ClassCount
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|Array1
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|Array2
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|otv_Coverage_validate
argument_list|(
name|table
operator|+
name|Coverage1
argument_list|,
name|valid
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|otv_Coverage_validate
argument_list|(
name|table
operator|+
name|Coverage2
argument_list|,
name|valid
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|otv_MarkArray_validate
argument_list|(
name|table
operator|+
name|Array1
argument_list|,
name|valid
argument_list|)
expr_stmt|;
name|valid
operator|->
name|nesting_level
operator|++
expr_stmt|;
name|func
operator|=
name|valid
operator|->
name|func
index|[
name|valid
operator|->
name|nesting_level
index|]
expr_stmt|;
name|valid
operator|->
name|extra1
operator|=
name|ClassCount
expr_stmt|;
name|func
argument_list|(
name|table
operator|+
name|Array2
argument_list|,
name|valid
argument_list|)
expr_stmt|;
name|valid
operator|->
name|nesting_level
operator|--
expr_stmt|;
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                        VALUE RECORDS                          *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_function
specifier|static
name|FT_UInt
DECL|function|otv_value_length
name|otv_value_length
parameter_list|(
name|FT_UInt
name|format
parameter_list|)
block|{
name|FT_UInt
name|count
decl_stmt|;
name|count
operator|=
operator|(
operator|(
name|format
operator|&
literal|0xAA
operator|)
operator|>>
literal|1
operator|)
operator|+
operator|(
name|format
operator|&
literal|0x55
operator|)
expr_stmt|;
name|count
operator|=
operator|(
operator|(
name|count
operator|&
literal|0xCC
operator|)
operator|>>
literal|2
operator|)
operator|+
operator|(
name|count
operator|&
literal|0x33
operator|)
expr_stmt|;
name|count
operator|=
operator|(
operator|(
name|count
operator|&
literal|0xF0
operator|)
operator|>>
literal|4
operator|)
operator|+
operator|(
name|count
operator|&
literal|0x0F
operator|)
expr_stmt|;
return|return
name|count
operator|*
literal|2
return|;
block|}
end_function
begin_comment
comment|/* uses valid->extra3 (pointer to base table) */
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_ValueRecord_validate
name|otv_ValueRecord_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|FT_UInt
name|format
parameter_list|,
name|OTV_Validator
name|valid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|count
decl_stmt|;
ifdef|#
directive|ifdef
name|FT_DEBUG_LEVEL_TRACE
name|FT_Int
name|loop
decl_stmt|;
name|FT_ULong
name|res
init|=
literal|0
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"ValueRecord"
argument_list|)
expr_stmt|;
comment|/* display `format' in dual representation */
for|for
control|(
name|loop
operator|=
literal|7
init|;
name|loop
operator|>=
literal|0
condition|;
name|loop
operator|--
control|)
block|{
name|res
operator|<<=
literal|4
expr_stmt|;
name|res
operator|+=
operator|(
name|format
operator|>>
name|loop
operator|)
operator|&
literal|1
expr_stmt|;
block|}
name|OTV_TRACE
argument_list|(
operator|(
literal|" (format 0b%08lx)\n"
operator|,
name|res
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|format
operator|>=
literal|0x100
condition|)
name|FT_INVALID_FORMAT
expr_stmt|;
for|for
control|(
name|count
operator|=
literal|4
init|;
name|count
operator|>
literal|0
condition|;
name|count
operator|--
control|)
block|{
if|if
condition|(
name|format
operator|&
literal|1
condition|)
block|{
comment|/* XPlacement, YPlacement, XAdvance, YAdvance */
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|2
expr_stmt|;
block|}
name|format
operator|>>=
literal|1
expr_stmt|;
block|}
for|for
control|(
name|count
operator|=
literal|4
init|;
name|count
operator|>
literal|0
condition|;
name|count
operator|--
control|)
block|{
if|if
condition|(
name|format
operator|&
literal|1
condition|)
block|{
name|FT_PtrDist
name|table_size
decl_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|device
argument_list|)
expr_stmt|;
comment|/* XPlaDevice, YPlaDevice, XAdvDevice, YAdvDevice */
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|device
argument_list|)
expr_stmt|;
comment|/* XXX: this value is usually too small, especially if the current */
comment|/* ValueRecord is part of an array -- getting the correct table    */
comment|/* size is probably not worth the trouble                          */
name|table_size
operator|=
name|p
operator|-
name|valid
operator|->
name|extra3
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|device
argument_list|)
expr_stmt|;
if|if
condition|(
name|device
condition|)
name|otv_Device_validate
argument_list|(
name|valid
operator|->
name|extra3
operator|+
name|device
argument_list|,
name|valid
argument_list|)
expr_stmt|;
block|}
name|format
operator|>>=
literal|1
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                           ANCHORS                             *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_Anchor_validate
name|otv_Anchor_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|valid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|AnchorFormat
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"Anchor"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|6
argument_list|)
expr_stmt|;
name|AnchorFormat
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (format %d)\n"
operator|,
name|AnchorFormat
operator|)
argument_list|)
expr_stmt|;
name|p
operator|+=
literal|4
expr_stmt|;
comment|/* skip XCoordinate and YCoordinate */
switch|switch
condition|(
name|AnchorFormat
condition|)
block|{
case|case
literal|1
case|:
break|break;
case|case
literal|2
case|:
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
comment|/* AnchorPoint */
break|break;
case|case
literal|3
case|:
block|{
name|FT_UInt
name|table_size
decl_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|XDeviceTable
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|YDeviceTable
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|XDeviceTable
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|YDeviceTable
argument_list|)
expr_stmt|;
name|table_size
operator|=
literal|6
operator|+
literal|4
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|XDeviceTable
argument_list|)
expr_stmt|;
if|if
condition|(
name|XDeviceTable
condition|)
name|otv_Device_validate
argument_list|(
name|table
operator|+
name|XDeviceTable
argument_list|,
name|valid
argument_list|)
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|YDeviceTable
argument_list|)
expr_stmt|;
if|if
condition|(
name|YDeviceTable
condition|)
name|otv_Device_validate
argument_list|(
name|table
operator|+
name|YDeviceTable
argument_list|,
name|valid
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
name|FT_INVALID_FORMAT
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                         MARK ARRAYS                           *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_MarkArray_validate
name|otv_MarkArray_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|valid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|MarkCount
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"MarkArray"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|MarkCount
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (MarkCount = %d)\n"
operator|,
name|MarkCount
operator|)
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
name|MarkCount
operator|*
literal|4
argument_list|)
expr_stmt|;
comment|/* MarkRecord */
for|for
control|(
init|;
name|MarkCount
operator|>
literal|0
condition|;
name|MarkCount
operator|--
control|)
block|{
name|p
operator|+=
literal|2
expr_stmt|;
comment|/* skip Class */
comment|/* MarkAnchor */
name|otv_Anchor_validate
argument_list|(
name|table
operator|+
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
argument_list|,
name|valid
argument_list|)
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                     GPOS LOOKUP TYPE 1                        *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/* sets valid->extra3 (pointer to base table) */
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_SinglePos_validate
name|otv_SinglePos_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|valid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|PosFormat
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"SinglePos"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|PosFormat
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (format %d)\n"
operator|,
name|PosFormat
operator|)
argument_list|)
expr_stmt|;
name|valid
operator|->
name|extra3
operator|=
name|table
expr_stmt|;
switch|switch
condition|(
name|PosFormat
condition|)
block|{
case|case
literal|1
case|:
comment|/* SinglePosFormat1 */
block|{
name|FT_UInt
name|Coverage
decl_stmt|,
name|ValueFormat
decl_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|Coverage
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ValueFormat
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|otv_Coverage_validate
argument_list|(
name|table
operator|+
name|Coverage
argument_list|,
name|valid
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|otv_ValueRecord_validate
argument_list|(
name|p
argument_list|,
name|ValueFormat
argument_list|,
name|valid
argument_list|)
expr_stmt|;
comment|/* Value */
block|}
break|break;
case|case
literal|2
case|:
comment|/* SinglePosFormat2 */
block|{
name|FT_UInt
name|Coverage
decl_stmt|,
name|ValueFormat
decl_stmt|,
name|ValueCount
decl_stmt|,
name|len_value
decl_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|6
argument_list|)
expr_stmt|;
name|Coverage
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ValueFormat
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ValueCount
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (ValueCount = %d)\n"
operator|,
name|ValueCount
operator|)
argument_list|)
expr_stmt|;
name|len_value
operator|=
name|otv_value_length
argument_list|(
name|ValueFormat
argument_list|)
expr_stmt|;
name|otv_Coverage_validate
argument_list|(
name|table
operator|+
name|Coverage
argument_list|,
name|valid
argument_list|,
name|ValueCount
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
name|ValueCount
operator|*
name|len_value
argument_list|)
expr_stmt|;
comment|/* Value */
for|for
control|(
init|;
name|ValueCount
operator|>
literal|0
condition|;
name|ValueCount
operator|--
control|)
block|{
name|otv_ValueRecord_validate
argument_list|(
name|p
argument_list|,
name|ValueFormat
argument_list|,
name|valid
argument_list|)
expr_stmt|;
name|p
operator|+=
name|len_value
expr_stmt|;
block|}
block|}
break|break;
default|default:
name|FT_INVALID_FORMAT
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                     GPOS LOOKUP TYPE 2                        *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_PairSet_validate
name|otv_PairSet_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|FT_UInt
name|format1
parameter_list|,
name|FT_UInt
name|format2
parameter_list|,
name|OTV_Validator
name|valid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|value_len1
decl_stmt|,
name|value_len2
decl_stmt|,
name|PairValueCount
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"PairSet"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|PairValueCount
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (PairValueCount = %d)\n"
operator|,
name|PairValueCount
operator|)
argument_list|)
expr_stmt|;
name|value_len1
operator|=
name|otv_value_length
argument_list|(
name|format1
argument_list|)
expr_stmt|;
name|value_len2
operator|=
name|otv_value_length
argument_list|(
name|format2
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
name|PairValueCount
operator|*
operator|(
name|value_len1
operator|+
name|value_len2
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
comment|/* PairValueRecord */
for|for
control|(
init|;
name|PairValueCount
operator|>
literal|0
condition|;
name|PairValueCount
operator|--
control|)
block|{
name|p
operator|+=
literal|2
expr_stmt|;
comment|/* skip SecondGlyph */
if|if
condition|(
name|format1
condition|)
name|otv_ValueRecord_validate
argument_list|(
name|p
argument_list|,
name|format1
argument_list|,
name|valid
argument_list|)
expr_stmt|;
comment|/* Value1 */
name|p
operator|+=
name|value_len1
expr_stmt|;
if|if
condition|(
name|format2
condition|)
name|otv_ValueRecord_validate
argument_list|(
name|p
argument_list|,
name|format2
argument_list|,
name|valid
argument_list|)
expr_stmt|;
comment|/* Value2 */
name|p
operator|+=
name|value_len2
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/* sets valid->extra3 (pointer to base table) */
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_PairPos_validate
name|otv_PairPos_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|valid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|PosFormat
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"PairPos"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|PosFormat
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (format %d)\n"
operator|,
name|PosFormat
operator|)
argument_list|)
expr_stmt|;
name|valid
operator|->
name|extra3
operator|=
name|table
expr_stmt|;
switch|switch
condition|(
name|PosFormat
condition|)
block|{
case|case
literal|1
case|:
comment|/* PairPosFormat1 */
block|{
name|FT_UInt
name|Coverage
decl_stmt|,
name|ValueFormat1
decl_stmt|,
name|ValueFormat2
decl_stmt|,
name|PairSetCount
decl_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|8
argument_list|)
expr_stmt|;
name|Coverage
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ValueFormat1
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ValueFormat2
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|PairSetCount
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (PairSetCount = %d)\n"
operator|,
name|PairSetCount
operator|)
argument_list|)
expr_stmt|;
name|otv_Coverage_validate
argument_list|(
name|table
operator|+
name|Coverage
argument_list|,
name|valid
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
name|PairSetCount
operator|*
literal|2
argument_list|)
expr_stmt|;
comment|/* PairSetOffset */
for|for
control|(
init|;
name|PairSetCount
operator|>
literal|0
condition|;
name|PairSetCount
operator|--
control|)
name|otv_PairSet_validate
argument_list|(
name|table
operator|+
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
argument_list|,
name|ValueFormat1
argument_list|,
name|ValueFormat2
argument_list|,
name|valid
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
literal|2
case|:
comment|/* PairPosFormat2 */
block|{
name|FT_UInt
name|Coverage
decl_stmt|,
name|ValueFormat1
decl_stmt|,
name|ValueFormat2
decl_stmt|,
name|ClassDef1
decl_stmt|,
name|ClassDef2
decl_stmt|;
name|FT_UInt
name|ClassCount1
decl_stmt|,
name|ClassCount2
decl_stmt|,
name|len_value1
decl_stmt|,
name|len_value2
decl_stmt|,
name|count
decl_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|14
argument_list|)
expr_stmt|;
name|Coverage
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ValueFormat1
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ValueFormat2
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ClassDef1
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ClassDef2
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ClassCount1
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ClassCount2
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (ClassCount1 = %d)\n"
operator|,
name|ClassCount1
operator|)
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (ClassCount2 = %d)\n"
operator|,
name|ClassCount2
operator|)
argument_list|)
expr_stmt|;
name|len_value1
operator|=
name|otv_value_length
argument_list|(
name|ValueFormat1
argument_list|)
expr_stmt|;
name|len_value2
operator|=
name|otv_value_length
argument_list|(
name|ValueFormat2
argument_list|)
expr_stmt|;
name|otv_Coverage_validate
argument_list|(
name|table
operator|+
name|Coverage
argument_list|,
name|valid
argument_list|,
operator|-
literal|1
argument_list|)
expr_stmt|;
name|otv_ClassDef_validate
argument_list|(
name|table
operator|+
name|ClassDef1
argument_list|,
name|valid
argument_list|)
expr_stmt|;
name|otv_ClassDef_validate
argument_list|(
name|table
operator|+
name|ClassDef2
argument_list|,
name|valid
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
name|ClassCount1
operator|*
name|ClassCount2
operator|*
operator|(
name|len_value1
operator|+
name|len_value2
operator|)
argument_list|)
expr_stmt|;
comment|/* Class1Record */
for|for
control|(
init|;
name|ClassCount1
operator|>
literal|0
condition|;
name|ClassCount1
operator|--
control|)
block|{
comment|/* Class2Record */
for|for
control|(
name|count
operator|=
name|ClassCount2
init|;
name|count
operator|>
literal|0
condition|;
name|count
operator|--
control|)
block|{
if|if
condition|(
name|ValueFormat1
condition|)
comment|/* Value1 */
name|otv_ValueRecord_validate
argument_list|(
name|p
argument_list|,
name|ValueFormat1
argument_list|,
name|valid
argument_list|)
expr_stmt|;
name|p
operator|+=
name|len_value1
expr_stmt|;
if|if
condition|(
name|ValueFormat2
condition|)
comment|/* Value2 */
name|otv_ValueRecord_validate
argument_list|(
name|p
argument_list|,
name|ValueFormat2
argument_list|,
name|valid
argument_list|)
expr_stmt|;
name|p
operator|+=
name|len_value2
expr_stmt|;
block|}
block|}
block|}
break|break;
default|default:
name|FT_INVALID_FORMAT
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                     GPOS LOOKUP TYPE 3                        *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_CursivePos_validate
name|otv_CursivePos_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|valid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|PosFormat
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"CursivePos"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|PosFormat
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (format %d)\n"
operator|,
name|PosFormat
operator|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|PosFormat
condition|)
block|{
case|case
literal|1
case|:
comment|/* CursivePosFormat1 */
block|{
name|FT_UInt
name|table_size
decl_stmt|;
name|FT_UInt
name|Coverage
decl_stmt|,
name|EntryExitCount
decl_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|EntryAnchor
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_TABLE
argument_list|(
name|ExitAnchor
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|4
argument_list|)
expr_stmt|;
name|Coverage
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|EntryExitCount
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (EntryExitCount = %d)\n"
operator|,
name|EntryExitCount
operator|)
argument_list|)
expr_stmt|;
name|otv_Coverage_validate
argument_list|(
name|table
operator|+
name|Coverage
argument_list|,
name|valid
argument_list|,
name|EntryExitCount
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
name|EntryExitCount
operator|*
literal|4
argument_list|)
expr_stmt|;
name|table_size
operator|=
name|EntryExitCount
operator|*
literal|4
operator|+
literal|4
expr_stmt|;
comment|/* EntryExitRecord */
for|for
control|(
init|;
name|EntryExitCount
operator|>
literal|0
condition|;
name|EntryExitCount
operator|--
control|)
block|{
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|EntryAnchor
argument_list|)
expr_stmt|;
name|OTV_OPTIONAL_OFFSET
argument_list|(
name|ExitAnchor
argument_list|)
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|EntryAnchor
argument_list|)
expr_stmt|;
if|if
condition|(
name|EntryAnchor
condition|)
name|otv_Anchor_validate
argument_list|(
name|table
operator|+
name|EntryAnchor
argument_list|,
name|valid
argument_list|)
expr_stmt|;
name|OTV_SIZE_CHECK
argument_list|(
name|ExitAnchor
argument_list|)
expr_stmt|;
if|if
condition|(
name|ExitAnchor
condition|)
name|otv_Anchor_validate
argument_list|(
name|table
operator|+
name|ExitAnchor
argument_list|,
name|valid
argument_list|)
expr_stmt|;
block|}
block|}
break|break;
default|default:
name|FT_INVALID_FORMAT
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                     GPOS LOOKUP TYPE 4                        *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/* UNDOCUMENTED (in OpenType 1.5):              */
end_comment
begin_comment
comment|/* BaseRecord tables can contain NULL pointers. */
end_comment
begin_comment
comment|/* sets valid->extra2 (1) */
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_MarkBasePos_validate
name|otv_MarkBasePos_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|valid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|PosFormat
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"MarkBasePos"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|PosFormat
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (format %d)\n"
operator|,
name|PosFormat
operator|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|PosFormat
condition|)
block|{
case|case
literal|1
case|:
name|valid
operator|->
name|extra2
operator|=
literal|1
expr_stmt|;
name|OTV_NEST2
argument_list|(
name|MarkBasePosFormat1
argument_list|,
name|BaseArray
argument_list|)
expr_stmt|;
name|OTV_RUN
argument_list|(
name|table
argument_list|,
name|valid
argument_list|)
expr_stmt|;
break|break;
default|default:
name|FT_INVALID_FORMAT
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                     GPOS LOOKUP TYPE 5                        *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/* sets valid->extra2 (1) */
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_MarkLigPos_validate
name|otv_MarkLigPos_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|valid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|PosFormat
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"MarkLigPos"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|PosFormat
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (format %d)\n"
operator|,
name|PosFormat
operator|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|PosFormat
condition|)
block|{
case|case
literal|1
case|:
name|valid
operator|->
name|extra2
operator|=
literal|1
expr_stmt|;
name|OTV_NEST3
argument_list|(
name|MarkLigPosFormat1
argument_list|,
name|LigatureArray
argument_list|,
name|LigatureAttach
argument_list|)
expr_stmt|;
name|OTV_RUN
argument_list|(
name|table
argument_list|,
name|valid
argument_list|)
expr_stmt|;
break|break;
default|default:
name|FT_INVALID_FORMAT
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                     GPOS LOOKUP TYPE 6                        *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/* sets valid->extra2 (0) */
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_MarkMarkPos_validate
name|otv_MarkMarkPos_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|valid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|PosFormat
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"MarkMarkPos"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|PosFormat
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (format %d)\n"
operator|,
name|PosFormat
operator|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|PosFormat
condition|)
block|{
case|case
literal|1
case|:
name|valid
operator|->
name|extra2
operator|=
literal|0
expr_stmt|;
name|OTV_NEST2
argument_list|(
name|MarkMarkPosFormat1
argument_list|,
name|Mark2Array
argument_list|)
expr_stmt|;
name|OTV_RUN
argument_list|(
name|table
argument_list|,
name|valid
argument_list|)
expr_stmt|;
break|break;
default|default:
name|FT_INVALID_FORMAT
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                     GPOS LOOKUP TYPE 7                        *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/* sets valid->extra1 (lookup count) */
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_ContextPos_validate
name|otv_ContextPos_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|valid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|PosFormat
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"ContextPos"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|PosFormat
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (format %d)\n"
operator|,
name|PosFormat
operator|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|PosFormat
condition|)
block|{
case|case
literal|1
case|:
comment|/* no need to check glyph indices/classes used as input for these */
comment|/* context rules since even invalid glyph indices/classes return  */
comment|/* meaningful results                                             */
name|valid
operator|->
name|extra1
operator|=
name|valid
operator|->
name|lookup_count
expr_stmt|;
name|OTV_NEST3
argument_list|(
name|ContextPosFormat1
argument_list|,
name|PosRuleSet
argument_list|,
name|PosRule
argument_list|)
expr_stmt|;
name|OTV_RUN
argument_list|(
name|table
argument_list|,
name|valid
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
comment|/* no need to check glyph indices/classes used as input for these */
comment|/* context rules since even invalid glyph indices/classes return  */
comment|/* meaningful results                                             */
name|OTV_NEST3
argument_list|(
name|ContextPosFormat2
argument_list|,
name|PosClassSet
argument_list|,
name|PosClassRule
argument_list|)
expr_stmt|;
name|OTV_RUN
argument_list|(
name|table
argument_list|,
name|valid
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|OTV_NEST1
argument_list|(
name|ContextPosFormat3
argument_list|)
expr_stmt|;
name|OTV_RUN
argument_list|(
name|table
argument_list|,
name|valid
argument_list|)
expr_stmt|;
break|break;
default|default:
name|FT_INVALID_FORMAT
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                     GPOS LOOKUP TYPE 8                        *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/* sets valid->extra1 (lookup count) */
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_ChainContextPos_validate
name|otv_ChainContextPos_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|valid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|PosFormat
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"ChainContextPos"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|PosFormat
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (format %d)\n"
operator|,
name|PosFormat
operator|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|PosFormat
condition|)
block|{
case|case
literal|1
case|:
comment|/* no need to check glyph indices/classes used as input for these */
comment|/* context rules since even invalid glyph indices/classes return  */
comment|/* meaningful results                                             */
name|valid
operator|->
name|extra1
operator|=
name|valid
operator|->
name|lookup_count
expr_stmt|;
name|OTV_NEST3
argument_list|(
name|ChainContextPosFormat1
argument_list|,
name|ChainPosRuleSet
argument_list|,
name|ChainPosRule
argument_list|)
expr_stmt|;
name|OTV_RUN
argument_list|(
name|table
argument_list|,
name|valid
argument_list|)
expr_stmt|;
break|break;
case|case
literal|2
case|:
comment|/* no need to check glyph indices/classes used as input for these */
comment|/* context rules since even invalid glyph indices/classes return  */
comment|/* meaningful results                                             */
name|OTV_NEST3
argument_list|(
name|ChainContextPosFormat2
argument_list|,
name|ChainPosClassSet
argument_list|,
name|ChainPosClassRule
argument_list|)
expr_stmt|;
name|OTV_RUN
argument_list|(
name|table
argument_list|,
name|valid
argument_list|)
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|OTV_NEST1
argument_list|(
name|ChainContextPosFormat3
argument_list|)
expr_stmt|;
name|OTV_RUN
argument_list|(
name|table
argument_list|,
name|valid
argument_list|)
expr_stmt|;
break|break;
default|default:
name|FT_INVALID_FORMAT
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                     GPOS LOOKUP TYPE 9                        *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/* uses valid->type_funcs */
end_comment
begin_function
specifier|static
name|void
DECL|function|otv_ExtensionPos_validate
name|otv_ExtensionPos_validate
parameter_list|(
name|FT_Bytes
name|table
parameter_list|,
name|OTV_Validator
name|valid
parameter_list|)
block|{
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|PosFormat
decl_stmt|;
name|OTV_NAME_ENTER
argument_list|(
literal|"ExtensionPos"
argument_list|)
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|PosFormat
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|OTV_TRACE
argument_list|(
operator|(
literal|" (format %d)\n"
operator|,
name|PosFormat
operator|)
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|PosFormat
condition|)
block|{
case|case
literal|1
case|:
comment|/* ExtensionPosFormat1 */
block|{
name|FT_UInt
name|ExtensionLookupType
decl_stmt|;
name|FT_ULong
name|ExtensionOffset
decl_stmt|;
name|OTV_Validate_Func
name|validate
decl_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|6
argument_list|)
expr_stmt|;
name|ExtensionLookupType
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|ExtensionOffset
operator|=
name|FT_NEXT_ULONG
argument_list|(
name|p
argument_list|)
expr_stmt|;
if|if
condition|(
name|ExtensionLookupType
operator|==
literal|0
operator|||
name|ExtensionLookupType
operator|>=
literal|9
condition|)
name|FT_INVALID_DATA
expr_stmt|;
name|validate
operator|=
name|valid
operator|->
name|type_funcs
index|[
name|ExtensionLookupType
operator|-
literal|1
index|]
expr_stmt|;
name|validate
argument_list|(
name|table
operator|+
name|ExtensionOffset
argument_list|,
name|valid
argument_list|)
expr_stmt|;
block|}
break|break;
default|default:
name|FT_INVALID_FORMAT
expr_stmt|;
block|}
name|OTV_EXIT
expr_stmt|;
block|}
end_function
begin_decl_stmt
DECL|variable|otv_gpos_validate_funcs
specifier|static
specifier|const
name|OTV_Validate_Func
name|otv_gpos_validate_funcs
index|[
literal|9
index|]
init|=
block|{
name|otv_SinglePos_validate
block|,
name|otv_PairPos_validate
block|,
name|otv_CursivePos_validate
block|,
name|otv_MarkBasePos_validate
block|,
name|otv_MarkLigPos_validate
block|,
name|otv_MarkMarkPos_validate
block|,
name|otv_ContextPos_validate
block|,
name|otv_ChainContextPos_validate
block|,
name|otv_ExtensionPos_validate
block|}
decl_stmt|;
end_decl_stmt
begin_comment
comment|/* sets valid->type_count */
end_comment
begin_comment
comment|/* sets valid->type_funcs */
end_comment
begin_macro
name|FT_LOCAL_DEF
argument_list|(
argument|void
argument_list|)
end_macro
begin_macro
DECL|function|otv_GPOS_subtable_validate
name|otv_GPOS_subtable_validate
argument_list|(
argument|FT_Bytes       table
argument_list|,
argument|OTV_Validator  valid
argument_list|)
end_macro
begin_block
block|{
name|valid
operator|->
name|type_count
operator|=
literal|9
expr_stmt|;
name|valid
operator|->
name|type_funcs
operator|=
operator|(
name|OTV_Validate_Func
operator|*
operator|)
name|otv_gpos_validate_funcs
expr_stmt|;
name|otv_Lookup_validate
argument_list|(
name|table
argument_list|,
name|valid
argument_list|)
expr_stmt|;
block|}
end_block
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                          GPOS TABLE                           *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/* sets valid->glyph_count */
end_comment
begin_macro
name|FT_LOCAL_DEF
argument_list|(
argument|void
argument_list|)
end_macro
begin_macro
DECL|function|otv_GPOS_validate
name|otv_GPOS_validate
argument_list|(
argument|FT_Bytes      table
argument_list|,
argument|FT_UInt       glyph_count
argument_list|,
argument|FT_Validator  ftvalid
argument_list|)
end_macro
begin_block
block|{
name|OTV_ValidatorRec
name|validrec
decl_stmt|;
name|OTV_Validator
name|valid
init|=
operator|&
name|validrec
decl_stmt|;
name|FT_Bytes
name|p
init|=
name|table
decl_stmt|;
name|FT_UInt
name|ScriptList
decl_stmt|,
name|FeatureList
decl_stmt|,
name|LookupList
decl_stmt|;
name|valid
operator|->
name|root
operator|=
name|ftvalid
expr_stmt|;
name|FT_TRACE3
argument_list|(
operator|(
literal|"validating GPOS table\n"
operator|)
argument_list|)
expr_stmt|;
name|OTV_INIT
expr_stmt|;
name|OTV_LIMIT_CHECK
argument_list|(
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|FT_NEXT_ULONG
argument_list|(
name|p
argument_list|)
operator|!=
literal|0x10000UL
condition|)
comment|/* Version */
name|FT_INVALID_FORMAT
expr_stmt|;
name|ScriptList
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|FeatureList
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|LookupList
operator|=
name|FT_NEXT_USHORT
argument_list|(
name|p
argument_list|)
expr_stmt|;
name|valid
operator|->
name|type_count
operator|=
literal|9
expr_stmt|;
name|valid
operator|->
name|type_funcs
operator|=
operator|(
name|OTV_Validate_Func
operator|*
operator|)
name|otv_gpos_validate_funcs
expr_stmt|;
name|valid
operator|->
name|glyph_count
operator|=
name|glyph_count
expr_stmt|;
name|otv_LookupList_validate
argument_list|(
name|table
operator|+
name|LookupList
argument_list|,
name|valid
argument_list|)
expr_stmt|;
name|otv_FeatureList_validate
argument_list|(
name|table
operator|+
name|FeatureList
argument_list|,
name|table
operator|+
name|LookupList
argument_list|,
name|valid
argument_list|)
expr_stmt|;
name|otv_ScriptList_validate
argument_list|(
name|table
operator|+
name|ScriptList
argument_list|,
name|table
operator|+
name|FeatureList
argument_list|,
name|valid
argument_list|)
expr_stmt|;
name|FT_TRACE4
argument_list|(
operator|(
literal|"\n"
operator|)
argument_list|)
expr_stmt|;
block|}
end_block
begin_comment
comment|/* END */
end_comment
end_unit
