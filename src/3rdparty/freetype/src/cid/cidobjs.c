begin_unit
begin_comment
comment|/***************************************************************************/
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  cidobjs.c                                                              */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*    CID objects manager (body).                                          */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  Copyright 1996-2001, 2002, 2003, 2004, 2005, 2006, 2008 by             */
end_comment
begin_comment
comment|/*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  This file is part of the FreeType project, and may only be used,       */
end_comment
begin_comment
comment|/*  modified, and distributed under the terms of the FreeType project      */
end_comment
begin_comment
comment|/*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */
end_comment
begin_comment
comment|/*  this file you indicate that you have read the license and              */
end_comment
begin_comment
comment|/*  understand and accept it fully.                                        */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/***************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<ft2build.h>
end_include
begin_include
include|#
directive|include
include|FT_INTERNAL_DEBUG_H
end_include
begin_include
include|#
directive|include
include|FT_INTERNAL_STREAM_H
end_include
begin_include
include|#
directive|include
file|"cidgload.h"
end_include
begin_include
include|#
directive|include
file|"cidload.h"
end_include
begin_include
include|#
directive|include
include|FT_SERVICE_POSTSCRIPT_CMAPS_H
end_include
begin_include
include|#
directive|include
include|FT_INTERNAL_POSTSCRIPT_AUX_H
end_include
begin_include
include|#
directive|include
include|FT_INTERNAL_POSTSCRIPT_HINTS_H
end_include
begin_include
include|#
directive|include
file|"ciderrs.h"
end_include
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */
end_comment
begin_comment
comment|/* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */
end_comment
begin_comment
comment|/* messages during execution.                                            */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_undef
DECL|macro|FT_COMPONENT
undef|#
directive|undef
name|FT_COMPONENT
end_undef
begin_define
DECL|macro|FT_COMPONENT
define|#
directive|define
name|FT_COMPONENT
value|trace_cidobjs
end_define
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*                            SLOT  FUNCTIONS                            */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_macro
name|FT_LOCAL_DEF
argument_list|(
argument|void
argument_list|)
end_macro
begin_macro
DECL|function|cid_slot_done
name|cid_slot_done
argument_list|(
argument|FT_GlyphSlot  slot
argument_list|)
end_macro
begin_block
block|{
name|slot
operator|->
name|internal
operator|->
name|glyph_hints
operator|=
literal|0
expr_stmt|;
block|}
end_block
begin_macro
DECL|function|FT_LOCAL_DEF
name|FT_LOCAL_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|cid_slot_init
argument_list|(
argument|FT_GlyphSlot  slot
argument_list|)
end_macro
begin_block
block|{
name|CID_Face
name|face
decl_stmt|;
name|PSHinter_Service
name|pshinter
decl_stmt|;
name|face
operator|=
operator|(
name|CID_Face
operator|)
name|slot
operator|->
name|face
expr_stmt|;
name|pshinter
operator|=
operator|(
name|PSHinter_Service
operator|)
name|face
operator|->
name|pshinter
expr_stmt|;
if|if
condition|(
name|pshinter
condition|)
block|{
name|FT_Module
name|module
decl_stmt|;
name|module
operator|=
name|FT_Get_Module
argument_list|(
name|slot
operator|->
name|face
operator|->
name|driver
operator|->
name|root
operator|.
name|library
argument_list|,
literal|"pshinter"
argument_list|)
expr_stmt|;
if|if
condition|(
name|module
condition|)
block|{
name|T1_Hints_Funcs
name|funcs
decl_stmt|;
name|funcs
operator|=
name|pshinter
operator|->
name|get_t1_funcs
argument_list|(
name|module
argument_list|)
expr_stmt|;
name|slot
operator|->
name|internal
operator|->
name|glyph_hints
operator|=
operator|(
name|void
operator|*
operator|)
name|funcs
expr_stmt|;
block|}
block|}
return|return
literal|0
return|;
block|}
end_block
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*                           SIZE  FUNCTIONS                             */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_function
specifier|static
name|PSH_Globals_Funcs
DECL|function|cid_size_get_globals_funcs
name|cid_size_get_globals_funcs
parameter_list|(
name|CID_Size
name|size
parameter_list|)
block|{
name|CID_Face
name|face
init|=
operator|(
name|CID_Face
operator|)
name|size
operator|->
name|root
operator|.
name|face
decl_stmt|;
name|PSHinter_Service
name|pshinter
init|=
operator|(
name|PSHinter_Service
operator|)
name|face
operator|->
name|pshinter
decl_stmt|;
name|FT_Module
name|module
decl_stmt|;
name|module
operator|=
name|FT_Get_Module
argument_list|(
name|size
operator|->
name|root
operator|.
name|face
operator|->
name|driver
operator|->
name|root
operator|.
name|library
argument_list|,
literal|"pshinter"
argument_list|)
expr_stmt|;
return|return
operator|(
name|module
operator|&&
name|pshinter
operator|&&
name|pshinter
operator|->
name|get_globals_funcs
operator|)
condition|?
name|pshinter
operator|->
name|get_globals_funcs
argument_list|(
name|module
argument_list|)
else|:
literal|0
return|;
block|}
end_function
begin_macro
name|FT_LOCAL_DEF
argument_list|(
argument|void
argument_list|)
end_macro
begin_macro
DECL|function|cid_size_done
name|cid_size_done
argument_list|(
argument|FT_Size  cidsize
argument_list|)
end_macro
begin_comment
DECL|function|cid_size_done
comment|/* CID_Size */
end_comment
begin_block
block|{
name|CID_Size
name|size
init|=
operator|(
name|CID_Size
operator|)
name|cidsize
decl_stmt|;
if|if
condition|(
name|cidsize
operator|->
name|internal
condition|)
block|{
name|PSH_Globals_Funcs
name|funcs
decl_stmt|;
name|funcs
operator|=
name|cid_size_get_globals_funcs
argument_list|(
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
name|funcs
condition|)
name|funcs
operator|->
name|destroy
argument_list|(
operator|(
name|PSH_Globals
operator|)
name|cidsize
operator|->
name|internal
argument_list|)
expr_stmt|;
name|cidsize
operator|->
name|internal
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_block
begin_macro
DECL|function|FT_LOCAL_DEF
name|FT_LOCAL_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|cid_size_init
argument_list|(
argument|FT_Size  cidsize
argument_list|)
end_macro
begin_comment
comment|/* CID_Size */
end_comment
begin_block
block|{
name|CID_Size
name|size
init|=
operator|(
name|CID_Size
operator|)
name|cidsize
decl_stmt|;
name|FT_Error
name|error
init|=
literal|0
decl_stmt|;
name|PSH_Globals_Funcs
name|funcs
init|=
name|cid_size_get_globals_funcs
argument_list|(
name|size
argument_list|)
decl_stmt|;
if|if
condition|(
name|funcs
condition|)
block|{
name|PSH_Globals
name|globals
decl_stmt|;
name|CID_Face
name|face
init|=
operator|(
name|CID_Face
operator|)
name|cidsize
operator|->
name|face
decl_stmt|;
name|CID_FaceDict
name|dict
init|=
name|face
operator|->
name|cid
operator|.
name|font_dicts
operator|+
name|face
operator|->
name|root
operator|.
name|face_index
decl_stmt|;
name|PS_Private
name|priv
init|=
operator|&
name|dict
operator|->
name|private_dict
decl_stmt|;
name|error
operator|=
name|funcs
operator|->
name|create
argument_list|(
name|cidsize
operator|->
name|face
operator|->
name|memory
argument_list|,
name|priv
argument_list|,
operator|&
name|globals
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|error
condition|)
name|cidsize
operator|->
name|internal
operator|=
operator|(
name|FT_Size_Internal
operator|)
operator|(
name|void
operator|*
operator|)
name|globals
expr_stmt|;
block|}
return|return
name|error
return|;
block|}
end_block
begin_macro
DECL|function|FT_LOCAL
name|FT_LOCAL
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|cid_size_request
argument_list|(
argument|FT_Size          size
argument_list|,
argument|FT_Size_Request  req
argument_list|)
end_macro
begin_block
block|{
name|PSH_Globals_Funcs
name|funcs
decl_stmt|;
name|FT_Request_Metrics
argument_list|(
name|size
operator|->
name|face
argument_list|,
name|req
argument_list|)
expr_stmt|;
name|funcs
operator|=
name|cid_size_get_globals_funcs
argument_list|(
operator|(
name|CID_Size
operator|)
name|size
argument_list|)
expr_stmt|;
if|if
condition|(
name|funcs
condition|)
name|funcs
operator|->
name|set_scale
argument_list|(
operator|(
name|PSH_Globals
operator|)
name|size
operator|->
name|internal
argument_list|,
name|size
operator|->
name|metrics
operator|.
name|x_scale
argument_list|,
name|size
operator|->
name|metrics
operator|.
name|y_scale
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
name|CID_Err_Ok
return|;
block|}
end_block
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*                           FACE  FUNCTIONS                             */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Function>                                                            */
end_comment
begin_comment
comment|/*    cid_face_done                                                      */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Description>                                                         */
end_comment
begin_comment
comment|/*    Finalizes a given face object.                                     */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Input>                                                               */
end_comment
begin_comment
comment|/*    face :: A pointer to the face object to destroy.                   */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_macro
name|FT_LOCAL_DEF
argument_list|(
argument|void
argument_list|)
end_macro
begin_macro
DECL|function|cid_face_done
name|cid_face_done
argument_list|(
argument|FT_Face  cidface
argument_list|)
end_macro
begin_comment
DECL|function|cid_face_done
comment|/* CID_Face */
end_comment
begin_block
block|{
name|CID_Face
name|face
init|=
operator|(
name|CID_Face
operator|)
name|cidface
decl_stmt|;
name|FT_Memory
name|memory
decl_stmt|;
name|CID_FaceInfo
name|cid
decl_stmt|;
name|PS_FontInfo
name|info
decl_stmt|;
if|if
condition|(
operator|!
name|face
condition|)
return|return;
name|cid
operator|=
operator|&
name|face
operator|->
name|cid
expr_stmt|;
name|info
operator|=
operator|&
name|cid
operator|->
name|font_info
expr_stmt|;
name|memory
operator|=
name|cidface
operator|->
name|memory
expr_stmt|;
comment|/* release subrs */
if|if
condition|(
name|face
operator|->
name|subrs
condition|)
block|{
name|FT_Int
name|n
decl_stmt|;
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|cid
operator|->
name|num_dicts
condition|;
name|n
operator|++
control|)
block|{
name|CID_Subrs
name|subr
init|=
name|face
operator|->
name|subrs
operator|+
name|n
decl_stmt|;
if|if
condition|(
name|subr
operator|->
name|code
condition|)
block|{
name|FT_FREE
argument_list|(
name|subr
operator|->
name|code
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|FT_FREE
argument_list|(
name|subr
operator|->
name|code
argument_list|)
expr_stmt|;
block|}
block|}
name|FT_FREE
argument_list|(
name|face
operator|->
name|subrs
argument_list|)
expr_stmt|;
block|}
comment|/* release FontInfo strings */
name|FT_FREE
argument_list|(
name|info
operator|->
name|version
argument_list|)
expr_stmt|;
name|FT_FREE
argument_list|(
name|info
operator|->
name|notice
argument_list|)
expr_stmt|;
name|FT_FREE
argument_list|(
name|info
operator|->
name|full_name
argument_list|)
expr_stmt|;
name|FT_FREE
argument_list|(
name|info
operator|->
name|family_name
argument_list|)
expr_stmt|;
name|FT_FREE
argument_list|(
name|info
operator|->
name|weight
argument_list|)
expr_stmt|;
comment|/* release font dictionaries */
name|FT_FREE
argument_list|(
name|cid
operator|->
name|font_dicts
argument_list|)
expr_stmt|;
name|cid
operator|->
name|num_dicts
operator|=
literal|0
expr_stmt|;
comment|/* release other strings */
name|FT_FREE
argument_list|(
name|cid
operator|->
name|cid_font_name
argument_list|)
expr_stmt|;
name|FT_FREE
argument_list|(
name|cid
operator|->
name|registry
argument_list|)
expr_stmt|;
name|FT_FREE
argument_list|(
name|cid
operator|->
name|ordering
argument_list|)
expr_stmt|;
name|cidface
operator|->
name|family_name
operator|=
literal|0
expr_stmt|;
name|cidface
operator|->
name|style_name
operator|=
literal|0
expr_stmt|;
name|FT_FREE
argument_list|(
name|face
operator|->
name|binary_data
argument_list|)
expr_stmt|;
name|FT_FREE
argument_list|(
name|face
operator|->
name|cid_stream
argument_list|)
expr_stmt|;
block|}
end_block
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Function>                                                            */
end_comment
begin_comment
comment|/*    cid_face_init                                                      */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Description>                                                         */
end_comment
begin_comment
comment|/*    Initializes a given CID face object.                               */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Input>                                                               */
end_comment
begin_comment
comment|/*    stream     :: The source font stream.                              */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*    face_index :: The index of the font face in the resource.          */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*    num_params :: Number of additional generic parameters.  Ignored.   */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*    params     :: Additional generic parameters.  Ignored.             */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<InOut>                                                               */
end_comment
begin_comment
comment|/*    face       :: The newly built face object.                         */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Return>                                                              */
end_comment
begin_comment
comment|/*    FreeType error code.  0 means success.                             */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_macro
DECL|function|FT_LOCAL_DEF
name|FT_LOCAL_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|cid_face_init
argument_list|(
argument|FT_Stream      stream
argument_list|,
argument|FT_Face        cidface
argument_list|,
comment|/* CID_Face */
argument|FT_Int         face_index
argument_list|,
argument|FT_Int         num_params
argument_list|,
argument|FT_Parameter*  params
argument_list|)
end_macro
begin_block
block|{
name|CID_Face
name|face
init|=
operator|(
name|CID_Face
operator|)
name|cidface
decl_stmt|;
name|FT_Error
name|error
decl_stmt|;
name|PSAux_Service
name|psaux
decl_stmt|;
name|PSHinter_Service
name|pshinter
decl_stmt|;
name|FT_UNUSED
argument_list|(
name|num_params
argument_list|)
expr_stmt|;
name|FT_UNUSED
argument_list|(
name|params
argument_list|)
expr_stmt|;
name|FT_UNUSED
argument_list|(
name|stream
argument_list|)
expr_stmt|;
name|cidface
operator|->
name|num_faces
operator|=
literal|1
expr_stmt|;
name|psaux
operator|=
operator|(
name|PSAux_Service
operator|)
name|face
operator|->
name|psaux
expr_stmt|;
if|if
condition|(
operator|!
name|psaux
condition|)
block|{
name|psaux
operator|=
operator|(
name|PSAux_Service
operator|)
name|FT_Get_Module_Interface
argument_list|(
name|FT_FACE_LIBRARY
argument_list|(
name|face
argument_list|)
argument_list|,
literal|"psaux"
argument_list|)
expr_stmt|;
name|face
operator|->
name|psaux
operator|=
name|psaux
expr_stmt|;
block|}
name|pshinter
operator|=
operator|(
name|PSHinter_Service
operator|)
name|face
operator|->
name|pshinter
expr_stmt|;
if|if
condition|(
operator|!
name|pshinter
condition|)
block|{
name|pshinter
operator|=
operator|(
name|PSHinter_Service
operator|)
name|FT_Get_Module_Interface
argument_list|(
name|FT_FACE_LIBRARY
argument_list|(
name|face
argument_list|)
argument_list|,
literal|"pshinter"
argument_list|)
expr_stmt|;
name|face
operator|->
name|pshinter
operator|=
name|pshinter
expr_stmt|;
block|}
comment|/* open the tokenizer; this will also check the font format */
if|if
condition|(
name|FT_STREAM_SEEK
argument_list|(
literal|0
argument_list|)
condition|)
goto|goto
name|Exit
goto|;
name|error
operator|=
name|cid_face_open
argument_list|(
name|face
argument_list|,
name|face_index
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
condition|)
goto|goto
name|Exit
goto|;
comment|/* if we just wanted to check the format, leave successfully now */
if|if
condition|(
name|face_index
operator|<
literal|0
condition|)
goto|goto
name|Exit
goto|;
comment|/* check the face index */
comment|/* XXX: handle CID fonts with more than a single face */
if|if
condition|(
name|face_index
operator|!=
literal|0
condition|)
block|{
name|FT_ERROR
argument_list|(
operator|(
literal|"cid_face_init: invalid face index\n"
operator|)
argument_list|)
expr_stmt|;
name|error
operator|=
name|CID_Err_Invalid_Argument
expr_stmt|;
goto|goto
name|Exit
goto|;
block|}
comment|/* now load the font program into the face object */
comment|/* initialize the face object fields */
comment|/* set up root face fields */
block|{
name|CID_FaceInfo
name|cid
init|=
operator|&
name|face
operator|->
name|cid
decl_stmt|;
name|PS_FontInfo
name|info
init|=
operator|&
name|cid
operator|->
name|font_info
decl_stmt|;
name|cidface
operator|->
name|num_glyphs
operator|=
name|cid
operator|->
name|cid_count
expr_stmt|;
name|cidface
operator|->
name|num_charmaps
operator|=
literal|0
expr_stmt|;
name|cidface
operator|->
name|face_index
operator|=
name|face_index
expr_stmt|;
name|cidface
operator|->
name|face_flags
operator|=
name|FT_FACE_FLAG_SCALABLE
operator||
comment|/* scalable outlines */
name|FT_FACE_FLAG_HORIZONTAL
operator||
comment|/* horizontal data   */
name|FT_FACE_FLAG_HINTER
expr_stmt|;
comment|/* has native hinter */
if|if
condition|(
name|info
operator|->
name|is_fixed_pitch
condition|)
name|cidface
operator|->
name|face_flags
operator||=
name|FT_FACE_FLAG_FIXED_WIDTH
expr_stmt|;
comment|/* XXX: TODO: add kerning with .afm support */
comment|/* get style name -- be careful, some broken fonts only */
comment|/* have a /FontName dictionary entry!                   */
name|cidface
operator|->
name|family_name
operator|=
name|info
operator|->
name|family_name
expr_stmt|;
comment|/* assume "Regular" style if we don't know better */
name|cidface
operator|->
name|style_name
operator|=
operator|(
name|char
operator|*
operator|)
literal|"Regular"
expr_stmt|;
if|if
condition|(
name|cidface
operator|->
name|family_name
condition|)
block|{
name|char
modifier|*
name|full
init|=
name|info
operator|->
name|full_name
decl_stmt|;
name|char
modifier|*
name|family
init|=
name|cidface
operator|->
name|family_name
decl_stmt|;
if|if
condition|(
name|full
condition|)
block|{
while|while
condition|(
operator|*
name|full
condition|)
block|{
if|if
condition|(
operator|*
name|full
operator|==
operator|*
name|family
condition|)
block|{
name|family
operator|++
expr_stmt|;
name|full
operator|++
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
operator|*
name|full
operator|==
literal|' '
operator|||
operator|*
name|full
operator|==
literal|'-'
condition|)
name|full
operator|++
expr_stmt|;
elseif|else
if|if
condition|(
operator|*
name|family
operator|==
literal|' '
operator|||
operator|*
name|family
operator|==
literal|'-'
condition|)
name|family
operator|++
expr_stmt|;
else|else
block|{
if|if
condition|(
operator|!
operator|*
name|family
condition|)
name|cidface
operator|->
name|style_name
operator|=
name|full
expr_stmt|;
break|break;
block|}
block|}
block|}
block|}
block|}
else|else
block|{
comment|/* do we have a `/FontName'? */
if|if
condition|(
name|cid
operator|->
name|cid_font_name
condition|)
name|cidface
operator|->
name|family_name
operator|=
name|cid
operator|->
name|cid_font_name
expr_stmt|;
block|}
comment|/* compute style flags */
name|cidface
operator|->
name|style_flags
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|italic_angle
condition|)
name|cidface
operator|->
name|style_flags
operator||=
name|FT_STYLE_FLAG_ITALIC
expr_stmt|;
if|if
condition|(
name|info
operator|->
name|weight
condition|)
block|{
if|if
condition|(
operator|!
name|ft_strcmp
argument_list|(
name|info
operator|->
name|weight
argument_list|,
literal|"Bold"
argument_list|)
operator|||
operator|!
name|ft_strcmp
argument_list|(
name|info
operator|->
name|weight
argument_list|,
literal|"Black"
argument_list|)
condition|)
name|cidface
operator|->
name|style_flags
operator||=
name|FT_STYLE_FLAG_BOLD
expr_stmt|;
block|}
comment|/* no embedded bitmap support */
name|cidface
operator|->
name|num_fixed_sizes
operator|=
literal|0
expr_stmt|;
name|cidface
operator|->
name|available_sizes
operator|=
literal|0
expr_stmt|;
name|cidface
operator|->
name|bbox
operator|.
name|xMin
operator|=
name|cid
operator|->
name|font_bbox
operator|.
name|xMin
operator|>>
literal|16
expr_stmt|;
name|cidface
operator|->
name|bbox
operator|.
name|yMin
operator|=
name|cid
operator|->
name|font_bbox
operator|.
name|yMin
operator|>>
literal|16
expr_stmt|;
comment|/* no `U' suffix here to 0xFFFF! */
name|cidface
operator|->
name|bbox
operator|.
name|xMax
operator|=
operator|(
name|cid
operator|->
name|font_bbox
operator|.
name|xMax
operator|+
literal|0xFFFF
operator|)
operator|>>
literal|16
expr_stmt|;
name|cidface
operator|->
name|bbox
operator|.
name|yMax
operator|=
operator|(
name|cid
operator|->
name|font_bbox
operator|.
name|yMax
operator|+
literal|0xFFFF
operator|)
operator|>>
literal|16
expr_stmt|;
if|if
condition|(
operator|!
name|cidface
operator|->
name|units_per_EM
condition|)
name|cidface
operator|->
name|units_per_EM
operator|=
literal|1000
expr_stmt|;
name|cidface
operator|->
name|ascender
operator|=
call|(
name|FT_Short
call|)
argument_list|(
name|cidface
operator|->
name|bbox
operator|.
name|yMax
argument_list|)
expr_stmt|;
name|cidface
operator|->
name|descender
operator|=
call|(
name|FT_Short
call|)
argument_list|(
name|cidface
operator|->
name|bbox
operator|.
name|yMin
argument_list|)
expr_stmt|;
name|cidface
operator|->
name|height
operator|=
call|(
name|FT_Short
call|)
argument_list|(
operator|(
name|cidface
operator|->
name|units_per_EM
operator|*
literal|12
operator|)
operator|/
literal|10
argument_list|)
expr_stmt|;
if|if
condition|(
name|cidface
operator|->
name|height
operator|<
name|cidface
operator|->
name|ascender
operator|-
name|cidface
operator|->
name|descender
condition|)
name|cidface
operator|->
name|height
operator|=
call|(
name|FT_Short
call|)
argument_list|(
name|cidface
operator|->
name|ascender
operator|-
name|cidface
operator|->
name|descender
argument_list|)
expr_stmt|;
name|cidface
operator|->
name|underline_position
operator|=
operator|(
name|FT_Short
operator|)
name|info
operator|->
name|underline_position
expr_stmt|;
name|cidface
operator|->
name|underline_thickness
operator|=
operator|(
name|FT_Short
operator|)
name|info
operator|->
name|underline_thickness
expr_stmt|;
block|}
name|Exit
label|:
return|return
name|error
return|;
block|}
end_block
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Function>                                                            */
end_comment
begin_comment
comment|/*    cid_driver_init                                                    */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Description>                                                         */
end_comment
begin_comment
comment|/*    Initializes a given CID driver object.                             */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Input>                                                               */
end_comment
begin_comment
comment|/*    driver :: A handle to the target driver object.                    */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Return>                                                              */
end_comment
begin_comment
comment|/*    FreeType error code.  0 means success.                             */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_macro
DECL|function|FT_LOCAL_DEF
name|FT_LOCAL_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|cid_driver_init
argument_list|(
argument|FT_Module  driver
argument_list|)
end_macro
begin_block
block|{
name|FT_UNUSED
argument_list|(
name|driver
argument_list|)
expr_stmt|;
return|return
name|CID_Err_Ok
return|;
block|}
end_block
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Function>                                                            */
end_comment
begin_comment
comment|/*    cid_driver_done                                                    */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Description>                                                         */
end_comment
begin_comment
comment|/*    Finalizes a given CID driver.                                      */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Input>                                                               */
end_comment
begin_comment
comment|/*    driver :: A handle to the target CID driver.                       */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_macro
name|FT_LOCAL_DEF
argument_list|(
argument|void
argument_list|)
end_macro
begin_macro
DECL|function|cid_driver_done
name|cid_driver_done
argument_list|(
argument|FT_Module  driver
argument_list|)
end_macro
begin_block
block|{
name|FT_UNUSED
argument_list|(
name|driver
argument_list|)
expr_stmt|;
block|}
end_block
begin_comment
comment|/* END */
end_comment
end_unit
