begin_unit
begin_comment
comment|/***************************************************************************/
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  cffcmap.c                                                              */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*    CFF character mapping table (cmap) support (body).                   */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  Copyright 2002-2015 by                                                 */
end_comment
begin_comment
comment|/*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  This file is part of the FreeType project, and may only be used,       */
end_comment
begin_comment
comment|/*  modified, and distributed under the terms of the FreeType project      */
end_comment
begin_comment
comment|/*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */
end_comment
begin_comment
comment|/*  this file you indicate that you have read the license and              */
end_comment
begin_comment
comment|/*  understand and accept it fully.                                        */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/***************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<ft2build.h>
end_include
begin_include
include|#
directive|include
include|FT_INTERNAL_DEBUG_H
end_include
begin_include
include|#
directive|include
file|"cffcmap.h"
end_include
begin_include
include|#
directive|include
file|"cffload.h"
end_include
begin_include
include|#
directive|include
file|"cfferrs.h"
end_include
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****           CFF STANDARD (AND EXPERT) ENCODING CMAPS            *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|cff_cmap_encoding_init
argument_list|(
argument|CFF_CMapStd  cmap
argument_list|,
argument|FT_Pointer   pointer
argument_list|)
end_macro
begin_block
block|{
name|TT_Face
name|face
init|=
operator|(
name|TT_Face
operator|)
name|FT_CMAP_FACE
argument_list|(
name|cmap
argument_list|)
decl_stmt|;
name|CFF_Font
name|cff
init|=
operator|(
name|CFF_Font
operator|)
name|face
operator|->
name|extra
operator|.
name|data
decl_stmt|;
name|CFF_Encoding
name|encoding
init|=
operator|&
name|cff
operator|->
name|encoding
decl_stmt|;
name|FT_UNUSED
argument_list|(
name|pointer
argument_list|)
expr_stmt|;
name|cmap
operator|->
name|gids
operator|=
name|encoding
operator|->
name|codes
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block
begin_macro
name|FT_CALLBACK_DEF
argument_list|(
argument|void
argument_list|)
end_macro
begin_macro
DECL|function|cff_cmap_encoding_done
name|cff_cmap_encoding_done
argument_list|(
argument|CFF_CMapStd  cmap
argument_list|)
end_macro
begin_block
block|{
name|cmap
operator|->
name|gids
operator|=
name|NULL
expr_stmt|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_UInt
argument_list|)
end_macro
begin_macro
name|cff_cmap_encoding_char_index
argument_list|(
argument|CFF_CMapStd  cmap
argument_list|,
argument|FT_UInt32    char_code
argument_list|)
end_macro
begin_block
block|{
name|FT_UInt
name|result
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|char_code
operator|<
literal|256
condition|)
name|result
operator|=
name|cmap
operator|->
name|gids
index|[
name|char_code
index|]
expr_stmt|;
return|return
name|result
return|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_UInt32
argument_list|)
end_macro
begin_macro
name|cff_cmap_encoding_char_next
argument_list|(
argument|CFF_CMapStd   cmap
argument_list|,
argument|FT_UInt32    *pchar_code
argument_list|)
end_macro
begin_block
block|{
name|FT_UInt
name|result
init|=
literal|0
decl_stmt|;
name|FT_UInt32
name|char_code
init|=
operator|*
name|pchar_code
decl_stmt|;
operator|*
name|pchar_code
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|char_code
operator|<
literal|255
condition|)
block|{
name|FT_UInt
name|code
init|=
call|(
name|FT_UInt
call|)
argument_list|(
name|char_code
operator|+
literal|1
argument_list|)
decl_stmt|;
for|for
control|(
init|;
condition|;
control|)
block|{
if|if
condition|(
name|code
operator|>=
literal|256
condition|)
break|break;
name|result
operator|=
name|cmap
operator|->
name|gids
index|[
name|code
index|]
expr_stmt|;
if|if
condition|(
name|result
operator|!=
literal|0
condition|)
block|{
operator|*
name|pchar_code
operator|=
name|code
expr_stmt|;
break|break;
block|}
name|code
operator|++
expr_stmt|;
block|}
block|}
return|return
name|result
return|;
block|}
end_block
begin_macro
name|FT_DEFINE_CMAP_CLASS
argument_list|(
argument|cff_cmap_encoding_class_rec
argument_list|,
argument|sizeof ( CFF_CMapStdRec )
argument_list|,
argument|(FT_CMap_InitFunc)     cff_cmap_encoding_init
argument_list|,
argument|(FT_CMap_DoneFunc)     cff_cmap_encoding_done
argument_list|,
argument|(FT_CMap_CharIndexFunc)cff_cmap_encoding_char_index
argument_list|,
argument|(FT_CMap_CharNextFunc) cff_cmap_encoding_char_next
argument_list|,
argument|NULL
argument_list|,
argument|NULL
argument_list|,
argument|NULL
argument_list|,
argument|NULL
argument_list|,
argument|NULL
argument_list|)
end_macro
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****              CFF SYNTHETIC UNICODE ENCODING CMAP              *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_macro
name|FT_CALLBACK_DEF
argument_list|(
argument|const char*
argument_list|)
end_macro
begin_macro
DECL|function|cff_sid_to_glyph_name
name|cff_sid_to_glyph_name
argument_list|(
argument|TT_Face  face
argument_list|,
argument|FT_UInt  idx
argument_list|)
end_macro
begin_block
block|{
name|CFF_Font
name|cff
init|=
operator|(
name|CFF_Font
operator|)
name|face
operator|->
name|extra
operator|.
name|data
decl_stmt|;
name|CFF_Charset
name|charset
init|=
operator|&
name|cff
operator|->
name|charset
decl_stmt|;
name|FT_UInt
name|sid
init|=
name|charset
operator|->
name|sids
index|[
name|idx
index|]
decl_stmt|;
return|return
name|cff_index_get_sid_string
argument_list|(
name|cff
argument_list|,
name|sid
argument_list|)
return|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|cff_cmap_unicode_init
argument_list|(
argument|PS_Unicodes  unicodes
argument_list|,
argument|FT_Pointer   pointer
argument_list|)
end_macro
begin_block
block|{
name|TT_Face
name|face
init|=
operator|(
name|TT_Face
operator|)
name|FT_CMAP_FACE
argument_list|(
name|unicodes
argument_list|)
decl_stmt|;
name|FT_Memory
name|memory
init|=
name|FT_FACE_MEMORY
argument_list|(
name|face
argument_list|)
decl_stmt|;
name|CFF_Font
name|cff
init|=
operator|(
name|CFF_Font
operator|)
name|face
operator|->
name|extra
operator|.
name|data
decl_stmt|;
name|CFF_Charset
name|charset
init|=
operator|&
name|cff
operator|->
name|charset
decl_stmt|;
name|FT_Service_PsCMaps
name|psnames
init|=
operator|(
name|FT_Service_PsCMaps
operator|)
name|cff
operator|->
name|psnames
decl_stmt|;
name|FT_UNUSED
argument_list|(
name|pointer
argument_list|)
expr_stmt|;
comment|/* can't build Unicode map for CID-keyed font */
comment|/* because we don't know glyph names.         */
if|if
condition|(
operator|!
name|charset
operator|->
name|sids
condition|)
return|return
name|FT_THROW
argument_list|(
name|No_Unicode_Glyph_Name
argument_list|)
return|;
return|return
name|psnames
operator|->
name|unicodes_init
argument_list|(
name|memory
argument_list|,
name|unicodes
argument_list|,
name|cff
operator|->
name|num_glyphs
argument_list|,
operator|(
name|PS_GetGlyphNameFunc
operator|)
operator|&
name|cff_sid_to_glyph_name
argument_list|,
operator|(
name|PS_FreeGlyphNameFunc
operator|)
name|NULL
argument_list|,
operator|(
name|FT_Pointer
operator|)
name|face
argument_list|)
return|;
block|}
end_block
begin_macro
name|FT_CALLBACK_DEF
argument_list|(
argument|void
argument_list|)
end_macro
begin_macro
DECL|function|cff_cmap_unicode_done
name|cff_cmap_unicode_done
argument_list|(
argument|PS_Unicodes  unicodes
argument_list|)
end_macro
begin_block
block|{
name|FT_Face
name|face
init|=
name|FT_CMAP_FACE
argument_list|(
name|unicodes
argument_list|)
decl_stmt|;
name|FT_Memory
name|memory
init|=
name|FT_FACE_MEMORY
argument_list|(
name|face
argument_list|)
decl_stmt|;
name|FT_FREE
argument_list|(
name|unicodes
operator|->
name|maps
argument_list|)
expr_stmt|;
name|unicodes
operator|->
name|num_maps
operator|=
literal|0
expr_stmt|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_UInt
argument_list|)
end_macro
begin_macro
name|cff_cmap_unicode_char_index
argument_list|(
argument|PS_Unicodes  unicodes
argument_list|,
argument|FT_UInt32    char_code
argument_list|)
end_macro
begin_block
block|{
name|TT_Face
name|face
init|=
operator|(
name|TT_Face
operator|)
name|FT_CMAP_FACE
argument_list|(
name|unicodes
argument_list|)
decl_stmt|;
name|CFF_Font
name|cff
init|=
operator|(
name|CFF_Font
operator|)
name|face
operator|->
name|extra
operator|.
name|data
decl_stmt|;
name|FT_Service_PsCMaps
name|psnames
init|=
operator|(
name|FT_Service_PsCMaps
operator|)
name|cff
operator|->
name|psnames
decl_stmt|;
return|return
name|psnames
operator|->
name|unicodes_char_index
argument_list|(
name|unicodes
argument_list|,
name|char_code
argument_list|)
return|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_UInt32
argument_list|)
end_macro
begin_macro
name|cff_cmap_unicode_char_next
argument_list|(
argument|PS_Unicodes  unicodes
argument_list|,
argument|FT_UInt32   *pchar_code
argument_list|)
end_macro
begin_block
block|{
name|TT_Face
name|face
init|=
operator|(
name|TT_Face
operator|)
name|FT_CMAP_FACE
argument_list|(
name|unicodes
argument_list|)
decl_stmt|;
name|CFF_Font
name|cff
init|=
operator|(
name|CFF_Font
operator|)
name|face
operator|->
name|extra
operator|.
name|data
decl_stmt|;
name|FT_Service_PsCMaps
name|psnames
init|=
operator|(
name|FT_Service_PsCMaps
operator|)
name|cff
operator|->
name|psnames
decl_stmt|;
return|return
name|psnames
operator|->
name|unicodes_char_next
argument_list|(
name|unicodes
argument_list|,
name|pchar_code
argument_list|)
return|;
block|}
end_block
begin_macro
name|FT_DEFINE_CMAP_CLASS
argument_list|(
argument|cff_cmap_unicode_class_rec
argument_list|,
argument|sizeof ( PS_UnicodesRec )
argument_list|,
argument|(FT_CMap_InitFunc)     cff_cmap_unicode_init
argument_list|,
argument|(FT_CMap_DoneFunc)     cff_cmap_unicode_done
argument_list|,
argument|(FT_CMap_CharIndexFunc)cff_cmap_unicode_char_index
argument_list|,
argument|(FT_CMap_CharNextFunc) cff_cmap_unicode_char_next
argument_list|,
argument|NULL
argument_list|,
argument|NULL
argument_list|,
argument|NULL
argument_list|,
argument|NULL
argument_list|,
argument|NULL
argument_list|)
end_macro
begin_comment
comment|/* END */
end_comment
end_unit
