begin_unit
begin_comment
comment|/***************************************************************************/
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  t1cmap.c                                                               */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*    Type 1 character map support (body).                                 */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  Copyright 2002, 2003, 2006, 2007 by                                    */
end_comment
begin_comment
comment|/*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  This file is part of the FreeType project, and may only be used,       */
end_comment
begin_comment
comment|/*  modified, and distributed under the terms of the FreeType project      */
end_comment
begin_comment
comment|/*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */
end_comment
begin_comment
comment|/*  this file you indicate that you have read the license and              */
end_comment
begin_comment
comment|/*  understand and accept it fully.                                        */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/***************************************************************************/
end_comment
begin_include
include|#
directive|include
file|"t1cmap.h"
end_include
begin_include
include|#
directive|include
include|FT_INTERNAL_DEBUG_H
end_include
begin_include
include|#
directive|include
file|"psauxerr.h"
end_include
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****          TYPE1 STANDARD (AND EXPERT) ENCODING CMAPS           *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_function
specifier|static
name|void
DECL|function|t1_cmap_std_init
name|t1_cmap_std_init
parameter_list|(
name|T1_CMapStd
name|cmap
parameter_list|,
name|FT_Int
name|is_expert
parameter_list|)
block|{
name|T1_Face
name|face
init|=
operator|(
name|T1_Face
operator|)
name|FT_CMAP_FACE
argument_list|(
name|cmap
argument_list|)
decl_stmt|;
name|FT_Service_PsCMaps
name|psnames
init|=
operator|(
name|FT_Service_PsCMaps
operator|)
name|face
operator|->
name|psnames
decl_stmt|;
name|cmap
operator|->
name|num_glyphs
operator|=
name|face
operator|->
name|type1
operator|.
name|num_glyphs
expr_stmt|;
name|cmap
operator|->
name|glyph_names
operator|=
operator|(
specifier|const
name|char
operator|*
specifier|const
operator|*
operator|)
name|face
operator|->
name|type1
operator|.
name|glyph_names
expr_stmt|;
name|cmap
operator|->
name|sid_to_string
operator|=
name|psnames
operator|->
name|adobe_std_strings
expr_stmt|;
name|cmap
operator|->
name|code_to_sid
operator|=
name|is_expert
condition|?
name|psnames
operator|->
name|adobe_expert_encoding
else|:
name|psnames
operator|->
name|adobe_std_encoding
expr_stmt|;
name|FT_ASSERT
argument_list|(
name|cmap
operator|->
name|code_to_sid
operator|!=
name|NULL
argument_list|)
expr_stmt|;
block|}
end_function
begin_macro
name|FT_CALLBACK_DEF
argument_list|(
argument|void
argument_list|)
end_macro
begin_macro
DECL|function|t1_cmap_std_done
name|t1_cmap_std_done
argument_list|(
argument|T1_CMapStd  cmap
argument_list|)
end_macro
begin_block
block|{
name|cmap
operator|->
name|num_glyphs
operator|=
literal|0
expr_stmt|;
name|cmap
operator|->
name|glyph_names
operator|=
name|NULL
expr_stmt|;
name|cmap
operator|->
name|sid_to_string
operator|=
name|NULL
expr_stmt|;
name|cmap
operator|->
name|code_to_sid
operator|=
name|NULL
expr_stmt|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_UInt
argument_list|)
end_macro
begin_macro
name|t1_cmap_std_char_index
argument_list|(
argument|T1_CMapStd  cmap
argument_list|,
argument|FT_UInt32   char_code
argument_list|)
end_macro
begin_block
block|{
name|FT_UInt
name|result
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|char_code
operator|<
literal|256
condition|)
block|{
name|FT_UInt
name|code
decl_stmt|,
name|n
decl_stmt|;
specifier|const
name|char
modifier|*
name|glyph_name
decl_stmt|;
comment|/* convert character code to Adobe SID string */
name|code
operator|=
name|cmap
operator|->
name|code_to_sid
index|[
name|char_code
index|]
expr_stmt|;
name|glyph_name
operator|=
name|cmap
operator|->
name|sid_to_string
argument_list|(
name|code
argument_list|)
expr_stmt|;
comment|/* look for the corresponding glyph name */
for|for
control|(
name|n
operator|=
literal|0
init|;
name|n
operator|<
name|cmap
operator|->
name|num_glyphs
condition|;
name|n
operator|++
control|)
block|{
specifier|const
name|char
modifier|*
name|gname
init|=
name|cmap
operator|->
name|glyph_names
index|[
name|n
index|]
decl_stmt|;
if|if
condition|(
name|gname
operator|&&
name|gname
index|[
literal|0
index|]
operator|==
name|glyph_name
index|[
literal|0
index|]
operator|&&
name|ft_strcmp
argument_list|(
name|gname
argument_list|,
name|glyph_name
argument_list|)
operator|==
literal|0
condition|)
block|{
name|result
operator|=
name|n
expr_stmt|;
break|break;
block|}
block|}
block|}
return|return
name|result
return|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_UInt32
argument_list|)
end_macro
begin_macro
name|t1_cmap_std_char_next
argument_list|(
argument|T1_CMapStd   cmap
argument_list|,
argument|FT_UInt32   *pchar_code
argument_list|)
end_macro
begin_block
block|{
name|FT_UInt
name|result
init|=
literal|0
decl_stmt|;
name|FT_UInt32
name|char_code
init|=
operator|*
name|pchar_code
operator|+
literal|1
decl_stmt|;
while|while
condition|(
name|char_code
operator|<
literal|256
condition|)
block|{
name|result
operator|=
name|t1_cmap_std_char_index
argument_list|(
name|cmap
argument_list|,
name|char_code
argument_list|)
expr_stmt|;
if|if
condition|(
name|result
operator|!=
literal|0
condition|)
goto|goto
name|Exit
goto|;
name|char_code
operator|++
expr_stmt|;
block|}
name|char_code
operator|=
literal|0
expr_stmt|;
name|Exit
label|:
operator|*
name|pchar_code
operator|=
name|char_code
expr_stmt|;
return|return
name|result
return|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|t1_cmap_standard_init
argument_list|(
argument|T1_CMapStd  cmap
argument_list|)
end_macro
begin_block
block|{
name|t1_cmap_std_init
argument_list|(
name|cmap
argument_list|,
literal|0
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block
begin_decl_stmt
name|FT_CALLBACK_TABLE_DEF
specifier|const
name|FT_CMap_ClassRec
DECL|variable|t1_cmap_standard_class_rec
name|t1_cmap_standard_class_rec
init|=
block|{
sizeof|sizeof
argument_list|(
name|T1_CMapStdRec
argument_list|)
block|,
operator|(
name|FT_CMap_InitFunc
operator|)
name|t1_cmap_standard_init
block|,
operator|(
name|FT_CMap_DoneFunc
operator|)
name|t1_cmap_std_done
block|,
operator|(
name|FT_CMap_CharIndexFunc
operator|)
name|t1_cmap_std_char_index
block|,
operator|(
name|FT_CMap_CharNextFunc
operator|)
name|t1_cmap_std_char_next
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|t1_cmap_expert_init
argument_list|(
argument|T1_CMapStd  cmap
argument_list|)
end_macro
begin_block
block|{
name|t1_cmap_std_init
argument_list|(
name|cmap
argument_list|,
literal|1
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block
begin_decl_stmt
name|FT_CALLBACK_TABLE_DEF
specifier|const
name|FT_CMap_ClassRec
DECL|variable|t1_cmap_expert_class_rec
name|t1_cmap_expert_class_rec
init|=
block|{
sizeof|sizeof
argument_list|(
name|T1_CMapStdRec
argument_list|)
block|,
operator|(
name|FT_CMap_InitFunc
operator|)
name|t1_cmap_expert_init
block|,
operator|(
name|FT_CMap_DoneFunc
operator|)
name|t1_cmap_std_done
block|,
operator|(
name|FT_CMap_CharIndexFunc
operator|)
name|t1_cmap_std_char_index
block|,
operator|(
name|FT_CMap_CharNextFunc
operator|)
name|t1_cmap_std_char_next
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****                    TYPE1 CUSTOM ENCODING CMAP                 *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|t1_cmap_custom_init
argument_list|(
argument|T1_CMapCustom  cmap
argument_list|)
end_macro
begin_block
block|{
name|T1_Face
name|face
init|=
operator|(
name|T1_Face
operator|)
name|FT_CMAP_FACE
argument_list|(
name|cmap
argument_list|)
decl_stmt|;
name|T1_Encoding
name|encoding
init|=
operator|&
name|face
operator|->
name|type1
operator|.
name|encoding
decl_stmt|;
name|cmap
operator|->
name|first
operator|=
name|encoding
operator|->
name|code_first
expr_stmt|;
name|cmap
operator|->
name|count
operator|=
call|(
name|FT_UInt
call|)
argument_list|(
name|encoding
operator|->
name|code_last
operator|-
name|cmap
operator|->
name|first
argument_list|)
expr_stmt|;
name|cmap
operator|->
name|indices
operator|=
name|encoding
operator|->
name|char_index
expr_stmt|;
name|FT_ASSERT
argument_list|(
name|cmap
operator|->
name|indices
operator|!=
name|NULL
argument_list|)
expr_stmt|;
name|FT_ASSERT
argument_list|(
name|encoding
operator|->
name|code_first
operator|<=
name|encoding
operator|->
name|code_last
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_block
begin_macro
name|FT_CALLBACK_DEF
argument_list|(
argument|void
argument_list|)
end_macro
begin_macro
DECL|function|t1_cmap_custom_done
name|t1_cmap_custom_done
argument_list|(
argument|T1_CMapCustom  cmap
argument_list|)
end_macro
begin_block
block|{
name|cmap
operator|->
name|indices
operator|=
name|NULL
expr_stmt|;
name|cmap
operator|->
name|first
operator|=
literal|0
expr_stmt|;
name|cmap
operator|->
name|count
operator|=
literal|0
expr_stmt|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_UInt
argument_list|)
end_macro
begin_macro
name|t1_cmap_custom_char_index
argument_list|(
argument|T1_CMapCustom  cmap
argument_list|,
argument|FT_UInt32      char_code
argument_list|)
end_macro
begin_block
block|{
name|FT_UInt
name|result
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|(
name|char_code
operator|>=
name|cmap
operator|->
name|first
operator|)
operator|&&
operator|(
name|char_code
operator|<
operator|(
name|cmap
operator|->
name|first
operator|+
name|cmap
operator|->
name|count
operator|)
operator|)
condition|)
name|result
operator|=
name|cmap
operator|->
name|indices
index|[
name|char_code
index|]
expr_stmt|;
return|return
name|result
return|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_UInt32
argument_list|)
end_macro
begin_macro
name|t1_cmap_custom_char_next
argument_list|(
argument|T1_CMapCustom  cmap
argument_list|,
argument|FT_UInt32     *pchar_code
argument_list|)
end_macro
begin_block
block|{
name|FT_UInt
name|result
init|=
literal|0
decl_stmt|;
name|FT_UInt32
name|char_code
init|=
operator|*
name|pchar_code
decl_stmt|;
operator|++
name|char_code
expr_stmt|;
if|if
condition|(
name|char_code
operator|<
name|cmap
operator|->
name|first
condition|)
name|char_code
operator|=
name|cmap
operator|->
name|first
expr_stmt|;
for|for
control|(
init|;
name|char_code
operator|<
operator|(
name|cmap
operator|->
name|first
operator|+
name|cmap
operator|->
name|count
operator|)
condition|;
name|char_code
operator|++
control|)
block|{
name|result
operator|=
name|cmap
operator|->
name|indices
index|[
name|char_code
index|]
expr_stmt|;
if|if
condition|(
name|result
operator|!=
literal|0
condition|)
goto|goto
name|Exit
goto|;
block|}
name|char_code
operator|=
literal|0
expr_stmt|;
name|Exit
label|:
operator|*
name|pchar_code
operator|=
name|char_code
expr_stmt|;
return|return
name|result
return|;
block|}
end_block
begin_decl_stmt
name|FT_CALLBACK_TABLE_DEF
specifier|const
name|FT_CMap_ClassRec
DECL|variable|t1_cmap_custom_class_rec
name|t1_cmap_custom_class_rec
init|=
block|{
sizeof|sizeof
argument_list|(
name|T1_CMapCustomRec
argument_list|)
block|,
operator|(
name|FT_CMap_InitFunc
operator|)
name|t1_cmap_custom_init
block|,
operator|(
name|FT_CMap_DoneFunc
operator|)
name|t1_cmap_custom_done
block|,
operator|(
name|FT_CMap_CharIndexFunc
operator|)
name|t1_cmap_custom_char_index
block|,
operator|(
name|FT_CMap_CharNextFunc
operator|)
name|t1_cmap_custom_char_next
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*****            TYPE1 SYNTHETIC UNICODE ENCODING CMAP              *****/
end_comment
begin_comment
comment|/*****                                                               *****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_macro
name|FT_CALLBACK_DEF
argument_list|(
argument|const char *
argument_list|)
end_macro
begin_macro
DECL|function|t1_get_glyph_name
name|t1_get_glyph_name
argument_list|(
argument|T1_Face  face
argument_list|,
argument|FT_UInt  idx
argument_list|)
end_macro
begin_block
block|{
return|return
name|face
operator|->
name|type1
operator|.
name|glyph_names
index|[
name|idx
index|]
return|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_Error
argument_list|)
end_macro
begin_macro
name|t1_cmap_unicode_init
argument_list|(
argument|PS_Unicodes  unicodes
argument_list|)
end_macro
begin_block
block|{
name|T1_Face
name|face
init|=
operator|(
name|T1_Face
operator|)
name|FT_CMAP_FACE
argument_list|(
name|unicodes
argument_list|)
decl_stmt|;
name|FT_Memory
name|memory
init|=
name|FT_FACE_MEMORY
argument_list|(
name|face
argument_list|)
decl_stmt|;
name|FT_Service_PsCMaps
name|psnames
init|=
operator|(
name|FT_Service_PsCMaps
operator|)
name|face
operator|->
name|psnames
decl_stmt|;
return|return
name|psnames
operator|->
name|unicodes_init
argument_list|(
name|memory
argument_list|,
name|unicodes
argument_list|,
name|face
operator|->
name|type1
operator|.
name|num_glyphs
argument_list|,
operator|(
name|PS_GetGlyphNameFunc
operator|)
operator|&
name|t1_get_glyph_name
argument_list|,
operator|(
name|PS_FreeGlyphNameFunc
operator|)
name|NULL
argument_list|,
operator|(
name|FT_Pointer
operator|)
name|face
argument_list|)
return|;
block|}
end_block
begin_macro
name|FT_CALLBACK_DEF
argument_list|(
argument|void
argument_list|)
end_macro
begin_macro
DECL|function|t1_cmap_unicode_done
name|t1_cmap_unicode_done
argument_list|(
argument|PS_Unicodes  unicodes
argument_list|)
end_macro
begin_block
block|{
name|FT_Face
name|face
init|=
name|FT_CMAP_FACE
argument_list|(
name|unicodes
argument_list|)
decl_stmt|;
name|FT_Memory
name|memory
init|=
name|FT_FACE_MEMORY
argument_list|(
name|face
argument_list|)
decl_stmt|;
name|FT_FREE
argument_list|(
name|unicodes
operator|->
name|maps
argument_list|)
expr_stmt|;
name|unicodes
operator|->
name|num_maps
operator|=
literal|0
expr_stmt|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_UInt
argument_list|)
end_macro
begin_macro
name|t1_cmap_unicode_char_index
argument_list|(
argument|PS_Unicodes  unicodes
argument_list|,
argument|FT_UInt32    char_code
argument_list|)
end_macro
begin_block
block|{
name|T1_Face
name|face
init|=
operator|(
name|T1_Face
operator|)
name|FT_CMAP_FACE
argument_list|(
name|unicodes
argument_list|)
decl_stmt|;
name|FT_Service_PsCMaps
name|psnames
init|=
operator|(
name|FT_Service_PsCMaps
operator|)
name|face
operator|->
name|psnames
decl_stmt|;
return|return
name|psnames
operator|->
name|unicodes_char_index
argument_list|(
name|unicodes
argument_list|,
name|char_code
argument_list|)
return|;
block|}
end_block
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_UInt32
argument_list|)
end_macro
begin_macro
name|t1_cmap_unicode_char_next
argument_list|(
argument|PS_Unicodes  unicodes
argument_list|,
argument|FT_UInt32   *pchar_code
argument_list|)
end_macro
begin_block
block|{
name|T1_Face
name|face
init|=
operator|(
name|T1_Face
operator|)
name|FT_CMAP_FACE
argument_list|(
name|unicodes
argument_list|)
decl_stmt|;
name|FT_Service_PsCMaps
name|psnames
init|=
operator|(
name|FT_Service_PsCMaps
operator|)
name|face
operator|->
name|psnames
decl_stmt|;
return|return
name|psnames
operator|->
name|unicodes_char_next
argument_list|(
name|unicodes
argument_list|,
name|pchar_code
argument_list|)
return|;
block|}
end_block
begin_decl_stmt
name|FT_CALLBACK_TABLE_DEF
specifier|const
name|FT_CMap_ClassRec
DECL|variable|t1_cmap_unicode_class_rec
name|t1_cmap_unicode_class_rec
init|=
block|{
sizeof|sizeof
argument_list|(
name|PS_UnicodesRec
argument_list|)
block|,
operator|(
name|FT_CMap_InitFunc
operator|)
name|t1_cmap_unicode_init
block|,
operator|(
name|FT_CMap_DoneFunc
operator|)
name|t1_cmap_unicode_done
block|,
operator|(
name|FT_CMap_CharIndexFunc
operator|)
name|t1_cmap_unicode_char_index
block|,
operator|(
name|FT_CMap_CharNextFunc
operator|)
name|t1_cmap_unicode_char_next
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|,
name|NULL
block|}
decl_stmt|;
end_decl_stmt
begin_comment
comment|/* END */
end_comment
end_unit
