begin_unit
begin_comment
comment|/***************************************************************************/
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  ttdriver.c                                                             */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*    TrueType font driver implementation (body).                          */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  Copyright 1996-2015 by                                                 */
end_comment
begin_comment
comment|/*  David Turner, Robert Wilhelm, and Werner Lemberg.                      */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/*  This file is part of the FreeType project, and may only be used,       */
end_comment
begin_comment
comment|/*  modified, and distributed under the terms of the FreeType project      */
end_comment
begin_comment
comment|/*  license, LICENSE.TXT.  By continuing to use, modify, or distribute     */
end_comment
begin_comment
comment|/*  this file you indicate that you have read the license and              */
end_comment
begin_comment
comment|/*  understand and accept it fully.                                        */
end_comment
begin_comment
comment|/*                                                                         */
end_comment
begin_comment
comment|/***************************************************************************/
end_comment
begin_include
include|#
directive|include
file|<ft2build.h>
end_include
begin_include
include|#
directive|include
include|FT_INTERNAL_DEBUG_H
end_include
begin_include
include|#
directive|include
include|FT_INTERNAL_STREAM_H
end_include
begin_include
include|#
directive|include
include|FT_INTERNAL_SFNT_H
end_include
begin_include
include|#
directive|include
include|FT_SERVICE_FONT_FORMAT_H
end_include
begin_ifdef
ifdef|#
directive|ifdef
name|TT_CONFIG_OPTION_GX_VAR_SUPPORT
end_ifdef
begin_include
include|#
directive|include
include|FT_MULTIPLE_MASTERS_H
end_include
begin_include
include|#
directive|include
include|FT_SERVICE_MULTIPLE_MASTERS_H
end_include
begin_endif
endif|#
directive|endif
end_endif
begin_include
include|#
directive|include
include|FT_SERVICE_TRUETYPE_ENGINE_H
end_include
begin_include
include|#
directive|include
include|FT_SERVICE_TRUETYPE_GLYF_H
end_include
begin_include
include|#
directive|include
include|FT_SERVICE_PROPERTIES_H
end_include
begin_include
include|#
directive|include
include|FT_TRUETYPE_DRIVER_H
end_include
begin_include
include|#
directive|include
file|"ttdriver.h"
end_include
begin_include
include|#
directive|include
file|"ttgload.h"
end_include
begin_include
include|#
directive|include
file|"ttpload.h"
end_include
begin_ifdef
ifdef|#
directive|ifdef
name|TT_CONFIG_OPTION_GX_VAR_SUPPORT
end_ifdef
begin_include
include|#
directive|include
file|"ttgxvar.h"
end_include
begin_endif
endif|#
directive|endif
end_endif
begin_include
include|#
directive|include
file|"tterrors.h"
end_include
begin_include
include|#
directive|include
file|"ttpic.h"
end_include
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/* The macro FT_COMPONENT is used in trace mode.  It is an implicit      */
end_comment
begin_comment
comment|/* parameter of the FT_TRACE() and FT_ERROR() macros, used to print/log  */
end_comment
begin_comment
comment|/* messages during execution.                                            */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_undef
DECL|macro|FT_COMPONENT
undef|#
directive|undef
name|FT_COMPONENT
end_undef
begin_define
DECL|macro|FT_COMPONENT
define|#
directive|define
name|FT_COMPONENT
value|trace_ttdriver
end_define
begin_comment
comment|/*    *  PROPERTY SERVICE    *    */
end_comment
begin_function
specifier|static
name|FT_Error
DECL|function|tt_property_set
name|tt_property_set
parameter_list|(
name|FT_Module
name|module
parameter_list|,
comment|/* TT_Driver */
specifier|const
name|char
modifier|*
name|property_name
parameter_list|,
specifier|const
name|void
modifier|*
name|value
parameter_list|)
block|{
name|FT_Error
name|error
init|=
name|FT_Err_Ok
decl_stmt|;
name|TT_Driver
name|driver
init|=
operator|(
name|TT_Driver
operator|)
name|module
decl_stmt|;
if|if
condition|(
operator|!
name|ft_strcmp
argument_list|(
name|property_name
argument_list|,
literal|"interpreter-version"
argument_list|)
condition|)
block|{
name|FT_UInt
modifier|*
name|interpreter_version
init|=
operator|(
name|FT_UInt
operator|*
operator|)
name|value
decl_stmt|;
ifndef|#
directive|ifndef
name|TT_CONFIG_OPTION_SUBPIXEL_HINTING
if|if
condition|(
operator|*
name|interpreter_version
operator|!=
name|TT_INTERPRETER_VERSION_35
condition|)
name|error
operator|=
name|FT_ERR
argument_list|(
name|Unimplemented_Feature
argument_list|)
expr_stmt|;
else|else
endif|#
directive|endif
name|driver
operator|->
name|interpreter_version
operator|=
operator|*
name|interpreter_version
expr_stmt|;
return|return
name|error
return|;
block|}
name|FT_TRACE0
argument_list|(
operator|(
literal|"tt_property_set: missing property `%s'\n"
operator|,
name|property_name
operator|)
argument_list|)
expr_stmt|;
return|return
name|FT_THROW
argument_list|(
name|Missing_Property
argument_list|)
return|;
block|}
end_function
begin_function
specifier|static
name|FT_Error
DECL|function|tt_property_get
name|tt_property_get
parameter_list|(
name|FT_Module
name|module
parameter_list|,
comment|/* TT_Driver */
specifier|const
name|char
modifier|*
name|property_name
parameter_list|,
specifier|const
name|void
modifier|*
name|value
parameter_list|)
block|{
name|FT_Error
name|error
init|=
name|FT_Err_Ok
decl_stmt|;
name|TT_Driver
name|driver
init|=
operator|(
name|TT_Driver
operator|)
name|module
decl_stmt|;
name|FT_UInt
name|interpreter_version
init|=
name|driver
operator|->
name|interpreter_version
decl_stmt|;
if|if
condition|(
operator|!
name|ft_strcmp
argument_list|(
name|property_name
argument_list|,
literal|"interpreter-version"
argument_list|)
condition|)
block|{
name|FT_UInt
modifier|*
name|val
init|=
operator|(
name|FT_UInt
operator|*
operator|)
name|value
decl_stmt|;
operator|*
name|val
operator|=
name|interpreter_version
expr_stmt|;
return|return
name|error
return|;
block|}
name|FT_TRACE0
argument_list|(
operator|(
literal|"tt_property_get: missing property `%s'\n"
operator|,
name|property_name
operator|)
argument_list|)
expr_stmt|;
return|return
name|FT_THROW
argument_list|(
name|Missing_Property
argument_list|)
return|;
block|}
end_function
begin_macro
name|FT_DEFINE_SERVICE_PROPERTIESREC
argument_list|(
argument|tt_service_properties
argument_list|,
argument|(FT_Properties_SetFunc)tt_property_set
argument_list|,
argument|(FT_Properties_GetFunc)tt_property_get
argument_list|)
end_macro
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/****                                                                 ****/
end_comment
begin_comment
comment|/****                                                                 ****/
end_comment
begin_comment
comment|/****                          F A C E S                              ****/
end_comment
begin_comment
comment|/****                                                                 ****/
end_comment
begin_comment
comment|/****                                                                 ****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Function>                                                            */
end_comment
begin_comment
comment|/*    tt_get_kerning                                                     */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Description>                                                         */
end_comment
begin_comment
comment|/*    A driver method used to return the kerning vector between two      */
end_comment
begin_comment
comment|/*    glyphs of the same face.                                           */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Input>                                                               */
end_comment
begin_comment
comment|/*    face        :: A handle to the source face object.                 */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*    left_glyph  :: The index of the left glyph in the kern pair.       */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*    right_glyph :: The index of the right glyph in the kern pair.      */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Output>                                                              */
end_comment
begin_comment
comment|/*    kerning     :: The kerning vector.  This is in font units for      */
end_comment
begin_comment
comment|/*                   scalable formats, and in pixels for fixed-sizes     */
end_comment
begin_comment
comment|/*                   formats.                                            */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Return>                                                              */
end_comment
begin_comment
comment|/*    FreeType error code.  0 means success.                             */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Note>                                                                */
end_comment
begin_comment
comment|/*    Only horizontal layouts (left-to-right& right-to-left) are        */
end_comment
begin_comment
comment|/*    supported by this function.  Other layouts, or more sophisticated  */
end_comment
begin_comment
comment|/*    kernings, are out of scope of this method (the basic driver        */
end_comment
begin_comment
comment|/*    interface is meant to be simple).                                  */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*    They can be implemented by format-specific interfaces.             */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_function
specifier|static
name|FT_Error
DECL|function|tt_get_kerning
name|tt_get_kerning
parameter_list|(
name|FT_Face
name|ttface
parameter_list|,
comment|/* TT_Face */
name|FT_UInt
name|left_glyph
parameter_list|,
name|FT_UInt
name|right_glyph
parameter_list|,
name|FT_Vector
modifier|*
name|kerning
parameter_list|)
block|{
name|TT_Face
name|face
init|=
operator|(
name|TT_Face
operator|)
name|ttface
decl_stmt|;
name|SFNT_Service
name|sfnt
init|=
operator|(
name|SFNT_Service
operator|)
name|face
operator|->
name|sfnt
decl_stmt|;
name|kerning
operator|->
name|x
operator|=
literal|0
expr_stmt|;
name|kerning
operator|->
name|y
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|sfnt
condition|)
name|kerning
operator|->
name|x
operator|=
name|sfnt
operator|->
name|get_kerning
argument_list|(
name|face
argument_list|,
name|left_glyph
argument_list|,
name|right_glyph
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function
begin_function
specifier|static
name|FT_Error
DECL|function|tt_get_advances
name|tt_get_advances
parameter_list|(
name|FT_Face
name|ttface
parameter_list|,
name|FT_UInt
name|start
parameter_list|,
name|FT_UInt
name|count
parameter_list|,
name|FT_Int32
name|flags
parameter_list|,
name|FT_Fixed
modifier|*
name|advances
parameter_list|)
block|{
name|FT_UInt
name|nn
decl_stmt|;
name|TT_Face
name|face
init|=
operator|(
name|TT_Face
operator|)
name|ttface
decl_stmt|;
comment|/* XXX: TODO: check for sbits */
if|if
condition|(
name|flags
operator|&
name|FT_LOAD_VERTICAL_LAYOUT
condition|)
block|{
for|for
control|(
name|nn
operator|=
literal|0
init|;
name|nn
operator|<
name|count
condition|;
name|nn
operator|++
control|)
block|{
name|FT_Short
name|tsb
decl_stmt|;
name|FT_UShort
name|ah
decl_stmt|;
comment|/* since we don't need `tsb', we use zero for `yMax' parameter */
name|TT_Get_VMetrics
argument_list|(
name|face
argument_list|,
name|start
operator|+
name|nn
argument_list|,
literal|0
argument_list|,
operator|&
name|tsb
argument_list|,
operator|&
name|ah
argument_list|)
expr_stmt|;
name|advances
index|[
name|nn
index|]
operator|=
name|ah
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|nn
operator|=
literal|0
init|;
name|nn
operator|<
name|count
condition|;
name|nn
operator|++
control|)
block|{
name|FT_Short
name|lsb
decl_stmt|;
name|FT_UShort
name|aw
decl_stmt|;
name|TT_Get_HMetrics
argument_list|(
name|face
argument_list|,
name|start
operator|+
name|nn
argument_list|,
operator|&
name|lsb
argument_list|,
operator|&
name|aw
argument_list|)
expr_stmt|;
name|advances
index|[
name|nn
index|]
operator|=
name|aw
expr_stmt|;
block|}
block|}
return|return
name|FT_Err_Ok
return|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/****                                                                 ****/
end_comment
begin_comment
comment|/****                                                                 ****/
end_comment
begin_comment
comment|/****                           S I Z E S                             ****/
end_comment
begin_comment
comment|/****                                                                 ****/
end_comment
begin_comment
comment|/****                                                                 ****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|TT_CONFIG_OPTION_EMBEDDED_BITMAPS
end_ifdef
begin_function
specifier|static
name|FT_Error
DECL|function|tt_size_select
name|tt_size_select
parameter_list|(
name|FT_Size
name|size
parameter_list|,
name|FT_ULong
name|strike_index
parameter_list|)
block|{
name|TT_Face
name|ttface
init|=
operator|(
name|TT_Face
operator|)
name|size
operator|->
name|face
decl_stmt|;
name|TT_Size
name|ttsize
init|=
operator|(
name|TT_Size
operator|)
name|size
decl_stmt|;
name|FT_Error
name|error
init|=
name|FT_Err_Ok
decl_stmt|;
name|ttsize
operator|->
name|strike_index
operator|=
name|strike_index
expr_stmt|;
if|if
condition|(
name|FT_IS_SCALABLE
argument_list|(
name|size
operator|->
name|face
argument_list|)
condition|)
block|{
comment|/* use the scaled metrics, even when tt_size_reset fails */
name|FT_Select_Metrics
argument_list|(
name|size
operator|->
name|face
argument_list|,
name|strike_index
argument_list|)
expr_stmt|;
name|tt_size_reset
argument_list|(
name|ttsize
argument_list|)
expr_stmt|;
comment|/* ignore return value */
block|}
else|else
block|{
name|SFNT_Service
name|sfnt
init|=
operator|(
name|SFNT_Service
operator|)
name|ttface
operator|->
name|sfnt
decl_stmt|;
name|FT_Size_Metrics
modifier|*
name|metrics
init|=
operator|&
name|size
operator|->
name|metrics
decl_stmt|;
name|error
operator|=
name|sfnt
operator|->
name|load_strike_metrics
argument_list|(
name|ttface
argument_list|,
name|strike_index
argument_list|,
name|metrics
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
condition|)
name|ttsize
operator|->
name|strike_index
operator|=
literal|0xFFFFFFFFUL
expr_stmt|;
block|}
return|return
name|error
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* TT_CONFIG_OPTION_EMBEDDED_BITMAPS */
end_comment
begin_function
specifier|static
name|FT_Error
DECL|function|tt_size_request
name|tt_size_request
parameter_list|(
name|FT_Size
name|size
parameter_list|,
name|FT_Size_Request
name|req
parameter_list|)
block|{
name|TT_Size
name|ttsize
init|=
operator|(
name|TT_Size
operator|)
name|size
decl_stmt|;
name|FT_Error
name|error
init|=
name|FT_Err_Ok
decl_stmt|;
ifdef|#
directive|ifdef
name|TT_CONFIG_OPTION_EMBEDDED_BITMAPS
if|if
condition|(
name|FT_HAS_FIXED_SIZES
argument_list|(
name|size
operator|->
name|face
argument_list|)
condition|)
block|{
name|TT_Face
name|ttface
init|=
operator|(
name|TT_Face
operator|)
name|size
operator|->
name|face
decl_stmt|;
name|SFNT_Service
name|sfnt
init|=
operator|(
name|SFNT_Service
operator|)
name|ttface
operator|->
name|sfnt
decl_stmt|;
name|FT_ULong
name|strike_index
decl_stmt|;
name|error
operator|=
name|sfnt
operator|->
name|set_sbit_strike
argument_list|(
name|ttface
argument_list|,
name|req
argument_list|,
operator|&
name|strike_index
argument_list|)
expr_stmt|;
if|if
condition|(
name|error
condition|)
name|ttsize
operator|->
name|strike_index
operator|=
literal|0xFFFFFFFFUL
expr_stmt|;
else|else
return|return
name|tt_size_select
argument_list|(
name|size
argument_list|,
name|strike_index
argument_list|)
return|;
block|}
endif|#
directive|endif
comment|/* TT_CONFIG_OPTION_EMBEDDED_BITMAPS */
name|FT_Request_Metrics
argument_list|(
name|size
operator|->
name|face
argument_list|,
name|req
argument_list|)
expr_stmt|;
if|if
condition|(
name|FT_IS_SCALABLE
argument_list|(
name|size
operator|->
name|face
argument_list|)
condition|)
block|{
name|error
operator|=
name|tt_size_reset
argument_list|(
name|ttsize
argument_list|)
expr_stmt|;
name|ttsize
operator|->
name|root
operator|.
name|metrics
operator|=
name|ttsize
operator|->
name|metrics
expr_stmt|;
block|}
return|return
name|error
return|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Function>                                                            */
end_comment
begin_comment
comment|/*    tt_glyph_load                                                      */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Description>                                                         */
end_comment
begin_comment
comment|/*    A driver method used to load a glyph within a given glyph slot.    */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Input>                                                               */
end_comment
begin_comment
comment|/*    slot        :: A handle to the target slot object where the glyph  */
end_comment
begin_comment
comment|/*                   will be loaded.                                     */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*    size        :: A handle to the source face size at which the glyph */
end_comment
begin_comment
comment|/*                   must be scaled, loaded, etc.                        */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*    glyph_index :: The index of the glyph in the font file.            */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*    load_flags  :: A flag indicating what to load for this glyph.  The */
end_comment
begin_comment
comment|/*                   FT_LOAD_XXX constants can be used to control the    */
end_comment
begin_comment
comment|/*                   glyph loading process (e.g., whether the outline    */
end_comment
begin_comment
comment|/*                   should be scaled, whether to load bitmaps or not,   */
end_comment
begin_comment
comment|/*                   whether to hint the outline, etc).                  */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_comment
comment|/*<Return>                                                              */
end_comment
begin_comment
comment|/*    FreeType error code.  0 means success.                             */
end_comment
begin_comment
comment|/*                                                                       */
end_comment
begin_function
specifier|static
name|FT_Error
DECL|function|tt_glyph_load
name|tt_glyph_load
parameter_list|(
name|FT_GlyphSlot
name|ttslot
parameter_list|,
comment|/* TT_GlyphSlot */
name|FT_Size
name|ttsize
parameter_list|,
comment|/* TT_Size      */
name|FT_UInt
name|glyph_index
parameter_list|,
name|FT_Int32
name|load_flags
parameter_list|)
block|{
name|TT_GlyphSlot
name|slot
init|=
operator|(
name|TT_GlyphSlot
operator|)
name|ttslot
decl_stmt|;
name|TT_Size
name|size
init|=
operator|(
name|TT_Size
operator|)
name|ttsize
decl_stmt|;
name|FT_Face
name|face
init|=
name|ttslot
operator|->
name|face
decl_stmt|;
name|FT_Error
name|error
decl_stmt|;
if|if
condition|(
operator|!
name|slot
condition|)
return|return
name|FT_THROW
argument_list|(
name|Invalid_Slot_Handle
argument_list|)
return|;
if|if
condition|(
operator|!
name|size
condition|)
return|return
name|FT_THROW
argument_list|(
name|Invalid_Size_Handle
argument_list|)
return|;
if|if
condition|(
operator|!
name|face
condition|)
return|return
name|FT_THROW
argument_list|(
name|Invalid_Face_Handle
argument_list|)
return|;
ifdef|#
directive|ifdef
name|FT_CONFIG_OPTION_INCREMENTAL
if|if
condition|(
name|glyph_index
operator|>=
operator|(
name|FT_UInt
operator|)
name|face
operator|->
name|num_glyphs
operator|&&
operator|!
name|face
operator|->
name|internal
operator|->
name|incremental_interface
condition|)
else|#
directive|else
if|if
condition|(
name|glyph_index
operator|>=
operator|(
name|FT_UInt
operator|)
name|face
operator|->
name|num_glyphs
condition|)
endif|#
directive|endif
return|return
name|FT_THROW
argument_list|(
name|Invalid_Argument
argument_list|)
return|;
if|if
condition|(
name|load_flags
operator|&
name|FT_LOAD_NO_HINTING
condition|)
block|{
comment|/* both FT_LOAD_NO_HINTING and FT_LOAD_NO_AUTOHINT   */
comment|/* are necessary to disable hinting for tricky fonts */
if|if
condition|(
name|FT_IS_TRICKY
argument_list|(
name|face
argument_list|)
condition|)
name|load_flags
operator|&=
operator|~
name|FT_LOAD_NO_HINTING
expr_stmt|;
if|if
condition|(
name|load_flags
operator|&
name|FT_LOAD_NO_AUTOHINT
condition|)
name|load_flags
operator||=
name|FT_LOAD_NO_HINTING
expr_stmt|;
block|}
if|if
condition|(
name|load_flags
operator|&
operator|(
name|FT_LOAD_NO_RECURSE
operator||
name|FT_LOAD_NO_SCALE
operator|)
condition|)
block|{
name|load_flags
operator||=
name|FT_LOAD_NO_BITMAP
operator||
name|FT_LOAD_NO_SCALE
expr_stmt|;
if|if
condition|(
operator|!
name|FT_IS_TRICKY
argument_list|(
name|face
argument_list|)
condition|)
name|load_flags
operator||=
name|FT_LOAD_NO_HINTING
expr_stmt|;
block|}
comment|/* now load the glyph outline if necessary */
name|error
operator|=
name|TT_Load_Glyph
argument_list|(
name|size
argument_list|,
name|slot
argument_list|,
name|glyph_index
argument_list|,
name|load_flags
argument_list|)
expr_stmt|;
comment|/* force drop-out mode to 2 - irrelevant now */
comment|/* slot->outline.dropout_mode = 2; */
return|return
name|error
return|;
block|}
end_function
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/****                                                                 ****/
end_comment
begin_comment
comment|/****                                                                 ****/
end_comment
begin_comment
comment|/****                D R I V E R  I N T E R F A C E                   ****/
end_comment
begin_comment
comment|/****                                                                 ****/
end_comment
begin_comment
comment|/****                                                                 ****/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_comment
comment|/*************************************************************************/
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|TT_CONFIG_OPTION_GX_VAR_SUPPORT
end_ifdef
begin_macro
name|FT_DEFINE_SERVICE_MULTIMASTERSREC
argument_list|(
argument|tt_service_gx_multi_masters
argument_list|,
argument|(FT_Get_MM_Func)        NULL
argument_list|,
DECL|variable|NULL
argument|(FT_Set_MM_Design_Func) NULL
argument_list|,
DECL|variable|TT_Set_MM_Blend
argument|(FT_Set_MM_Blend_Func)  TT_Set_MM_Blend
argument_list|,
DECL|variable|TT_Get_MM_Var
argument|(FT_Get_MM_Var_Func)    TT_Get_MM_Var
argument_list|,
argument|(FT_Set_Var_Design_Func)TT_Set_Var_Design
argument_list|)
end_macro
begin_endif
endif|#
directive|endif
end_endif
begin_decl_stmt
DECL|variable|tt_service_truetype_engine
specifier|static
specifier|const
name|FT_Service_TrueTypeEngineRec
name|tt_service_truetype_engine
init|=
block|{
ifdef|#
directive|ifdef
name|TT_USE_BYTECODE_INTERPRETER
ifdef|#
directive|ifdef
name|TT_CONFIG_OPTION_UNPATENTED_HINTING
name|FT_TRUETYPE_ENGINE_TYPE_UNPATENTED
else|#
directive|else
name|FT_TRUETYPE_ENGINE_TYPE_PATENTED
endif|#
directive|endif
else|#
directive|else
comment|/* !TT_USE_BYTECODE_INTERPRETER */
name|FT_TRUETYPE_ENGINE_TYPE_NONE
endif|#
directive|endif
comment|/* TT_USE_BYTECODE_INTERPRETER */
block|}
decl_stmt|;
end_decl_stmt
begin_macro
name|FT_DEFINE_SERVICE_TTGLYFREC
argument_list|(
argument|tt_service_truetype_glyf
argument_list|,
argument|(TT_Glyf_GetLocationFunc)tt_face_get_location
argument_list|)
end_macro
begin_ifdef
ifdef|#
directive|ifdef
name|TT_CONFIG_OPTION_GX_VAR_SUPPORT
end_ifdef
begin_macro
name|FT_DEFINE_SERVICEDESCREC5
argument_list|(
argument|tt_services
argument_list|,
argument|FT_SERVICE_ID_FONT_FORMAT
argument_list|,
argument|FT_FONT_FORMAT_TRUETYPE
argument_list|,
argument|FT_SERVICE_ID_MULTI_MASTERS
argument_list|,
argument|&TT_SERVICE_GX_MULTI_MASTERS_GET
argument_list|,
argument|FT_SERVICE_ID_TRUETYPE_ENGINE
argument_list|,
argument|&tt_service_truetype_engine
argument_list|,
argument|FT_SERVICE_ID_TT_GLYF
argument_list|,
argument|&TT_SERVICE_TRUETYPE_GLYF_GET
argument_list|,
argument|FT_SERVICE_ID_PROPERTIES
argument_list|,
argument|&TT_SERVICE_PROPERTIES_GET
argument_list|)
end_macro
begin_else
else|#
directive|else
end_else
begin_macro
name|FT_DEFINE_SERVICEDESCREC4
argument_list|(
argument|tt_services
argument_list|,
argument|FT_SERVICE_ID_FONT_FORMAT
argument_list|,
argument|FT_FONT_FORMAT_TRUETYPE
argument_list|,
argument|FT_SERVICE_ID_TRUETYPE_ENGINE
argument_list|,
argument|&tt_service_truetype_engine
argument_list|,
argument|FT_SERVICE_ID_TT_GLYF
argument_list|,
argument|&TT_SERVICE_TRUETYPE_GLYF_GET
argument_list|,
argument|FT_SERVICE_ID_PROPERTIES
argument_list|,
argument|&TT_SERVICE_PROPERTIES_GET
argument_list|)
end_macro
begin_endif
endif|#
directive|endif
end_endif
begin_macro
DECL|function|FT_CALLBACK_DEF
name|FT_CALLBACK_DEF
argument_list|(
argument|FT_Module_Interface
argument_list|)
end_macro
begin_macro
name|tt_get_interface
argument_list|(
argument|FT_Module    driver
argument_list|,
comment|/* TT_Driver */
argument|const char*  tt_interface
argument_list|)
end_macro
begin_block
block|{
name|FT_Library
name|library
decl_stmt|;
name|FT_Module_Interface
name|result
decl_stmt|;
name|FT_Module
name|sfntd
decl_stmt|;
name|SFNT_Service
name|sfnt
decl_stmt|;
comment|/* TT_SERVICES_GET dereferences `library' in PIC mode */
ifdef|#
directive|ifdef
name|FT_CONFIG_OPTION_PIC
if|if
condition|(
operator|!
name|driver
condition|)
return|return
name|NULL
return|;
name|library
operator|=
name|driver
operator|->
name|library
expr_stmt|;
if|if
condition|(
operator|!
name|library
condition|)
return|return
name|NULL
return|;
endif|#
directive|endif
name|result
operator|=
name|ft_service_list_lookup
argument_list|(
name|TT_SERVICES_GET
argument_list|,
name|tt_interface
argument_list|)
expr_stmt|;
if|if
condition|(
name|result
operator|!=
name|NULL
condition|)
return|return
name|result
return|;
ifndef|#
directive|ifndef
name|FT_CONFIG_OPTION_PIC
if|if
condition|(
operator|!
name|driver
condition|)
return|return
name|NULL
return|;
name|library
operator|=
name|driver
operator|->
name|library
expr_stmt|;
if|if
condition|(
operator|!
name|library
condition|)
return|return
name|NULL
return|;
endif|#
directive|endif
comment|/* only return the default interface from the SFNT module */
name|sfntd
operator|=
name|FT_Get_Module
argument_list|(
name|library
argument_list|,
literal|"sfnt"
argument_list|)
expr_stmt|;
if|if
condition|(
name|sfntd
condition|)
block|{
name|sfnt
operator|=
call|(
name|SFNT_Service
call|)
argument_list|(
name|sfntd
operator|->
name|clazz
operator|->
name|module_interface
argument_list|)
expr_stmt|;
if|if
condition|(
name|sfnt
condition|)
return|return
name|sfnt
operator|->
name|get_interface
argument_list|(
name|driver
argument_list|,
name|tt_interface
argument_list|)
return|;
block|}
return|return
literal|0
return|;
block|}
end_block
begin_comment
comment|/* The FT_DriverInterface structure is defined in ftdriver.h. */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|TT_USE_BYTECODE_INTERPRETER
end_ifdef
begin_define
DECL|macro|TT_HINTER_FLAG
define|#
directive|define
name|TT_HINTER_FLAG
value|FT_MODULE_DRIVER_HAS_HINTER
end_define
begin_else
else|#
directive|else
end_else
begin_define
DECL|macro|TT_HINTER_FLAG
define|#
directive|define
name|TT_HINTER_FLAG
value|0
end_define
begin_endif
endif|#
directive|endif
end_endif
begin_ifdef
ifdef|#
directive|ifdef
name|TT_CONFIG_OPTION_EMBEDDED_BITMAPS
end_ifdef
begin_define
DECL|macro|TT_SIZE_SELECT
define|#
directive|define
name|TT_SIZE_SELECT
value|tt_size_select
end_define
begin_else
else|#
directive|else
end_else
begin_define
DECL|macro|TT_SIZE_SELECT
define|#
directive|define
name|TT_SIZE_SELECT
value|0
end_define
begin_endif
endif|#
directive|endif
end_endif
begin_macro
name|FT_DEFINE_DRIVER
argument_list|(
argument|tt_driver_class
argument_list|,
argument|FT_MODULE_FONT_DRIVER     |       FT_MODULE_DRIVER_SCALABLE |       TT_HINTER_FLAG
argument_list|,
argument|sizeof ( TT_DriverRec )
argument_list|,
literal|"truetype"
argument_list|,
comment|/* driver name                           */
literal|0x10000L
argument_list|,
comment|/* driver version == 1.0                 */
literal|0x20000L
argument_list|,
comment|/* driver requires FreeType 2.0 or above */
argument|(void*)
literal|0
argument_list|,
comment|/* driver specific interface */
argument|tt_driver_init
argument_list|,
argument|tt_driver_done
argument_list|,
argument|tt_get_interface
argument_list|,
argument|sizeof ( TT_FaceRec )
argument_list|,
argument|sizeof ( TT_SizeRec )
argument_list|,
argument|sizeof ( FT_GlyphSlotRec )
argument_list|,
argument|tt_face_init
argument_list|,
argument|tt_face_done
argument_list|,
argument|tt_size_init
argument_list|,
argument|tt_size_done
argument_list|,
argument|tt_slot_init
argument_list|,
literal|0
argument_list|,
comment|/* FT_Slot_DoneFunc */
argument|tt_glyph_load
argument_list|,
argument|tt_get_kerning
argument_list|,
literal|0
argument_list|,
comment|/* FT_Face_AttachFunc */
argument|tt_get_advances
argument_list|,
argument|tt_size_request
argument_list|,
argument|TT_SIZE_SELECT
argument_list|)
end_macro
begin_comment
comment|/* END */
end_comment
end_unit
