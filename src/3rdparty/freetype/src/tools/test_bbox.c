begin_unit
begin_include
include|#
directive|include
file|<ft2build.h>
end_include
begin_include
include|#
directive|include
include|FT_FREETYPE_H
end_include
begin_include
include|#
directive|include
include|FT_BBOX_H
end_include
begin_include
include|#
directive|include
file|<time.h>
end_include
begin_comment
comment|/* for clock() */
end_comment
begin_comment
comment|/* SunOS 4.1.* does not define CLOCKS_PER_SEC, so include<sys/param.h> */
end_comment
begin_comment
comment|/* to get the HZ macro which is the equivalent.                         */
end_comment
begin_if
if|#
directive|if
name|defined
argument_list|(
name|__sun__
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|SVR4
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|__SVR4
argument_list|)
end_if
begin_include
include|#
directive|include
file|<sys/param.h>
end_include
begin_define
DECL|macro|CLOCKS_PER_SEC
define|#
directive|define
name|CLOCKS_PER_SEC
value|HZ
end_define
begin_endif
endif|#
directive|endif
end_endif
begin_function
specifier|static
name|long
DECL|function|get_time
name|get_time
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|clock
argument_list|()
operator|*
literal|10000L
operator|/
name|CLOCKS_PER_SEC
return|;
block|}
end_function
begin_comment
comment|/* test bbox computations */
end_comment
begin_define
DECL|macro|XSCALE
define|#
directive|define
name|XSCALE
value|65536
end_define
begin_define
DECL|macro|XX
define|#
directive|define
name|XX
parameter_list|(
name|x
parameter_list|)
value|((FT_Pos)(x*XSCALE))
end_define
begin_define
DECL|macro|XVEC
define|#
directive|define
name|XVEC
parameter_list|(
name|x
parameter_list|,
name|y
parameter_list|)
value|{ XX(x), XX(y) }
end_define
begin_define
DECL|macro|XVAL
define|#
directive|define
name|XVAL
parameter_list|(
name|x
parameter_list|)
value|((x)/(1.0*XSCALE))
end_define
begin_comment
comment|/* dummy outline #1 */
end_comment
begin_decl_stmt
DECL|variable|dummy_vec_1
specifier|static
name|FT_Vector
name|dummy_vec_1
index|[
literal|4
index|]
init|=
block|{
if|#
directive|if
literal|1
name|XVEC
argument_list|(
literal|408.9111
argument_list|,
literal|535.3164
argument_list|)
block|,
name|XVEC
argument_list|(
literal|455.8887
argument_list|,
literal|634.396
argument_list|)
block|,
name|XVEC
argument_list|(
operator|-
literal|37.8765
argument_list|,
literal|786.2207
argument_list|)
block|,
name|XVEC
argument_list|(
literal|164.6074
argument_list|,
literal|535.3164
argument_list|)
else|#
directive|else
block|{
operator|(
name|FT_Int32
operator|)
literal|0x0198E93DL
block|,
operator|(
name|FT_Int32
operator|)
literal|0x021750FFL
block|}
block|,
comment|/* 408.9111, 535.3164 */
block|{
operator|(
name|FT_Int32
operator|)
literal|0x01C7E312L
block|,
operator|(
name|FT_Int32
operator|)
literal|0x027A6560L
block|}
block|,
comment|/* 455.8887, 634.3960 */
block|{
operator|(
name|FT_Int32
operator|)
literal|0xFFDA1F9EL
block|,
operator|(
name|FT_Int32
operator|)
literal|0x0312387FL
block|}
block|,
comment|/* -37.8765, 786.2207 */
block|{
operator|(
name|FT_Int32
operator|)
literal|0x00A49B7EL
block|,
operator|(
name|FT_Int32
operator|)
literal|0x021750FFL
block|}
comment|/* 164.6074, 535.3164 */
endif|#
directive|endif
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|variable|dummy_tag_1
specifier|static
name|char
name|dummy_tag_1
index|[
literal|4
index|]
init|=
block|{
name|FT_CURVE_TAG_ON
block|,
name|FT_CURVE_TAG_CUBIC
block|,
name|FT_CURVE_TAG_CUBIC
block|,
name|FT_CURVE_TAG_ON
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|variable|dummy_contour_1
specifier|static
name|short
name|dummy_contour_1
index|[
literal|1
index|]
init|=
block|{
literal|3
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|variable|dummy_outline_1
specifier|static
name|FT_Outline
name|dummy_outline_1
init|=
block|{
literal|1
block|,
literal|4
block|,
name|dummy_vec_1
block|,
name|dummy_tag_1
block|,
name|dummy_contour_1
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt
begin_comment
comment|/* dummy outline #2 */
end_comment
begin_decl_stmt
DECL|variable|dummy_vec_2
specifier|static
name|FT_Vector
name|dummy_vec_2
index|[
literal|4
index|]
init|=
block|{
name|XVEC
argument_list|(
literal|100.0
argument_list|,
literal|100.0
argument_list|)
block|,
name|XVEC
argument_list|(
literal|100.0
argument_list|,
literal|200.0
argument_list|)
block|,
name|XVEC
argument_list|(
literal|200.0
argument_list|,
literal|200.0
argument_list|)
block|,
name|XVEC
argument_list|(
literal|200.0
argument_list|,
literal|133.0
argument_list|)
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|variable|dummy_outline_2
specifier|static
name|FT_Outline
name|dummy_outline_2
init|=
block|{
literal|1
block|,
literal|4
block|,
name|dummy_vec_2
block|,
name|dummy_tag_1
block|,
name|dummy_contour_1
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt
begin_comment
comment|/* dummy outline #3 with bbox of [0 100 128 128] precisely */
end_comment
begin_decl_stmt
DECL|variable|dummy_vec_3
specifier|static
name|FT_Vector
name|dummy_vec_3
index|[
literal|4
index|]
init|=
block|{
name|XVEC
argument_list|(
literal|100.0
argument_list|,
literal|127.0
argument_list|)
block|,
name|XVEC
argument_list|(
literal|200.0
argument_list|,
literal|127.0
argument_list|)
block|,
name|XVEC
argument_list|(
literal|0.0
argument_list|,
literal|136.0
argument_list|)
block|,
name|XVEC
argument_list|(
literal|0.0
argument_list|,
literal|100.0
argument_list|)
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|variable|dummy_outline_3
specifier|static
name|FT_Outline
name|dummy_outline_3
init|=
block|{
literal|1
block|,
literal|4
block|,
name|dummy_vec_3
block|,
name|dummy_tag_1
block|,
name|dummy_contour_1
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt
begin_function
specifier|static
name|void
DECL|function|dump_outline
name|dump_outline
parameter_list|(
name|FT_Outline
modifier|*
name|outline
parameter_list|)
block|{
name|FT_BBox
name|bbox
decl_stmt|;
comment|/* compute and display cbox */
name|FT_Outline_Get_CBox
argument_list|(
name|outline
argument_list|,
operator|&
name|bbox
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"cbox = [%.2f %.2f %.2f %.2f]\n"
argument_list|,
name|XVAL
argument_list|(
name|bbox
operator|.
name|xMin
argument_list|)
argument_list|,
name|XVAL
argument_list|(
name|bbox
operator|.
name|yMin
argument_list|)
argument_list|,
name|XVAL
argument_list|(
name|bbox
operator|.
name|xMax
argument_list|)
argument_list|,
name|XVAL
argument_list|(
name|bbox
operator|.
name|yMax
argument_list|)
argument_list|)
expr_stmt|;
comment|/* compute and display bbox */
name|FT_Outline_Get_BBox
argument_list|(
name|outline
argument_list|,
operator|&
name|bbox
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"bbox = [%.2f %.2f %.2f %.2f]\n"
argument_list|,
name|XVAL
argument_list|(
name|bbox
operator|.
name|xMin
argument_list|)
argument_list|,
name|XVAL
argument_list|(
name|bbox
operator|.
name|yMin
argument_list|)
argument_list|,
name|XVAL
argument_list|(
name|bbox
operator|.
name|xMax
argument_list|)
argument_list|,
name|XVAL
argument_list|(
name|bbox
operator|.
name|yMax
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
specifier|static
name|void
DECL|function|profile_outline
name|profile_outline
parameter_list|(
name|FT_Outline
modifier|*
name|outline
parameter_list|,
name|long
name|repeat
parameter_list|)
block|{
name|FT_BBox
name|bbox
decl_stmt|;
name|long
name|count
decl_stmt|;
name|long
name|time0
decl_stmt|;
name|time0
operator|=
name|get_time
argument_list|()
expr_stmt|;
for|for
control|(
name|count
operator|=
name|repeat
init|;
name|count
operator|>
literal|0
condition|;
name|count
operator|--
control|)
name|FT_Outline_Get_CBox
argument_list|(
name|outline
argument_list|,
operator|&
name|bbox
argument_list|)
expr_stmt|;
name|time0
operator|=
name|get_time
argument_list|()
operator|-
name|time0
expr_stmt|;
name|printf
argument_list|(
literal|"time = %6.3f cbox = [%8.4f %8.4f %8.4f %8.4f]\n"
argument_list|,
operator|(
operator|(
name|double
operator|)
name|time0
operator|/
literal|10000.0
operator|)
argument_list|,
name|XVAL
argument_list|(
name|bbox
operator|.
name|xMin
argument_list|)
argument_list|,
name|XVAL
argument_list|(
name|bbox
operator|.
name|yMin
argument_list|)
argument_list|,
name|XVAL
argument_list|(
name|bbox
operator|.
name|xMax
argument_list|)
argument_list|,
name|XVAL
argument_list|(
name|bbox
operator|.
name|yMax
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"cbox_hex = [%08X %08X %08X %08X]\n"
argument_list|,
name|bbox
operator|.
name|xMin
argument_list|,
name|bbox
operator|.
name|yMin
argument_list|,
name|bbox
operator|.
name|xMax
argument_list|,
name|bbox
operator|.
name|yMax
argument_list|)
expr_stmt|;
name|time0
operator|=
name|get_time
argument_list|()
expr_stmt|;
for|for
control|(
name|count
operator|=
name|repeat
init|;
name|count
operator|>
literal|0
condition|;
name|count
operator|--
control|)
name|FT_Outline_Get_BBox
argument_list|(
name|outline
argument_list|,
operator|&
name|bbox
argument_list|)
expr_stmt|;
name|time0
operator|=
name|get_time
argument_list|()
operator|-
name|time0
expr_stmt|;
name|printf
argument_list|(
literal|"time = %6.3f bbox = [%8.4f %8.4f %8.4f %8.4f]\n"
argument_list|,
operator|(
operator|(
name|double
operator|)
name|time0
operator|/
literal|10000.0
operator|)
argument_list|,
name|XVAL
argument_list|(
name|bbox
operator|.
name|xMin
argument_list|)
argument_list|,
name|XVAL
argument_list|(
name|bbox
operator|.
name|yMin
argument_list|)
argument_list|,
name|XVAL
argument_list|(
name|bbox
operator|.
name|xMax
argument_list|)
argument_list|,
name|XVAL
argument_list|(
name|bbox
operator|.
name|yMax
argument_list|)
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"bbox_hex = [%08X %08X %08X %08X]\n"
argument_list|,
name|bbox
operator|.
name|xMin
argument_list|,
name|bbox
operator|.
name|yMin
argument_list|,
name|bbox
operator|.
name|xMax
argument_list|,
name|bbox
operator|.
name|yMax
argument_list|)
expr_stmt|;
block|}
end_function
begin_define
DECL|macro|REPEAT
define|#
directive|define
name|REPEAT
value|1000000L
end_define
begin_function
DECL|function|main
name|int
name|main
parameter_list|(
name|int
name|argc
parameter_list|,
name|char
modifier|*
modifier|*
name|argv
parameter_list|)
block|{
name|printf
argument_list|(
literal|"outline #1\n"
argument_list|)
expr_stmt|;
name|profile_outline
argument_list|(
operator|&
name|dummy_outline_1
argument_list|,
name|REPEAT
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"outline #2\n"
argument_list|)
expr_stmt|;
name|profile_outline
argument_list|(
operator|&
name|dummy_outline_2
argument_list|,
name|REPEAT
argument_list|)
expr_stmt|;
name|printf
argument_list|(
literal|"outline #3\n"
argument_list|)
expr_stmt|;
name|profile_outline
argument_list|(
operator|&
name|dummy_outline_3
argument_list|,
name|REPEAT
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
end_function
end_unit
