begin_unit
begin_include
include|#
directive|include
file|<ft2build.h>
end_include
begin_include
include|#
directive|include
include|FT_FREETYPE_H
end_include
begin_include
include|#
directive|include
include|FT_TRIGONOMETRY_H
end_include
begin_include
include|#
directive|include
file|<math.h>
end_include
begin_include
include|#
directive|include
file|<stdio.h>
end_include
begin_define
DECL|macro|PI
define|#
directive|define
name|PI
value|3.14159265358979323846
end_define
begin_define
DECL|macro|SPI
define|#
directive|define
name|SPI
value|(PI/FT_ANGLE_PI)
end_define
begin_comment
comment|/* the precision in 16.16 fixed-point checks. Expect between 2 and 5 */
end_comment
begin_comment
comment|/* noise LSB bits during operations, due to rounding errors..        */
end_comment
begin_define
DECL|macro|THRESHOLD
define|#
directive|define
name|THRESHOLD
value|64
end_define
begin_expr_stmt
DECL|variable|error
specifier|static
name|error
operator|=
literal|0
expr_stmt|;
end_expr_stmt
begin_function
specifier|static
name|void
DECL|function|test_cos
name|test_cos
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|FT_ANGLE_2PI
condition|;
name|i
operator|+=
literal|0x10000L
control|)
block|{
name|FT_Fixed
name|f1
decl_stmt|,
name|f2
decl_stmt|;
name|double
name|d2
decl_stmt|;
name|f1
operator|=
name|FT_Cos
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|d2
operator|=
name|cos
argument_list|(
name|i
operator|*
name|SPI
argument_list|)
expr_stmt|;
name|f2
operator|=
call|(
name|FT_Fixed
call|)
argument_list|(
name|d2
operator|*
literal|65536.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|abs
argument_list|(
name|f2
operator|-
name|f1
argument_list|)
operator|>
name|THRESHOLD
condition|)
block|{
name|error
operator|=
literal|1
expr_stmt|;
name|printf
argument_list|(
literal|"FT_Cos[%3d] = %.7f  cos[%3d] = %.7f\n"
argument_list|,
operator|(
name|i
operator|>>
literal|16
operator|)
argument_list|,
name|f1
operator|/
literal|65536.0
argument_list|,
operator|(
name|i
operator|>>
literal|16
operator|)
argument_list|,
name|d2
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function
specifier|static
name|void
DECL|function|test_sin
name|test_sin
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|FT_ANGLE_2PI
condition|;
name|i
operator|+=
literal|0x10000L
control|)
block|{
name|FT_Fixed
name|f1
decl_stmt|,
name|f2
decl_stmt|;
name|double
name|d2
decl_stmt|;
name|f1
operator|=
name|FT_Sin
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|d2
operator|=
name|sin
argument_list|(
name|i
operator|*
name|SPI
argument_list|)
expr_stmt|;
name|f2
operator|=
call|(
name|FT_Fixed
call|)
argument_list|(
name|d2
operator|*
literal|65536.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|abs
argument_list|(
name|f2
operator|-
name|f1
argument_list|)
operator|>
name|THRESHOLD
condition|)
block|{
name|error
operator|=
literal|1
expr_stmt|;
name|printf
argument_list|(
literal|"FT_Sin[%3d] = %.7f  sin[%3d] = %.7f\n"
argument_list|,
operator|(
name|i
operator|>>
literal|16
operator|)
argument_list|,
name|f1
operator|/
literal|65536.0
argument_list|,
operator|(
name|i
operator|>>
literal|16
operator|)
argument_list|,
name|d2
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function
specifier|static
name|void
DECL|function|test_tan
name|test_tan
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|FT_ANGLE_PI2
operator|-
literal|0x2000000L
condition|;
name|i
operator|+=
literal|0x10000L
control|)
block|{
name|FT_Fixed
name|f1
decl_stmt|,
name|f2
decl_stmt|;
name|double
name|d2
decl_stmt|;
name|f1
operator|=
name|FT_Tan
argument_list|(
name|i
argument_list|)
expr_stmt|;
name|d2
operator|=
name|tan
argument_list|(
name|i
operator|*
name|SPI
argument_list|)
expr_stmt|;
name|f2
operator|=
call|(
name|FT_Fixed
call|)
argument_list|(
name|d2
operator|*
literal|65536.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|abs
argument_list|(
name|f2
operator|-
name|f1
argument_list|)
operator|>
name|THRESHOLD
condition|)
block|{
name|error
operator|=
literal|1
expr_stmt|;
name|printf
argument_list|(
literal|"FT_Tan[%3d] = %.7f  tan[%3d] = %.7f\n"
argument_list|,
operator|(
name|i
operator|>>
literal|16
operator|)
argument_list|,
name|f1
operator|/
literal|65536.0
argument_list|,
operator|(
name|i
operator|>>
literal|16
operator|)
argument_list|,
name|d2
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function
specifier|static
name|void
DECL|function|test_atan2
name|test_atan2
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|FT_ANGLE_2PI
condition|;
name|i
operator|+=
literal|0x10000L
control|)
block|{
name|FT_Fixed
name|c2
decl_stmt|,
name|s2
decl_stmt|;
name|double
name|l
decl_stmt|,
name|a
decl_stmt|,
name|c1
decl_stmt|,
name|s1
decl_stmt|;
name|int
name|j
decl_stmt|;
name|l
operator|=
literal|5.0
expr_stmt|;
name|a
operator|=
name|i
operator|*
name|SPI
expr_stmt|;
name|c1
operator|=
name|l
operator|*
name|cos
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|s1
operator|=
name|l
operator|*
name|sin
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|c2
operator|=
call|(
name|FT_Fixed
call|)
argument_list|(
name|c1
operator|*
literal|65536.0
argument_list|)
expr_stmt|;
name|s2
operator|=
call|(
name|FT_Fixed
call|)
argument_list|(
name|s1
operator|*
literal|65536.0
argument_list|)
expr_stmt|;
name|j
operator|=
name|FT_Atan2
argument_list|(
name|c2
argument_list|,
name|s2
argument_list|)
expr_stmt|;
if|if
condition|(
name|j
operator|<
literal|0
condition|)
name|j
operator|+=
name|FT_ANGLE_2PI
expr_stmt|;
if|if
condition|(
name|abs
argument_list|(
name|i
operator|-
name|j
argument_list|)
operator|>
literal|1
condition|)
block|{
name|printf
argument_list|(
literal|"FT_Atan2( %.7f, %.7f ) = %.5f, atan = %.5f\n"
argument_list|,
name|c2
operator|/
literal|65536.0
argument_list|,
name|s2
operator|/
literal|65536.0
argument_list|,
name|j
operator|/
literal|65536.0
argument_list|,
name|i
operator|/
literal|65536.0
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function
specifier|static
name|void
DECL|function|test_unit
name|test_unit
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|FT_ANGLE_2PI
condition|;
name|i
operator|+=
literal|0x10000L
control|)
block|{
name|FT_Vector
name|v
decl_stmt|;
name|double
name|a
decl_stmt|,
name|c1
decl_stmt|,
name|s1
decl_stmt|;
name|FT_Fixed
name|c2
decl_stmt|,
name|s2
decl_stmt|;
name|FT_Vector_Unit
argument_list|(
operator|&
name|v
argument_list|,
name|i
argument_list|)
expr_stmt|;
name|a
operator|=
operator|(
name|i
operator|*
name|SPI
operator|)
expr_stmt|;
name|c1
operator|=
name|cos
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|s1
operator|=
name|sin
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|c2
operator|=
call|(
name|FT_Fixed
call|)
argument_list|(
name|c1
operator|*
literal|65536.0
argument_list|)
expr_stmt|;
name|s2
operator|=
call|(
name|FT_Fixed
call|)
argument_list|(
name|s1
operator|*
literal|65536.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|abs
argument_list|(
name|v
operator|.
name|x
operator|-
name|c2
argument_list|)
operator|>
name|THRESHOLD
operator|||
name|abs
argument_list|(
name|v
operator|.
name|y
operator|-
name|s2
argument_list|)
operator|>
name|THRESHOLD
condition|)
block|{
name|error
operator|=
literal|1
expr_stmt|;
name|printf
argument_list|(
literal|"FT_Vector_Unit[%3d] = ( %.7f, %.7f )  vec = ( %.7f, %.7f )\n"
argument_list|,
operator|(
name|i
operator|>>
literal|16
operator|)
argument_list|,
name|v
operator|.
name|x
operator|/
literal|65536.0
argument_list|,
name|v
operator|.
name|y
operator|/
literal|65536.0
argument_list|,
name|c1
argument_list|,
name|s1
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function
specifier|static
name|void
DECL|function|test_length
name|test_length
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|FT_ANGLE_2PI
condition|;
name|i
operator|+=
literal|0x10000L
control|)
block|{
name|FT_Vector
name|v
decl_stmt|;
name|FT_Fixed
name|l
decl_stmt|,
name|l2
decl_stmt|;
name|l
operator|=
call|(
name|FT_Fixed
call|)
argument_list|(
literal|500.0
operator|*
literal|65536.0
argument_list|)
expr_stmt|;
name|v
operator|.
name|x
operator|=
call|(
name|FT_Fixed
call|)
argument_list|(
name|l
operator|*
name|cos
argument_list|(
name|i
operator|*
name|SPI
argument_list|)
argument_list|)
expr_stmt|;
name|v
operator|.
name|y
operator|=
call|(
name|FT_Fixed
call|)
argument_list|(
name|l
operator|*
name|sin
argument_list|(
name|i
operator|*
name|SPI
argument_list|)
argument_list|)
expr_stmt|;
name|l2
operator|=
name|FT_Vector_Length
argument_list|(
operator|&
name|v
argument_list|)
expr_stmt|;
if|if
condition|(
name|abs
argument_list|(
name|l2
operator|-
name|l
argument_list|)
operator|>
name|THRESHOLD
condition|)
block|{
name|error
operator|=
literal|1
expr_stmt|;
name|printf
argument_list|(
literal|"FT_Length( %.7f, %.7f ) = %.5f, length = %.5f\n"
argument_list|,
name|v
operator|.
name|x
operator|/
literal|65536.0
argument_list|,
name|v
operator|.
name|y
operator|/
literal|65536.0
argument_list|,
name|l2
operator|/
literal|65536.0
argument_list|,
name|l
operator|/
literal|65536.0
argument_list|)
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function
specifier|static
name|void
DECL|function|test_rotate
name|test_rotate
parameter_list|(
name|void
parameter_list|)
block|{
name|int
name|rotate
decl_stmt|;
for|for
control|(
name|rotate
operator|=
literal|0
init|;
name|rotate
operator|<
name|FT_ANGLE_2PI
condition|;
name|rotate
operator|+=
literal|0x10000L
control|)
block|{
name|double
name|ra
decl_stmt|,
name|cra
decl_stmt|,
name|sra
decl_stmt|;
name|int
name|i
decl_stmt|;
name|ra
operator|=
name|rotate
operator|*
name|SPI
expr_stmt|;
name|cra
operator|=
name|cos
argument_list|(
name|ra
argument_list|)
expr_stmt|;
name|sra
operator|=
name|sin
argument_list|(
name|ra
argument_list|)
expr_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|FT_ANGLE_2PI
condition|;
name|i
operator|+=
literal|0x10000L
control|)
block|{
name|FT_Fixed
name|c2
decl_stmt|,
name|s2
decl_stmt|,
name|c4
decl_stmt|,
name|s4
decl_stmt|;
name|FT_Vector
name|v
decl_stmt|;
name|double
name|l
decl_stmt|,
name|a
decl_stmt|,
name|c1
decl_stmt|,
name|s1
decl_stmt|,
name|c3
decl_stmt|,
name|s3
decl_stmt|;
name|l
operator|=
literal|500.0
expr_stmt|;
name|a
operator|=
name|i
operator|*
name|SPI
expr_stmt|;
name|c1
operator|=
name|l
operator|*
name|cos
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|s1
operator|=
name|l
operator|*
name|sin
argument_list|(
name|a
argument_list|)
expr_stmt|;
name|v
operator|.
name|x
operator|=
name|c2
operator|=
call|(
name|FT_Fixed
call|)
argument_list|(
name|c1
operator|*
literal|65536.0
argument_list|)
expr_stmt|;
name|v
operator|.
name|y
operator|=
name|s2
operator|=
call|(
name|FT_Fixed
call|)
argument_list|(
name|s1
operator|*
literal|65536.0
argument_list|)
expr_stmt|;
name|FT_Vector_Rotate
argument_list|(
operator|&
name|v
argument_list|,
name|rotate
argument_list|)
expr_stmt|;
name|c3
operator|=
name|c1
operator|*
name|cra
operator|-
name|s1
operator|*
name|sra
expr_stmt|;
name|s3
operator|=
name|c1
operator|*
name|sra
operator|+
name|s1
operator|*
name|cra
expr_stmt|;
name|c4
operator|=
call|(
name|FT_Fixed
call|)
argument_list|(
name|c3
operator|*
literal|65536.0
argument_list|)
expr_stmt|;
name|s4
operator|=
call|(
name|FT_Fixed
call|)
argument_list|(
name|s3
operator|*
literal|65536.0
argument_list|)
expr_stmt|;
if|if
condition|(
name|abs
argument_list|(
name|c4
operator|-
name|v
operator|.
name|x
argument_list|)
operator|>
name|THRESHOLD
operator|||
name|abs
argument_list|(
name|s4
operator|-
name|v
operator|.
name|y
argument_list|)
operator|>
name|THRESHOLD
condition|)
block|{
name|error
operator|=
literal|1
expr_stmt|;
name|printf
argument_list|(
literal|"FT_Rotate( (%.7f,%.7f), %.5f ) = ( %.7f, %.7f ), rot = ( %.7f, %.7f )\n"
argument_list|,
name|c1
argument_list|,
name|s1
argument_list|,
name|ra
argument_list|,
name|c2
operator|/
literal|65536.0
argument_list|,
name|s2
operator|/
literal|65536.0
argument_list|,
name|c4
operator|/
literal|65536.0
argument_list|,
name|s4
operator|/
literal|65536.0
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
end_function
begin_function
DECL|function|main
name|int
name|main
parameter_list|(
name|void
parameter_list|)
block|{
name|test_cos
argument_list|()
expr_stmt|;
name|test_sin
argument_list|()
expr_stmt|;
name|test_tan
argument_list|()
expr_stmt|;
name|test_atan2
argument_list|()
expr_stmt|;
name|test_unit
argument_list|()
expr_stmt|;
name|test_length
argument_list|()
expr_stmt|;
name|test_rotate
argument_list|()
expr_stmt|;
if|if
condition|(
operator|!
name|error
condition|)
name|printf
argument_list|(
literal|"trigonometry test ok !\n"
argument_list|)
expr_stmt|;
return|return
operator|!
name|error
return|;
block|}
end_function
end_unit
