begin_unit
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *             For conditions of distribution and use,                    * */
end_comment
begin_comment
comment|/* *                see copyright notice in libmng.h                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * project   : libmng                                                     * */
end_comment
begin_comment
comment|/* * file      : libmng_zlib.c             copyright (c) 2000-2004 G.Juyn   * */
end_comment
begin_comment
comment|/* * version   : 1.0.9                                                      * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * purpose   : ZLIB library interface (implementation)                    * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * author    : G.Juyn                                                     * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * comment   : implementation of the ZLIB library interface               * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * changes   : 0.5.1 - 05/08/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed strict-ANSI stuff                                * */
end_comment
begin_comment
comment|/* *             0.5.1 - 05/11/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - filled the deflatedata routine                           * */
end_comment
begin_comment
comment|/* *             0.5.1 - 05/12/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed trace to macro for callback error-reporting      * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.5.2 - 05/20/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed for JNG alpha handling                             * */
end_comment
begin_comment
comment|/* *             0.5.2 - 05/24/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - moved init of default zlib parms from here to            * */
end_comment
begin_comment
comment|/* *               "mng_hlapi.c"                                            * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.5.3 - 06/16/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed progressive-display processing                   * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.2 - 08/05/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed file-prefixes                                    * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.3 - 08/08/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed compiler-warnings from Mozilla                     * */
end_comment
begin_comment
comment|/* *             0.9.3 - 09/07/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added support for new filter_types                       * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.5 - 08/07/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added test-option for PNG filter method 193 (=no filter) * */
end_comment
begin_comment
comment|/* *             1.0.5 - 08/19/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - B597134 - libmng pollutes the linker namespace           * */
end_comment
begin_comment
comment|/* *             1.0.5 - 09/19/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added warning for too much IDAT data                     * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.6 - 07/07/2003 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added MNG_NO_16BIT_SUPPORT support                       * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.9 - 10/09/2004 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added MNG_NO_1_2_4BIT_SUPPORT support                    * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_include
include|#
directive|include
file|"libmng.h"
end_include
begin_include
include|#
directive|include
file|"libmng_data.h"
end_include
begin_include
include|#
directive|include
file|"libmng_error.h"
end_include
begin_include
include|#
directive|include
file|"libmng_trace.h"
end_include
begin_ifdef
ifdef|#
directive|ifdef
name|__BORLANDC__
end_ifdef
begin_pragma
pragma|#
directive|pragma
name|hdrstop
end_pragma
begin_endif
endif|#
directive|endif
end_endif
begin_include
include|#
directive|include
file|"libmng_memory.h"
end_include
begin_include
include|#
directive|include
file|"libmng_pixels.h"
end_include
begin_include
include|#
directive|include
file|"libmng_filter.h"
end_include
begin_include
include|#
directive|include
file|"libmng_zlib.h"
end_include
begin_if
if|#
directive|if
name|defined
argument_list|(
name|__BORLANDC__
argument_list|)
operator|&&
name|defined
argument_list|(
name|MNG_STRICT_ANSI
argument_list|)
end_if
begin_pragma
pragma|#
directive|pragma
name|option
name|-
name|A
end_pragma
begin_comment
comment|/* force ANSI-C */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_ZLIB
end_ifdef
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mngzlib_alloc
name|voidpf
name|mngzlib_alloc
parameter_list|(
name|voidpf
name|pData
parameter_list|,
name|uInt
name|iCount
parameter_list|,
name|uInt
name|iSize
parameter_list|)
block|{
name|voidpf
name|pPtr
decl_stmt|;
comment|/* temporary space */
ifdef|#
directive|ifdef
name|MNG_INTERNAL_MEMMNGMT
name|pPtr
operator|=
name|calloc
argument_list|(
name|iCount
argument_list|,
name|iSize
argument_list|)
expr_stmt|;
comment|/* local allocation */
else|#
directive|else
if|if
condition|(
operator|(
operator|(
name|mng_datap
operator|)
name|pData
operator|)
operator|->
name|fMemalloc
condition|)
comment|/* callback function set ? */
name|pPtr
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|pData
operator|)
operator|->
name|fMemalloc
argument_list|(
name|iCount
operator|*
name|iSize
argument_list|)
expr_stmt|;
else|else
name|pPtr
operator|=
name|Z_NULL
expr_stmt|;
comment|/* can't allocate! */
endif|#
directive|endif
return|return
name|pPtr
return|;
comment|/* return the result */
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mngzlib_free
name|void
name|mngzlib_free
parameter_list|(
name|voidpf
name|pData
parameter_list|,
name|voidpf
name|pAddress
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_INTERNAL_MEMMNGMT
name|free
argument_list|(
name|pAddress
argument_list|)
expr_stmt|;
comment|/* free locally */
else|#
directive|else
if|if
condition|(
operator|(
operator|(
name|mng_datap
operator|)
name|pData
operator|)
operator|->
name|fMemfree
condition|)
comment|/* callback set? */
operator|(
operator|(
name|mng_datap
operator|)
name|pData
operator|)
operator|->
name|fMemfree
argument_list|(
name|pAddress
argument_list|,
literal|1
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mngzlib_initialize
name|mng_retcode
name|mngzlib_initialize
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_INITIALIZE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_INTERNAL_MEMMNGMT
name|pData
operator|->
name|sZlib
operator|.
name|zalloc
operator|=
name|Z_NULL
expr_stmt|;
comment|/* let zlib figure out memory management */
name|pData
operator|->
name|sZlib
operator|.
name|zfree
operator|=
name|Z_NULL
expr_stmt|;
name|pData
operator|->
name|sZlib
operator|.
name|opaque
operator|=
name|Z_NULL
expr_stmt|;
else|#
directive|else
comment|/* use user-provided callbacks */
name|pData
operator|->
name|sZlib
operator|.
name|zalloc
operator|=
name|mngzlib_alloc
expr_stmt|;
name|pData
operator|->
name|sZlib
operator|.
name|zfree
operator|=
name|mngzlib_free
expr_stmt|;
name|pData
operator|->
name|sZlib
operator|.
name|opaque
operator|=
operator|(
name|voidpf
operator|)
name|pData
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|bInflating
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* not performing any action yet */
name|pData
operator|->
name|bDeflating
operator|=
name|MNG_FALSE
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_INITIALIZE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
comment|/* done */
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mngzlib_cleanup
name|mng_retcode
name|mngzlib_cleanup
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_CLEANUP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bInflating
condition|)
comment|/* force zlib cleanup */
name|mngzlib_inflatefree
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bDeflating
condition|)
name|mngzlib_deflatefree
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_CLEANUP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
comment|/* done */
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mngzlib_inflateinit
name|mng_retcode
name|mngzlib_inflateinit
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|int
name|iZrslt
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_INFLATEINIT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* initialize zlib structures and such */
name|iZrslt
operator|=
name|inflateInit
argument_list|(
operator|&
name|pData
operator|->
name|sZlib
argument_list|)
expr_stmt|;
if|if
condition|(
name|iZrslt
operator|!=
name|Z_OK
condition|)
comment|/* on error bail out */
name|MNG_ERRORZ
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_uint32
operator|)
name|iZrslt
argument_list|)
expr_stmt|;
name|pData
operator|->
name|bInflating
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* really inflating something now */
name|pData
operator|->
name|sZlib
operator|.
name|next_out
operator|=
literal|0
expr_stmt|;
comment|/* force JIT initialization */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_INFLATEINIT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
comment|/* done */
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
end_ifdef
begin_function
DECL|function|mngzlib_inflaterows
name|mng_retcode
name|mngzlib_inflaterows
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint32
name|iInlen
parameter_list|,
name|mng_uint8p
name|pIndata
parameter_list|)
block|{
name|int
name|iZrslt
decl_stmt|;
name|mng_retcode
name|iRslt
decl_stmt|;
name|mng_ptr
name|pSwap
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_INFLATEROWS
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|sZlib
operator|.
name|next_in
operator|=
name|pIndata
expr_stmt|;
comment|/* let zlib know where to get stuff */
name|pData
operator|->
name|sZlib
operator|.
name|avail_in
operator|=
operator|(
name|uInt
operator|)
name|iInlen
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|sZlib
operator|.
name|next_out
operator|==
literal|0
condition|)
comment|/* initialize output variables ? */
block|{
comment|/* let zlib know where to store stuff */
name|pData
operator|->
name|sZlib
operator|.
name|next_out
operator|=
name|pData
operator|->
name|pWorkrow
expr_stmt|;
name|pData
operator|->
name|sZlib
operator|.
name|avail_out
operator|=
call|(
name|uInt
call|)
argument_list|(
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_NO_1_2_4BIT_SUPPORT
if|if
condition|(
name|pData
operator|->
name|iPNGdepth
operator|<
literal|8
condition|)
name|pData
operator|->
name|sZlib
operator|.
name|avail_out
operator|=
call|(
name|uInt
call|)
argument_list|(
operator|(
name|pData
operator|->
name|iPNGdepth
operator|*
name|pData
operator|->
name|iRowsize
operator|+
literal|7
operator|)
operator|/
literal|8
operator|+
name|pData
operator|->
name|iPixelofs
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|pData
operator|->
name|iPNGdepth
operator|>
literal|8
condition|)
name|pData
operator|->
name|sZlib
operator|.
name|avail_out
operator|=
call|(
name|uInt
call|)
argument_list|(
literal|2
operator|*
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
do|do
block|{
comment|/* now inflate a row */
name|iZrslt
operator|=
name|inflate
argument_list|(
operator|&
name|pData
operator|->
name|sZlib
argument_list|,
name|Z_SYNC_FLUSH
argument_list|)
expr_stmt|;
comment|/* produced a full row ? */
if|if
condition|(
operator|(
operator|(
name|iZrslt
operator|==
name|Z_OK
operator|)
operator|||
operator|(
name|iZrslt
operator|==
name|Z_STREAM_END
operator|)
operator|)
operator|&&
operator|(
name|pData
operator|->
name|sZlib
operator|.
name|avail_out
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* image not completed yet ? */
if|if
condition|(
name|pData
operator|->
name|iRow
operator|<
operator|(
name|mng_int32
operator|)
name|pData
operator|->
name|iDataheight
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_NO_1_2_4BIT_SUPPORT
if|if
condition|(
name|pData
operator|->
name|iPNGdepth
operator|==
literal|1
condition|)
block|{
comment|/* Inflate Workrow to 8-bit */
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8p
name|pSrc
init|=
name|pData
operator|->
name|pWorkrow
operator|+
literal|1
decl_stmt|;
name|mng_uint8p
name|pDest
init|=
name|pSrc
operator|+
name|pData
operator|->
name|iRowsize
operator|-
operator|(
name|pData
operator|->
name|iRowsize
operator|+
literal|7
operator|)
operator|/
literal|8
decl_stmt|;
for|for
control|(
name|iX
operator|=
operator|(
operator|(
name|pData
operator|->
name|iRowsize
operator|+
literal|7
operator|)
operator|/
literal|8
operator|)
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
operator|*
name|pDest
operator|++
operator|=
operator|*
name|pSrc
operator|++
expr_stmt|;
name|pDest
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
literal|1
expr_stmt|;
name|pSrc
operator|=
name|pDest
operator|+
name|pData
operator|->
name|iRowsize
operator|-
operator|(
name|pData
operator|->
name|iRowsize
operator|+
literal|7
operator|)
operator|/
literal|8
expr_stmt|;
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsize
init|;
condition|;
control|)
block|{
operator|*
name|pDest
operator|++
operator|=
operator|(
operator|(
operator|(
operator|*
name|pSrc
operator|)
operator|>>
literal|7
operator|)
operator|&
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|iX
operator|--
operator|<=
literal|0
condition|)
break|break;
operator|*
name|pDest
operator|++
operator|=
operator|(
operator|(
operator|(
operator|*
name|pSrc
operator|)
operator|>>
literal|6
operator|)
operator|&
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|iX
operator|--
operator|<=
literal|0
condition|)
break|break;
operator|*
name|pDest
operator|++
operator|=
operator|(
operator|(
operator|(
operator|*
name|pSrc
operator|)
operator|>>
literal|5
operator|)
operator|&
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|iX
operator|--
operator|<=
literal|0
condition|)
break|break;
operator|*
name|pDest
operator|++
operator|=
operator|(
operator|(
operator|(
operator|*
name|pSrc
operator|)
operator|>>
literal|4
operator|)
operator|&
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|iX
operator|--
operator|<=
literal|0
condition|)
break|break;
operator|*
name|pDest
operator|++
operator|=
operator|(
operator|(
operator|(
operator|*
name|pSrc
operator|)
operator|>>
literal|3
operator|)
operator|&
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|iX
operator|--
operator|<=
literal|0
condition|)
break|break;
operator|*
name|pDest
operator|++
operator|=
operator|(
operator|(
operator|(
operator|*
name|pSrc
operator|)
operator|>>
literal|2
operator|)
operator|&
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|iX
operator|--
operator|<=
literal|0
condition|)
break|break;
operator|*
name|pDest
operator|++
operator|=
operator|(
operator|(
operator|(
operator|*
name|pSrc
operator|)
operator|>>
literal|1
operator|)
operator|&
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|iX
operator|--
operator|<=
literal|0
condition|)
break|break;
operator|*
name|pDest
operator|++
operator|=
operator|(
operator|(
operator|(
operator|*
name|pSrc
operator|)
operator|)
operator|&
literal|1
operator|)
expr_stmt|;
if|if
condition|(
name|iX
operator|--
operator|<=
literal|0
condition|)
break|break;
name|pSrc
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iPNGdepth
operator|==
literal|2
condition|)
block|{
comment|/* Inflate Workrow to 8-bit */
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8p
name|pSrc
init|=
name|pData
operator|->
name|pWorkrow
operator|+
literal|1
decl_stmt|;
name|mng_uint8p
name|pDest
init|=
name|pSrc
operator|+
name|pData
operator|->
name|iRowsize
operator|-
operator|(
literal|2
operator|*
name|pData
operator|->
name|iRowsize
operator|+
literal|7
operator|)
operator|/
literal|8
decl_stmt|;
for|for
control|(
name|iX
operator|=
operator|(
operator|(
literal|2
operator|*
name|pData
operator|->
name|iRowsize
operator|+
literal|7
operator|)
operator|/
literal|8
operator|)
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
operator|*
name|pDest
operator|++
operator|=
operator|*
name|pSrc
operator|++
expr_stmt|;
name|pDest
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
literal|1
expr_stmt|;
name|pSrc
operator|=
name|pDest
operator|+
name|pData
operator|->
name|iRowsize
operator|-
operator|(
literal|2
operator|*
name|pData
operator|->
name|iRowsize
operator|+
literal|7
operator|)
operator|/
literal|8
expr_stmt|;
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsize
init|;
condition|;
control|)
block|{
operator|*
name|pDest
operator|++
operator|=
operator|(
operator|(
operator|(
operator|*
name|pSrc
operator|)
operator|>>
literal|6
operator|)
operator|&
literal|3
operator|)
expr_stmt|;
if|if
condition|(
name|iX
operator|--
operator|<=
literal|0
condition|)
break|break;
operator|*
name|pDest
operator|++
operator|=
operator|(
operator|(
operator|(
operator|*
name|pSrc
operator|)
operator|>>
literal|4
operator|)
operator|&
literal|3
operator|)
expr_stmt|;
if|if
condition|(
name|iX
operator|--
operator|<=
literal|0
condition|)
break|break;
operator|*
name|pDest
operator|++
operator|=
operator|(
operator|(
operator|(
operator|*
name|pSrc
operator|)
operator|>>
literal|2
operator|)
operator|&
literal|3
operator|)
expr_stmt|;
if|if
condition|(
name|iX
operator|--
operator|<=
literal|0
condition|)
break|break;
operator|*
name|pDest
operator|++
operator|=
operator|(
operator|(
operator|(
operator|*
name|pSrc
operator|)
operator|)
operator|&
literal|3
operator|)
expr_stmt|;
if|if
condition|(
name|iX
operator|--
operator|<=
literal|0
condition|)
break|break;
name|pSrc
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iPNGdepth
operator|==
literal|4
condition|)
block|{
comment|/* Inflate Workrow to 8-bit */
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8p
name|pSrc
init|=
name|pData
operator|->
name|pWorkrow
operator|+
literal|1
decl_stmt|;
name|mng_uint8p
name|pDest
init|=
name|pSrc
operator|+
name|pData
operator|->
name|iRowsize
operator|-
operator|(
literal|4
operator|*
name|pData
operator|->
name|iRowsize
operator|+
literal|7
operator|)
operator|/
literal|8
decl_stmt|;
for|for
control|(
name|iX
operator|=
operator|(
operator|(
literal|4
operator|*
name|pData
operator|->
name|iRowsize
operator|+
literal|7
operator|)
operator|/
literal|8
operator|)
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
operator|*
name|pDest
operator|++
operator|=
operator|*
name|pSrc
operator|++
expr_stmt|;
name|pDest
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
literal|1
expr_stmt|;
name|pSrc
operator|=
name|pDest
operator|+
name|pData
operator|->
name|iRowsize
operator|-
operator|(
literal|4
operator|*
name|pData
operator|->
name|iRowsize
operator|+
literal|7
operator|)
operator|/
literal|8
expr_stmt|;
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsize
init|;
condition|;
control|)
block|{
operator|*
name|pDest
operator|++
operator|=
operator|(
operator|(
operator|(
operator|*
name|pSrc
operator|)
operator|>>
literal|4
operator|)
operator|&
literal|0x0f
operator|)
expr_stmt|;
if|if
condition|(
name|iX
operator|--
operator|<=
literal|0
condition|)
break|break;
operator|*
name|pDest
operator|++
operator|=
operator|(
operator|(
operator|(
operator|*
name|pSrc
operator|)
operator|)
operator|&
literal|0x0f
operator|)
expr_stmt|;
if|if
condition|(
name|iX
operator|--
operator|<=
literal|0
condition|)
break|break;
name|pSrc
operator|++
expr_stmt|;
block|}
block|}
if|if
condition|(
name|pData
operator|->
name|iPNGdepth
operator|<
literal|8
operator|&&
name|pData
operator|->
name|iColortype
operator|==
literal|0
condition|)
block|{
comment|/* Expand samples to 8-bit by LBR */
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8p
name|pSrc
init|=
name|pData
operator|->
name|pWorkrow
operator|+
literal|1
decl_stmt|;
name|mng_uint8
name|multiplier
index|[]
init|=
block|{
literal|0
block|,
literal|255
block|,
literal|85
block|,
literal|0
block|,
literal|17
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|1
block|}
decl_stmt|;
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsize
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
operator|*
name|pSrc
operator|++
operator|*=
name|multiplier
index|[
name|pData
operator|->
name|iPNGdepth
index|]
expr_stmt|;
block|}
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|pData
operator|->
name|iPNGdepth
operator|>
literal|8
condition|)
block|{
comment|/* Reduce Workrow to 8-bit */
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8p
name|pSrc
init|=
name|pData
operator|->
name|pWorkrow
operator|+
literal|1
decl_stmt|;
name|mng_uint8p
name|pDest
init|=
name|pSrc
decl_stmt|;
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsize
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
block|{
operator|*
name|pDest
operator|=
operator|*
name|pSrc
expr_stmt|;
name|pDest
operator|++
expr_stmt|;
name|pSrc
operator|+=
literal|2
expr_stmt|;
block|}
block|}
endif|#
directive|endif
ifdef|#
directive|ifdef
name|FILTER192
comment|/* has leveling info ? */
if|if
condition|(
name|pData
operator|->
name|iFilterofs
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|iRslt
operator|=
name|init_rowdiffering
argument_list|(
name|pData
argument_list|)
expr_stmt|;
else|else
endif|#
directive|endif
name|iRslt
operator|=
name|MNG_NOERROR
expr_stmt|;
comment|/* filter the row if necessary */
if|if
condition|(
operator|(
operator|!
name|iRslt
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iFilterofs
operator|<
name|pData
operator|->
name|iPixelofs
operator|)
operator|&&
operator|(
operator|*
operator|(
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iFilterofs
operator|)
operator|)
condition|)
name|iRslt
operator|=
name|mng_filter_a_row
argument_list|(
name|pData
argument_list|)
expr_stmt|;
else|else
name|iRslt
operator|=
name|MNG_NOERROR
expr_stmt|;
comment|/* additional leveling/differing ? */
if|if
condition|(
operator|(
operator|!
name|iRslt
operator|)
operator|&&
operator|(
name|pData
operator|->
name|fDifferrow
operator|)
condition|)
block|{
name|iRslt
operator|=
operator|(
operator|(
name|mng_differrow
operator|)
name|pData
operator|->
name|fDifferrow
operator|)
operator|(
name|pData
operator|)
expr_stmt|;
name|pSwap
operator|=
name|pData
operator|->
name|pWorkrow
expr_stmt|;
name|pData
operator|->
name|pWorkrow
operator|=
name|pData
operator|->
name|pPrevrow
expr_stmt|;
name|pData
operator|->
name|pPrevrow
operator|=
name|pSwap
expr_stmt|;
comment|/* make sure we're processing the right data */
block|}
if|if
condition|(
operator|!
name|iRslt
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
if|if
condition|(
name|pData
operator|->
name|bHasJHDR
condition|)
comment|/* is JNG alpha-channel ? */
block|{
comment|/* just store in object ? */
if|if
condition|(
operator|(
operator|!
name|iRslt
operator|)
operator|&&
operator|(
name|pData
operator|->
name|fStorerow
operator|)
condition|)
name|iRslt
operator|=
operator|(
operator|(
name|mng_storerow
operator|)
name|pData
operator|->
name|fStorerow
operator|)
operator|(
name|pData
operator|)
expr_stmt|;
block|}
else|else
endif|#
directive|endif
comment|/* MNG_INCLUDE_JNG */
block|{
comment|/* process this row */
if|if
condition|(
operator|(
operator|!
name|iRslt
operator|)
operator|&&
operator|(
name|pData
operator|->
name|fProcessrow
operator|)
condition|)
name|iRslt
operator|=
operator|(
operator|(
name|mng_processrow
operator|)
name|pData
operator|->
name|fProcessrow
operator|)
operator|(
name|pData
operator|)
expr_stmt|;
comment|/* store in object ? */
if|if
condition|(
operator|(
operator|!
name|iRslt
operator|)
operator|&&
operator|(
name|pData
operator|->
name|fStorerow
operator|)
condition|)
name|iRslt
operator|=
operator|(
operator|(
name|mng_storerow
operator|)
name|pData
operator|->
name|fStorerow
operator|)
operator|(
name|pData
operator|)
expr_stmt|;
comment|/* color correction ? */
if|if
condition|(
operator|(
operator|!
name|iRslt
operator|)
operator|&&
operator|(
name|pData
operator|->
name|fCorrectrow
operator|)
condition|)
name|iRslt
operator|=
operator|(
operator|(
name|mng_correctrow
operator|)
name|pData
operator|->
name|fCorrectrow
operator|)
operator|(
name|pData
operator|)
expr_stmt|;
comment|/* slap onto canvas ? */
if|if
condition|(
operator|(
operator|!
name|iRslt
operator|)
operator|&&
operator|(
name|pData
operator|->
name|fDisplayrow
operator|)
condition|)
block|{
name|iRslt
operator|=
operator|(
operator|(
name|mng_displayrow
operator|)
name|pData
operator|->
name|fDisplayrow
operator|)
operator|(
name|pData
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|iRslt
condition|)
comment|/* check progressive display refresh */
name|iRslt
operator|=
name|mng_display_progressive_check
argument_list|(
name|pData
argument_list|)
expr_stmt|;
block|}
block|}
block|}
if|if
condition|(
name|iRslt
condition|)
comment|/* on error bail out */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|iRslt
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pData
operator|->
name|fDifferrow
condition|)
comment|/* swap row-pointers */
block|{
name|pSwap
operator|=
name|pData
operator|->
name|pWorkrow
expr_stmt|;
name|pData
operator|->
name|pWorkrow
operator|=
name|pData
operator|->
name|pPrevrow
expr_stmt|;
name|pData
operator|->
name|pPrevrow
operator|=
name|pSwap
expr_stmt|;
comment|/* so prev points to the processed row! */
block|}
name|iRslt
operator|=
name|mng_next_row
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* adjust variables for next row */
if|if
condition|(
name|iRslt
condition|)
comment|/* on error bail out */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|iRslt
argument_list|)
expr_stmt|;
block|}
comment|/* let zlib know where to store next output */
name|pData
operator|->
name|sZlib
operator|.
name|next_out
operator|=
name|pData
operator|->
name|pWorkrow
expr_stmt|;
name|pData
operator|->
name|sZlib
operator|.
name|avail_out
operator|=
call|(
name|uInt
call|)
argument_list|(
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_NO_1_2_4BIT_SUPPORT
if|if
condition|(
name|pData
operator|->
name|iPNGdepth
operator|<
literal|8
condition|)
name|pData
operator|->
name|sZlib
operator|.
name|avail_out
operator|=
call|(
name|uInt
call|)
argument_list|(
operator|(
name|pData
operator|->
name|iPNGdepth
operator|*
name|pData
operator|->
name|iRowsize
operator|+
literal|7
operator|)
operator|/
literal|8
operator|+
name|pData
operator|->
name|iPixelofs
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|pData
operator|->
name|iPNGdepth
operator|>
literal|8
condition|)
name|pData
operator|->
name|sZlib
operator|.
name|avail_out
operator|=
call|(
name|uInt
call|)
argument_list|(
literal|2
operator|*
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
comment|/* until some error or EOI                                           or all pixels received */
do|while
condition|(
operator|(
name|iZrslt
operator|==
name|Z_OK
operator|)
operator|&&
operator|(
name|pData
operator|->
name|sZlib
operator|.
name|avail_in
operator|>
literal|0
operator|)
operator|&&
operator|(
operator|(
name|pData
operator|->
name|iRow
operator|<
operator|(
name|mng_int32
operator|)
name|pData
operator|->
name|iDataheight
operator|)
operator|||
operator|(
operator|(
name|pData
operator|->
name|iPass
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iPass
operator|<
literal|7
operator|)
operator|)
operator|)
condition|)
do|;
comment|/* on error bail out */
if|if
condition|(
operator|(
name|iZrslt
operator|!=
name|Z_OK
operator|)
operator|&&
operator|(
name|iZrslt
operator|!=
name|Z_STREAM_END
operator|)
condition|)
name|MNG_ERRORZ
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_uint32
operator|)
name|iZrslt
argument_list|)
expr_stmt|;
comment|/* too much data ? */
if|if
condition|(
operator|(
name|iZrslt
operator|==
name|Z_OK
operator|)
operator|&&
operator|(
name|pData
operator|->
name|sZlib
operator|.
name|avail_in
operator|>
literal|0
operator|)
condition|)
name|MNG_WARNING
argument_list|(
name|pData
argument_list|,
name|MNG_TOOMUCHIDAT
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_INFLATEROWS
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_DISPLAY */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mngzlib_inflatedata
name|mng_retcode
name|mngzlib_inflatedata
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint32
name|iInlen
parameter_list|,
name|mng_uint8p
name|pIndata
parameter_list|)
block|{
name|int
name|iZrslt
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_INFLATEDATA
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* let zlib know where to get stuff */
name|pData
operator|->
name|sZlib
operator|.
name|next_in
operator|=
name|pIndata
expr_stmt|;
name|pData
operator|->
name|sZlib
operator|.
name|avail_in
operator|=
operator|(
name|uInt
operator|)
name|iInlen
expr_stmt|;
comment|/* now inflate the data in one go! */
name|iZrslt
operator|=
name|inflate
argument_list|(
operator|&
name|pData
operator|->
name|sZlib
argument_list|,
name|Z_FINISH
argument_list|)
expr_stmt|;
comment|/* not enough room in output-buffer ? */
if|if
condition|(
operator|(
name|iZrslt
operator|==
name|Z_BUF_ERROR
operator|)
operator|||
operator|(
name|pData
operator|->
name|sZlib
operator|.
name|avail_in
operator|>
literal|0
operator|)
condition|)
return|return
name|MNG_BUFOVERFLOW
return|;
comment|/* on error bail out */
if|if
condition|(
operator|(
name|iZrslt
operator|!=
name|Z_OK
operator|)
operator|&&
operator|(
name|iZrslt
operator|!=
name|Z_STREAM_END
operator|)
condition|)
name|MNG_ERRORZ
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_uint32
operator|)
name|iZrslt
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_INFLATEDATA
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mngzlib_inflatefree
name|mng_retcode
name|mngzlib_inflatefree
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|int
name|iZrslt
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_INFLATEFREE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|bInflating
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* stopped it */
name|iZrslt
operator|=
name|inflateEnd
argument_list|(
operator|&
name|pData
operator|->
name|sZlib
argument_list|)
expr_stmt|;
comment|/* let zlib cleanup its own stuff */
if|if
condition|(
name|iZrslt
operator|!=
name|Z_OK
condition|)
comment|/* on error bail out */
name|MNG_ERRORZ
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_uint32
operator|)
name|iZrslt
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_INFLATEFREE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
comment|/* done */
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mngzlib_deflateinit
name|mng_retcode
name|mngzlib_deflateinit
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|int
name|iZrslt
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_DEFLATEINIT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* initialize zlib structures and such */
name|iZrslt
operator|=
name|deflateInit2
argument_list|(
operator|&
name|pData
operator|->
name|sZlib
argument_list|,
name|pData
operator|->
name|iZlevel
argument_list|,
name|pData
operator|->
name|iZmethod
argument_list|,
name|pData
operator|->
name|iZwindowbits
argument_list|,
name|pData
operator|->
name|iZmemlevel
argument_list|,
name|pData
operator|->
name|iZstrategy
argument_list|)
expr_stmt|;
if|if
condition|(
name|iZrslt
operator|!=
name|Z_OK
condition|)
comment|/* on error bail out */
name|MNG_ERRORZ
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_uint32
operator|)
name|iZrslt
argument_list|)
expr_stmt|;
name|pData
operator|->
name|bDeflating
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* really deflating something now */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_DEFLATEINIT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
comment|/* done */
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mngzlib_deflaterows
name|mng_retcode
name|mngzlib_deflaterows
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint32
name|iInlen
parameter_list|,
name|mng_uint8p
name|pIndata
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_DEFLATEROWS
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_DEFLATEROWS
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mngzlib_deflatedata
name|mng_retcode
name|mngzlib_deflatedata
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint32
name|iInlen
parameter_list|,
name|mng_uint8p
name|pIndata
parameter_list|)
block|{
name|int
name|iZrslt
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_DEFLATEDATA
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|sZlib
operator|.
name|next_in
operator|=
name|pIndata
expr_stmt|;
comment|/* let zlib know where to get stuff */
name|pData
operator|->
name|sZlib
operator|.
name|avail_in
operator|=
operator|(
name|uInt
operator|)
name|iInlen
expr_stmt|;
comment|/* now deflate the data in one go! */
name|iZrslt
operator|=
name|deflate
argument_list|(
operator|&
name|pData
operator|->
name|sZlib
argument_list|,
name|Z_FINISH
argument_list|)
expr_stmt|;
comment|/* not enough room in output-buffer ? */
if|if
condition|(
operator|(
name|iZrslt
operator|==
name|Z_BUF_ERROR
operator|)
operator|||
operator|(
name|pData
operator|->
name|sZlib
operator|.
name|avail_in
operator|>
literal|0
operator|)
condition|)
return|return
name|MNG_BUFOVERFLOW
return|;
comment|/* on error bail out */
if|if
condition|(
operator|(
name|iZrslt
operator|!=
name|Z_OK
operator|)
operator|&&
operator|(
name|iZrslt
operator|!=
name|Z_STREAM_END
operator|)
condition|)
name|MNG_ERRORZ
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_uint32
operator|)
name|iZrslt
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_DEFLATEDATA
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mngzlib_deflatefree
name|mng_retcode
name|mngzlib_deflatefree
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|int
name|iZrslt
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_DEFLATEFREE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iZrslt
operator|=
name|deflateEnd
argument_list|(
operator|&
name|pData
operator|->
name|sZlib
argument_list|)
expr_stmt|;
comment|/* let zlib cleanup its own stuff */
if|if
condition|(
name|iZrslt
operator|!=
name|Z_OK
condition|)
comment|/* on error bail out */
name|MNG_ERRORZ
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_uint32
operator|)
name|iZrslt
argument_list|)
expr_stmt|;
name|pData
operator|->
name|bDeflating
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* stopped it */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_ZLIB_DEFLATEFREE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
comment|/* done */
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_INCLUDE_ZLIB */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* * end of file                                                            * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
end_unit
