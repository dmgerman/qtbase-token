begin_unit
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *             For conditions of distribution and use,                    * */
end_comment
begin_comment
comment|/* *                see copyright notice in libmng.h                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * project   : libmng                                                     * */
end_comment
begin_comment
comment|/* * file      : libmng_object_prc.c       copyright (c) 2000-2007 G.Juyn   * */
end_comment
begin_comment
comment|/* * version   : 1.0.10                                                     * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * purpose   : Object processing routines (implementation)                * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * author    : G.Juyn                                                     * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * comment   : implementation of the internal object processing routines  * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * changes   : 0.5.1 - 05/08/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed strict-ANSI stuff                                * */
end_comment
begin_comment
comment|/* *             0.5.1 - 05/12/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed trace to macro for callback error-reporting      * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.5.2 - 05/20/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed to support JNG objects                             * */
end_comment
begin_comment
comment|/* *             0.5.2 - 05/24/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added support for global color-chunks in animation       * */
end_comment
begin_comment
comment|/* *             - added support for global PLTE,tRNS,bKGD in animation     * */
end_comment
begin_comment
comment|/* *             - added SAVE& SEEK animation objects                      * */
end_comment
begin_comment
comment|/* *             0.5.2 - 05/29/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added initialization of framenr/layernr/playtime         * */
end_comment
begin_comment
comment|/* *             - changed ani_object create routines not to return the     * */
end_comment
begin_comment
comment|/* *               created object (wasn't necessary)                        * */
end_comment
begin_comment
comment|/* *             0.5.2 - 05/30/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added object promotion routine (PROM handling)           * */
end_comment
begin_comment
comment|/* *             - added ani-object routines for delta-image processing     * */
end_comment
begin_comment
comment|/* *             - added compression/filter/interlace fields to             * */
end_comment
begin_comment
comment|/* *               object-buffer for delta-image processing                 * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.5.3 - 06/17/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed support for delta-image processing               * */
end_comment
begin_comment
comment|/* *             0.5.3 - 06/20/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed some small things (as precaution)                  * */
end_comment
begin_comment
comment|/* *             0.5.3 - 06/21/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added processing of PLTE/tRNS& color-info for           * */
end_comment
begin_comment
comment|/* *               delta-images in the ani_objects chain                    * */
end_comment
begin_comment
comment|/* *             0.5.3 - 06/22/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added support for PPLT chunk                             * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.1 - 07/07/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added support for freeze/restart/resume& go_xxxx        * */
end_comment
begin_comment
comment|/* *             0.9.1 - 07/16/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed support for mng_display() after mng_read()         * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.2 - 07/29/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed small bugs in display processing                   * */
end_comment
begin_comment
comment|/* *             0.9.2 - 08/05/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed file-prefixes                                    * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.3 - 08/07/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - B111300 - fixup for improved portability                 * */
end_comment
begin_comment
comment|/* *             0.9.3 - 08/26/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added MAGN chunk                                         * */
end_comment
begin_comment
comment|/* *             0.9.3 - 09/10/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed DEFI behavior                                      * */
end_comment
begin_comment
comment|/* *             0.9.3 - 10/17/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added valid-flag to stored objects for read() / display()* */
end_comment
begin_comment
comment|/* *             - added routine to discard "invalid" objects               * */
end_comment
begin_comment
comment|/* *             0.9.3 - 10/18/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed delta-processing behavior                          * */
end_comment
begin_comment
comment|/* *             0.9.3 - 10/19/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added storage for pixel-/alpha-sampledepth for delta's   * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.4 -  1/18/2001 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - removed "old" MAGN methods 3& 4                         * */
end_comment
begin_comment
comment|/* *             - added "new" MAGN methods 3, 4& 5                        * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.5 -  1/22/2001 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - B129681 - fixed compiler warnings SGI/Irix               * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.2 - 06/23/2001 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added optimization option for MNG-video playback         * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.5 - 08/15/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - completed PROM support                                   * */
end_comment
begin_comment
comment|/* *             1.0.5 - 08/16/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - completed MAGN support (16-bit functions)                * */
end_comment
begin_comment
comment|/* *             1.0.5 - 08/19/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - B597134 - libmng pollutes the linker namespace           * */
end_comment
begin_comment
comment|/* *             1.0.5 - 09/13/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed read/write of MAGN chunk                           * */
end_comment
begin_comment
comment|/* *             1.0.5 - 09/15/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added event handling for dynamic MNG                     * */
end_comment
begin_comment
comment|/* *             1.0.5 - 09/20/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added support for PAST                                   * */
end_comment
begin_comment
comment|/* *             1.0.5 - 09/23/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed reset_object_detail to clear old buffer            * */
end_comment
begin_comment
comment|/* *             - added in-memory color-correction of abstract images      * */
end_comment
begin_comment
comment|/* *             1.0.5 - 10/05/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed problem with cloned objects marked as invalid      * */
end_comment
begin_comment
comment|/* *             - fixed problem cloning frozen object_buffers              * */
end_comment
begin_comment
comment|/* *             1.0.5 - 10/07/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed DISC support                                       * */
end_comment
begin_comment
comment|/* *             1.0.5 - 11/04/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed goframe/golayer/gotime processing                  * */
end_comment
begin_comment
comment|/* *             1.0.5 - 11/07/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed magnification bug with object 0                    * */
end_comment
begin_comment
comment|/* *             1.0.5 - 01/19/2003 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - B664911 - fixed buffer overflow during init              * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.6 - 04/19/2003 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed problem with infinite loops during readdisplay()   * */
end_comment
begin_comment
comment|/* *             1.0.6 - 05/25/2003 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added MNG_SKIPCHUNK_cHNK footprint optimizations         * */
end_comment
begin_comment
comment|/* *             1.0.6 - 06/09/2003 - G. R-P                                * */
end_comment
begin_comment
comment|/* *             - added conditionals around 8-bit magn routines            * */
end_comment
begin_comment
comment|/* *             1.0.6 - 07/07/2003 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added conditionals around some JNG-supporting code       * */
end_comment
begin_comment
comment|/* *             - removed conditionals around 8-bit magn routines          * */
end_comment
begin_comment
comment|/* *             - added conditionals around delta-png and 16-bit code      * */
end_comment
begin_comment
comment|/* *             1.0.6 - 07/14/2003 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added MNG_NO_LOOP_SIGNALS_SUPPORTED conditional          * */
end_comment
begin_comment
comment|/* *             1.0.6 - 07/29/2003 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed invalid test in promote_imageobject                * */
end_comment
begin_comment
comment|/* *             1.0.6 - 07/29/2003 - G.R-P.                                * */
end_comment
begin_comment
comment|/* *             - added conditionals around PAST chunk support             * */
end_comment
begin_comment
comment|/* *             1.0.6 - 08/17/2003 - G.R-P.                                * */
end_comment
begin_comment
comment|/* *             - added conditionals around MAGN chunk support             * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.7 - 03/21/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed some 64-bit platform compiler warnings             * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.9 - 10/10/2004 - G.R-P.                                * */
end_comment
begin_comment
comment|/* *             - added MNG_NO_1_2_4BIT_SUPPORT support                    * */
end_comment
begin_comment
comment|/* *             1.0.9 - 12/05/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added conditional MNG_OPTIMIZE_OBJCLEANUP                * */
end_comment
begin_comment
comment|/* *             1.0.9 - 12/11/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added conditional MNG_OPTIMIZE_DISPLAYCALLS              * */
end_comment
begin_comment
comment|/* *             1.0.9 - 12/31/2004 - G.R-P.                                * */
end_comment
begin_comment
comment|/* *             - fixed warnings about possible uninitialized pointers     * */
end_comment
begin_comment
comment|/* *             1.0.9 - 01/02/2005 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixing some compiler-warnings                            * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.10 - 02/07/2005 - G.Juyn                               * */
end_comment
begin_comment
comment|/* *             - fixed some compiler-warnings                             * */
end_comment
begin_comment
comment|/* *             1.0.10 - 07/30/2005 - G.Juyn                               * */
end_comment
begin_comment
comment|/* *             - fixed problem with CLON object during readdisplay()      * */
end_comment
begin_comment
comment|/* *             1.0.10 - 04/08/2007 - G.Juyn                               * */
end_comment
begin_comment
comment|/* *             - added support for mPNG proposal                          * */
end_comment
begin_comment
comment|/* *             1.0.10 - 04/12/2007 - G.Juyn                               * */
end_comment
begin_comment
comment|/* *             - added support for ANG proposal                           * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_include
include|#
directive|include
file|"libmng.h"
end_include
begin_include
include|#
directive|include
file|"libmng_data.h"
end_include
begin_include
include|#
directive|include
file|"libmng_error.h"
end_include
begin_include
include|#
directive|include
file|"libmng_trace.h"
end_include
begin_ifdef
ifdef|#
directive|ifdef
name|__BORLANDC__
end_ifdef
begin_pragma
pragma|#
directive|pragma
name|hdrstop
end_pragma
begin_endif
endif|#
directive|endif
end_endif
begin_include
include|#
directive|include
file|"libmng_memory.h"
end_include
begin_include
include|#
directive|include
file|"libmng_chunks.h"
end_include
begin_include
include|#
directive|include
file|"libmng_objects.h"
end_include
begin_include
include|#
directive|include
file|"libmng_display.h"
end_include
begin_include
include|#
directive|include
file|"libmng_pixels.h"
end_include
begin_include
include|#
directive|include
file|"libmng_object_prc.h"
end_include
begin_include
include|#
directive|include
file|"libmng_cms.h"
end_include
begin_if
if|#
directive|if
name|defined
argument_list|(
name|__BORLANDC__
argument_list|)
operator|&&
name|defined
argument_list|(
name|MNG_STRICT_ANSI
argument_list|)
end_if
begin_pragma
pragma|#
directive|pragma
name|option
name|-
name|A
end_pragma
begin_comment
comment|/* force ANSI-C */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_DISPLAY_PROCS
end_ifdef
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Generic object routines                                                * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_drop_invalid_objects
name|mng_retcode
name|mng_drop_invalid_objects
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_objectp
name|pObject
decl_stmt|;
name|mng_objectp
name|pNext
decl_stmt|;
name|mng_cleanupobject
name|fCleanup
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DROP_INVALID_OBJECTS
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pObject
operator|=
name|pData
operator|->
name|pFirstimgobj
expr_stmt|;
comment|/* get first stored image-object (if any) */
while|while
condition|(
name|pObject
condition|)
comment|/* more objects to check ? */
block|{
name|pNext
operator|=
operator|(
operator|(
name|mng_object_headerp
operator|)
name|pObject
operator|)
operator|->
name|pNext
expr_stmt|;
comment|/* invalid ? */
if|if
condition|(
operator|!
operator|(
operator|(
name|mng_imagep
operator|)
name|pObject
operator|)
operator|->
name|bValid
condition|)
block|{
comment|/* call appropriate cleanup */
name|fCleanup
operator|=
operator|(
operator|(
name|mng_object_headerp
operator|)
name|pObject
operator|)
operator|->
name|fCleanup
expr_stmt|;
name|fCleanup
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|)
expr_stmt|;
block|}
name|pObject
operator|=
name|pNext
expr_stmt|;
comment|/* neeeext */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DROP_INVALID_OBJECTS
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifdef
begin_function
DECL|function|create_obj_general
name|MNG_LOCAL
name|mng_retcode
name|create_obj_general
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_size_t
name|iObjsize
parameter_list|,
name|mng_cleanupobject
name|fCleanup
parameter_list|,
name|mng_processobject
name|fProcess
parameter_list|,
name|mng_ptr
modifier|*
name|ppObject
parameter_list|)
block|{
name|mng_object_headerp
name|pWork
decl_stmt|;
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pWork
argument_list|,
name|iObjsize
argument_list|)
expr_stmt|;
name|pWork
operator|->
name|fCleanup
operator|=
name|fCleanup
expr_stmt|;
name|pWork
operator|->
name|fProcess
operator|=
name|fProcess
expr_stmt|;
name|pWork
operator|->
name|iObjsize
operator|=
name|iObjsize
expr_stmt|;
operator|*
name|ppObject
operator|=
operator|(
name|mng_ptr
operator|)
name|pWork
expr_stmt|;
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_free_obj_general
name|MNG_LOCAL
name|mng_retcode
name|mng_free_obj_general
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
operator|(
operator|(
name|mng_object_headerp
operator|)
name|pObject
operator|)
operator|->
name|iObjsize
argument_list|)
expr_stmt|;
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Image-data-object routines                                             * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * these handle the "object buffer" as defined by the MNG specification   * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_create_imagedataobject
name|mng_retcode
name|mng_create_imagedataobject
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_bool
name|bConcrete
parameter_list|,
name|mng_bool
name|bViewable
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint32
name|iHeight
parameter_list|,
name|mng_uint8
name|iBitdepth
parameter_list|,
name|mng_uint8
name|iColortype
parameter_list|,
name|mng_uint8
name|iCompression
parameter_list|,
name|mng_uint8
name|iFilter
parameter_list|,
name|mng_uint8
name|iInterlace
parameter_list|,
name|mng_imagedatap
modifier|*
name|ppObject
parameter_list|)
block|{
name|mng_imagedatap
name|pImagedata
decl_stmt|;
name|mng_uint32
name|iSamplesize
init|=
literal|0
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_IMGDATAOBJECT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* get a buffer */
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
block|{
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_imagedata
argument_list|)
argument_list|,
operator|(
name|mng_cleanupobject
operator|)
name|mng_free_imagedataobject
argument_list|,
name|MNG_NULL
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pImagedata
operator|=
operator|(
name|mng_imagedatap
operator|)
name|pTemp
expr_stmt|;
block|}
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pImagedata
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_imagedata
argument_list|)
argument_list|)
expr_stmt|;
comment|/* fill the appropriate fields */
name|pImagedata
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
operator|(
name|mng_cleanupobject
operator|)
name|mng_free_imagedataobject
expr_stmt|;
name|pImagedata
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|MNG_NULL
expr_stmt|;
endif|#
directive|endif
name|pImagedata
operator|->
name|iRefcount
operator|=
literal|1
expr_stmt|;
name|pImagedata
operator|->
name|bFrozen
operator|=
name|MNG_FALSE
expr_stmt|;
name|pImagedata
operator|->
name|bConcrete
operator|=
name|bConcrete
expr_stmt|;
name|pImagedata
operator|->
name|bViewable
operator|=
name|bViewable
expr_stmt|;
name|pImagedata
operator|->
name|iWidth
operator|=
name|iWidth
expr_stmt|;
name|pImagedata
operator|->
name|iHeight
operator|=
name|iHeight
expr_stmt|;
name|pImagedata
operator|->
name|iBitdepth
operator|=
name|iBitdepth
expr_stmt|;
name|pImagedata
operator|->
name|iColortype
operator|=
name|iColortype
expr_stmt|;
name|pImagedata
operator|->
name|iCompression
operator|=
name|iCompression
expr_stmt|;
name|pImagedata
operator|->
name|iFilter
operator|=
name|iFilter
expr_stmt|;
name|pImagedata
operator|->
name|iInterlace
operator|=
name|iInterlace
expr_stmt|;
name|pImagedata
operator|->
name|bCorrected
operator|=
name|MNG_FALSE
expr_stmt|;
name|pImagedata
operator|->
name|iAlphabitdepth
operator|=
literal|0
expr_stmt|;
name|pImagedata
operator|->
name|iJHDRcompression
operator|=
literal|0
expr_stmt|;
name|pImagedata
operator|->
name|iJHDRinterlace
operator|=
literal|0
expr_stmt|;
name|pImagedata
operator|->
name|iPixelsampledepth
operator|=
name|iBitdepth
expr_stmt|;
name|pImagedata
operator|->
name|iAlphasampledepth
operator|=
name|iBitdepth
expr_stmt|;
comment|/* determine samplesize from color_type/bit_depth */
switch|switch
condition|(
name|iColortype
condition|)
comment|/* for< 8-bit samples we just reserve 8 bits */
block|{
case|case
literal|0
case|:
empty_stmt|;
comment|/* gray */
case|case
literal|8
case|:
block|{
comment|/* JPEG gray */
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|>
literal|8
condition|)
name|iSamplesize
operator|=
literal|2
expr_stmt|;
else|else
endif|#
directive|endif
name|iSamplesize
operator|=
literal|1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
empty_stmt|;
comment|/* rgb */
case|case
literal|10
case|:
block|{
comment|/* JPEG rgb */
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|>
literal|8
condition|)
name|iSamplesize
operator|=
literal|6
expr_stmt|;
else|else
endif|#
directive|endif
name|iSamplesize
operator|=
literal|3
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
comment|/* indexed */
name|iSamplesize
operator|=
literal|1
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
empty_stmt|;
comment|/* gray+alpha */
case|case
literal|12
case|:
block|{
comment|/* JPEG gray+alpha */
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|>
literal|8
condition|)
name|iSamplesize
operator|=
literal|4
expr_stmt|;
else|else
endif|#
directive|endif
name|iSamplesize
operator|=
literal|2
expr_stmt|;
break|break;
block|}
case|case
literal|6
case|:
empty_stmt|;
comment|/* rgb+alpha */
case|case
literal|14
case|:
block|{
comment|/* JPEG rgb+alpha */
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|>
literal|8
condition|)
name|iSamplesize
operator|=
literal|8
expr_stmt|;
else|else
endif|#
directive|endif
name|iSamplesize
operator|=
literal|4
expr_stmt|;
break|break;
block|}
block|}
comment|/* make sure we remember all this */
name|pImagedata
operator|->
name|iSamplesize
operator|=
name|iSamplesize
expr_stmt|;
name|pImagedata
operator|->
name|iRowsize
operator|=
name|iSamplesize
operator|*
name|iWidth
expr_stmt|;
name|pImagedata
operator|->
name|iImgdatasize
operator|=
name|pImagedata
operator|->
name|iRowsize
operator|*
name|iHeight
expr_stmt|;
if|if
condition|(
name|pImagedata
operator|->
name|iImgdatasize
condition|)
comment|/* need a buffer ? */
block|{
comment|/* so allocate it */
name|MNG_ALLOCX
argument_list|(
name|pData
argument_list|,
name|pImagedata
operator|->
name|pImgdata
argument_list|,
name|pImagedata
operator|->
name|iImgdatasize
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pImagedata
operator|->
name|pImgdata
condition|)
comment|/* enough memory ? */
block|{
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pImagedata
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_imagedata
argument_list|)
argument_list|)
expr_stmt|;
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_OUTOFMEMORY
argument_list|)
expr_stmt|;
block|}
block|}
comment|/* check global stuff */
name|pImagedata
operator|->
name|bHasGAMA
operator|=
name|pData
operator|->
name|bHasglobalGAMA
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_cHRM
name|pImagedata
operator|->
name|bHasCHRM
operator|=
name|pData
operator|->
name|bHasglobalCHRM
expr_stmt|;
endif|#
directive|endif
name|pImagedata
operator|->
name|bHasSRGB
operator|=
name|pData
operator|->
name|bHasglobalSRGB
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
name|pImagedata
operator|->
name|bHasICCP
operator|=
name|pData
operator|->
name|bHasglobalICCP
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_bKGD
name|pImagedata
operator|->
name|bHasBKGD
operator|=
name|pData
operator|->
name|bHasglobalBKGD
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bHasglobalGAMA
condition|)
comment|/* global gAMA present ? */
name|pImagedata
operator|->
name|iGamma
operator|=
name|pData
operator|->
name|iGlobalGamma
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_cHRM
if|if
condition|(
name|pData
operator|->
name|bHasglobalCHRM
condition|)
comment|/* global cHRM present ? */
block|{
name|pImagedata
operator|->
name|iWhitepointx
operator|=
name|pData
operator|->
name|iGlobalWhitepointx
expr_stmt|;
name|pImagedata
operator|->
name|iWhitepointy
operator|=
name|pData
operator|->
name|iGlobalWhitepointy
expr_stmt|;
name|pImagedata
operator|->
name|iPrimaryredx
operator|=
name|pData
operator|->
name|iGlobalPrimaryredx
expr_stmt|;
name|pImagedata
operator|->
name|iPrimaryredy
operator|=
name|pData
operator|->
name|iGlobalPrimaryredy
expr_stmt|;
name|pImagedata
operator|->
name|iPrimarygreenx
operator|=
name|pData
operator|->
name|iGlobalPrimarygreenx
expr_stmt|;
name|pImagedata
operator|->
name|iPrimarygreeny
operator|=
name|pData
operator|->
name|iGlobalPrimarygreeny
expr_stmt|;
name|pImagedata
operator|->
name|iPrimarybluex
operator|=
name|pData
operator|->
name|iGlobalPrimarybluex
expr_stmt|;
name|pImagedata
operator|->
name|iPrimarybluey
operator|=
name|pData
operator|->
name|iGlobalPrimarybluey
expr_stmt|;
block|}
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bHasglobalSRGB
condition|)
comment|/* glbal sRGB present ? */
name|pImagedata
operator|->
name|iRenderingintent
operator|=
name|pData
operator|->
name|iGlobalRendintent
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
if|if
condition|(
name|pData
operator|->
name|bHasglobalICCP
condition|)
comment|/* glbal iCCP present ? */
block|{
name|pImagedata
operator|->
name|iProfilesize
operator|=
name|pData
operator|->
name|iGlobalProfilesize
expr_stmt|;
if|if
condition|(
name|pImagedata
operator|->
name|iProfilesize
condition|)
block|{
name|MNG_ALLOCX
argument_list|(
name|pData
argument_list|,
name|pImagedata
operator|->
name|pProfile
argument_list|,
name|pImagedata
operator|->
name|iProfilesize
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pImagedata
operator|->
name|pProfile
condition|)
comment|/* enough memory ? */
block|{
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pImagedata
operator|->
name|pImgdata
argument_list|,
name|pImagedata
operator|->
name|iImgdatasize
argument_list|)
expr_stmt|;
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pImagedata
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_imagedata
argument_list|)
argument_list|)
expr_stmt|;
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_OUTOFMEMORY
argument_list|)
expr_stmt|;
block|}
name|MNG_COPY
argument_list|(
name|pImagedata
operator|->
name|pProfile
argument_list|,
name|pData
operator|->
name|pGlobalProfile
argument_list|,
name|pImagedata
operator|->
name|iProfilesize
argument_list|)
expr_stmt|;
block|}
block|}
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_bKGD
if|if
condition|(
name|pData
operator|->
name|bHasglobalBKGD
condition|)
comment|/* global bKGD present ? */
block|{
name|pImagedata
operator|->
name|iBKGDred
operator|=
name|pData
operator|->
name|iGlobalBKGDred
expr_stmt|;
name|pImagedata
operator|->
name|iBKGDgreen
operator|=
name|pData
operator|->
name|iGlobalBKGDgreen
expr_stmt|;
name|pImagedata
operator|->
name|iBKGDblue
operator|=
name|pData
operator|->
name|iGlobalBKGDblue
expr_stmt|;
block|}
endif|#
directive|endif
operator|*
name|ppObject
operator|=
name|pImagedata
expr_stmt|;
comment|/* return it */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_IMGDATAOBJECT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_free_imagedataobject
name|mng_retcode
name|mng_free_imagedataobject
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_imagedatap
name|pImagedata
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_IMGDATAOBJECT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pImagedata
operator|->
name|iRefcount
condition|)
comment|/* decrease reference count */
name|pImagedata
operator|->
name|iRefcount
operator|--
expr_stmt|;
if|if
condition|(
operator|!
name|pImagedata
operator|->
name|iRefcount
condition|)
comment|/* reached zero ? */
block|{
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
if|if
condition|(
name|pImagedata
operator|->
name|iProfilesize
condition|)
comment|/* stored an iCCP profile ? */
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pImagedata
operator|->
name|pProfile
argument_list|,
name|pImagedata
operator|->
name|iProfilesize
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pImagedata
operator|->
name|iImgdatasize
condition|)
comment|/* sample-buffer present ? */
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pImagedata
operator|->
name|pImgdata
argument_list|,
name|pImagedata
operator|->
name|iImgdatasize
argument_list|)
expr_stmt|;
comment|/* drop the buffer */
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pImagedata
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_imagedata
argument_list|)
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_IMGDATAOBJECT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_clone_imagedataobject
name|mng_retcode
name|mng_clone_imagedataobject
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_bool
name|bConcrete
parameter_list|,
name|mng_imagedatap
name|pSource
parameter_list|,
name|mng_imagedatap
modifier|*
name|ppClone
parameter_list|)
block|{
name|mng_imagedatap
name|pNewdata
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CLONE_IMGDATAOBJECT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* get a buffer */
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pNewdata
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_imagedata
argument_list|)
argument_list|)
expr_stmt|;
comment|/* blatently copy the original buffer */
name|MNG_COPY
argument_list|(
name|pNewdata
argument_list|,
name|pSource
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_imagedata
argument_list|)
argument_list|)
expr_stmt|;
name|pNewdata
operator|->
name|iRefcount
operator|=
literal|1
expr_stmt|;
comment|/* only the reference count */
name|pNewdata
operator|->
name|bConcrete
operator|=
name|bConcrete
expr_stmt|;
comment|/* and concrete-flag are different */
name|pNewdata
operator|->
name|bFrozen
operator|=
name|MNG_FALSE
expr_stmt|;
if|if
condition|(
name|pNewdata
operator|->
name|iImgdatasize
condition|)
comment|/* sample buffer present ? */
block|{
name|MNG_ALLOCX
argument_list|(
name|pData
argument_list|,
name|pNewdata
operator|->
name|pImgdata
argument_list|,
name|pNewdata
operator|->
name|iImgdatasize
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pNewdata
operator|->
name|pImgdata
condition|)
comment|/* not enough memory ? */
block|{
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pNewdata
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_imagedata
argument_list|)
argument_list|)
expr_stmt|;
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_OUTOFMEMORY
argument_list|)
expr_stmt|;
block|}
comment|/* make a copy */
name|MNG_COPY
argument_list|(
name|pNewdata
operator|->
name|pImgdata
argument_list|,
name|pSource
operator|->
name|pImgdata
argument_list|,
name|pNewdata
operator|->
name|iImgdatasize
argument_list|)
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
if|if
condition|(
name|pNewdata
operator|->
name|iProfilesize
condition|)
comment|/* iCCP profile present ? */
block|{
name|MNG_ALLOCX
argument_list|(
name|pData
argument_list|,
name|pNewdata
operator|->
name|pProfile
argument_list|,
name|pNewdata
operator|->
name|iProfilesize
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pNewdata
operator|->
name|pProfile
condition|)
comment|/* enough memory ? */
block|{
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pNewdata
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_imagedata
argument_list|)
argument_list|)
expr_stmt|;
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_OUTOFMEMORY
argument_list|)
expr_stmt|;
block|}
comment|/* make a copy */
name|MNG_COPY
argument_list|(
name|pNewdata
operator|->
name|pProfile
argument_list|,
name|pSource
operator|->
name|pProfile
argument_list|,
name|pNewdata
operator|->
name|iProfilesize
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
operator|*
name|ppClone
operator|=
name|pNewdata
expr_stmt|;
comment|/* return the clone */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CLONE_IMGDATAOBJECT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Image-object routines                                                  * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * these handle the "object" as defined by the MNG specification          * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_create_imageobject
name|mng_retcode
name|mng_create_imageobject
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iId
parameter_list|,
name|mng_bool
name|bConcrete
parameter_list|,
name|mng_bool
name|bVisible
parameter_list|,
name|mng_bool
name|bViewable
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint32
name|iHeight
parameter_list|,
name|mng_uint8
name|iBitdepth
parameter_list|,
name|mng_uint8
name|iColortype
parameter_list|,
name|mng_uint8
name|iCompression
parameter_list|,
name|mng_uint8
name|iFilter
parameter_list|,
name|mng_uint8
name|iInterlace
parameter_list|,
name|mng_int32
name|iPosx
parameter_list|,
name|mng_int32
name|iPosy
parameter_list|,
name|mng_bool
name|bClipped
parameter_list|,
name|mng_int32
name|iClipl
parameter_list|,
name|mng_int32
name|iClipr
parameter_list|,
name|mng_int32
name|iClipt
parameter_list|,
name|mng_int32
name|iClipb
parameter_list|,
name|mng_imagep
modifier|*
name|ppObject
parameter_list|)
block|{
name|mng_imagep
name|pImage
decl_stmt|;
name|mng_imagep
name|pPrev
decl_stmt|,
name|pNext
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
name|mng_imagedatap
name|pImgbuf
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_IMGOBJECT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* get a buffer */
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pImage
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_image
argument_list|)
argument_list|)
expr_stmt|;
comment|/* now get a new "object buffer" */
name|iRetcode
operator|=
name|mng_create_imagedataobject
argument_list|(
name|pData
argument_list|,
name|bConcrete
argument_list|,
name|bViewable
argument_list|,
name|iWidth
argument_list|,
name|iHeight
argument_list|,
name|iBitdepth
argument_list|,
name|iColortype
argument_list|,
name|iCompression
argument_list|,
name|iFilter
argument_list|,
name|iInterlace
argument_list|,
operator|&
name|pImgbuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
block|{
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pImage
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_image
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|iRetcode
return|;
block|}
comment|/* fill the appropriate fields */
name|pImage
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
operator|(
name|mng_cleanupobject
operator|)
name|mng_free_imageobject
expr_stmt|;
name|pImage
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|MNG_NULL
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|pImage
operator|->
name|sHeader
operator|.
name|iObjsize
operator|=
sizeof|sizeof
argument_list|(
name|mng_image
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pImage
operator|->
name|iId
operator|=
name|iId
expr_stmt|;
name|pImage
operator|->
name|bFrozen
operator|=
name|MNG_FALSE
expr_stmt|;
name|pImage
operator|->
name|bVisible
operator|=
name|bVisible
expr_stmt|;
name|pImage
operator|->
name|bViewable
operator|=
name|bViewable
expr_stmt|;
name|pImage
operator|->
name|bValid
operator|=
call|(
name|mng_bool
call|)
argument_list|(
operator|(
name|pData
operator|->
name|bDisplaying
operator|)
operator|&&
operator|(
operator|(
name|pData
operator|->
name|bRunning
operator|)
operator|||
operator|(
name|pData
operator|->
name|bSearching
operator|)
operator|)
operator|&&
operator|(
operator|!
name|pData
operator|->
name|bFreezing
operator|)
argument_list|)
expr_stmt|;
name|pImage
operator|->
name|iPosx
operator|=
name|iPosx
expr_stmt|;
name|pImage
operator|->
name|iPosy
operator|=
name|iPosy
expr_stmt|;
name|pImage
operator|->
name|bClipped
operator|=
name|bClipped
expr_stmt|;
name|pImage
operator|->
name|iClipl
operator|=
name|iClipl
expr_stmt|;
name|pImage
operator|->
name|iClipr
operator|=
name|iClipr
expr_stmt|;
name|pImage
operator|->
name|iClipt
operator|=
name|iClipt
expr_stmt|;
name|pImage
operator|->
name|iClipb
operator|=
name|iClipb
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_MAGN
name|pImage
operator|->
name|iMAGN_MethodX
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_MethodY
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_MX
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_MY
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_ML
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_MR
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_MT
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_MB
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_PAST
name|pImage
operator|->
name|iPastx
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iPasty
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
name|pImage
operator|->
name|pImgbuf
operator|=
name|pImgbuf
expr_stmt|;
if|if
condition|(
name|iId
condition|)
comment|/* only if not object 0 ! */
block|{
comment|/* find previous lower object-id */
name|pPrev
operator|=
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pLastimgobj
expr_stmt|;
while|while
condition|(
operator|(
name|pPrev
operator|)
operator|&&
operator|(
name|pPrev
operator|->
name|iId
operator|>
name|iId
operator|)
condition|)
name|pPrev
operator|=
operator|(
name|mng_imagep
operator|)
name|pPrev
operator|->
name|sHeader
operator|.
name|pPrev
expr_stmt|;
if|if
condition|(
name|pPrev
condition|)
comment|/* found it ? */
block|{
name|pImage
operator|->
name|sHeader
operator|.
name|pPrev
operator|=
name|pPrev
expr_stmt|;
comment|/* than link it in place */
name|pImage
operator|->
name|sHeader
operator|.
name|pNext
operator|=
name|pPrev
operator|->
name|sHeader
operator|.
name|pNext
expr_stmt|;
name|pPrev
operator|->
name|sHeader
operator|.
name|pNext
operator|=
name|pImage
expr_stmt|;
block|}
else|else
comment|/* if not found, it becomes the first ! */
block|{
name|pImage
operator|->
name|sHeader
operator|.
name|pNext
operator|=
name|pData
operator|->
name|pFirstimgobj
expr_stmt|;
name|pData
operator|->
name|pFirstimgobj
operator|=
name|pImage
expr_stmt|;
block|}
name|pNext
operator|=
operator|(
name|mng_imagep
operator|)
name|pImage
operator|->
name|sHeader
operator|.
name|pNext
expr_stmt|;
if|if
condition|(
name|pNext
condition|)
name|pNext
operator|->
name|sHeader
operator|.
name|pPrev
operator|=
name|pImage
expr_stmt|;
else|else
name|pData
operator|->
name|pLastimgobj
operator|=
name|pImage
expr_stmt|;
block|}
operator|*
name|ppObject
operator|=
name|pImage
expr_stmt|;
comment|/* and return the new buffer */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_IMGOBJECT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
comment|/* okido */
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_free_imageobject
name|mng_retcode
name|mng_free_imageobject
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_imagep
name|pImage
parameter_list|)
block|{
name|mng_retcode
name|iRetcode
decl_stmt|;
name|mng_imagep
name|pPrev
init|=
name|pImage
operator|->
name|sHeader
operator|.
name|pPrev
decl_stmt|;
name|mng_imagep
name|pNext
init|=
name|pImage
operator|->
name|sHeader
operator|.
name|pNext
decl_stmt|;
name|mng_imagedatap
name|pImgbuf
init|=
name|pImage
operator|->
name|pImgbuf
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_IMGOBJECT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pImage
operator|->
name|iId
condition|)
comment|/* not for object 0 */
block|{
if|if
condition|(
name|pPrev
condition|)
comment|/* unlink from the list first ! */
name|pPrev
operator|->
name|sHeader
operator|.
name|pNext
operator|=
name|pImage
operator|->
name|sHeader
operator|.
name|pNext
expr_stmt|;
else|else
name|pData
operator|->
name|pFirstimgobj
operator|=
name|pImage
operator|->
name|sHeader
operator|.
name|pNext
expr_stmt|;
if|if
condition|(
name|pNext
condition|)
name|pNext
operator|->
name|sHeader
operator|.
name|pPrev
operator|=
name|pImage
operator|->
name|sHeader
operator|.
name|pPrev
expr_stmt|;
else|else
name|pData
operator|->
name|pLastimgobj
operator|=
name|pImage
operator|->
name|sHeader
operator|.
name|pPrev
expr_stmt|;
block|}
comment|/* unlink the image-data buffer */
name|iRetcode
operator|=
name|mng_free_imagedataobject
argument_list|(
name|pData
argument_list|,
name|pImgbuf
argument_list|)
expr_stmt|;
comment|/* drop its own buffer */
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pImage
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_image
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_IMGOBJECT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_find_imageobject
name|mng_imagep
name|mng_find_imageobject
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iId
parameter_list|)
block|{
name|mng_imagep
name|pImage
init|=
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pFirstimgobj
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACEX
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FIND_IMGOBJECT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* look up the right id */
while|while
condition|(
operator|(
name|pImage
operator|)
operator|&&
operator|(
name|pImage
operator|->
name|iId
operator|!=
name|iId
operator|)
condition|)
name|pImage
operator|=
operator|(
name|mng_imagep
operator|)
name|pImage
operator|->
name|sHeader
operator|.
name|pNext
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_INCLUDE_MPNG_PROPOSAL
if|if
condition|(
operator|(
operator|!
name|pImage
operator|)
operator|&&
operator|(
name|pData
operator|->
name|eImagetype
operator|==
name|mng_it_mpng
operator|)
condition|)
name|pImage
operator|=
name|pData
operator|->
name|pObjzero
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACEX
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FIND_IMGOBJECT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|pImage
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_clone_imageobject
name|mng_retcode
name|mng_clone_imageobject
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iId
parameter_list|,
name|mng_bool
name|bPartial
parameter_list|,
name|mng_bool
name|bVisible
parameter_list|,
name|mng_bool
name|bAbstract
parameter_list|,
name|mng_bool
name|bHasloca
parameter_list|,
name|mng_uint8
name|iLocationtype
parameter_list|,
name|mng_int32
name|iLocationx
parameter_list|,
name|mng_int32
name|iLocationy
parameter_list|,
name|mng_imagep
name|pSource
parameter_list|,
name|mng_imagep
modifier|*
name|ppClone
parameter_list|)
block|{
name|mng_imagep
name|pNew
decl_stmt|;
name|mng_imagep
name|pPrev
decl_stmt|,
name|pNext
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
name|mng_imagedatap
name|pImgbuf
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CLONE_IMGOBJECT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_MAGN
if|if
condition|(
operator|(
name|pSource
operator|->
name|iId
operator|)
operator|&&
comment|/* needs magnification ? */
operator|(
operator|(
name|pSource
operator|->
name|iMAGN_MethodX
operator|)
operator|||
operator|(
name|pSource
operator|->
name|iMAGN_MethodY
operator|)
operator|)
condition|)
block|{
name|iRetcode
operator|=
name|mng_magnify_imageobject
argument_list|(
name|pData
argument_list|,
name|pSource
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
block|}
endif|#
directive|endif
comment|/* get a buffer */
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
block|{
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_image
argument_list|)
argument_list|,
operator|(
name|mng_cleanupobject
operator|)
name|mng_free_imageobject
argument_list|,
name|MNG_NULL
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pNew
operator|=
operator|(
name|mng_imagep
operator|)
name|pTemp
expr_stmt|;
block|}
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pNew
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_image
argument_list|)
argument_list|)
expr_stmt|;
comment|/* fill or copy the appropriate fields */
name|pNew
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
operator|(
name|mng_cleanupobject
operator|)
name|mng_free_imageobject
expr_stmt|;
name|pNew
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|MNG_NULL
expr_stmt|;
endif|#
directive|endif
name|pNew
operator|->
name|iId
operator|=
name|iId
expr_stmt|;
name|pNew
operator|->
name|bFrozen
operator|=
name|MNG_FALSE
expr_stmt|;
name|pNew
operator|->
name|bVisible
operator|=
name|bVisible
expr_stmt|;
name|pNew
operator|->
name|bViewable
operator|=
name|pSource
operator|->
name|bViewable
expr_stmt|;
name|pNew
operator|->
name|bValid
operator|=
name|MNG_TRUE
expr_stmt|;
if|if
condition|(
name|bHasloca
condition|)
comment|/* location info available ? */
block|{
if|if
condition|(
name|iLocationtype
operator|==
literal|0
condition|)
comment|/* absolute position ? */
block|{
name|pNew
operator|->
name|iPosx
operator|=
name|iLocationx
expr_stmt|;
name|pNew
operator|->
name|iPosy
operator|=
name|iLocationy
expr_stmt|;
block|}
else|else
comment|/* relative */
block|{
name|pNew
operator|->
name|iPosx
operator|=
name|pSource
operator|->
name|iPosx
operator|+
name|iLocationx
expr_stmt|;
name|pNew
operator|->
name|iPosy
operator|=
name|pSource
operator|->
name|iPosy
operator|+
name|iLocationy
expr_stmt|;
block|}
block|}
else|else
comment|/* copy from source */
block|{
name|pNew
operator|->
name|iPosx
operator|=
name|pSource
operator|->
name|iPosx
expr_stmt|;
name|pNew
operator|->
name|iPosy
operator|=
name|pSource
operator|->
name|iPosy
expr_stmt|;
block|}
comment|/* copy clipping info */
name|pNew
operator|->
name|bClipped
operator|=
name|pSource
operator|->
name|bClipped
expr_stmt|;
name|pNew
operator|->
name|iClipl
operator|=
name|pSource
operator|->
name|iClipl
expr_stmt|;
name|pNew
operator|->
name|iClipr
operator|=
name|pSource
operator|->
name|iClipr
expr_stmt|;
name|pNew
operator|->
name|iClipt
operator|=
name|pSource
operator|->
name|iClipt
expr_stmt|;
name|pNew
operator|->
name|iClipb
operator|=
name|pSource
operator|->
name|iClipb
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_MAGN
comment|/* copy magnification info */
comment|/*  pNew->iMAGN_MethodX    = pSource->iMAGN_MethodX;     LET'S NOT !!!!!!   pNew->iMAGN_MethodY    = pSource->iMAGN_MethodY;   pNew->iMAGN_MX         = pSource->iMAGN_MX;   pNew->iMAGN_MY         = pSource->iMAGN_MY;   pNew->iMAGN_ML         = pSource->iMAGN_ML;   pNew->iMAGN_MR         = pSource->iMAGN_MR;   pNew->iMAGN_MT         = pSource->iMAGN_MT;   pNew->iMAGN_MB         = pSource->iMAGN_MB; */
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_PAST
name|pNew
operator|->
name|iPastx
operator|=
literal|0
expr_stmt|;
comment|/* initialize PAST info */
name|pNew
operator|->
name|iPasty
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iId
condition|)
comment|/* not for object 0 */
block|{
comment|/* find previous lower object-id */
name|pPrev
operator|=
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pLastimgobj
expr_stmt|;
while|while
condition|(
operator|(
name|pPrev
operator|)
operator|&&
operator|(
name|pPrev
operator|->
name|iId
operator|>
name|iId
operator|)
condition|)
name|pPrev
operator|=
operator|(
name|mng_imagep
operator|)
name|pPrev
operator|->
name|sHeader
operator|.
name|pPrev
expr_stmt|;
if|if
condition|(
name|pPrev
condition|)
comment|/* found it ? */
block|{
name|pNew
operator|->
name|sHeader
operator|.
name|pPrev
operator|=
name|pPrev
expr_stmt|;
comment|/* than link it in place */
name|pNew
operator|->
name|sHeader
operator|.
name|pNext
operator|=
name|pPrev
operator|->
name|sHeader
operator|.
name|pNext
expr_stmt|;
name|pPrev
operator|->
name|sHeader
operator|.
name|pNext
operator|=
name|pNew
expr_stmt|;
block|}
else|else
comment|/* if not found, it becomes the first ! */
block|{
name|pNew
operator|->
name|sHeader
operator|.
name|pNext
operator|=
name|pData
operator|->
name|pFirstimgobj
expr_stmt|;
name|pData
operator|->
name|pFirstimgobj
operator|=
name|pNew
expr_stmt|;
block|}
name|pNext
operator|=
operator|(
name|mng_imagep
operator|)
name|pNew
operator|->
name|sHeader
operator|.
name|pNext
expr_stmt|;
if|if
condition|(
name|pNext
condition|)
name|pNext
operator|->
name|sHeader
operator|.
name|pPrev
operator|=
name|pNew
expr_stmt|;
else|else
name|pData
operator|->
name|pLastimgobj
operator|=
name|pNew
expr_stmt|;
block|}
if|if
condition|(
name|bPartial
condition|)
comment|/* partial clone ? */
block|{
name|pNew
operator|->
name|pImgbuf
operator|=
name|pSource
operator|->
name|pImgbuf
expr_stmt|;
comment|/* use the same object buffer */
name|pNew
operator|->
name|pImgbuf
operator|->
name|iRefcount
operator|++
expr_stmt|;
comment|/* and increase the reference count */
block|}
else|else
comment|/* create a full clone ! */
block|{
name|mng_bool
name|bConcrete
init|=
name|MNG_FALSE
decl_stmt|;
comment|/* it's abstract by default (?) */
if|if
condition|(
operator|!
name|bAbstract
condition|)
comment|/* determine concreteness from source ? */
name|bConcrete
operator|=
name|pSource
operator|->
name|pImgbuf
operator|->
name|bConcrete
expr_stmt|;
comment|/* create a full clone ! */
name|iRetcode
operator|=
name|mng_clone_imagedataobject
argument_list|(
name|pData
argument_list|,
name|bConcrete
argument_list|,
name|pSource
operator|->
name|pImgbuf
argument_list|,
operator|&
name|pImgbuf
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
block|{
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pNew
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_image
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|iRetcode
return|;
block|}
name|pNew
operator|->
name|pImgbuf
operator|=
name|pImgbuf
expr_stmt|;
comment|/* and remember it */
block|}
operator|*
name|ppClone
operator|=
name|pNew
expr_stmt|;
comment|/* return it */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CLONE_IMGOBJECT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_renum_imageobject
name|mng_retcode
name|mng_renum_imageobject
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_imagep
name|pSource
parameter_list|,
name|mng_uint16
name|iId
parameter_list|,
name|mng_bool
name|bVisible
parameter_list|,
name|mng_bool
name|bAbstract
parameter_list|,
name|mng_bool
name|bHasloca
parameter_list|,
name|mng_uint8
name|iLocationtype
parameter_list|,
name|mng_int32
name|iLocationx
parameter_list|,
name|mng_int32
name|iLocationy
parameter_list|)
block|{
name|mng_imagep
name|pPrev
decl_stmt|,
name|pNext
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RENUM_IMGOBJECT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pSource
operator|->
name|bVisible
operator|=
name|bVisible
expr_stmt|;
comment|/* store the new visibility */
if|if
condition|(
name|bHasloca
condition|)
comment|/* location info available ? */
block|{
if|if
condition|(
name|iLocationtype
operator|==
literal|0
condition|)
comment|/* absolute position ? */
block|{
name|pSource
operator|->
name|iPosx
operator|=
name|iLocationx
expr_stmt|;
name|pSource
operator|->
name|iPosy
operator|=
name|iLocationy
expr_stmt|;
block|}
else|else
comment|/* relative */
block|{
name|pSource
operator|->
name|iPosx
operator|=
name|pSource
operator|->
name|iPosx
operator|+
name|iLocationx
expr_stmt|;
name|pSource
operator|->
name|iPosy
operator|=
name|pSource
operator|->
name|iPosy
operator|+
name|iLocationy
expr_stmt|;
block|}
block|}
if|if
condition|(
name|iId
condition|)
comment|/* not for object 0 */
block|{
comment|/* find previous lower object-id */
name|pPrev
operator|=
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pLastimgobj
expr_stmt|;
while|while
condition|(
operator|(
name|pPrev
operator|)
operator|&&
operator|(
name|pPrev
operator|->
name|iId
operator|>
name|iId
operator|)
condition|)
name|pPrev
operator|=
operator|(
name|mng_imagep
operator|)
name|pPrev
operator|->
name|sHeader
operator|.
name|pPrev
expr_stmt|;
comment|/* different from current ? */
if|if
condition|(
name|pPrev
operator|!=
operator|(
name|mng_imagep
operator|)
name|pSource
operator|->
name|sHeader
operator|.
name|pPrev
condition|)
block|{
if|if
condition|(
name|pSource
operator|->
name|sHeader
operator|.
name|pPrev
condition|)
comment|/* unlink from current position !! */
operator|(
operator|(
name|mng_imagep
operator|)
name|pSource
operator|->
name|sHeader
operator|.
name|pPrev
operator|)
operator|->
name|sHeader
operator|.
name|pNext
operator|=
name|pSource
operator|->
name|sHeader
operator|.
name|pNext
expr_stmt|;
else|else
name|pData
operator|->
name|pFirstimgobj
operator|=
name|pSource
operator|->
name|sHeader
operator|.
name|pNext
expr_stmt|;
if|if
condition|(
name|pSource
operator|->
name|sHeader
operator|.
name|pNext
condition|)
operator|(
operator|(
name|mng_imagep
operator|)
name|pSource
operator|->
name|sHeader
operator|.
name|pNext
operator|)
operator|->
name|sHeader
operator|.
name|pPrev
operator|=
name|pSource
operator|->
name|sHeader
operator|.
name|pPrev
expr_stmt|;
else|else
name|pData
operator|->
name|pLastimgobj
operator|=
name|pSource
operator|->
name|sHeader
operator|.
name|pPrev
expr_stmt|;
if|if
condition|(
name|pPrev
condition|)
comment|/* found the previous ? */
block|{
comment|/* than link it in place */
name|pSource
operator|->
name|sHeader
operator|.
name|pPrev
operator|=
name|pPrev
expr_stmt|;
name|pSource
operator|->
name|sHeader
operator|.
name|pNext
operator|=
name|pPrev
operator|->
name|sHeader
operator|.
name|pNext
expr_stmt|;
name|pPrev
operator|->
name|sHeader
operator|.
name|pNext
operator|=
name|pSource
expr_stmt|;
block|}
else|else
comment|/* if not found, it becomes the first ! */
block|{
name|pSource
operator|->
name|sHeader
operator|.
name|pNext
operator|=
name|pData
operator|->
name|pFirstimgobj
expr_stmt|;
name|pData
operator|->
name|pFirstimgobj
operator|=
name|pSource
expr_stmt|;
block|}
name|pNext
operator|=
operator|(
name|mng_imagep
operator|)
name|pSource
operator|->
name|sHeader
operator|.
name|pNext
expr_stmt|;
if|if
condition|(
name|pNext
condition|)
name|pNext
operator|->
name|sHeader
operator|.
name|pPrev
operator|=
name|pSource
expr_stmt|;
else|else
name|pData
operator|->
name|pLastimgobj
operator|=
name|pSource
expr_stmt|;
block|}
block|}
name|pSource
operator|->
name|iId
operator|=
name|iId
expr_stmt|;
comment|/* now set the new id! */
if|if
condition|(
name|bAbstract
condition|)
comment|/* force it to abstract ? */
name|pSource
operator|->
name|pImgbuf
operator|->
name|bConcrete
operator|=
name|MNG_FALSE
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RENUM_IMGOBJECT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_reset_object_details
name|mng_retcode
name|mng_reset_object_details
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_imagep
name|pImage
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint32
name|iHeight
parameter_list|,
name|mng_uint8
name|iBitdepth
parameter_list|,
name|mng_uint8
name|iColortype
parameter_list|,
name|mng_uint8
name|iCompression
parameter_list|,
name|mng_uint8
name|iFilter
parameter_list|,
name|mng_uint8
name|iInterlace
parameter_list|,
name|mng_bool
name|bResetall
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
name|pImage
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint32
name|iSamplesize
init|=
literal|0
decl_stmt|;
name|mng_uint32
name|iRowsize
decl_stmt|;
name|mng_uint32
name|iImgdatasize
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESET_OBJECTDETAILS
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pBuf
operator|->
name|iWidth
operator|=
name|iWidth
expr_stmt|;
comment|/* set buffer characteristics */
name|pBuf
operator|->
name|iHeight
operator|=
name|iHeight
expr_stmt|;
name|pBuf
operator|->
name|iBitdepth
operator|=
name|iBitdepth
expr_stmt|;
name|pBuf
operator|->
name|iColortype
operator|=
name|iColortype
expr_stmt|;
name|pBuf
operator|->
name|iCompression
operator|=
name|iCompression
expr_stmt|;
name|pBuf
operator|->
name|iFilter
operator|=
name|iFilter
expr_stmt|;
name|pBuf
operator|->
name|iInterlace
operator|=
name|iInterlace
expr_stmt|;
name|pBuf
operator|->
name|bCorrected
operator|=
name|MNG_FALSE
expr_stmt|;
name|pBuf
operator|->
name|iAlphabitdepth
operator|=
literal|0
expr_stmt|;
comment|/* determine samplesize from color_type/bit_depth */
switch|switch
condition|(
name|iColortype
condition|)
comment|/* for< 8-bit samples we just reserve 8 bits */
block|{
case|case
literal|0
case|:
empty_stmt|;
comment|/* gray */
case|case
literal|8
case|:
block|{
comment|/* JPEG gray */
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|>
literal|8
condition|)
name|iSamplesize
operator|=
literal|2
expr_stmt|;
else|else
endif|#
directive|endif
name|iSamplesize
operator|=
literal|1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
empty_stmt|;
comment|/* rgb */
case|case
literal|10
case|:
block|{
comment|/* JPEG rgb */
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|>
literal|8
condition|)
name|iSamplesize
operator|=
literal|6
expr_stmt|;
else|else
endif|#
directive|endif
name|iSamplesize
operator|=
literal|3
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
comment|/* indexed */
name|iSamplesize
operator|=
literal|1
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
empty_stmt|;
comment|/* gray+alpha */
case|case
literal|12
case|:
block|{
comment|/* JPEG gray+alpha */
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|>
literal|8
condition|)
name|iSamplesize
operator|=
literal|4
expr_stmt|;
else|else
endif|#
directive|endif
name|iSamplesize
operator|=
literal|2
expr_stmt|;
break|break;
block|}
case|case
literal|6
case|:
empty_stmt|;
comment|/* rgb+alpha */
case|case
literal|14
case|:
block|{
comment|/* JPEG rgb+alpha */
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|>
literal|8
condition|)
name|iSamplesize
operator|=
literal|8
expr_stmt|;
else|else
endif|#
directive|endif
name|iSamplesize
operator|=
literal|4
expr_stmt|;
break|break;
block|}
block|}
name|iRowsize
operator|=
name|iSamplesize
operator|*
name|iWidth
expr_stmt|;
name|iImgdatasize
operator|=
name|iRowsize
operator|*
name|iHeight
expr_stmt|;
comment|/* buffer size changed ? */
if|if
condition|(
name|iImgdatasize
operator|!=
name|pBuf
operator|->
name|iImgdatasize
condition|)
block|{
comment|/* drop the old one */
name|MNG_FREE
argument_list|(
name|pData
argument_list|,
name|pBuf
operator|->
name|pImgdata
argument_list|,
name|pBuf
operator|->
name|iImgdatasize
argument_list|)
expr_stmt|;
if|if
condition|(
name|iImgdatasize
condition|)
comment|/* allocate new sample-buffer ? */
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pBuf
operator|->
name|pImgdata
argument_list|,
name|iImgdatasize
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iImgdatasize
condition|)
comment|/* clear old buffer */
block|{
name|mng_uint8p
name|pTemp
init|=
name|pBuf
operator|->
name|pImgdata
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
operator|(
name|iImgdatasize
operator|&
call|(
name|mng_uint32
call|)
argument_list|(
operator|~
literal|3L
argument_list|)
operator|)
condition|;
name|iX
operator|+=
literal|4
control|)
block|{
operator|*
operator|(
operator|(
name|mng_uint32p
operator|)
name|pTemp
operator|)
operator|=
literal|0x00000000l
expr_stmt|;
name|pTemp
operator|+=
literal|4
expr_stmt|;
block|}
while|while
condition|(
name|pTemp
operator|<
operator|(
name|pBuf
operator|->
name|pImgdata
operator|+
name|iImgdatasize
operator|)
condition|)
block|{
operator|*
name|pTemp
operator|=
literal|0
expr_stmt|;
name|pTemp
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pBuf
operator|->
name|iSamplesize
operator|=
name|iSamplesize
expr_stmt|;
comment|/* remember new sizes */
name|pBuf
operator|->
name|iRowsize
operator|=
name|iRowsize
expr_stmt|;
name|pBuf
operator|->
name|iImgdatasize
operator|=
name|iImgdatasize
expr_stmt|;
if|if
condition|(
operator|!
name|pBuf
operator|->
name|iPixelsampledepth
condition|)
comment|/* set delta sampledepths if empty */
name|pBuf
operator|->
name|iPixelsampledepth
operator|=
name|iBitdepth
expr_stmt|;
if|if
condition|(
operator|!
name|pBuf
operator|->
name|iAlphasampledepth
condition|)
name|pBuf
operator|->
name|iAlphasampledepth
operator|=
name|iBitdepth
expr_stmt|;
comment|/* dimension set and clipping not ? */
if|if
condition|(
operator|(
name|iWidth
operator|)
operator|&&
operator|(
name|iHeight
operator|)
operator|&&
operator|(
operator|!
name|pImage
operator|->
name|bClipped
operator|)
condition|)
block|{
name|pImage
operator|->
name|iClipl
operator|=
literal|0
expr_stmt|;
comment|/* set clipping to dimension by default */
name|pImage
operator|->
name|iClipr
operator|=
name|iWidth
expr_stmt|;
name|pImage
operator|->
name|iClipt
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iClipb
operator|=
name|iHeight
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_MAGN
if|if
condition|(
name|pImage
operator|->
name|iId
condition|)
comment|/* reset magnification info ? */
block|{
name|pImage
operator|->
name|iMAGN_MethodX
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_MethodY
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_MX
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_MY
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_ML
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_MR
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_MT
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_MB
operator|=
literal|0
expr_stmt|;
block|}
endif|#
directive|endif
if|if
condition|(
name|bResetall
condition|)
comment|/* reset the other characteristics ? */
block|{
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_PAST
name|pImage
operator|->
name|iPastx
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iPasty
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
name|pBuf
operator|->
name|bHasPLTE
operator|=
name|MNG_FALSE
expr_stmt|;
name|pBuf
operator|->
name|bHasTRNS
operator|=
name|MNG_FALSE
expr_stmt|;
name|pBuf
operator|->
name|bHasGAMA
operator|=
name|pData
operator|->
name|bHasglobalGAMA
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_cHRM
name|pBuf
operator|->
name|bHasCHRM
operator|=
name|pData
operator|->
name|bHasglobalCHRM
expr_stmt|;
endif|#
directive|endif
name|pBuf
operator|->
name|bHasSRGB
operator|=
name|pData
operator|->
name|bHasglobalSRGB
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
name|pBuf
operator|->
name|bHasICCP
operator|=
name|pData
operator|->
name|bHasglobalICCP
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_bKGD
name|pBuf
operator|->
name|bHasBKGD
operator|=
name|pData
operator|->
name|bHasglobalBKGD
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
if|if
condition|(
name|pBuf
operator|->
name|iProfilesize
condition|)
comment|/* drop possibly old ICC profile */
block|{
name|MNG_FREE
argument_list|(
name|pData
argument_list|,
name|pBuf
operator|->
name|pProfile
argument_list|,
name|pBuf
operator|->
name|iProfilesize
argument_list|)
expr_stmt|;
name|pBuf
operator|->
name|iProfilesize
operator|=
literal|0
expr_stmt|;
block|}
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bHasglobalGAMA
condition|)
comment|/* global gAMA present ? */
name|pBuf
operator|->
name|iGamma
operator|=
name|pData
operator|->
name|iGlobalGamma
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_cHRM
if|if
condition|(
name|pData
operator|->
name|bHasglobalCHRM
condition|)
comment|/* global cHRM present ? */
block|{
name|pBuf
operator|->
name|iWhitepointx
operator|=
name|pData
operator|->
name|iGlobalWhitepointx
expr_stmt|;
name|pBuf
operator|->
name|iWhitepointy
operator|=
name|pData
operator|->
name|iGlobalWhitepointy
expr_stmt|;
name|pBuf
operator|->
name|iPrimaryredx
operator|=
name|pData
operator|->
name|iGlobalPrimaryredx
expr_stmt|;
name|pBuf
operator|->
name|iPrimaryredy
operator|=
name|pData
operator|->
name|iGlobalPrimaryredy
expr_stmt|;
name|pBuf
operator|->
name|iPrimarygreenx
operator|=
name|pData
operator|->
name|iGlobalPrimarygreenx
expr_stmt|;
name|pBuf
operator|->
name|iPrimarygreeny
operator|=
name|pData
operator|->
name|iGlobalPrimarygreeny
expr_stmt|;
name|pBuf
operator|->
name|iPrimarybluex
operator|=
name|pData
operator|->
name|iGlobalPrimarybluex
expr_stmt|;
name|pBuf
operator|->
name|iPrimarybluey
operator|=
name|pData
operator|->
name|iGlobalPrimarybluey
expr_stmt|;
block|}
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bHasglobalSRGB
condition|)
comment|/* global sRGB present ? */
name|pBuf
operator|->
name|iRenderingintent
operator|=
name|pData
operator|->
name|iGlobalRendintent
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
if|if
condition|(
name|pData
operator|->
name|bHasglobalICCP
condition|)
comment|/* global iCCP present ? */
block|{
if|if
condition|(
name|pData
operator|->
name|iGlobalProfilesize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pBuf
operator|->
name|pProfile
argument_list|,
name|pData
operator|->
name|iGlobalProfilesize
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pBuf
operator|->
name|pProfile
argument_list|,
name|pData
operator|->
name|pGlobalProfile
argument_list|,
name|pData
operator|->
name|iGlobalProfilesize
argument_list|)
expr_stmt|;
block|}
name|pBuf
operator|->
name|iProfilesize
operator|=
name|pData
operator|->
name|iGlobalProfilesize
expr_stmt|;
block|}
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_bKGD
if|if
condition|(
name|pData
operator|->
name|bHasglobalBKGD
condition|)
comment|/* global bKGD present ? */
block|{
name|pBuf
operator|->
name|iBKGDred
operator|=
name|pData
operator|->
name|iGlobalBKGDred
expr_stmt|;
name|pBuf
operator|->
name|iBKGDgreen
operator|=
name|pData
operator|->
name|iGlobalBKGDgreen
expr_stmt|;
name|pBuf
operator|->
name|iBKGDblue
operator|=
name|pData
operator|->
name|iGlobalBKGDblue
expr_stmt|;
block|}
endif|#
directive|endif
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESET_OBJECTDETAILS
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|MNG_NO_DELTA_PNG
argument_list|)
operator|||
operator|!
name|defined
argument_list|(
name|MNG_SKIPCHUNK_PAST
argument_list|)
operator|||
operator|!
name|defined
argument_list|(
name|MNG_SKIPCHUNK_MAGN
argument_list|)
end_if
begin_function
DECL|function|mng_promote_imageobject
name|mng_retcode
name|mng_promote_imageobject
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_imagep
name|pImage
parameter_list|,
name|mng_uint8
name|iBitdepth
parameter_list|,
name|mng_uint8
name|iColortype
parameter_list|,
name|mng_uint8
name|iFilltype
parameter_list|)
block|{
name|mng_retcode
name|iRetcode
init|=
name|MNG_NOERROR
decl_stmt|;
name|mng_imagedatap
name|pBuf
init|=
name|pImage
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint32
name|iW
init|=
name|pBuf
operator|->
name|iWidth
decl_stmt|;
name|mng_uint32
name|iH
init|=
name|pBuf
operator|->
name|iHeight
decl_stmt|;
name|mng_uint8p
name|pNewbuf
decl_stmt|;
name|mng_uint32
name|iNewbufsize
decl_stmt|;
name|mng_uint32
name|iNewrowsize
decl_stmt|;
name|mng_uint32
name|iNewsamplesize
init|=
name|pBuf
operator|->
name|iSamplesize
decl_stmt|;
name|mng_uint32
name|iY
decl_stmt|;
name|mng_uint8
name|iTempdepth
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_IMGOBJECT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_NO_1_2_4BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|<
literal|8
condition|)
name|iBitdepth
operator|=
literal|8
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<
literal|8
condition|)
name|pBuf
operator|->
name|iBitdepth
operator|=
literal|8
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|>
literal|8
condition|)
name|iBitdepth
operator|=
literal|8
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|>
literal|8
condition|)
name|pBuf
operator|->
name|iBitdepth
operator|=
literal|8
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|fPromoterow
operator|=
name|MNG_NULL
expr_stmt|;
comment|/* init promotion fields */
name|pData
operator|->
name|fPromBitdepth
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|iPromColortype
operator|=
name|iColortype
expr_stmt|;
name|pData
operator|->
name|iPromBitdepth
operator|=
name|iBitdepth
expr_stmt|;
name|pData
operator|->
name|iPromFilltype
operator|=
name|iFilltype
expr_stmt|;
if|if
condition|(
name|iBitdepth
operator|!=
name|pBuf
operator|->
name|iBitdepth
condition|)
comment|/* determine bitdepth promotion */
block|{
if|if
condition|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_INDEXED
condition|)
name|iTempdepth
operator|=
literal|8
expr_stmt|;
else|else
name|iTempdepth
operator|=
name|pBuf
operator|->
name|iBitdepth
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
name|iFilltype
operator|==
name|MNG_FILLMETHOD_ZEROFILL
condition|)
block|{
switch|switch
condition|(
name|iTempdepth
condition|)
block|{
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
case|case
literal|1
case|:
block|{
switch|switch
condition|(
name|iBitdepth
condition|)
block|{
case|case
literal|2
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_zerofill_1_2
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_zerofill_1_4
expr_stmt|;
break|break;
block|}
case|case
literal|8
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_zerofill_1_8
expr_stmt|;
break|break;
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
case|case
literal|16
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_zerofill_1_16
expr_stmt|;
break|break;
block|}
endif|#
directive|endif
block|}
break|break;
block|}
case|case
literal|2
case|:
block|{
switch|switch
condition|(
name|iBitdepth
condition|)
block|{
case|case
literal|4
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_zerofill_2_4
expr_stmt|;
break|break;
block|}
case|case
literal|8
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_zerofill_2_8
expr_stmt|;
break|break;
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
case|case
literal|16
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_zerofill_2_16
expr_stmt|;
break|break;
block|}
endif|#
directive|endif
block|}
break|break;
block|}
case|case
literal|4
case|:
block|{
switch|switch
condition|(
name|iBitdepth
condition|)
block|{
case|case
literal|8
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_zerofill_4_8
expr_stmt|;
break|break;
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
case|case
literal|16
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_zerofill_4_16
expr_stmt|;
break|break;
block|}
endif|#
directive|endif
block|}
break|break;
block|}
endif|#
directive|endif
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
case|case
literal|8
case|:
block|{
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_zerofill_8_16
expr_stmt|;
endif|#
directive|endif
break|break;
block|}
block|}
block|}
else|else
endif|#
directive|endif
block|{
switch|switch
condition|(
name|iTempdepth
condition|)
block|{
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
case|case
literal|1
case|:
block|{
switch|switch
condition|(
name|iBitdepth
condition|)
block|{
case|case
literal|2
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_replicate_1_2
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_replicate_1_4
expr_stmt|;
break|break;
block|}
case|case
literal|8
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_replicate_1_8
expr_stmt|;
break|break;
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
case|case
literal|16
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_replicate_1_16
expr_stmt|;
break|break;
block|}
endif|#
directive|endif
block|}
break|break;
block|}
case|case
literal|2
case|:
block|{
switch|switch
condition|(
name|iBitdepth
condition|)
block|{
case|case
literal|4
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_replicate_2_4
expr_stmt|;
break|break;
block|}
case|case
literal|8
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_replicate_2_8
expr_stmt|;
break|break;
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
case|case
literal|16
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_replicate_2_16
expr_stmt|;
break|break;
block|}
endif|#
directive|endif
block|}
break|break;
block|}
case|case
literal|4
case|:
block|{
switch|switch
condition|(
name|iBitdepth
condition|)
block|{
case|case
literal|8
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_replicate_4_8
expr_stmt|;
break|break;
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
case|case
literal|16
case|:
block|{
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_replicate_4_16
expr_stmt|;
break|break;
block|}
endif|#
directive|endif
block|}
break|break;
block|}
endif|#
directive|endif
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
case|case
literal|8
case|:
block|{
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromBitdepth
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_replicate_8_16
expr_stmt|;
endif|#
directive|endif
break|break;
block|}
block|}
block|}
block|}
comment|/* g -> g */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_GRAY
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_GRAY
operator|)
condition|)
block|{
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
block|{
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g8_g16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g8_g8
expr_stmt|;
block|}
name|iNewsamplesize
operator|=
literal|1
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
comment|/* 16-bit wide ? */
name|iNewsamplesize
operator|=
literal|2
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* g -> ga */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_GRAY
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_GRAYA
operator|)
condition|)
block|{
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
block|{
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g8_ga16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g8_ga8
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
else|else
comment|/* source = 16 bits */
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g16_ga16
expr_stmt|;
endif|#
directive|endif
name|iNewsamplesize
operator|=
literal|2
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
comment|/* 16-bit wide ? */
name|iNewsamplesize
operator|=
literal|4
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* g -> rgb */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_GRAY
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_RGB
operator|)
condition|)
block|{
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
block|{
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g8_rgb16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g8_rgb8
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
else|else
comment|/* source = 16 bits */
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g16_rgb16
expr_stmt|;
endif|#
directive|endif
name|iNewsamplesize
operator|=
literal|3
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
comment|/* 16-bit wide ? */
name|iNewsamplesize
operator|=
literal|6
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* g -> rgba */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_GRAY
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_RGBA
operator|)
condition|)
block|{
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
block|{
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g8_rgba16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g8_rgba8
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
else|else
comment|/* source = 16 bits */
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g16_rgba16
expr_stmt|;
endif|#
directive|endif
name|iNewsamplesize
operator|=
literal|4
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
comment|/* 16-bit wide ? */
name|iNewsamplesize
operator|=
literal|8
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* ga -> ga */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_GRAYA
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_GRAYA
operator|)
condition|)
block|{
name|iNewsamplesize
operator|=
literal|2
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_ga8_ga16
expr_stmt|;
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|iNewsamplesize
operator|=
literal|4
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* ga -> rgba */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_GRAYA
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_RGBA
operator|)
condition|)
block|{
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
block|{
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_ga8_rgba16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_ga8_rgba8
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
else|else
comment|/* source = 16 bits */
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_ga16_rgba16
expr_stmt|;
endif|#
directive|endif
name|iNewsamplesize
operator|=
literal|4
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
comment|/* 16-bit wide ? */
name|iNewsamplesize
operator|=
literal|8
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* rgb -> rgb */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_RGB
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_RGB
operator|)
condition|)
block|{
name|iNewsamplesize
operator|=
literal|3
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_rgb8_rgb16
expr_stmt|;
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|iNewsamplesize
operator|=
literal|6
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* rgb -> rgba */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_RGB
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_RGBA
operator|)
condition|)
block|{
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
block|{
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_rgb8_rgba16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_rgb8_rgba8
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
else|else
comment|/* source = 16 bits */
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_rgb16_rgba16
expr_stmt|;
endif|#
directive|endif
name|iNewsamplesize
operator|=
literal|4
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
comment|/* 16-bit wide ? */
name|iNewsamplesize
operator|=
literal|8
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* indexed -> rgb */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_INDEXED
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_RGB
operator|)
condition|)
block|{
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_idx8_rgb16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_idx8_rgb8
expr_stmt|;
name|iNewsamplesize
operator|=
literal|3
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
comment|/* 16-bit wide ? */
name|iNewsamplesize
operator|=
literal|6
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* indexed -> rgba */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_INDEXED
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_RGBA
operator|)
condition|)
block|{
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_idx8_rgba16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_idx8_rgba8
expr_stmt|;
name|iNewsamplesize
operator|=
literal|4
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
comment|/* 16-bit wide ? */
name|iNewsamplesize
operator|=
literal|8
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* rgba -> rgba */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_RGBA
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_RGBA
operator|)
condition|)
block|{
name|iNewsamplesize
operator|=
literal|4
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
block|{
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_rgba8_rgba16
expr_stmt|;
block|}
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
comment|/* 16-bit wide ? */
name|iNewsamplesize
operator|=
literal|8
expr_stmt|;
endif|#
directive|endif
block|}
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
elseif|else
comment|/* JPEG g -> g */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGGRAY
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGGRAY
operator|)
condition|)
block|{
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
block|{
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g8_g16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g8_g8
expr_stmt|;
block|}
name|iNewsamplesize
operator|=
literal|1
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
comment|/* 16-bit wide ? */
name|iNewsamplesize
operator|=
literal|2
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* JPEG g -> ga */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGGRAY
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGGRAYA
operator|)
condition|)
block|{
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
block|{
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g8_ga16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g8_ga8
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
else|else
comment|/* source = 16 bits */
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g16_ga16
expr_stmt|;
endif|#
directive|endif
name|iNewsamplesize
operator|=
literal|2
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
comment|/* 16-bit wide ? */
name|iNewsamplesize
operator|=
literal|4
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* JPEG g -> rgb */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGGRAY
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGCOLOR
operator|)
condition|)
block|{
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
block|{
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g8_rgb16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g8_rgb8
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
else|else
comment|/* source = 16 bits */
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g16_rgb16
expr_stmt|;
endif|#
directive|endif
name|iNewsamplesize
operator|=
literal|3
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
comment|/* 16-bit wide ? */
name|iNewsamplesize
operator|=
literal|6
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* JPEG g -> rgba */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGGRAY
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGCOLORA
operator|)
condition|)
block|{
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
block|{
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g8_rgba16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g8_rgba8
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
else|else
comment|/* source = 16 bits */
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_g16_rgba16
expr_stmt|;
endif|#
directive|endif
name|iNewsamplesize
operator|=
literal|4
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
comment|/* 16-bit wide ? */
name|iNewsamplesize
operator|=
literal|8
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* JPEG ga -> ga */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGGRAYA
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGGRAYA
operator|)
condition|)
block|{
name|iNewsamplesize
operator|=
literal|2
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_ga8_ga16
expr_stmt|;
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|iNewsamplesize
operator|=
literal|4
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* JPEG ga -> rgba */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGGRAYA
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGCOLORA
operator|)
condition|)
block|{
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
block|{
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_ga8_rgba16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_ga8_rgba8
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
else|else
comment|/* source = 16 bits */
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_ga16_rgba16
expr_stmt|;
endif|#
directive|endif
name|iNewsamplesize
operator|=
literal|4
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
comment|/* 16-bit wide ? */
name|iNewsamplesize
operator|=
literal|8
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* JPEG rgb -> rgb */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGCOLOR
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGCOLOR
operator|)
condition|)
block|{
name|iNewsamplesize
operator|=
literal|3
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_rgb8_rgb16
expr_stmt|;
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|iNewsamplesize
operator|=
literal|6
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* JPEG rgb -> rgba */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGCOLOR
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGCOLORA
operator|)
condition|)
block|{
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
block|{
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_rgb8_rgba16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_rgb8_rgba8
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
else|else
comment|/* source = 16 bits */
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_rgb16_rgba16
expr_stmt|;
endif|#
directive|endif
name|iNewsamplesize
operator|=
literal|4
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
comment|/* 16-bit wide ? */
name|iNewsamplesize
operator|=
literal|8
expr_stmt|;
endif|#
directive|endif
block|}
elseif|else
comment|/* JPEG rgba -> rgba */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGCOLORA
operator|)
operator|&&
operator|(
name|iColortype
operator|==
name|MNG_COLORTYPE_JPEGCOLORA
operator|)
condition|)
block|{
name|iNewsamplesize
operator|=
literal|4
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
comment|/* source<= 8 bits */
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|pData
operator|->
name|fPromoterow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_promote_rgba8_rgba16
expr_stmt|;
if|if
condition|(
name|iBitdepth
operator|==
literal|16
condition|)
name|iNewsamplesize
operator|=
literal|8
expr_stmt|;
endif|#
directive|endif
block|}
endif|#
directive|endif
comment|/* JNG */
comment|/* found a proper promotion ? */
if|if
condition|(
name|pData
operator|->
name|fPromoterow
condition|)
block|{
name|pData
operator|->
name|pPromBuf
operator|=
operator|(
name|mng_ptr
operator|)
name|pBuf
expr_stmt|;
name|pData
operator|->
name|iPromWidth
operator|=
name|pBuf
operator|->
name|iWidth
expr_stmt|;
name|iNewrowsize
operator|=
name|iW
operator|*
name|iNewsamplesize
expr_stmt|;
name|iNewbufsize
operator|=
name|iH
operator|*
name|iNewrowsize
expr_stmt|;
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pNewbuf
argument_list|,
name|iNewbufsize
argument_list|)
expr_stmt|;
name|pData
operator|->
name|pPromSrc
operator|=
operator|(
name|mng_ptr
operator|)
name|pBuf
operator|->
name|pImgdata
expr_stmt|;
name|pData
operator|->
name|pPromDst
operator|=
operator|(
name|mng_ptr
operator|)
name|pNewbuf
expr_stmt|;
name|iY
operator|=
literal|0
expr_stmt|;
while|while
condition|(
operator|(
operator|!
name|iRetcode
operator|)
operator|&&
operator|(
name|iY
operator|<
name|iH
operator|)
condition|)
block|{
name|iRetcode
operator|=
operator|(
operator|(
name|mng_promoterow
operator|)
name|pData
operator|->
name|fPromoterow
operator|)
operator|(
name|pData
operator|)
expr_stmt|;
name|pData
operator|->
name|pPromSrc
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
operator|+
name|pBuf
operator|->
name|iRowsize
expr_stmt|;
name|pData
operator|->
name|pPromDst
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
operator|+
name|iNewrowsize
expr_stmt|;
comment|/*      pData->pPromSrc  = (mng_ptr)((mng_uint32)pData->pPromSrc + pBuf->iRowsize); */
comment|/*      pData->pPromDst  = (mng_ptr)((mng_uint32)pData->pPromDst + iNewrowsize); */
name|iY
operator|++
expr_stmt|;
block|}
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pBuf
operator|->
name|pImgdata
argument_list|,
name|pBuf
operator|->
name|iImgdatasize
argument_list|)
expr_stmt|;
name|pBuf
operator|->
name|iBitdepth
operator|=
name|iBitdepth
expr_stmt|;
name|pBuf
operator|->
name|iColortype
operator|=
name|iColortype
expr_stmt|;
name|pBuf
operator|->
name|iSamplesize
operator|=
name|iNewsamplesize
expr_stmt|;
name|pBuf
operator|->
name|iRowsize
operator|=
name|iNewrowsize
expr_stmt|;
name|pBuf
operator|->
name|iImgdatasize
operator|=
name|iNewbufsize
expr_stmt|;
name|pBuf
operator|->
name|pImgdata
operator|=
name|pNewbuf
expr_stmt|;
name|pBuf
operator|->
name|bHasPLTE
operator|=
name|MNG_FALSE
expr_stmt|;
name|pBuf
operator|->
name|iPLTEcount
operator|=
literal|0
expr_stmt|;
name|pBuf
operator|->
name|bHasTRNS
operator|=
name|MNG_FALSE
expr_stmt|;
name|pBuf
operator|->
name|iTRNScount
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_IMGOBJECT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_MAGN
end_ifndef
begin_function
DECL|function|mng_magnify_imageobject
name|mng_retcode
name|mng_magnify_imageobject
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_imagep
name|pImage
parameter_list|)
block|{
name|mng_uint8p
name|pNewdata
decl_stmt|;
name|mng_uint8p
name|pSrcline1
decl_stmt|;
name|mng_uint8p
name|pSrcline2
decl_stmt|;
name|mng_uint8p
name|pTempline
decl_stmt|;
name|mng_uint8p
name|pDstline
decl_stmt|;
name|mng_uint32
name|iNewrowsize
decl_stmt|;
name|mng_uint32
name|iNewsize
decl_stmt|;
name|mng_uint32
name|iY
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
name|mng_imagedatap
name|pBuf
init|=
name|pImage
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint32
name|iNewW
init|=
name|pBuf
operator|->
name|iWidth
decl_stmt|;
name|mng_uint32
name|iNewH
init|=
name|pBuf
operator|->
name|iHeight
decl_stmt|;
name|mng_magnify_x
name|fMagnifyX
init|=
name|MNG_NULL
decl_stmt|;
name|mng_magnify_y
name|fMagnifyY
init|=
name|MNG_NULL
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_IMGOBJECT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pBuf
operator|->
name|iColortype
operator|==
name|MNG_COLORTYPE_INDEXED
condition|)
comment|/* indexed color ? */
block|{
comment|/* concrete buffer ? */
if|if
condition|(
operator|(
name|pBuf
operator|->
name|bConcrete
operator|)
operator|&&
operator|(
name|pImage
operator|->
name|iId
operator|)
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_INVALIDCOLORTYPE
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_MAGN
if|if
condition|(
name|pBuf
operator|->
name|iTRNScount
condition|)
comment|/* with transparency ? */
name|iRetcode
operator|=
name|mng_promote_imageobject
argument_list|(
name|pData
argument_list|,
name|pImage
argument_list|,
literal|8
argument_list|,
literal|6
argument_list|,
literal|0
argument_list|)
expr_stmt|;
else|else
name|iRetcode
operator|=
name|mng_promote_imageobject
argument_list|(
name|pData
argument_list|,
name|pImage
argument_list|,
literal|8
argument_list|,
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
endif|#
directive|endif
block|}
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_MAGN
comment|/* Promote everything to RGBA, using fill method 0 (LBR) */
name|iRetcode
operator|=
name|mng_promote_imageobject
argument_list|(
name|pData
argument_list|,
name|pImage
argument_list|,
literal|8
argument_list|,
literal|6
argument_list|,
literal|0
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
endif|#
directive|endif
if|if
condition|(
name|pImage
operator|->
name|iMAGN_MethodX
condition|)
comment|/* determine new width */
block|{
if|if
condition|(
name|pImage
operator|->
name|iMAGN_MethodX
operator|==
literal|1
condition|)
block|{
name|iNewW
operator|=
name|pImage
operator|->
name|iMAGN_ML
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|iWidth
operator|>
literal|1
condition|)
name|iNewW
operator|=
name|iNewW
operator|+
name|pImage
operator|->
name|iMAGN_MR
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|iWidth
operator|>
literal|2
condition|)
name|iNewW
operator|=
name|iNewW
operator|+
operator|(
name|pBuf
operator|->
name|iWidth
operator|-
literal|2
operator|)
operator|*
operator|(
name|pImage
operator|->
name|iMAGN_MX
operator|)
expr_stmt|;
block|}
else|else
block|{
name|iNewW
operator|=
name|pBuf
operator|->
name|iWidth
operator|+
name|pImage
operator|->
name|iMAGN_ML
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|iWidth
operator|>
literal|2
condition|)
name|iNewW
operator|=
name|iNewW
operator|+
name|pImage
operator|->
name|iMAGN_MR
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|iWidth
operator|>
literal|3
condition|)
name|iNewW
operator|=
name|iNewW
operator|+
operator|(
name|pBuf
operator|->
name|iWidth
operator|-
literal|3
operator|)
operator|*
operator|(
name|pImage
operator|->
name|iMAGN_MX
operator|-
literal|1
operator|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|pImage
operator|->
name|iMAGN_MethodY
condition|)
comment|/* determine new height */
block|{
if|if
condition|(
name|pImage
operator|->
name|iMAGN_MethodY
operator|==
literal|1
condition|)
block|{
name|iNewH
operator|=
name|pImage
operator|->
name|iMAGN_MT
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|iHeight
operator|>
literal|1
condition|)
name|iNewH
operator|=
name|iNewH
operator|+
name|pImage
operator|->
name|iMAGN_ML
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|iHeight
operator|>
literal|2
condition|)
name|iNewH
operator|=
name|iNewH
operator|+
operator|(
name|pBuf
operator|->
name|iHeight
operator|-
literal|2
operator|)
operator|*
operator|(
name|pImage
operator|->
name|iMAGN_MY
operator|)
expr_stmt|;
block|}
else|else
block|{
name|iNewH
operator|=
name|pBuf
operator|->
name|iHeight
operator|+
name|pImage
operator|->
name|iMAGN_MT
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|iHeight
operator|>
literal|2
condition|)
name|iNewH
operator|=
name|iNewH
operator|+
name|pImage
operator|->
name|iMAGN_MB
operator|-
literal|1
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|iHeight
operator|>
literal|3
condition|)
name|iNewH
operator|=
name|iNewH
operator|+
operator|(
name|pBuf
operator|->
name|iHeight
operator|-
literal|3
operator|)
operator|*
operator|(
name|pImage
operator|->
name|iMAGN_MY
operator|-
literal|1
operator|)
expr_stmt|;
block|}
block|}
comment|/* get new buffer */
name|iNewrowsize
operator|=
name|iNewW
operator|*
name|pBuf
operator|->
name|iSamplesize
expr_stmt|;
name|iNewsize
operator|=
name|iNewH
operator|*
name|iNewrowsize
expr_stmt|;
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pNewdata
argument_list|,
name|iNewsize
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|pBuf
operator|->
name|iColortype
condition|)
comment|/* determine magnification routines */
block|{
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_MAGN
case|case
literal|0
case|:
empty_stmt|;
case|case
literal|8
case|:
block|{
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
block|{
switch|switch
condition|(
name|pImage
operator|->
name|iMAGN_MethodX
condition|)
block|{
case|case
literal|1
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_g8_x1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_g8_x2
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_g8_x3
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_g8_x2
expr_stmt|;
break|break;
block|}
case|case
literal|5
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_g8_x3
expr_stmt|;
break|break;
block|}
block|}
switch|switch
condition|(
name|pImage
operator|->
name|iMAGN_MethodY
condition|)
block|{
case|case
literal|1
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_g8_y1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_g8_y2
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_g8_y3
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_g8_y2
expr_stmt|;
break|break;
block|}
case|case
literal|5
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_g8_y3
expr_stmt|;
break|break;
block|}
block|}
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
else|else
block|{
switch|switch
condition|(
name|pImage
operator|->
name|iMAGN_MethodX
condition|)
block|{
case|case
literal|1
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_g16_x1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_g16_x2
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_g16_x3
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_g16_x2
expr_stmt|;
break|break;
block|}
case|case
literal|5
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_g16_x3
expr_stmt|;
break|break;
block|}
block|}
switch|switch
condition|(
name|pImage
operator|->
name|iMAGN_MethodY
condition|)
block|{
case|case
literal|1
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_g16_y1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_g16_y2
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_g16_y3
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_g16_y2
expr_stmt|;
break|break;
block|}
case|case
literal|5
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_g16_y3
expr_stmt|;
break|break;
block|}
block|}
block|}
endif|#
directive|endif
break|break;
block|}
case|case
literal|2
case|:
empty_stmt|;
case|case
literal|10
case|:
block|{
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
block|{
switch|switch
condition|(
name|pImage
operator|->
name|iMAGN_MethodX
condition|)
block|{
case|case
literal|1
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgb8_x1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgb8_x2
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgb8_x3
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgb8_x2
expr_stmt|;
break|break;
block|}
case|case
literal|5
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgb8_x3
expr_stmt|;
break|break;
block|}
block|}
switch|switch
condition|(
name|pImage
operator|->
name|iMAGN_MethodY
condition|)
block|{
case|case
literal|1
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgb8_y1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgb8_y2
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgb8_y3
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgb8_y2
expr_stmt|;
break|break;
block|}
case|case
literal|5
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgb8_y3
expr_stmt|;
break|break;
block|}
block|}
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
else|else
block|{
switch|switch
condition|(
name|pImage
operator|->
name|iMAGN_MethodX
condition|)
block|{
case|case
literal|1
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgb16_x1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgb16_x2
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgb16_x3
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgb16_x2
expr_stmt|;
break|break;
block|}
case|case
literal|5
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgb16_x3
expr_stmt|;
break|break;
block|}
block|}
switch|switch
condition|(
name|pImage
operator|->
name|iMAGN_MethodY
condition|)
block|{
case|case
literal|1
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgb16_y1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgb16_y2
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgb16_y3
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgb16_y2
expr_stmt|;
break|break;
block|}
case|case
literal|5
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgb16_y3
expr_stmt|;
break|break;
block|}
block|}
block|}
endif|#
directive|endif
break|break;
block|}
case|case
literal|4
case|:
empty_stmt|;
case|case
literal|12
case|:
block|{
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
block|{
switch|switch
condition|(
name|pImage
operator|->
name|iMAGN_MethodX
condition|)
block|{
case|case
literal|1
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_ga8_x1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_ga8_x2
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_ga8_x3
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_ga8_x4
expr_stmt|;
break|break;
block|}
case|case
literal|5
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_ga8_x5
expr_stmt|;
break|break;
block|}
block|}
switch|switch
condition|(
name|pImage
operator|->
name|iMAGN_MethodY
condition|)
block|{
case|case
literal|1
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_ga8_y1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_ga8_y2
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_ga8_y3
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_ga8_y4
expr_stmt|;
break|break;
block|}
case|case
literal|5
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_ga8_y5
expr_stmt|;
break|break;
block|}
block|}
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
else|else
block|{
switch|switch
condition|(
name|pImage
operator|->
name|iMAGN_MethodX
condition|)
block|{
case|case
literal|1
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_ga16_x1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_ga16_x2
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_ga16_x3
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_ga16_x4
expr_stmt|;
break|break;
block|}
case|case
literal|5
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_ga16_x5
expr_stmt|;
break|break;
block|}
block|}
switch|switch
condition|(
name|pImage
operator|->
name|iMAGN_MethodY
condition|)
block|{
case|case
literal|1
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_ga16_y1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_ga16_y2
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_ga16_y3
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_ga16_y4
expr_stmt|;
break|break;
block|}
case|case
literal|5
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_ga16_y5
expr_stmt|;
break|break;
block|}
block|}
block|}
endif|#
directive|endif
break|break;
block|}
endif|#
directive|endif
case|case
literal|6
case|:
empty_stmt|;
case|case
literal|14
case|:
block|{
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<=
literal|8
condition|)
block|{
switch|switch
condition|(
name|pImage
operator|->
name|iMAGN_MethodX
condition|)
block|{
case|case
literal|1
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgba8_x1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgba8_x2
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgba8_x3
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgba8_x4
expr_stmt|;
break|break;
block|}
case|case
literal|5
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgba8_x5
expr_stmt|;
break|break;
block|}
block|}
switch|switch
condition|(
name|pImage
operator|->
name|iMAGN_MethodY
condition|)
block|{
case|case
literal|1
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgba8_y1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgba8_y2
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgba8_y3
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgba8_y4
expr_stmt|;
break|break;
block|}
case|case
literal|5
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgba8_y5
expr_stmt|;
break|break;
block|}
block|}
block|}
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_MAGN
else|else
block|{
switch|switch
condition|(
name|pImage
operator|->
name|iMAGN_MethodX
condition|)
block|{
case|case
literal|1
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgba16_x1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgba16_x2
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgba16_x3
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgba16_x4
expr_stmt|;
break|break;
block|}
case|case
literal|5
case|:
block|{
name|fMagnifyX
operator|=
name|mng_magnify_rgba16_x5
expr_stmt|;
break|break;
block|}
block|}
switch|switch
condition|(
name|pImage
operator|->
name|iMAGN_MethodY
condition|)
block|{
case|case
literal|1
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgba16_y1
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgba16_y2
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgba16_y3
expr_stmt|;
break|break;
block|}
case|case
literal|4
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgba16_y4
expr_stmt|;
break|break;
block|}
case|case
literal|5
case|:
block|{
name|fMagnifyY
operator|=
name|mng_magnify_rgba16_y5
expr_stmt|;
break|break;
block|}
block|}
block|}
endif|#
directive|endif
endif|#
directive|endif
break|break;
block|}
block|}
name|pSrcline1
operator|=
name|pBuf
operator|->
name|pImgdata
expr_stmt|;
comment|/* initialize row-loop variables */
name|pDstline
operator|=
name|pNewdata
expr_stmt|;
comment|/* allocate temporary row */
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pTempline
argument_list|,
name|iNewrowsize
argument_list|)
expr_stmt|;
for|for
control|(
name|iY
operator|=
literal|0
init|;
name|iY
operator|<
name|pBuf
operator|->
name|iHeight
condition|;
name|iY
operator|++
control|)
block|{
name|pSrcline2
operator|=
name|pSrcline1
operator|+
name|pBuf
operator|->
name|iRowsize
expr_stmt|;
if|if
condition|(
name|fMagnifyX
condition|)
comment|/* magnifying in X-direction ? */
block|{
name|iRetcode
operator|=
name|fMagnifyX
argument_list|(
name|pData
argument_list|,
name|pImage
operator|->
name|iMAGN_MX
argument_list|,
name|pImage
operator|->
name|iMAGN_ML
argument_list|,
name|pImage
operator|->
name|iMAGN_MR
argument_list|,
name|pBuf
operator|->
name|iWidth
argument_list|,
name|pSrcline1
argument_list|,
name|pDstline
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
block|{
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pTempline
argument_list|,
name|iNewrowsize
argument_list|)
expr_stmt|;
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pNewdata
argument_list|,
name|iNewsize
argument_list|)
expr_stmt|;
return|return
name|iRetcode
return|;
block|}
block|}
else|else
block|{
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline1
argument_list|,
name|iNewrowsize
argument_list|)
expr_stmt|;
block|}
name|pDstline
operator|+=
name|iNewrowsize
expr_stmt|;
comment|/* magnifying in Y-direction ? */
if|if
condition|(
operator|(
name|fMagnifyY
operator|)
operator|&&
operator|(
operator|(
name|iY
operator|<
name|pBuf
operator|->
name|iHeight
operator|-
literal|1
operator|)
operator|||
operator|(
name|pBuf
operator|->
name|iHeight
operator|==
literal|1
operator|)
operator|||
operator|(
name|pImage
operator|->
name|iMAGN_MethodY
operator|==
literal|1
operator|)
operator|)
condition|)
block|{
if|if
condition|(
name|iY
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|pBuf
operator|->
name|iHeight
operator|==
literal|1
condition|)
comment|/* single row ? */
name|pSrcline2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|pImage
operator|->
name|iMAGN_MT
expr_stmt|;
block|}
elseif|else
comment|/* last interval ? */
if|if
condition|(
operator|(
operator|(
name|pImage
operator|->
name|iMAGN_MethodY
operator|==
literal|1
operator|)
operator|&&
operator|(
name|iY
operator|==
operator|(
name|pBuf
operator|->
name|iHeight
operator|-
literal|1
operator|)
operator|)
operator|)
operator|||
operator|(
operator|(
name|pImage
operator|->
name|iMAGN_MethodY
operator|!=
literal|1
operator|)
operator|&&
operator|(
name|iY
operator|==
operator|(
name|pBuf
operator|->
name|iHeight
operator|-
literal|2
operator|)
operator|)
operator|)
condition|)
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|pImage
operator|->
name|iMAGN_MB
expr_stmt|;
else|else
comment|/* middle interval */
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|pImage
operator|->
name|iMAGN_MY
expr_stmt|;
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
name|iRetcode
operator|=
name|fMagnifyY
argument_list|(
name|pData
argument_list|,
name|iS
argument_list|,
name|iM
argument_list|,
name|pBuf
operator|->
name|iWidth
argument_list|,
name|pSrcline1
argument_list|,
name|pSrcline2
argument_list|,
name|pTempline
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
block|{
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pTempline
argument_list|,
name|iNewrowsize
argument_list|)
expr_stmt|;
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pNewdata
argument_list|,
name|iNewsize
argument_list|)
expr_stmt|;
return|return
name|iRetcode
return|;
block|}
if|if
condition|(
name|fMagnifyX
condition|)
comment|/* magnifying in X-direction ? */
block|{
name|iRetcode
operator|=
name|fMagnifyX
argument_list|(
name|pData
argument_list|,
name|pImage
operator|->
name|iMAGN_MX
argument_list|,
name|pImage
operator|->
name|iMAGN_ML
argument_list|,
name|pImage
operator|->
name|iMAGN_MR
argument_list|,
name|pBuf
operator|->
name|iWidth
argument_list|,
name|pTempline
argument_list|,
name|pDstline
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
block|{
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pTempline
argument_list|,
name|iNewrowsize
argument_list|)
expr_stmt|;
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pNewdata
argument_list|,
name|iNewsize
argument_list|)
expr_stmt|;
return|return
name|iRetcode
return|;
block|}
block|}
else|else
block|{
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pTempline
argument_list|,
name|iNewrowsize
argument_list|)
expr_stmt|;
block|}
name|pDstline
operator|+=
name|iNewrowsize
expr_stmt|;
block|}
block|}
name|pSrcline1
operator|+=
name|pBuf
operator|->
name|iRowsize
expr_stmt|;
block|}
comment|/* drop temporary row */
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pTempline
argument_list|,
name|iNewrowsize
argument_list|)
expr_stmt|;
comment|/* drop old pixel-data */
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pBuf
operator|->
name|pImgdata
argument_list|,
name|pBuf
operator|->
name|iImgdatasize
argument_list|)
expr_stmt|;
name|pBuf
operator|->
name|pImgdata
operator|=
name|pNewdata
expr_stmt|;
comment|/* save new buffer dimensions */
name|pBuf
operator|->
name|iRowsize
operator|=
name|iNewrowsize
expr_stmt|;
name|pBuf
operator|->
name|iImgdatasize
operator|=
name|iNewsize
expr_stmt|;
name|pBuf
operator|->
name|iWidth
operator|=
name|iNewW
expr_stmt|;
name|pBuf
operator|->
name|iHeight
operator|=
name|iNewH
expr_stmt|;
if|if
condition|(
name|pImage
operator|->
name|iId
condition|)
comment|/* real object ? */
block|{
name|pImage
operator|->
name|iMAGN_MethodX
operator|=
literal|0
expr_stmt|;
comment|/* it's done; don't do it again !!! */
name|pImage
operator|->
name|iMAGN_MethodY
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_MX
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_MY
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_ML
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_MR
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_MT
operator|=
literal|0
expr_stmt|;
name|pImage
operator|->
name|iMAGN_MB
operator|=
literal|0
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_IMGOBJECT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_colorcorrect_object
name|mng_retcode
name|mng_colorcorrect_object
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_imagep
name|pImage
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
name|pImage
operator|->
name|pImgbuf
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
name|mng_uint32
name|iY
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_COLORCORRECT_OBJECT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
if|if
condition|(
operator|(
name|pBuf
operator|->
name|iBitdepth
operator|<
literal|8
operator|)
operator|||
comment|/* we need 8- or 16-bit RGBA !!! */
operator|(
operator|(
name|pBuf
operator|->
name|iColortype
operator|!=
name|MNG_COLORTYPE_RGBA
operator|)
operator|&&
operator|(
name|pBuf
operator|->
name|iColortype
operator|!=
name|MNG_COLORTYPE_JPEGCOLORA
operator|)
operator|)
condition|)
else|#
directive|else
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|<
literal|8
condition|)
comment|/* we need 8- or 16-bit RGBA !!! */
endif|#
directive|endif
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_OBJNOTABSTRACT
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pBuf
operator|->
name|bCorrected
condition|)
comment|/* only if not already done ! */
block|{
comment|/* so the row routines now to find it */
name|pData
operator|->
name|pRetrieveobj
operator|=
operator|(
name|mng_objectp
operator|)
name|pImage
expr_stmt|;
name|pData
operator|->
name|pStoreobj
operator|=
operator|(
name|mng_objectp
operator|)
name|pImage
expr_stmt|;
name|pData
operator|->
name|pStorebuf
operator|=
operator|(
name|mng_objectp
operator|)
name|pImage
operator|->
name|pImgbuf
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|>
literal|8
condition|)
block|{
name|pData
operator|->
name|fRetrieverow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_retrieve_rgba16
expr_stmt|;
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_rgba16
expr_stmt|;
block|}
else|else
endif|#
directive|endif
block|{
name|pData
operator|->
name|fRetrieverow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_retrieve_rgba8
expr_stmt|;
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_rgba8
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
comment|/* these are the object's dimensions now */
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pBuf
operator|->
name|iWidth
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|<<
literal|2
expr_stmt|;
name|pData
operator|->
name|iPixelofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* adjust for 16-bit object ? */
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|>
literal|8
condition|)
block|{
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_TRUE
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|<<
literal|3
expr_stmt|;
block|}
endif|#
directive|endif
name|pData
operator|->
name|fCorrectrow
operator|=
name|MNG_NULL
expr_stmt|;
comment|/* default no color-correction */
ifdef|#
directive|ifdef
name|MNG_NO_CMS
name|iRetcode
operator|=
name|MNG_NOERROR
expr_stmt|;
else|#
directive|else
if|#
directive|if
name|defined
argument_list|(
name|MNG_FULL_CMS
argument_list|)
comment|/* determine color-management routine */
name|iRetcode
operator|=
name|mng_init_full_cms
argument_list|(
name|pData
argument_list|,
name|MNG_FALSE
argument_list|,
name|MNG_FALSE
argument_list|,
name|MNG_TRUE
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|MNG_GAMMA_ONLY
argument_list|)
name|iRetcode
operator|=
name|mng_init_gamma_only
argument_list|(
name|pData
argument_list|,
name|MNG_FALSE
argument_list|,
name|MNG_FALSE
argument_list|,
name|MNG_TRUE
argument_list|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|MNG_APP_CMS
argument_list|)
name|iRetcode
operator|=
name|mng_init_app_cms
argument_list|(
name|pData
argument_list|,
name|MNG_FALSE
argument_list|,
name|MNG_FALSE
argument_list|,
name|MNG_TRUE
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
endif|#
directive|endif
comment|/* MNG_NO_CMS */
if|if
condition|(
name|pData
operator|->
name|fCorrectrow
condition|)
comment|/* really correct something ? */
block|{
comment|/* get a temporary row-buffer */
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pRGBArow
argument_list|,
name|pData
operator|->
name|iRowsize
argument_list|)
expr_stmt|;
name|pData
operator|->
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|iY
operator|=
literal|0
expr_stmt|;
comment|/* start from the top */
while|while
condition|(
operator|(
operator|!
name|iRetcode
operator|)
operator|&&
operator|(
name|iY
operator|<
name|pBuf
operator|->
name|iHeight
operator|)
condition|)
block|{
comment|/* get a row */
name|iRetcode
operator|=
operator|(
operator|(
name|mng_retrieverow
operator|)
name|pData
operator|->
name|fRetrieverow
operator|)
operator|(
name|pData
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|iRetcode
condition|)
comment|/* color correct it */
name|iRetcode
operator|=
operator|(
operator|(
name|mng_correctrow
operator|)
name|pData
operator|->
name|fCorrectrow
operator|)
operator|(
name|pData
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|iRetcode
condition|)
comment|/* store it back ! */
name|iRetcode
operator|=
operator|(
operator|(
name|mng_storerow
operator|)
name|pData
operator|->
name|fStorerow
operator|)
operator|(
name|pData
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|iRetcode
condition|)
comment|/* adjust variables for next row */
name|iRetcode
operator|=
name|mng_next_row
argument_list|(
name|pData
argument_list|)
expr_stmt|;
name|iY
operator|++
expr_stmt|;
comment|/* and next line */
block|}
comment|/* drop the temporary row-buffer */
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pRGBArow
argument_list|,
name|pData
operator|->
name|iRowsize
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
if|#
directive|if
name|defined
argument_list|(
name|MNG_FULL_CMS
argument_list|)
comment|/* cleanup cms stuff */
name|iRetcode
operator|=
name|mng_clear_cms
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
endif|#
directive|endif
block|}
name|pBuf
operator|->
name|bCorrected
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* let's not go through that again ! */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_COLORCORRECT_OBJECT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Animation-object routines                                              * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * these handle the animation objects used to re-run parts of a MNG.      * */
end_comment
begin_comment
comment|/* * eg. during LOOP or TERM processing                                     * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_add_ani_object
name|void
name|mng_add_ani_object
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_object_headerp
name|pObject
parameter_list|)
block|{
name|mng_object_headerp
name|pLast
init|=
operator|(
name|mng_object_headerp
operator|)
name|pData
operator|->
name|pLastaniobj
decl_stmt|;
if|if
condition|(
name|pLast
condition|)
comment|/* link it as last in the chain */
block|{
name|pObject
operator|->
name|pPrev
operator|=
name|pLast
expr_stmt|;
name|pLast
operator|->
name|pNext
operator|=
name|pObject
expr_stmt|;
block|}
else|else
block|{
name|pObject
operator|->
name|pPrev
operator|=
name|MNG_NULL
expr_stmt|;
comment|/* be on the safe side */
name|pData
operator|->
name|pFirstaniobj
operator|=
name|pObject
expr_stmt|;
block|}
name|pObject
operator|->
name|pNext
operator|=
name|MNG_NULL
expr_stmt|;
comment|/* be on the safe side */
name|pData
operator|->
name|pLastaniobj
operator|=
name|pObject
expr_stmt|;
comment|/* keep track for jumping */
name|pObject
operator|->
name|iFramenr
operator|=
name|pData
operator|->
name|iFrameseq
expr_stmt|;
name|pObject
operator|->
name|iLayernr
operator|=
name|pData
operator|->
name|iLayerseq
expr_stmt|;
name|pObject
operator|->
name|iPlaytime
operator|=
name|pData
operator|->
name|iFrametime
expr_stmt|;
comment|/* save restart object ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|bDisplaying
operator|)
operator|&&
operator|(
operator|!
name|pData
operator|->
name|bRunning
operator|)
operator|&&
operator|(
operator|!
name|pData
operator|->
name|pCurraniobj
operator|)
condition|)
name|pData
operator|->
name|pCurraniobj
operator|=
name|pObject
expr_stmt|;
return|return;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_create_ani_image
name|mng_retcode
name|mng_create_ani_image
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_ani_imagep
name|pImage
decl_stmt|;
name|mng_imagep
name|pCurrent
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_IMAGE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
name|pData
operator|->
name|bHasDHDR
condition|)
comment|/* processing delta-image ? */
name|pCurrent
operator|=
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pObjzero
expr_stmt|;
else|else
comment|/* get the current object */
endif|#
directive|endif
name|pCurrent
operator|=
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pCurrentobj
expr_stmt|;
if|if
condition|(
operator|!
name|pCurrent
condition|)
comment|/* otherwise object 0 */
name|pCurrent
operator|=
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pObjzero
expr_stmt|;
comment|/* now just clone the object !!! */
name|iRetcode
operator|=
name|mng_clone_imageobject
argument_list|(
name|pData
argument_list|,
literal|0
argument_list|,
name|MNG_FALSE
argument_list|,
name|pCurrent
operator|->
name|bVisible
argument_list|,
name|MNG_FALSE
argument_list|,
name|MNG_FALSE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|pCurrent
argument_list|,
operator|&
name|pImage
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
name|pImage
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_image
expr_stmt|;
name|pImage
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_image
expr_stmt|;
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pImage
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_IMAGE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
comment|/* okido */
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_free_ani_image
name|mng_retcode
name|mng_free_ani_image
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_imagep
name|pImage
init|=
operator|(
name|mng_ani_imagep
operator|)
name|pObject
decl_stmt|;
name|mng_imagedatap
name|pImgbuf
init|=
name|pImage
operator|->
name|pImgbuf
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_IMAGE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* unlink the image-data buffer */
name|iRetcode
operator|=
name|mng_free_imagedataobject
argument_list|(
name|pData
argument_list|,
name|pImgbuf
argument_list|)
expr_stmt|;
comment|/* drop its own buffer */
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pImage
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_image
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_IMAGE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_image
name|mng_retcode
name|mng_process_ani_image
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_retcode
name|iRetcode
init|=
name|MNG_NOERROR
decl_stmt|;
name|mng_ani_imagep
name|pImage
init|=
operator|(
name|mng_imagep
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_IMAGE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
name|pData
operator|->
name|bHasDHDR
condition|)
comment|/* processing delta-image ? */
block|{
name|mng_imagep
name|pDelta
init|=
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pDeltaImage
decl_stmt|;
if|if
condition|(
operator|!
name|pData
operator|->
name|iBreakpoint
condition|)
comment|/* only execute if not broken before */
block|{
comment|/* make sure to process pixels as well */
name|pData
operator|->
name|bDeltaimmediate
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* execute the delta process */
name|iRetcode
operator|=
name|mng_execute_delta_image
argument_list|(
name|pData
argument_list|,
name|pDelta
argument_list|,
operator|(
name|mng_imagep
operator|)
name|pObject
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
block|}
comment|/* now go and shoot it off (if required) */
if|if
condition|(
operator|(
name|pDelta
operator|->
name|bVisible
operator|)
operator|&&
operator|(
name|pDelta
operator|->
name|bViewable
operator|)
condition|)
name|iRetcode
operator|=
name|mng_display_image
argument_list|(
name|pData
argument_list|,
name|pDelta
argument_list|,
name|MNG_FALSE
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pData
operator|->
name|bTimerset
condition|)
name|pData
operator|->
name|bHasDHDR
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* this image signifies IEND !! */
block|}
elseif|else
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|pCurrentobj
condition|)
comment|/* active object ? */
block|{
name|mng_imagep
name|pCurrent
init|=
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pCurrentobj
decl_stmt|;
name|mng_imagedatap
name|pBuf
init|=
name|pCurrent
operator|->
name|pImgbuf
decl_stmt|;
if|if
condition|(
operator|!
name|pData
operator|->
name|iBreakpoint
condition|)
comment|/* don't copy it again ! */
block|{
if|if
condition|(
name|pBuf
operator|->
name|iImgdatasize
condition|)
comment|/* buffer present in active object ? */
comment|/* then drop it */
name|MNG_FREE
argument_list|(
name|pData
argument_list|,
name|pBuf
operator|->
name|pImgdata
argument_list|,
name|pBuf
operator|->
name|iImgdatasize
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
if|if
condition|(
name|pBuf
operator|->
name|iProfilesize
condition|)
comment|/* iCCP profile present ? */
comment|/* then drop it */
name|MNG_FREE
argument_list|(
name|pData
argument_list|,
name|pBuf
operator|->
name|pProfile
argument_list|,
name|pBuf
operator|->
name|iProfilesize
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* now blatently copy the animation buffer */
name|MNG_COPY
argument_list|(
name|pBuf
argument_list|,
name|pImage
operator|->
name|pImgbuf
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_imagedata
argument_list|)
argument_list|)
expr_stmt|;
comment|/* copy viewability */
name|pCurrent
operator|->
name|bViewable
operator|=
name|pImage
operator|->
name|bViewable
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|iImgdatasize
condition|)
comment|/* sample buffer present ? */
block|{
comment|/* then make a copy */
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pBuf
operator|->
name|pImgdata
argument_list|,
name|pBuf
operator|->
name|iImgdatasize
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pBuf
operator|->
name|pImgdata
argument_list|,
name|pImage
operator|->
name|pImgbuf
operator|->
name|pImgdata
argument_list|,
name|pBuf
operator|->
name|iImgdatasize
argument_list|)
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
if|if
condition|(
name|pBuf
operator|->
name|iProfilesize
condition|)
comment|/* iCCP profile present ? */
block|{
comment|/* then make a copy */
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pBuf
operator|->
name|pProfile
argument_list|,
name|pBuf
operator|->
name|iProfilesize
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pBuf
operator|->
name|pProfile
argument_list|,
name|pImage
operator|->
name|pImgbuf
operator|->
name|pProfile
argument_list|,
name|pBuf
operator|->
name|iProfilesize
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
block|}
comment|/* now go and shoot it off (if required) */
if|if
condition|(
operator|(
name|pCurrent
operator|->
name|bVisible
operator|)
operator|&&
operator|(
name|pCurrent
operator|->
name|bViewable
operator|)
condition|)
name|iRetcode
operator|=
name|mng_display_image
argument_list|(
name|pData
argument_list|,
name|pCurrent
argument_list|,
name|MNG_FALSE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|mng_imagep
name|pObjzero
init|=
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pObjzero
decl_stmt|;
name|mng_imagedatap
name|pBuf
init|=
name|pObjzero
operator|->
name|pImgbuf
decl_stmt|;
if|if
condition|(
operator|!
name|pData
operator|->
name|iBreakpoint
condition|)
comment|/* don't copy it again ! */
block|{
if|if
condition|(
name|pBuf
operator|->
name|iImgdatasize
condition|)
comment|/* buffer present in active object ? */
comment|/* then drop it */
name|MNG_FREE
argument_list|(
name|pData
argument_list|,
name|pBuf
operator|->
name|pImgdata
argument_list|,
name|pBuf
operator|->
name|iImgdatasize
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
if|if
condition|(
name|pBuf
operator|->
name|iProfilesize
condition|)
comment|/* iCCP profile present ? */
comment|/* then drop it */
name|MNG_FREE
argument_list|(
name|pData
argument_list|,
name|pBuf
operator|->
name|pProfile
argument_list|,
name|pBuf
operator|->
name|iProfilesize
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* now blatently copy the animation buffer */
name|MNG_COPY
argument_list|(
name|pBuf
argument_list|,
name|pImage
operator|->
name|pImgbuf
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_imagedata
argument_list|)
argument_list|)
expr_stmt|;
comment|/* copy viewability */
name|pObjzero
operator|->
name|bViewable
operator|=
name|pImage
operator|->
name|bViewable
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|iImgdatasize
condition|)
comment|/* sample buffer present ? */
block|{
comment|/* then make a copy */
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pBuf
operator|->
name|pImgdata
argument_list|,
name|pBuf
operator|->
name|iImgdatasize
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pBuf
operator|->
name|pImgdata
argument_list|,
name|pImage
operator|->
name|pImgbuf
operator|->
name|pImgdata
argument_list|,
name|pBuf
operator|->
name|iImgdatasize
argument_list|)
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
if|if
condition|(
name|pBuf
operator|->
name|iProfilesize
condition|)
comment|/* iCCP profile present ? */
block|{
comment|/* then make a copy */
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pBuf
operator|->
name|pProfile
argument_list|,
name|pBuf
operator|->
name|iProfilesize
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pBuf
operator|->
name|pProfile
argument_list|,
name|pImage
operator|->
name|pImgbuf
operator|->
name|pProfile
argument_list|,
name|pBuf
operator|->
name|iProfilesize
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
block|}
comment|/* now go and show it */
name|iRetcode
operator|=
name|mng_display_image
argument_list|(
name|pData
argument_list|,
name|pObjzero
argument_list|,
name|MNG_FALSE
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|iRetcode
condition|)
comment|/* all's well ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bTimerset
condition|)
comment|/* timer break ? */
name|pData
operator|->
name|iBreakpoint
operator|=
literal|99
expr_stmt|;
comment|/* fictive number; no more processing needed! */
else|else
name|pData
operator|->
name|iBreakpoint
operator|=
literal|0
expr_stmt|;
comment|/* else clear it */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_IMAGE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_plte
name|mng_retcode
name|mng_create_ani_plte
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint32
name|iEntrycount
argument_list|,
name|mng_palette8ep
name|paEntries
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_plte
argument_list|(
name|mng_datap
name|pData
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_pltep
name|pPLTE
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_PLTE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_plte
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_plte
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pPLTE
operator|=
operator|(
name|mng_ani_pltep
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pPLTE
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_plte
argument_list|)
argument_list|)
expr_stmt|;
name|pPLTE
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_plte
expr_stmt|;
name|pPLTE
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_plte
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pPLTE
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pPLTE
operator|->
name|iEntrycount
operator|=
name|iEntrycount
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pPLTE
operator|->
name|aEntries
argument_list|,
name|paEntries
argument_list|,
sizeof|sizeof
argument_list|(
name|pPLTE
operator|->
name|aEntries
argument_list|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|pPLTE
operator|->
name|iEntrycount
operator|=
name|pData
operator|->
name|iGlobalPLTEcount
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pPLTE
operator|->
name|aEntries
argument_list|,
name|pData
operator|->
name|aGlobalPLTEentries
argument_list|,
sizeof|sizeof
argument_list|(
name|pPLTE
operator|->
name|aEntries
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_PLTE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_plte
name|mng_retcode
name|mng_free_ani_plte
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_PLTE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_plte
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_PLTE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_plte
name|mng_retcode
name|mng_process_ani_plte
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_pltep
name|pPLTE
init|=
operator|(
name|mng_ani_pltep
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_PLTE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|bHasglobalPLTE
operator|=
name|MNG_TRUE
expr_stmt|;
name|pData
operator|->
name|iGlobalPLTEcount
operator|=
name|pPLTE
operator|->
name|iEntrycount
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pData
operator|->
name|aGlobalPLTEentries
argument_list|,
name|pPLTE
operator|->
name|aEntries
argument_list|,
sizeof|sizeof
argument_list|(
name|pPLTE
operator|->
name|aEntries
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_PLTE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_trns
name|mng_retcode
name|mng_create_ani_trns
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint32
name|iRawlen
argument_list|,
name|mng_uint8p
name|pRawdata
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_trns
argument_list|(
name|mng_datap
name|pData
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_trnsp
name|pTRNS
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_TRNS
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_trns
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_trns
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pTRNS
operator|=
operator|(
name|mng_ani_trnsp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pTRNS
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_trns
argument_list|)
argument_list|)
expr_stmt|;
name|pTRNS
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_trns
expr_stmt|;
name|pTRNS
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_trns
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pTRNS
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pTRNS
operator|->
name|iRawlen
operator|=
name|iRawlen
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pTRNS
operator|->
name|aRawdata
argument_list|,
name|pRawdata
argument_list|,
sizeof|sizeof
argument_list|(
name|pTRNS
operator|->
name|aRawdata
argument_list|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|pTRNS
operator|->
name|iRawlen
operator|=
name|pData
operator|->
name|iGlobalTRNSrawlen
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pTRNS
operator|->
name|aRawdata
argument_list|,
name|pData
operator|->
name|aGlobalTRNSrawdata
argument_list|,
sizeof|sizeof
argument_list|(
name|pTRNS
operator|->
name|aRawdata
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_TRNS
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_trns
name|mng_retcode
name|mng_free_ani_trns
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_TRNS
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_trns
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_TRNS
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_trns
name|mng_retcode
name|mng_process_ani_trns
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_trnsp
name|pTRNS
init|=
operator|(
name|mng_ani_trnsp
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_TRNS
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|bHasglobalTRNS
operator|=
name|MNG_TRUE
expr_stmt|;
name|pData
operator|->
name|iGlobalTRNSrawlen
operator|=
name|pTRNS
operator|->
name|iRawlen
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pData
operator|->
name|aGlobalTRNSrawdata
argument_list|,
name|pTRNS
operator|->
name|aRawdata
argument_list|,
sizeof|sizeof
argument_list|(
name|pTRNS
operator|->
name|aRawdata
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_TRNS
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_gAMA
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_gama
name|mng_retcode
name|mng_create_ani_gama
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_bool
name|bEmpty
argument_list|,
name|mng_uint32
name|iGamma
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_gama
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_chunkp
name|pChunk
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_gamap
name|pGAMA
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_GAMA
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_gama
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_gama
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pGAMA
operator|=
operator|(
name|mng_ani_gamap
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pGAMA
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_gama
argument_list|)
argument_list|)
expr_stmt|;
name|pGAMA
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_gama
expr_stmt|;
name|pGAMA
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_gama
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pGAMA
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pGAMA
operator|->
name|bEmpty
operator|=
name|bEmpty
expr_stmt|;
name|pGAMA
operator|->
name|iGamma
operator|=
name|iGamma
expr_stmt|;
else|#
directive|else
name|pGAMA
operator|->
name|bEmpty
operator|=
operator|(
operator|(
name|mng_gamap
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
expr_stmt|;
name|pGAMA
operator|->
name|iGamma
operator|=
operator|(
operator|(
name|mng_gamap
operator|)
name|pChunk
operator|)
operator|->
name|iGamma
expr_stmt|;
endif|#
directive|endif
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_GAMA
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_gama
name|mng_retcode
name|mng_free_ani_gama
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_GAMA
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_gama
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_GAMA
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_gama
name|mng_retcode
name|mng_process_ani_gama
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_gamap
name|pGAMA
init|=
operator|(
name|mng_ani_gamap
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_GAMA
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pGAMA
operator|->
name|bEmpty
condition|)
comment|/* empty chunk ? */
block|{
comment|/* clear global gAMA */
name|pData
operator|->
name|bHasglobalGAMA
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iGlobalGamma
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
comment|/* set global gAMA */
name|pData
operator|->
name|bHasglobalGAMA
operator|=
name|MNG_TRUE
expr_stmt|;
name|pData
operator|->
name|iGlobalGamma
operator|=
name|pGAMA
operator|->
name|iGamma
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_GAMA
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_cHRM
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_chrm
name|mng_retcode
name|mng_create_ani_chrm
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_bool
name|bEmpty
argument_list|,
name|mng_uint32
name|iWhitepointx
argument_list|,
name|mng_uint32
name|iWhitepointy
argument_list|,
name|mng_uint32
name|iRedx
argument_list|,
name|mng_uint32
name|iRedy
argument_list|,
name|mng_uint32
name|iGreenx
argument_list|,
name|mng_uint32
name|iGreeny
argument_list|,
name|mng_uint32
name|iBluex
argument_list|,
name|mng_uint32
name|iBluey
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_chrm
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_chunkp
name|pChunk
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_chrmp
name|pCHRM
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_CHRM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_chrm
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_chrm
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pCHRM
operator|=
operator|(
name|mng_ani_chrmp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pCHRM
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_chrm
argument_list|)
argument_list|)
expr_stmt|;
name|pCHRM
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_chrm
expr_stmt|;
name|pCHRM
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_chrm
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pCHRM
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pCHRM
operator|->
name|bEmpty
operator|=
name|bEmpty
expr_stmt|;
name|pCHRM
operator|->
name|iWhitepointx
operator|=
name|iWhitepointx
expr_stmt|;
name|pCHRM
operator|->
name|iWhitepointy
operator|=
name|iWhitepointy
expr_stmt|;
name|pCHRM
operator|->
name|iRedx
operator|=
name|iRedx
expr_stmt|;
name|pCHRM
operator|->
name|iRedy
operator|=
name|iRedy
expr_stmt|;
name|pCHRM
operator|->
name|iGreenx
operator|=
name|iGreenx
expr_stmt|;
name|pCHRM
operator|->
name|iGreeny
operator|=
name|iGreeny
expr_stmt|;
name|pCHRM
operator|->
name|iBluex
operator|=
name|iBluex
expr_stmt|;
name|pCHRM
operator|->
name|iBluey
operator|=
name|iBluey
expr_stmt|;
else|#
directive|else
name|pCHRM
operator|->
name|bEmpty
operator|=
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
expr_stmt|;
name|pCHRM
operator|->
name|iWhitepointx
operator|=
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|iWhitepointx
expr_stmt|;
name|pCHRM
operator|->
name|iWhitepointy
operator|=
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|iWhitepointy
expr_stmt|;
name|pCHRM
operator|->
name|iRedx
operator|=
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|iRedx
expr_stmt|;
name|pCHRM
operator|->
name|iRedy
operator|=
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|iRedy
expr_stmt|;
name|pCHRM
operator|->
name|iGreenx
operator|=
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|iGreenx
expr_stmt|;
name|pCHRM
operator|->
name|iGreeny
operator|=
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|iGreeny
expr_stmt|;
name|pCHRM
operator|->
name|iBluex
operator|=
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|iBluex
expr_stmt|;
name|pCHRM
operator|->
name|iBluey
operator|=
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|iBluey
expr_stmt|;
endif|#
directive|endif
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_CHRM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_chrm
name|mng_retcode
name|mng_free_ani_chrm
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_CHRM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_chrm
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_CHRM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_chrm
name|mng_retcode
name|mng_process_ani_chrm
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_chrmp
name|pCHRM
init|=
operator|(
name|mng_ani_chrmp
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_CHRM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pCHRM
operator|->
name|bEmpty
condition|)
comment|/* empty chunk ? */
block|{
comment|/* clear global cHRM */
name|pData
operator|->
name|bHasglobalCHRM
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iGlobalWhitepointx
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalWhitepointy
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimaryredx
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimaryredy
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimarygreenx
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimarygreeny
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimarybluex
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimarybluey
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
comment|/* set global cHRM */
name|pData
operator|->
name|bHasglobalCHRM
operator|=
name|MNG_TRUE
expr_stmt|;
name|pData
operator|->
name|iGlobalWhitepointx
operator|=
name|pCHRM
operator|->
name|iWhitepointx
expr_stmt|;
name|pData
operator|->
name|iGlobalWhitepointy
operator|=
name|pCHRM
operator|->
name|iWhitepointy
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimaryredx
operator|=
name|pCHRM
operator|->
name|iRedx
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimaryredy
operator|=
name|pCHRM
operator|->
name|iRedy
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimarygreenx
operator|=
name|pCHRM
operator|->
name|iGreenx
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimarygreeny
operator|=
name|pCHRM
operator|->
name|iGreeny
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimarybluex
operator|=
name|pCHRM
operator|->
name|iBluex
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimarybluey
operator|=
name|pCHRM
operator|->
name|iBluey
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_CHRM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_sRGB
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_srgb
name|mng_retcode
name|mng_create_ani_srgb
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_bool
name|bEmpty
argument_list|,
name|mng_uint8
name|iRenderingintent
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_srgb
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_chunkp
name|pChunk
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_srgbp
name|pSRGB
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_SRGB
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_srgb
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_srgb
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pSRGB
operator|=
operator|(
name|mng_ani_srgbp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pSRGB
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_srgb
argument_list|)
argument_list|)
expr_stmt|;
name|pSRGB
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_srgb
expr_stmt|;
name|pSRGB
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_srgb
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pSRGB
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pSRGB
operator|->
name|bEmpty
operator|=
name|bEmpty
expr_stmt|;
name|pSRGB
operator|->
name|iRenderingintent
operator|=
name|iRenderingintent
expr_stmt|;
else|#
directive|else
name|pSRGB
operator|->
name|bEmpty
operator|=
operator|(
operator|(
name|mng_srgbp
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
expr_stmt|;
name|pSRGB
operator|->
name|iRenderingintent
operator|=
operator|(
operator|(
name|mng_srgbp
operator|)
name|pChunk
operator|)
operator|->
name|iRenderingintent
expr_stmt|;
endif|#
directive|endif
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_SRGB
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_srgb
name|mng_retcode
name|mng_free_ani_srgb
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_SRGB
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_srgb
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_SRGB
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_srgb
name|mng_retcode
name|mng_process_ani_srgb
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_srgbp
name|pSRGB
init|=
operator|(
name|mng_ani_srgbp
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_SRGB
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pSRGB
operator|->
name|bEmpty
condition|)
comment|/* empty chunk ? */
block|{
comment|/* clear global sRGB */
name|pData
operator|->
name|bHasglobalSRGB
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iGlobalRendintent
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
comment|/* set global sRGB */
name|pData
operator|->
name|bHasglobalSRGB
operator|=
name|MNG_TRUE
expr_stmt|;
name|pData
operator|->
name|iGlobalRendintent
operator|=
name|pSRGB
operator|->
name|iRenderingintent
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_SRGB
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_iccp
name|mng_retcode
name|mng_create_ani_iccp
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_bool
name|bEmpty
argument_list|,
name|mng_uint32
name|iProfilesize
argument_list|,
name|mng_ptr
name|pProfile
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_iccp
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_chunkp
name|pChunk
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_iccpp
name|pICCP
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_ICCP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_iccp
argument_list|)
argument_list|,
name|mng_free_ani_iccp
argument_list|,
name|mng_process_ani_iccp
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pICCP
operator|=
operator|(
name|mng_ani_iccpp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pICCP
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_iccp
argument_list|)
argument_list|)
expr_stmt|;
name|pICCP
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_iccp
expr_stmt|;
name|pICCP
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_iccp
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pICCP
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pICCP
operator|->
name|bEmpty
operator|=
name|bEmpty
expr_stmt|;
name|pICCP
operator|->
name|iProfilesize
operator|=
name|iProfilesize
expr_stmt|;
if|if
condition|(
name|iProfilesize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pICCP
operator|->
name|pProfile
argument_list|,
name|iProfilesize
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pICCP
operator|->
name|pProfile
argument_list|,
name|pProfile
argument_list|,
name|iProfilesize
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|pICCP
operator|->
name|bEmpty
operator|=
operator|(
operator|(
name|mng_iccpp
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
expr_stmt|;
name|pICCP
operator|->
name|iProfilesize
operator|=
operator|(
operator|(
name|mng_iccpp
operator|)
name|pChunk
operator|)
operator|->
name|iProfilesize
expr_stmt|;
if|if
condition|(
name|pICCP
operator|->
name|iProfilesize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pICCP
operator|->
name|pProfile
argument_list|,
name|pICCP
operator|->
name|iProfilesize
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pICCP
operator|->
name|pProfile
argument_list|,
operator|(
operator|(
name|mng_iccpp
operator|)
name|pChunk
operator|)
operator|->
name|pProfile
argument_list|,
name|pICCP
operator|->
name|iProfilesize
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_ICCP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_free_ani_iccp
name|mng_retcode
name|mng_free_ani_iccp
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_iccpp
name|pICCP
init|=
operator|(
name|mng_ani_iccpp
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_ICCP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pICCP
operator|->
name|iProfilesize
condition|)
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pICCP
operator|->
name|pProfile
argument_list|,
name|pICCP
operator|->
name|iProfilesize
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_iccp
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_ICCP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
return|return
name|MNG_NOERROR
return|;
else|#
directive|else
return|return
name|mng_free_obj_general
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|)
return|;
endif|#
directive|endif
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_iccp
name|mng_retcode
name|mng_process_ani_iccp
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_iccpp
name|pICCP
init|=
operator|(
name|mng_ani_iccpp
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_ICCP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pICCP
operator|->
name|bEmpty
condition|)
comment|/* empty chunk ? */
block|{
comment|/* clear global iCCP */
name|pData
operator|->
name|bHasglobalICCP
operator|=
name|MNG_FALSE
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|iGlobalProfilesize
condition|)
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pGlobalProfile
argument_list|,
name|pData
operator|->
name|iGlobalProfilesize
argument_list|)
expr_stmt|;
name|pData
operator|->
name|iGlobalProfilesize
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|pGlobalProfile
operator|=
name|MNG_NULL
expr_stmt|;
block|}
else|else
block|{
comment|/* set global iCCP */
name|pData
operator|->
name|bHasglobalICCP
operator|=
name|MNG_TRUE
expr_stmt|;
name|pData
operator|->
name|iGlobalProfilesize
operator|=
name|pICCP
operator|->
name|iProfilesize
expr_stmt|;
if|if
condition|(
name|pICCP
operator|->
name|iProfilesize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pGlobalProfile
argument_list|,
name|pICCP
operator|->
name|iProfilesize
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pData
operator|->
name|pGlobalProfile
argument_list|,
name|pICCP
operator|->
name|pProfile
argument_list|,
name|pICCP
operator|->
name|iProfilesize
argument_list|)
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_ICCP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_bKGD
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_bkgd
name|mng_retcode
name|mng_create_ani_bkgd
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint16
name|iRed
argument_list|,
name|mng_uint16
name|iGreen
argument_list|,
name|mng_uint16
name|iBlue
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_bkgd
argument_list|(
name|mng_datap
name|pData
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_bkgdp
name|pBKGD
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_BKGD
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_bkgd
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_bkgd
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pBKGD
operator|=
operator|(
name|mng_ani_bkgdp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pBKGD
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_bkgd
argument_list|)
argument_list|)
expr_stmt|;
name|pBKGD
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_bkgd
expr_stmt|;
name|pBKGD
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_bkgd
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pBKGD
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pBKGD
operator|->
name|iRed
operator|=
name|iRed
expr_stmt|;
name|pBKGD
operator|->
name|iGreen
operator|=
name|iGreen
expr_stmt|;
name|pBKGD
operator|->
name|iBlue
operator|=
name|iBlue
expr_stmt|;
else|#
directive|else
name|pBKGD
operator|->
name|iRed
operator|=
name|pData
operator|->
name|iGlobalBKGDred
expr_stmt|;
name|pBKGD
operator|->
name|iGreen
operator|=
name|pData
operator|->
name|iGlobalBKGDgreen
expr_stmt|;
name|pBKGD
operator|->
name|iBlue
operator|=
name|pData
operator|->
name|iGlobalBKGDblue
expr_stmt|;
endif|#
directive|endif
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_BKGD
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_bkgd
name|mng_retcode
name|mng_free_ani_bkgd
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_BKGD
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_bkgd
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_BKGD
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_bkgd
name|mng_retcode
name|mng_process_ani_bkgd
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_bkgdp
name|pBKGD
init|=
operator|(
name|mng_ani_bkgdp
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_BKGD
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|bHasglobalBKGD
operator|=
name|MNG_TRUE
expr_stmt|;
name|pData
operator|->
name|iGlobalBKGDred
operator|=
name|pBKGD
operator|->
name|iRed
expr_stmt|;
name|pData
operator|->
name|iGlobalBKGDgreen
operator|=
name|pBKGD
operator|->
name|iGreen
expr_stmt|;
name|pData
operator|->
name|iGlobalBKGDblue
operator|=
name|pBKGD
operator|->
name|iBlue
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_BKGD
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_LOOP
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_loop
name|mng_retcode
name|mng_create_ani_loop
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint8
name|iLevel
argument_list|,
name|mng_uint32
name|iRepeatcount
argument_list|,
name|mng_uint8
name|iTermcond
argument_list|,
name|mng_uint32
name|iItermin
argument_list|,
name|mng_uint32
name|iItermax
argument_list|,
name|mng_uint32
name|iCount
argument_list|,
name|mng_uint32p
name|pSignals
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_loop
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_chunkp
name|pChunk
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_loopp
name|pLOOP
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_LOOP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_loop
argument_list|)
argument_list|,
name|mng_free_ani_loop
argument_list|,
name|mng_process_ani_loop
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pLOOP
operator|=
operator|(
name|mng_ani_loopp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pLOOP
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_loop
argument_list|)
argument_list|)
expr_stmt|;
name|pLOOP
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_loop
expr_stmt|;
name|pLOOP
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_loop
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pLOOP
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pLOOP
operator|->
name|iLevel
operator|=
name|iLevel
expr_stmt|;
name|pLOOP
operator|->
name|iRepeatcount
operator|=
name|iRepeatcount
expr_stmt|;
name|pLOOP
operator|->
name|iTermcond
operator|=
name|iTermcond
expr_stmt|;
name|pLOOP
operator|->
name|iItermin
operator|=
name|iItermin
expr_stmt|;
name|pLOOP
operator|->
name|iItermax
operator|=
name|iItermax
expr_stmt|;
name|pLOOP
operator|->
name|iCount
operator|=
name|iCount
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_LOOP_SIGNALS_SUPPORTED
if|if
condition|(
name|iCount
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pLOOP
operator|->
name|pSignals
argument_list|,
operator|(
name|iCount
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pLOOP
operator|->
name|pSignals
argument_list|,
name|pSignals
argument_list|,
operator|(
name|iCount
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
else|#
directive|else
comment|/* MNG_OPTIMIZE_CHUNKREADER */
name|pLOOP
operator|->
name|iLevel
operator|=
operator|(
operator|(
name|mng_loopp
operator|)
name|pChunk
operator|)
operator|->
name|iLevel
expr_stmt|;
name|pLOOP
operator|->
name|iRepeatcount
operator|=
operator|(
operator|(
name|mng_loopp
operator|)
name|pChunk
operator|)
operator|->
name|iRepeat
expr_stmt|;
name|pLOOP
operator|->
name|iTermcond
operator|=
operator|(
operator|(
name|mng_loopp
operator|)
name|pChunk
operator|)
operator|->
name|iTermination
expr_stmt|;
name|pLOOP
operator|->
name|iItermin
operator|=
operator|(
operator|(
name|mng_loopp
operator|)
name|pChunk
operator|)
operator|->
name|iItermin
expr_stmt|;
name|pLOOP
operator|->
name|iItermax
operator|=
operator|(
operator|(
name|mng_loopp
operator|)
name|pChunk
operator|)
operator|->
name|iItermax
expr_stmt|;
name|pLOOP
operator|->
name|iCount
operator|=
operator|(
operator|(
name|mng_loopp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_LOOP_SIGNALS_SUPPORTED
if|if
condition|(
name|pLOOP
operator|->
name|iCount
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pLOOP
operator|->
name|pSignals
argument_list|,
operator|(
name|pLOOP
operator|->
name|iCount
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pLOOP
operator|->
name|pSignals
argument_list|,
operator|(
operator|(
name|mng_loopp
operator|)
name|pChunk
operator|)
operator|->
name|pSignals
argument_list|,
operator|(
name|pLOOP
operator|->
name|iCount
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
endif|#
directive|endif
comment|/* MNG_OPTIMIZE_CHUNKREADER */
comment|/* running counter starts with repeat_count */
name|pLOOP
operator|->
name|iRunningcount
operator|=
name|pLOOP
operator|->
name|iRepeatcount
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_LOOP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_free_ani_loop
name|mng_retcode
name|mng_free_ani_loop
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifndef|#
directive|ifndef
name|MNG_NO_LOOP_SIGNALS_SUPPORTED
name|mng_ani_loopp
name|pLOOP
init|=
operator|(
name|mng_ani_loopp
operator|)
name|pObject
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_LOOP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_NO_LOOP_SIGNALS_SUPPORTED
if|if
condition|(
name|pLOOP
operator|->
name|iCount
condition|)
comment|/* drop signal buffer ? */
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pLOOP
operator|->
name|pSignals
argument_list|,
operator|(
name|pLOOP
operator|->
name|iCount
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_loop
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_LOOP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
return|return
name|MNG_NOERROR
return|;
else|#
directive|else
return|return
name|mng_free_obj_general
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|)
return|;
endif|#
directive|endif
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_loop
name|mng_retcode
name|mng_process_ani_loop
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_loopp
name|pLOOP
init|=
operator|(
name|mng_ani_loopp
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_LOOP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* just reset the running counter */
name|pLOOP
operator|->
name|iRunningcount
operator|=
name|pLOOP
operator|->
name|iRepeatcount
expr_stmt|;
comment|/* iteration=0 means we're skipping ! */
if|if
condition|(
operator|(
operator|!
name|pData
operator|->
name|bSkipping
operator|)
operator|&&
operator|(
name|pLOOP
operator|->
name|iRepeatcount
operator|==
literal|0
operator|)
condition|)
name|pData
operator|->
name|bSkipping
operator|=
name|MNG_TRUE
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_LOOP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_create_ani_endl
name|mng_retcode
name|mng_create_ani_endl
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint8
name|iLevel
parameter_list|)
block|{
name|mng_ani_endlp
name|pENDL
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_ENDL
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_endl
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_endl
argument_list|,
operator|&
name|pTemp
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pENDL
operator|=
operator|(
name|mng_ani_endlp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pENDL
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_endl
argument_list|)
argument_list|)
expr_stmt|;
name|pENDL
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_endl
expr_stmt|;
name|pENDL
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_endl
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pENDL
argument_list|)
expr_stmt|;
name|pENDL
operator|->
name|iLevel
operator|=
name|iLevel
expr_stmt|;
name|iRetcode
operator|=
name|mng_process_ani_endl
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_objectp
operator|)
name|pENDL
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_ENDL
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_endl
name|mng_retcode
name|mng_free_ani_endl
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_ENDL
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_endl
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_ENDL
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_endl
name|mng_retcode
name|mng_process_ani_endl
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_endlp
name|pENDL
init|=
operator|(
name|mng_ani_endlp
operator|)
name|pObject
decl_stmt|;
name|mng_ani_loopp
name|pLOOP
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_ENDL
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|(
operator|(
name|pData
operator|->
name|bDisplaying
operator|)
operator|&&
operator|(
operator|(
name|pData
operator|->
name|bRunning
operator|)
operator|||
operator|(
name|pData
operator|->
name|bSearching
operator|)
operator|)
operator|)
operator|||
operator|(
name|pData
operator|->
name|bReading
operator|)
condition|)
block|{
name|pLOOP
operator|=
name|pENDL
operator|->
name|pLOOP
expr_stmt|;
comment|/* determine matching LOOP */
if|if
condition|(
operator|!
name|pLOOP
condition|)
comment|/* haven't got it yet ? */
block|{
comment|/* go and look back in the list */
name|pLOOP
operator|=
operator|(
name|mng_ani_loopp
operator|)
name|pENDL
operator|->
name|sHeader
operator|.
name|pPrev
expr_stmt|;
while|while
condition|(
operator|(
name|pLOOP
operator|)
operator|&&
operator|(
operator|(
name|pLOOP
operator|->
name|sHeader
operator|.
name|fCleanup
operator|!=
name|mng_free_ani_loop
operator|)
operator|||
operator|(
name|pLOOP
operator|->
name|iLevel
operator|!=
name|pENDL
operator|->
name|iLevel
operator|)
operator|)
condition|)
name|pLOOP
operator|=
name|pLOOP
operator|->
name|sHeader
operator|.
name|pPrev
expr_stmt|;
block|}
comment|/* got it now ? */
if|if
condition|(
operator|(
name|pLOOP
operator|)
operator|&&
operator|(
name|pLOOP
operator|->
name|iLevel
operator|==
name|pENDL
operator|->
name|iLevel
operator|)
condition|)
block|{
name|pENDL
operator|->
name|pLOOP
operator|=
name|pLOOP
expr_stmt|;
comment|/* save for next time ! */
comment|/* decrease running counter ? */
if|if
condition|(
operator|(
name|pLOOP
operator|->
name|iRunningcount
operator|)
operator|&&
operator|(
name|pLOOP
operator|->
name|iRunningcount
operator|<
literal|0x7fffffffL
operator|)
condition|)
name|pLOOP
operator|->
name|iRunningcount
operator|--
expr_stmt|;
if|if
condition|(
operator|(
operator|!
name|pData
operator|->
name|bDisplaying
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bReading
operator|)
operator|&&
operator|(
name|pLOOP
operator|->
name|iRunningcount
operator|>=
literal|0x7fffffffL
operator|)
condition|)
block|{
name|pData
operator|->
name|iTotalframes
operator|=
literal|0x7fffffffL
expr_stmt|;
name|pData
operator|->
name|iTotallayers
operator|=
literal|0x7fffffffL
expr_stmt|;
name|pData
operator|->
name|iTotalplaytime
operator|=
literal|0x7fffffffL
expr_stmt|;
block|}
else|else
block|{
comment|/* TODO: we're cheating out on the termination_condition,            iteration_min, iteration_max and possible signals;            the code is just not ready for that can of worms.... */
if|if
condition|(
operator|!
name|pLOOP
operator|->
name|iRunningcount
condition|)
comment|/* reached zero ? */
block|{
comment|/* was this the outer LOOP ? */
if|if
condition|(
name|pData
operator|->
name|pFirstaniobj
operator|==
operator|(
name|mng_objectp
operator|)
name|pLOOP
condition|)
comment|/* TODO: THIS IS WRONG!! */
name|pData
operator|->
name|bHasLOOP
operator|=
name|MNG_FALSE
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|pCurraniobj
condition|)
comment|/* was we processing objects ? */
name|pData
operator|->
name|pCurraniobj
operator|=
name|pLOOP
expr_stmt|;
comment|/* then restart with LOOP */
else|else
comment|/* else restart behind LOOP !!! */
name|pData
operator|->
name|pCurraniobj
operator|=
name|pLOOP
operator|->
name|sHeader
operator|.
name|pNext
expr_stmt|;
block|}
block|}
comment|/* does this match a 'skipping' LOOP? */
if|if
condition|(
operator|(
name|pData
operator|->
name|bSkipping
operator|)
operator|&&
operator|(
name|pLOOP
operator|->
name|iRepeatcount
operator|==
literal|0
operator|)
condition|)
name|pData
operator|->
name|bSkipping
operator|=
name|MNG_FALSE
expr_stmt|;
block|}
else|else
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_NOMATCHINGLOOP
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_ENDL
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_DEFI
end_ifndef
begin_function
DECL|function|mng_create_ani_defi
name|mng_retcode
name|mng_create_ani_defi
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_ani_defip
name|pDEFI
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_DEFI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_defi
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_defi
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pDEFI
operator|=
operator|(
name|mng_ani_defip
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pDEFI
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_defi
argument_list|)
argument_list|)
expr_stmt|;
name|pDEFI
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_defi
expr_stmt|;
name|pDEFI
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_defi
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pDEFI
argument_list|)
expr_stmt|;
name|pDEFI
operator|->
name|iId
operator|=
name|pData
operator|->
name|iDEFIobjectid
expr_stmt|;
name|pDEFI
operator|->
name|bHasdonotshow
operator|=
name|pData
operator|->
name|bDEFIhasdonotshow
expr_stmt|;
name|pDEFI
operator|->
name|iDonotshow
operator|=
name|pData
operator|->
name|iDEFIdonotshow
expr_stmt|;
name|pDEFI
operator|->
name|bHasconcrete
operator|=
name|pData
operator|->
name|bDEFIhasconcrete
expr_stmt|;
name|pDEFI
operator|->
name|iConcrete
operator|=
name|pData
operator|->
name|iDEFIconcrete
expr_stmt|;
name|pDEFI
operator|->
name|bHasloca
operator|=
name|pData
operator|->
name|bDEFIhasloca
expr_stmt|;
name|pDEFI
operator|->
name|iLocax
operator|=
name|pData
operator|->
name|iDEFIlocax
expr_stmt|;
name|pDEFI
operator|->
name|iLocay
operator|=
name|pData
operator|->
name|iDEFIlocay
expr_stmt|;
name|pDEFI
operator|->
name|bHasclip
operator|=
name|pData
operator|->
name|bDEFIhasclip
expr_stmt|;
name|pDEFI
operator|->
name|iClipl
operator|=
name|pData
operator|->
name|iDEFIclipl
expr_stmt|;
name|pDEFI
operator|->
name|iClipr
operator|=
name|pData
operator|->
name|iDEFIclipr
expr_stmt|;
name|pDEFI
operator|->
name|iClipt
operator|=
name|pData
operator|->
name|iDEFIclipt
expr_stmt|;
name|pDEFI
operator|->
name|iClipb
operator|=
name|pData
operator|->
name|iDEFIclipb
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_DEFI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_defi
name|mng_retcode
name|mng_free_ani_defi
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_DEFI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_defi
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_DEFI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_defi
name|mng_retcode
name|mng_process_ani_defi
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_defip
name|pDEFI
init|=
operator|(
name|mng_ani_defip
operator|)
name|pObject
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_DEFI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iDEFIobjectid
operator|=
name|pDEFI
operator|->
name|iId
expr_stmt|;
name|pData
operator|->
name|bDEFIhasdonotshow
operator|=
name|pDEFI
operator|->
name|bHasdonotshow
expr_stmt|;
name|pData
operator|->
name|iDEFIdonotshow
operator|=
name|pDEFI
operator|->
name|iDonotshow
expr_stmt|;
name|pData
operator|->
name|bDEFIhasconcrete
operator|=
name|pDEFI
operator|->
name|bHasconcrete
expr_stmt|;
name|pData
operator|->
name|iDEFIconcrete
operator|=
name|pDEFI
operator|->
name|iConcrete
expr_stmt|;
name|pData
operator|->
name|bDEFIhasloca
operator|=
name|pDEFI
operator|->
name|bHasloca
expr_stmt|;
name|pData
operator|->
name|iDEFIlocax
operator|=
name|pDEFI
operator|->
name|iLocax
expr_stmt|;
name|pData
operator|->
name|iDEFIlocay
operator|=
name|pDEFI
operator|->
name|iLocay
expr_stmt|;
name|pData
operator|->
name|bDEFIhasclip
operator|=
name|pDEFI
operator|->
name|bHasclip
expr_stmt|;
name|pData
operator|->
name|iDEFIclipl
operator|=
name|pDEFI
operator|->
name|iClipl
expr_stmt|;
name|pData
operator|->
name|iDEFIclipr
operator|=
name|pDEFI
operator|->
name|iClipr
expr_stmt|;
name|pData
operator|->
name|iDEFIclipt
operator|=
name|pDEFI
operator|->
name|iClipt
expr_stmt|;
name|pData
operator|->
name|iDEFIclipb
operator|=
name|pDEFI
operator|->
name|iClipb
expr_stmt|;
name|iRetcode
operator|=
name|mng_process_display_defi
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_DEFI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_BASI
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_basi
name|mng_retcode
name|mng_create_ani_basi
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint16
name|iRed
argument_list|,
name|mng_uint16
name|iGreen
argument_list|,
name|mng_uint16
name|iBlue
argument_list|,
name|mng_bool
name|bHasalpha
argument_list|,
name|mng_uint16
name|iAlpha
argument_list|,
name|mng_uint8
name|iViewable
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_basi
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_chunkp
name|pChunk
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_basip
name|pBASI
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_BASI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_basi
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_basi
argument_list|,
operator|&
name|pTemp
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pBASI
operator|=
operator|(
name|mng_ani_basip
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pBASI
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_basi
argument_list|)
argument_list|)
expr_stmt|;
name|pBASI
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_basi
expr_stmt|;
name|pBASI
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_basi
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pBASI
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pBASI
operator|->
name|iRed
operator|=
name|iRed
expr_stmt|;
name|pBASI
operator|->
name|iGreen
operator|=
name|iGreen
expr_stmt|;
name|pBASI
operator|->
name|iBlue
operator|=
name|iBlue
expr_stmt|;
name|pBASI
operator|->
name|bHasalpha
operator|=
name|bHasalpha
expr_stmt|;
name|pBASI
operator|->
name|iAlpha
operator|=
name|iAlpha
expr_stmt|;
name|pBASI
operator|->
name|iViewable
operator|=
name|iViewable
expr_stmt|;
else|#
directive|else
name|pBASI
operator|->
name|iRed
operator|=
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iRed
expr_stmt|;
name|pBASI
operator|->
name|iGreen
operator|=
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iGreen
expr_stmt|;
name|pBASI
operator|->
name|iBlue
operator|=
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iBlue
expr_stmt|;
name|pBASI
operator|->
name|bHasalpha
operator|=
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|bHasalpha
expr_stmt|;
name|pBASI
operator|->
name|iAlpha
operator|=
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iAlpha
expr_stmt|;
name|pBASI
operator|->
name|iViewable
operator|=
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iViewable
expr_stmt|;
endif|#
directive|endif
block|}
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|iRetcode
operator|=
name|mng_process_display_basi
argument_list|(
name|pData
argument_list|,
name|iRed
argument_list|,
name|iGreen
argument_list|,
name|iBlue
argument_list|,
name|bHasalpha
argument_list|,
name|iAlpha
argument_list|,
name|iViewable
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_process_display_basi
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iRed
argument_list|,
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iGreen
argument_list|,
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iBlue
argument_list|,
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|bHasalpha
argument_list|,
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iAlpha
argument_list|,
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iViewable
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pData
operator|->
name|iBASIred
operator|=
name|iRed
expr_stmt|;
name|pData
operator|->
name|iBASIgreen
operator|=
name|iGreen
expr_stmt|;
name|pData
operator|->
name|iBASIblue
operator|=
name|iBlue
expr_stmt|;
name|pData
operator|->
name|bBASIhasalpha
operator|=
name|bHasalpha
expr_stmt|;
name|pData
operator|->
name|iBASIalpha
operator|=
name|iAlpha
expr_stmt|;
name|pData
operator|->
name|iBASIviewable
operator|=
name|iViewable
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iBASIred
operator|=
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iRed
expr_stmt|;
name|pData
operator|->
name|iBASIgreen
operator|=
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iGreen
expr_stmt|;
name|pData
operator|->
name|iBASIblue
operator|=
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iBlue
expr_stmt|;
name|pData
operator|->
name|bBASIhasalpha
operator|=
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|bHasalpha
expr_stmt|;
name|pData
operator|->
name|iBASIalpha
operator|=
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iAlpha
expr_stmt|;
name|pData
operator|->
name|iBASIviewable
operator|=
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iViewable
expr_stmt|;
endif|#
directive|endif
name|iRetcode
operator|=
name|mng_process_display_basi
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_BASI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_basi
name|mng_retcode
name|mng_free_ani_basi
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_BASI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_basi
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_BASI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_basi
name|mng_retcode
name|mng_process_ani_basi
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_basip
name|pBASI
init|=
operator|(
name|mng_ani_basip
operator|)
name|pObject
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_BASI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
name|iRetcode
operator|=
name|mng_process_display_basi
argument_list|(
name|pData
argument_list|,
name|pBASI
operator|->
name|iRed
argument_list|,
name|pBASI
operator|->
name|iGreen
argument_list|,
name|pBASI
operator|->
name|iBlue
argument_list|,
name|pBASI
operator|->
name|bHasalpha
argument_list|,
name|pBASI
operator|->
name|iAlpha
argument_list|,
name|pBASI
operator|->
name|iViewable
argument_list|)
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iBASIred
operator|=
name|pBASI
operator|->
name|iRed
expr_stmt|;
name|pData
operator|->
name|iBASIgreen
operator|=
name|pBASI
operator|->
name|iGreen
expr_stmt|;
name|pData
operator|->
name|iBASIblue
operator|=
name|pBASI
operator|->
name|iBlue
expr_stmt|;
name|pData
operator|->
name|bBASIhasalpha
operator|=
name|pBASI
operator|->
name|bHasalpha
expr_stmt|;
name|pData
operator|->
name|iBASIalpha
operator|=
name|pBASI
operator|->
name|iAlpha
expr_stmt|;
name|pData
operator|->
name|iBASIviewable
operator|=
name|pBASI
operator|->
name|iViewable
expr_stmt|;
name|iRetcode
operator|=
name|mng_process_display_basi
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_BASI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_CLON
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_clon
name|mng_retcode
name|mng_create_ani_clon
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint16
name|iSourceid
argument_list|,
name|mng_uint16
name|iCloneid
argument_list|,
name|mng_uint8
name|iClonetype
argument_list|,
name|mng_bool
name|bHasdonotshow
argument_list|,
name|mng_uint8
name|iDonotshow
argument_list|,
name|mng_uint8
name|iConcrete
argument_list|,
name|mng_bool
name|bHasloca
argument_list|,
name|mng_uint8
name|iLocatype
argument_list|,
name|mng_int32
name|iLocax
argument_list|,
name|mng_int32
name|iLocay
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_clon
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_chunkp
name|pChunk
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_clonp
name|pCLON
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_CLON
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_clon
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_clon
argument_list|,
operator|&
name|pTemp
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pCLON
operator|=
operator|(
name|mng_ani_clonp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pCLON
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_clon
argument_list|)
argument_list|)
expr_stmt|;
name|pCLON
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_clon
expr_stmt|;
name|pCLON
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_clon
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pCLON
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pCLON
operator|->
name|iSourceid
operator|=
name|iSourceid
expr_stmt|;
name|pCLON
operator|->
name|iCloneid
operator|=
name|iCloneid
expr_stmt|;
name|pCLON
operator|->
name|iClonetype
operator|=
name|iClonetype
expr_stmt|;
name|pCLON
operator|->
name|bHasdonotshow
operator|=
name|bHasdonotshow
expr_stmt|;
name|pCLON
operator|->
name|iDonotshow
operator|=
name|iDonotshow
expr_stmt|;
name|pCLON
operator|->
name|iConcrete
operator|=
name|iConcrete
expr_stmt|;
name|pCLON
operator|->
name|bHasloca
operator|=
name|bHasloca
expr_stmt|;
name|pCLON
operator|->
name|iLocatype
operator|=
name|iLocatype
expr_stmt|;
name|pCLON
operator|->
name|iLocax
operator|=
name|iLocax
expr_stmt|;
name|pCLON
operator|->
name|iLocay
operator|=
name|iLocay
expr_stmt|;
else|#
directive|else
name|pCLON
operator|->
name|iSourceid
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iSourceid
expr_stmt|;
name|pCLON
operator|->
name|iCloneid
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iCloneid
expr_stmt|;
name|pCLON
operator|->
name|iClonetype
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iClonetype
expr_stmt|;
name|pCLON
operator|->
name|bHasdonotshow
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|bHasdonotshow
expr_stmt|;
name|pCLON
operator|->
name|iDonotshow
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iDonotshow
expr_stmt|;
name|pCLON
operator|->
name|iConcrete
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iConcrete
expr_stmt|;
name|pCLON
operator|->
name|bHasloca
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|bHasloca
expr_stmt|;
name|pCLON
operator|->
name|iLocatype
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iLocationtype
expr_stmt|;
name|pCLON
operator|->
name|iLocax
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iLocationx
expr_stmt|;
name|pCLON
operator|->
name|iLocay
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iLocationy
expr_stmt|;
endif|#
directive|endif
block|}
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|iRetcode
operator|=
name|mng_process_display_clon
argument_list|(
name|pData
argument_list|,
name|iSourceid
argument_list|,
name|iCloneid
argument_list|,
name|iClonetype
argument_list|,
name|bHasdonotshow
argument_list|,
name|iDonotshow
argument_list|,
name|iConcrete
argument_list|,
name|bHasloca
argument_list|,
name|iLocatype
argument_list|,
name|iLocax
argument_list|,
name|iLocay
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_process_display_clon
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iSourceid
argument_list|,
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iCloneid
argument_list|,
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iClonetype
argument_list|,
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|bHasdonotshow
argument_list|,
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iDonotshow
argument_list|,
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iConcrete
argument_list|,
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|bHasloca
argument_list|,
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iLocationtype
argument_list|,
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iLocationx
argument_list|,
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iLocationy
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pData
operator|->
name|iCLONsourceid
operator|=
name|iSourceid
expr_stmt|;
name|pData
operator|->
name|iCLONcloneid
operator|=
name|iCloneid
expr_stmt|;
name|pData
operator|->
name|iCLONclonetype
operator|=
name|iClonetype
expr_stmt|;
name|pData
operator|->
name|bCLONhasdonotshow
operator|=
name|bHasdonotshow
expr_stmt|;
name|pData
operator|->
name|iCLONdonotshow
operator|=
name|iDonotshow
expr_stmt|;
name|pData
operator|->
name|iCLONconcrete
operator|=
name|iConcrete
expr_stmt|;
name|pData
operator|->
name|bCLONhasloca
operator|=
name|bHasloca
expr_stmt|;
name|pData
operator|->
name|iCLONlocationtype
operator|=
name|iLocatype
expr_stmt|;
name|pData
operator|->
name|iCLONlocationx
operator|=
name|iLocax
expr_stmt|;
name|pData
operator|->
name|iCLONlocationy
operator|=
name|iLocay
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iCLONsourceid
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iSourceid
expr_stmt|;
name|pData
operator|->
name|iCLONcloneid
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iCloneid
expr_stmt|;
name|pData
operator|->
name|iCLONclonetype
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iClonetype
expr_stmt|;
name|pData
operator|->
name|bCLONhasdonotshow
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|bHasdonotshow
expr_stmt|;
name|pData
operator|->
name|iCLONdonotshow
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iDonotshow
expr_stmt|;
name|pData
operator|->
name|iCLONconcrete
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iConcrete
expr_stmt|;
name|pData
operator|->
name|bCLONhasloca
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|bHasloca
expr_stmt|;
name|pData
operator|->
name|iCLONlocationtype
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iLocationtype
expr_stmt|;
name|pData
operator|->
name|iCLONlocationx
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iLocationx
expr_stmt|;
name|pData
operator|->
name|iCLONlocationy
operator|=
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iLocationy
expr_stmt|;
endif|#
directive|endif
name|iRetcode
operator|=
name|mng_process_display_clon
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_CLON
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_clon
name|mng_retcode
name|mng_free_ani_clon
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_CLON
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_clon
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_CLON
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_clon
name|mng_retcode
name|mng_process_ani_clon
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_clonp
name|pCLON
init|=
operator|(
name|mng_ani_clonp
operator|)
name|pObject
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_CLON
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
name|iRetcode
operator|=
name|mng_process_display_clon
argument_list|(
name|pData
argument_list|,
name|pCLON
operator|->
name|iSourceid
argument_list|,
name|pCLON
operator|->
name|iCloneid
argument_list|,
name|pCLON
operator|->
name|iClonetype
argument_list|,
name|pCLON
operator|->
name|bHasdonotshow
argument_list|,
name|pCLON
operator|->
name|iDonotshow
argument_list|,
name|pCLON
operator|->
name|iConcrete
argument_list|,
name|pCLON
operator|->
name|bHasloca
argument_list|,
name|pCLON
operator|->
name|iLocatype
argument_list|,
name|pCLON
operator|->
name|iLocax
argument_list|,
name|pCLON
operator|->
name|iLocay
argument_list|)
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iCLONcloneid
operator|=
name|pCLON
operator|->
name|iCloneid
expr_stmt|;
name|pData
operator|->
name|iCLONsourceid
operator|=
name|pCLON
operator|->
name|iSourceid
expr_stmt|;
name|pData
operator|->
name|iCLONclonetype
operator|=
name|pCLON
operator|->
name|iClonetype
expr_stmt|;
name|pData
operator|->
name|bCLONhasdonotshow
operator|=
name|pCLON
operator|->
name|bHasdonotshow
expr_stmt|;
name|pData
operator|->
name|iCLONdonotshow
operator|=
name|pCLON
operator|->
name|iDonotshow
expr_stmt|;
name|pData
operator|->
name|iCLONconcrete
operator|=
name|pCLON
operator|->
name|iConcrete
expr_stmt|;
name|pData
operator|->
name|bCLONhasloca
operator|=
name|pCLON
operator|->
name|bHasloca
expr_stmt|;
name|pData
operator|->
name|iCLONlocationtype
operator|=
name|pCLON
operator|->
name|iLocatype
expr_stmt|;
name|pData
operator|->
name|iCLONlocationx
operator|=
name|pCLON
operator|->
name|iLocax
expr_stmt|;
name|pData
operator|->
name|iCLONlocationy
operator|=
name|pCLON
operator|->
name|iLocay
expr_stmt|;
name|iRetcode
operator|=
name|mng_process_display_clon
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_CLON
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_BACK
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_back
name|mng_retcode
name|mng_create_ani_back
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint16
name|iRed
argument_list|,
name|mng_uint16
name|iGreen
argument_list|,
name|mng_uint16
name|iBlue
argument_list|,
name|mng_uint8
name|iMandatory
argument_list|,
name|mng_uint16
name|iImageid
argument_list|,
name|mng_uint8
name|iTile
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_back
argument_list|(
name|mng_datap
name|pData
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_backp
name|pBACK
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_BACK
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_back
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_back
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pBACK
operator|=
operator|(
name|mng_ani_backp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pBACK
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_back
argument_list|)
argument_list|)
expr_stmt|;
name|pBACK
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_back
expr_stmt|;
name|pBACK
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_back
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pBACK
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pBACK
operator|->
name|iRed
operator|=
name|iRed
expr_stmt|;
name|pBACK
operator|->
name|iGreen
operator|=
name|iGreen
expr_stmt|;
name|pBACK
operator|->
name|iBlue
operator|=
name|iBlue
expr_stmt|;
name|pBACK
operator|->
name|iMandatory
operator|=
name|iMandatory
expr_stmt|;
name|pBACK
operator|->
name|iImageid
operator|=
name|iImageid
expr_stmt|;
name|pBACK
operator|->
name|iTile
operator|=
name|iTile
expr_stmt|;
else|#
directive|else
name|pBACK
operator|->
name|iRed
operator|=
name|pData
operator|->
name|iBACKred
expr_stmt|;
name|pBACK
operator|->
name|iGreen
operator|=
name|pData
operator|->
name|iBACKgreen
expr_stmt|;
name|pBACK
operator|->
name|iBlue
operator|=
name|pData
operator|->
name|iBACKblue
expr_stmt|;
name|pBACK
operator|->
name|iMandatory
operator|=
name|pData
operator|->
name|iBACKmandatory
expr_stmt|;
name|pBACK
operator|->
name|iImageid
operator|=
name|pData
operator|->
name|iBACKimageid
expr_stmt|;
name|pBACK
operator|->
name|iTile
operator|=
name|pData
operator|->
name|iBACKtile
expr_stmt|;
endif|#
directive|endif
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_BACK
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_back
name|mng_retcode
name|mng_free_ani_back
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_BACK
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_back
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_BACK
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_back
name|mng_retcode
name|mng_process_ani_back
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_backp
name|pBACK
init|=
operator|(
name|mng_ani_backp
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_BACK
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iBACKred
operator|=
name|pBACK
operator|->
name|iRed
expr_stmt|;
name|pData
operator|->
name|iBACKgreen
operator|=
name|pBACK
operator|->
name|iGreen
expr_stmt|;
name|pData
operator|->
name|iBACKblue
operator|=
name|pBACK
operator|->
name|iBlue
expr_stmt|;
name|pData
operator|->
name|iBACKmandatory
operator|=
name|pBACK
operator|->
name|iMandatory
expr_stmt|;
name|pData
operator|->
name|iBACKimageid
operator|=
name|pBACK
operator|->
name|iImageid
expr_stmt|;
name|pData
operator|->
name|iBACKtile
operator|=
name|pBACK
operator|->
name|iTile
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_BACK
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_FRAM
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_fram
name|mng_retcode
name|mng_create_ani_fram
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint8
name|iFramemode
argument_list|,
name|mng_uint8
name|iChangedelay
argument_list|,
name|mng_uint32
name|iDelay
argument_list|,
name|mng_uint8
name|iChangetimeout
argument_list|,
name|mng_uint32
name|iTimeout
argument_list|,
name|mng_uint8
name|iChangeclipping
argument_list|,
name|mng_uint8
name|iCliptype
argument_list|,
name|mng_int32
name|iClipl
argument_list|,
name|mng_int32
name|iClipr
argument_list|,
name|mng_int32
name|iClipt
argument_list|,
name|mng_int32
name|iClipb
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_fram
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_chunkp
name|pChunk
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_framp
name|pFRAM
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_FRAM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_fram
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_fram
argument_list|,
operator|&
name|pTemp
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pFRAM
operator|=
operator|(
name|mng_ani_framp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pFRAM
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_fram
argument_list|)
argument_list|)
expr_stmt|;
name|pFRAM
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_fram
expr_stmt|;
name|pFRAM
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_fram
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pFRAM
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pFRAM
operator|->
name|iFramemode
operator|=
name|iFramemode
expr_stmt|;
name|pFRAM
operator|->
name|iChangedelay
operator|=
name|iChangedelay
expr_stmt|;
name|pFRAM
operator|->
name|iDelay
operator|=
name|iDelay
expr_stmt|;
name|pFRAM
operator|->
name|iChangetimeout
operator|=
name|iChangetimeout
expr_stmt|;
name|pFRAM
operator|->
name|iTimeout
operator|=
name|iTimeout
expr_stmt|;
name|pFRAM
operator|->
name|iChangeclipping
operator|=
name|iChangeclipping
expr_stmt|;
name|pFRAM
operator|->
name|iCliptype
operator|=
name|iCliptype
expr_stmt|;
name|pFRAM
operator|->
name|iClipl
operator|=
name|iClipl
expr_stmt|;
name|pFRAM
operator|->
name|iClipr
operator|=
name|iClipr
expr_stmt|;
name|pFRAM
operator|->
name|iClipt
operator|=
name|iClipt
expr_stmt|;
name|pFRAM
operator|->
name|iClipb
operator|=
name|iClipb
expr_stmt|;
else|#
directive|else
name|pFRAM
operator|->
name|iFramemode
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iMode
expr_stmt|;
name|pFRAM
operator|->
name|iChangedelay
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iChangedelay
expr_stmt|;
name|pFRAM
operator|->
name|iDelay
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iDelay
expr_stmt|;
name|pFRAM
operator|->
name|iChangetimeout
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iChangetimeout
expr_stmt|;
name|pFRAM
operator|->
name|iTimeout
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iTimeout
expr_stmt|;
name|pFRAM
operator|->
name|iChangeclipping
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iChangeclipping
expr_stmt|;
name|pFRAM
operator|->
name|iCliptype
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundarytype
expr_stmt|;
name|pFRAM
operator|->
name|iClipl
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundaryl
expr_stmt|;
name|pFRAM
operator|->
name|iClipr
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundaryr
expr_stmt|;
name|pFRAM
operator|->
name|iClipt
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundaryt
expr_stmt|;
name|pFRAM
operator|->
name|iClipb
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundaryb
expr_stmt|;
endif|#
directive|endif
block|}
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|iRetcode
operator|=
name|mng_process_display_fram
argument_list|(
name|pData
argument_list|,
name|iFramemode
argument_list|,
name|iChangedelay
argument_list|,
name|iDelay
argument_list|,
name|iChangetimeout
argument_list|,
name|iTimeout
argument_list|,
name|iChangeclipping
argument_list|,
name|iCliptype
argument_list|,
name|iClipl
argument_list|,
name|iClipr
argument_list|,
name|iClipt
argument_list|,
name|iClipb
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_process_display_fram
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iMode
argument_list|,
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iChangedelay
argument_list|,
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iDelay
argument_list|,
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iChangetimeout
argument_list|,
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iTimeout
argument_list|,
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iChangeclipping
argument_list|,
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundarytype
argument_list|,
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundaryl
argument_list|,
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundaryr
argument_list|,
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundaryt
argument_list|,
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundaryb
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pData
operator|->
name|iTempFramemode
operator|=
name|iFramemode
expr_stmt|;
name|pData
operator|->
name|iTempChangedelay
operator|=
name|iChangedelay
expr_stmt|;
name|pData
operator|->
name|iTempDelay
operator|=
name|iDelay
expr_stmt|;
name|pData
operator|->
name|iTempChangetimeout
operator|=
name|iChangetimeout
expr_stmt|;
name|pData
operator|->
name|iTempTimeout
operator|=
name|iTimeout
expr_stmt|;
name|pData
operator|->
name|iTempChangeclipping
operator|=
name|iChangeclipping
expr_stmt|;
name|pData
operator|->
name|iTempCliptype
operator|=
name|iCliptype
expr_stmt|;
name|pData
operator|->
name|iTempClipl
operator|=
name|iClipl
expr_stmt|;
name|pData
operator|->
name|iTempClipr
operator|=
name|iClipr
expr_stmt|;
name|pData
operator|->
name|iTempClipt
operator|=
name|iClipt
expr_stmt|;
name|pData
operator|->
name|iTempClipb
operator|=
name|iClipb
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iTempFramemode
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iMode
expr_stmt|;
name|pData
operator|->
name|iTempChangedelay
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iChangedelay
expr_stmt|;
name|pData
operator|->
name|iTempDelay
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iDelay
expr_stmt|;
name|pData
operator|->
name|iTempChangetimeout
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iChangetimeout
expr_stmt|;
name|pData
operator|->
name|iTempTimeout
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iTimeout
expr_stmt|;
name|pData
operator|->
name|iTempChangeclipping
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iChangeclipping
expr_stmt|;
name|pData
operator|->
name|iTempCliptype
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundarytype
expr_stmt|;
name|pData
operator|->
name|iTempClipl
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundaryl
expr_stmt|;
name|pData
operator|->
name|iTempClipr
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundaryr
expr_stmt|;
name|pData
operator|->
name|iTempClipt
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundaryt
expr_stmt|;
name|pData
operator|->
name|iTempClipb
operator|=
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundaryb
expr_stmt|;
endif|#
directive|endif
name|iRetcode
operator|=
name|mng_process_display_fram
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_FRAM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_fram
name|mng_retcode
name|mng_free_ani_fram
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_FRAM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_fram
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_FRAM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_fram
name|mng_retcode
name|mng_process_ani_fram
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_framp
name|pFRAM
init|=
operator|(
name|mng_ani_framp
operator|)
name|pObject
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_FRAM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|iBreakpoint
condition|)
comment|/* previously broken ? */
block|{
name|iRetcode
operator|=
name|mng_process_display_fram2
argument_list|(
name|pData
argument_list|)
expr_stmt|;
name|pData
operator|->
name|iBreakpoint
operator|=
literal|0
expr_stmt|;
comment|/* not again */
block|}
else|else
block|{
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
name|iRetcode
operator|=
name|mng_process_display_fram
argument_list|(
name|pData
argument_list|,
name|pFRAM
operator|->
name|iFramemode
argument_list|,
name|pFRAM
operator|->
name|iChangedelay
argument_list|,
name|pFRAM
operator|->
name|iDelay
argument_list|,
name|pFRAM
operator|->
name|iChangetimeout
argument_list|,
name|pFRAM
operator|->
name|iTimeout
argument_list|,
name|pFRAM
operator|->
name|iChangeclipping
argument_list|,
name|pFRAM
operator|->
name|iCliptype
argument_list|,
name|pFRAM
operator|->
name|iClipl
argument_list|,
name|pFRAM
operator|->
name|iClipr
argument_list|,
name|pFRAM
operator|->
name|iClipt
argument_list|,
name|pFRAM
operator|->
name|iClipb
argument_list|)
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iTempFramemode
operator|=
name|pFRAM
operator|->
name|iFramemode
expr_stmt|;
name|pData
operator|->
name|iTempChangedelay
operator|=
name|pFRAM
operator|->
name|iChangedelay
expr_stmt|;
name|pData
operator|->
name|iTempDelay
operator|=
name|pFRAM
operator|->
name|iDelay
expr_stmt|;
name|pData
operator|->
name|iTempChangetimeout
operator|=
name|pFRAM
operator|->
name|iChangetimeout
expr_stmt|;
name|pData
operator|->
name|iTempTimeout
operator|=
name|pFRAM
operator|->
name|iTimeout
expr_stmt|;
name|pData
operator|->
name|iTempChangeclipping
operator|=
name|pFRAM
operator|->
name|iChangeclipping
expr_stmt|;
name|pData
operator|->
name|iTempCliptype
operator|=
name|pFRAM
operator|->
name|iCliptype
expr_stmt|;
name|pData
operator|->
name|iTempClipl
operator|=
name|pFRAM
operator|->
name|iClipl
expr_stmt|;
name|pData
operator|->
name|iTempClipr
operator|=
name|pFRAM
operator|->
name|iClipr
expr_stmt|;
name|pData
operator|->
name|iTempClipt
operator|=
name|pFRAM
operator|->
name|iClipt
expr_stmt|;
name|pData
operator|->
name|iTempClipb
operator|=
name|pFRAM
operator|->
name|iClipb
expr_stmt|;
name|iRetcode
operator|=
name|mng_process_display_fram
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_FRAM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_MOVE
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_move
name|mng_retcode
name|mng_create_ani_move
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint16
name|iFirstid
argument_list|,
name|mng_uint16
name|iLastid
argument_list|,
name|mng_uint8
name|iType
argument_list|,
name|mng_int32
name|iLocax
argument_list|,
name|mng_int32
name|iLocay
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_move
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_chunkp
name|pChunk
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_movep
name|pMOVE
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_MOVE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_move
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_move
argument_list|,
operator|&
name|pTemp
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pMOVE
operator|=
operator|(
name|mng_ani_movep
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pMOVE
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_move
argument_list|)
argument_list|)
expr_stmt|;
name|pMOVE
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_move
expr_stmt|;
name|pMOVE
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_move
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pMOVE
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pMOVE
operator|->
name|iFirstid
operator|=
name|iFirstid
expr_stmt|;
name|pMOVE
operator|->
name|iLastid
operator|=
name|iLastid
expr_stmt|;
name|pMOVE
operator|->
name|iType
operator|=
name|iType
expr_stmt|;
name|pMOVE
operator|->
name|iLocax
operator|=
name|iLocax
expr_stmt|;
name|pMOVE
operator|->
name|iLocay
operator|=
name|iLocay
expr_stmt|;
else|#
directive|else
name|pMOVE
operator|->
name|iFirstid
operator|=
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iFirstid
expr_stmt|;
name|pMOVE
operator|->
name|iLastid
operator|=
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iLastid
expr_stmt|;
name|pMOVE
operator|->
name|iType
operator|=
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iMovetype
expr_stmt|;
name|pMOVE
operator|->
name|iLocax
operator|=
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iMovex
expr_stmt|;
name|pMOVE
operator|->
name|iLocay
operator|=
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iMovey
expr_stmt|;
endif|#
directive|endif
block|}
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|iRetcode
operator|=
name|mng_process_display_move
argument_list|(
name|pData
argument_list|,
name|iFirstid
argument_list|,
name|iLastid
argument_list|,
name|iType
argument_list|,
name|iLocax
argument_list|,
name|iLocay
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_process_display_move
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iFirstid
argument_list|,
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iLastid
argument_list|,
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iMovetype
argument_list|,
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iMovex
argument_list|,
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iMovey
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pData
operator|->
name|iMOVEfromid
operator|=
name|iFirstid
expr_stmt|;
name|pData
operator|->
name|iMOVEtoid
operator|=
name|iLastid
expr_stmt|;
name|pData
operator|->
name|iMOVEmovetype
operator|=
name|iType
expr_stmt|;
name|pData
operator|->
name|iMOVEmovex
operator|=
name|iLocax
expr_stmt|;
name|pData
operator|->
name|iMOVEmovey
operator|=
name|iLocay
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iMOVEfromid
operator|=
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iFirstid
expr_stmt|;
name|pData
operator|->
name|iMOVEtoid
operator|=
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iLastid
expr_stmt|;
name|pData
operator|->
name|iMOVEmovetype
operator|=
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iMovetype
expr_stmt|;
name|pData
operator|->
name|iMOVEmovex
operator|=
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iMovex
expr_stmt|;
name|pData
operator|->
name|iMOVEmovey
operator|=
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iMovey
expr_stmt|;
endif|#
directive|endif
name|iRetcode
operator|=
name|mng_process_display_move
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_MOVE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_move
name|mng_retcode
name|mng_free_ani_move
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_MOVE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_move
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_MOVE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_move
name|mng_retcode
name|mng_process_ani_move
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_retcode
name|iRetcode
decl_stmt|;
name|mng_ani_movep
name|pMOVE
init|=
operator|(
name|mng_ani_movep
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_MOVE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* re-process the MOVE chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
name|iRetcode
operator|=
name|mng_process_display_move
argument_list|(
name|pData
argument_list|,
name|pMOVE
operator|->
name|iFirstid
argument_list|,
name|pMOVE
operator|->
name|iLastid
argument_list|,
name|pMOVE
operator|->
name|iType
argument_list|,
name|pMOVE
operator|->
name|iLocax
argument_list|,
name|pMOVE
operator|->
name|iLocay
argument_list|)
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iMOVEfromid
operator|=
name|pMOVE
operator|->
name|iFirstid
expr_stmt|;
name|pData
operator|->
name|iMOVEtoid
operator|=
name|pMOVE
operator|->
name|iLastid
expr_stmt|;
name|pData
operator|->
name|iMOVEmovetype
operator|=
name|pMOVE
operator|->
name|iType
expr_stmt|;
name|pData
operator|->
name|iMOVEmovex
operator|=
name|pMOVE
operator|->
name|iLocax
expr_stmt|;
name|pData
operator|->
name|iMOVEmovey
operator|=
name|pMOVE
operator|->
name|iLocay
expr_stmt|;
name|iRetcode
operator|=
name|mng_process_display_move
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_MOVE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_CLIP
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_clip
name|mng_retcode
name|mng_create_ani_clip
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint16
name|iFirstid
argument_list|,
name|mng_uint16
name|iLastid
argument_list|,
name|mng_uint8
name|iType
argument_list|,
name|mng_int32
name|iClipl
argument_list|,
name|mng_int32
name|iClipr
argument_list|,
name|mng_int32
name|iClipt
argument_list|,
name|mng_int32
name|iClipb
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_clip
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_chunkp
name|pChunk
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_clipp
name|pCLIP
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_CLIP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_clip
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_clip
argument_list|,
operator|&
name|pTemp
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pCLIP
operator|=
operator|(
name|mng_ani_clipp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pCLIP
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_clip
argument_list|)
argument_list|)
expr_stmt|;
name|pCLIP
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_clip
expr_stmt|;
name|pCLIP
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_clip
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pCLIP
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pCLIP
operator|->
name|iFirstid
operator|=
name|iFirstid
expr_stmt|;
name|pCLIP
operator|->
name|iLastid
operator|=
name|iLastid
expr_stmt|;
name|pCLIP
operator|->
name|iType
operator|=
name|iType
expr_stmt|;
name|pCLIP
operator|->
name|iClipl
operator|=
name|iClipl
expr_stmt|;
name|pCLIP
operator|->
name|iClipr
operator|=
name|iClipr
expr_stmt|;
name|pCLIP
operator|->
name|iClipt
operator|=
name|iClipt
expr_stmt|;
name|pCLIP
operator|->
name|iClipb
operator|=
name|iClipb
expr_stmt|;
else|#
directive|else
name|pCLIP
operator|->
name|iFirstid
operator|=
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iFirstid
expr_stmt|;
name|pCLIP
operator|->
name|iLastid
operator|=
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iLastid
expr_stmt|;
name|pCLIP
operator|->
name|iType
operator|=
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iCliptype
expr_stmt|;
name|pCLIP
operator|->
name|iClipl
operator|=
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iClipl
expr_stmt|;
name|pCLIP
operator|->
name|iClipr
operator|=
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iClipr
expr_stmt|;
name|pCLIP
operator|->
name|iClipt
operator|=
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iClipt
expr_stmt|;
name|pCLIP
operator|->
name|iClipb
operator|=
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iClipb
expr_stmt|;
endif|#
directive|endif
block|}
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|iRetcode
operator|=
name|mng_process_display_clip
argument_list|(
name|pData
argument_list|,
name|iFirstid
argument_list|,
name|iLastid
argument_list|,
name|iType
argument_list|,
name|iClipl
argument_list|,
name|iClipr
argument_list|,
name|iClipt
argument_list|,
name|iClipb
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_process_display_clip
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iFirstid
argument_list|,
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iLastid
argument_list|,
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iCliptype
argument_list|,
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iClipl
argument_list|,
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iClipr
argument_list|,
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iClipt
argument_list|,
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iClipb
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pData
operator|->
name|iCLIPfromid
operator|=
name|iFirstid
expr_stmt|;
name|pData
operator|->
name|iCLIPtoid
operator|=
name|iLastid
expr_stmt|;
name|pData
operator|->
name|iCLIPcliptype
operator|=
name|iType
expr_stmt|;
name|pData
operator|->
name|iCLIPclipl
operator|=
name|iClipl
expr_stmt|;
name|pData
operator|->
name|iCLIPclipr
operator|=
name|iClipr
expr_stmt|;
name|pData
operator|->
name|iCLIPclipt
operator|=
name|iClipt
expr_stmt|;
name|pData
operator|->
name|iCLIPclipb
operator|=
name|iClipb
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iCLIPfromid
operator|=
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iFirstid
expr_stmt|;
name|pData
operator|->
name|iCLIPtoid
operator|=
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iLastid
expr_stmt|;
name|pData
operator|->
name|iCLIPcliptype
operator|=
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iCliptype
expr_stmt|;
name|pData
operator|->
name|iCLIPclipl
operator|=
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iClipl
expr_stmt|;
name|pData
operator|->
name|iCLIPclipr
operator|=
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iClipr
expr_stmt|;
name|pData
operator|->
name|iCLIPclipt
operator|=
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iClipt
expr_stmt|;
name|pData
operator|->
name|iCLIPclipb
operator|=
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iClipb
expr_stmt|;
endif|#
directive|endif
name|iRetcode
operator|=
name|mng_process_display_clip
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_CLIP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_clip
name|mng_retcode
name|mng_free_ani_clip
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_CLIP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_clip
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_CLIP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_clip
name|mng_retcode
name|mng_process_ani_clip
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_retcode
name|iRetcode
decl_stmt|;
name|mng_ani_clipp
name|pCLIP
init|=
operator|(
name|mng_ani_clipp
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_CLIP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* re-process the CLIP chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
name|iRetcode
operator|=
name|mng_process_display_clip
argument_list|(
name|pData
argument_list|,
name|pCLIP
operator|->
name|iFirstid
argument_list|,
name|pCLIP
operator|->
name|iLastid
argument_list|,
name|pCLIP
operator|->
name|iType
argument_list|,
name|pCLIP
operator|->
name|iClipl
argument_list|,
name|pCLIP
operator|->
name|iClipr
argument_list|,
name|pCLIP
operator|->
name|iClipt
argument_list|,
name|pCLIP
operator|->
name|iClipb
argument_list|)
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iCLIPfromid
operator|=
name|pCLIP
operator|->
name|iFirstid
expr_stmt|;
name|pData
operator|->
name|iCLIPtoid
operator|=
name|pCLIP
operator|->
name|iLastid
expr_stmt|;
name|pData
operator|->
name|iCLIPcliptype
operator|=
name|pCLIP
operator|->
name|iType
expr_stmt|;
name|pData
operator|->
name|iCLIPclipl
operator|=
name|pCLIP
operator|->
name|iClipl
expr_stmt|;
name|pData
operator|->
name|iCLIPclipr
operator|=
name|pCLIP
operator|->
name|iClipr
expr_stmt|;
name|pData
operator|->
name|iCLIPclipt
operator|=
name|pCLIP
operator|->
name|iClipt
expr_stmt|;
name|pData
operator|->
name|iCLIPclipb
operator|=
name|pCLIP
operator|->
name|iClipb
expr_stmt|;
name|iRetcode
operator|=
name|mng_process_display_clip
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_CLIP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SHOW
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_show
name|mng_retcode
name|mng_create_ani_show
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint16
name|iFirstid
argument_list|,
name|mng_uint16
name|iLastid
argument_list|,
name|mng_uint8
name|iMode
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_show
argument_list|(
name|mng_datap
name|pData
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_showp
name|pSHOW
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_SHOW
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_show
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_show
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pSHOW
operator|=
operator|(
name|mng_ani_showp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pSHOW
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_show
argument_list|)
argument_list|)
expr_stmt|;
name|pSHOW
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_show
expr_stmt|;
name|pSHOW
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_show
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pSHOW
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pSHOW
operator|->
name|iFirstid
operator|=
name|iFirstid
expr_stmt|;
name|pSHOW
operator|->
name|iLastid
operator|=
name|iLastid
expr_stmt|;
name|pSHOW
operator|->
name|iMode
operator|=
name|iMode
expr_stmt|;
else|#
directive|else
name|pSHOW
operator|->
name|iFirstid
operator|=
name|pData
operator|->
name|iSHOWfromid
expr_stmt|;
name|pSHOW
operator|->
name|iLastid
operator|=
name|pData
operator|->
name|iSHOWtoid
expr_stmt|;
name|pSHOW
operator|->
name|iMode
operator|=
name|pData
operator|->
name|iSHOWmode
expr_stmt|;
endif|#
directive|endif
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_SHOW
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_show
name|mng_retcode
name|mng_free_ani_show
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_SHOW
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_show
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_SHOW
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_show
name|mng_retcode
name|mng_process_ani_show
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_retcode
name|iRetcode
decl_stmt|;
name|mng_ani_showp
name|pSHOW
init|=
operator|(
name|mng_ani_showp
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_SHOW
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|iBreakpoint
condition|)
comment|/* returning from breakpoint ? */
block|{
name|iRetcode
operator|=
name|mng_process_display_show
argument_list|(
name|pData
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* "re-run" SHOW chunk */
name|pData
operator|->
name|iSHOWmode
operator|=
name|pSHOW
operator|->
name|iMode
expr_stmt|;
name|pData
operator|->
name|iSHOWfromid
operator|=
name|pSHOW
operator|->
name|iFirstid
expr_stmt|;
name|pData
operator|->
name|iSHOWtoid
operator|=
name|pSHOW
operator|->
name|iLastid
expr_stmt|;
name|iRetcode
operator|=
name|mng_process_display_show
argument_list|(
name|pData
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_SHOW
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_TERM
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_term
name|mng_retcode
name|mng_create_ani_term
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint8
name|iTermaction
argument_list|,
name|mng_uint8
name|iIteraction
argument_list|,
name|mng_uint32
name|iDelay
argument_list|,
name|mng_uint32
name|iItermax
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_term
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_chunkp
name|pChunk
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_termp
name|pTERM
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_TERM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_term
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_term
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pTERM
operator|=
operator|(
name|mng_ani_termp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pTERM
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_term
argument_list|)
argument_list|)
expr_stmt|;
name|pTERM
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_term
expr_stmt|;
name|pTERM
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_term
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pTERM
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pTERM
operator|->
name|iTermaction
operator|=
name|iTermaction
expr_stmt|;
name|pTERM
operator|->
name|iIteraction
operator|=
name|iIteraction
expr_stmt|;
name|pTERM
operator|->
name|iDelay
operator|=
name|iDelay
expr_stmt|;
name|pTERM
operator|->
name|iItermax
operator|=
name|iItermax
expr_stmt|;
else|#
directive|else
name|pTERM
operator|->
name|iTermaction
operator|=
operator|(
operator|(
name|mng_termp
operator|)
name|pChunk
operator|)
operator|->
name|iTermaction
expr_stmt|;
name|pTERM
operator|->
name|iIteraction
operator|=
operator|(
operator|(
name|mng_termp
operator|)
name|pChunk
operator|)
operator|->
name|iIteraction
expr_stmt|;
name|pTERM
operator|->
name|iDelay
operator|=
operator|(
operator|(
name|mng_termp
operator|)
name|pChunk
operator|)
operator|->
name|iDelay
expr_stmt|;
name|pTERM
operator|->
name|iItermax
operator|=
operator|(
operator|(
name|mng_termp
operator|)
name|pChunk
operator|)
operator|->
name|iItermax
expr_stmt|;
endif|#
directive|endif
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_TERM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_term
name|mng_retcode
name|mng_free_ani_term
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_TERM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_term
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_TERM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_term
name|mng_retcode
name|mng_process_ani_term
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_TERM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* dummy: no action required! */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_TERM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SAVE
end_ifndef
begin_function
DECL|function|mng_create_ani_save
name|mng_retcode
name|mng_create_ani_save
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_ani_savep
name|pSAVE
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_SAVE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_save
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_save
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pSAVE
operator|=
operator|(
name|mng_ani_savep
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pSAVE
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_save
argument_list|)
argument_list|)
expr_stmt|;
name|pSAVE
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_save
expr_stmt|;
name|pSAVE
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_save
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pSAVE
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_SAVE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_save
name|mng_retcode
name|mng_free_ani_save
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_SAVE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_save
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_SAVE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_save
name|mng_retcode
name|mng_process_ani_save
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_SAVE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iRetcode
operator|=
name|mng_process_display_save
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_SAVE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SEEK
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_seek
name|mng_retcode
name|mng_create_ani_seek
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint32
name|iSegmentnamesize
argument_list|,
name|mng_pchar
name|zSegmentname
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_seek
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_chunkp
name|pChunk
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_seekp
name|pSEEK
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_SEEK
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_seek
argument_list|)
argument_list|,
name|mng_free_ani_seek
argument_list|,
name|mng_process_ani_seek
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pSEEK
operator|=
operator|(
name|mng_ani_seekp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pSEEK
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_seek
argument_list|)
argument_list|)
expr_stmt|;
name|pSEEK
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_seek
expr_stmt|;
name|pSEEK
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_seek
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pSEEK
argument_list|)
expr_stmt|;
name|pData
operator|->
name|pLastseek
operator|=
operator|(
name|mng_objectp
operator|)
name|pSEEK
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pSEEK
operator|->
name|iSegmentnamesize
operator|=
name|iSegmentnamesize
expr_stmt|;
if|if
condition|(
name|iSegmentnamesize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pSEEK
operator|->
name|zSegmentname
argument_list|,
name|iSegmentnamesize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pSEEK
operator|->
name|zSegmentname
argument_list|,
name|zSegmentname
argument_list|,
name|iSegmentnamesize
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|pSEEK
operator|->
name|iSegmentnamesize
operator|=
operator|(
operator|(
name|mng_seekp
operator|)
name|pChunk
operator|)
operator|->
name|iNamesize
expr_stmt|;
if|if
condition|(
name|pSEEK
operator|->
name|iSegmentnamesize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pSEEK
operator|->
name|zSegmentname
argument_list|,
name|pSEEK
operator|->
name|iSegmentnamesize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pSEEK
operator|->
name|zSegmentname
argument_list|,
operator|(
operator|(
name|mng_seekp
operator|)
name|pChunk
operator|)
operator|->
name|zName
argument_list|,
name|pSEEK
operator|->
name|iSegmentnamesize
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_SEEK
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_free_ani_seek
name|mng_retcode
name|mng_free_ani_seek
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_seekp
name|pSEEK
init|=
operator|(
name|mng_ani_seekp
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_SEEK
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pSEEK
operator|->
name|iSegmentnamesize
condition|)
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pSEEK
operator|->
name|zSegmentname
argument_list|,
name|pSEEK
operator|->
name|iSegmentnamesize
operator|+
literal|1
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_seek
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_SEEK
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
return|return
name|MNG_NOERROR
return|;
else|#
directive|else
return|return
name|mng_free_obj_general
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|)
return|;
endif|#
directive|endif
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_seek
name|mng_retcode
name|mng_process_ani_seek
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_seekp
name|pSEEK
init|=
operator|(
name|mng_ani_seekp
operator|)
name|pObject
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_SEEK
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DYNAMICMNG
if|if
condition|(
operator|!
name|pData
operator|->
name|bStopafterseek
condition|)
comment|/* can we really process this one ? */
endif|#
directive|endif
block|{
name|pData
operator|->
name|pLastseek
operator|=
name|pObject
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|fProcessseek
condition|)
comment|/* inform the app ? */
block|{
name|mng_bool
name|bOke
decl_stmt|;
name|mng_pchar
name|zName
decl_stmt|;
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|zName
argument_list|,
name|pSEEK
operator|->
name|iSegmentnamesize
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|pSEEK
operator|->
name|iSegmentnamesize
condition|)
name|MNG_COPY
argument_list|(
name|zName
argument_list|,
name|pSEEK
operator|->
name|zSegmentname
argument_list|,
name|pSEEK
operator|->
name|iSegmentnamesize
argument_list|)
expr_stmt|;
name|bOke
operator|=
name|pData
operator|->
name|fProcessseek
argument_list|(
operator|(
name|mng_handle
operator|)
name|pData
argument_list|,
name|zName
argument_list|)
expr_stmt|;
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|zName
argument_list|,
name|pSEEK
operator|->
name|iSegmentnamesize
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|bOke
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_APPMISCERROR
argument_list|)
expr_stmt|;
block|}
block|}
name|iRetcode
operator|=
name|mng_process_display_seek
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_SEEK
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_dhdr
name|mng_retcode
name|mng_create_ani_dhdr
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint16
name|iObjectid
argument_list|,
name|mng_uint8
name|iImagetype
argument_list|,
name|mng_uint8
name|iDeltatype
argument_list|,
name|mng_uint32
name|iBlockwidth
argument_list|,
name|mng_uint32
name|iBlockheight
argument_list|,
name|mng_uint32
name|iBlockx
argument_list|,
name|mng_uint32
name|iBlocky
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_dhdr
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_chunkp
name|pChunk
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_dhdrp
name|pDHDR
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_DHDR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_dhdr
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_dhdr
argument_list|,
operator|&
name|pTemp
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pDHDR
operator|=
operator|(
name|mng_ani_dhdrp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pDHDR
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_dhdr
argument_list|)
argument_list|)
expr_stmt|;
name|pDHDR
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_dhdr
expr_stmt|;
name|pDHDR
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_dhdr
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pDHDR
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pDHDR
operator|->
name|iObjectid
operator|=
name|iObjectid
expr_stmt|;
name|pDHDR
operator|->
name|iImagetype
operator|=
name|iImagetype
expr_stmt|;
name|pDHDR
operator|->
name|iDeltatype
operator|=
name|iDeltatype
expr_stmt|;
name|pDHDR
operator|->
name|iBlockwidth
operator|=
name|iBlockwidth
expr_stmt|;
name|pDHDR
operator|->
name|iBlockheight
operator|=
name|iBlockheight
expr_stmt|;
name|pDHDR
operator|->
name|iBlockx
operator|=
name|iBlockx
expr_stmt|;
name|pDHDR
operator|->
name|iBlocky
operator|=
name|iBlocky
expr_stmt|;
else|#
directive|else
name|pDHDR
operator|->
name|iObjectid
operator|=
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iObjectid
expr_stmt|;
name|pDHDR
operator|->
name|iImagetype
operator|=
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iImagetype
expr_stmt|;
name|pDHDR
operator|->
name|iDeltatype
operator|=
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iDeltatype
expr_stmt|;
name|pDHDR
operator|->
name|iBlockwidth
operator|=
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iBlockwidth
expr_stmt|;
name|pDHDR
operator|->
name|iBlockheight
operator|=
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iBlockheight
expr_stmt|;
name|pDHDR
operator|->
name|iBlockx
operator|=
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iBlockx
expr_stmt|;
name|pDHDR
operator|->
name|iBlocky
operator|=
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iBlocky
expr_stmt|;
endif|#
directive|endif
block|}
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|iRetcode
operator|=
name|mng_process_display_dhdr
argument_list|(
name|pData
argument_list|,
name|iObjectid
argument_list|,
name|iImagetype
argument_list|,
name|iDeltatype
argument_list|,
name|iBlockwidth
argument_list|,
name|iBlockheight
argument_list|,
name|iBlockx
argument_list|,
name|iBlocky
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_process_display_dhdr
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iObjectid
argument_list|,
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iImagetype
argument_list|,
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iDeltatype
argument_list|,
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iBlockwidth
argument_list|,
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iBlockheight
argument_list|,
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iBlockx
argument_list|,
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iBlocky
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pData
operator|->
name|iDHDRobjectid
operator|=
name|iObjectid
expr_stmt|;
name|pData
operator|->
name|iDHDRimagetype
operator|=
name|iImagetype
expr_stmt|;
name|pData
operator|->
name|iDHDRdeltatype
operator|=
name|iDeltatype
expr_stmt|;
name|pData
operator|->
name|iDHDRblockwidth
operator|=
name|iBlockwidth
expr_stmt|;
name|pData
operator|->
name|iDHDRblockheight
operator|=
name|iBlockheight
expr_stmt|;
name|pData
operator|->
name|iDHDRblockx
operator|=
name|iBlockx
expr_stmt|;
name|pData
operator|->
name|iDHDRblocky
operator|=
name|iBlocky
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iDHDRobjectid
operator|=
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iObjectid
expr_stmt|;
name|pData
operator|->
name|iDHDRimagetype
operator|=
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iImagetype
expr_stmt|;
name|pData
operator|->
name|iDHDRdeltatype
operator|=
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iDeltatype
expr_stmt|;
name|pData
operator|->
name|iDHDRblockwidth
operator|=
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iBlockwidth
expr_stmt|;
name|pData
operator|->
name|iDHDRblockheight
operator|=
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iBlockheight
expr_stmt|;
name|pData
operator|->
name|iDHDRblockx
operator|=
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iBlockx
expr_stmt|;
name|pData
operator|->
name|iDHDRblocky
operator|=
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iBlocky
expr_stmt|;
endif|#
directive|endif
name|iRetcode
operator|=
name|mng_process_display_dhdr
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_DHDR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_dhdr
name|mng_retcode
name|mng_free_ani_dhdr
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_DHDR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_dhdr
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_DHDR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_dhdr
name|mng_retcode
name|mng_process_ani_dhdr
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_dhdrp
name|pDHDR
init|=
operator|(
name|mng_ani_dhdrp
operator|)
name|pObject
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_DHDR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|bHasDHDR
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* let everyone know we're inside a DHDR */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
name|iRetcode
operator|=
name|mng_process_display_dhdr
argument_list|(
name|pData
argument_list|,
name|pDHDR
operator|->
name|iObjectid
argument_list|,
name|pDHDR
operator|->
name|iImagetype
argument_list|,
name|pDHDR
operator|->
name|iDeltatype
argument_list|,
name|pDHDR
operator|->
name|iBlockwidth
argument_list|,
name|pDHDR
operator|->
name|iBlockheight
argument_list|,
name|pDHDR
operator|->
name|iBlockx
argument_list|,
name|pDHDR
operator|->
name|iBlocky
argument_list|)
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iDHDRobjectid
operator|=
name|pDHDR
operator|->
name|iObjectid
expr_stmt|;
name|pData
operator|->
name|iDHDRimagetype
operator|=
name|pDHDR
operator|->
name|iImagetype
expr_stmt|;
name|pData
operator|->
name|iDHDRdeltatype
operator|=
name|pDHDR
operator|->
name|iDeltatype
expr_stmt|;
name|pData
operator|->
name|iDHDRblockwidth
operator|=
name|pDHDR
operator|->
name|iBlockwidth
expr_stmt|;
name|pData
operator|->
name|iDHDRblockheight
operator|=
name|pDHDR
operator|->
name|iBlockheight
expr_stmt|;
name|pData
operator|->
name|iDHDRblockx
operator|=
name|pDHDR
operator|->
name|iBlockx
expr_stmt|;
name|pData
operator|->
name|iDHDRblocky
operator|=
name|pDHDR
operator|->
name|iBlocky
expr_stmt|;
name|iRetcode
operator|=
name|mng_process_display_dhdr
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_DHDR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_prom
name|mng_retcode
name|mng_create_ani_prom
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint8
name|iBitdepth
argument_list|,
name|mng_uint8
name|iColortype
argument_list|,
name|mng_uint8
name|iFilltype
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_prom
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_chunkp
name|pChunk
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_promp
name|pPROM
init|=
name|NULL
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_PROM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_prom
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_prom
argument_list|,
operator|&
name|pTemp
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pPROM
operator|=
operator|(
name|mng_ani_promp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pPROM
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_prom
argument_list|)
argument_list|)
expr_stmt|;
name|pPROM
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_prom
expr_stmt|;
name|pPROM
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_prom
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pPROM
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pPROM
operator|->
name|iBitdepth
operator|=
name|iBitdepth
expr_stmt|;
name|pPROM
operator|->
name|iColortype
operator|=
name|iColortype
expr_stmt|;
name|pPROM
operator|->
name|iFilltype
operator|=
name|iFilltype
expr_stmt|;
else|#
directive|else
name|pPROM
operator|->
name|iBitdepth
operator|=
operator|(
operator|(
name|mng_promp
operator|)
name|pChunk
operator|)
operator|->
name|iSampledepth
expr_stmt|;
name|pPROM
operator|->
name|iColortype
operator|=
operator|(
operator|(
name|mng_promp
operator|)
name|pChunk
operator|)
operator|->
name|iColortype
expr_stmt|;
name|pPROM
operator|->
name|iFilltype
operator|=
operator|(
operator|(
name|mng_promp
operator|)
name|pChunk
operator|)
operator|->
name|iFilltype
expr_stmt|;
endif|#
directive|endif
block|}
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|iRetcode
operator|=
name|mng_process_display_prom
argument_list|(
name|pData
argument_list|,
name|iBitdepth
argument_list|,
name|iColortype
argument_list|,
name|iFilltype
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_process_display_prom
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_promp
operator|)
name|pChunk
operator|)
operator|->
name|iSampledepth
argument_list|,
operator|(
operator|(
name|mng_promp
operator|)
name|pChunk
operator|)
operator|->
name|iColortype
argument_list|,
operator|(
operator|(
name|mng_promp
operator|)
name|pChunk
operator|)
operator|->
name|iFilltype
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pData
operator|->
name|iPROMbitdepth
operator|=
name|iBitdepth
expr_stmt|;
name|pData
operator|->
name|iPROMcolortype
operator|=
name|iColortype
expr_stmt|;
name|pData
operator|->
name|iPROMfilltype
operator|=
name|iFilltype
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iPROMbitdepth
operator|=
operator|(
operator|(
name|mng_promp
operator|)
name|pChunk
operator|)
operator|->
name|iSampledepth
expr_stmt|;
name|pData
operator|->
name|iPROMcolortype
operator|=
operator|(
operator|(
name|mng_promp
operator|)
name|pChunk
operator|)
operator|->
name|iColortype
expr_stmt|;
name|pData
operator|->
name|iPROMfilltype
operator|=
operator|(
operator|(
name|mng_promp
operator|)
name|pChunk
operator|)
operator|->
name|iFilltype
expr_stmt|;
endif|#
directive|endif
name|iRetcode
operator|=
name|mng_process_display_prom
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_PROM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_prom
name|mng_retcode
name|mng_free_ani_prom
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_PROM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_prom
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_PROM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_prom
name|mng_retcode
name|mng_process_ani_prom
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_promp
name|pPROM
init|=
operator|(
name|mng_ani_promp
operator|)
name|pObject
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_PROM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
name|iRetcode
operator|=
name|mng_process_display_prom
argument_list|(
name|pData
argument_list|,
name|pPROM
operator|->
name|iBitdepth
argument_list|,
name|pPROM
operator|->
name|iColortype
argument_list|,
name|pPROM
operator|->
name|iFilltype
argument_list|)
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iPROMbitdepth
operator|=
name|pPROM
operator|->
name|iBitdepth
expr_stmt|;
name|pData
operator|->
name|iPROMcolortype
operator|=
name|pPROM
operator|->
name|iColortype
expr_stmt|;
name|pData
operator|->
name|iPROMfilltype
operator|=
name|pPROM
operator|->
name|iFilltype
expr_stmt|;
name|iRetcode
operator|=
name|mng_process_display_prom
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_PROM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_function
DECL|function|mng_create_ani_ipng
name|mng_retcode
name|mng_create_ani_ipng
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_ani_ipngp
name|pIPNG
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_IPNG
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_ipng
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_ipng
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pIPNG
operator|=
operator|(
name|mng_ani_ipngp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pIPNG
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_ipng
argument_list|)
argument_list|)
expr_stmt|;
name|pIPNG
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_ipng
expr_stmt|;
name|pIPNG
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_ipng
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pIPNG
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_IPNG
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_ipng
name|mng_retcode
name|mng_free_ani_ipng
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_IPNG
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_ipng
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_IPNG
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_ipng
name|mng_retcode
name|mng_process_ani_ipng
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_IPNG
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iRetcode
operator|=
name|mng_process_display_ipng
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_IPNG
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
end_ifdef
begin_function
DECL|function|mng_create_ani_ijng
name|mng_retcode
name|mng_create_ani_ijng
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_ani_ijngp
name|pIJNG
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_IJNG
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_ijng
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_ijng
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pIJNG
operator|=
operator|(
name|mng_ani_ijngp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pIJNG
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_ijng
argument_list|)
argument_list|)
expr_stmt|;
name|pIJNG
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_ijng
expr_stmt|;
name|pIJNG
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_ijng
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pIJNG
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_IJNG
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_ijng
name|mng_retcode
name|mng_free_ani_ijng
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_IJNG
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_ijng
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_IJNG
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_ijng
name|mng_retcode
name|mng_process_ani_ijng
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_IJNG
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iRetcode
operator|=
name|mng_process_display_ijng
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_IJNG
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_function
DECL|function|mng_create_ani_pplt
name|mng_retcode
name|mng_create_ani_pplt
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint8
name|iType
parameter_list|,
name|mng_uint32
name|iCount
parameter_list|,
name|mng_palette8ep
name|paIndexentries
parameter_list|,
name|mng_uint8p
name|paAlphaentries
parameter_list|,
name|mng_uint8p
name|paUsedentries
parameter_list|)
block|{
name|mng_ani_ppltp
name|pPPLT
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_PPLT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_pplt
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_pplt
argument_list|,
operator|&
name|pTemp
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pPPLT
operator|=
operator|(
name|mng_ani_ppltp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pPPLT
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_pplt
argument_list|)
argument_list|)
expr_stmt|;
name|pPPLT
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_pplt
expr_stmt|;
name|pPPLT
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_pplt
expr_stmt|;
endif|#
directive|endif
name|pPPLT
operator|->
name|iType
operator|=
name|iType
expr_stmt|;
name|pPPLT
operator|->
name|iCount
operator|=
name|iCount
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pPPLT
operator|->
name|aIndexentries
argument_list|,
name|paIndexentries
argument_list|,
sizeof|sizeof
argument_list|(
name|pPPLT
operator|->
name|aIndexentries
argument_list|)
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pPPLT
operator|->
name|aAlphaentries
argument_list|,
name|paAlphaentries
argument_list|,
sizeof|sizeof
argument_list|(
name|pPPLT
operator|->
name|aAlphaentries
argument_list|)
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pPPLT
operator|->
name|aUsedentries
argument_list|,
name|paUsedentries
argument_list|,
sizeof|sizeof
argument_list|(
name|pPPLT
operator|->
name|aUsedentries
argument_list|)
argument_list|)
expr_stmt|;
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pPPLT
argument_list|)
expr_stmt|;
block|}
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
name|iRetcode
operator|=
name|mng_process_display_pplt
argument_list|(
name|pData
argument_list|,
name|iType
argument_list|,
name|iCount
argument_list|,
name|paIndexentries
argument_list|,
name|paAlphaentries
argument_list|,
name|paUsedentries
argument_list|)
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iPPLTtype
operator|=
name|iType
expr_stmt|;
name|pData
operator|->
name|iPPLTcount
operator|=
name|iCount
expr_stmt|;
name|pData
operator|->
name|paPPLTindexentries
operator|=
name|paIndexentries
expr_stmt|;
name|pData
operator|->
name|paPPLTalphaentries
operator|=
name|paAlphaentries
expr_stmt|;
name|pData
operator|->
name|paPPLTusedentries
operator|=
name|paUsedentries
expr_stmt|;
name|iRetcode
operator|=
name|mng_process_display_pplt
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_PPLT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_pplt
name|mng_retcode
name|mng_free_ani_pplt
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_PPLT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_pplt
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_PPLT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_pplt
name|mng_retcode
name|mng_process_ani_pplt
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_ppltp
name|pPPLT
init|=
operator|(
name|mng_ani_ppltp
operator|)
name|pObject
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_PPLT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
name|iRetcode
operator|=
name|mng_process_display_pplt
argument_list|(
name|pData
argument_list|,
name|pPPLT
operator|->
name|iType
argument_list|,
name|pPPLT
operator|->
name|iCount
argument_list|,
name|pPPLT
operator|->
name|aIndexentries
argument_list|,
name|pPPLT
operator|->
name|aAlphaentries
argument_list|,
name|pPPLT
operator|->
name|aUsedentries
argument_list|)
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iPPLTtype
operator|=
name|pPPLT
operator|->
name|iType
expr_stmt|;
name|pData
operator|->
name|iPPLTcount
operator|=
name|pPPLT
operator|->
name|iCount
expr_stmt|;
name|pData
operator|->
name|paPPLTindexentries
operator|=
operator|&
name|pPPLT
operator|->
name|aIndexentries
expr_stmt|;
name|pData
operator|->
name|paPPLTalphaentries
operator|=
operator|&
name|pPPLT
operator|->
name|aAlphaentries
expr_stmt|;
name|pData
operator|->
name|paPPLTusedentries
operator|=
operator|&
name|pPPLT
operator|->
name|aUsedentries
expr_stmt|;
name|iRetcode
operator|=
name|mng_process_display_pplt
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_PPLT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_MAGN
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_magn
name|mng_retcode
name|mng_create_ani_magn
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint16
name|iFirstid
argument_list|,
name|mng_uint16
name|iLastid
argument_list|,
name|mng_uint8
name|iMethodX
argument_list|,
name|mng_uint16
name|iMX
argument_list|,
name|mng_uint16
name|iMY
argument_list|,
name|mng_uint16
name|iML
argument_list|,
name|mng_uint16
name|iMR
argument_list|,
name|mng_uint16
name|iMT
argument_list|,
name|mng_uint16
name|iMB
argument_list|,
name|mng_uint8
name|iMethodY
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_magn
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_chunkp
name|pChunk
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_magnp
name|pMAGN
init|=
name|NULL
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_MAGN
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_magn
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_magn
argument_list|,
operator|&
name|pTemp
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pMAGN
operator|=
operator|(
name|mng_ani_magnp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pMAGN
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_magn
argument_list|)
argument_list|)
expr_stmt|;
name|pMAGN
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_magn
expr_stmt|;
name|pMAGN
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_magn
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pMAGN
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pMAGN
operator|->
name|iFirstid
operator|=
name|iFirstid
expr_stmt|;
name|pMAGN
operator|->
name|iLastid
operator|=
name|iLastid
expr_stmt|;
name|pMAGN
operator|->
name|iMethodX
operator|=
name|iMethodX
expr_stmt|;
name|pMAGN
operator|->
name|iMX
operator|=
name|iMX
expr_stmt|;
name|pMAGN
operator|->
name|iMY
operator|=
name|iMY
expr_stmt|;
name|pMAGN
operator|->
name|iML
operator|=
name|iML
expr_stmt|;
name|pMAGN
operator|->
name|iMR
operator|=
name|iMR
expr_stmt|;
name|pMAGN
operator|->
name|iMT
operator|=
name|iMT
expr_stmt|;
name|pMAGN
operator|->
name|iMB
operator|=
name|iMB
expr_stmt|;
name|pMAGN
operator|->
name|iMethodY
operator|=
name|iMethodY
expr_stmt|;
else|#
directive|else
name|pMAGN
operator|->
name|iFirstid
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iFirstid
expr_stmt|;
name|pMAGN
operator|->
name|iLastid
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iLastid
expr_stmt|;
name|pMAGN
operator|->
name|iMethodX
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMethodX
expr_stmt|;
name|pMAGN
operator|->
name|iMX
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMX
expr_stmt|;
name|pMAGN
operator|->
name|iMY
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMY
expr_stmt|;
name|pMAGN
operator|->
name|iML
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iML
expr_stmt|;
name|pMAGN
operator|->
name|iMR
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMR
expr_stmt|;
name|pMAGN
operator|->
name|iMT
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMT
expr_stmt|;
name|pMAGN
operator|->
name|iMB
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMB
expr_stmt|;
name|pMAGN
operator|->
name|iMethodY
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMethodY
expr_stmt|;
endif|#
directive|endif
block|}
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|iRetcode
operator|=
name|mng_process_display_magn
argument_list|(
name|pData
argument_list|,
name|pMAGN
operator|->
name|iFirstid
argument_list|,
name|pMAGN
operator|->
name|iLastid
argument_list|,
name|pMAGN
operator|->
name|iMethodX
argument_list|,
name|pMAGN
operator|->
name|iMX
argument_list|,
name|pMAGN
operator|->
name|iMY
argument_list|,
name|pMAGN
operator|->
name|iML
argument_list|,
name|pMAGN
operator|->
name|iMR
argument_list|,
name|pMAGN
operator|->
name|iMT
argument_list|,
name|pMAGN
operator|->
name|iMB
argument_list|,
name|pMAGN
operator|->
name|iMethodY
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_process_display_magn
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iFirstid
argument_list|,
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iLastid
argument_list|,
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMethodX
argument_list|,
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMX
argument_list|,
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMY
argument_list|,
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iML
argument_list|,
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMR
argument_list|,
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMT
argument_list|,
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMB
argument_list|,
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMethodY
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pData
operator|->
name|iMAGNfirstid
operator|=
name|iFirstid
expr_stmt|;
name|pData
operator|->
name|iMAGNlastid
operator|=
name|iLastid
expr_stmt|;
name|pData
operator|->
name|iMAGNmethodX
operator|=
name|iMethodX
expr_stmt|;
name|pData
operator|->
name|iMAGNmX
operator|=
name|iMX
expr_stmt|;
name|pData
operator|->
name|iMAGNmY
operator|=
name|iMY
expr_stmt|;
name|pData
operator|->
name|iMAGNmL
operator|=
name|iML
expr_stmt|;
name|pData
operator|->
name|iMAGNmR
operator|=
name|iMR
expr_stmt|;
name|pData
operator|->
name|iMAGNmT
operator|=
name|iMT
expr_stmt|;
name|pData
operator|->
name|iMAGNmB
operator|=
name|iMB
expr_stmt|;
name|pData
operator|->
name|iMAGNmethodY
operator|=
name|iMethodY
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iMAGNfirstid
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iFirstid
expr_stmt|;
name|pData
operator|->
name|iMAGNlastid
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iLastid
expr_stmt|;
name|pData
operator|->
name|iMAGNmethodX
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMethodX
expr_stmt|;
name|pData
operator|->
name|iMAGNmX
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMX
expr_stmt|;
name|pData
operator|->
name|iMAGNmY
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMY
expr_stmt|;
name|pData
operator|->
name|iMAGNmL
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iML
expr_stmt|;
name|pData
operator|->
name|iMAGNmR
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMR
expr_stmt|;
name|pData
operator|->
name|iMAGNmT
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMT
expr_stmt|;
name|pData
operator|->
name|iMAGNmB
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMB
expr_stmt|;
name|pData
operator|->
name|iMAGNmethodY
operator|=
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMethodY
expr_stmt|;
endif|#
directive|endif
name|iRetcode
operator|=
name|mng_process_display_magn
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_MAGN
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
end_ifndef
begin_function
DECL|function|mng_free_ani_magn
name|mng_retcode
name|mng_free_ani_magn
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_MAGN
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_magn
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_MAGN
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_magn
name|mng_retcode
name|mng_process_ani_magn
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_magnp
name|pMAGN
init|=
operator|(
name|mng_ani_magnp
operator|)
name|pObject
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_MAGN
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
name|iRetcode
operator|=
name|mng_process_display_magn
argument_list|(
name|pData
argument_list|,
name|pMAGN
operator|->
name|iFirstid
argument_list|,
name|pMAGN
operator|->
name|iLastid
argument_list|,
name|pMAGN
operator|->
name|iMethodX
argument_list|,
name|pMAGN
operator|->
name|iMX
argument_list|,
name|pMAGN
operator|->
name|iMY
argument_list|,
name|pMAGN
operator|->
name|iML
argument_list|,
name|pMAGN
operator|->
name|iMR
argument_list|,
name|pMAGN
operator|->
name|iMT
argument_list|,
name|pMAGN
operator|->
name|iMB
argument_list|,
name|pMAGN
operator|->
name|iMethodY
argument_list|)
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iMAGNfirstid
operator|=
name|pMAGN
operator|->
name|iFirstid
expr_stmt|;
name|pData
operator|->
name|iMAGNlastid
operator|=
name|pMAGN
operator|->
name|iLastid
expr_stmt|;
name|pData
operator|->
name|iMAGNmethodX
operator|=
name|pMAGN
operator|->
name|iMethodX
expr_stmt|;
name|pData
operator|->
name|iMAGNmX
operator|=
name|pMAGN
operator|->
name|iMX
expr_stmt|;
name|pData
operator|->
name|iMAGNmY
operator|=
name|pMAGN
operator|->
name|iMY
expr_stmt|;
name|pData
operator|->
name|iMAGNmL
operator|=
name|pMAGN
operator|->
name|iML
expr_stmt|;
name|pData
operator|->
name|iMAGNmR
operator|=
name|pMAGN
operator|->
name|iMR
expr_stmt|;
name|pData
operator|->
name|iMAGNmT
operator|=
name|pMAGN
operator|->
name|iMT
expr_stmt|;
name|pData
operator|->
name|iMAGNmB
operator|=
name|pMAGN
operator|->
name|iMB
expr_stmt|;
name|pData
operator|->
name|iMAGNmethodY
operator|=
name|pMAGN
operator|->
name|iMethodY
expr_stmt|;
name|iRetcode
operator|=
name|mng_process_display_magn
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_MAGN
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_PAST
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_past
name|mng_retcode
name|mng_create_ani_past
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint16
name|iTargetid
argument_list|,
name|mng_uint8
name|iTargettype
argument_list|,
name|mng_int32
name|iTargetx
argument_list|,
name|mng_int32
name|iTargety
argument_list|,
name|mng_uint32
name|iCount
argument_list|,
name|mng_ptr
name|pSources
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_past
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_chunkp
name|pChunk
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_pastp
name|pPAST
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_PAST
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_past
argument_list|)
argument_list|,
name|mng_free_ani_past
argument_list|,
name|mng_process_ani_past
argument_list|,
operator|&
name|pTemp
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pPAST
operator|=
operator|(
name|mng_ani_pastp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pPAST
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_past
argument_list|)
argument_list|)
expr_stmt|;
name|pPAST
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_past
expr_stmt|;
name|pPAST
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_past
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pPAST
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pPAST
operator|->
name|iTargetid
operator|=
name|iTargetid
expr_stmt|;
name|pPAST
operator|->
name|iTargettype
operator|=
name|iTargettype
expr_stmt|;
name|pPAST
operator|->
name|iTargetx
operator|=
name|iTargetx
expr_stmt|;
name|pPAST
operator|->
name|iTargety
operator|=
name|iTargety
expr_stmt|;
name|pPAST
operator|->
name|iCount
operator|=
name|iCount
expr_stmt|;
if|if
condition|(
name|iCount
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pPAST
operator|->
name|pSources
argument_list|,
operator|(
name|iCount
operator|*
sizeof|sizeof
argument_list|(
name|mng_past_source
argument_list|)
operator|)
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pPAST
operator|->
name|pSources
argument_list|,
name|pSources
argument_list|,
operator|(
name|iCount
operator|*
sizeof|sizeof
argument_list|(
name|mng_past_source
argument_list|)
operator|)
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|pPAST
operator|->
name|iTargetid
operator|=
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iDestid
expr_stmt|;
name|pPAST
operator|->
name|iTargettype
operator|=
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iTargettype
expr_stmt|;
name|pPAST
operator|->
name|iTargetx
operator|=
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iTargetx
expr_stmt|;
name|pPAST
operator|->
name|iTargety
operator|=
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iTargety
expr_stmt|;
name|pPAST
operator|->
name|iCount
operator|=
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
expr_stmt|;
if|if
condition|(
name|pPAST
operator|->
name|iCount
condition|)
block|{
name|mng_size_t
name|iSize
init|=
call|(
name|mng_size_t
call|)
argument_list|(
name|pPAST
operator|->
name|iCount
operator|*
sizeof|sizeof
argument_list|(
name|mng_past_source
argument_list|)
argument_list|)
decl_stmt|;
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pPAST
operator|->
name|pSources
argument_list|,
name|iSize
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pPAST
operator|->
name|pSources
argument_list|,
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|pSources
argument_list|,
name|iSize
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
block|}
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|iRetcode
operator|=
name|mng_process_display_past
argument_list|(
name|pData
argument_list|,
name|iTargetid
argument_list|,
name|iTargettype
argument_list|,
name|iTargetx
argument_list|,
name|iTargety
argument_list|,
name|iCount
argument_list|,
name|pSources
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_process_display_past
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iDestid
argument_list|,
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iTargettype
argument_list|,
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iTargetx
argument_list|,
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iTargety
argument_list|,
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
argument_list|,
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|pSources
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pData
operator|->
name|iPASTtargetid
operator|=
name|iTargetid
expr_stmt|;
name|pData
operator|->
name|iPASTtargettype
operator|=
name|iTargettype
expr_stmt|;
name|pData
operator|->
name|iPASTtargetx
operator|=
name|iTargetx
expr_stmt|;
name|pData
operator|->
name|iPASTtargety
operator|=
name|iTargety
expr_stmt|;
name|pData
operator|->
name|iPASTcount
operator|=
name|iCount
expr_stmt|;
name|pData
operator|->
name|pPASTsources
operator|=
name|pSources
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iPASTtargetid
operator|=
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iDestid
expr_stmt|;
name|pData
operator|->
name|iPASTtargettype
operator|=
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iTargettype
expr_stmt|;
name|pData
operator|->
name|iPASTtargetx
operator|=
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iTargetx
expr_stmt|;
name|pData
operator|->
name|iPASTtargety
operator|=
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iTargety
expr_stmt|;
name|pData
operator|->
name|iPASTcount
operator|=
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
expr_stmt|;
name|pData
operator|->
name|pPASTsources
operator|=
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|pSources
expr_stmt|;
endif|#
directive|endif
name|iRetcode
operator|=
name|mng_process_display_past
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_PAST
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_decl_stmt
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_PAST
end_ifndef
begin_function
DECL|function|mng_free_ani_past
name|mng_retcode
name|mng_free_ani_past
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_pastp
name|pPAST
init|=
operator|(
name|mng_ani_pastp
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_PAST
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pPAST
operator|->
name|iCount
condition|)
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pPAST
operator|->
name|pSources
argument_list|,
operator|(
name|pPAST
operator|->
name|iCount
operator|*
sizeof|sizeof
argument_list|(
name|mng_past_source
argument_list|)
operator|)
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_past
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_PAST
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
return|return
name|MNG_NOERROR
return|;
else|#
directive|else
return|return
name|mng_free_obj_general
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|)
return|;
endif|#
directive|endif
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_PAST
end_ifndef
begin_function
DECL|function|mng_process_ani_past
name|mng_retcode
name|mng_process_ani_past
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_pastp
name|pPAST
init|=
operator|(
name|mng_ani_pastp
operator|)
name|pObject
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_PAST
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
name|iRetcode
operator|=
name|mng_process_display_past
argument_list|(
name|pData
argument_list|,
name|pPAST
operator|->
name|iTargetid
argument_list|,
name|pPAST
operator|->
name|iTargettype
argument_list|,
name|pPAST
operator|->
name|iTargetx
argument_list|,
name|pPAST
operator|->
name|iTargety
argument_list|,
name|pPAST
operator|->
name|iCount
argument_list|,
name|pPAST
operator|->
name|pSources
argument_list|)
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iPASTtargetid
operator|=
name|pPAST
operator|->
name|iTargetid
expr_stmt|;
name|pData
operator|->
name|iPASTtargettype
operator|=
name|pPAST
operator|->
name|iTargettype
expr_stmt|;
name|pData
operator|->
name|iPASTtargetx
operator|=
name|pPAST
operator|->
name|iTargetx
expr_stmt|;
name|pData
operator|->
name|iPASTtargety
operator|=
name|pPAST
operator|->
name|iTargety
expr_stmt|;
name|pData
operator|->
name|iPASTcount
operator|=
name|pPAST
operator|->
name|iCount
expr_stmt|;
name|pData
operator|->
name|pPASTsources
operator|=
name|pPAST
operator|->
name|pSources
expr_stmt|;
name|iRetcode
operator|=
name|mng_process_display_past
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_PAST
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_DISC
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ani_disc
name|mng_retcode
name|mng_create_ani_disc
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint32
name|iCount
argument_list|,
name|mng_uint16p
name|pIds
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ani_disc
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_chunkp
name|pChunk
argument_list|)
endif|#
directive|endif
block|{
name|mng_ani_discp
name|pDISC
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_DISC
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_disc
argument_list|)
argument_list|,
name|mng_free_ani_disc
argument_list|,
name|mng_process_ani_disc
argument_list|,
operator|&
name|pTemp
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pDISC
operator|=
operator|(
name|mng_ani_discp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pDISC
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_disc
argument_list|)
argument_list|)
expr_stmt|;
name|pDISC
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_disc
expr_stmt|;
name|pDISC
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_disc
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pDISC
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pDISC
operator|->
name|iCount
operator|=
name|iCount
expr_stmt|;
if|if
condition|(
name|iCount
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pDISC
operator|->
name|pIds
argument_list|,
operator|(
name|iCount
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pDISC
operator|->
name|pIds
argument_list|,
name|pIds
argument_list|,
operator|(
name|iCount
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|pDISC
operator|->
name|iCount
operator|=
operator|(
operator|(
name|mng_discp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
expr_stmt|;
if|if
condition|(
name|pDISC
operator|->
name|iCount
condition|)
block|{
name|mng_size_t
name|iSize
init|=
call|(
name|mng_size_t
call|)
argument_list|(
name|pDISC
operator|->
name|iCount
operator|<<
literal|1
argument_list|)
decl_stmt|;
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pDISC
operator|->
name|pIds
argument_list|,
name|iSize
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pDISC
operator|->
name|pIds
argument_list|,
operator|(
operator|(
name|mng_discp
operator|)
name|pChunk
operator|)
operator|->
name|pObjectids
argument_list|,
name|iSize
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
block|}
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|iRetcode
operator|=
name|mng_process_display_disc
argument_list|(
name|pData
argument_list|,
name|iCount
argument_list|,
name|pIds
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_process_display_disc
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_discp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
argument_list|,
operator|(
operator|(
name|mng_discp
operator|)
name|pChunk
operator|)
operator|->
name|pObjectids
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pData
operator|->
name|iDISCcount
operator|=
name|iCount
expr_stmt|;
name|pData
operator|->
name|pDISCids
operator|=
name|pIds
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iDISCcount
operator|=
operator|(
operator|(
name|mng_discp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
expr_stmt|;
name|pData
operator|->
name|pDISCids
operator|=
operator|(
operator|(
name|mng_discp
operator|)
name|pChunk
operator|)
operator|->
name|pObjectids
expr_stmt|;
endif|#
directive|endif
name|iRetcode
operator|=
name|mng_process_display_disc
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANI_DISC
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_free_ani_disc
name|mng_retcode
name|mng_free_ani_disc
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_discp
name|pDISC
init|=
operator|(
name|mng_ani_discp
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_DISC
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pDISC
operator|->
name|iCount
condition|)
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pDISC
operator|->
name|pIds
argument_list|,
operator|(
name|pDISC
operator|->
name|iCount
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_disc
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANI_DISC
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
return|return
name|MNG_NOERROR
return|;
else|#
directive|else
return|return
name|mng_free_obj_general
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|)
return|;
endif|#
directive|endif
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ani_disc
name|mng_retcode
name|mng_process_ani_disc
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ani_discp
name|pDISC
init|=
operator|(
name|mng_ani_discp
operator|)
name|pObject
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_DISC
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_DISPLAYCALLS
name|iRetcode
operator|=
name|mng_process_display_disc
argument_list|(
name|pData
argument_list|,
name|pDISC
operator|->
name|iCount
argument_list|,
name|pDISC
operator|->
name|pIds
argument_list|)
expr_stmt|;
else|#
directive|else
name|pData
operator|->
name|iDISCcount
operator|=
name|pDISC
operator|->
name|iCount
expr_stmt|;
name|pData
operator|->
name|pDISCids
operator|=
name|pDISC
operator|->
name|pIds
expr_stmt|;
name|iRetcode
operator|=
name|mng_process_display_disc
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANI_DISC
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DYNAMICMNG
end_ifdef
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_event
name|mng_retcode
name|mng_create_event
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint8
name|iEventtype
argument_list|,
name|mng_uint8
name|iMasktype
argument_list|,
name|mng_int32
name|iLeft
argument_list|,
name|mng_int32
name|iRight
argument_list|,
name|mng_int32
name|iTop
argument_list|,
name|mng_int32
name|iBottom
argument_list|,
name|mng_uint16
name|iObjectid
argument_list|,
name|mng_uint8
name|iIndex
argument_list|,
name|mng_uint32
name|iSegmentnamesize
argument_list|,
name|mng_pchar
name|zSegmentname
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_event
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_ptr
name|pEntry
argument_list|)
endif|#
directive|endif
block|{
name|mng_eventp
name|pEvent
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_EVENT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* caching playback info ? */
block|{
name|mng_object_headerp
name|pLast
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
init|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_event
argument_list|)
argument_list|,
name|mng_free_event
argument_list|,
name|mng_process_event
argument_list|,
operator|&
name|pTemp
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pEvent
operator|=
operator|(
name|mng_eventp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pEvent
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_event
argument_list|)
argument_list|)
expr_stmt|;
name|pEvent
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_event
expr_stmt|;
name|pEvent
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_event
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pEvent
operator|->
name|iEventtype
operator|=
name|iEventtype
expr_stmt|;
name|pEvent
operator|->
name|iMasktype
operator|=
name|iMasktype
expr_stmt|;
name|pEvent
operator|->
name|iLeft
operator|=
name|iLeft
expr_stmt|;
name|pEvent
operator|->
name|iRight
operator|=
name|iRight
expr_stmt|;
name|pEvent
operator|->
name|iTop
operator|=
name|iTop
expr_stmt|;
name|pEvent
operator|->
name|iBottom
operator|=
name|iBottom
expr_stmt|;
name|pEvent
operator|->
name|iObjectid
operator|=
name|iObjectid
expr_stmt|;
name|pEvent
operator|->
name|iIndex
operator|=
name|iIndex
expr_stmt|;
name|pEvent
operator|->
name|iSegmentnamesize
operator|=
name|iSegmentnamesize
expr_stmt|;
if|if
condition|(
name|iSegmentnamesize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pEvent
operator|->
name|zSegmentname
argument_list|,
name|iSegmentnamesize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pEvent
operator|->
name|zSegmentname
argument_list|,
name|zSegmentname
argument_list|,
name|iSegmentnamesize
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|pEvent
operator|->
name|iEventtype
operator|=
operator|(
operator|(
name|mng_evnt_entryp
operator|)
name|pEntry
operator|)
operator|->
name|iEventtype
expr_stmt|;
name|pEvent
operator|->
name|iMasktype
operator|=
operator|(
operator|(
name|mng_evnt_entryp
operator|)
name|pEntry
operator|)
operator|->
name|iMasktype
expr_stmt|;
name|pEvent
operator|->
name|iLeft
operator|=
operator|(
operator|(
name|mng_evnt_entryp
operator|)
name|pEntry
operator|)
operator|->
name|iLeft
expr_stmt|;
name|pEvent
operator|->
name|iRight
operator|=
operator|(
operator|(
name|mng_evnt_entryp
operator|)
name|pEntry
operator|)
operator|->
name|iRight
expr_stmt|;
name|pEvent
operator|->
name|iTop
operator|=
operator|(
operator|(
name|mng_evnt_entryp
operator|)
name|pEntry
operator|)
operator|->
name|iTop
expr_stmt|;
name|pEvent
operator|->
name|iBottom
operator|=
operator|(
operator|(
name|mng_evnt_entryp
operator|)
name|pEntry
operator|)
operator|->
name|iBottom
expr_stmt|;
name|pEvent
operator|->
name|iObjectid
operator|=
operator|(
operator|(
name|mng_evnt_entryp
operator|)
name|pEntry
operator|)
operator|->
name|iObjectid
expr_stmt|;
name|pEvent
operator|->
name|iIndex
operator|=
operator|(
operator|(
name|mng_evnt_entryp
operator|)
name|pEntry
operator|)
operator|->
name|iIndex
expr_stmt|;
name|pEvent
operator|->
name|iSegmentnamesize
operator|=
operator|(
operator|(
name|mng_evnt_entryp
operator|)
name|pEntry
operator|)
operator|->
name|iSegmentnamesize
expr_stmt|;
if|if
condition|(
name|pEvent
operator|->
name|iSegmentnamesize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pEvent
operator|->
name|zSegmentname
argument_list|,
name|pEvent
operator|->
name|iSegmentnamesize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pEvent
operator|->
name|zSegmentname
argument_list|,
operator|(
operator|(
name|mng_evnt_entryp
operator|)
name|pEntry
operator|)
operator|->
name|zSegmentname
argument_list|,
name|pEvent
operator|->
name|iSegmentnamesize
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* fixup the double-linked list */
name|pLast
operator|=
operator|(
name|mng_object_headerp
operator|)
name|pData
operator|->
name|pLastevent
expr_stmt|;
if|if
condition|(
name|pLast
condition|)
comment|/* link it as last in the chain */
block|{
name|pEvent
operator|->
name|sHeader
operator|.
name|pPrev
operator|=
name|pLast
expr_stmt|;
name|pLast
operator|->
name|pNext
operator|=
name|pEvent
expr_stmt|;
block|}
else|else
block|{
name|pData
operator|->
name|pFirstevent
operator|=
name|pEvent
expr_stmt|;
block|}
name|pData
operator|->
name|pLastevent
operator|=
name|pEvent
expr_stmt|;
name|pData
operator|->
name|bDynamic
operator|=
name|MNG_TRUE
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_EVENT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_free_event
name|mng_retcode
name|mng_free_event
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_eventp
name|pEvent
init|=
operator|(
name|mng_eventp
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_EVENT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pEvent
operator|->
name|iSegmentnamesize
condition|)
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pEvent
operator|->
name|zSegmentname
argument_list|,
name|pEvent
operator|->
name|iSegmentnamesize
operator|+
literal|1
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pEvent
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_event
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_EVENT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
return|return
name|MNG_NOERROR
return|;
else|#
directive|else
return|return
name|mng_free_obj_general
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|)
return|;
endif|#
directive|endif
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_event
name|mng_retcode
name|mng_process_event
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SEEK
name|mng_eventp
name|pEvent
init|=
operator|(
name|mng_eventp
operator|)
name|pObject
decl_stmt|;
name|mng_object_headerp
name|pAni
decl_stmt|;
name|mng_bool
name|bFound
init|=
name|MNG_FALSE
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_EVENT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SEEK
if|if
condition|(
operator|!
name|pEvent
operator|->
name|pSEEK
condition|)
comment|/* need to find SEEK first ? */
block|{
name|pAni
operator|=
operator|(
name|mng_object_headerp
operator|)
name|pData
operator|->
name|pFirstaniobj
expr_stmt|;
while|while
condition|(
operator|(
name|pAni
operator|)
operator|&&
operator|(
operator|!
name|bFound
operator|)
condition|)
block|{
if|if
condition|(
operator|(
name|pAni
operator|->
name|fCleanup
operator|==
name|mng_free_ani_seek
operator|)
operator|&&
operator|(
name|strcmp
argument_list|(
name|pEvent
operator|->
name|zSegmentname
argument_list|,
operator|(
operator|(
name|mng_ani_seekp
operator|)
name|pAni
operator|)
operator|->
name|zSegmentname
argument_list|)
operator|==
literal|0
operator|)
condition|)
name|bFound
operator|=
name|MNG_TRUE
expr_stmt|;
else|else
name|pAni
operator|=
operator|(
name|mng_object_headerp
operator|)
name|pAni
operator|->
name|pNext
expr_stmt|;
block|}
if|if
condition|(
name|pAni
condition|)
name|pEvent
operator|->
name|pSEEK
operator|=
operator|(
name|mng_ani_seekp
operator|)
name|pAni
expr_stmt|;
block|}
if|if
condition|(
name|pEvent
operator|->
name|pSEEK
condition|)
comment|/* anything to do ? */
block|{
name|pEvent
operator|->
name|iLastx
operator|=
name|pData
operator|->
name|iEventx
expr_stmt|;
name|pEvent
operator|->
name|iLasty
operator|=
name|pData
operator|->
name|iEventy
expr_stmt|;
comment|/* let's start from this SEEK then */
name|pData
operator|->
name|pCurraniobj
operator|=
operator|(
name|mng_objectp
operator|)
name|pEvent
operator|->
name|pSEEK
expr_stmt|;
name|pData
operator|->
name|bRunningevent
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* wake-up the app ! */
if|if
condition|(
operator|!
name|pData
operator|->
name|fSettimer
argument_list|(
operator|(
name|mng_handle
operator|)
name|pData
argument_list|,
literal|5
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_APPTIMERERROR
argument_list|)
expr_stmt|;
block|}
else|else
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_SEEKNOTFOUND
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_EVENT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_DYNAMICMNG */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_MPNG_PROPOSAL
end_ifdef
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_mpng_obj
name|mng_retcode
name|mng_create_mpng_obj
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint32
name|iFramewidth
argument_list|,
name|mng_uint32
name|iFrameheight
argument_list|,
name|mng_uint16
name|iNumplays
argument_list|,
name|mng_uint16
name|iTickspersec
argument_list|,
name|mng_uint32
name|iFramessize
argument_list|,
name|mng_ptr
name|pFrames
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_mpng_obj
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_ptr
name|pEntry
argument_list|)
endif|#
directive|endif
block|{
name|mng_mpng_objp
name|pMPNG
decl_stmt|;
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
name|mng_uint8p
name|pFrame
decl_stmt|;
name|mng_int32
name|iCnt
decl_stmt|,
name|iMax
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|,
name|iY
decl_stmt|,
name|iWidth
decl_stmt|,
name|iHeight
decl_stmt|;
name|mng_int32
name|iXoffset
decl_stmt|,
name|iYoffset
decl_stmt|;
name|mng_uint16
name|iTicks
decl_stmt|;
name|mng_uint16
name|iDelay
decl_stmt|;
name|mng_bool
name|bNewframe
decl_stmt|;
name|mng_ani_loopp
name|pLOOP
decl_stmt|;
name|mng_ani_endlp
name|pENDL
decl_stmt|;
name|mng_ani_framp
name|pFRAM
decl_stmt|;
name|mng_ani_movep
name|pMOVE
decl_stmt|;
name|mng_ani_clipp
name|pCLIP
decl_stmt|;
name|mng_ani_showp
name|pSHOW
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_MPNG_OBJ
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_mpng_obj
argument_list|)
argument_list|,
name|mng_free_mpng_obj
argument_list|,
name|mng_process_mpng_obj
argument_list|,
operator|&
name|pTemp
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pMPNG
operator|=
operator|(
name|mng_mpng_objp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pMPNG
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_mpng_obj
argument_list|)
argument_list|)
expr_stmt|;
name|pMPNG
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_mpng_obj
expr_stmt|;
name|pMPNG
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_mpng_obj
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pMPNG
operator|->
name|iFramewidth
operator|=
name|iFramewidth
expr_stmt|;
name|pMPNG
operator|->
name|iFrameheight
operator|=
name|iFrameheight
expr_stmt|;
name|pMPNG
operator|->
name|iNumplays
operator|=
name|iNumplays
expr_stmt|;
name|pMPNG
operator|->
name|iTickspersec
operator|=
name|iTickspersec
expr_stmt|;
name|pMPNG
operator|->
name|iFramessize
operator|=
name|iFramessize
expr_stmt|;
if|if
condition|(
name|iFramessize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pMPNG
operator|->
name|pFrames
argument_list|,
name|iFramessize
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pMPNG
operator|->
name|pFrames
argument_list|,
name|pFrames
argument_list|,
name|iFramessize
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|pMPNG
operator|->
name|iFramewidth
operator|=
operator|(
operator|(
name|mng_mpngp
operator|)
name|pEntry
operator|)
operator|->
name|iFramewidth
expr_stmt|;
name|pMPNG
operator|->
name|iFrameheight
operator|=
operator|(
operator|(
name|mng_mpngp
operator|)
name|pEntry
operator|)
operator|->
name|iFrameheight
expr_stmt|;
name|pMPNG
operator|->
name|iNumplays
operator|=
operator|(
operator|(
name|mng_mpngp
operator|)
name|pEntry
operator|)
operator|->
name|iNumplays
expr_stmt|;
name|pMPNG
operator|->
name|iTickspersec
operator|=
operator|(
operator|(
name|mng_mpngp
operator|)
name|pEntry
operator|)
operator|->
name|iTickspersec
expr_stmt|;
name|pMPNG
operator|->
name|iFramessize
operator|=
operator|(
operator|(
name|mng_mpngp
operator|)
name|pEntry
operator|)
operator|->
name|iFramessize
expr_stmt|;
if|if
condition|(
name|pMPNG
operator|->
name|iFramessize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pMPNG
operator|->
name|pFrames
argument_list|,
name|pMPNG
operator|->
name|iFramessize
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pMPNG
operator|->
name|pFrames
argument_list|,
operator|(
operator|(
name|mng_mpngp
operator|)
name|pEntry
operator|)
operator|->
name|pFrames
argument_list|,
name|pMPNG
operator|->
name|iFramessize
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
name|pData
operator|->
name|pMPNG
operator|=
name|pMPNG
expr_stmt|;
name|pData
operator|->
name|eImagetype
operator|=
name|mng_it_mpng
expr_stmt|;
name|iRetcode
operator|=
name|mng_process_display_mpng
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
comment|/* now let's create the MNG animation directives from this */
name|pFrame
operator|=
operator|(
name|mng_uint8p
operator|)
name|pMPNG
operator|->
name|pFrames
expr_stmt|;
name|iMax
operator|=
name|pMPNG
operator|->
name|iFramessize
operator|/
literal|26
expr_stmt|;
comment|/* set up MNG impersonation */
name|pData
operator|->
name|iTicks
operator|=
name|pMPNG
operator|->
name|iTickspersec
expr_stmt|;
name|pData
operator|->
name|iLayercount
operator|=
name|iMax
expr_stmt|;
if|if
condition|(
name|pMPNG
operator|->
name|iNumplays
operator|!=
literal|1
condition|)
comment|/* create a LOOP/ENDL pair ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_loop
argument_list|)
argument_list|,
name|mng_free_ani_loop
argument_list|,
name|mng_process_ani_loop
argument_list|,
operator|&
operator|(
operator|(
name|mng_ptr
operator|)
name|pLOOP
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pLOOP
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_loop
argument_list|)
argument_list|)
expr_stmt|;
name|pLOOP
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_loop
expr_stmt|;
name|pLOOP
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_loop
expr_stmt|;
endif|#
directive|endif
name|pLOOP
operator|->
name|iLevel
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|pMPNG
operator|->
name|iNumplays
condition|)
name|pLOOP
operator|->
name|iRepeatcount
operator|=
name|pMPNG
operator|->
name|iNumplays
expr_stmt|;
else|else
name|pLOOP
operator|->
name|iRepeatcount
operator|=
literal|0xFFFFFFFFl
expr_stmt|;
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pLOOP
argument_list|)
expr_stmt|;
block|}
name|bNewframe
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* create the frame display objects */
for|for
control|(
name|iCnt
operator|=
literal|0
init|;
name|iCnt
operator|<
name|iMax
condition|;
name|iCnt
operator|++
control|)
block|{
name|iX
operator|=
name|mng_get_uint32
argument_list|(
name|pFrame
argument_list|)
expr_stmt|;
name|iY
operator|=
name|mng_get_uint32
argument_list|(
name|pFrame
operator|+
literal|4
argument_list|)
expr_stmt|;
name|iWidth
operator|=
name|mng_get_uint32
argument_list|(
name|pFrame
operator|+
literal|8
argument_list|)
expr_stmt|;
name|iHeight
operator|=
name|mng_get_uint32
argument_list|(
name|pFrame
operator|+
literal|12
argument_list|)
expr_stmt|;
name|iXoffset
operator|=
name|mng_get_int32
argument_list|(
name|pFrame
operator|+
literal|16
argument_list|)
expr_stmt|;
name|iYoffset
operator|=
name|mng_get_int32
argument_list|(
name|pFrame
operator|+
literal|20
argument_list|)
expr_stmt|;
name|iTicks
operator|=
name|mng_get_uint16
argument_list|(
name|pFrame
operator|+
literal|24
argument_list|)
expr_stmt|;
name|iDelay
operator|=
name|iTicks
expr_stmt|;
if|if
condition|(
operator|!
name|iDelay
condition|)
block|{
name|mng_uint8p
name|pTemp
init|=
name|pFrame
operator|+
literal|26
decl_stmt|;
name|mng_int32
name|iTemp
init|=
name|iCnt
operator|+
literal|1
decl_stmt|;
while|while
condition|(
operator|(
name|iTemp
operator|<
name|iMax
operator|)
operator|&&
operator|(
operator|!
name|iDelay
operator|)
condition|)
block|{
name|iDelay
operator|=
name|mng_get_uint16
argument_list|(
name|pTemp
operator|+
literal|24
argument_list|)
expr_stmt|;
name|pTemp
operator|+=
literal|26
expr_stmt|;
name|iTemp
operator|++
expr_stmt|;
block|}
block|}
if|if
condition|(
name|bNewframe
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_fram
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_fram
argument_list|,
operator|&
operator|(
operator|(
name|mng_ptr
operator|)
name|pFRAM
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pFRAM
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_fram
argument_list|)
argument_list|)
expr_stmt|;
name|pFRAM
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_fram
expr_stmt|;
name|pFRAM
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_fram
expr_stmt|;
endif|#
directive|endif
name|pFRAM
operator|->
name|iFramemode
operator|=
literal|4
expr_stmt|;
name|pFRAM
operator|->
name|iChangedelay
operator|=
literal|1
expr_stmt|;
name|pFRAM
operator|->
name|iDelay
operator|=
name|iDelay
expr_stmt|;
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pFRAM
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_move
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_move
argument_list|,
operator|&
operator|(
operator|(
name|mng_ptr
operator|)
name|pMOVE
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pMOVE
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_move
argument_list|)
argument_list|)
expr_stmt|;
name|pMOVE
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_move
expr_stmt|;
name|pMOVE
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_move
expr_stmt|;
endif|#
directive|endif
name|pMOVE
operator|->
name|iLocax
operator|=
name|iXoffset
operator|-
operator|(
name|mng_int32
operator|)
name|iX
expr_stmt|;
name|pMOVE
operator|->
name|iLocay
operator|=
name|iYoffset
operator|-
operator|(
name|mng_int32
operator|)
name|iY
expr_stmt|;
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pMOVE
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_clip
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_clip
argument_list|,
operator|&
operator|(
operator|(
name|mng_ptr
operator|)
name|pCLIP
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pCLIP
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_clip
argument_list|)
argument_list|)
expr_stmt|;
name|pCLIP
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_clip
expr_stmt|;
name|pCLIP
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_clip
expr_stmt|;
endif|#
directive|endif
name|pCLIP
operator|->
name|iClipl
operator|=
name|iXoffset
expr_stmt|;
name|pCLIP
operator|->
name|iClipr
operator|=
name|iXoffset
operator|+
operator|(
name|mng_int32
operator|)
name|iWidth
expr_stmt|;
name|pCLIP
operator|->
name|iClipt
operator|=
name|iYoffset
expr_stmt|;
name|pCLIP
operator|->
name|iClipb
operator|=
name|iYoffset
operator|+
operator|(
name|mng_int32
operator|)
name|iHeight
expr_stmt|;
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pCLIP
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_show
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_show
argument_list|,
operator|&
operator|(
operator|(
name|mng_ptr
operator|)
name|pSHOW
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pSHOW
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_show
argument_list|)
argument_list|)
expr_stmt|;
name|pSHOW
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_show
expr_stmt|;
name|pSHOW
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_show
expr_stmt|;
endif|#
directive|endif
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pSHOW
argument_list|)
expr_stmt|;
name|bNewframe
operator|=
operator|(
name|mng_bool
operator|)
name|iTicks
expr_stmt|;
name|pFrame
operator|+=
literal|26
expr_stmt|;
block|}
if|if
condition|(
name|pMPNG
operator|->
name|iNumplays
operator|!=
literal|1
condition|)
comment|/* create a LOOP/ENDL pair ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_endl
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_endl
argument_list|,
operator|&
operator|(
operator|(
name|mng_ptr
operator|)
name|pENDL
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pENDL
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_endl
argument_list|)
argument_list|)
expr_stmt|;
name|pENDL
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_endl
expr_stmt|;
name|pENDL
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_endl
expr_stmt|;
endif|#
directive|endif
name|pENDL
operator|->
name|iLevel
operator|=
literal|1
expr_stmt|;
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pENDL
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_MPNG_OBJ
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_free_mpng_obj
name|mng_retcode
name|mng_free_mpng_obj
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_mpng_objp
name|pMPNG
init|=
operator|(
name|mng_mpng_objp
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_MPNG_OBJ
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pMPNG
operator|->
name|iFramessize
condition|)
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pMPNG
operator|->
name|pFrames
argument_list|,
name|pMPNG
operator|->
name|iFramessize
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pMPNG
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_mpng_obj
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_MPNG_OBJ
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
return|return
name|MNG_NOERROR
return|;
else|#
directive|else
return|return
name|mng_free_obj_general
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|)
return|;
endif|#
directive|endif
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_mpng_obj
name|mng_retcode
name|mng_process_mpng_obj
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_INCLUDE_MPNG_PROPOSAL */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_ANG_PROPOSAL
end_ifdef
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifndef
begin_decl_stmt
DECL|function|mng_create_ang_obj
name|mng_retcode
name|mng_create_ang_obj
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_uint32
name|iNumframes
argument_list|,
name|mng_uint32
name|iTickspersec
argument_list|,
name|mng_uint32
name|iNumplays
argument_list|,
name|mng_uint32
name|iTilewidth
argument_list|,
name|mng_uint32
name|iTileheight
argument_list|,
name|mng_uint8
name|iInterlace
argument_list|,
name|mng_uint8
name|iStillused
argument_list|)
else|#
directive|else
name|mng_retcode
name|mng_create_ang_obj
argument_list|(
name|mng_datap
name|pData
argument_list|,
name|mng_ptr
name|pEntry
argument_list|)
endif|#
directive|endif
block|{
name|mng_ang_objp
name|pANG
decl_stmt|;
name|mng_ptr
name|pTemp
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANG_OBJ
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ang_obj
argument_list|)
argument_list|,
name|mng_free_ang_obj
argument_list|,
name|mng_process_ang_obj
argument_list|,
operator|&
name|pTemp
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
name|pANG
operator|=
operator|(
name|mng_ang_objp
operator|)
name|pTemp
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pANG
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ang_obj
argument_list|)
argument_list|)
expr_stmt|;
name|pANG
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ang_obj
expr_stmt|;
name|pANG
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ang_obj
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|pANG
operator|->
name|iNumframes
operator|=
name|iNumframes
expr_stmt|;
name|pANG
operator|->
name|iTickspersec
operator|=
name|iTickspersec
expr_stmt|;
name|pANG
operator|->
name|iNumplays
operator|=
name|iNumplays
expr_stmt|;
name|pANG
operator|->
name|iTilewidth
operator|=
name|iTilewidth
expr_stmt|;
name|pANG
operator|->
name|iTileheight
operator|=
name|iTileheight
expr_stmt|;
name|pANG
operator|->
name|iInterlace
operator|=
name|iInterlace
expr_stmt|;
name|pANG
operator|->
name|iStillused
operator|=
name|iStillused
expr_stmt|;
else|#
directive|else
name|pANG
operator|->
name|iNumframes
operator|=
operator|(
operator|(
name|mng_ahdrp
operator|)
name|pEntry
operator|)
operator|->
name|iNumframes
expr_stmt|;
name|pANG
operator|->
name|iTickspersec
operator|=
operator|(
operator|(
name|mng_ahdrp
operator|)
name|pEntry
operator|)
operator|->
name|iTickspersec
expr_stmt|;
name|pANG
operator|->
name|iNumplays
operator|=
operator|(
operator|(
name|mng_ahdrp
operator|)
name|pEntry
operator|)
operator|->
name|iNumplays
expr_stmt|;
name|pANG
operator|->
name|iTilewidth
operator|=
operator|(
operator|(
name|mng_ahdrp
operator|)
name|pEntry
operator|)
operator|->
name|iTilewidth
expr_stmt|;
name|pANG
operator|->
name|iTileheight
operator|=
operator|(
operator|(
name|mng_ahdrp
operator|)
name|pEntry
operator|)
operator|->
name|iTileheight
expr_stmt|;
name|pANG
operator|->
name|iInterlace
operator|=
operator|(
operator|(
name|mng_ahdrp
operator|)
name|pEntry
operator|)
operator|->
name|iInterlace
expr_stmt|;
name|pANG
operator|->
name|iStillused
operator|=
operator|(
operator|(
name|mng_ahdrp
operator|)
name|pEntry
operator|)
operator|->
name|iStillused
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|pANG
operator|=
name|pANG
expr_stmt|;
name|pData
operator|->
name|eImagetype
operator|=
name|mng_it_ang
expr_stmt|;
name|iRetcode
operator|=
name|mng_process_display_ang
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CREATE_ANG_OBJ
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_free_ang_obj
name|mng_retcode
name|mng_free_ang_obj
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ang_objp
name|pANG
init|=
operator|(
name|mng_ang_objp
operator|)
name|pObject
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANG_OBJ
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pANG
operator|->
name|iTilessize
condition|)
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pANG
operator|->
name|pTiles
argument_list|,
name|pANG
operator|->
name|iTilessize
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pANG
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ang_obj
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FREE_ANG_OBJ
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_OBJCLEANUP
return|return
name|MNG_NOERROR
return|;
else|#
directive|else
return|return
name|mng_free_obj_general
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|)
return|;
endif|#
directive|endif
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ang_obj
name|mng_retcode
name|mng_process_ang_obj
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_objectp
name|pObject
parameter_list|)
block|{
name|mng_ang_objp
name|pANG
init|=
operator|(
name|mng_ang_objp
operator|)
name|pObject
decl_stmt|;
name|mng_uint8p
name|pTile
init|=
operator|(
name|mng_uint8p
operator|)
name|pANG
operator|->
name|pTiles
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
name|mng_int32
name|iCnt
decl_stmt|,
name|iMax
decl_stmt|;
name|mng_uint32
name|iTicks
decl_stmt|;
name|mng_int32
name|iXoffset
decl_stmt|,
name|iYoffset
decl_stmt|;
name|mng_uint8
name|iSource
decl_stmt|;
name|mng_ani_loopp
name|pLOOP
decl_stmt|;
name|mng_ani_endlp
name|pENDL
decl_stmt|;
name|mng_ani_framp
name|pFRAM
decl_stmt|;
name|mng_ani_movep
name|pMOVE
decl_stmt|;
name|mng_ani_showp
name|pSHOW
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANG_OBJ
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* let's create the MNG animation directives from this */
name|iMax
operator|=
name|pANG
operator|->
name|iNumframes
expr_stmt|;
comment|/* set up MNG impersonation */
name|pData
operator|->
name|iTicks
operator|=
name|pANG
operator|->
name|iTickspersec
expr_stmt|;
name|pData
operator|->
name|iLayercount
operator|=
name|iMax
expr_stmt|;
if|if
condition|(
name|pANG
operator|->
name|iNumplays
operator|!=
literal|1
condition|)
comment|/* create a LOOP/ENDL pair ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_loop
argument_list|)
argument_list|,
name|mng_free_ani_loop
argument_list|,
name|mng_process_ani_loop
argument_list|,
operator|&
operator|(
operator|(
name|mng_ptr
operator|)
name|pLOOP
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pLOOP
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_loop
argument_list|)
argument_list|)
expr_stmt|;
name|pLOOP
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_loop
expr_stmt|;
name|pLOOP
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_loop
expr_stmt|;
endif|#
directive|endif
name|pLOOP
operator|->
name|iLevel
operator|=
literal|1
expr_stmt|;
if|if
condition|(
name|pANG
operator|->
name|iNumplays
condition|)
name|pLOOP
operator|->
name|iRepeatcount
operator|=
name|pANG
operator|->
name|iNumplays
expr_stmt|;
else|else
name|pLOOP
operator|->
name|iRepeatcount
operator|=
literal|0xFFFFFFFFl
expr_stmt|;
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pLOOP
argument_list|)
expr_stmt|;
block|}
for|for
control|(
name|iCnt
operator|=
literal|0
init|;
name|iCnt
operator|<
name|iMax
condition|;
name|iCnt
operator|++
control|)
block|{
name|iTicks
operator|=
name|mng_get_uint32
argument_list|(
name|pTile
argument_list|)
expr_stmt|;
name|iXoffset
operator|=
name|mng_get_int32
argument_list|(
name|pTile
operator|+
literal|4
argument_list|)
expr_stmt|;
name|iYoffset
operator|=
name|mng_get_int32
argument_list|(
name|pTile
operator|+
literal|8
argument_list|)
expr_stmt|;
name|iSource
operator|=
operator|*
operator|(
name|pTile
operator|+
literal|12
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_fram
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_fram
argument_list|,
operator|&
operator|(
operator|(
name|mng_ptr
operator|)
name|pFRAM
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pFRAM
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_fram
argument_list|)
argument_list|)
expr_stmt|;
name|pFRAM
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_fram
expr_stmt|;
name|pFRAM
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_fram
expr_stmt|;
endif|#
directive|endif
name|pFRAM
operator|->
name|iFramemode
operator|=
literal|4
expr_stmt|;
name|pFRAM
operator|->
name|iChangedelay
operator|=
literal|1
expr_stmt|;
name|pFRAM
operator|->
name|iDelay
operator|=
name|iTicks
expr_stmt|;
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pFRAM
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|iSource
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_move
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_move
argument_list|,
operator|&
operator|(
operator|(
name|mng_ptr
operator|)
name|pMOVE
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pMOVE
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_move
argument_list|)
argument_list|)
expr_stmt|;
name|pMOVE
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_move
expr_stmt|;
name|pMOVE
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_move
expr_stmt|;
endif|#
directive|endif
name|pMOVE
operator|->
name|iFirstid
operator|=
literal|1
expr_stmt|;
name|pMOVE
operator|->
name|iLastid
operator|=
literal|1
expr_stmt|;
name|pMOVE
operator|->
name|iLocax
operator|=
operator|-
name|iXoffset
expr_stmt|;
name|pMOVE
operator|->
name|iLocay
operator|=
operator|-
name|iYoffset
expr_stmt|;
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pMOVE
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_show
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_show
argument_list|,
operator|&
operator|(
operator|(
name|mng_ptr
operator|)
name|pSHOW
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pSHOW
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_show
argument_list|)
argument_list|)
expr_stmt|;
name|pSHOW
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_show
expr_stmt|;
name|pSHOW
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_show
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iSource
condition|)
name|pSHOW
operator|->
name|iFirstid
operator|=
literal|0
expr_stmt|;
else|else
name|pSHOW
operator|->
name|iFirstid
operator|=
literal|1
expr_stmt|;
name|pSHOW
operator|->
name|iLastid
operator|=
name|pSHOW
operator|->
name|iFirstid
expr_stmt|;
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pSHOW
argument_list|)
expr_stmt|;
name|pTile
operator|+=
sizeof|sizeof
argument_list|(
name|mng_adat_tile
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|pANG
operator|->
name|iNumplays
operator|!=
literal|1
condition|)
comment|/* create a LOOP/ENDL pair ? */
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_OBJCLEANUP
name|iRetcode
operator|=
name|create_obj_general
argument_list|(
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_endl
argument_list|)
argument_list|,
name|mng_free_obj_general
argument_list|,
name|mng_process_ani_endl
argument_list|,
operator|&
operator|(
operator|(
name|mng_ptr
operator|)
name|pENDL
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pENDL
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_ani_endl
argument_list|)
argument_list|)
expr_stmt|;
name|pENDL
operator|->
name|sHeader
operator|.
name|fCleanup
operator|=
name|mng_free_ani_endl
expr_stmt|;
name|pENDL
operator|->
name|sHeader
operator|.
name|fProcess
operator|=
name|mng_process_ani_endl
expr_stmt|;
endif|#
directive|endif
name|pENDL
operator|->
name|iLevel
operator|=
literal|1
expr_stmt|;
name|mng_add_ani_object
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_object_headerp
operator|)
name|pENDL
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_ANG_OBJ
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_INCLUDE_ANG_PROPOSAL */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_INCLUDE_DISPLAY_PROCS */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* * end of file                                                            * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
end_unit
