begin_unit
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *             For conditions of distribution and use,                    * */
end_comment
begin_comment
comment|/* *                see copyright notice in libmng.h                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * project   : libmng                                                     * */
end_comment
begin_comment
comment|/* * file      : libmng_chunk_xs.c         copyright (c) 2000-2007 G.Juyn   * */
end_comment
begin_comment
comment|/* * version   : 1.0.10                                                     * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * purpose   : chunk access functions (implementation)                    * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * author    : G.Juyn                                                     * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * comment   : implementation of the chunk access functions               * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * changes   : 0.5.1 - 05/06/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed and filled iterate-chunk function                * */
end_comment
begin_comment
comment|/* *             0.5.1 - 05/08/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed calling convention                                 * */
end_comment
begin_comment
comment|/* *             - added getchunk functions                                 * */
end_comment
begin_comment
comment|/* *             - added putchunk functions                                 * */
end_comment
begin_comment
comment|/* *             - changed strict-ANSI stuff                                * */
end_comment
begin_comment
comment|/* *             0.5.1 - 05/11/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added empty-chunk put-routines                           * */
end_comment
begin_comment
comment|/* *             0.5.1 - 05/12/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed trace to macro for callback error-reporting      * */
end_comment
begin_comment
comment|/* *             0.5.1 - 05/15/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added getimgdata& putimgdata functions                  * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.5.2 - 05/19/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - B004 - fixed problem with MNG_SUPPORT_WRITE not defined  * */
end_comment
begin_comment
comment|/* *               also for MNG_SUPPORT_WRITE without MNG_INCLUDE_JNG       * */
end_comment
begin_comment
comment|/* *             - Cleaned up some code regarding mixed support             * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.1 - 07/19/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed creation-code                                      * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.2 - 08/05/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed file-prefixes                                    * */
end_comment
begin_comment
comment|/* *             - added function to set simplicity field                   * */
end_comment
begin_comment
comment|/* *             - fixed putchunk_unknown() function                        * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.3 - 08/07/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - B111300 - fixup for improved portability                 * */
end_comment
begin_comment
comment|/* *             0.9.3 - 08/26/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added MAGN chunk                                         * */
end_comment
begin_comment
comment|/* *             0.9.3 - 10/20/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed putchunk_plte() to set bEmpty parameter            * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.5 - 01/25/2001 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed some small compiler warnings (thanks Nikki)        * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.5 - 09/07/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - B578940 - unimplemented functions return errorcode       * */
end_comment
begin_comment
comment|/* *             1.0.5 - 08/19/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - B597134 - libmng pollutes the linker namespace           * */
end_comment
begin_comment
comment|/* *             - added HLAPI function to copy chunks                      * */
end_comment
begin_comment
comment|/* *             1.0.5 - 09/14/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added event handling for dynamic MNG                     * */
end_comment
begin_comment
comment|/* *             1.0.5 - 10/07/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added check for TERM placement during create/write       * */
end_comment
begin_comment
comment|/* *             1.0.5 - 11/28/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed definition of iMethodX/Y for MAGN chunk            * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.6 - 05/25/2003 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added MNG_SKIPCHUNK_cHNK footprint optimizations         * */
end_comment
begin_comment
comment|/* *             1.0.6 - 07/07/2003 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added MNG_NO_DELTA_PNG reduction and more SKIPCHUNK      * */
end_comment
begin_comment
comment|/* *               optimizations                                            * */
end_comment
begin_comment
comment|/* *             1.0.6 - 07/29/2003 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added conditionals around PAST chunk support             * */
end_comment
begin_comment
comment|/* *             1.0.6 - 08/17/2003 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added conditionals around non-VLC chunk support          * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.8 - 04/01/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added missing get-/put-chunk-jdaa                        * */
end_comment
begin_comment
comment|/* *             1.0.8 - 08/02/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added conditional to allow easier writing of large MNG's * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.9 - 09/17/2004 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added two more conditionals                              * */
end_comment
begin_comment
comment|/* *             1.0.9 - 09/25/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - replaced MNG_TWEAK_LARGE_FILES with permanent solution   * */
end_comment
begin_comment
comment|/* *             1.0.9 - 17/14/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed PPLT getchunk/putchunk routines                    * */
end_comment
begin_comment
comment|/* *             1.0.9 - 12/05/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added conditional MNG_OPTIMIZE_CHUNKINITFREE             * */
end_comment
begin_comment
comment|/* *             1.0.9 - 12/20/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - cleaned up macro-invocations (thanks to D. Airlie)       * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.10 - 04/08/2007 - G.Juyn                               * */
end_comment
begin_comment
comment|/* *             - added support for mPNG proposal                          * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_include
include|#
directive|include
file|"libmng.h"
end_include
begin_include
include|#
directive|include
file|"libmng_data.h"
end_include
begin_include
include|#
directive|include
file|"libmng_error.h"
end_include
begin_include
include|#
directive|include
file|"libmng_trace.h"
end_include
begin_ifdef
ifdef|#
directive|ifdef
name|__BORLANDC__
end_ifdef
begin_pragma
pragma|#
directive|pragma
name|hdrstop
end_pragma
begin_endif
endif|#
directive|endif
end_endif
begin_include
include|#
directive|include
file|"libmng_memory.h"
end_include
begin_include
include|#
directive|include
file|"libmng_chunks.h"
end_include
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKREADER
end_ifdef
begin_include
include|#
directive|include
file|"libmng_chunk_descr.h"
end_include
begin_endif
endif|#
directive|endif
end_endif
begin_include
include|#
directive|include
file|"libmng_chunk_prc.h"
end_include
begin_include
include|#
directive|include
file|"libmng_chunk_io.h"
end_include
begin_if
if|#
directive|if
name|defined
argument_list|(
name|__BORLANDC__
argument_list|)
operator|&&
name|defined
argument_list|(
name|MNG_STRICT_ANSI
argument_list|)
end_if
begin_pragma
pragma|#
directive|pragma
name|option
name|-
name|A
end_pragma
begin_comment
comment|/* force ANSI-C */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_ACCESS_CHUNKS
end_ifdef
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_iterate_chunks
name|mng_retcode
name|MNG_DECL
name|mng_iterate_chunks
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iChunkseq
parameter_list|,
name|mng_iteratechunk
name|fProc
parameter_list|)
block|{
name|mng_uint32
name|iSeq
decl_stmt|;
name|mng_chunkid
name|iChunkname
decl_stmt|;
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_bool
name|bCont
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_ITERATE_CHUNKS
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
name|iSeq
operator|=
literal|0
expr_stmt|;
name|bCont
operator|=
name|MNG_TRUE
expr_stmt|;
name|pChunk
operator|=
name|pData
operator|->
name|pFirstchunk
expr_stmt|;
comment|/* get the first chunk */
comment|/* as long as there are some more */
while|while
condition|(
operator|(
name|pChunk
operator|)
operator|&&
operator|(
name|bCont
operator|)
condition|)
comment|/* and the app didn't signal a stop */
block|{
if|if
condition|(
name|iSeq
operator|>=
name|iChunkseq
condition|)
comment|/* reached the first target ? */
block|{
comment|/* then call this and next ones back in... */
name|iChunkname
operator|=
operator|(
operator|(
name|mng_chunk_headerp
operator|)
name|pChunk
operator|)
operator|->
name|iChunkname
expr_stmt|;
name|bCont
operator|=
name|fProc
argument_list|(
name|hHandle
argument_list|,
operator|(
name|mng_handle
operator|)
name|pChunk
argument_list|,
name|iChunkname
argument_list|,
name|iSeq
argument_list|)
expr_stmt|;
block|}
name|iSeq
operator|++
expr_stmt|;
comment|/* next one */
name|pChunk
operator|=
operator|(
operator|(
name|mng_chunk_headerp
operator|)
name|pChunk
operator|)
operator|->
name|pNext
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_ITERATE_CHUNKS
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_WRITE
end_ifdef
begin_function
DECL|function|mng_copy_chunk
name|mng_retcode
name|MNG_DECL
name|mng_copy_chunk
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_handle
name|hHandleOut
parameter_list|)
block|{
name|mng_datap
name|pDataOut
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_chunkp
name|pChunkOut
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_COPY_CHUNK
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handles */
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandleOut
argument_list|)
name|pDataOut
operator|=
operator|(
name|mng_datap
operator|)
name|hHandleOut
expr_stmt|;
comment|/* make outhandle addressable */
name|pChunk
operator|=
operator|(
name|mng_chunkp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
operator|!
name|pDataOut
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pDataOut
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* create a new chunk */
name|iRetcode
operator|=
operator|(
call|(
name|mng_createchunk
call|)
argument_list|(
operator|(
name|mng_chunk_headerp
operator|)
name|pChunk
argument_list|)
operator|->
name|fCreate
operator|)
operator|(
name|pDataOut
operator|,
operator|(
operator|(
name|mng_chunk_headerp
operator|)
name|pChunk
operator|)
operator|,
operator|&
name|pChunkOut
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|iRetcode
condition|)
comment|/* assign the chunk-specific data */
name|iRetcode
operator|=
operator|(
call|(
name|mng_assignchunk
call|)
argument_list|(
operator|(
name|mng_chunk_headerp
operator|)
name|pChunk
argument_list|)
operator|->
name|fAssign
operator|)
operator|(
name|pDataOut
operator|,
name|pChunkOut
operator|,
name|pChunk
operator|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
name|mng_add_chunk
argument_list|(
name|pDataOut
argument_list|,
name|pChunkOut
argument_list|)
expr_stmt|;
comment|/* and put it in the output-stream */
comment|/* could it be the end of the chain ? */
if|if
condition|(
operator|(
operator|(
name|mng_chunk_headerp
operator|)
name|pChunkOut
operator|)
operator|->
name|iChunkname
operator|==
name|MNG_UINT_IEND
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
if|if
condition|(
operator|(
name|pDataOut
operator|->
name|iFirstchunkadded
operator|==
name|MNG_UINT_IHDR
operator|)
operator|||
operator|(
name|pDataOut
operator|->
name|iFirstchunkadded
operator|==
name|MNG_UINT_JHDR
operator|)
condition|)
else|#
directive|else
if|if
condition|(
name|pDataOut
operator|->
name|iFirstchunkadded
operator|==
name|MNG_UINT_IHDR
condition|)
endif|#
directive|endif
name|pDataOut
operator|->
name|bCreating
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* right; this should be the last chunk !!! */
block|}
if|if
condition|(
operator|(
operator|(
name|mng_chunk_headerp
operator|)
name|pChunkOut
operator|)
operator|->
name|iChunkname
operator|==
name|MNG_UINT_MEND
condition|)
name|pDataOut
operator|->
name|bCreating
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* definitely this should be the last !!! */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_COPY_CHUNK
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_WRITE */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_getchunk_ihdr
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_ihdr
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iWidth
parameter_list|,
name|mng_uint32
modifier|*
name|iHeight
parameter_list|,
name|mng_uint8
modifier|*
name|iBitdepth
parameter_list|,
name|mng_uint8
modifier|*
name|iColortype
parameter_list|,
name|mng_uint8
modifier|*
name|iCompression
parameter_list|,
name|mng_uint8
modifier|*
name|iFilter
parameter_list|,
name|mng_uint8
modifier|*
name|iInterlace
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_ihdrp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_IHDR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_ihdrp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_IHDR
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iWidth
operator|=
name|pChunk
operator|->
name|iWidth
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iHeight
operator|=
name|pChunk
operator|->
name|iHeight
expr_stmt|;
operator|*
name|iBitdepth
operator|=
name|pChunk
operator|->
name|iBitdepth
expr_stmt|;
operator|*
name|iColortype
operator|=
name|pChunk
operator|->
name|iColortype
expr_stmt|;
operator|*
name|iCompression
operator|=
name|pChunk
operator|->
name|iCompression
expr_stmt|;
operator|*
name|iFilter
operator|=
name|pChunk
operator|->
name|iFilter
expr_stmt|;
operator|*
name|iInterlace
operator|=
name|pChunk
operator|->
name|iInterlace
expr_stmt|;
comment|/* fill the chunk */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_IHDR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_getchunk_plte
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_plte
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iCount
parameter_list|,
name|mng_palette8
modifier|*
name|aPalette
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_pltep
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_PLTE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_pltep
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_PLTE
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iCount
operator|=
name|pChunk
operator|->
name|iEntrycount
expr_stmt|;
comment|/* fill the fields */
name|MNG_COPY
argument_list|(
operator|*
name|aPalette
argument_list|,
name|pChunk
operator|->
name|aEntries
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_palette8
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_PLTE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_getchunk_idat
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_idat
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iRawlen
parameter_list|,
name|mng_ptr
modifier|*
name|pRawdata
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_idatp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_IDAT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_idatp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_IDAT
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iRawlen
operator|=
name|pChunk
operator|->
name|iDatasize
expr_stmt|;
comment|/* fill the fields */
operator|*
name|pRawdata
operator|=
name|pChunk
operator|->
name|pData
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_IDAT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_getchunk_trns
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_trns
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_bool
modifier|*
name|bEmpty
parameter_list|,
name|mng_bool
modifier|*
name|bGlobal
parameter_list|,
name|mng_uint8
modifier|*
name|iType
parameter_list|,
name|mng_uint32
modifier|*
name|iCount
parameter_list|,
name|mng_uint8arr
modifier|*
name|aAlphas
parameter_list|,
name|mng_uint16
modifier|*
name|iGray
parameter_list|,
name|mng_uint16
modifier|*
name|iRed
parameter_list|,
name|mng_uint16
modifier|*
name|iGreen
parameter_list|,
name|mng_uint16
modifier|*
name|iBlue
parameter_list|,
name|mng_uint32
modifier|*
name|iRawlen
parameter_list|,
name|mng_uint8arr
modifier|*
name|aRawdata
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_trnsp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_TRNS
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_trnsp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_tRNS
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|bEmpty
operator|=
name|pChunk
operator|->
name|bEmpty
expr_stmt|;
comment|/* fill the fields */
operator|*
name|bGlobal
operator|=
name|pChunk
operator|->
name|bGlobal
expr_stmt|;
operator|*
name|iType
operator|=
name|pChunk
operator|->
name|iType
expr_stmt|;
operator|*
name|iCount
operator|=
name|pChunk
operator|->
name|iCount
expr_stmt|;
operator|*
name|iGray
operator|=
name|pChunk
operator|->
name|iGray
expr_stmt|;
operator|*
name|iRed
operator|=
name|pChunk
operator|->
name|iRed
expr_stmt|;
operator|*
name|iGreen
operator|=
name|pChunk
operator|->
name|iGreen
expr_stmt|;
operator|*
name|iBlue
operator|=
name|pChunk
operator|->
name|iBlue
expr_stmt|;
operator|*
name|iRawlen
operator|=
name|pChunk
operator|->
name|iRawlen
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|*
name|aAlphas
argument_list|,
name|pChunk
operator|->
name|aEntries
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_uint8arr
argument_list|)
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|*
name|aRawdata
argument_list|,
name|pChunk
operator|->
name|aRawdata
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_uint8arr
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_TRNS
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_gAMA
end_ifndef
begin_function
DECL|function|mng_getchunk_gama
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_gama
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_bool
modifier|*
name|bEmpty
parameter_list|,
name|mng_uint32
modifier|*
name|iGamma
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_gamap
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_GAMA
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_gamap
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_gAMA
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|bEmpty
operator|=
name|pChunk
operator|->
name|bEmpty
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iGamma
operator|=
name|pChunk
operator|->
name|iGamma
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_GAMA
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_cHRM
end_ifndef
begin_function
DECL|function|mng_getchunk_chrm
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_chrm
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_bool
modifier|*
name|bEmpty
parameter_list|,
name|mng_uint32
modifier|*
name|iWhitepointx
parameter_list|,
name|mng_uint32
modifier|*
name|iWhitepointy
parameter_list|,
name|mng_uint32
modifier|*
name|iRedx
parameter_list|,
name|mng_uint32
modifier|*
name|iRedy
parameter_list|,
name|mng_uint32
modifier|*
name|iGreenx
parameter_list|,
name|mng_uint32
modifier|*
name|iGreeny
parameter_list|,
name|mng_uint32
modifier|*
name|iBluex
parameter_list|,
name|mng_uint32
modifier|*
name|iBluey
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chrmp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_CHRM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_chrmp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_cHRM
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|bEmpty
operator|=
name|pChunk
operator|->
name|bEmpty
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iWhitepointx
operator|=
name|pChunk
operator|->
name|iWhitepointx
expr_stmt|;
operator|*
name|iWhitepointy
operator|=
name|pChunk
operator|->
name|iWhitepointy
expr_stmt|;
operator|*
name|iRedx
operator|=
name|pChunk
operator|->
name|iRedx
expr_stmt|;
operator|*
name|iRedy
operator|=
name|pChunk
operator|->
name|iRedy
expr_stmt|;
operator|*
name|iGreenx
operator|=
name|pChunk
operator|->
name|iGreenx
expr_stmt|;
operator|*
name|iGreeny
operator|=
name|pChunk
operator|->
name|iGreeny
expr_stmt|;
operator|*
name|iBluex
operator|=
name|pChunk
operator|->
name|iBluex
expr_stmt|;
operator|*
name|iBluey
operator|=
name|pChunk
operator|->
name|iBluey
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_CHRM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_sRGB
end_ifndef
begin_function
DECL|function|mng_getchunk_srgb
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_srgb
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_bool
modifier|*
name|bEmpty
parameter_list|,
name|mng_uint8
modifier|*
name|iRenderingintent
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_srgbp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_SRGB
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_srgbp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_sRGB
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|bEmpty
operator|=
name|pChunk
operator|->
name|bEmpty
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iRenderingintent
operator|=
name|pChunk
operator|->
name|iRenderingintent
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_SRGB
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
end_ifndef
begin_function
DECL|function|mng_getchunk_iccp
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_iccp
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_bool
modifier|*
name|bEmpty
parameter_list|,
name|mng_uint32
modifier|*
name|iNamesize
parameter_list|,
name|mng_pchar
modifier|*
name|zName
parameter_list|,
name|mng_uint8
modifier|*
name|iCompression
parameter_list|,
name|mng_uint32
modifier|*
name|iProfilesize
parameter_list|,
name|mng_ptr
modifier|*
name|pProfile
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_iccpp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_ICCP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_iccpp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_iCCP
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|bEmpty
operator|=
name|pChunk
operator|->
name|bEmpty
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iNamesize
operator|=
name|pChunk
operator|->
name|iNamesize
expr_stmt|;
operator|*
name|zName
operator|=
name|pChunk
operator|->
name|zName
expr_stmt|;
operator|*
name|iCompression
operator|=
name|pChunk
operator|->
name|iCompression
expr_stmt|;
operator|*
name|iProfilesize
operator|=
name|pChunk
operator|->
name|iProfilesize
expr_stmt|;
operator|*
name|pProfile
operator|=
name|pChunk
operator|->
name|pProfile
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_ICCP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_tEXt
end_ifndef
begin_function
DECL|function|mng_getchunk_text
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_text
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iKeywordsize
parameter_list|,
name|mng_pchar
modifier|*
name|zKeyword
parameter_list|,
name|mng_uint32
modifier|*
name|iTextsize
parameter_list|,
name|mng_pchar
modifier|*
name|zText
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_textp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_TEXT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_textp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_tEXt
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
comment|/* fill the fields */
operator|*
name|iKeywordsize
operator|=
name|pChunk
operator|->
name|iKeywordsize
expr_stmt|;
operator|*
name|zKeyword
operator|=
name|pChunk
operator|->
name|zKeyword
expr_stmt|;
operator|*
name|iTextsize
operator|=
name|pChunk
operator|->
name|iTextsize
expr_stmt|;
operator|*
name|zText
operator|=
name|pChunk
operator|->
name|zText
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_TEXT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_zTXt
end_ifndef
begin_function
DECL|function|mng_getchunk_ztxt
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_ztxt
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iKeywordsize
parameter_list|,
name|mng_pchar
modifier|*
name|zKeyword
parameter_list|,
name|mng_uint8
modifier|*
name|iCompression
parameter_list|,
name|mng_uint32
modifier|*
name|iTextsize
parameter_list|,
name|mng_pchar
modifier|*
name|zText
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_ztxtp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_ZTXT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_ztxtp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_zTXt
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
comment|/* fill the fields */
operator|*
name|iKeywordsize
operator|=
name|pChunk
operator|->
name|iKeywordsize
expr_stmt|;
operator|*
name|zKeyword
operator|=
name|pChunk
operator|->
name|zKeyword
expr_stmt|;
operator|*
name|iCompression
operator|=
name|pChunk
operator|->
name|iCompression
expr_stmt|;
operator|*
name|iTextsize
operator|=
name|pChunk
operator|->
name|iTextsize
expr_stmt|;
operator|*
name|zText
operator|=
name|pChunk
operator|->
name|zText
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_ZTXT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iTXt
end_ifndef
begin_function
DECL|function|mng_getchunk_itxt
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_itxt
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iKeywordsize
parameter_list|,
name|mng_pchar
modifier|*
name|zKeyword
parameter_list|,
name|mng_uint8
modifier|*
name|iCompressionflag
parameter_list|,
name|mng_uint8
modifier|*
name|iCompressionmethod
parameter_list|,
name|mng_uint32
modifier|*
name|iLanguagesize
parameter_list|,
name|mng_pchar
modifier|*
name|zLanguage
parameter_list|,
name|mng_uint32
modifier|*
name|iTranslationsize
parameter_list|,
name|mng_pchar
modifier|*
name|zTranslation
parameter_list|,
name|mng_uint32
modifier|*
name|iTextsize
parameter_list|,
name|mng_pchar
modifier|*
name|zText
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_itxtp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_ITXT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_itxtp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_iTXt
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
comment|/* fill the fields */
operator|*
name|iKeywordsize
operator|=
name|pChunk
operator|->
name|iKeywordsize
expr_stmt|;
operator|*
name|zKeyword
operator|=
name|pChunk
operator|->
name|zKeyword
expr_stmt|;
operator|*
name|iCompressionflag
operator|=
name|pChunk
operator|->
name|iCompressionflag
expr_stmt|;
operator|*
name|iCompressionmethod
operator|=
name|pChunk
operator|->
name|iCompressionmethod
expr_stmt|;
operator|*
name|iLanguagesize
operator|=
name|pChunk
operator|->
name|iLanguagesize
expr_stmt|;
operator|*
name|zLanguage
operator|=
name|pChunk
operator|->
name|zLanguage
expr_stmt|;
operator|*
name|iTranslationsize
operator|=
name|pChunk
operator|->
name|iTranslationsize
expr_stmt|;
operator|*
name|zTranslation
operator|=
name|pChunk
operator|->
name|zTranslation
expr_stmt|;
operator|*
name|iTextsize
operator|=
name|pChunk
operator|->
name|iTextsize
expr_stmt|;
operator|*
name|zText
operator|=
name|pChunk
operator|->
name|zText
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_ITXT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_bKGD
end_ifndef
begin_function
DECL|function|mng_getchunk_bkgd
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_bkgd
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_bool
modifier|*
name|bEmpty
parameter_list|,
name|mng_uint8
modifier|*
name|iType
parameter_list|,
name|mng_uint8
modifier|*
name|iIndex
parameter_list|,
name|mng_uint16
modifier|*
name|iGray
parameter_list|,
name|mng_uint16
modifier|*
name|iRed
parameter_list|,
name|mng_uint16
modifier|*
name|iGreen
parameter_list|,
name|mng_uint16
modifier|*
name|iBlue
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_bkgdp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_BKGD
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_bkgdp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_bKGD
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|bEmpty
operator|=
name|pChunk
operator|->
name|bEmpty
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iType
operator|=
name|pChunk
operator|->
name|iType
expr_stmt|;
operator|*
name|iIndex
operator|=
name|pChunk
operator|->
name|iIndex
expr_stmt|;
operator|*
name|iGray
operator|=
name|pChunk
operator|->
name|iGray
expr_stmt|;
operator|*
name|iRed
operator|=
name|pChunk
operator|->
name|iRed
expr_stmt|;
operator|*
name|iGreen
operator|=
name|pChunk
operator|->
name|iGreen
expr_stmt|;
operator|*
name|iBlue
operator|=
name|pChunk
operator|->
name|iBlue
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_BKGD
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_pHYs
end_ifndef
begin_function
DECL|function|mng_getchunk_phys
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_phys
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_bool
modifier|*
name|bEmpty
parameter_list|,
name|mng_uint32
modifier|*
name|iSizex
parameter_list|,
name|mng_uint32
modifier|*
name|iSizey
parameter_list|,
name|mng_uint8
modifier|*
name|iUnit
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_physp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_PHYS
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_physp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_pHYs
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|bEmpty
operator|=
name|pChunk
operator|->
name|bEmpty
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iSizex
operator|=
name|pChunk
operator|->
name|iSizex
expr_stmt|;
operator|*
name|iSizey
operator|=
name|pChunk
operator|->
name|iSizey
expr_stmt|;
operator|*
name|iUnit
operator|=
name|pChunk
operator|->
name|iUnit
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_PHYS
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_sBIT
end_ifndef
begin_function
DECL|function|mng_getchunk_sbit
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_sbit
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_bool
modifier|*
name|bEmpty
parameter_list|,
name|mng_uint8
modifier|*
name|iType
parameter_list|,
name|mng_uint8arr4
modifier|*
name|aBits
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_sbitp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_SBIT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_sbitp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_sBIT
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|bEmpty
operator|=
name|pChunk
operator|->
name|bEmpty
expr_stmt|;
operator|*
name|iType
operator|=
name|pChunk
operator|->
name|iType
expr_stmt|;
operator|(
operator|*
name|aBits
operator|)
index|[
literal|0
index|]
operator|=
name|pChunk
operator|->
name|aBits
index|[
literal|0
index|]
expr_stmt|;
operator|(
operator|*
name|aBits
operator|)
index|[
literal|1
index|]
operator|=
name|pChunk
operator|->
name|aBits
index|[
literal|1
index|]
expr_stmt|;
operator|(
operator|*
name|aBits
operator|)
index|[
literal|2
index|]
operator|=
name|pChunk
operator|->
name|aBits
index|[
literal|2
index|]
expr_stmt|;
operator|(
operator|*
name|aBits
operator|)
index|[
literal|3
index|]
operator|=
name|pChunk
operator|->
name|aBits
index|[
literal|3
index|]
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_SBIT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_sPLT
end_ifndef
begin_function
DECL|function|mng_getchunk_splt
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_splt
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_bool
modifier|*
name|bEmpty
parameter_list|,
name|mng_uint32
modifier|*
name|iNamesize
parameter_list|,
name|mng_pchar
modifier|*
name|zName
parameter_list|,
name|mng_uint8
modifier|*
name|iSampledepth
parameter_list|,
name|mng_uint32
modifier|*
name|iEntrycount
parameter_list|,
name|mng_ptr
modifier|*
name|pEntries
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_spltp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_SPLT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_spltp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_sPLT
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|bEmpty
operator|=
name|pChunk
operator|->
name|bEmpty
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iNamesize
operator|=
name|pChunk
operator|->
name|iNamesize
expr_stmt|;
operator|*
name|zName
operator|=
name|pChunk
operator|->
name|zName
expr_stmt|;
operator|*
name|iSampledepth
operator|=
name|pChunk
operator|->
name|iSampledepth
expr_stmt|;
operator|*
name|iEntrycount
operator|=
name|pChunk
operator|->
name|iEntrycount
expr_stmt|;
operator|*
name|pEntries
operator|=
name|pChunk
operator|->
name|pEntries
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_SPLT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_hIST
end_ifndef
begin_function
DECL|function|mng_getchunk_hist
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_hist
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iEntrycount
parameter_list|,
name|mng_uint16arr
modifier|*
name|aEntries
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_histp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_HIST
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_histp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_hIST
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iEntrycount
operator|=
name|pChunk
operator|->
name|iEntrycount
expr_stmt|;
comment|/* fill the fields */
name|MNG_COPY
argument_list|(
operator|*
name|aEntries
argument_list|,
name|pChunk
operator|->
name|aEntries
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_uint16arr
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_HIST
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_tIME
end_ifndef
begin_function
DECL|function|mng_getchunk_time
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_time
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint16
modifier|*
name|iYear
parameter_list|,
name|mng_uint8
modifier|*
name|iMonth
parameter_list|,
name|mng_uint8
modifier|*
name|iDay
parameter_list|,
name|mng_uint8
modifier|*
name|iHour
parameter_list|,
name|mng_uint8
modifier|*
name|iMinute
parameter_list|,
name|mng_uint8
modifier|*
name|iSecond
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_timep
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_TIME
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_timep
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_tIME
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iYear
operator|=
name|pChunk
operator|->
name|iYear
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iMonth
operator|=
name|pChunk
operator|->
name|iMonth
expr_stmt|;
operator|*
name|iDay
operator|=
name|pChunk
operator|->
name|iDay
expr_stmt|;
operator|*
name|iHour
operator|=
name|pChunk
operator|->
name|iHour
expr_stmt|;
operator|*
name|iMinute
operator|=
name|pChunk
operator|->
name|iMinute
expr_stmt|;
operator|*
name|iSecond
operator|=
name|pChunk
operator|->
name|iSecond
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_TIME
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_getchunk_mhdr
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_mhdr
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iWidth
parameter_list|,
name|mng_uint32
modifier|*
name|iHeight
parameter_list|,
name|mng_uint32
modifier|*
name|iTicks
parameter_list|,
name|mng_uint32
modifier|*
name|iLayercount
parameter_list|,
name|mng_uint32
modifier|*
name|iFramecount
parameter_list|,
name|mng_uint32
modifier|*
name|iPlaytime
parameter_list|,
name|mng_uint32
modifier|*
name|iSimplicity
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_mhdrp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_MHDR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_mhdrp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iWidth
operator|=
name|pChunk
operator|->
name|iWidth
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iHeight
operator|=
name|pChunk
operator|->
name|iHeight
expr_stmt|;
operator|*
name|iTicks
operator|=
name|pChunk
operator|->
name|iTicks
expr_stmt|;
operator|*
name|iLayercount
operator|=
name|pChunk
operator|->
name|iLayercount
expr_stmt|;
operator|*
name|iFramecount
operator|=
name|pChunk
operator|->
name|iFramecount
expr_stmt|;
operator|*
name|iPlaytime
operator|=
name|pChunk
operator|->
name|iPlaytime
expr_stmt|;
operator|*
name|iSimplicity
operator|=
name|pChunk
operator|->
name|iSimplicity
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_MHDR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_LOOP
end_ifndef
begin_function
DECL|function|mng_getchunk_loop
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_loop
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint8
modifier|*
name|iLevel
parameter_list|,
name|mng_uint32
modifier|*
name|iRepeat
parameter_list|,
name|mng_uint8
modifier|*
name|iTermination
parameter_list|,
name|mng_uint32
modifier|*
name|iItermin
parameter_list|,
name|mng_uint32
modifier|*
name|iItermax
parameter_list|,
name|mng_uint32
modifier|*
name|iCount
parameter_list|,
name|mng_uint32p
modifier|*
name|pSignals
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_loopp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_LOOP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_loopp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_LOOP
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iLevel
operator|=
name|pChunk
operator|->
name|iLevel
expr_stmt|;
comment|/* fill teh fields */
operator|*
name|iRepeat
operator|=
name|pChunk
operator|->
name|iRepeat
expr_stmt|;
operator|*
name|iTermination
operator|=
name|pChunk
operator|->
name|iTermination
expr_stmt|;
operator|*
name|iItermin
operator|=
name|pChunk
operator|->
name|iItermin
expr_stmt|;
operator|*
name|iItermax
operator|=
name|pChunk
operator|->
name|iItermax
expr_stmt|;
operator|*
name|iCount
operator|=
name|pChunk
operator|->
name|iCount
expr_stmt|;
operator|*
name|pSignals
operator|=
name|pChunk
operator|->
name|pSignals
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_LOOP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_getchunk_endl
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_endl
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint8
modifier|*
name|iLevel
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_endlp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_ENDL
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_endlp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_ENDL
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iLevel
operator|=
name|pChunk
operator|->
name|iLevel
expr_stmt|;
comment|/* fill the field */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_ENDL
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_DEFI
end_ifndef
begin_function
DECL|function|mng_getchunk_defi
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_defi
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint16
modifier|*
name|iObjectid
parameter_list|,
name|mng_uint8
modifier|*
name|iDonotshow
parameter_list|,
name|mng_uint8
modifier|*
name|iConcrete
parameter_list|,
name|mng_bool
modifier|*
name|bHasloca
parameter_list|,
name|mng_int32
modifier|*
name|iXlocation
parameter_list|,
name|mng_int32
modifier|*
name|iYlocation
parameter_list|,
name|mng_bool
modifier|*
name|bHasclip
parameter_list|,
name|mng_int32
modifier|*
name|iLeftcb
parameter_list|,
name|mng_int32
modifier|*
name|iRightcb
parameter_list|,
name|mng_int32
modifier|*
name|iTopcb
parameter_list|,
name|mng_int32
modifier|*
name|iBottomcb
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_defip
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_DEFI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_defip
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_DEFI
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iObjectid
operator|=
name|pChunk
operator|->
name|iObjectid
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iDonotshow
operator|=
name|pChunk
operator|->
name|iDonotshow
expr_stmt|;
operator|*
name|iConcrete
operator|=
name|pChunk
operator|->
name|iConcrete
expr_stmt|;
operator|*
name|bHasloca
operator|=
name|pChunk
operator|->
name|bHasloca
expr_stmt|;
operator|*
name|iXlocation
operator|=
name|pChunk
operator|->
name|iXlocation
expr_stmt|;
operator|*
name|iYlocation
operator|=
name|pChunk
operator|->
name|iYlocation
expr_stmt|;
operator|*
name|bHasclip
operator|=
name|pChunk
operator|->
name|bHasclip
expr_stmt|;
operator|*
name|iLeftcb
operator|=
name|pChunk
operator|->
name|iLeftcb
expr_stmt|;
operator|*
name|iRightcb
operator|=
name|pChunk
operator|->
name|iRightcb
expr_stmt|;
operator|*
name|iTopcb
operator|=
name|pChunk
operator|->
name|iTopcb
expr_stmt|;
operator|*
name|iBottomcb
operator|=
name|pChunk
operator|->
name|iBottomcb
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_DEFI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_BASI
end_ifndef
begin_function
DECL|function|mng_getchunk_basi
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_basi
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iWidth
parameter_list|,
name|mng_uint32
modifier|*
name|iHeight
parameter_list|,
name|mng_uint8
modifier|*
name|iBitdepth
parameter_list|,
name|mng_uint8
modifier|*
name|iColortype
parameter_list|,
name|mng_uint8
modifier|*
name|iCompression
parameter_list|,
name|mng_uint8
modifier|*
name|iFilter
parameter_list|,
name|mng_uint8
modifier|*
name|iInterlace
parameter_list|,
name|mng_uint16
modifier|*
name|iRed
parameter_list|,
name|mng_uint16
modifier|*
name|iGreen
parameter_list|,
name|mng_uint16
modifier|*
name|iBlue
parameter_list|,
name|mng_uint16
modifier|*
name|iAlpha
parameter_list|,
name|mng_uint8
modifier|*
name|iViewable
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_basip
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_BASI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_basip
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_BASI
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iWidth
operator|=
name|pChunk
operator|->
name|iWidth
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iHeight
operator|=
name|pChunk
operator|->
name|iHeight
expr_stmt|;
operator|*
name|iBitdepth
operator|=
name|pChunk
operator|->
name|iBitdepth
expr_stmt|;
operator|*
name|iColortype
operator|=
name|pChunk
operator|->
name|iColortype
expr_stmt|;
operator|*
name|iCompression
operator|=
name|pChunk
operator|->
name|iCompression
expr_stmt|;
operator|*
name|iFilter
operator|=
name|pChunk
operator|->
name|iFilter
expr_stmt|;
operator|*
name|iInterlace
operator|=
name|pChunk
operator|->
name|iInterlace
expr_stmt|;
operator|*
name|iRed
operator|=
name|pChunk
operator|->
name|iRed
expr_stmt|;
operator|*
name|iGreen
operator|=
name|pChunk
operator|->
name|iGreen
expr_stmt|;
operator|*
name|iBlue
operator|=
name|pChunk
operator|->
name|iBlue
expr_stmt|;
operator|*
name|iAlpha
operator|=
name|pChunk
operator|->
name|iAlpha
expr_stmt|;
operator|*
name|iViewable
operator|=
name|pChunk
operator|->
name|iViewable
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_BASI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_CLON
end_ifndef
begin_function
DECL|function|mng_getchunk_clon
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_clon
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint16
modifier|*
name|iSourceid
parameter_list|,
name|mng_uint16
modifier|*
name|iCloneid
parameter_list|,
name|mng_uint8
modifier|*
name|iClonetype
parameter_list|,
name|mng_uint8
modifier|*
name|iDonotshow
parameter_list|,
name|mng_uint8
modifier|*
name|iConcrete
parameter_list|,
name|mng_bool
modifier|*
name|bHasloca
parameter_list|,
name|mng_uint8
modifier|*
name|iLocationtype
parameter_list|,
name|mng_int32
modifier|*
name|iLocationx
parameter_list|,
name|mng_int32
modifier|*
name|iLocationy
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_clonp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_CLON
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_clonp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_CLON
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iSourceid
operator|=
name|pChunk
operator|->
name|iSourceid
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iCloneid
operator|=
name|pChunk
operator|->
name|iCloneid
expr_stmt|;
operator|*
name|iClonetype
operator|=
name|pChunk
operator|->
name|iClonetype
expr_stmt|;
operator|*
name|iDonotshow
operator|=
name|pChunk
operator|->
name|iDonotshow
expr_stmt|;
operator|*
name|iConcrete
operator|=
name|pChunk
operator|->
name|iConcrete
expr_stmt|;
operator|*
name|bHasloca
operator|=
name|pChunk
operator|->
name|bHasloca
expr_stmt|;
operator|*
name|iLocationtype
operator|=
name|pChunk
operator|->
name|iLocationtype
expr_stmt|;
operator|*
name|iLocationx
operator|=
name|pChunk
operator|->
name|iLocationx
expr_stmt|;
operator|*
name|iLocationy
operator|=
name|pChunk
operator|->
name|iLocationy
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_CLON
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_PAST
end_ifndef
begin_function
DECL|function|mng_getchunk_past
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_past
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint16
modifier|*
name|iDestid
parameter_list|,
name|mng_uint8
modifier|*
name|iTargettype
parameter_list|,
name|mng_int32
modifier|*
name|iTargetx
parameter_list|,
name|mng_int32
modifier|*
name|iTargety
parameter_list|,
name|mng_uint32
modifier|*
name|iCount
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_pastp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_PAST
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_pastp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_PAST
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iDestid
operator|=
name|pChunk
operator|->
name|iDestid
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iTargettype
operator|=
name|pChunk
operator|->
name|iTargettype
expr_stmt|;
operator|*
name|iTargetx
operator|=
name|pChunk
operator|->
name|iTargetx
expr_stmt|;
operator|*
name|iTargety
operator|=
name|pChunk
operator|->
name|iTargety
expr_stmt|;
operator|*
name|iCount
operator|=
name|pChunk
operator|->
name|iCount
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_PAST
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_PAST
end_ifndef
begin_function
DECL|function|mng_getchunk_past_src
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_past_src
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
name|iEntry
parameter_list|,
name|mng_uint16
modifier|*
name|iSourceid
parameter_list|,
name|mng_uint8
modifier|*
name|iComposition
parameter_list|,
name|mng_uint8
modifier|*
name|iOrientation
parameter_list|,
name|mng_uint8
modifier|*
name|iOffsettype
parameter_list|,
name|mng_int32
modifier|*
name|iOffsetx
parameter_list|,
name|mng_int32
modifier|*
name|iOffsety
parameter_list|,
name|mng_uint8
modifier|*
name|iBoundarytype
parameter_list|,
name|mng_int32
modifier|*
name|iBoundaryl
parameter_list|,
name|mng_int32
modifier|*
name|iBoundaryr
parameter_list|,
name|mng_int32
modifier|*
name|iBoundaryt
parameter_list|,
name|mng_int32
modifier|*
name|iBoundaryb
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_pastp
name|pChunk
decl_stmt|;
name|mng_past_sourcep
name|pEntry
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_PAST_SRC
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_pastp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_PAST
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
if|if
condition|(
name|iEntry
operator|>=
name|pChunk
operator|->
name|iCount
condition|)
comment|/* valid index ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_INVALIDENTRYIX
argument_list|)
comment|/* address the entry */
name|pEntry
operator|=
name|pChunk
operator|->
name|pSources
operator|+
name|iEntry
expr_stmt|;
operator|*
name|iSourceid
operator|=
name|pEntry
operator|->
name|iSourceid
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iComposition
operator|=
name|pEntry
operator|->
name|iComposition
expr_stmt|;
operator|*
name|iOrientation
operator|=
name|pEntry
operator|->
name|iOrientation
expr_stmt|;
operator|*
name|iOffsettype
operator|=
name|pEntry
operator|->
name|iOffsettype
expr_stmt|;
operator|*
name|iOffsetx
operator|=
name|pEntry
operator|->
name|iOffsetx
expr_stmt|;
operator|*
name|iOffsety
operator|=
name|pEntry
operator|->
name|iOffsety
expr_stmt|;
operator|*
name|iBoundarytype
operator|=
name|pEntry
operator|->
name|iBoundarytype
expr_stmt|;
operator|*
name|iBoundaryl
operator|=
name|pEntry
operator|->
name|iBoundaryl
expr_stmt|;
operator|*
name|iBoundaryr
operator|=
name|pEntry
operator|->
name|iBoundaryr
expr_stmt|;
operator|*
name|iBoundaryt
operator|=
name|pEntry
operator|->
name|iBoundaryt
expr_stmt|;
operator|*
name|iBoundaryb
operator|=
name|pEntry
operator|->
name|iBoundaryb
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_PAST_SRC
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_DISC
end_ifndef
begin_function
DECL|function|mng_getchunk_disc
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_disc
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iCount
parameter_list|,
name|mng_uint16p
modifier|*
name|pObjectids
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_discp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_DISC
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_discp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_DISC
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iCount
operator|=
name|pChunk
operator|->
name|iCount
expr_stmt|;
comment|/* fill the fields */
operator|*
name|pObjectids
operator|=
name|pChunk
operator|->
name|pObjectids
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_DISC
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_BACK
end_ifndef
begin_function
DECL|function|mng_getchunk_back
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_back
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint16
modifier|*
name|iRed
parameter_list|,
name|mng_uint16
modifier|*
name|iGreen
parameter_list|,
name|mng_uint16
modifier|*
name|iBlue
parameter_list|,
name|mng_uint8
modifier|*
name|iMandatory
parameter_list|,
name|mng_uint16
modifier|*
name|iImageid
parameter_list|,
name|mng_uint8
modifier|*
name|iTile
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_backp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_BACK
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_backp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_BACK
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iRed
operator|=
name|pChunk
operator|->
name|iRed
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iGreen
operator|=
name|pChunk
operator|->
name|iGreen
expr_stmt|;
operator|*
name|iBlue
operator|=
name|pChunk
operator|->
name|iBlue
expr_stmt|;
operator|*
name|iMandatory
operator|=
name|pChunk
operator|->
name|iMandatory
expr_stmt|;
operator|*
name|iImageid
operator|=
name|pChunk
operator|->
name|iImageid
expr_stmt|;
operator|*
name|iTile
operator|=
name|pChunk
operator|->
name|iTile
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_BACK
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_FRAM
end_ifndef
begin_function
DECL|function|mng_getchunk_fram
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_fram
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_bool
modifier|*
name|bEmpty
parameter_list|,
name|mng_uint8
modifier|*
name|iMode
parameter_list|,
name|mng_uint32
modifier|*
name|iNamesize
parameter_list|,
name|mng_pchar
modifier|*
name|zName
parameter_list|,
name|mng_uint8
modifier|*
name|iChangedelay
parameter_list|,
name|mng_uint8
modifier|*
name|iChangetimeout
parameter_list|,
name|mng_uint8
modifier|*
name|iChangeclipping
parameter_list|,
name|mng_uint8
modifier|*
name|iChangesyncid
parameter_list|,
name|mng_uint32
modifier|*
name|iDelay
parameter_list|,
name|mng_uint32
modifier|*
name|iTimeout
parameter_list|,
name|mng_uint8
modifier|*
name|iBoundarytype
parameter_list|,
name|mng_int32
modifier|*
name|iBoundaryl
parameter_list|,
name|mng_int32
modifier|*
name|iBoundaryr
parameter_list|,
name|mng_int32
modifier|*
name|iBoundaryt
parameter_list|,
name|mng_int32
modifier|*
name|iBoundaryb
parameter_list|,
name|mng_uint32
modifier|*
name|iCount
parameter_list|,
name|mng_uint32p
modifier|*
name|pSyncids
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_framp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_FRAM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_framp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_FRAM
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|bEmpty
operator|=
name|pChunk
operator|->
name|bEmpty
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iMode
operator|=
name|pChunk
operator|->
name|iMode
expr_stmt|;
operator|*
name|iNamesize
operator|=
name|pChunk
operator|->
name|iNamesize
expr_stmt|;
operator|*
name|zName
operator|=
name|pChunk
operator|->
name|zName
expr_stmt|;
operator|*
name|iChangedelay
operator|=
name|pChunk
operator|->
name|iChangedelay
expr_stmt|;
operator|*
name|iChangetimeout
operator|=
name|pChunk
operator|->
name|iChangetimeout
expr_stmt|;
operator|*
name|iChangeclipping
operator|=
name|pChunk
operator|->
name|iChangeclipping
expr_stmt|;
operator|*
name|iChangesyncid
operator|=
name|pChunk
operator|->
name|iChangesyncid
expr_stmt|;
operator|*
name|iDelay
operator|=
name|pChunk
operator|->
name|iDelay
expr_stmt|;
operator|*
name|iTimeout
operator|=
name|pChunk
operator|->
name|iTimeout
expr_stmt|;
operator|*
name|iBoundarytype
operator|=
name|pChunk
operator|->
name|iBoundarytype
expr_stmt|;
operator|*
name|iBoundaryl
operator|=
name|pChunk
operator|->
name|iBoundaryl
expr_stmt|;
operator|*
name|iBoundaryr
operator|=
name|pChunk
operator|->
name|iBoundaryr
expr_stmt|;
operator|*
name|iBoundaryt
operator|=
name|pChunk
operator|->
name|iBoundaryt
expr_stmt|;
operator|*
name|iBoundaryb
operator|=
name|pChunk
operator|->
name|iBoundaryb
expr_stmt|;
operator|*
name|iCount
operator|=
name|pChunk
operator|->
name|iCount
expr_stmt|;
operator|*
name|pSyncids
operator|=
name|pChunk
operator|->
name|pSyncids
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_FRAM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_MOVE
end_ifndef
begin_function
DECL|function|mng_getchunk_move
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_move
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint16
modifier|*
name|iFirstid
parameter_list|,
name|mng_uint16
modifier|*
name|iLastid
parameter_list|,
name|mng_uint8
modifier|*
name|iMovetype
parameter_list|,
name|mng_int32
modifier|*
name|iMovex
parameter_list|,
name|mng_int32
modifier|*
name|iMovey
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_movep
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_MOVE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_movep
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_MOVE
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iFirstid
operator|=
name|pChunk
operator|->
name|iFirstid
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iLastid
operator|=
name|pChunk
operator|->
name|iLastid
expr_stmt|;
operator|*
name|iMovetype
operator|=
name|pChunk
operator|->
name|iMovetype
expr_stmt|;
operator|*
name|iMovex
operator|=
name|pChunk
operator|->
name|iMovex
expr_stmt|;
operator|*
name|iMovey
operator|=
name|pChunk
operator|->
name|iMovey
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_MOVE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_CLIP
end_ifndef
begin_function
DECL|function|mng_getchunk_clip
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_clip
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint16
modifier|*
name|iFirstid
parameter_list|,
name|mng_uint16
modifier|*
name|iLastid
parameter_list|,
name|mng_uint8
modifier|*
name|iCliptype
parameter_list|,
name|mng_int32
modifier|*
name|iClipl
parameter_list|,
name|mng_int32
modifier|*
name|iClipr
parameter_list|,
name|mng_int32
modifier|*
name|iClipt
parameter_list|,
name|mng_int32
modifier|*
name|iClipb
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_clipp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_CLIP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_clipp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_CLIP
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iFirstid
operator|=
name|pChunk
operator|->
name|iFirstid
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iLastid
operator|=
name|pChunk
operator|->
name|iLastid
expr_stmt|;
operator|*
name|iCliptype
operator|=
name|pChunk
operator|->
name|iCliptype
expr_stmt|;
operator|*
name|iClipl
operator|=
name|pChunk
operator|->
name|iClipl
expr_stmt|;
operator|*
name|iClipr
operator|=
name|pChunk
operator|->
name|iClipr
expr_stmt|;
operator|*
name|iClipt
operator|=
name|pChunk
operator|->
name|iClipt
expr_stmt|;
operator|*
name|iClipb
operator|=
name|pChunk
operator|->
name|iClipb
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_CLIP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SHOW
end_ifndef
begin_function
DECL|function|mng_getchunk_show
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_show
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_bool
modifier|*
name|bEmpty
parameter_list|,
name|mng_uint16
modifier|*
name|iFirstid
parameter_list|,
name|mng_uint16
modifier|*
name|iLastid
parameter_list|,
name|mng_uint8
modifier|*
name|iMode
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_showp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_SHOW
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_showp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_SHOW
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|bEmpty
operator|=
name|pChunk
operator|->
name|bEmpty
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iFirstid
operator|=
name|pChunk
operator|->
name|iFirstid
expr_stmt|;
operator|*
name|iLastid
operator|=
name|pChunk
operator|->
name|iLastid
expr_stmt|;
operator|*
name|iMode
operator|=
name|pChunk
operator|->
name|iMode
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_SHOW
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_TERM
end_ifndef
begin_function
DECL|function|mng_getchunk_term
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_term
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint8
modifier|*
name|iTermaction
parameter_list|,
name|mng_uint8
modifier|*
name|iIteraction
parameter_list|,
name|mng_uint32
modifier|*
name|iDelay
parameter_list|,
name|mng_uint32
modifier|*
name|iItermax
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_termp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_TERM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_termp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_TERM
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iTermaction
operator|=
name|pChunk
operator|->
name|iTermaction
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iIteraction
operator|=
name|pChunk
operator|->
name|iIteraction
expr_stmt|;
operator|*
name|iDelay
operator|=
name|pChunk
operator|->
name|iDelay
expr_stmt|;
operator|*
name|iItermax
operator|=
name|pChunk
operator|->
name|iItermax
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_TERM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SAVE
end_ifndef
begin_function
DECL|function|mng_getchunk_save
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_save
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_bool
modifier|*
name|bEmpty
parameter_list|,
name|mng_uint8
modifier|*
name|iOffsettype
parameter_list|,
name|mng_uint32
modifier|*
name|iCount
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_savep
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_SAVE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_savep
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_SAVE
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|bEmpty
operator|=
name|pChunk
operator|->
name|bEmpty
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iOffsettype
operator|=
name|pChunk
operator|->
name|iOffsettype
expr_stmt|;
operator|*
name|iCount
operator|=
name|pChunk
operator|->
name|iCount
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_SAVE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_getchunk_save_entry
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_save_entry
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
name|iEntry
parameter_list|,
name|mng_uint8
modifier|*
name|iEntrytype
parameter_list|,
name|mng_uint32arr2
modifier|*
name|iOffset
parameter_list|,
name|mng_uint32arr2
modifier|*
name|iStarttime
parameter_list|,
name|mng_uint32
modifier|*
name|iLayernr
parameter_list|,
name|mng_uint32
modifier|*
name|iFramenr
parameter_list|,
name|mng_uint32
modifier|*
name|iNamesize
parameter_list|,
name|mng_pchar
modifier|*
name|zName
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_savep
name|pChunk
decl_stmt|;
name|mng_save_entryp
name|pEntry
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_SAVE_ENTRY
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_savep
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_SAVE
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
if|if
condition|(
name|iEntry
operator|>=
name|pChunk
operator|->
name|iCount
condition|)
comment|/* valid index ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_INVALIDENTRYIX
argument_list|)
name|pEntry
operator|=
name|pChunk
operator|->
name|pEntries
operator|+
name|iEntry
expr_stmt|;
comment|/* address the entry */
comment|/* fill the fields */
operator|*
name|iEntrytype
operator|=
name|pEntry
operator|->
name|iEntrytype
expr_stmt|;
operator|(
operator|*
name|iOffset
operator|)
index|[
literal|0
index|]
operator|=
name|pEntry
operator|->
name|iOffset
index|[
literal|0
index|]
expr_stmt|;
operator|(
operator|*
name|iOffset
operator|)
index|[
literal|1
index|]
operator|=
name|pEntry
operator|->
name|iOffset
index|[
literal|1
index|]
expr_stmt|;
operator|(
operator|*
name|iStarttime
operator|)
index|[
literal|0
index|]
operator|=
name|pEntry
operator|->
name|iStarttime
index|[
literal|0
index|]
expr_stmt|;
operator|(
operator|*
name|iStarttime
operator|)
index|[
literal|1
index|]
operator|=
name|pEntry
operator|->
name|iStarttime
index|[
literal|1
index|]
expr_stmt|;
operator|*
name|iLayernr
operator|=
name|pEntry
operator|->
name|iLayernr
expr_stmt|;
operator|*
name|iFramenr
operator|=
name|pEntry
operator|->
name|iFramenr
expr_stmt|;
operator|*
name|iNamesize
operator|=
name|pEntry
operator|->
name|iNamesize
expr_stmt|;
operator|*
name|zName
operator|=
name|pEntry
operator|->
name|zName
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_SAVE_ENTRY
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SEEK
end_ifndef
begin_function
DECL|function|mng_getchunk_seek
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_seek
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iNamesize
parameter_list|,
name|mng_pchar
modifier|*
name|zName
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_seekp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_SEEK
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_seekp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_SEEK
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iNamesize
operator|=
name|pChunk
operator|->
name|iNamesize
expr_stmt|;
comment|/* fill the fields */
operator|*
name|zName
operator|=
name|pChunk
operator|->
name|zName
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_SEEK
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_eXPI
end_ifndef
begin_function
DECL|function|mng_getchunk_expi
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_expi
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint16
modifier|*
name|iSnapshotid
parameter_list|,
name|mng_uint32
modifier|*
name|iNamesize
parameter_list|,
name|mng_pchar
modifier|*
name|zName
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_expip
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_EXPI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_expip
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_eXPI
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iSnapshotid
operator|=
name|pChunk
operator|->
name|iSnapshotid
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iNamesize
operator|=
name|pChunk
operator|->
name|iNamesize
expr_stmt|;
operator|*
name|zName
operator|=
name|pChunk
operator|->
name|zName
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_EXPI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_fPRI
end_ifndef
begin_function
DECL|function|mng_getchunk_fpri
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_fpri
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint8
modifier|*
name|iDeltatype
parameter_list|,
name|mng_uint8
modifier|*
name|iPriority
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_fprip
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_FPRI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_fprip
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_fPRI
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iDeltatype
operator|=
name|pChunk
operator|->
name|iDeltatype
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iPriority
operator|=
name|pChunk
operator|->
name|iPriority
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_FPRI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_nEED
end_ifndef
begin_function
DECL|function|mng_getchunk_need
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_need
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iKeywordssize
parameter_list|,
name|mng_pchar
modifier|*
name|zKeywords
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_needp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_NEED
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_needp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_nEED
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
comment|/* fill the fields */
operator|*
name|iKeywordssize
operator|=
name|pChunk
operator|->
name|iKeywordssize
expr_stmt|;
operator|*
name|zKeywords
operator|=
name|pChunk
operator|->
name|zKeywords
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_NEED
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_pHYg
end_ifndef
begin_function
DECL|function|mng_getchunk_phyg
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_phyg
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_bool
modifier|*
name|bEmpty
parameter_list|,
name|mng_uint32
modifier|*
name|iSizex
parameter_list|,
name|mng_uint32
modifier|*
name|iSizey
parameter_list|,
name|mng_uint8
modifier|*
name|iUnit
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_phygp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_PHYG
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_phygp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_pHYg
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|bEmpty
operator|=
name|pChunk
operator|->
name|bEmpty
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iSizex
operator|=
name|pChunk
operator|->
name|iSizex
expr_stmt|;
operator|*
name|iSizey
operator|=
name|pChunk
operator|->
name|iSizey
expr_stmt|;
operator|*
name|iUnit
operator|=
name|pChunk
operator|->
name|iUnit
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_PHYG
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
end_ifdef
begin_function
DECL|function|mng_getchunk_jhdr
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_jhdr
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iWidth
parameter_list|,
name|mng_uint32
modifier|*
name|iHeight
parameter_list|,
name|mng_uint8
modifier|*
name|iColortype
parameter_list|,
name|mng_uint8
modifier|*
name|iImagesampledepth
parameter_list|,
name|mng_uint8
modifier|*
name|iImagecompression
parameter_list|,
name|mng_uint8
modifier|*
name|iImageinterlace
parameter_list|,
name|mng_uint8
modifier|*
name|iAlphasampledepth
parameter_list|,
name|mng_uint8
modifier|*
name|iAlphacompression
parameter_list|,
name|mng_uint8
modifier|*
name|iAlphafilter
parameter_list|,
name|mng_uint8
modifier|*
name|iAlphainterlace
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_jhdrp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_JHDR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_jhdrp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_JHDR
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iWidth
operator|=
name|pChunk
operator|->
name|iWidth
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iHeight
operator|=
name|pChunk
operator|->
name|iHeight
expr_stmt|;
operator|*
name|iColortype
operator|=
name|pChunk
operator|->
name|iColortype
expr_stmt|;
operator|*
name|iImagesampledepth
operator|=
name|pChunk
operator|->
name|iImagesampledepth
expr_stmt|;
operator|*
name|iImagecompression
operator|=
name|pChunk
operator|->
name|iImagecompression
expr_stmt|;
operator|*
name|iImageinterlace
operator|=
name|pChunk
operator|->
name|iImageinterlace
expr_stmt|;
operator|*
name|iAlphasampledepth
operator|=
name|pChunk
operator|->
name|iAlphasampledepth
expr_stmt|;
operator|*
name|iAlphacompression
operator|=
name|pChunk
operator|->
name|iAlphacompression
expr_stmt|;
operator|*
name|iAlphafilter
operator|=
name|pChunk
operator|->
name|iAlphafilter
expr_stmt|;
operator|*
name|iAlphainterlace
operator|=
name|pChunk
operator|->
name|iAlphainterlace
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_JHDR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_INCLUDE_JNG */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
end_ifdef
begin_function
DECL|function|mng_getchunk_jdat
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_jdat
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iRawlen
parameter_list|,
name|mng_ptr
modifier|*
name|pRawdata
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_jdatp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_JDAT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_jdatp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_JDAT
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iRawlen
operator|=
name|pChunk
operator|->
name|iDatasize
expr_stmt|;
comment|/* fill the fields */
operator|*
name|pRawdata
operator|=
name|pChunk
operator|->
name|pData
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_JDAT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_INCLUDE_JNG */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
end_ifdef
begin_function
DECL|function|mng_getchunk_jdaa
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_jdaa
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iRawlen
parameter_list|,
name|mng_ptr
modifier|*
name|pRawdata
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_jdaap
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_JDAA
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_jdaap
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_JDAA
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iRawlen
operator|=
name|pChunk
operator|->
name|iDatasize
expr_stmt|;
comment|/* fill the fields */
operator|*
name|pRawdata
operator|=
name|pChunk
operator|->
name|pData
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_JDAA
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_INCLUDE_JNG */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_function
DECL|function|mng_getchunk_dhdr
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_dhdr
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint16
modifier|*
name|iObjectid
parameter_list|,
name|mng_uint8
modifier|*
name|iImagetype
parameter_list|,
name|mng_uint8
modifier|*
name|iDeltatype
parameter_list|,
name|mng_uint32
modifier|*
name|iBlockwidth
parameter_list|,
name|mng_uint32
modifier|*
name|iBlockheight
parameter_list|,
name|mng_uint32
modifier|*
name|iBlockx
parameter_list|,
name|mng_uint32
modifier|*
name|iBlocky
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_dhdrp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_DHDR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_dhdrp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_DHDR
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iObjectid
operator|=
name|pChunk
operator|->
name|iObjectid
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iImagetype
operator|=
name|pChunk
operator|->
name|iImagetype
expr_stmt|;
operator|*
name|iDeltatype
operator|=
name|pChunk
operator|->
name|iDeltatype
expr_stmt|;
operator|*
name|iBlockwidth
operator|=
name|pChunk
operator|->
name|iBlockwidth
expr_stmt|;
operator|*
name|iBlockheight
operator|=
name|pChunk
operator|->
name|iBlockheight
expr_stmt|;
operator|*
name|iBlockx
operator|=
name|pChunk
operator|->
name|iBlockx
expr_stmt|;
operator|*
name|iBlocky
operator|=
name|pChunk
operator|->
name|iBlocky
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_DHDR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_function
DECL|function|mng_getchunk_prom
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_prom
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint8
modifier|*
name|iColortype
parameter_list|,
name|mng_uint8
modifier|*
name|iSampledepth
parameter_list|,
name|mng_uint8
modifier|*
name|iFilltype
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_promp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_PROM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_promp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_PROM
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iColortype
operator|=
name|pChunk
operator|->
name|iColortype
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iSampledepth
operator|=
name|pChunk
operator|->
name|iSampledepth
expr_stmt|;
operator|*
name|iFilltype
operator|=
name|pChunk
operator|->
name|iFilltype
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_PROM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_function
DECL|function|mng_getchunk_pplt
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_pplt
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint8
modifier|*
name|iDeltatype
parameter_list|,
name|mng_uint32
modifier|*
name|iCount
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_ppltp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_PPLT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_ppltp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_PPLT
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iDeltatype
operator|=
name|pChunk
operator|->
name|iDeltatype
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iCount
operator|=
name|pChunk
operator|->
name|iCount
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_PPLT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_function
DECL|function|mng_getchunk_pplt_entry
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_pplt_entry
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
name|iEntry
parameter_list|,
name|mng_uint16
modifier|*
name|iRed
parameter_list|,
name|mng_uint16
modifier|*
name|iGreen
parameter_list|,
name|mng_uint16
modifier|*
name|iBlue
parameter_list|,
name|mng_uint16
modifier|*
name|iAlpha
parameter_list|,
name|mng_bool
modifier|*
name|bUsed
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_ppltp
name|pChunk
decl_stmt|;
name|mng_pplt_entryp
name|pEntry
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_PPLT_ENTRY
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_ppltp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_PPLT
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
if|if
condition|(
name|iEntry
operator|>=
name|pChunk
operator|->
name|iCount
condition|)
comment|/* valid index ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_INVALIDENTRYIX
argument_list|)
name|pEntry
operator|=
operator|&
name|pChunk
operator|->
name|aEntries
index|[
name|iEntry
index|]
expr_stmt|;
comment|/* address the entry */
operator|*
name|iRed
operator|=
name|pEntry
operator|->
name|iRed
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iGreen
operator|=
name|pEntry
operator|->
name|iGreen
expr_stmt|;
operator|*
name|iBlue
operator|=
name|pEntry
operator|->
name|iBlue
expr_stmt|;
operator|*
name|iAlpha
operator|=
name|pEntry
operator|->
name|iAlpha
expr_stmt|;
operator|*
name|bUsed
operator|=
name|pEntry
operator|->
name|bUsed
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_PPLT_ENTRY
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_function
DECL|function|mng_getchunk_drop
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_drop
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iCount
parameter_list|,
name|mng_chunkidp
modifier|*
name|pChunknames
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_dropp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_DROP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_dropp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_DROP
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iCount
operator|=
name|pChunk
operator|->
name|iCount
expr_stmt|;
comment|/* fill the fields */
operator|*
name|pChunknames
operator|=
name|pChunk
operator|->
name|pChunknames
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_DROP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_DBYK
end_ifndef
begin_function
DECL|function|mng_getchunk_dbyk
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_dbyk
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_chunkid
modifier|*
name|iChunkname
parameter_list|,
name|mng_uint8
modifier|*
name|iPolarity
parameter_list|,
name|mng_uint32
modifier|*
name|iKeywordssize
parameter_list|,
name|mng_pchar
modifier|*
name|zKeywords
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_dbykp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_DBYK
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_dbykp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_DBYK
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iChunkname
operator|=
name|pChunk
operator|->
name|iChunkname
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iPolarity
operator|=
name|pChunk
operator|->
name|iPolarity
expr_stmt|;
operator|*
name|iKeywordssize
operator|=
name|pChunk
operator|->
name|iKeywordssize
expr_stmt|;
operator|*
name|zKeywords
operator|=
name|pChunk
operator|->
name|zKeywords
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_DBYK
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_ORDR
end_ifndef
begin_function
DECL|function|mng_getchunk_ordr
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_ordr
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iCount
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_ordrp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_ORDR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_ordrp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_ORDR
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iCount
operator|=
name|pChunk
operator|->
name|iCount
expr_stmt|;
comment|/* fill the field */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_ORDR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_ORDR
end_ifndef
begin_function
DECL|function|mng_getchunk_ordr_entry
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_ordr_entry
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
name|iEntry
parameter_list|,
name|mng_chunkid
modifier|*
name|iChunkname
parameter_list|,
name|mng_uint8
modifier|*
name|iOrdertype
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_ordrp
name|pChunk
decl_stmt|;
name|mng_ordr_entryp
name|pEntry
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_ORDR_ENTRY
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_ordrp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_ORDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
if|if
condition|(
name|iEntry
operator|>=
name|pChunk
operator|->
name|iCount
condition|)
comment|/* valid index ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_INVALIDENTRYIX
argument_list|)
name|pEntry
operator|=
name|pChunk
operator|->
name|pEntries
operator|+
name|iEntry
expr_stmt|;
comment|/* address the proper entry */
operator|*
name|iChunkname
operator|=
name|pEntry
operator|->
name|iChunkname
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iOrdertype
operator|=
name|pEntry
operator|->
name|iOrdertype
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_ORDR_ENTRY
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_MAGN
end_ifndef
begin_function
DECL|function|mng_getchunk_magn
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_magn
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint16
modifier|*
name|iFirstid
parameter_list|,
name|mng_uint16
modifier|*
name|iLastid
parameter_list|,
name|mng_uint16
modifier|*
name|iMethodX
parameter_list|,
name|mng_uint16
modifier|*
name|iMX
parameter_list|,
name|mng_uint16
modifier|*
name|iMY
parameter_list|,
name|mng_uint16
modifier|*
name|iML
parameter_list|,
name|mng_uint16
modifier|*
name|iMR
parameter_list|,
name|mng_uint16
modifier|*
name|iMT
parameter_list|,
name|mng_uint16
modifier|*
name|iMB
parameter_list|,
name|mng_uint16
modifier|*
name|iMethodY
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_magnp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_MAGN
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_magnp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_MAGN
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iFirstid
operator|=
name|pChunk
operator|->
name|iFirstid
expr_stmt|;
comment|/* fill the fields */
operator|*
name|iLastid
operator|=
name|pChunk
operator|->
name|iLastid
expr_stmt|;
operator|*
name|iMethodX
operator|=
operator|(
name|mng_uint16
operator|)
name|pChunk
operator|->
name|iMethodX
expr_stmt|;
operator|*
name|iMX
operator|=
name|pChunk
operator|->
name|iMX
expr_stmt|;
operator|*
name|iMY
operator|=
name|pChunk
operator|->
name|iMY
expr_stmt|;
operator|*
name|iML
operator|=
name|pChunk
operator|->
name|iML
expr_stmt|;
operator|*
name|iMR
operator|=
name|pChunk
operator|->
name|iMR
expr_stmt|;
operator|*
name|iMT
operator|=
name|pChunk
operator|->
name|iMT
expr_stmt|;
operator|*
name|iMB
operator|=
name|pChunk
operator|->
name|iMB
expr_stmt|;
operator|*
name|iMethodY
operator|=
operator|(
name|mng_uint16
operator|)
name|pChunk
operator|->
name|iMethodY
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_MAGN
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_MPNG_PROPOSAL
end_ifdef
begin_function
DECL|function|mng_getchunk_mpng
name|MNG_EXT
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_mpng
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iFramewidth
parameter_list|,
name|mng_uint32
modifier|*
name|iFrameheight
parameter_list|,
name|mng_uint16
modifier|*
name|iNumplays
parameter_list|,
name|mng_uint16
modifier|*
name|iTickspersec
parameter_list|,
name|mng_uint8
modifier|*
name|iCompressionmethod
parameter_list|,
name|mng_uint32
modifier|*
name|iCount
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_mpngp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_MPNG
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_mpngp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_mpNG
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
comment|/* fill the fields */
operator|*
name|iFramewidth
operator|=
name|pChunk
operator|->
name|iFramewidth
expr_stmt|;
operator|*
name|iFrameheight
operator|=
name|pChunk
operator|->
name|iFrameheight
expr_stmt|;
operator|*
name|iNumplays
operator|=
name|pChunk
operator|->
name|iNumplays
expr_stmt|;
operator|*
name|iTickspersec
operator|=
name|pChunk
operator|->
name|iTickspersec
expr_stmt|;
operator|*
name|iCompressionmethod
operator|=
name|pChunk
operator|->
name|iCompressionmethod
expr_stmt|;
operator|*
name|iCount
operator|=
name|pChunk
operator|->
name|iFramessize
operator|/
sizeof|sizeof
argument_list|(
name|mng_mpng_frame
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_MPNG
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_MPNG_PROPOSAL
end_ifdef
begin_function
DECL|function|mng_getchunk_mpng_frame
name|MNG_EXT
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_mpng_frame
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
name|iEntry
parameter_list|,
name|mng_uint32
modifier|*
name|iX
parameter_list|,
name|mng_uint32
modifier|*
name|iY
parameter_list|,
name|mng_uint32
modifier|*
name|iWidth
parameter_list|,
name|mng_uint32
modifier|*
name|iHeight
parameter_list|,
name|mng_int32
modifier|*
name|iXoffset
parameter_list|,
name|mng_int32
modifier|*
name|iYoffset
parameter_list|,
name|mng_uint16
modifier|*
name|iTicks
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_mpngp
name|pChunk
decl_stmt|;
name|mng_mpng_framep
name|pFrame
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_MPNG_FRAME
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_mpngp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_mpNG
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
comment|/* valid index ? */
if|if
condition|(
name|iEntry
operator|>=
operator|(
name|pChunk
operator|->
name|iFramessize
operator|/
sizeof|sizeof
argument_list|(
name|mng_mpng_frame
argument_list|)
operator|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_INVALIDENTRYIX
argument_list|)
name|pFrame
operator|=
name|pChunk
operator|->
name|pFrames
operator|+
name|iEntry
expr_stmt|;
comment|/* address the entry */
comment|/* fill the fields */
operator|*
name|iX
operator|=
name|pFrame
operator|->
name|iX
expr_stmt|;
operator|*
name|iY
operator|=
name|pFrame
operator|->
name|iY
expr_stmt|;
operator|*
name|iWidth
operator|=
name|pFrame
operator|->
name|iWidth
expr_stmt|;
operator|*
name|iHeight
operator|=
name|pFrame
operator|->
name|iHeight
expr_stmt|;
operator|*
name|iXoffset
operator|=
name|pFrame
operator|->
name|iXoffset
expr_stmt|;
operator|*
name|iYoffset
operator|=
name|pFrame
operator|->
name|iYoffset
expr_stmt|;
operator|*
name|iTicks
operator|=
name|pFrame
operator|->
name|iTicks
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_MPNG_FRAME
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_evNT
end_ifndef
begin_function
DECL|function|mng_getchunk_evnt
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_evnt
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
modifier|*
name|iCount
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_evntp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_EVNT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_evntp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_evNT
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
operator|*
name|iCount
operator|=
name|pChunk
operator|->
name|iCount
expr_stmt|;
comment|/* fill the fields */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_EVNT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_getchunk_evnt_entry
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_evnt_entry
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
name|iEntry
parameter_list|,
name|mng_uint8
modifier|*
name|iEventtype
parameter_list|,
name|mng_uint8
modifier|*
name|iMasktype
parameter_list|,
name|mng_int32
modifier|*
name|iLeft
parameter_list|,
name|mng_int32
modifier|*
name|iRight
parameter_list|,
name|mng_int32
modifier|*
name|iTop
parameter_list|,
name|mng_int32
modifier|*
name|iBottom
parameter_list|,
name|mng_uint16
modifier|*
name|iObjectid
parameter_list|,
name|mng_uint8
modifier|*
name|iIndex
parameter_list|,
name|mng_uint32
modifier|*
name|iSegmentnamesize
parameter_list|,
name|mng_pchar
modifier|*
name|zSegmentname
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_evntp
name|pChunk
decl_stmt|;
name|mng_evnt_entryp
name|pEntry
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_EVNT_ENTRY
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_evntp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
operator|!=
name|MNG_UINT_evNT
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
if|if
condition|(
name|iEntry
operator|>=
name|pChunk
operator|->
name|iCount
condition|)
comment|/* valid index ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_INVALIDENTRYIX
argument_list|)
name|pEntry
operator|=
name|pChunk
operator|->
name|pEntries
operator|+
name|iEntry
expr_stmt|;
comment|/* address the entry */
comment|/* fill the fields */
operator|*
name|iEventtype
operator|=
name|pEntry
operator|->
name|iEventtype
expr_stmt|;
operator|*
name|iMasktype
operator|=
name|pEntry
operator|->
name|iMasktype
expr_stmt|;
operator|*
name|iLeft
operator|=
name|pEntry
operator|->
name|iLeft
expr_stmt|;
operator|*
name|iRight
operator|=
name|pEntry
operator|->
name|iRight
expr_stmt|;
operator|*
name|iTop
operator|=
name|pEntry
operator|->
name|iTop
expr_stmt|;
operator|*
name|iBottom
operator|=
name|pEntry
operator|->
name|iBottom
expr_stmt|;
operator|*
name|iObjectid
operator|=
name|pEntry
operator|->
name|iObjectid
expr_stmt|;
operator|*
name|iIndex
operator|=
name|pEntry
operator|->
name|iIndex
expr_stmt|;
operator|*
name|iSegmentnamesize
operator|=
name|pEntry
operator|->
name|iSegmentnamesize
expr_stmt|;
operator|*
name|zSegmentname
operator|=
name|pEntry
operator|->
name|zSegmentname
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_EVNT_ENTRY
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_getchunk_unknown
name|mng_retcode
name|MNG_DECL
name|mng_getchunk_unknown
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_chunkid
modifier|*
name|iChunkname
parameter_list|,
name|mng_uint32
modifier|*
name|iRawlen
parameter_list|,
name|mng_ptr
modifier|*
name|pRawdata
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_unknown_chunkp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_UNKNOWN
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
name|pChunk
operator|=
operator|(
name|mng_unknown_chunkp
operator|)
name|hChunk
expr_stmt|;
comment|/* address the chunk */
if|if
condition|(
name|pChunk
operator|->
name|sHeader
operator|.
name|fCleanup
operator|!=
name|mng_free_unknown
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_WRONGCHUNK
argument_list|)
comment|/* ouch */
comment|/* fill the fields */
operator|*
name|iChunkname
operator|=
name|pChunk
operator|->
name|sHeader
operator|.
name|iChunkname
expr_stmt|;
operator|*
name|iRawlen
operator|=
name|pChunk
operator|->
name|iDatasize
expr_stmt|;
operator|*
name|pRawdata
operator|=
name|pChunk
operator|->
name|pData
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETCHUNK_UNKNOWN
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_WRITE_PROCS
end_ifdef
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_TERM
end_ifndef
begin_function
DECL|function|check_term
name|MNG_LOCAL
name|mng_bool
name|check_term
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_chunkid
name|iChunkname
parameter_list|)
block|{
name|mng_chunk_headerp
name|pChunk
init|=
operator|(
name|mng_chunk_headerp
operator|)
name|pData
operator|->
name|pLastchunk
decl_stmt|;
if|if
condition|(
operator|!
name|pChunk
condition|)
comment|/* nothing added yet ? */
return|return
name|MNG_TRUE
return|;
comment|/* last added chunk is TERM ? */
if|if
condition|(
name|pChunk
operator|->
name|iChunkname
operator|!=
name|MNG_UINT_TERM
condition|)
return|return
name|MNG_TRUE
return|;
comment|/* previous to last is MHDR ? */
if|if
condition|(
operator|(
name|pChunk
operator|->
name|pPrev
operator|)
operator|&&
operator|(
operator|(
operator|(
name|mng_chunk_headerp
operator|)
name|pChunk
operator|->
name|pPrev
operator|)
operator|->
name|iChunkname
operator|==
name|MNG_UINT_MHDR
operator|)
condition|)
return|return
name|MNG_TRUE
return|;
if|if
condition|(
name|iChunkname
operator|==
name|MNG_UINT_SEEK
condition|)
comment|/* new chunk to be added is SEEK ? */
return|return
name|MNG_TRUE
return|;
return|return
name|MNG_FALSE
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_putchunk_ihdr
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_ihdr
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint32
name|iHeight
parameter_list|,
name|mng_uint8
name|iBitdepth
parameter_list|,
name|mng_uint8
name|iColortype
parameter_list|,
name|mng_uint8
name|iCompression
parameter_list|,
name|mng_uint8
name|iFilter
parameter_list|,
name|mng_uint8
name|iInterlace
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_IHDR
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_ihdr
block|,
name|mng_write_ihdr
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_ihdr
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_IHDR
operator|,
name|mng_init_ihdr
operator|,
name|mng_free_ihdr
operator|,
name|mng_read_ihdr
operator|,
name|mng_write_ihdr
operator|,
name|mng_assign_ihdr
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_IHDR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_IHDR
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_ihdr
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_IHDR
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
operator|(
operator|(
name|mng_ihdrp
operator|)
name|pChunk
operator|)
operator|->
name|iWidth
operator|=
name|iWidth
expr_stmt|;
operator|(
operator|(
name|mng_ihdrp
operator|)
name|pChunk
operator|)
operator|->
name|iHeight
operator|=
name|iHeight
expr_stmt|;
operator|(
operator|(
name|mng_ihdrp
operator|)
name|pChunk
operator|)
operator|->
name|iBitdepth
operator|=
name|iBitdepth
expr_stmt|;
operator|(
operator|(
name|mng_ihdrp
operator|)
name|pChunk
operator|)
operator|->
name|iColortype
operator|=
name|iColortype
expr_stmt|;
operator|(
operator|(
name|mng_ihdrp
operator|)
name|pChunk
operator|)
operator|->
name|iCompression
operator|=
name|iCompression
expr_stmt|;
operator|(
operator|(
name|mng_ihdrp
operator|)
name|pChunk
operator|)
operator|->
name|iFilter
operator|=
name|iFilter
expr_stmt|;
operator|(
operator|(
name|mng_ihdrp
operator|)
name|pChunk
operator|)
operator|->
name|iInterlace
operator|=
name|iInterlace
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_IHDR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_putchunk_plte
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_plte
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iCount
parameter_list|,
name|mng_palette8
name|aPalette
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_PLTE
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_plte
block|,
name|mng_write_plte
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_plte
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_PLTE
operator|,
name|mng_init_plte
operator|,
name|mng_free_plte
operator|,
name|mng_read_plte
operator|,
name|mng_write_plte
operator|,
name|mng_assign_plte
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_PLTE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_PLTE
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_plte
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_PLTE
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_pltep
operator|)
name|pChunk
operator|)
operator|->
name|iEntrycount
operator|=
name|iCount
expr_stmt|;
operator|(
operator|(
name|mng_pltep
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
operator|=
call|(
name|mng_bool
call|)
argument_list|(
name|iCount
operator|==
literal|0
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_pltep
operator|)
name|pChunk
operator|)
operator|->
name|aEntries
argument_list|,
name|aPalette
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_palette8
argument_list|)
argument_list|)
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_PLTE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_putchunk_idat
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_idat
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iRawlen
parameter_list|,
name|mng_ptr
name|pRawdata
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_IDAT
block|,
name|mng_init_general
block|,
name|mng_free_idat
block|,
name|mng_read_idat
block|,
name|mng_write_idat
block|,
name|mng_assign_idat
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_idat
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_IDAT
operator|,
name|mng_init_idat
operator|,
name|mng_free_idat
operator|,
name|mng_read_idat
operator|,
name|mng_write_idat
operator|,
name|mng_assign_idat
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_IDAT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_IDAT
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_idat
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_IDAT
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_idatp
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
operator|=
call|(
name|mng_bool
call|)
argument_list|(
name|iRawlen
operator|==
literal|0
argument_list|)
expr_stmt|;
operator|(
operator|(
name|mng_idatp
operator|)
name|pChunk
operator|)
operator|->
name|iDatasize
operator|=
name|iRawlen
expr_stmt|;
if|if
condition|(
name|iRawlen
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_idatp
operator|)
name|pChunk
operator|)
operator|->
name|pData
argument_list|,
name|iRawlen
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_idatp
operator|)
name|pChunk
operator|)
operator|->
name|pData
argument_list|,
name|pRawdata
argument_list|,
name|iRawlen
argument_list|)
expr_stmt|;
block|}
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_IDAT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_putchunk_iend
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_iend
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_IEND
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_iend
block|,
name|mng_write_iend
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_iend
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_IEND
operator|,
name|mng_init_iend
operator|,
name|mng_free_iend
operator|,
name|mng_read_iend
operator|,
name|mng_write_iend
operator|,
name|mng_assign_iend
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_IEND
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_IEND
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_iend
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_IEND
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
if|if
condition|(
operator|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
name|MNG_UINT_IHDR
operator|)
operator|||
operator|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
name|MNG_UINT_JHDR
operator|)
condition|)
else|#
directive|else
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
name|MNG_UINT_IHDR
condition|)
endif|#
directive|endif
name|pData
operator|->
name|bCreating
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* should be last chunk !!! */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_IEND
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_putchunk_trns
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_trns
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_bool
name|bEmpty
parameter_list|,
name|mng_bool
name|bGlobal
parameter_list|,
name|mng_uint8
name|iType
parameter_list|,
name|mng_uint32
name|iCount
parameter_list|,
name|mng_uint8arr
name|aAlphas
parameter_list|,
name|mng_uint16
name|iGray
parameter_list|,
name|mng_uint16
name|iRed
parameter_list|,
name|mng_uint16
name|iGreen
parameter_list|,
name|mng_uint16
name|iBlue
parameter_list|,
name|mng_uint32
name|iRawlen
parameter_list|,
name|mng_uint8arr
name|aRawdata
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_tRNS
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_trns
block|,
name|mng_write_trns
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_trns
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_tRNS
operator|,
name|mng_init_trns
operator|,
name|mng_free_trns
operator|,
name|mng_read_trns
operator|,
name|mng_write_trns
operator|,
name|mng_assign_trns
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_TRNS
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_tRNS
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_trns
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_tRNS
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_trnsp
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
operator|=
name|bEmpty
expr_stmt|;
operator|(
operator|(
name|mng_trnsp
operator|)
name|pChunk
operator|)
operator|->
name|bGlobal
operator|=
name|bGlobal
expr_stmt|;
operator|(
operator|(
name|mng_trnsp
operator|)
name|pChunk
operator|)
operator|->
name|iType
operator|=
name|iType
expr_stmt|;
operator|(
operator|(
name|mng_trnsp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
operator|=
name|iCount
expr_stmt|;
operator|(
operator|(
name|mng_trnsp
operator|)
name|pChunk
operator|)
operator|->
name|iGray
operator|=
name|iGray
expr_stmt|;
operator|(
operator|(
name|mng_trnsp
operator|)
name|pChunk
operator|)
operator|->
name|iRed
operator|=
name|iRed
expr_stmt|;
operator|(
operator|(
name|mng_trnsp
operator|)
name|pChunk
operator|)
operator|->
name|iGreen
operator|=
name|iGreen
expr_stmt|;
operator|(
operator|(
name|mng_trnsp
operator|)
name|pChunk
operator|)
operator|->
name|iBlue
operator|=
name|iBlue
expr_stmt|;
operator|(
operator|(
name|mng_trnsp
operator|)
name|pChunk
operator|)
operator|->
name|iRawlen
operator|=
name|iRawlen
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_trnsp
operator|)
name|pChunk
operator|)
operator|->
name|aEntries
argument_list|,
name|aAlphas
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_uint8arr
argument_list|)
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_trnsp
operator|)
name|pChunk
operator|)
operator|->
name|aRawdata
argument_list|,
name|aRawdata
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_uint8arr
argument_list|)
argument_list|)
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_TRNS
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_gAMA
end_ifndef
begin_function
DECL|function|mng_putchunk_gama
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_gama
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_bool
name|bEmpty
parameter_list|,
name|mng_uint32
name|iGamma
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_gAMA
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_gama
block|,
name|mng_write_gama
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_gama
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_gAMA
operator|,
name|mng_init_gama
operator|,
name|mng_free_gama
operator|,
name|mng_read_gama
operator|,
name|mng_write_gama
operator|,
name|mng_assign_gama
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_GAMA
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_gAMA
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_gama
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_gAMA
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_gamap
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
operator|=
name|bEmpty
expr_stmt|;
operator|(
operator|(
name|mng_gamap
operator|)
name|pChunk
operator|)
operator|->
name|iGamma
operator|=
name|iGamma
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_GAMA
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_cHRM
end_ifndef
begin_function
DECL|function|mng_putchunk_chrm
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_chrm
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_bool
name|bEmpty
parameter_list|,
name|mng_uint32
name|iWhitepointx
parameter_list|,
name|mng_uint32
name|iWhitepointy
parameter_list|,
name|mng_uint32
name|iRedx
parameter_list|,
name|mng_uint32
name|iRedy
parameter_list|,
name|mng_uint32
name|iGreenx
parameter_list|,
name|mng_uint32
name|iGreeny
parameter_list|,
name|mng_uint32
name|iBluex
parameter_list|,
name|mng_uint32
name|iBluey
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_cHRM
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_chrm
block|,
name|mng_write_chrm
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_chrm
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_cHRM
operator|,
name|mng_init_chrm
operator|,
name|mng_free_chrm
operator|,
name|mng_read_chrm
operator|,
name|mng_write_chrm
operator|,
name|mng_assign_chrm
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_CHRM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_cHRM
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_chrm
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_cHRM
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
operator|=
name|bEmpty
expr_stmt|;
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|iWhitepointx
operator|=
name|iWhitepointx
expr_stmt|;
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|iWhitepointy
operator|=
name|iWhitepointy
expr_stmt|;
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|iRedx
operator|=
name|iRedx
expr_stmt|;
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|iRedy
operator|=
name|iRedy
expr_stmt|;
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|iGreenx
operator|=
name|iGreenx
expr_stmt|;
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|iGreeny
operator|=
name|iGreeny
expr_stmt|;
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|iBluex
operator|=
name|iBluex
expr_stmt|;
operator|(
operator|(
name|mng_chrmp
operator|)
name|pChunk
operator|)
operator|->
name|iBluey
operator|=
name|iBluey
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_CHRM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_sRGB
end_ifndef
begin_function
DECL|function|mng_putchunk_srgb
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_srgb
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_bool
name|bEmpty
parameter_list|,
name|mng_uint8
name|iRenderingintent
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_sRGB
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_srgb
block|,
name|mng_write_srgb
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_srgb
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_sRGB
operator|,
name|mng_init_srgb
operator|,
name|mng_free_srgb
operator|,
name|mng_read_srgb
operator|,
name|mng_write_srgb
operator|,
name|mng_assign_srgb
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_SRGB
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_sRGB
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_srgb
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_sRGB
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_srgbp
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
operator|=
name|bEmpty
expr_stmt|;
operator|(
operator|(
name|mng_srgbp
operator|)
name|pChunk
operator|)
operator|->
name|iRenderingintent
operator|=
name|iRenderingintent
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_SRGB
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
end_ifndef
begin_function
DECL|function|mng_putchunk_iccp
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_iccp
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_bool
name|bEmpty
parameter_list|,
name|mng_uint32
name|iNamesize
parameter_list|,
name|mng_pchar
name|zName
parameter_list|,
name|mng_uint8
name|iCompression
parameter_list|,
name|mng_uint32
name|iProfilesize
parameter_list|,
name|mng_ptr
name|pProfile
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_iCCP
block|,
name|mng_init_general
block|,
name|mng_free_iccp
block|,
name|mng_read_iccp
block|,
name|mng_write_iccp
block|,
name|mng_assign_iccp
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_iccp
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_iCCP
operator|,
name|mng_init_iccp
operator|,
name|mng_free_iccp
operator|,
name|mng_read_iccp
operator|,
name|mng_write_iccp
operator|,
name|mng_assign_iccp
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_ICCP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_iCCP
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_iccp
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_iCCP
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_iccpp
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
operator|=
name|bEmpty
expr_stmt|;
operator|(
operator|(
name|mng_iccpp
operator|)
name|pChunk
operator|)
operator|->
name|iNamesize
operator|=
name|iNamesize
expr_stmt|;
operator|(
operator|(
name|mng_iccpp
operator|)
name|pChunk
operator|)
operator|->
name|iCompression
operator|=
name|iCompression
expr_stmt|;
operator|(
operator|(
name|mng_iccpp
operator|)
name|pChunk
operator|)
operator|->
name|iProfilesize
operator|=
name|iProfilesize
expr_stmt|;
if|if
condition|(
name|iNamesize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_iccpp
operator|)
name|pChunk
operator|)
operator|->
name|zName
argument_list|,
name|iNamesize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_iccpp
operator|)
name|pChunk
operator|)
operator|->
name|zName
argument_list|,
name|zName
argument_list|,
name|iNamesize
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|iProfilesize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_iccpp
operator|)
name|pChunk
operator|)
operator|->
name|pProfile
argument_list|,
name|iProfilesize
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_iccpp
operator|)
name|pChunk
operator|)
operator|->
name|pProfile
argument_list|,
name|pProfile
argument_list|,
name|iProfilesize
argument_list|)
expr_stmt|;
block|}
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_ICCP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_tEXt
end_ifndef
begin_function
DECL|function|mng_putchunk_text
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_text
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iKeywordsize
parameter_list|,
name|mng_pchar
name|zKeyword
parameter_list|,
name|mng_uint32
name|iTextsize
parameter_list|,
name|mng_pchar
name|zText
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_tEXt
block|,
name|mng_init_general
block|,
name|mng_free_text
block|,
name|mng_read_text
block|,
name|mng_write_text
block|,
name|mng_assign_text
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_text
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_tEXt
operator|,
name|mng_init_text
operator|,
name|mng_free_text
operator|,
name|mng_read_text
operator|,
name|mng_write_text
operator|,
name|mng_assign_text
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_TEXT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_tEXt
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_text
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_tEXt
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_textp
operator|)
name|pChunk
operator|)
operator|->
name|iKeywordsize
operator|=
name|iKeywordsize
expr_stmt|;
operator|(
operator|(
name|mng_textp
operator|)
name|pChunk
operator|)
operator|->
name|iTextsize
operator|=
name|iTextsize
expr_stmt|;
if|if
condition|(
name|iKeywordsize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_textp
operator|)
name|pChunk
operator|)
operator|->
name|zKeyword
argument_list|,
name|iKeywordsize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_textp
operator|)
name|pChunk
operator|)
operator|->
name|zKeyword
argument_list|,
name|zKeyword
argument_list|,
name|iKeywordsize
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|iTextsize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_textp
operator|)
name|pChunk
operator|)
operator|->
name|zText
argument_list|,
name|iTextsize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_textp
operator|)
name|pChunk
operator|)
operator|->
name|zText
argument_list|,
name|zText
argument_list|,
name|iTextsize
argument_list|)
expr_stmt|;
block|}
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_TEXT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_zTXt
end_ifndef
begin_function
DECL|function|mng_putchunk_ztxt
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_ztxt
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iKeywordsize
parameter_list|,
name|mng_pchar
name|zKeyword
parameter_list|,
name|mng_uint8
name|iCompression
parameter_list|,
name|mng_uint32
name|iTextsize
parameter_list|,
name|mng_pchar
name|zText
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_zTXt
block|,
name|mng_init_general
block|,
name|mng_free_ztxt
block|,
name|mng_read_ztxt
block|,
name|mng_write_ztxt
block|,
name|mng_assign_ztxt
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_ztxt
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_zTXt
operator|,
name|mng_init_ztxt
operator|,
name|mng_free_ztxt
operator|,
name|mng_read_ztxt
operator|,
name|mng_write_ztxt
operator|,
name|mng_assign_ztxt
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_ZTXT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_zTXt
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_ztxt
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_zTXt
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_ztxtp
operator|)
name|pChunk
operator|)
operator|->
name|iKeywordsize
operator|=
name|iKeywordsize
expr_stmt|;
operator|(
operator|(
name|mng_ztxtp
operator|)
name|pChunk
operator|)
operator|->
name|iCompression
operator|=
name|iCompression
expr_stmt|;
operator|(
operator|(
name|mng_ztxtp
operator|)
name|pChunk
operator|)
operator|->
name|iTextsize
operator|=
name|iTextsize
expr_stmt|;
if|if
condition|(
name|iKeywordsize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_ztxtp
operator|)
name|pChunk
operator|)
operator|->
name|zKeyword
argument_list|,
name|iKeywordsize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_ztxtp
operator|)
name|pChunk
operator|)
operator|->
name|zKeyword
argument_list|,
name|zKeyword
argument_list|,
name|iKeywordsize
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|iTextsize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_ztxtp
operator|)
name|pChunk
operator|)
operator|->
name|zText
argument_list|,
name|iTextsize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_ztxtp
operator|)
name|pChunk
operator|)
operator|->
name|zText
argument_list|,
name|zText
argument_list|,
name|iTextsize
argument_list|)
expr_stmt|;
block|}
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_ZTXT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iTXt
end_ifndef
begin_function
DECL|function|mng_putchunk_itxt
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_itxt
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iKeywordsize
parameter_list|,
name|mng_pchar
name|zKeyword
parameter_list|,
name|mng_uint8
name|iCompressionflag
parameter_list|,
name|mng_uint8
name|iCompressionmethod
parameter_list|,
name|mng_uint32
name|iLanguagesize
parameter_list|,
name|mng_pchar
name|zLanguage
parameter_list|,
name|mng_uint32
name|iTranslationsize
parameter_list|,
name|mng_pchar
name|zTranslation
parameter_list|,
name|mng_uint32
name|iTextsize
parameter_list|,
name|mng_pchar
name|zText
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_iTXt
block|,
name|mng_init_general
block|,
name|mng_free_itxt
block|,
name|mng_read_itxt
block|,
name|mng_write_itxt
block|,
name|mng_assign_itxt
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_itxt
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_iTXt
operator|,
name|mng_init_itxt
operator|,
name|mng_free_itxt
operator|,
name|mng_read_itxt
operator|,
name|mng_write_itxt
operator|,
name|mng_assign_itxt
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_ITXT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_iTXt
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_itxt
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_iTXt
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_itxtp
operator|)
name|pChunk
operator|)
operator|->
name|iKeywordsize
operator|=
name|iKeywordsize
expr_stmt|;
operator|(
operator|(
name|mng_itxtp
operator|)
name|pChunk
operator|)
operator|->
name|iCompressionflag
operator|=
name|iCompressionflag
expr_stmt|;
operator|(
operator|(
name|mng_itxtp
operator|)
name|pChunk
operator|)
operator|->
name|iCompressionmethod
operator|=
name|iCompressionmethod
expr_stmt|;
operator|(
operator|(
name|mng_itxtp
operator|)
name|pChunk
operator|)
operator|->
name|iLanguagesize
operator|=
name|iLanguagesize
expr_stmt|;
operator|(
operator|(
name|mng_itxtp
operator|)
name|pChunk
operator|)
operator|->
name|iTranslationsize
operator|=
name|iTranslationsize
expr_stmt|;
operator|(
operator|(
name|mng_itxtp
operator|)
name|pChunk
operator|)
operator|->
name|iTextsize
operator|=
name|iTextsize
expr_stmt|;
if|if
condition|(
name|iKeywordsize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_itxtp
operator|)
name|pChunk
operator|)
operator|->
name|zKeyword
argument_list|,
name|iKeywordsize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_itxtp
operator|)
name|pChunk
operator|)
operator|->
name|zKeyword
argument_list|,
name|zKeyword
argument_list|,
name|iKeywordsize
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|iLanguagesize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_itxtp
operator|)
name|pChunk
operator|)
operator|->
name|zLanguage
argument_list|,
name|iLanguagesize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_itxtp
operator|)
name|pChunk
operator|)
operator|->
name|zLanguage
argument_list|,
name|zLanguage
argument_list|,
name|iLanguagesize
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|iTranslationsize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_itxtp
operator|)
name|pChunk
operator|)
operator|->
name|zTranslation
argument_list|,
name|iTranslationsize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_itxtp
operator|)
name|pChunk
operator|)
operator|->
name|zTranslation
argument_list|,
name|zTranslation
argument_list|,
name|iTranslationsize
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|iTextsize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_itxtp
operator|)
name|pChunk
operator|)
operator|->
name|zText
argument_list|,
name|iTextsize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_itxtp
operator|)
name|pChunk
operator|)
operator|->
name|zText
argument_list|,
name|zText
argument_list|,
name|iTextsize
argument_list|)
expr_stmt|;
block|}
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_ITXT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_bKGD
end_ifndef
begin_function
DECL|function|mng_putchunk_bkgd
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_bkgd
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_bool
name|bEmpty
parameter_list|,
name|mng_uint8
name|iType
parameter_list|,
name|mng_uint8
name|iIndex
parameter_list|,
name|mng_uint16
name|iGray
parameter_list|,
name|mng_uint16
name|iRed
parameter_list|,
name|mng_uint16
name|iGreen
parameter_list|,
name|mng_uint16
name|iBlue
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_bKGD
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_bkgd
block|,
name|mng_write_bkgd
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_bkgd
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_bKGD
operator|,
name|mng_init_bkgd
operator|,
name|mng_free_bkgd
operator|,
name|mng_read_bkgd
operator|,
name|mng_write_bkgd
operator|,
name|mng_assign_bkgd
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_BKGD
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_bKGD
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_bkgd
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_bKGD
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_bkgdp
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
operator|=
name|bEmpty
expr_stmt|;
operator|(
operator|(
name|mng_bkgdp
operator|)
name|pChunk
operator|)
operator|->
name|iType
operator|=
name|iType
expr_stmt|;
operator|(
operator|(
name|mng_bkgdp
operator|)
name|pChunk
operator|)
operator|->
name|iIndex
operator|=
name|iIndex
expr_stmt|;
operator|(
operator|(
name|mng_bkgdp
operator|)
name|pChunk
operator|)
operator|->
name|iGray
operator|=
name|iGray
expr_stmt|;
operator|(
operator|(
name|mng_bkgdp
operator|)
name|pChunk
operator|)
operator|->
name|iRed
operator|=
name|iRed
expr_stmt|;
operator|(
operator|(
name|mng_bkgdp
operator|)
name|pChunk
operator|)
operator|->
name|iGreen
operator|=
name|iGreen
expr_stmt|;
operator|(
operator|(
name|mng_bkgdp
operator|)
name|pChunk
operator|)
operator|->
name|iBlue
operator|=
name|iBlue
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_BKGD
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_pHYs
end_ifndef
begin_function
DECL|function|mng_putchunk_phys
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_phys
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_bool
name|bEmpty
parameter_list|,
name|mng_uint32
name|iSizex
parameter_list|,
name|mng_uint32
name|iSizey
parameter_list|,
name|mng_uint8
name|iUnit
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_pHYs
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_phys
block|,
name|mng_write_phys
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_phys
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_pHYs
operator|,
name|mng_init_phys
operator|,
name|mng_free_phys
operator|,
name|mng_read_phys
operator|,
name|mng_write_phys
operator|,
name|mng_assign_phys
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_PHYS
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_pHYs
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_phys
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_pHYs
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_physp
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
operator|=
name|bEmpty
expr_stmt|;
operator|(
operator|(
name|mng_physp
operator|)
name|pChunk
operator|)
operator|->
name|iSizex
operator|=
name|iSizex
expr_stmt|;
operator|(
operator|(
name|mng_physp
operator|)
name|pChunk
operator|)
operator|->
name|iSizey
operator|=
name|iSizey
expr_stmt|;
operator|(
operator|(
name|mng_physp
operator|)
name|pChunk
operator|)
operator|->
name|iUnit
operator|=
name|iUnit
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_PHYS
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_sBIT
end_ifndef
begin_function
DECL|function|mng_putchunk_sbit
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_sbit
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_bool
name|bEmpty
parameter_list|,
name|mng_uint8
name|iType
parameter_list|,
name|mng_uint8arr4
name|aBits
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_sBIT
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_sbit
block|,
name|mng_write_sbit
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_sbit
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_sBIT
operator|,
name|mng_init_sbit
operator|,
name|mng_free_sbit
operator|,
name|mng_read_sbit
operator|,
name|mng_write_sbit
operator|,
name|mng_assign_sbit
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_SBIT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_sBIT
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_sbit
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_sBIT
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_sbitp
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
operator|=
name|bEmpty
expr_stmt|;
operator|(
operator|(
name|mng_sbitp
operator|)
name|pChunk
operator|)
operator|->
name|iType
operator|=
name|iType
expr_stmt|;
operator|(
operator|(
name|mng_sbitp
operator|)
name|pChunk
operator|)
operator|->
name|aBits
index|[
literal|0
index|]
operator|=
name|aBits
index|[
literal|0
index|]
expr_stmt|;
operator|(
operator|(
name|mng_sbitp
operator|)
name|pChunk
operator|)
operator|->
name|aBits
index|[
literal|1
index|]
operator|=
name|aBits
index|[
literal|1
index|]
expr_stmt|;
operator|(
operator|(
name|mng_sbitp
operator|)
name|pChunk
operator|)
operator|->
name|aBits
index|[
literal|2
index|]
operator|=
name|aBits
index|[
literal|2
index|]
expr_stmt|;
operator|(
operator|(
name|mng_sbitp
operator|)
name|pChunk
operator|)
operator|->
name|aBits
index|[
literal|3
index|]
operator|=
name|aBits
index|[
literal|3
index|]
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_SBIT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_sPLT
end_ifndef
begin_function
DECL|function|mng_putchunk_splt
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_splt
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_bool
name|bEmpty
parameter_list|,
name|mng_uint32
name|iNamesize
parameter_list|,
name|mng_pchar
name|zName
parameter_list|,
name|mng_uint8
name|iSampledepth
parameter_list|,
name|mng_uint32
name|iEntrycount
parameter_list|,
name|mng_ptr
name|pEntries
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_sPLT
block|,
name|mng_init_general
block|,
name|mng_free_splt
block|,
name|mng_read_splt
block|,
name|mng_write_splt
block|,
name|mng_assign_splt
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_splt
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_sPLT
operator|,
name|mng_init_splt
operator|,
name|mng_free_splt
operator|,
name|mng_read_splt
operator|,
name|mng_write_splt
operator|,
name|mng_assign_splt
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_SPLT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_sPLT
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_splt
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_sPLT
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_spltp
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
operator|=
name|bEmpty
expr_stmt|;
operator|(
operator|(
name|mng_spltp
operator|)
name|pChunk
operator|)
operator|->
name|iNamesize
operator|=
name|iNamesize
expr_stmt|;
operator|(
operator|(
name|mng_spltp
operator|)
name|pChunk
operator|)
operator|->
name|iSampledepth
operator|=
name|iSampledepth
expr_stmt|;
operator|(
operator|(
name|mng_spltp
operator|)
name|pChunk
operator|)
operator|->
name|iEntrycount
operator|=
name|iEntrycount
expr_stmt|;
if|if
condition|(
name|iNamesize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_spltp
operator|)
name|pChunk
operator|)
operator|->
name|zName
argument_list|,
name|iNamesize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_spltp
operator|)
name|pChunk
operator|)
operator|->
name|zName
argument_list|,
name|zName
argument_list|,
name|iNamesize
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|iEntrycount
condition|)
block|{
name|mng_uint32
name|iSize
init|=
name|iEntrycount
operator|*
operator|(
operator|(
name|iSampledepth
operator|>>
literal|1
operator|)
operator|+
literal|2
operator|)
decl_stmt|;
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_spltp
operator|)
name|pChunk
operator|)
operator|->
name|pEntries
argument_list|,
name|iSize
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_spltp
operator|)
name|pChunk
operator|)
operator|->
name|pEntries
argument_list|,
name|pEntries
argument_list|,
name|iSize
argument_list|)
expr_stmt|;
block|}
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_SPLT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_hIST
end_ifndef
begin_function
DECL|function|mng_putchunk_hist
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_hist
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iEntrycount
parameter_list|,
name|mng_uint16arr
name|aEntries
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_hIST
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_hist
block|,
name|mng_write_hist
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_hist
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_hIST
operator|,
name|mng_init_hist
operator|,
name|mng_free_hist
operator|,
name|mng_read_hist
operator|,
name|mng_write_hist
operator|,
name|mng_assign_hist
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_HIST
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_hIST
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_hist
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_hIST
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_histp
operator|)
name|pChunk
operator|)
operator|->
name|iEntrycount
operator|=
name|iEntrycount
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_histp
operator|)
name|pChunk
operator|)
operator|->
name|aEntries
argument_list|,
name|aEntries
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_uint16arr
argument_list|)
argument_list|)
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_HIST
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_tIME
end_ifndef
begin_function
DECL|function|mng_putchunk_time
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_time
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint16
name|iYear
parameter_list|,
name|mng_uint8
name|iMonth
parameter_list|,
name|mng_uint8
name|iDay
parameter_list|,
name|mng_uint8
name|iHour
parameter_list|,
name|mng_uint8
name|iMinute
parameter_list|,
name|mng_uint8
name|iSecond
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_tIME
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_time
block|,
name|mng_write_time
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_time
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_tIME
operator|,
name|mng_init_time
operator|,
name|mng_free_time
operator|,
name|mng_read_time
operator|,
name|mng_write_time
operator|,
name|mng_assign_time
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_TIME
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_tIME
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_time
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_tIME
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_timep
operator|)
name|pChunk
operator|)
operator|->
name|iYear
operator|=
name|iYear
expr_stmt|;
operator|(
operator|(
name|mng_timep
operator|)
name|pChunk
operator|)
operator|->
name|iMonth
operator|=
name|iMonth
expr_stmt|;
operator|(
operator|(
name|mng_timep
operator|)
name|pChunk
operator|)
operator|->
name|iDay
operator|=
name|iDay
expr_stmt|;
operator|(
operator|(
name|mng_timep
operator|)
name|pChunk
operator|)
operator|->
name|iHour
operator|=
name|iHour
expr_stmt|;
operator|(
operator|(
name|mng_timep
operator|)
name|pChunk
operator|)
operator|->
name|iMinute
operator|=
name|iMinute
expr_stmt|;
operator|(
operator|(
name|mng_timep
operator|)
name|pChunk
operator|)
operator|->
name|iSecond
operator|=
name|iSecond
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_TIME
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_putchunk_mhdr
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_mhdr
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint32
name|iHeight
parameter_list|,
name|mng_uint32
name|iTicks
parameter_list|,
name|mng_uint32
name|iLayercount
parameter_list|,
name|mng_uint32
name|iFramecount
parameter_list|,
name|mng_uint32
name|iPlaytime
parameter_list|,
name|mng_uint32
name|iSimplicity
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_MHDR
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_mhdr
block|,
name|mng_write_mhdr
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_mhdr
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_MHDR
operator|,
name|mng_init_mhdr
operator|,
name|mng_free_mhdr
operator|,
name|mng_read_mhdr
operator|,
name|mng_write_mhdr
operator|,
name|mng_assign_mhdr
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_MHDR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must be very first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_SEQUENCEERROR
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_MHDR
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_mhdr
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_MHDR
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_mhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iWidth
operator|=
name|iWidth
expr_stmt|;
operator|(
operator|(
name|mng_mhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iHeight
operator|=
name|iHeight
expr_stmt|;
operator|(
operator|(
name|mng_mhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iTicks
operator|=
name|iTicks
expr_stmt|;
operator|(
operator|(
name|mng_mhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iLayercount
operator|=
name|iLayercount
expr_stmt|;
operator|(
operator|(
name|mng_mhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iFramecount
operator|=
name|iFramecount
expr_stmt|;
operator|(
operator|(
name|mng_mhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iPlaytime
operator|=
name|iPlaytime
expr_stmt|;
operator|(
operator|(
name|mng_mhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iSimplicity
operator|=
name|iSimplicity
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_MHDR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_putchunk_mend
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_mend
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_MEND
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_mend
block|,
name|mng_write_mend
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_mend
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_MEND
operator|,
name|mng_init_mend
operator|,
name|mng_free_mend
operator|,
name|mng_read_mend
operator|,
name|mng_write_mend
operator|,
name|mng_assign_mend
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_MEND
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_MEND
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_mend
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_MEND
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
name|pData
operator|->
name|bCreating
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* should be last chunk !!! */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_MEND
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_LOOP
end_ifndef
begin_function
DECL|function|mng_putchunk_loop
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_loop
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint8
name|iLevel
parameter_list|,
name|mng_uint32
name|iRepeat
parameter_list|,
name|mng_uint8
name|iTermination
parameter_list|,
name|mng_uint32
name|iItermin
parameter_list|,
name|mng_uint32
name|iItermax
parameter_list|,
name|mng_uint32
name|iCount
parameter_list|,
name|mng_uint32p
name|pSignals
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_LOOP
block|,
name|mng_init_general
block|,
name|mng_free_loop
block|,
name|mng_read_loop
block|,
name|mng_write_loop
block|,
name|mng_assign_loop
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_loop
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_LOOP
operator|,
name|mng_init_loop
operator|,
name|mng_free_loop
operator|,
name|mng_read_loop
operator|,
name|mng_write_loop
operator|,
name|mng_assign_loop
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_LOOP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_LOOP
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_loop
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_LOOP
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_loopp
operator|)
name|pChunk
operator|)
operator|->
name|iLevel
operator|=
name|iLevel
expr_stmt|;
operator|(
operator|(
name|mng_loopp
operator|)
name|pChunk
operator|)
operator|->
name|iRepeat
operator|=
name|iRepeat
expr_stmt|;
operator|(
operator|(
name|mng_loopp
operator|)
name|pChunk
operator|)
operator|->
name|iTermination
operator|=
name|iTermination
expr_stmt|;
operator|(
operator|(
name|mng_loopp
operator|)
name|pChunk
operator|)
operator|->
name|iItermin
operator|=
name|iItermin
expr_stmt|;
operator|(
operator|(
name|mng_loopp
operator|)
name|pChunk
operator|)
operator|->
name|iItermax
operator|=
name|iItermax
expr_stmt|;
operator|(
operator|(
name|mng_loopp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
operator|=
name|iCount
expr_stmt|;
operator|(
operator|(
name|mng_loopp
operator|)
name|pChunk
operator|)
operator|->
name|pSignals
operator|=
name|pSignals
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_LOOP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_putchunk_endl
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_endl
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint8
name|iLevel
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_ENDL
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_endl
block|,
name|mng_write_endl
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_endl
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_ENDL
operator|,
name|mng_init_endl
operator|,
name|mng_free_endl
operator|,
name|mng_read_endl
operator|,
name|mng_write_endl
operator|,
name|mng_assign_endl
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_ENDL
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_ENDL
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_endl
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_ENDL
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_endlp
operator|)
name|pChunk
operator|)
operator|->
name|iLevel
operator|=
name|iLevel
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_ENDL
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_DEFI
end_ifndef
begin_function
DECL|function|mng_putchunk_defi
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_defi
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint16
name|iObjectid
parameter_list|,
name|mng_uint8
name|iDonotshow
parameter_list|,
name|mng_uint8
name|iConcrete
parameter_list|,
name|mng_bool
name|bHasloca
parameter_list|,
name|mng_int32
name|iXlocation
parameter_list|,
name|mng_int32
name|iYlocation
parameter_list|,
name|mng_bool
name|bHasclip
parameter_list|,
name|mng_int32
name|iLeftcb
parameter_list|,
name|mng_int32
name|iRightcb
parameter_list|,
name|mng_int32
name|iTopcb
parameter_list|,
name|mng_int32
name|iBottomcb
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_DEFI
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_defi
block|,
name|mng_write_defi
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_defi
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_DEFI
operator|,
name|mng_init_defi
operator|,
name|mng_free_defi
operator|,
name|mng_read_defi
operator|,
name|mng_write_defi
operator|,
name|mng_assign_defi
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_DEFI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_DEFI
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_defi
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_DEFI
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_defip
operator|)
name|pChunk
operator|)
operator|->
name|iObjectid
operator|=
name|iObjectid
expr_stmt|;
operator|(
operator|(
name|mng_defip
operator|)
name|pChunk
operator|)
operator|->
name|iDonotshow
operator|=
name|iDonotshow
expr_stmt|;
operator|(
operator|(
name|mng_defip
operator|)
name|pChunk
operator|)
operator|->
name|iConcrete
operator|=
name|iConcrete
expr_stmt|;
operator|(
operator|(
name|mng_defip
operator|)
name|pChunk
operator|)
operator|->
name|bHasloca
operator|=
name|bHasloca
expr_stmt|;
operator|(
operator|(
name|mng_defip
operator|)
name|pChunk
operator|)
operator|->
name|iXlocation
operator|=
name|iXlocation
expr_stmt|;
operator|(
operator|(
name|mng_defip
operator|)
name|pChunk
operator|)
operator|->
name|iYlocation
operator|=
name|iYlocation
expr_stmt|;
operator|(
operator|(
name|mng_defip
operator|)
name|pChunk
operator|)
operator|->
name|bHasclip
operator|=
name|bHasclip
expr_stmt|;
operator|(
operator|(
name|mng_defip
operator|)
name|pChunk
operator|)
operator|->
name|iLeftcb
operator|=
name|iLeftcb
expr_stmt|;
operator|(
operator|(
name|mng_defip
operator|)
name|pChunk
operator|)
operator|->
name|iRightcb
operator|=
name|iRightcb
expr_stmt|;
operator|(
operator|(
name|mng_defip
operator|)
name|pChunk
operator|)
operator|->
name|iTopcb
operator|=
name|iTopcb
expr_stmt|;
operator|(
operator|(
name|mng_defip
operator|)
name|pChunk
operator|)
operator|->
name|iBottomcb
operator|=
name|iBottomcb
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_DEFI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_BASI
end_ifndef
begin_function
DECL|function|mng_putchunk_basi
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_basi
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint32
name|iHeight
parameter_list|,
name|mng_uint8
name|iBitdepth
parameter_list|,
name|mng_uint8
name|iColortype
parameter_list|,
name|mng_uint8
name|iCompression
parameter_list|,
name|mng_uint8
name|iFilter
parameter_list|,
name|mng_uint8
name|iInterlace
parameter_list|,
name|mng_uint16
name|iRed
parameter_list|,
name|mng_uint16
name|iGreen
parameter_list|,
name|mng_uint16
name|iBlue
parameter_list|,
name|mng_uint16
name|iAlpha
parameter_list|,
name|mng_uint8
name|iViewable
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_BASI
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_basi
block|,
name|mng_write_basi
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_basi
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_BASI
operator|,
name|mng_init_basi
operator|,
name|mng_free_basi
operator|,
name|mng_read_basi
operator|,
name|mng_write_basi
operator|,
name|mng_assign_basi
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_BASI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_BASI
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_basi
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_BASI
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iWidth
operator|=
name|iWidth
expr_stmt|;
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iHeight
operator|=
name|iHeight
expr_stmt|;
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iBitdepth
operator|=
name|iBitdepth
expr_stmt|;
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iColortype
operator|=
name|iColortype
expr_stmt|;
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iCompression
operator|=
name|iCompression
expr_stmt|;
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iFilter
operator|=
name|iFilter
expr_stmt|;
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iInterlace
operator|=
name|iInterlace
expr_stmt|;
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iRed
operator|=
name|iRed
expr_stmt|;
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iGreen
operator|=
name|iGreen
expr_stmt|;
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iBlue
operator|=
name|iBlue
expr_stmt|;
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iAlpha
operator|=
name|iAlpha
expr_stmt|;
operator|(
operator|(
name|mng_basip
operator|)
name|pChunk
operator|)
operator|->
name|iViewable
operator|=
name|iViewable
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_BASI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_CLON
end_ifndef
begin_function
DECL|function|mng_putchunk_clon
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_clon
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint16
name|iSourceid
parameter_list|,
name|mng_uint16
name|iCloneid
parameter_list|,
name|mng_uint8
name|iClonetype
parameter_list|,
name|mng_uint8
name|iDonotshow
parameter_list|,
name|mng_uint8
name|iConcrete
parameter_list|,
name|mng_bool
name|bHasloca
parameter_list|,
name|mng_uint8
name|iLocationtype
parameter_list|,
name|mng_int32
name|iLocationx
parameter_list|,
name|mng_int32
name|iLocationy
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_CLON
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_clon
block|,
name|mng_write_clon
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_clon
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_CLON
operator|,
name|mng_init_clon
operator|,
name|mng_free_clon
operator|,
name|mng_read_clon
operator|,
name|mng_write_clon
operator|,
name|mng_assign_clon
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_CLON
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_CLON
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_clon
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_CLON
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iSourceid
operator|=
name|iSourceid
expr_stmt|;
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iCloneid
operator|=
name|iCloneid
expr_stmt|;
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iClonetype
operator|=
name|iClonetype
expr_stmt|;
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iDonotshow
operator|=
name|iDonotshow
expr_stmt|;
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iConcrete
operator|=
name|iConcrete
expr_stmt|;
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|bHasloca
operator|=
name|bHasloca
expr_stmt|;
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iLocationtype
operator|=
name|iLocationtype
expr_stmt|;
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iLocationx
operator|=
name|iLocationx
expr_stmt|;
operator|(
operator|(
name|mng_clonp
operator|)
name|pChunk
operator|)
operator|->
name|iLocationy
operator|=
name|iLocationy
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_CLON
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_PAST
end_ifndef
begin_function
DECL|function|mng_putchunk_past
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_past
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint16
name|iDestid
parameter_list|,
name|mng_uint8
name|iTargettype
parameter_list|,
name|mng_int32
name|iTargetx
parameter_list|,
name|mng_int32
name|iTargety
parameter_list|,
name|mng_uint32
name|iCount
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_PAST
block|,
name|mng_init_general
block|,
name|mng_free_past
block|,
name|mng_read_past
block|,
name|mng_write_past
block|,
name|mng_assign_past
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_past
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_PAST
operator|,
name|mng_init_past
operator|,
name|mng_free_past
operator|,
name|mng_read_past
operator|,
name|mng_write_past
operator|,
name|mng_assign_past
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_PAST
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_PAST
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_past
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_PAST
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iDestid
operator|=
name|iDestid
expr_stmt|;
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iTargettype
operator|=
name|iTargettype
expr_stmt|;
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iTargetx
operator|=
name|iTargetx
expr_stmt|;
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iTargety
operator|=
name|iTargety
expr_stmt|;
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
operator|=
name|iCount
expr_stmt|;
if|if
condition|(
name|iCount
condition|)
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|pSources
argument_list|,
name|iCount
operator|*
sizeof|sizeof
argument_list|(
name|mng_past_source
argument_list|)
argument_list|)
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_PAST
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_PAST
end_ifndef
begin_function
DECL|function|mng_putchunk_past_src
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_past_src
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iEntry
parameter_list|,
name|mng_uint16
name|iSourceid
parameter_list|,
name|mng_uint8
name|iComposition
parameter_list|,
name|mng_uint8
name|iOrientation
parameter_list|,
name|mng_uint8
name|iOffsettype
parameter_list|,
name|mng_int32
name|iOffsetx
parameter_list|,
name|mng_int32
name|iOffsety
parameter_list|,
name|mng_uint8
name|iBoundarytype
parameter_list|,
name|mng_int32
name|iBoundaryl
parameter_list|,
name|mng_int32
name|iBoundaryr
parameter_list|,
name|mng_int32
name|iBoundaryt
parameter_list|,
name|mng_int32
name|iBoundaryb
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_past_sourcep
name|pEntry
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_PAST_SRC
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
name|pChunk
operator|=
name|pData
operator|->
name|pLastchunk
expr_stmt|;
comment|/* last one must have been PAST ! */
if|if
condition|(
operator|(
operator|(
name|mng_chunk_headerp
operator|)
name|pChunk
operator|)
operator|->
name|iChunkname
operator|!=
name|MNG_UINT_PAST
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOCORRCHUNK
argument_list|)
comment|/* index out of bounds ? */
if|if
condition|(
name|iEntry
operator|>=
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_INVALIDENTRYIX
argument_list|)
comment|/* address proper entry */
name|pEntry
operator|=
operator|(
operator|(
name|mng_pastp
operator|)
name|pChunk
operator|)
operator|->
name|pSources
operator|+
name|iEntry
expr_stmt|;
name|pEntry
operator|->
name|iSourceid
operator|=
name|iSourceid
expr_stmt|;
comment|/* fill entry */
name|pEntry
operator|->
name|iComposition
operator|=
name|iComposition
expr_stmt|;
name|pEntry
operator|->
name|iOrientation
operator|=
name|iOrientation
expr_stmt|;
name|pEntry
operator|->
name|iOffsettype
operator|=
name|iOffsettype
expr_stmt|;
name|pEntry
operator|->
name|iOffsetx
operator|=
name|iOffsetx
expr_stmt|;
name|pEntry
operator|->
name|iOffsety
operator|=
name|iOffsety
expr_stmt|;
name|pEntry
operator|->
name|iBoundarytype
operator|=
name|iBoundarytype
expr_stmt|;
name|pEntry
operator|->
name|iBoundaryl
operator|=
name|iBoundaryl
expr_stmt|;
name|pEntry
operator|->
name|iBoundaryr
operator|=
name|iBoundaryr
expr_stmt|;
name|pEntry
operator|->
name|iBoundaryt
operator|=
name|iBoundaryt
expr_stmt|;
name|pEntry
operator|->
name|iBoundaryb
operator|=
name|iBoundaryb
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_PAST_SRC
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_DISC
end_ifndef
begin_function
DECL|function|mng_putchunk_disc
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_disc
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iCount
parameter_list|,
name|mng_uint16p
name|pObjectids
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_DISC
block|,
name|mng_init_general
block|,
name|mng_free_disc
block|,
name|mng_read_disc
block|,
name|mng_write_disc
block|,
name|mng_assign_disc
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_disc
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_DISC
operator|,
name|mng_init_disc
operator|,
name|mng_free_disc
operator|,
name|mng_read_disc
operator|,
name|mng_write_disc
operator|,
name|mng_assign_disc
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_DISC
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_DISC
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_disc
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_DISC
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_discp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
operator|=
name|iCount
expr_stmt|;
if|if
condition|(
name|iCount
condition|)
block|{
name|mng_uint32
name|iSize
init|=
name|iCount
operator|*
sizeof|sizeof
argument_list|(
name|mng_uint32
argument_list|)
decl_stmt|;
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_discp
operator|)
name|pChunk
operator|)
operator|->
name|pObjectids
argument_list|,
name|iSize
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_discp
operator|)
name|pChunk
operator|)
operator|->
name|pObjectids
argument_list|,
name|pObjectids
argument_list|,
name|iSize
argument_list|)
expr_stmt|;
block|}
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_DISC
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_BACK
end_ifndef
begin_function
DECL|function|mng_putchunk_back
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_back
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint16
name|iRed
parameter_list|,
name|mng_uint16
name|iGreen
parameter_list|,
name|mng_uint16
name|iBlue
parameter_list|,
name|mng_uint8
name|iMandatory
parameter_list|,
name|mng_uint16
name|iImageid
parameter_list|,
name|mng_uint8
name|iTile
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_BACK
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_back
block|,
name|mng_write_back
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_back
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_BACK
operator|,
name|mng_init_back
operator|,
name|mng_free_back
operator|,
name|mng_read_back
operator|,
name|mng_write_back
operator|,
name|mng_assign_back
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_BACK
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_BACK
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_back
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_BACK
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_backp
operator|)
name|pChunk
operator|)
operator|->
name|iRed
operator|=
name|iRed
expr_stmt|;
operator|(
operator|(
name|mng_backp
operator|)
name|pChunk
operator|)
operator|->
name|iGreen
operator|=
name|iGreen
expr_stmt|;
operator|(
operator|(
name|mng_backp
operator|)
name|pChunk
operator|)
operator|->
name|iBlue
operator|=
name|iBlue
expr_stmt|;
operator|(
operator|(
name|mng_backp
operator|)
name|pChunk
operator|)
operator|->
name|iMandatory
operator|=
name|iMandatory
expr_stmt|;
operator|(
operator|(
name|mng_backp
operator|)
name|pChunk
operator|)
operator|->
name|iImageid
operator|=
name|iImageid
expr_stmt|;
operator|(
operator|(
name|mng_backp
operator|)
name|pChunk
operator|)
operator|->
name|iTile
operator|=
name|iTile
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_BACK
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_FRAM
end_ifndef
begin_function
DECL|function|mng_putchunk_fram
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_fram
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_bool
name|bEmpty
parameter_list|,
name|mng_uint8
name|iMode
parameter_list|,
name|mng_uint32
name|iNamesize
parameter_list|,
name|mng_pchar
name|zName
parameter_list|,
name|mng_uint8
name|iChangedelay
parameter_list|,
name|mng_uint8
name|iChangetimeout
parameter_list|,
name|mng_uint8
name|iChangeclipping
parameter_list|,
name|mng_uint8
name|iChangesyncid
parameter_list|,
name|mng_uint32
name|iDelay
parameter_list|,
name|mng_uint32
name|iTimeout
parameter_list|,
name|mng_uint8
name|iBoundarytype
parameter_list|,
name|mng_int32
name|iBoundaryl
parameter_list|,
name|mng_int32
name|iBoundaryr
parameter_list|,
name|mng_int32
name|iBoundaryt
parameter_list|,
name|mng_int32
name|iBoundaryb
parameter_list|,
name|mng_uint32
name|iCount
parameter_list|,
name|mng_uint32p
name|pSyncids
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_FRAM
block|,
name|mng_init_general
block|,
name|mng_free_fram
block|,
name|mng_read_fram
block|,
name|mng_write_fram
block|,
name|mng_assign_fram
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_fram
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_FRAM
operator|,
name|mng_init_fram
operator|,
name|mng_free_fram
operator|,
name|mng_read_fram
operator|,
name|mng_write_fram
operator|,
name|mng_assign_fram
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_FRAM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_FRAM
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_fram
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_FRAM
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
operator|=
name|bEmpty
expr_stmt|;
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iMode
operator|=
name|iMode
expr_stmt|;
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iNamesize
operator|=
name|iNamesize
expr_stmt|;
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iChangedelay
operator|=
name|iChangedelay
expr_stmt|;
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iChangetimeout
operator|=
name|iChangetimeout
expr_stmt|;
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iChangeclipping
operator|=
name|iChangeclipping
expr_stmt|;
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iChangesyncid
operator|=
name|iChangesyncid
expr_stmt|;
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iDelay
operator|=
name|iDelay
expr_stmt|;
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iTimeout
operator|=
name|iTimeout
expr_stmt|;
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundarytype
operator|=
name|iBoundarytype
expr_stmt|;
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundaryl
operator|=
name|iBoundaryl
expr_stmt|;
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundaryr
operator|=
name|iBoundaryr
expr_stmt|;
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundaryt
operator|=
name|iBoundaryt
expr_stmt|;
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iBoundaryb
operator|=
name|iBoundaryb
expr_stmt|;
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
operator|=
name|iCount
expr_stmt|;
if|if
condition|(
name|iNamesize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|zName
argument_list|,
name|iNamesize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|zName
argument_list|,
name|zName
argument_list|,
name|iNamesize
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|iCount
condition|)
block|{
name|mng_uint32
name|iSize
init|=
name|iCount
operator|*
sizeof|sizeof
argument_list|(
name|mng_uint32
argument_list|)
decl_stmt|;
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|pSyncids
argument_list|,
name|iSize
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_framp
operator|)
name|pChunk
operator|)
operator|->
name|pSyncids
argument_list|,
name|pSyncids
argument_list|,
name|iSize
argument_list|)
expr_stmt|;
block|}
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_FRAM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_MOVE
end_ifndef
begin_function
DECL|function|mng_putchunk_move
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_move
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint16
name|iFirstid
parameter_list|,
name|mng_uint16
name|iLastid
parameter_list|,
name|mng_uint8
name|iMovetype
parameter_list|,
name|mng_int32
name|iMovex
parameter_list|,
name|mng_int32
name|iMovey
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_MOVE
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_move
block|,
name|mng_write_move
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_move
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_MOVE
operator|,
name|mng_init_move
operator|,
name|mng_free_move
operator|,
name|mng_read_move
operator|,
name|mng_write_move
operator|,
name|mng_assign_move
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_MOVE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_MOVE
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_move
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_MOVE
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iFirstid
operator|=
name|iFirstid
expr_stmt|;
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iLastid
operator|=
name|iLastid
expr_stmt|;
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iMovetype
operator|=
name|iMovetype
expr_stmt|;
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iMovex
operator|=
name|iMovex
expr_stmt|;
operator|(
operator|(
name|mng_movep
operator|)
name|pChunk
operator|)
operator|->
name|iMovey
operator|=
name|iMovey
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_MOVE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_CLIP
end_ifndef
begin_function
DECL|function|mng_putchunk_clip
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_clip
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint16
name|iFirstid
parameter_list|,
name|mng_uint16
name|iLastid
parameter_list|,
name|mng_uint8
name|iCliptype
parameter_list|,
name|mng_int32
name|iClipl
parameter_list|,
name|mng_int32
name|iClipr
parameter_list|,
name|mng_int32
name|iClipt
parameter_list|,
name|mng_int32
name|iClipb
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_CLIP
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_clip
block|,
name|mng_write_clip
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_clip
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_CLIP
operator|,
name|mng_init_clip
operator|,
name|mng_free_clip
operator|,
name|mng_read_clip
operator|,
name|mng_write_clip
operator|,
name|mng_assign_clip
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_CLIP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_CLIP
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_clip
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_CLIP
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iFirstid
operator|=
name|iFirstid
expr_stmt|;
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iLastid
operator|=
name|iLastid
expr_stmt|;
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iCliptype
operator|=
name|iCliptype
expr_stmt|;
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iClipl
operator|=
name|iClipl
expr_stmt|;
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iClipr
operator|=
name|iClipr
expr_stmt|;
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iClipt
operator|=
name|iClipt
expr_stmt|;
operator|(
operator|(
name|mng_clipp
operator|)
name|pChunk
operator|)
operator|->
name|iClipb
operator|=
name|iClipb
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_CLIP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SHOW
end_ifndef
begin_function
DECL|function|mng_putchunk_show
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_show
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_bool
name|bEmpty
parameter_list|,
name|mng_uint16
name|iFirstid
parameter_list|,
name|mng_uint16
name|iLastid
parameter_list|,
name|mng_uint8
name|iMode
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_SHOW
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_show
block|,
name|mng_write_show
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_show
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_SHOW
operator|,
name|mng_init_show
operator|,
name|mng_free_show
operator|,
name|mng_read_show
operator|,
name|mng_write_show
operator|,
name|mng_assign_show
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_SHOW
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_SHOW
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_show
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_SHOW
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_showp
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
operator|=
name|bEmpty
expr_stmt|;
operator|(
operator|(
name|mng_showp
operator|)
name|pChunk
operator|)
operator|->
name|iFirstid
operator|=
name|iFirstid
expr_stmt|;
operator|(
operator|(
name|mng_showp
operator|)
name|pChunk
operator|)
operator|->
name|iLastid
operator|=
name|iLastid
expr_stmt|;
operator|(
operator|(
name|mng_showp
operator|)
name|pChunk
operator|)
operator|->
name|iMode
operator|=
name|iMode
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_SHOW
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_TERM
end_ifndef
begin_function
DECL|function|mng_putchunk_term
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_term
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint8
name|iTermaction
parameter_list|,
name|mng_uint8
name|iIteraction
parameter_list|,
name|mng_uint32
name|iDelay
parameter_list|,
name|mng_uint32
name|iItermax
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_TERM
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_term
block|,
name|mng_write_term
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_term
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_TERM
operator|,
name|mng_init_term
operator|,
name|mng_free_term
operator|,
name|mng_read_term
operator|,
name|mng_write_term
operator|,
name|mng_assign_term
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_TERM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_term
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_TERM
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_termp
operator|)
name|pChunk
operator|)
operator|->
name|iTermaction
operator|=
name|iTermaction
expr_stmt|;
operator|(
operator|(
name|mng_termp
operator|)
name|pChunk
operator|)
operator|->
name|iIteraction
operator|=
name|iIteraction
expr_stmt|;
operator|(
operator|(
name|mng_termp
operator|)
name|pChunk
operator|)
operator|->
name|iDelay
operator|=
name|iDelay
expr_stmt|;
operator|(
operator|(
name|mng_termp
operator|)
name|pChunk
operator|)
operator|->
name|iItermax
operator|=
name|iItermax
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_TERM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SAVE
end_ifndef
begin_function
DECL|function|mng_putchunk_save
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_save
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_bool
name|bEmpty
parameter_list|,
name|mng_uint8
name|iOffsettype
parameter_list|,
name|mng_uint32
name|iCount
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_SAVE
block|,
name|mng_init_general
block|,
name|mng_free_save
block|,
name|mng_read_save
block|,
name|mng_write_save
block|,
name|mng_assign_save
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_save
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_SAVE
operator|,
name|mng_init_save
operator|,
name|mng_free_save
operator|,
name|mng_read_save
operator|,
name|mng_write_save
operator|,
name|mng_assign_save
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_SAVE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_SAVE
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_save
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_SAVE
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_savep
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
operator|=
name|bEmpty
expr_stmt|;
operator|(
operator|(
name|mng_savep
operator|)
name|pChunk
operator|)
operator|->
name|iOffsettype
operator|=
name|iOffsettype
expr_stmt|;
operator|(
operator|(
name|mng_savep
operator|)
name|pChunk
operator|)
operator|->
name|iCount
operator|=
name|iCount
expr_stmt|;
if|if
condition|(
name|iCount
condition|)
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_savep
operator|)
name|pChunk
operator|)
operator|->
name|pEntries
argument_list|,
name|iCount
operator|*
sizeof|sizeof
argument_list|(
name|mng_save_entry
argument_list|)
argument_list|)
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_SAVE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_putchunk_save_entry
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_save_entry
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iEntry
parameter_list|,
name|mng_uint8
name|iEntrytype
parameter_list|,
name|mng_uint32arr2
name|iOffset
parameter_list|,
name|mng_uint32arr2
name|iStarttime
parameter_list|,
name|mng_uint32
name|iLayernr
parameter_list|,
name|mng_uint32
name|iFramenr
parameter_list|,
name|mng_uint32
name|iNamesize
parameter_list|,
name|mng_pchar
name|zName
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_save_entryp
name|pEntry
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_SAVE_ENTRY
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
name|pChunk
operator|=
name|pData
operator|->
name|pLastchunk
expr_stmt|;
comment|/* last one must have been SAVE ! */
if|if
condition|(
operator|(
operator|(
name|mng_chunk_headerp
operator|)
name|pChunk
operator|)
operator|->
name|iChunkname
operator|!=
name|MNG_UINT_SAVE
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOCORRCHUNK
argument_list|)
comment|/* index out of bounds ? */
if|if
condition|(
name|iEntry
operator|>=
operator|(
operator|(
name|mng_savep
operator|)
name|pChunk
operator|)
operator|->
name|iCount
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_INVALIDENTRYIX
argument_list|)
comment|/* address proper entry */
name|pEntry
operator|=
operator|(
operator|(
name|mng_savep
operator|)
name|pChunk
operator|)
operator|->
name|pEntries
operator|+
name|iEntry
expr_stmt|;
name|pEntry
operator|->
name|iEntrytype
operator|=
name|iEntrytype
expr_stmt|;
comment|/* fill entry */
name|pEntry
operator|->
name|iOffset
index|[
literal|0
index|]
operator|=
name|iOffset
index|[
literal|0
index|]
expr_stmt|;
name|pEntry
operator|->
name|iOffset
index|[
literal|1
index|]
operator|=
name|iOffset
index|[
literal|1
index|]
expr_stmt|;
name|pEntry
operator|->
name|iStarttime
index|[
literal|0
index|]
operator|=
name|iStarttime
index|[
literal|0
index|]
expr_stmt|;
name|pEntry
operator|->
name|iStarttime
index|[
literal|1
index|]
operator|=
name|iStarttime
index|[
literal|1
index|]
expr_stmt|;
name|pEntry
operator|->
name|iLayernr
operator|=
name|iLayernr
expr_stmt|;
name|pEntry
operator|->
name|iFramenr
operator|=
name|iFramenr
expr_stmt|;
name|pEntry
operator|->
name|iNamesize
operator|=
name|iNamesize
expr_stmt|;
if|if
condition|(
name|iNamesize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pEntry
operator|->
name|zName
argument_list|,
name|iNamesize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pEntry
operator|->
name|zName
argument_list|,
name|zName
argument_list|,
name|iNamesize
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_SAVE_ENTRY
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SEEK
end_ifndef
begin_function
DECL|function|mng_putchunk_seek
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_seek
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iNamesize
parameter_list|,
name|mng_pchar
name|zName
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_SEEK
block|,
name|mng_init_general
block|,
name|mng_free_seek
block|,
name|mng_read_seek
block|,
name|mng_write_seek
block|,
name|mng_assign_seek
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_seek
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_SEEK
operator|,
name|mng_init_seek
operator|,
name|mng_free_seek
operator|,
name|mng_read_seek
operator|,
name|mng_write_seek
operator|,
name|mng_assign_seek
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_SEEK
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_SEEK
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_seek
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_SEEK
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_seekp
operator|)
name|pChunk
operator|)
operator|->
name|iNamesize
operator|=
name|iNamesize
expr_stmt|;
if|if
condition|(
name|iNamesize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_seekp
operator|)
name|pChunk
operator|)
operator|->
name|zName
argument_list|,
name|iNamesize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_seekp
operator|)
name|pChunk
operator|)
operator|->
name|zName
argument_list|,
name|zName
argument_list|,
name|iNamesize
argument_list|)
expr_stmt|;
block|}
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_SEEK
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_eXPI
end_ifndef
begin_function
DECL|function|mng_putchunk_expi
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_expi
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint16
name|iSnapshotid
parameter_list|,
name|mng_uint32
name|iNamesize
parameter_list|,
name|mng_pchar
name|zName
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_eXPI
block|,
name|mng_init_general
block|,
name|mng_free_expi
block|,
name|mng_read_expi
block|,
name|mng_write_expi
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_expi
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_eXPI
operator|,
name|mng_init_expi
operator|,
name|mng_free_expi
operator|,
name|mng_read_expi
operator|,
name|mng_write_expi
operator|,
name|mng_assign_expi
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_EXPI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_eXPI
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_expi
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_eXPI
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_expip
operator|)
name|pChunk
operator|)
operator|->
name|iSnapshotid
operator|=
name|iSnapshotid
expr_stmt|;
operator|(
operator|(
name|mng_expip
operator|)
name|pChunk
operator|)
operator|->
name|iNamesize
operator|=
name|iNamesize
expr_stmt|;
if|if
condition|(
name|iNamesize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_expip
operator|)
name|pChunk
operator|)
operator|->
name|zName
argument_list|,
name|iNamesize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_expip
operator|)
name|pChunk
operator|)
operator|->
name|zName
argument_list|,
name|zName
argument_list|,
name|iNamesize
argument_list|)
expr_stmt|;
block|}
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_EXPI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_fPRI
end_ifndef
begin_function
DECL|function|mng_putchunk_fpri
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_fpri
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint8
name|iDeltatype
parameter_list|,
name|mng_uint8
name|iPriority
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_fPRI
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_fpri
block|,
name|mng_write_fpri
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_fpri
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_fPRI
operator|,
name|mng_init_fpri
operator|,
name|mng_free_fpri
operator|,
name|mng_read_fpri
operator|,
name|mng_write_fpri
operator|,
name|mng_assign_fpri
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_FPRI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_fPRI
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_fpri
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_fPRI
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_fprip
operator|)
name|pChunk
operator|)
operator|->
name|iDeltatype
operator|=
name|iDeltatype
expr_stmt|;
operator|(
operator|(
name|mng_fprip
operator|)
name|pChunk
operator|)
operator|->
name|iPriority
operator|=
name|iPriority
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_FPRI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_nEED
end_ifndef
begin_function
DECL|function|mng_putchunk_need
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_need
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iKeywordssize
parameter_list|,
name|mng_pchar
name|zKeywords
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_nEED
block|,
name|mng_init_general
block|,
name|mng_free_need
block|,
name|mng_read_need
block|,
name|mng_write_need
block|,
name|mng_assign_need
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_need
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_nEED
operator|,
name|mng_init_need
operator|,
name|mng_free_need
operator|,
name|mng_read_need
operator|,
name|mng_write_need
operator|,
name|mng_assign_need
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_NEED
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_nEED
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_need
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_nEED
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_needp
operator|)
name|pChunk
operator|)
operator|->
name|iKeywordssize
operator|=
name|iKeywordssize
expr_stmt|;
if|if
condition|(
name|iKeywordssize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_needp
operator|)
name|pChunk
operator|)
operator|->
name|zKeywords
argument_list|,
name|iKeywordssize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_needp
operator|)
name|pChunk
operator|)
operator|->
name|zKeywords
argument_list|,
name|zKeywords
argument_list|,
name|iKeywordssize
argument_list|)
expr_stmt|;
block|}
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_NEED
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_pHYg
end_ifndef
begin_function
DECL|function|mng_putchunk_phyg
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_phyg
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_bool
name|bEmpty
parameter_list|,
name|mng_uint32
name|iSizex
parameter_list|,
name|mng_uint32
name|iSizey
parameter_list|,
name|mng_uint8
name|iUnit
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_pHYg
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_phyg
block|,
name|mng_write_phyg
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_phyg
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_pHYg
operator|,
name|mng_init_phyg
operator|,
name|mng_free_phyg
operator|,
name|mng_read_phyg
operator|,
name|mng_write_phyg
operator|,
name|mng_assign_phyg
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_PHYG
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_pHYg
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_phyg
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_pHYg
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_phygp
operator|)
name|pChunk
operator|)
operator|->
name|bEmpty
operator|=
name|bEmpty
expr_stmt|;
operator|(
operator|(
name|mng_phygp
operator|)
name|pChunk
operator|)
operator|->
name|iSizex
operator|=
name|iSizex
expr_stmt|;
operator|(
operator|(
name|mng_phygp
operator|)
name|pChunk
operator|)
operator|->
name|iSizey
operator|=
name|iSizey
expr_stmt|;
operator|(
operator|(
name|mng_phygp
operator|)
name|pChunk
operator|)
operator|->
name|iUnit
operator|=
name|iUnit
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_PHYG
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
end_ifdef
begin_function
DECL|function|mng_putchunk_jhdr
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_jhdr
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint32
name|iHeight
parameter_list|,
name|mng_uint8
name|iColortype
parameter_list|,
name|mng_uint8
name|iImagesampledepth
parameter_list|,
name|mng_uint8
name|iImagecompression
parameter_list|,
name|mng_uint8
name|iImageinterlace
parameter_list|,
name|mng_uint8
name|iAlphasampledepth
parameter_list|,
name|mng_uint8
name|iAlphacompression
parameter_list|,
name|mng_uint8
name|iAlphafilter
parameter_list|,
name|mng_uint8
name|iAlphainterlace
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_JHDR
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_jhdr
block|,
name|mng_write_jhdr
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_jhdr
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_JHDR
operator|,
name|mng_init_jhdr
operator|,
name|mng_free_jhdr
operator|,
name|mng_read_jhdr
operator|,
name|mng_write_jhdr
operator|,
name|mng_assign_jhdr
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_JHDR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_JHDR
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_jhdr
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_JHDR
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_jhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iWidth
operator|=
name|iWidth
expr_stmt|;
operator|(
operator|(
name|mng_jhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iHeight
operator|=
name|iHeight
expr_stmt|;
operator|(
operator|(
name|mng_jhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iColortype
operator|=
name|iColortype
expr_stmt|;
operator|(
operator|(
name|mng_jhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iImagesampledepth
operator|=
name|iImagesampledepth
expr_stmt|;
operator|(
operator|(
name|mng_jhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iImagecompression
operator|=
name|iImagecompression
expr_stmt|;
operator|(
operator|(
name|mng_jhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iImageinterlace
operator|=
name|iImageinterlace
expr_stmt|;
operator|(
operator|(
name|mng_jhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iAlphasampledepth
operator|=
name|iAlphasampledepth
expr_stmt|;
operator|(
operator|(
name|mng_jhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iAlphacompression
operator|=
name|iAlphacompression
expr_stmt|;
operator|(
operator|(
name|mng_jhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iAlphafilter
operator|=
name|iAlphafilter
expr_stmt|;
operator|(
operator|(
name|mng_jhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iAlphainterlace
operator|=
name|iAlphainterlace
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_JHDR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_INCLUDE_JNG */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
end_ifdef
begin_function
DECL|function|mng_putchunk_jdat
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_jdat
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iRawlen
parameter_list|,
name|mng_ptr
name|pRawdata
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_JDAT
block|,
name|mng_init_general
block|,
name|mng_free_jdat
block|,
name|mng_read_jdat
block|,
name|mng_write_jdat
block|,
name|mng_assign_jdat
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_jdat
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_JDAT
operator|,
name|mng_init_jdat
operator|,
name|mng_free_jdat
operator|,
name|mng_read_jdat
operator|,
name|mng_write_jdat
operator|,
name|mng_assign_jdat
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_JDAT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR or JHDR first! */
if|if
condition|(
operator|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_JHDR
operator|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_JDAT
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_jdat
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_JDAT
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_jdatp
operator|)
name|pChunk
operator|)
operator|->
name|iDatasize
operator|=
name|iRawlen
expr_stmt|;
if|if
condition|(
name|iRawlen
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_jdatp
operator|)
name|pChunk
operator|)
operator|->
name|pData
argument_list|,
name|iRawlen
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_jdatp
operator|)
name|pChunk
operator|)
operator|->
name|pData
argument_list|,
name|pRawdata
argument_list|,
name|iRawlen
argument_list|)
expr_stmt|;
block|}
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_JDAT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/*  MNG_INCLUDE_JNG */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
end_ifdef
begin_function
DECL|function|mng_putchunk_jdaa
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_jdaa
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iRawlen
parameter_list|,
name|mng_ptr
name|pRawdata
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_JDAA
block|,
name|mng_init_general
block|,
name|mng_free_jdaa
block|,
name|mng_read_jdaa
block|,
name|mng_write_jdaa
block|,
name|mng_assign_jdaa
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_jdaa
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_JDAA
operator|,
name|mng_init_jdaa
operator|,
name|mng_free_jdaa
operator|,
name|mng_read_jdaa
operator|,
name|mng_write_jdaa
operator|,
name|mng_assign_jdaa
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_JDAA
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR or JHDR first! */
if|if
condition|(
operator|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_JHDR
operator|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_JDAA
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_jdaa
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_JDAA
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_jdaap
operator|)
name|pChunk
operator|)
operator|->
name|iDatasize
operator|=
name|iRawlen
expr_stmt|;
if|if
condition|(
name|iRawlen
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_jdaap
operator|)
name|pChunk
operator|)
operator|->
name|pData
argument_list|,
name|iRawlen
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_jdaap
operator|)
name|pChunk
operator|)
operator|->
name|pData
argument_list|,
name|pRawdata
argument_list|,
name|iRawlen
argument_list|)
expr_stmt|;
block|}
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_JDAA
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/*  MNG_INCLUDE_JNG */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
end_ifdef
begin_function
DECL|function|mng_putchunk_jsep
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_jsep
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_JSEP
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_jsep
block|,
name|mng_write_jsep
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_jsep
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_JSEP
operator|,
name|mng_init_jsep
operator|,
name|mng_free_jsep
operator|,
name|mng_read_jsep
operator|,
name|mng_write_jsep
operator|,
name|mng_assign_jsep
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_JSEP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR or JHDR first! */
if|if
condition|(
operator|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_JHDR
operator|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_JSEP
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_jsep
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_JSEP
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_JSEP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_INCLUDE_JNG */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_function
DECL|function|mng_putchunk_dhdr
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_dhdr
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint16
name|iObjectid
parameter_list|,
name|mng_uint8
name|iImagetype
parameter_list|,
name|mng_uint8
name|iDeltatype
parameter_list|,
name|mng_uint32
name|iBlockwidth
parameter_list|,
name|mng_uint32
name|iBlockheight
parameter_list|,
name|mng_uint32
name|iBlockx
parameter_list|,
name|mng_uint32
name|iBlocky
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_DHDR
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_dhdr
block|,
name|mng_write_dhdr
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_dhdr
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_DHDR
operator|,
name|mng_init_dhdr
operator|,
name|mng_free_dhdr
operator|,
name|mng_read_dhdr
operator|,
name|mng_write_dhdr
operator|,
name|mng_assign_dhdr
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_DHDR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_DHDR
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_dhdr
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_DHDR
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iObjectid
operator|=
name|iObjectid
expr_stmt|;
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iImagetype
operator|=
name|iImagetype
expr_stmt|;
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iDeltatype
operator|=
name|iDeltatype
expr_stmt|;
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iBlockwidth
operator|=
name|iBlockwidth
expr_stmt|;
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iBlockheight
operator|=
name|iBlockheight
expr_stmt|;
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iBlockx
operator|=
name|iBlockx
expr_stmt|;
operator|(
operator|(
name|mng_dhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iBlocky
operator|=
name|iBlocky
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_DHDR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_function
DECL|function|mng_putchunk_prom
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_prom
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint8
name|iColortype
parameter_list|,
name|mng_uint8
name|iSampledepth
parameter_list|,
name|mng_uint8
name|iFilltype
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_PROM
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_prom
block|,
name|mng_write_prom
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_prom
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_PROM
operator|,
name|mng_init_prom
operator|,
name|mng_free_prom
operator|,
name|mng_read_prom
operator|,
name|mng_write_prom
operator|,
name|mng_assign_prom
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_PROM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_PROM
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_prom
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_PROM
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_promp
operator|)
name|pChunk
operator|)
operator|->
name|iColortype
operator|=
name|iColortype
expr_stmt|;
operator|(
operator|(
name|mng_promp
operator|)
name|pChunk
operator|)
operator|->
name|iSampledepth
operator|=
name|iSampledepth
expr_stmt|;
operator|(
operator|(
name|mng_promp
operator|)
name|pChunk
operator|)
operator|->
name|iFilltype
operator|=
name|iFilltype
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_PROM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_function
DECL|function|mng_putchunk_ipng
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_ipng
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_IPNG
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_ipng
block|,
name|mng_write_ipng
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_ipng
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_IPNG
operator|,
name|mng_init_ipng
operator|,
name|mng_free_ipng
operator|,
name|mng_read_ipng
operator|,
name|mng_write_ipng
operator|,
name|mng_assign_ipng
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_IPNG
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_IPNG
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_ipng
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_IPNG
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_IPNG
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_function
DECL|function|mng_putchunk_pplt
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_pplt
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint8
name|iDeltatype
parameter_list|,
name|mng_uint32
name|iCount
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_PPLT
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_pplt
block|,
name|mng_write_pplt
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_pplt
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_PPLT
operator|,
name|mng_init_pplt
operator|,
name|mng_free_pplt
operator|,
name|mng_read_pplt
operator|,
name|mng_write_pplt
operator|,
name|mng_assign_pplt
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_PPLT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_PPLT
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_pplt
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_PPLT
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_ppltp
operator|)
name|pChunk
operator|)
operator|->
name|iDeltatype
operator|=
name|iDeltatype
expr_stmt|;
operator|(
operator|(
name|mng_ppltp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
operator|=
name|iCount
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_PPLT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_function
DECL|function|mng_putchunk_pplt_entry
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_pplt_entry
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iEntry
parameter_list|,
name|mng_uint16
name|iRed
parameter_list|,
name|mng_uint16
name|iGreen
parameter_list|,
name|mng_uint16
name|iBlue
parameter_list|,
name|mng_uint16
name|iAlpha
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_pplt_entryp
name|pEntry
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_PPLT_ENTRY
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
name|pChunk
operator|=
name|pData
operator|->
name|pLastchunk
expr_stmt|;
comment|/* last one must have been PPLT ! */
if|if
condition|(
operator|(
operator|(
name|mng_chunk_headerp
operator|)
name|pChunk
operator|)
operator|->
name|iChunkname
operator|!=
name|MNG_UINT_PPLT
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOCORRCHUNK
argument_list|)
comment|/* index out of bounds ? */
if|if
condition|(
name|iEntry
operator|>=
operator|(
operator|(
name|mng_ppltp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_INVALIDENTRYIX
argument_list|)
comment|/* address proper entry */
name|pEntry
operator|=
call|(
name|mng_pplt_entryp
call|)
argument_list|(
operator|(
operator|(
name|mng_ppltp
operator|)
name|pChunk
operator|)
operator|->
name|aEntries
argument_list|)
operator|+
name|iEntry
expr_stmt|;
name|pEntry
operator|->
name|iRed
operator|=
operator|(
name|mng_uint8
operator|)
name|iRed
expr_stmt|;
comment|/* fill the entry */
name|pEntry
operator|->
name|iGreen
operator|=
operator|(
name|mng_uint8
operator|)
name|iGreen
expr_stmt|;
name|pEntry
operator|->
name|iBlue
operator|=
operator|(
name|mng_uint8
operator|)
name|iBlue
expr_stmt|;
name|pEntry
operator|->
name|iAlpha
operator|=
operator|(
name|mng_uint8
operator|)
name|iAlpha
expr_stmt|;
name|pEntry
operator|->
name|bUsed
operator|=
name|MNG_TRUE
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_PPLT_ENTRY
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
end_ifdef
begin_function
DECL|function|mng_putchunk_ijng
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_ijng
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_IJNG
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_ijng
block|,
name|mng_write_ijng
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_ijng
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_IJNG
operator|,
name|mng_init_ijng
operator|,
name|mng_free_ijng
operator|,
name|mng_read_ijng
operator|,
name|mng_write_ijng
operator|,
name|mng_assign_ijng
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_IJNG
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_IJNG
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_ijng
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_IJNG
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_IJNG
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_function
DECL|function|mng_putchunk_drop
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_drop
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iCount
parameter_list|,
name|mng_chunkidp
name|pChunknames
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_DROP
block|,
name|mng_init_general
block|,
name|mng_free_drop
block|,
name|mng_read_drop
block|,
name|mng_write_drop
block|,
name|mng_assign_drop
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_drop
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_DROP
operator|,
name|mng_init_drop
operator|,
name|mng_free_drop
operator|,
name|mng_read_drop
operator|,
name|mng_write_drop
operator|,
name|mng_assign_drop
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_DROP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_DROP
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_drop
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_DROP
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_dropp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
operator|=
name|iCount
expr_stmt|;
if|if
condition|(
name|iCount
condition|)
block|{
name|mng_uint32
name|iSize
init|=
name|iCount
operator|*
sizeof|sizeof
argument_list|(
name|mng_chunkid
argument_list|)
decl_stmt|;
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_dropp
operator|)
name|pChunk
operator|)
operator|->
name|pChunknames
argument_list|,
name|iSize
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_dropp
operator|)
name|pChunk
operator|)
operator|->
name|pChunknames
argument_list|,
name|pChunknames
argument_list|,
name|iSize
argument_list|)
expr_stmt|;
block|}
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_DROP
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_DBYK
end_ifndef
begin_function
DECL|function|mng_putchunk_dbyk
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_dbyk
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_chunkid
name|iChunkname
parameter_list|,
name|mng_uint8
name|iPolarity
parameter_list|,
name|mng_uint32
name|iKeywordssize
parameter_list|,
name|mng_pchar
name|zKeywords
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_DBYK
block|,
name|mng_init_general
block|,
name|mng_free_dbyk
block|,
name|mng_read_dbyk
block|,
name|mng_write_dbyk
block|,
name|mng_assign_dbyk
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_dbyk
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_DBYK
operator|,
name|mng_init_dbyk
operator|,
name|mng_free_dbyk
operator|,
name|mng_read_dbyk
operator|,
name|mng_write_dbyk
operator|,
name|mng_assign_dbyk
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_DBYK
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_DBYK
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_dbyk
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_DBYK
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_dbykp
operator|)
name|pChunk
operator|)
operator|->
name|iChunkname
operator|=
name|iChunkname
expr_stmt|;
operator|(
operator|(
name|mng_dbykp
operator|)
name|pChunk
operator|)
operator|->
name|iPolarity
operator|=
name|iPolarity
expr_stmt|;
operator|(
operator|(
name|mng_dbykp
operator|)
name|pChunk
operator|)
operator|->
name|iKeywordssize
operator|=
name|iKeywordssize
expr_stmt|;
if|if
condition|(
name|iKeywordssize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_dbykp
operator|)
name|pChunk
operator|)
operator|->
name|zKeywords
argument_list|,
name|iKeywordssize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_dbykp
operator|)
name|pChunk
operator|)
operator|->
name|zKeywords
argument_list|,
name|zKeywords
argument_list|,
name|iKeywordssize
argument_list|)
expr_stmt|;
block|}
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_DBYK
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_ORDR
end_ifndef
begin_function
DECL|function|mng_putchunk_ordr
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_ordr
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iCount
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_ORDR
block|,
name|mng_init_general
block|,
name|mng_free_ordr
block|,
name|mng_read_ordr
block|,
name|mng_write_ordr
block|,
name|mng_assign_ordr
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_ordr
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_ORDR
operator|,
name|mng_init_ordr
operator|,
name|mng_free_ordr
operator|,
name|mng_read_ordr
operator|,
name|mng_write_ordr
operator|,
name|mng_assign_ordr
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_ORDR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_ORDR
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_ordr
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_ORDR
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_ordrp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
operator|=
name|iCount
expr_stmt|;
if|if
condition|(
name|iCount
condition|)
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_ordrp
operator|)
name|pChunk
operator|)
operator|->
name|pEntries
argument_list|,
name|iCount
operator|*
sizeof|sizeof
argument_list|(
name|mng_ordr_entry
argument_list|)
argument_list|)
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_ORDR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_ORDR
end_ifndef
begin_function
DECL|function|mng_putchunk_ordr_entry
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_ordr_entry
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iEntry
parameter_list|,
name|mng_chunkid
name|iChunkname
parameter_list|,
name|mng_uint8
name|iOrdertype
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_ordr_entryp
name|pEntry
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_ORDR_ENTRY
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
name|pChunk
operator|=
name|pData
operator|->
name|pLastchunk
expr_stmt|;
comment|/* last one must have been ORDR ! */
if|if
condition|(
operator|(
operator|(
name|mng_chunk_headerp
operator|)
name|pChunk
operator|)
operator|->
name|iChunkname
operator|!=
name|MNG_UINT_ORDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOCORRCHUNK
argument_list|)
comment|/* index out of bounds ? */
if|if
condition|(
name|iEntry
operator|>=
operator|(
operator|(
name|mng_ordrp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_INVALIDENTRYIX
argument_list|)
comment|/* address proper entry */
name|pEntry
operator|=
operator|(
operator|(
name|mng_ordrp
operator|)
name|pChunk
operator|)
operator|->
name|pEntries
operator|+
name|iEntry
expr_stmt|;
name|pEntry
operator|->
name|iChunkname
operator|=
name|iChunkname
expr_stmt|;
comment|/* fill the entry */
name|pEntry
operator|->
name|iOrdertype
operator|=
name|iOrdertype
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_ORDR_ENTRY
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_MAGN
end_ifndef
begin_function
DECL|function|mng_putchunk_magn
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_magn
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint16
name|iFirstid
parameter_list|,
name|mng_uint16
name|iLastid
parameter_list|,
name|mng_uint16
name|iMethodX
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iMY
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint16
name|iMT
parameter_list|,
name|mng_uint16
name|iMB
parameter_list|,
name|mng_uint16
name|iMethodY
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_MAGN
block|,
name|mng_init_general
block|,
name|mng_free_general
block|,
name|mng_read_magn
block|,
name|mng_write_magn
block|,
name|mng_assign_general
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_magn
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_MAGN
operator|,
name|mng_init_magn
operator|,
name|mng_free_magn
operator|,
name|mng_read_magn
operator|,
name|mng_write_magn
operator|,
name|mng_assign_magn
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_MAGN
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_MAGN
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_magn
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_MAGN
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iFirstid
operator|=
name|iFirstid
expr_stmt|;
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iLastid
operator|=
name|iLastid
expr_stmt|;
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMethodX
operator|=
operator|(
name|mng_uint8
operator|)
name|iMethodX
expr_stmt|;
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMX
operator|=
name|iMX
expr_stmt|;
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMY
operator|=
name|iMY
expr_stmt|;
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iML
operator|=
name|iML
expr_stmt|;
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMR
operator|=
name|iMR
expr_stmt|;
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMT
operator|=
name|iMT
expr_stmt|;
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMB
operator|=
name|iMB
expr_stmt|;
operator|(
operator|(
name|mng_magnp
operator|)
name|pChunk
operator|)
operator|->
name|iMethodY
operator|=
operator|(
name|mng_uint8
operator|)
name|iMethodY
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_MAGN
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_MPNG_PROPOSAL
end_ifdef
begin_function
DECL|function|mng_putchunk_mpng
name|MNG_EXT
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_mpng
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iFramewidth
parameter_list|,
name|mng_uint32
name|iFrameheight
parameter_list|,
name|mng_uint16
name|iNumplays
parameter_list|,
name|mng_uint16
name|iTickspersec
parameter_list|,
name|mng_uint8
name|iCompressionmethod
parameter_list|,
name|mng_uint32
name|iCount
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_mpNG
block|,
name|mng_init_general
block|,
name|mng_free_mpng
block|,
name|mng_read_mpng
block|,
name|mng_write_mpng
block|,
name|mng_assign_mpng
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_mpng
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_mpNG
operator|,
name|mng_init_mpng
operator|,
name|mng_free_mpng
operator|,
name|mng_read_mpng
operator|,
name|mng_write_mpng
operator|,
name|mng_assign_mpng
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_MPNG
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a IHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_IHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_mpng
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_mpNG
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_mpngp
operator|)
name|pChunk
operator|)
operator|->
name|iFramewidth
operator|=
name|iFramewidth
expr_stmt|;
operator|(
operator|(
name|mng_mpngp
operator|)
name|pChunk
operator|)
operator|->
name|iFrameheight
operator|=
name|iFrameheight
expr_stmt|;
operator|(
operator|(
name|mng_mpngp
operator|)
name|pChunk
operator|)
operator|->
name|iNumplays
operator|=
name|iNumplays
expr_stmt|;
operator|(
operator|(
name|mng_mpngp
operator|)
name|pChunk
operator|)
operator|->
name|iTickspersec
operator|=
name|iTickspersec
expr_stmt|;
operator|(
operator|(
name|mng_mpngp
operator|)
name|pChunk
operator|)
operator|->
name|iCompressionmethod
operator|=
name|iCompressionmethod
expr_stmt|;
operator|(
operator|(
name|mng_mpngp
operator|)
name|pChunk
operator|)
operator|->
name|iFramessize
operator|=
name|iCount
operator|*
sizeof|sizeof
argument_list|(
name|mng_mpng_frame
argument_list|)
expr_stmt|;
if|if
condition|(
name|iCount
condition|)
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_mpngp
operator|)
name|pChunk
operator|)
operator|->
name|pFrames
argument_list|,
operator|(
operator|(
name|mng_mpngp
operator|)
name|pChunk
operator|)
operator|->
name|iFramessize
argument_list|)
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_MPNG
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_MPNG_PROPOSAL
end_ifdef
begin_function
DECL|function|mng_putchunk_mpng_frame
name|MNG_EXT
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_mpng_frame
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iEntry
parameter_list|,
name|mng_uint32
name|iX
parameter_list|,
name|mng_uint32
name|iY
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint32
name|iHeight
parameter_list|,
name|mng_int32
name|iXoffset
parameter_list|,
name|mng_int32
name|iYoffset
parameter_list|,
name|mng_uint16
name|iTicks
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_mpng_framep
name|pFrame
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_MPNG_FRAME
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a IHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_IHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
name|pChunk
operator|=
name|pData
operator|->
name|pLastchunk
expr_stmt|;
comment|/* last one must have been mpNG ! */
if|if
condition|(
operator|(
operator|(
name|mng_chunk_headerp
operator|)
name|pChunk
operator|)
operator|->
name|iChunkname
operator|!=
name|MNG_UINT_mpNG
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOCORRCHUNK
argument_list|)
comment|/* index out of bounds ? */
if|if
condition|(
name|iEntry
operator|>=
operator|(
operator|(
operator|(
name|mng_mpngp
operator|)
name|pChunk
operator|)
operator|->
name|iFramessize
operator|/
sizeof|sizeof
argument_list|(
name|mng_mpng_frame
argument_list|)
operator|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_INVALIDENTRYIX
argument_list|)
comment|/* address proper entry */
name|pFrame
operator|=
operator|(
operator|(
name|mng_mpngp
operator|)
name|pChunk
operator|)
operator|->
name|pFrames
operator|+
name|iEntry
expr_stmt|;
comment|/* fill entry */
name|pFrame
operator|->
name|iX
operator|=
name|iX
expr_stmt|;
name|pFrame
operator|->
name|iY
operator|=
name|iY
expr_stmt|;
name|pFrame
operator|->
name|iWidth
operator|=
name|iWidth
expr_stmt|;
name|pFrame
operator|->
name|iHeight
operator|=
name|iHeight
expr_stmt|;
name|pFrame
operator|->
name|iXoffset
operator|=
name|iXoffset
expr_stmt|;
name|pFrame
operator|->
name|iYoffset
operator|=
name|iYoffset
expr_stmt|;
name|pFrame
operator|->
name|iTicks
operator|=
name|iTicks
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_MPNG_FRAME
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_evNT
end_ifndef
begin_function
DECL|function|mng_putchunk_evnt
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_evnt
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iCount
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_evNT
block|,
name|mng_init_general
block|,
name|mng_free_evnt
block|,
name|mng_read_evnt
block|,
name|mng_write_evnt
block|,
name|mng_assign_evnt
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_evnt
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_evNT
operator|,
name|mng_init_evnt
operator|,
name|mng_free_evnt
operator|,
name|mng_read_evnt
operator|,
name|mng_write_evnt
operator|,
name|mng_assign_evnt
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_EVNT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|MNG_UINT_evNT
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_evnt
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_evNT
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_evntp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
operator|=
name|iCount
expr_stmt|;
if|if
condition|(
name|iCount
condition|)
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_evntp
operator|)
name|pChunk
operator|)
operator|->
name|pEntries
argument_list|,
name|iCount
operator|*
sizeof|sizeof
argument_list|(
name|mng_evnt_entry
argument_list|)
argument_list|)
expr_stmt|;
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_EVNT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_putchunk_evnt_entry
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_evnt_entry
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iEntry
parameter_list|,
name|mng_uint8
name|iEventtype
parameter_list|,
name|mng_uint8
name|iMasktype
parameter_list|,
name|mng_int32
name|iLeft
parameter_list|,
name|mng_int32
name|iRight
parameter_list|,
name|mng_int32
name|iTop
parameter_list|,
name|mng_int32
name|iBottom
parameter_list|,
name|mng_uint16
name|iObjectid
parameter_list|,
name|mng_uint8
name|iIndex
parameter_list|,
name|mng_uint32
name|iSegmentnamesize
parameter_list|,
name|mng_pchar
name|zSegmentname
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_evnt_entryp
name|pEntry
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_EVNT_ENTRY
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a MHDR first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
name|pChunk
operator|=
name|pData
operator|->
name|pLastchunk
expr_stmt|;
comment|/* last one must have been evNT ! */
if|if
condition|(
operator|(
operator|(
name|mng_chunk_headerp
operator|)
name|pChunk
operator|)
operator|->
name|iChunkname
operator|!=
name|MNG_UINT_evNT
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOCORRCHUNK
argument_list|)
comment|/* index out of bounds ? */
if|if
condition|(
name|iEntry
operator|>=
operator|(
operator|(
name|mng_evntp
operator|)
name|pChunk
operator|)
operator|->
name|iCount
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_INVALIDENTRYIX
argument_list|)
comment|/* address proper entry */
name|pEntry
operator|=
operator|(
operator|(
name|mng_evntp
operator|)
name|pChunk
operator|)
operator|->
name|pEntries
operator|+
name|iEntry
expr_stmt|;
comment|/* fill entry */
name|pEntry
operator|->
name|iEventtype
operator|=
name|iEventtype
expr_stmt|;
name|pEntry
operator|->
name|iMasktype
operator|=
name|iMasktype
expr_stmt|;
name|pEntry
operator|->
name|iLeft
operator|=
name|iLeft
expr_stmt|;
name|pEntry
operator|->
name|iRight
operator|=
name|iRight
expr_stmt|;
name|pEntry
operator|->
name|iTop
operator|=
name|iTop
expr_stmt|;
name|pEntry
operator|->
name|iBottom
operator|=
name|iBottom
expr_stmt|;
name|pEntry
operator|->
name|iObjectid
operator|=
name|iObjectid
expr_stmt|;
name|pEntry
operator|->
name|iIndex
operator|=
name|iIndex
expr_stmt|;
name|pEntry
operator|->
name|iSegmentnamesize
operator|=
name|iSegmentnamesize
expr_stmt|;
if|if
condition|(
name|iSegmentnamesize
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pEntry
operator|->
name|zSegmentname
argument_list|,
name|iSegmentnamesize
operator|+
literal|1
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
name|pEntry
operator|->
name|zSegmentname
argument_list|,
name|zSegmentname
argument_list|,
name|iSegmentnamesize
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_EVNT_ENTRY
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_putchunk_unknown
name|mng_retcode
name|MNG_DECL
name|mng_putchunk_unknown
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_chunkid
name|iChunkname
parameter_list|,
name|mng_uint32
name|iRawlen
parameter_list|,
name|mng_ptr
name|pRawdata
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
name|mng_chunk_header
name|sChunkheader
init|=
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
block|{
name|MNG_UINT_HUH
block|,
name|mng_init_general
block|,
name|mng_free_unknown
block|,
name|mng_read_unknown
block|,
name|mng_write_unknown
block|,
name|mng_assign_unknown
block|,
literal|0
block|,
literal|0
block|,
expr|sizeof
operator|(
name|mng_unknown_chunk
operator|)
block|}
decl_stmt|;
else|#
directive|else
block|{
name|MNG_UINT_HUH
operator|,
name|mng_init_unknown
operator|,
name|mng_free_unknown
operator|,
name|mng_read_unknown
operator|,
name|mng_write_unknown
operator|,
name|mng_assign_unknown
operator|,
literal|0
operator|,
literal|0
block|}
empty_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_chunk_header
name|sChunkheader
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_UNKNOWN
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must have had a header first! */
if|if
condition|(
name|pData
operator|->
name|iFirstchunkadded
operator|==
literal|0
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOHEADER
argument_list|)
comment|/* prevent misplaced TERM ! */
if|if
condition|(
operator|!
name|check_term
argument_list|(
name|pData
argument_list|,
name|iChunkname
argument_list|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_TERMSEQERROR
argument_list|)
comment|/* create the chunk */
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_CHUNKREADER
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_CHUNKINITFREE
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
else|#
directive|else
name|iRetcode
operator|=
name|mng_init_unknown
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
else|#
directive|else
name|mng_get_chunkheader
argument_list|(
name|MNG_UINT_HUH
argument_list|,
operator|&
name|sChunkheader
argument_list|)
expr_stmt|;
name|iRetcode
operator|=
name|mng_init_general
argument_list|(
name|pData
argument_list|,
operator|&
name|sChunkheader
argument_list|,
operator|&
name|pChunk
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* fill the chunk */
operator|(
operator|(
name|mng_unknown_chunkp
operator|)
name|pChunk
operator|)
operator|->
name|sHeader
operator|.
name|iChunkname
operator|=
name|iChunkname
expr_stmt|;
operator|(
operator|(
name|mng_unknown_chunkp
operator|)
name|pChunk
operator|)
operator|->
name|iDatasize
operator|=
name|iRawlen
expr_stmt|;
if|if
condition|(
name|iRawlen
condition|)
block|{
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
operator|(
operator|(
name|mng_unknown_chunkp
operator|)
name|pChunk
operator|)
operator|->
name|pData
argument_list|,
name|iRawlen
argument_list|)
expr_stmt|;
name|MNG_COPY
argument_list|(
operator|(
operator|(
name|mng_unknown_chunkp
operator|)
name|pChunk
operator|)
operator|->
name|pData
argument_list|,
name|pRawdata
argument_list|,
name|iRawlen
argument_list|)
expr_stmt|;
block|}
name|mng_add_chunk
argument_list|(
name|pData
argument_list|,
name|pChunk
argument_list|)
expr_stmt|;
comment|/* add it to the list */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTCHUNK_UNKNOWN
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_INCLUDE_WRITE_PROCS */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_getimgdata_seq
name|mng_retcode
name|MNG_DECL
name|mng_getimgdata_seq
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iSeqnr
parameter_list|,
name|mng_uint32
name|iCanvasstyle
parameter_list|,
name|mng_getcanvasline
name|fGetcanvasline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETIMGDATA_SEQ
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETIMGDATA_SEQ
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_FNNOTIMPLEMENTED
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_getimgdata_chunkseq
name|mng_retcode
name|MNG_DECL
name|mng_getimgdata_chunkseq
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iSeqnr
parameter_list|,
name|mng_uint32
name|iCanvasstyle
parameter_list|,
name|mng_getcanvasline
name|fGetcanvasline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETIMGDATA_CHUNKSEQ
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETIMGDATA_CHUNKSEQ
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_FNNOTIMPLEMENTED
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_getimgdata_chunk
name|mng_retcode
name|MNG_DECL
name|mng_getimgdata_chunk
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_handle
name|hChunk
parameter_list|,
name|mng_uint32
name|iCanvasstyle
parameter_list|,
name|mng_getcanvasline
name|fGetcanvasline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETIMGDATA_CHUNK
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETIMGDATA_CHUNK
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_FNNOTIMPLEMENTED
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_WRITE_PROCS
end_ifdef
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_putimgdata_ihdr
name|mng_retcode
name|MNG_DECL
name|mng_putimgdata_ihdr
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint32
name|iHeight
parameter_list|,
name|mng_uint8
name|iColortype
parameter_list|,
name|mng_uint8
name|iBitdepth
parameter_list|,
name|mng_uint8
name|iCompression
parameter_list|,
name|mng_uint8
name|iFilter
parameter_list|,
name|mng_uint8
name|iInterlace
parameter_list|,
name|mng_uint32
name|iCanvasstyle
parameter_list|,
name|mng_getcanvasline
name|fGetcanvasline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTIMGDATA_IHDR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTIMGDATA_IHDR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_FNNOTIMPLEMENTED
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
end_ifdef
begin_function
DECL|function|mng_putimgdata_jhdr
name|mng_retcode
name|MNG_DECL
name|mng_putimgdata_jhdr
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint32
name|iHeight
parameter_list|,
name|mng_uint8
name|iColortype
parameter_list|,
name|mng_uint8
name|iBitdepth
parameter_list|,
name|mng_uint8
name|iCompression
parameter_list|,
name|mng_uint8
name|iInterlace
parameter_list|,
name|mng_uint8
name|iAlphaBitdepth
parameter_list|,
name|mng_uint8
name|iAlphaCompression
parameter_list|,
name|mng_uint8
name|iAlphaFilter
parameter_list|,
name|mng_uint8
name|iAlphaInterlace
parameter_list|,
name|mng_uint32
name|iCanvasstyle
parameter_list|,
name|mng_getcanvasline
name|fGetcanvasline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTIMGDATA_JHDR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_PUTIMGDATA_JHDR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_FNNOTIMPLEMENTED
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_updatemngheader
name|mng_retcode
name|MNG_DECL
name|mng_updatemngheader
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iFramecount
parameter_list|,
name|mng_uint32
name|iLayercount
parameter_list|,
name|mng_uint32
name|iPlaytime
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_UPDATEMNGHEADER
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must be a MNG animation! */
if|if
condition|(
operator|(
name|pData
operator|->
name|eImagetype
operator|!=
name|mng_it_mng
operator|)
operator|||
operator|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
operator|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOMHDR
argument_list|)
name|pChunk
operator|=
name|pData
operator|->
name|pFirstchunk
expr_stmt|;
comment|/* get the first chunk */
comment|/* and update the variables */
operator|(
operator|(
name|mng_mhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iFramecount
operator|=
name|iFramecount
expr_stmt|;
operator|(
operator|(
name|mng_mhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iLayercount
operator|=
name|iLayercount
expr_stmt|;
operator|(
operator|(
name|mng_mhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iPlaytime
operator|=
name|iPlaytime
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_UPDATEMNGHEADER
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_updatemngsimplicity
name|mng_retcode
name|MNG_DECL
name|mng_updatemngsimplicity
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iSimplicity
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_chunkp
name|pChunk
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_UPDATEMNGSIMPLICITY
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|hHandle
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bCreating
condition|)
comment|/* aren't we creating a new file ? */
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_FUNCTIONINVALID
argument_list|)
comment|/* must be a MNG animation! */
if|if
condition|(
operator|(
name|pData
operator|->
name|eImagetype
operator|!=
name|mng_it_mng
operator|)
operator|||
operator|(
name|pData
operator|->
name|iFirstchunkadded
operator|!=
name|MNG_UINT_MHDR
operator|)
condition|)
name|MNG_ERROR
argument_list|(
argument|pData
argument_list|,
argument|MNG_NOMHDR
argument_list|)
name|pChunk
operator|=
name|pData
operator|->
name|pFirstchunk
expr_stmt|;
comment|/* get the first chunk */
comment|/* and update the variable */
operator|(
operator|(
name|mng_mhdrp
operator|)
name|pChunk
operator|)
operator|->
name|iSimplicity
operator|=
name|iSimplicity
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_UPDATEMNGSIMPLICITY
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_INCLUDE_WRITE_PROCS */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_ACCESS_CHUNKS */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* * end of file                                                            * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
end_unit
