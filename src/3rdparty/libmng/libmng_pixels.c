begin_unit
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *             For conditions of distribution and use,                    * */
end_comment
begin_comment
comment|/* *                see copyright notice in libmng.h                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * project   : libmng                                                     * */
end_comment
begin_comment
comment|/* * file      : libmng_pixels.c           copyright (c) 2000-2005 G.Juyn   * */
end_comment
begin_comment
comment|/* * version   : 1.0.10                                                     * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * purpose   : Pixel-row management routines (implementation)             * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * author    : G.Juyn                                                     * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * comment   : implementation of the pixel-row management routines        * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             the dual alpha-composing for RGBA/BGRA/etc output-canvas'  * */
end_comment
begin_comment
comment|/* *             is based on the Note on Compositing chapter of the         * */
end_comment
begin_comment
comment|/* *             DOH-3 draft, noted to me by Adam M. Costello               * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * changes   : 0.5.1 - 05/08/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed strict-ANSI stuff                                * */
end_comment
begin_comment
comment|/* *             0.5.1 - 05/11/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added callback error-reporting support                   * */
end_comment
begin_comment
comment|/* *             0.5.1 - 05/12/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed trace to macro for callback error-reporting      * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.5.2 - 05/22/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added JNG support                                        * */
end_comment
begin_comment
comment|/* *             0.5.2 - 05/30/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed minor bugs 16-bit pixel-handling                   * */
end_comment
begin_comment
comment|/* *             - added delta-image row-processing routines                * */
end_comment
begin_comment
comment|/* *             0.5.2 - 06/02/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed endian support (hopefully)                         * */
end_comment
begin_comment
comment|/* *             0.5.2 - 06/03/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed makeup for Linux gcc compile                       * */
end_comment
begin_comment
comment|/* *             0.5.2 - 06/05/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - implemented app bkgd restore routines                    * */
end_comment
begin_comment
comment|/* *             - implemented RGBA8, ARGB8, BGRA8& ABGR8 display routines * */
end_comment
begin_comment
comment|/* *             - added support for RGB8_A8 canvasstyle                    * */
end_comment
begin_comment
comment|/* *             0.5.2 - 06/09/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed alpha-handling for alpha canvasstyles              * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.5.3 - 06/16/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed progressive-display processing                   * */
end_comment
begin_comment
comment|/* *             0.5.3 - 06/17/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed to support delta-images                          * */
end_comment
begin_comment
comment|/* *             - optimized some store_xxx routines                        * */
end_comment
begin_comment
comment|/* *             0.5.3 - 06/20/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed nasty bug with embedded PNG after delta-image      * */
end_comment
begin_comment
comment|/* *             0.5.3 - 06/24/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed problem with 16-bit GA format                      * */
end_comment
begin_comment
comment|/* *             0.5.3 - 06/25/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed problem with cheap transparency for 4-bit gray     * */
end_comment
begin_comment
comment|/* *             - fixed display_xxxx routines for interlaced images        * */
end_comment
begin_comment
comment|/* *             0.5.3 - 06/28/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed compiler-warning for non-initialized iB variable   * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.1 - 07/05/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed mandatory BACK color to be opaque                  * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.2 - 07/31/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - B110547 - fixed bug in interlace code                    * */
end_comment
begin_comment
comment|/* *             0.9.2 - 08/05/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed file-prefixes                                    * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.3 - 08/20/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed app-supplied background restore                    * */
end_comment
begin_comment
comment|/* *             0.9.3 - 08/26/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added MAGN chunk                                         * */
end_comment
begin_comment
comment|/* *             0.9.3 - 09/07/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added support for new filter_types                       * */
end_comment
begin_comment
comment|/* *             0.9.3 - 09/30/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed MAGN rounding errors (thanks Matthias!)            * */
end_comment
begin_comment
comment|/* *             0.9.3 - 10/10/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed alpha-blending for RGBA canvasstyle                * */
end_comment
begin_comment
comment|/* *             0.9.3 - 10/11/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed alpha-blending for other alpha-canvasstyles        * */
end_comment
begin_comment
comment|/* *             0.9.3 - 10/16/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added optional support for bKGD for PNG images           * */
end_comment
begin_comment
comment|/* *             - added support for JDAA                                   * */
end_comment
begin_comment
comment|/* *             0.9.3 - 10/17/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed support for bKGD                                   * */
end_comment
begin_comment
comment|/* *             0.9.3 - 10/19/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - implemented delayed delta-processing                     * */
end_comment
begin_comment
comment|/* *             0.9.3 - 10/28/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed tRNS processing for gray-image< 8-bits            * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.4 - 12/16/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed mixup of data-& function-pointers (thanks Dimitri)* */
end_comment
begin_comment
comment|/* *             0.9.4 -  1/18/2001 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - removed "old" MAGN methods 3& 4                         * */
end_comment
begin_comment
comment|/* *             - added "new" MAGN methods 3, 4& 5                        * */
end_comment
begin_comment
comment|/* *             - removed test filter-methods 1& 65                       * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.1 - 04/21/2001 - G.Juyn (code by G.Kelly)              * */
end_comment
begin_comment
comment|/* *             - added BGRA8 canvas with premultiplied alpha              * */
end_comment
begin_comment
comment|/* *             1.0.1 - 04/25/2001 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - moved mng_clear_cms to libmng_cms                        * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.2 - 06/25/2001 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added option to turn off progressive refresh             * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.4 - 11/04/2001 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed possible compile-problem in cleanup_rowproc        * */
end_comment
begin_comment
comment|/* *             1.0.4 - 06/22/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - B558212 - off by one error                               * */
end_comment
begin_comment
comment|/* *             - MNG subimage alpha composite wrong for rgba8 images      * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.5 - 08/07/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added test-option for PNG filter method 193 (=no filter) * */
end_comment
begin_comment
comment|/* *             1.0.5 - 08/15/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - completed PROM support                                   * */
end_comment
begin_comment
comment|/* *             - completed delta-image support                            * */
end_comment
begin_comment
comment|/* *             1.0.5 - 08/16/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - completed MAGN support (16-bit functions)                * */
end_comment
begin_comment
comment|/* *             1.0.5 - 08/19/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - B597134 - libmng pollutes the linker namespace           * */
end_comment
begin_comment
comment|/* *             1.0.5 - 09/19/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - optimized restore-background for bKGD cases              * */
end_comment
begin_comment
comment|/* *             1.0.5 - 09/20/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - finished support for BACK image& tiling                 * */
end_comment
begin_comment
comment|/* *             1.0.5 - 09/22/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added bgrx8 canvas (filler byte)                         * */
end_comment
begin_comment
comment|/* *             1.0.5 - 09/23/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added compose over/under routines for PAST processing    * */
end_comment
begin_comment
comment|/* *             - added flip& tile routines for PAST processing           * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.6 - 03/09/2003 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - hiding 12-bit JPEG stuff                                 * */
end_comment
begin_comment
comment|/* *             1.0.6 - 05/11/2003 - Glenn RP                              * */
end_comment
begin_comment
comment|/* *             - added size-optimization COMPOSE routine usage            * */
end_comment
begin_comment
comment|/* *             1.0.6 - 05/11/2003 - G. Juyn                               * */
end_comment
begin_comment
comment|/* *             - added conditionals around canvas update routines         * */
end_comment
begin_comment
comment|/* *             1.0.6 - 05/25/2003 - Glenn RP                              * */
end_comment
begin_comment
comment|/* *             - added size-optimization DIV255B8 routine usage           * */
end_comment
begin_comment
comment|/* *             1.0.6 - 06/09/2003 - G. R-P                                * */
end_comment
begin_comment
comment|/* *             - added conditionals around 8-bit magn routines            * */
end_comment
begin_comment
comment|/* *             1.0.6 - 07/07/2003 - G. R-P                                * */
end_comment
begin_comment
comment|/* *             - removed conditionals around 8-bit magn routines          * */
end_comment
begin_comment
comment|/* *             - added MNG_NO_16BIT_SUPPORT and MNG_NO_DELTA_PNG          * */
end_comment
begin_comment
comment|/* *               conditionals                                             * */
end_comment
begin_comment
comment|/* *             - reversed many loops to use decrementing counter          * */
end_comment
begin_comment
comment|/* *             - combined init functions                                  * */
end_comment
begin_comment
comment|/* *             - converted some switches to array references              * */
end_comment
begin_comment
comment|/* *             1.0.6 - 07/29/2003 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed duplicate for-loop                                 * */
end_comment
begin_comment
comment|/* *             1.0.6 - 07/29/2003 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added SKIPCHUNK conditionals around PAST chunk support   * */
end_comment
begin_comment
comment|/* *             - fixed "FOOTPRINT_COMPOSEIV" typo (now "FOOTPRINT_DIV")   * */
end_comment
begin_comment
comment|/* *             1.0.6 - 08/17/2003 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added more conditionals around "promote" functions       * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.7 - 11/27/2003 - R.A                                   * */
end_comment
begin_comment
comment|/* *             - added CANVAS_RGB565 and CANVAS_BGR565                    * */
end_comment
begin_comment
comment|/* *             1.0.7 - 12/06/2003 - R.A                                   * */
end_comment
begin_comment
comment|/* *             - added CANVAS_RGBA565 and CANVAS_BGRA565                  * */
end_comment
begin_comment
comment|/* *             1.0.7 - 01/25/2004 - J.S                                   * */
end_comment
begin_comment
comment|/* *             - added premultiplied alpha canvas' for RGBA, ARGB, ABGR   * */
end_comment
begin_comment
comment|/* *             1.0.7 - 03/08/2004 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added more conditionals around 16-bit-supporting code    * */
end_comment
begin_comment
comment|/* *             1.0.7 - 03/09/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed bug in promote_g8_g8 with 16bit support off        * */
end_comment
begin_comment
comment|/* *             1.0.7 - 03/09/2004 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - more optimizations with 16bit support off                * */
end_comment
begin_comment
comment|/* *             1.0.7 - 03/10/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed some warnings for 16bit optimizations              * */
end_comment
begin_comment
comment|/* *             1.0.7 - 03/21/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed some 64-bit platform compiler warnings             * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.8 - 06/20/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - some speed optimizations (thanks to John Stiles)         * */
end_comment
begin_comment
comment|/* *             1.0.8 - 08/01/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added support for 3+byte pixelsize for JPEG's            * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.9 - 10/10/2004 - G.R-P.                                * */
end_comment
begin_comment
comment|/* *             - added MNG_NO_1_2_4BIT_SUPPORT                            * */
end_comment
begin_comment
comment|/* *             1.0.9 - 10/14/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added bgr565_a8 canvas-style (thanks to J. Elvander)     * */
end_comment
begin_comment
comment|/* *             1.0.9 - 12/05/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added LITTLEENDIAN/BIGENDIAN fixtures (thanks J.Stiles)  * */
end_comment
begin_comment
comment|/* *             - fixed MNG_NO_1_2_4BIT_SUPPORT for TBBN1G04.PNG           * */
end_comment
begin_comment
comment|/* *             1.0.9 - 12/31/2004 - G.R-P.                                * */
end_comment
begin_comment
comment|/* *             - fixed warnings about C++ style (//) comments             * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.10 - 07/06/2005 - G.R-P.                               * */
end_comment
begin_comment
comment|/* *             - added MORE MNG_NO_1_2_4BIT_SUPPORT                       * */
end_comment
begin_comment
comment|/* *             1.0.10 - 10/06/2005 - G.R-P.                               * */
end_comment
begin_comment
comment|/* *             - alloc more memory for MNG_NO_1_2_4BIT_SUPPORT            * */
end_comment
begin_comment
comment|/* *             1.0.10 - 12/07/2005 - G.R-P.                               * */
end_comment
begin_comment
comment|/* *             - optimized footprint of 16bit support                     * */
end_comment
begin_comment
comment|/* *             1.0.10 - 03/07/2006 - (thanks to W. Manthey)               * */
end_comment
begin_comment
comment|/* *             - added CANVAS_RGB555 and CANVAS_BGR555                    * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_include
include|#
directive|include
file|"libmng.h"
end_include
begin_include
include|#
directive|include
file|"libmng_data.h"
end_include
begin_include
include|#
directive|include
file|"libmng_error.h"
end_include
begin_include
include|#
directive|include
file|"libmng_trace.h"
end_include
begin_ifdef
ifdef|#
directive|ifdef
name|__BORLANDC__
end_ifdef
begin_pragma
pragma|#
directive|pragma
name|hdrstop
end_pragma
begin_endif
endif|#
directive|endif
end_endif
begin_include
include|#
directive|include
file|"libmng_objects.h"
end_include
begin_include
include|#
directive|include
file|"libmng_object_prc.h"
end_include
begin_include
include|#
directive|include
file|"libmng_memory.h"
end_include
begin_include
include|#
directive|include
file|"libmng_cms.h"
end_include
begin_include
include|#
directive|include
file|"libmng_filter.h"
end_include
begin_include
include|#
directive|include
file|"libmng_pixels.h"
end_include
begin_if
if|#
directive|if
name|defined
argument_list|(
name|__BORLANDC__
argument_list|)
operator|&&
name|defined
argument_list|(
name|MNG_STRICT_ANSI
argument_list|)
end_if
begin_pragma
pragma|#
directive|pragma
name|option
name|-
name|A
end_pragma
begin_comment
comment|/* force ANSI-C */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_DISPLAY_PROCS
end_ifdef
begin_comment
comment|/* TODO: magnification& canvas-positioning/-clipping */
end_comment
begin_comment
comment|/* TODO: major optimization of pixel-loops by using assembler (?) */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Interlace tables                                                       * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_decl_stmt
DECL|variable|interlace_row
name|MNG_LOCAL
name|mng_uint32
specifier|const
name|interlace_row
index|[
literal|7
index|]
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|4
block|,
literal|0
block|,
literal|2
block|,
literal|0
block|,
literal|1
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|variable|interlace_rowskip
name|MNG_LOCAL
name|mng_uint32
specifier|const
name|interlace_rowskip
index|[
literal|7
index|]
init|=
block|{
literal|8
block|,
literal|8
block|,
literal|8
block|,
literal|4
block|,
literal|4
block|,
literal|2
block|,
literal|2
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|variable|interlace_col
name|MNG_LOCAL
name|mng_uint32
specifier|const
name|interlace_col
index|[
literal|7
index|]
init|=
block|{
literal|0
block|,
literal|4
block|,
literal|0
block|,
literal|2
block|,
literal|0
block|,
literal|1
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|variable|interlace_colskip
name|MNG_LOCAL
name|mng_uint32
specifier|const
name|interlace_colskip
index|[
literal|7
index|]
init|=
block|{
literal|8
block|,
literal|8
block|,
literal|4
block|,
literal|4
block|,
literal|2
block|,
literal|2
block|,
literal|1
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|variable|interlace_roundoff
name|MNG_LOCAL
name|mng_uint32
specifier|const
name|interlace_roundoff
index|[
literal|7
index|]
init|=
block|{
literal|7
block|,
literal|7
block|,
literal|3
block|,
literal|3
block|,
literal|1
block|,
literal|1
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|variable|interlace_divider
name|MNG_LOCAL
name|mng_uint32
specifier|const
name|interlace_divider
index|[
literal|7
index|]
init|=
block|{
literal|3
block|,
literal|3
block|,
literal|2
block|,
literal|2
block|,
literal|1
block|,
literal|1
block|,
literal|0
block|}
decl_stmt|;
end_decl_stmt
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Alpha composing macros                                                 * */
end_comment
begin_comment
comment|/* * the code below is slightly modified from the libpng package            * */
end_comment
begin_comment
comment|/* * the original was last optimized by Greg Roelofs& Mark Adler           * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_define
DECL|macro|MNG_COMPOSE8
define|#
directive|define
name|MNG_COMPOSE8
parameter_list|(
name|RET
parameter_list|,
name|FG
parameter_list|,
name|ALPHA
parameter_list|,
name|BG
parameter_list|)
value|{                                    \        mng_uint16 iH = (mng_uint16)((mng_uint16)(FG) * (mng_uint16)(ALPHA) \                         + (mng_uint16)(BG)*(mng_uint16)(255 -              \                           (mng_uint16)(ALPHA)) + (mng_uint16)128);         \        (RET) = (mng_uint8)((iH + (iH>> 8))>> 8); }
end_define
begin_define
DECL|macro|MNG_COMPOSE16
define|#
directive|define
name|MNG_COMPOSE16
parameter_list|(
name|RET
parameter_list|,
name|FG
parameter_list|,
name|ALPHA
parameter_list|,
name|BG
parameter_list|)
value|{                                   \        mng_uint32 iH = (mng_uint32)((mng_uint32)(FG) * (mng_uint32)(ALPHA) \                         + (mng_uint32)(BG)*(mng_uint32)(65535L -           \                           (mng_uint32)(ALPHA)) + (mng_uint32)32768L);      \        (RET) = (mng_uint16)((iH + (iH>> 16))>> 16); }
end_define
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Alpha blending macros                                                  * */
end_comment
begin_comment
comment|/* * this code is based on Adam Costello's "Note on Compositing" from the   * */
end_comment
begin_comment
comment|/* * mng-list which gives the following formula:                            * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * top pixel       = (Rt, Gt, Bt, At)                                     * */
end_comment
begin_comment
comment|/* * bottom pixel    = (Rb, Gb, Bb, Ab)                                     * */
end_comment
begin_comment
comment|/* * composite pixel = (Rc, Gc, Bc, Ac)                                     * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * all values in the range 0..1                                           * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Ac = 1 - (1 - At)(1 - Ab)                                              * */
end_comment
begin_comment
comment|/* * s = At / Ac                                                            * */
end_comment
begin_comment
comment|/* * t = (1 - At) Ab / Ac                                                   * */
end_comment
begin_comment
comment|/* * Rc = s Rt + t Rb                                                       * */
end_comment
begin_comment
comment|/* * Gc = s Gt + t Gb                                                       * */
end_comment
begin_comment
comment|/* * Bc = s Bt + t Bb                                                       * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * (I just hope I coded it correctly in integer arithmetic...)            * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_define
DECL|macro|MNG_BLEND8
define|#
directive|define
name|MNG_BLEND8
parameter_list|(
name|RT
parameter_list|,
name|GT
parameter_list|,
name|BT
parameter_list|,
name|AT
parameter_list|,
name|RB
parameter_list|,
name|GB
parameter_list|,
name|BB
parameter_list|,
name|AB
parameter_list|,
name|RC
parameter_list|,
name|GC
parameter_list|,
name|BC
parameter_list|,
name|AC
parameter_list|)
value|{         \        mng_uint32 S, T;                                                      \        (AC) = (mng_uint8)((mng_uint32)255 -                                  \                           ((((mng_uint32)255 - (mng_uint32)(AT)) *           \                             ((mng_uint32)255 - (mng_uint32)(AB))   )>> 8)); \        S    = (mng_uint32)(((mng_uint32)(AT)<< 8) /                         \                            (mng_uint32)(AC));                                \        T    = (mng_uint32)(((mng_uint32)255 - (mng_uint32)(AT)) *            \                             (mng_uint32)(AB) / (mng_uint32)(AC));            \        (RC) = (mng_uint8)((S * (mng_uint32)(RT) +                            \                            T * (mng_uint32)(RB) + (mng_uint32)127)>> 8);    \        (GC) = (mng_uint8)((S * (mng_uint32)(GT) +                            \                            T * (mng_uint32)(GB) + (mng_uint32)127)>> 8);    \        (BC) = (mng_uint8)((S * (mng_uint32)(BT) +                            \                            T * (mng_uint32)(BB) + (mng_uint32)127)>> 8); }
end_define
begin_define
DECL|macro|MNG_BLEND16
define|#
directive|define
name|MNG_BLEND16
parameter_list|(
name|RT
parameter_list|,
name|GT
parameter_list|,
name|BT
parameter_list|,
name|AT
parameter_list|,
name|RB
parameter_list|,
name|GB
parameter_list|,
name|BB
parameter_list|,
name|AB
parameter_list|,
name|RC
parameter_list|,
name|GC
parameter_list|,
name|BC
parameter_list|,
name|AC
parameter_list|)
value|{            \        mng_uint32 S, T;                                                          \        (AC) = (mng_uint16)((mng_uint32)65535 -                                   \                            ((((mng_uint32)65535 - (mng_uint32)(AT)) *            \                              ((mng_uint32)65535 - (mng_uint32)(AB))   )>> 16)); \        S    = (mng_uint32)(((mng_uint32)(AT)<< 16) /                            \                             (mng_uint32)(AC));                                   \        T    = (mng_uint32)(((mng_uint32)65535 - (mng_uint32)(AT)) *              \                             (mng_uint32)(AB) / (mng_uint32)(AC));                \        (RC) = (mng_uint16)((S * (mng_uint32)(RT) +                               \                             T * (mng_uint32)(RB) + (mng_uint32)32767)>> 16);    \        (GC) = (mng_uint16)((S * (mng_uint32)(GT) +                               \                             T * (mng_uint32)(GB) + (mng_uint32)32767)>> 16);    \        (BC) = (mng_uint16)((S * (mng_uint32)(BT) +                               \                             T * (mng_uint32)(BB) + (mng_uint32)32767)>> 16); }
end_define
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* note a good optimizing compiler will optimize this */
end_comment
begin_define
DECL|macro|DIV255B8
define|#
directive|define
name|DIV255B8
parameter_list|(
name|x
parameter_list|)
value|(mng_uint8)(((x) + 127) / 255)
end_define
begin_define
DECL|macro|DIV255B16
define|#
directive|define
name|DIV255B16
parameter_list|(
name|x
parameter_list|)
value|(mng_uint16)(((x) + 32767) / 65535)
end_define
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Progressive display check - checks to see if progressive display is    * */
end_comment
begin_comment
comment|/* * in order& indicates so                                                * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * The routine is called after a call to one of the display_xxx routines  * */
end_comment
begin_comment
comment|/* * if appropriate                                                         * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * The refresh is warrented in the read_chunk routine (mng_read.c)        * */
end_comment
begin_comment
comment|/* * and only during read&display processing, since there's not much point  * */
end_comment
begin_comment
comment|/* * doing it from memory!                                                  * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_display_progressive_check
name|mng_retcode
name|mng_display_progressive_check
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
if|if
condition|(
operator|(
name|pData
operator|->
name|bDoProgressive
operator|)
operator|&&
comment|/* need progressive display? */
operator|(
operator|(
name|pData
operator|->
name|eImagetype
operator|!=
name|mng_it_mng
operator|)
operator|||
operator|(
name|pData
operator|->
name|iDataheight
operator|>
literal|300
operator|)
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iDestb
operator|-
name|pData
operator|->
name|iDestt
operator|>
literal|50
operator|)
operator|&&
operator|(
operator|!
name|pData
operator|->
name|pCurraniobj
operator|)
condition|)
block|{
name|mng_int32
name|iC
init|=
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
decl_stmt|;
if|if
condition|(
name|iC
operator|%
literal|20
operator|==
literal|0
condition|)
comment|/* every 20th line */
name|pData
operator|->
name|bNeedrefresh
operator|=
name|MNG_TRUE
expr_stmt|;
block|}
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Display routines - convert rowdata (which is already color-corrected)  * */
end_comment
begin_comment
comment|/* * to the output canvas, respecting the opacity information               * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|check_update_region
name|MNG_LOCAL
name|void
name|check_update_region
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
comment|/* determine actual canvas row */
name|mng_int32
name|iRow
init|=
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
decl_stmt|;
comment|/* check for change in update-region */
if|if
condition|(
operator|(
name|pData
operator|->
name|iDestl
operator|<
operator|(
name|mng_int32
operator|)
name|pData
operator|->
name|iUpdateleft
operator|)
operator|||
operator|(
name|pData
operator|->
name|iUpdateright
operator|==
literal|0
operator|)
condition|)
name|pData
operator|->
name|iUpdateleft
operator|=
name|pData
operator|->
name|iDestl
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|iDestr
operator|>
operator|(
name|mng_int32
operator|)
name|pData
operator|->
name|iUpdateright
condition|)
name|pData
operator|->
name|iUpdateright
operator|=
name|pData
operator|->
name|iDestr
expr_stmt|;
if|if
condition|(
operator|(
name|iRow
operator|<
operator|(
name|mng_int32
operator|)
name|pData
operator|->
name|iUpdatetop
operator|)
operator|||
operator|(
name|pData
operator|->
name|iUpdatebottom
operator|==
literal|0
operator|)
condition|)
name|pData
operator|->
name|iUpdatetop
operator|=
name|iRow
expr_stmt|;
if|if
condition|(
name|iRow
operator|+
literal|1
operator|>
operator|(
name|mng_int32
operator|)
name|pData
operator|->
name|iUpdatebottom
condition|)
name|pData
operator|->
name|iUpdatebottom
operator|=
name|iRow
operator|+
literal|1
expr_stmt|;
return|return;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_RGB8
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_rgb8
name|mng_retcode
name|mng_display_rgb8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iA16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|3
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|iA16
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA16
operator|==
literal|0xFFFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
block|}
else|else
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iA16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iA16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iA16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
name|MNG_COMPOSE8
argument_list|(
operator|*
name|pScanline
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iA8
argument_list|,
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_rgb8
name|mng_retcode
name|mng_display_rgb8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iA16
decl_stmt|;
name|mng_uint16
name|iFGg16
decl_stmt|;
name|mng_uint16
name|iBGg16
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|3
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|*
name|iBps
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
operator|*
name|iBps
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|iA16
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA16
operator|==
literal|0xFFFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
block|}
else|else
block|{
comment|/* get the proper values */
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
name|i
operator|+
name|i
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iA16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
name|i
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_rgb8
name|mng_retcode
name|mng_display_rgb8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|3
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
name|i
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|MNG_COMPOSE8
argument_list|(
operator|*
name|pScanline
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iA8
argument_list|,
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_RGB8 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_RGBA8
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_rgba8
name|mng_retcode
name|mng_display_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint16
name|iFGa16
decl_stmt|,
name|iBGa16
decl_stmt|,
name|iCa16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
name|iFGa16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iBGa16
operator|<<
literal|8
argument_list|)
operator||
name|iBGa16
expr_stmt|;
if|if
condition|(
name|iFGa16
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa16
operator|==
literal|0xFFFF
operator|)
operator|||
operator|(
name|iBGa16
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* plain copy it */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iFGa16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iFGa16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
comment|/* alpha remains fully opaque !!! */
block|}
else|else
block|{
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* let's blend */
name|MNG_BLEND16
argument_list|(
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCa16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
name|MNG_COMPOSE8
argument_list|(
operator|*
name|pScanline
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iFGa8
argument_list|,
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
comment|/* alpha remains fully opaque !!! */
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
name|pScanline
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
name|iCr8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
name|iCg8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
name|iCb8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_rgba8
name|mng_retcode
name|mng_display_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint16
name|iFGa16
decl_stmt|,
name|iBGa16
decl_stmt|,
name|iCa16
decl_stmt|;
name|mng_uint16
name|iFGg16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|*
name|iBps
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|*
name|iBps
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
operator|*
name|iBps
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
name|iFGa16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iBGa16
operator|<<
literal|8
argument_list|)
operator||
name|iBGa16
expr_stmt|;
if|if
condition|(
name|iFGa16
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa16
operator|==
literal|0xFFFF
operator|)
operator|||
operator|(
name|iBGa16
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* plain copy it */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* get the proper values */
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
name|i
operator|+
name|i
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iFGa16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
comment|/* alpha remains fully opaque !!! */
block|}
block|}
else|else
block|{
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* let's blend */
name|MNG_BLEND16
argument_list|(
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCa16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
name|i
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
comment|/* alpha remains fully opaque !!! */
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
name|pScanline
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
name|iCr8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
name|iCg8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
name|iCb8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_rgba8
name|mng_retcode
name|mng_display_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
name|i
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|MNG_COMPOSE8
argument_list|(
operator|*
name|pScanline
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iFGa8
argument_list|,
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* alpha remains fully opaque !!! */
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
name|pScanline
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
name|iCr8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
name|iCg8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
name|iCb8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_RGBA8 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_RGBA8_PM
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_rgba8_pm
name|mng_retcode
name|mng_display_rgba8_pm
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint32
name|s
decl_stmt|,
name|t
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA8_PM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|6
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|4
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|2
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
operator|-
name|i
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values and premultiply */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_BIGENDIAN_SUPPORTED
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
operator|(
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pDataline
operator|)
operator||
literal|0x000000FF
expr_stmt|;
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
endif|#
directive|endif
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|2
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|6
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* plain copy it */
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|4
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|2
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
operator|-
name|i
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|3
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* then simply copy the values */
ifdef|#
directive|ifdef
name|MNG_BIGENDIAN_SUPPORTED
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
operator|(
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pDataline
operator|)
operator||
literal|0x000000FF
expr_stmt|;
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
endif|#
directive|endif
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|2
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|3
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA8_PM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_rgba8_pm
name|mng_retcode
name|mng_display_rgba8_pm
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint32
name|s
decl_stmt|,
name|t
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA8_PM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|6
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|4
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|2
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
operator|-
name|i
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values and premultiply */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_BIGENDIAN_SUPPORTED
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
operator|(
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pDataline
operator|)
operator||
literal|0x000000FF
expr_stmt|;
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
endif|#
directive|endif
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|2
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|6
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* plain copy it */
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|4
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|2
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
operator|-
name|i
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|3
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* then simply copy the values */
ifdef|#
directive|ifdef
name|MNG_BIGENDIAN_SUPPORTED
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
operator|(
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pDataline
operator|)
operator||
literal|0x000000FF
expr_stmt|;
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
endif|#
directive|endif
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|2
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|3
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA8_PM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_rgba8_pm
name|mng_retcode
name|mng_display_rgba8_pm
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint32
name|s
decl_stmt|,
name|t
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA8_PM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values and premultiply */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_BIGENDIAN_SUPPORTED
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
operator|(
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pDataline
operator|)
operator||
literal|0x000000FF
expr_stmt|;
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
endif|#
directive|endif
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|2
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* then simply copy the values */
ifdef|#
directive|ifdef
name|MNG_BIGENDIAN_SUPPORTED
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
operator|(
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pDataline
operator|)
operator||
literal|0x000000FF
expr_stmt|;
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
endif|#
directive|endif
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|2
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|3
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA8_PM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_RGBA8_PM */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_ARGB8
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_argb8
name|mng_retcode
name|mng_display_argb8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint16
name|iFGa16
decl_stmt|,
name|iBGa16
decl_stmt|,
name|iCa16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ARGB8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
name|iFGa16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iBGa16
operator|<<
literal|8
argument_list|)
operator||
name|iBGa16
expr_stmt|;
if|if
condition|(
name|iFGa16
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa16
operator|==
literal|0xFFFF
operator|)
operator|||
operator|(
name|iBGa16
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* plain copy it */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iFGa16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iFGa16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
comment|/* alpha remains fully opaque !!! */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* let's blend */
name|MNG_BLEND16
argument_list|(
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCa16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
name|pScanline
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do simple alpha composing */
comment|/* alpha itself remains fully opaque !!! */
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
name|iCa8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
name|iCr8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
name|iCg8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
name|iCb8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ARGB8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_argb8
name|mng_retcode
name|mng_display_argb8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint16
name|iFGa16
decl_stmt|,
name|iBGa16
decl_stmt|,
name|iCa16
decl_stmt|;
name|mng_uint16
name|iFGg16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ARGB8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|*
name|iBps
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|*
name|iBps
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
operator|*
name|iBps
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
name|iFGa16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iBGa16
operator|<<
literal|8
argument_list|)
operator||
name|iBGa16
expr_stmt|;
if|if
condition|(
name|iFGa16
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa16
operator|==
literal|0xFFFF
operator|)
operator|||
operator|(
name|iBGa16
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* plain copy it */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* get the proper values */
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
name|i
operator|+
name|i
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iFGa16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
comment|/* alpha remains fully opaque !!! */
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* let's blend */
name|MNG_BLEND16
argument_list|(
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCa16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
name|pScanline
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do simple alpha composing */
comment|/* alpha itself remains fully opaque !!! */
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
name|i
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
name|iCa8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
name|iCr8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
name|iCg8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
name|iCb8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ARGB8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_argb8
name|mng_retcode
name|mng_display_argb8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ARGB8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
name|pScanline
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do simple alpha composing */
comment|/* alpha itself remains fully opaque !!! */
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
name|i
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
name|iCa8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
name|iCr8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
name|iCg8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
name|iCb8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ARGB8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_ARGB8 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_ARGB8_PM
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_argb8_pm
name|mng_retcode
name|mng_display_argb8_pm
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint32
name|s
decl_stmt|,
name|t
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ARGB8_PM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|6
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|4
index|]
expr_stmt|;
block|}
else|else
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|3
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
operator|-
name|i
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values and premultiply */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
block|}
else|else
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|3
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|6
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* plain copy it */
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|4
index|]
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
name|pScanline
index|[
literal|0
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|0
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|3
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
operator|-
name|i
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|3
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* then simply copy the values */
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
name|pScanline
index|[
literal|0
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|0
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|3
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|3
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ARGB8_PM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_argb8_pm
name|mng_retcode
name|mng_display_argb8_pm
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint32
name|s
decl_stmt|,
name|t
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ARGB8_PM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|6
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|4
index|]
expr_stmt|;
block|}
else|else
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|3
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
operator|-
name|i
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values and premultiply */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
block|}
else|else
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|3
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|6
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* plain copy it */
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|4
index|]
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
name|pScanline
index|[
literal|0
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|0
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|3
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
operator|-
name|i
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|3
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* then simply copy the values */
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
name|pScanline
index|[
literal|0
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|0
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|3
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|3
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ARGB8_PM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_argb8_pm
name|mng_retcode
name|mng_display_argb8_pm
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint32
name|s
decl_stmt|,
name|t
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ARGB8_PM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values and premultiply */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
block|}
else|else
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|3
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* then simply copy the values */
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
name|pScanline
index|[
literal|0
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|0
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
literal|3
operator|-
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|3
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ARGB8_PM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_ARGB8_PM */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_RGB8_A8
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_rgb8_a8
name|mng_retcode
name|mng_display_rgb8_a8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pAlphaline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint16
name|iFGa16
decl_stmt|,
name|iBGa16
decl_stmt|,
name|iCa16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB8_A8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination rows */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
name|pAlphaline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetalphaline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination rows starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|3
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|3
operator|)
expr_stmt|;
name|pAlphaline
operator|=
name|pAlphaline
operator|+
name|pData
operator|->
name|iCol
operator|+
name|pData
operator|->
name|iDestl
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
name|iFGa16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pAlphaline
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iBGa16
operator|<<
literal|8
argument_list|)
operator||
name|iBGa16
expr_stmt|;
if|if
condition|(
name|iFGa16
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa16
operator|==
literal|0xFFFF
operator|)
operator|||
operator|(
name|iBGa16
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* plain copy it */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iFGa16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iFGa16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
comment|/* alpha remains fully opaque !!! */
block|}
else|else
block|{
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* let's blend */
name|MNG_BLEND16
argument_list|(
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCa16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
name|pAlphaline
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
name|MNG_COMPOSE8
argument_list|(
operator|*
name|pScanline
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iFGa8
argument_list|,
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
comment|/* alpha remains fully opaque !!! */
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
name|pScanline
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
name|iCr8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
name|iCg8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
name|iCb8
expr_stmt|;
operator|*
name|pAlphaline
operator|=
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB8_A8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_rgb8_a8
name|mng_retcode
name|mng_display_rgb8_a8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pAlphaline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint16
name|iFGa16
decl_stmt|,
name|iBGa16
decl_stmt|,
name|iCa16
decl_stmt|;
name|mng_uint16
name|iFGg16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB8_A8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination rows */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
name|pAlphaline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetalphaline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination rows starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|3
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|3
operator|)
expr_stmt|;
name|pAlphaline
operator|=
name|pAlphaline
operator|+
name|pData
operator|->
name|iCol
operator|+
name|pData
operator|->
name|iDestl
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|*
name|iBps
operator|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|*
name|iBps
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|4
operator|*
name|iBps
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
name|iFGa16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pAlphaline
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iBGa16
operator|<<
literal|8
argument_list|)
operator||
name|iBGa16
expr_stmt|;
if|if
condition|(
name|iFGa16
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa16
operator|==
literal|0xFFFF
operator|)
operator|||
operator|(
name|iBGa16
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* plain copy it */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* get the proper values */
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
name|i
operator|+
name|i
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iFGa16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
comment|/* alpha remains fully opaque !!! */
block|}
block|}
else|else
block|{
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* let's blend */
name|MNG_BLEND16
argument_list|(
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCa16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
name|pAlphaline
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
name|i
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
comment|/* alpha remains fully opaque !!! */
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
name|pScanline
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
name|iCr8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
name|iCg8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
name|iCb8
expr_stmt|;
operator|*
name|pAlphaline
operator|=
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB8_A8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_rgb8_a8
name|mng_retcode
name|mng_display_rgb8_a8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pAlphaline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB8_A8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination rows */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
name|pAlphaline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetalphaline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination rows starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|3
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|3
operator|)
expr_stmt|;
name|pAlphaline
operator|=
name|pAlphaline
operator|+
name|pData
operator|->
name|iCol
operator|+
name|pData
operator|->
name|iDestl
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
name|pAlphaline
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
name|i
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|MNG_COMPOSE8
argument_list|(
operator|*
name|pScanline
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iFGa8
argument_list|,
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* alpha remains fully opaque !!! */
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
name|pScanline
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
name|iCr8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
name|iCg8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
name|iCb8
expr_stmt|;
operator|*
name|pAlphaline
operator|=
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB8_A8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_RGB8_A8 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_BGR8
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_bgr8
name|mng_retcode
name|mng_display_bgr8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iA16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|3
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|*
literal|8
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|*
literal|4
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha value */
name|iA16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|iA16
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA16
operator|==
literal|0xFFFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
block|}
else|else
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iA16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iA16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iA16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
name|MNG_COMPOSE8
argument_list|(
operator|*
name|pScanline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_bgr8
name|mng_retcode
name|mng_display_bgr8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iA16
decl_stmt|;
name|mng_uint16
name|iFGg16
decl_stmt|;
name|mng_uint16
name|iBGg16
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|3
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|*
name|iBps
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
operator|*
name|iBps
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha value */
name|iA16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|iA16
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA16
operator|==
literal|0xFFFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
block|}
else|else
block|{
comment|/* get the proper values */
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
name|i
operator|+
name|i
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|-
name|i
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iA16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|-
name|i
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|-
name|i
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_bgr8
name|mng_retcode
name|mng_display_bgr8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|3
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|*
literal|4
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|-
name|i
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|MNG_COMPOSE8
argument_list|(
operator|*
name|pScanline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_BGR8 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_BGRX8
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_bgrx8
name|mng_retcode
name|mng_display_bgrx8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iA16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRX8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|*
literal|8
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|*
literal|4
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
comment|/* filler byte */
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
comment|/* filler byte */
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha value */
name|iA16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|iA16
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA16
operator|==
literal|0xFFFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
comment|/* filler byte */
block|}
else|else
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iA16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iA16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iA16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
comment|/* filler byte */
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
comment|/* filler byte */
block|}
else|else
block|{
comment|/* do alpha composing */
name|MNG_COMPOSE8
argument_list|(
operator|*
name|pScanline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
comment|/* filler byte */
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRX8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_bgrx8
name|mng_retcode
name|mng_display_bgrx8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iA16
decl_stmt|;
name|mng_uint16
name|iFGg16
decl_stmt|;
name|mng_uint16
name|iBGg16
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRX8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|*
name|iBps
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
comment|/* filler byte */
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
operator|*
name|iBps
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha value */
name|iA16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|iA16
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA16
operator|==
literal|0xFFFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
comment|/* filler byte */
block|}
else|else
block|{
comment|/* get the proper values */
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
name|i
operator|+
name|i
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|-
name|i
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iA16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|-
name|i
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
comment|/* filler byte */
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
comment|/* filler byte */
block|}
else|else
block|{
comment|/* do alpha composing */
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|-
name|i
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
comment|/* filler byte */
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRX8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_bgrx8
name|mng_retcode
name|mng_display_bgrx8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRX8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|*
literal|4
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
comment|/* filler byte */
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
comment|/* filler byte */
block|}
else|else
block|{
comment|/* do alpha composing */
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|-
name|i
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|MNG_COMPOSE8
argument_list|(
operator|*
name|pScanline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iA8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
comment|/* filler byte */
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRX8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_BGRX8 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_BGRA8
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_bgra8
name|mng_retcode
name|mng_display_bgra8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint16
name|iFGa16
decl_stmt|,
name|iBGa16
decl_stmt|,
name|iCa16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
name|iFGa16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iBGa16
operator|<<
literal|8
argument_list|)
operator||
name|iBGa16
expr_stmt|;
if|if
condition|(
name|iFGa16
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa16
operator|==
literal|0xFFFF
operator|)
operator|||
operator|(
name|iBGa16
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* plain copy it */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iFGa16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iFGa16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
comment|/* alpha remains fully opaque !!! */
block|}
else|else
block|{
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* let's blend */
name|MNG_BLEND16
argument_list|(
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCa16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
name|MNG_COMPOSE8
argument_list|(
operator|*
name|pScanline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
comment|/* alpha remains fully opaque !!! */
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
name|pScanline
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
name|iCb8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
name|iCg8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
name|iCr8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_bgra8
name|mng_retcode
name|mng_display_bgra8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint16
name|iFGa16
decl_stmt|,
name|iBGa16
decl_stmt|,
name|iCa16
decl_stmt|;
name|mng_uint16
name|iFGg16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|*
name|iBps
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|*
name|iBps
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
operator|*
name|iBps
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
name|iFGa16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iBGa16
operator|<<
literal|8
argument_list|)
operator||
name|iBGa16
expr_stmt|;
if|if
condition|(
name|iFGa16
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa16
operator|==
literal|0xFFFF
operator|)
operator|||
operator|(
name|iBGa16
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* plain copy it */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* get the proper values */
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
name|i
operator|+
name|i
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|-
name|i
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iFGa16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|-
name|i
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
comment|/* alpha remains fully opaque !!! */
block|}
block|}
else|else
block|{
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* let's blend */
name|MNG_BLEND16
argument_list|(
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCa16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|-
name|i
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
comment|/* alpha remains fully opaque !!! */
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
name|pScanline
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
name|iCb8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
name|iCg8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
name|iCr8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_bgra8
name|mng_retcode
name|mng_display_bgra8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|-
name|i
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|MNG_COMPOSE8
argument_list|(
operator|*
name|pScanline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* alpha remains fully opaque !!! */
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
name|pScanline
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
name|iCb8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
name|iCg8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
name|iCr8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_BGRA8 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_BGRA8_PM
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_bgra8_pm
name|mng_retcode
name|mng_display_bgra8_pm
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint32
name|s
decl_stmt|,
name|t
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA8PM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|6
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|4
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values and premultiply */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|6
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* plain copy it */
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|4
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
operator|-
name|i
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|3
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* then simply copy the values */
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|3
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA8PM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_bgra8_pm
name|mng_retcode
name|mng_display_bgra8_pm
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint32
name|s
decl_stmt|,
name|t
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA8PM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|6
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|4
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
operator|-
name|i
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values and premultiply */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|6
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* plain copy it */
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|4
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
operator|-
name|i
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|3
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* then simply copy the values */
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|3
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA8PM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_bgra8_pm
name|mng_retcode
name|mng_display_bgra8_pm
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint32
name|s
decl_stmt|,
name|t
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA8PM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values and premultiply */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* then simply copy the values */
name|pScanline
index|[
literal|0
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
literal|255
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|0
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pScanline
index|[
literal|3
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|3
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA8PM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_BGRA8_PM */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_ABGR8
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_abgr8
name|mng_retcode
name|mng_display_abgr8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint16
name|iFGa16
decl_stmt|,
name|iBGa16
decl_stmt|,
name|iCa16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ABGR8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
name|iFGa16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iBGa16
operator|<<
literal|8
argument_list|)
operator||
name|iBGa16
expr_stmt|;
if|if
condition|(
name|iFGa16
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa16
operator|==
literal|0xFFFF
operator|)
operator|||
operator|(
name|iBGa16
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* plain copy it */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iFGa16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iFGa16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
comment|/* alpha itself remains fully opaque !!! */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* let's blend */
name|MNG_BLEND16
argument_list|(
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCa16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
name|pScanline
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do simple alpha composing */
comment|/* alpha itself remains fully opaque !!! */
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
name|iCa8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
name|iCb8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
name|iCg8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
name|iCr8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ABGR8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_abgr8
name|mng_retcode
name|mng_display_abgr8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint16
name|iFGa16
decl_stmt|,
name|iBGa16
decl_stmt|,
name|iCa16
decl_stmt|;
name|mng_uint16
name|iFGg16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ABGR8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|*
name|iBps
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|*
name|iBps
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
operator|*
name|iBps
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
name|iFGa16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pScanline
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iBGa16
operator|<<
literal|8
argument_list|)
operator||
name|iBGa16
expr_stmt|;
if|if
condition|(
name|iFGa16
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa16
operator|==
literal|0xFFFF
operator|)
operator|||
operator|(
name|iBGa16
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* plain copy it */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* get the proper values */
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
name|i
operator|+
name|i
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|-
name|i
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iFGa16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
comment|/* alpha itself remains fully opaque !!! */
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|-
name|i
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* let's blend */
name|MNG_BLEND16
argument_list|(
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCa16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCb16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCr16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
name|pScanline
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do simple alpha composing */
comment|/* alpha itself remains fully opaque !!! */
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|-
name|i
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
name|iCa8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
name|iCb8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
name|iCg8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
name|iCr8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ABGR8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_abgr8
name|mng_retcode
name|mng_display_abgr8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ABGR8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
name|pScanline
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
name|pScanline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
operator|*
name|pDataline
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do simple alpha composing */
comment|/* alpha itself remains fully opaque !!! */
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|-
name|i
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
name|i
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
name|iCa8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
name|iCb8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
name|iCg8
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|3
operator|)
operator|=
name|iCr8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ABGR8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_ABGR8 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_ABGR8_PM
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_abgr8_pm
name|mng_retcode
name|mng_display_abgr8_pm
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint32
name|s
decl_stmt|,
name|t
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ABGR8_PM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|6
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|4
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
block|}
else|else
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
operator|+
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
operator|-
name|i
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values and premultiply */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
block|}
else|else
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
operator|+
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|6
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* plain copy it */
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|4
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
name|pScanline
index|[
literal|0
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|0
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
operator|+
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
operator|-
name|i
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
name|i
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* then simply copy the values */
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
name|pScanline
index|[
literal|0
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|0
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
operator|+
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
name|i
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ABGR8_PM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_abgr8_pm
name|mng_retcode
name|mng_display_abgr8_pm
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint32
name|s
decl_stmt|,
name|t
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ABGR8_PM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|6
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|4
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
block|}
else|else
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
operator|+
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
operator|-
name|i
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values and premultiply */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
block|}
else|else
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
operator|+
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|6
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* plain copy it */
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|4
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
name|pScanline
index|[
literal|0
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|0
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
operator|+
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
operator|-
name|i
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
name|i
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|4
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* then simply copy the values */
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
name|pScanline
index|[
literal|0
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|0
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
operator|+
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
name|i
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ABGR8_PM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_abgr8_pm
name|mng_retcode
name|mng_display_abgr8_pm
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint32
name|s
decl_stmt|,
name|t
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ABGR8_PM
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values and premultiply */
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|==
literal|0
condition|)
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|pScanline
operator|=
literal|0
expr_stmt|;
comment|/* set all components = 0 */
else|else
block|{
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
block|}
else|else
block|{
name|pScanline
index|[
literal|0
index|]
operator|=
operator|(
name|mng_uint8
operator|)
name|s
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
operator|+
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
if|if
condition|(
operator|(
name|s
operator|=
name|pDataline
index|[
literal|3
index|]
operator|)
operator|!=
literal|0
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque ? */
if|if
condition|(
name|s
operator|==
literal|255
condition|)
block|{
comment|/* then simply copy the values */
name|pScanline
index|[
literal|0
index|]
operator|=
literal|255
expr_stmt|;
name|pScanline
index|[
literal|1
index|]
operator|=
name|pDataline
index|[
literal|2
index|]
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|pDataline
index|[
literal|1
index|]
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|pDataline
index|[
literal|0
index|]
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend (premultiplied) */
name|t
operator|=
literal|255
operator|-
name|s
expr_stmt|;
name|pScanline
index|[
literal|0
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
literal|255
operator|-
name|DIV255B8
argument_list|(
name|t
operator|*
operator|(
literal|255
operator|-
name|pScanline
index|[
literal|0
index|]
operator|)
argument_list|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_DIV
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|pScanline
index|[
name|i
operator|+
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
operator|-
name|i
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
name|i
operator|+
literal|1
index|]
argument_list|)
expr_stmt|;
block|}
block|}
else|#
directive|else
name|pScanline
index|[
literal|1
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|2
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|1
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|2
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|1
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|2
index|]
argument_list|)
expr_stmt|;
name|pScanline
index|[
literal|3
index|]
operator|=
name|DIV255B8
argument_list|(
name|s
operator|*
name|pDataline
index|[
literal|0
index|]
operator|+
name|t
operator|*
name|pScanline
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_ABGR8_PM
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_ABGR8_PM */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_BGR565
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_bgr565
name|mng_retcode
name|mng_display_bgr565
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iA16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR565
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|5
operator|)
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|iA16
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA16
operator|==
literal|0xFFFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
operator||
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|)
operator|>>
literal|3
argument_list|)
operator||
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iA16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iA16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iA16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGr16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGb16
operator|>>
literal|11
operator|)
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|>>
literal|3
operator|)
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
name|pScanline
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iA8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR565
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_bgr565
name|mng_retcode
name|mng_display_bgr565
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iA16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR565
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
operator|>>
literal|5
operator|)
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|*
name|iBps
operator|)
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
operator|*
name|iBps
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|iA16
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA16
operator|==
literal|0xFFFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
operator||
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|)
operator|>>
literal|3
argument_list|)
operator||
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iA16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iA16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iA16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGr16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGb16
operator|>>
literal|11
operator|)
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|>>
literal|3
operator|)
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
name|pScanline
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iA8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR565
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_bgr565
name|mng_retcode
name|mng_display_bgr565
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR565
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|>>
literal|3
operator|)
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
name|pScanline
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iA8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR565
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_BGR565 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_RGB565
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_rgb565
name|mng_retcode
name|mng_display_rgb565
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iA16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB565
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|iA16
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA16
operator|==
literal|0xFFFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iA16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iA16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iA16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iFGb16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
argument_list|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGr16
operator|>>
literal|11
argument_list|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|0
operator|)
argument_list|,
name|iA8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB565
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_rgb565
name|mng_retcode
name|mng_display_rgb565
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iA16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB565
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|*
name|iBps
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
operator|*
name|iBps
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|iA16
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA16
operator|==
literal|0xFFFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iA16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iA16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iA16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iFGb16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
argument_list|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGr16
operator|>>
literal|11
argument_list|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|0
operator|)
argument_list|,
name|iA8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB565
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_rgb565
name|mng_retcode
name|mng_display_rgb565
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB565
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|0
operator|)
argument_list|,
name|iA8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB565
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_RGB565 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_BGRA565
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_bgra565
name|mng_retcode
name|mng_display_bgra565
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint16
name|iFGa16
decl_stmt|,
name|iBGa16
decl_stmt|,
name|iCa16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA565
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|5
operator|)
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
name|iFGa16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iBGa16
operator|<<
literal|8
argument_list|)
operator||
name|iBGa16
expr_stmt|;
if|if
condition|(
name|iFGa16
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa16
operator|==
literal|0xFFFF
operator|)
operator|||
operator|(
name|iBGa16
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* plain copy it */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
operator||
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|)
operator|>>
literal|3
argument_list|)
operator||
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iFGa16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iFGa16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGr16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGb16
operator|>>
literal|11
operator|)
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* scale background up */
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* let's blend */
name|MNG_BLEND16
argument_list|(
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iCr16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iCb16
operator|>>
literal|11
operator|)
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCa16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|>>
literal|3
operator|)
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
name|pScanline
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iFGa8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
comment|/* alpha remains fully opaque !!! */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iRed
argument_list|,
name|iGreen
argument_list|,
name|iBlue
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCb8
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iCg8
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCr8
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iCg8
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|(
name|mng_uint8
operator|)
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA565
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_bgra565
name|mng_retcode
name|mng_display_bgra565
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint16
name|iFGa16
decl_stmt|,
name|iBGa16
decl_stmt|,
name|iCa16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA565
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
operator|>>
literal|5
operator|)
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|*
name|iBps
operator|)
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|*
name|iBps
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
operator|*
name|iBps
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
name|iFGa16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iBGa16
operator|<<
literal|8
argument_list|)
operator||
name|iBGa16
expr_stmt|;
if|if
condition|(
name|iFGa16
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa16
operator|==
literal|0xFFFF
operator|)
operator|||
operator|(
name|iBGa16
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* plain copy it */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
operator||
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|)
operator|>>
literal|3
argument_list|)
operator||
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iFGa16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iFGa16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGr16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGb16
operator|>>
literal|11
operator|)
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* scale background up */
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* let's blend */
name|MNG_BLEND16
argument_list|(
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iCr16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iCb16
operator|>>
literal|11
operator|)
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCa16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|>>
literal|3
operator|)
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
name|pScanline
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iFGa8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
comment|/* alpha remains fully opaque !!! */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iRed
argument_list|,
name|iGreen
argument_list|,
name|iBlue
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCb8
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iCg8
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCr8
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iCg8
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|(
name|mng_uint8
operator|)
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA565
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_bgra565
name|mng_retcode
name|mng_display_bgra565
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA565
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|>>
literal|3
operator|)
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
name|pScanline
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iFGa8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
comment|/* alpha remains fully opaque !!! */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iRed
argument_list|,
name|iGreen
argument_list|,
name|iBlue
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCb8
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iCg8
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCr8
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iCg8
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|(
name|mng_uint8
operator|)
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGRA565
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_BGRA565 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_RGBA565
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_rgba565
name|mng_retcode
name|mng_display_rgba565
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint16
name|iFGa16
decl_stmt|,
name|iBGa16
decl_stmt|,
name|iCa16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA565
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|5
operator|)
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
name|iFGa16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iBGa16
operator|<<
literal|8
argument_list|)
operator||
name|iBGa16
expr_stmt|;
if|if
condition|(
name|iFGa16
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa16
operator|==
literal|0xFFFF
operator|)
operator|||
operator|(
name|iBGa16
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* plain copy it */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
operator||
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|>>
literal|3
argument_list|)
operator||
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iFGa16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iFGa16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGb16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGr16
operator|>>
literal|11
operator|)
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* let's blend */
name|MNG_BLEND16
argument_list|(
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iCb16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iCr16
operator|>>
literal|11
operator|)
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCa16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|>>
literal|3
operator|)
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
name|pScanline
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iFGa8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
comment|/* alpha remains fully opaque !!! */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iRed
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iRed
argument_list|,
name|iGreen
argument_list|,
name|iBlue
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCr8
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iCg8
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCb8
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iCg8
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|(
name|mng_uint8
operator|)
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA565
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_rgba565
name|mng_retcode
name|mng_display_rgba565
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint16
name|iFGa16
decl_stmt|,
name|iBGa16
decl_stmt|,
name|iCa16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA565
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|*
name|iBps
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
operator|>>
literal|5
operator|)
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|*
name|iBps
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
operator|*
name|iBps
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* get alpha values */
name|iFGa16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iBGa16
operator|<<
literal|8
argument_list|)
operator||
name|iBGa16
expr_stmt|;
if|if
condition|(
name|iFGa16
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa16
operator|==
literal|0xFFFF
operator|)
operator|||
operator|(
name|iBGa16
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* plain copy it */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
operator||
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|>>
literal|3
argument_list|)
operator||
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iFGa16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iFGa16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGb16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGr16
operator|>>
literal|11
operator|)
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* let's blend */
name|MNG_BLEND16
argument_list|(
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iCb16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iCr16
operator|>>
literal|11
operator|)
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCa16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|>>
literal|3
operator|)
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
name|pScanline
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iFGa8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
comment|/* alpha remains fully opaque !!! */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iRed
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iRed
argument_list|,
name|iGreen
argument_list|,
name|iBlue
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCr8
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iCg8
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCb8
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iCg8
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|(
name|mng_uint8
operator|)
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA565
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_rgba565
name|mng_retcode
name|mng_display_rgba565
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA565
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|<<
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|>>
literal|3
operator|)
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
name|pScanline
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iFGa8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
comment|/* alpha remains fully opaque !!! */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iRed
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* now blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
name|iRed
argument_list|,
name|iGreen
argument_list|,
name|iBlue
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCr8
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iCg8
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCb8
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iCg8
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
operator|=
operator|(
name|mng_uint8
operator|)
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGBA565
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_RGBA565 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_BGR565_A8
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_bgr565_a8
name|mng_retcode
name|mng_display_bgr565_a8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pAlphaline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iA16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|,
name|iBGa16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|,
name|iCa16
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR565_A8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
name|pAlphaline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetalphaline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|2
operator|)
expr_stmt|;
name|pAlphaline
operator|=
name|pAlphaline
operator|+
name|pData
operator|->
name|iCol
operator|+
name|pData
operator|->
name|iDestl
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|5
operator|)
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
comment|/* Not fully opaque */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pAlphaline
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iBGa16
operator|<<
literal|8
argument_list|)
operator||
name|iBGa16
expr_stmt|;
if|if
condition|(
name|iA16
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
operator|(
name|iA16
operator|==
literal|0xFFFF
operator|)
operator|||
operator|(
name|iBGa16
operator|==
literal|0
operator|)
condition|)
comment|/* fully opaque or background fully transparent ? */
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
operator||
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|)
operator|>>
literal|3
argument_list|)
operator||
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iA16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iA16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iA16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGr16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGb16
operator|>>
literal|11
operator|)
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iA16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
else|else
comment|/* background is not fully opaque */
block|{
comment|/* scale background up */
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* let's blend */
name|MNG_BLEND16
argument_list|(
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
argument_list|,
name|iA16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iCr16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iCb16
operator|>>
literal|11
operator|)
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCa16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
name|iBGa8
operator|=
operator|*
name|pAlphaline
expr_stmt|;
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iA8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|>>
literal|3
operator|)
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
name|pScanline
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iA8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
name|iA8
expr_stmt|;
block|}
else|else
comment|/* background not fully opaque */
block|{
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
name|pScanline
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCr8
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iCg8
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCb8
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iCg8
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR565_A8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_bgr565_a8
name|mng_retcode
name|mng_display_bgr565_a8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pAlphaline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iA16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|,
name|iBGa16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|,
name|iCa16
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR565_A8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
name|pAlphaline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetalphaline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|2
operator|)
expr_stmt|;
name|pAlphaline
operator|=
name|pAlphaline
operator|+
name|pData
operator|->
name|iCol
operator|+
name|pData
operator|->
name|iDestl
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
operator|>>
literal|5
operator|)
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|*
name|iBps
operator|)
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
comment|/* Not fully opaque */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pAlphaline
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iBGa16
operator|<<
literal|8
argument_list|)
operator||
name|iBGa16
expr_stmt|;
if|if
condition|(
name|iA16
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
operator|(
name|iA16
operator|==
literal|0xFFFF
operator|)
operator|||
operator|(
name|iBGa16
operator|==
literal|0
operator|)
condition|)
comment|/* fully opaque or background fully transparent ? */
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
operator||
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|)
operator|>>
literal|3
argument_list|)
operator||
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|6
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iA16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iA16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iA16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGr16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGb16
operator|>>
literal|11
operator|)
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iA16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
else|else
comment|/* background is not fully opaque */
block|{
comment|/* scale background up */
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|)
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* let's blend */
name|MNG_BLEND16
argument_list|(
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
argument_list|,
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
argument_list|,
name|iA16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iCr16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iCb16
operator|>>
literal|11
operator|)
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iCg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iCa16
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
name|iBGa8
operator|=
operator|*
name|pAlphaline
expr_stmt|;
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iA8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|>>
literal|3
operator|)
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
name|pScanline
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iA8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
name|iA8
expr_stmt|;
block|}
else|else
comment|/* background not fully opaque */
block|{
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
name|pScanline
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCr8
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iCg8
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCb8
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iCg8
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR565_A8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_bgr565_a8
name|mng_retcode
name|mng_display_bgr565_a8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pAlphaline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|,
name|iBGa8
decl_stmt|,
name|iCa8
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR565_A8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
name|pAlphaline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetalphaline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|2
operator|)
expr_stmt|;
name|pAlphaline
operator|=
name|pAlphaline
operator|+
name|pData
operator|->
name|iCol
operator|+
name|pData
operator|->
name|iDestl
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
comment|/* Not fully opaque */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
name|iBGa8
operator|=
operator|*
name|pAlphaline
expr_stmt|;
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iA8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|)
operator|&
literal|0xF8
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|)
operator|>>
literal|3
operator|)
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
name|pScanline
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
name|pDataline
argument_list|,
name|iA8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
name|iA8
expr_stmt|;
block|}
else|else
comment|/* background not fully opaque */
block|{
name|MNG_BLEND8
argument_list|(
operator|*
name|pDataline
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
operator|*
name|pScanline
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pScanline
operator|+
literal|2
operator|)
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCr8
operator|&
literal|0xF8
operator|)
operator||
operator|(
name|iCg8
operator|>>
literal|5
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iCb8
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iCg8
operator|&
literal|0xFC
operator|)
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pAlphaline
operator|=
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pAlphaline
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR565_A8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_BGR565_A8 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_RGB555
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_rgb555
name|mng_retcode
name|mng_display_rgb555
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iA16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB555
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|iA16
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA16
operator|==
literal|0xFFFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|1
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|6
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iA16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iA16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iA16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGb16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
argument_list|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iFGr16
operator|>>
literal|11
operator|)
operator|>>
literal|3
argument_list|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|1
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|6
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|0
operator|)
argument_list|,
name|iA8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB555
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_rgb555
name|mng_retcode
name|mng_display_rgb555
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iA16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB555
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|*
name|iBps
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
operator|*
name|iBps
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|iA16
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA16
operator|==
literal|0xFFFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGr16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|1
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|6
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iA16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iA16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iA16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGb16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
argument_list|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iFGr16
operator|>>
literal|11
operator|)
operator|>>
literal|3
argument_list|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|1
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|6
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|0
operator|)
argument_list|,
name|iA8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB555
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_rgb555
name|mng_retcode
name|mng_display_rgb555
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB555
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|1
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|6
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|0
operator|)
argument_list|,
name|iA8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_RGB555
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_RGB555 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_BGR555
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
end_ifndef
begin_function
DECL|function|mng_display_bgr555
name|mng_retcode
name|mng_display_bgr555
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iA16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR555
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
else|else
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|iA16
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA16
operator|==
literal|0xFFFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGb16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|1
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|6
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iA16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iA16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iA16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGr16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
argument_list|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iFGb16
operator|>>
literal|11
operator|)
operator|>>
literal|3
argument_list|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|1
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|6
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|0
operator|)
argument_list|,
name|iA8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR555
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_function
DECL|function|mng_display_bgr555
name|mng_retcode
name|mng_display_bgr555
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iA16
decl_stmt|;
name|mng_uint16
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
name|mng_uint8
name|iBps
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR555
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iBps
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|bIsRGBA16
condition|?
literal|2
else|:
literal|1
argument_list|)
expr_stmt|;
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
comment|/* adjust source row starting-point */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
operator|(
name|iBps
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|*
name|iBps
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
name|iBps
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
operator|*
name|iBps
expr_stmt|;
block|}
block|}
else|else
block|{
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit input row ? */
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|6
argument_list|)
expr_stmt|;
if|if
condition|(
name|iA16
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA16
operator|==
literal|0xFFFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* scale down by dropping the LSB */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|4
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* get the proper values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
name|pDataline
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* scale background up */
name|iBGb16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|1
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|6
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGr16
operator|<<
literal|8
argument_list|)
operator||
name|iBGr16
expr_stmt|;
name|iBGg16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGg16
operator|<<
literal|8
argument_list|)
operator||
name|iBGg16
expr_stmt|;
name|iBGb16
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint32
operator|)
name|iBGb16
operator|<<
literal|8
argument_list|)
operator||
name|iBGb16
expr_stmt|;
comment|/* now compose */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iA16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iA16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iA16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iFGr16
operator|>>
literal|8
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
argument_list|)
operator||
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iFGb16
operator|>>
literal|11
operator|)
operator|>>
literal|3
argument_list|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|iFGg16
operator|>>
literal|8
argument_list|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|1
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|6
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|0
operator|)
argument_list|,
name|iA8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR555
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_COMPOSE */
end_comment
begin_else
else|#
directive|else
end_else
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_function
DECL|function|mng_display_bgr555
name|mng_retcode
name|mng_display_bgr555
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pScanline
decl_stmt|;
name|mng_uint8p
name|pDataline
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iA8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR555
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* viewable row ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
name|pData
operator|->
name|iSourcet
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iRow
operator|<
name|pData
operator|->
name|iSourceb
operator|)
condition|)
block|{
comment|/* address destination row */
name|pScanline
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetcanvasline
argument_list|(
operator|(
operator|(
name|mng_handle
operator|)
name|pData
operator|)
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
operator|-
name|pData
operator|->
name|iSourcet
argument_list|)
expr_stmt|;
comment|/* adjust destination row starting-point */
name|pScanline
operator|=
name|pScanline
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
literal|2
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDestl
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* address source row */
name|pDataline
operator|=
name|pDataline
operator|+
operator|(
operator|(
name|pData
operator|->
name|iSourcel
operator|/
name|pData
operator|->
name|iColinc
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bIsOpaque
condition|)
comment|/* forget about transparency ? */
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
comment|/* copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
block|{
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iSourcel
operator|+
name|pData
operator|->
name|iCol
init|;
name|iX
operator|<
name|pData
operator|->
name|iSourcer
condition|;
name|iX
operator|+=
name|pData
operator|->
name|iColinc
control|)
block|{
name|iA8
operator|=
operator|*
operator|(
name|pDataline
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha value */
if|if
condition|(
name|iA8
condition|)
comment|/* any opacity at all ? */
block|{
if|if
condition|(
name|iA8
operator|==
literal|0xFF
condition|)
comment|/* fully opaque ? */
block|{
comment|/* then simply copy the values */
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|)
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* do alpha composing */
name|mng_uint8
name|iRed
decl_stmt|,
name|iGreen
decl_stmt|,
name|iBlue
decl_stmt|;
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|&
literal|0xF8
operator|)
operator|<<
literal|1
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|<<
literal|6
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pScanline
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|2
operator|)
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pScanline
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iRed
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|0
operator|)
argument_list|,
name|iA8
argument_list|,
name|iRed
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iGreen
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|1
operator|)
argument_list|,
name|iA8
argument_list|,
name|iGreen
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
name|iBlue
argument_list|,
operator|*
operator|(
name|pDataline
operator|+
literal|2
operator|)
argument_list|,
name|iA8
argument_list|,
name|iBlue
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pScanline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|iRed
operator|&
literal|0xF8
operator|)
operator|>>
literal|1
operator|)
operator||
operator|(
name|iGreen
operator|>>
literal|6
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pScanline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iBlue
operator|>>
literal|3
operator|)
operator||
operator|(
operator|(
name|iGreen
operator|&
literal|0xF8
operator|)
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
block|}
name|pScanline
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|2
operator|)
expr_stmt|;
name|pDataline
operator|+=
literal|4
expr_stmt|;
block|}
block|}
block|}
block|}
name|check_update_region
argument_list|(
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_BGR555
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_BGR555 */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_BACK
end_ifndef
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Background restore routines - restore the background with info from    * */
end_comment
begin_comment
comment|/* * the BACK and/or bKGD chunk or the app's background canvas              * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_restore_bkgd_backimage
name|mng_retcode
name|mng_restore_bkgd_backimage
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
comment|/* save some stuff */
name|mng_uint8p
name|pRGBArow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iRow
init|=
name|pData
operator|->
name|iRow
decl_stmt|;
name|mng_int32
name|iRowsamples
init|=
name|pData
operator|->
name|iRowsamples
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
comment|/* work variables */
name|mng_uint8p
name|pTemp
decl_stmt|;
name|mng_uint8p
name|pWork
init|=
name|pRGBArow
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iZ
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_BACKIMAGE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* determine row to retrieve */
name|pData
operator|->
name|iRow
operator|=
name|pData
operator|->
name|iDestt
operator|+
name|iRow
operator|+
name|pData
operator|->
name|iBackimgoffsy
expr_stmt|;
while|while
condition|(
name|pData
operator|->
name|iRow
operator|>=
operator|(
name|mng_int32
operator|)
name|pData
operator|->
name|iBackimgheight
condition|)
name|pData
operator|->
name|iRow
operator|-=
operator|(
name|mng_int32
operator|)
name|pData
operator|->
name|iBackimgheight
expr_stmt|;
comment|/* set width to that of background image */
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iBackimgwidth
expr_stmt|;
comment|/* retrieve into alternate buffer ! */
name|pData
operator|->
name|pRGBArow
operator|=
name|pData
operator|->
name|pPrevrow
expr_stmt|;
comment|/* get it then */
name|iRetcode
operator|=
operator|(
operator|(
name|mng_retrieverow
operator|)
name|pData
operator|->
name|fRetrieverow
operator|)
operator|(
name|pData
operator|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error; bail out */
return|return
name|iRetcode
return|;
comment|/* we got the full row; but now need to                                           paste it into the proper location */
name|iX
operator|=
name|pData
operator|->
name|iDestl
operator|-
name|pData
operator|->
name|iBackimgoffsx
expr_stmt|;
while|while
condition|(
name|iX
operator|>=
name|pData
operator|->
name|iBackimgwidth
condition|)
name|iX
operator|-=
name|pData
operator|->
name|iBackimgwidth
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|pData
operator|->
name|bIsRGBA16
condition|)
comment|/* 16-bit buffer ? */
block|{
name|pTemp
operator|=
name|pData
operator|->
name|pPrevrow
operator|+
operator|(
name|iX
operator|<<
literal|3
operator|)
expr_stmt|;
for|for
control|(
name|iZ
operator|=
operator|(
name|pData
operator|->
name|iDestr
operator|-
name|pData
operator|->
name|iDestl
operator|)
init|;
name|iZ
operator|>
literal|0
condition|;
name|iZ
operator|--
control|)
block|{
name|MNG_COPY
argument_list|(
name|pWork
argument_list|,
name|pTemp
argument_list|,
literal|8
argument_list|)
expr_stmt|;
name|pWork
operator|+=
literal|8
expr_stmt|;
name|pTemp
operator|+=
literal|8
expr_stmt|;
name|iX
operator|++
expr_stmt|;
comment|/* reached end of bkgd-image line ? */
if|if
condition|(
name|iX
operator|>=
name|pData
operator|->
name|iBackimgwidth
condition|)
block|{
name|iX
operator|=
literal|0
expr_stmt|;
name|pTemp
operator|=
name|pData
operator|->
name|pPrevrow
expr_stmt|;
block|}
block|}
block|}
else|else
endif|#
directive|endif
block|{
name|pTemp
operator|=
name|pData
operator|->
name|pPrevrow
operator|+
operator|(
name|iX
operator|<<
literal|2
operator|)
expr_stmt|;
for|for
control|(
name|iZ
operator|=
operator|(
name|pData
operator|->
name|iDestr
operator|-
name|pData
operator|->
name|iDestl
operator|)
init|;
name|iZ
operator|>
literal|0
condition|;
name|iZ
operator|--
control|)
block|{
name|MNG_COPY
argument_list|(
name|pWork
argument_list|,
name|pTemp
argument_list|,
literal|4
argument_list|)
expr_stmt|;
name|pWork
operator|+=
literal|4
expr_stmt|;
name|pTemp
operator|+=
literal|4
expr_stmt|;
name|iX
operator|++
expr_stmt|;
comment|/* reached end of bkgd-image line ? */
if|if
condition|(
name|iX
operator|>=
name|pData
operator|->
name|iBackimgwidth
condition|)
block|{
name|iX
operator|=
literal|0
expr_stmt|;
name|pTemp
operator|=
name|pData
operator|->
name|pPrevrow
expr_stmt|;
block|}
block|}
block|}
name|pData
operator|->
name|pRGBArow
operator|=
name|pRGBArow
expr_stmt|;
comment|/* restore original values */
name|pData
operator|->
name|iRow
operator|=
name|iRow
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|iRowsamples
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_BACKIMAGE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_restore_bkgd_backcolor
name|mng_retcode
name|mng_restore_bkgd_backcolor
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint32p
name|pWork32
init|=
operator|(
name|mng_uint32p
operator|)
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_uint32
name|iWrite
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_BACKCOLOR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_BIGENDIAN_SUPPORTED
comment|/* fast way for big endian */
name|iWrite
operator|=
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBACKred
operator|>>
literal|8
argument_list|)
operator|)
operator|<<
literal|24
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBACKgreen
operator|>>
literal|8
argument_list|)
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBACKblue
operator|>>
literal|8
argument_list|)
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
literal|0xFF
operator|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|MNG_LITTLEENDIAN_SUPPORTED
argument_list|)
comment|/* fast way for little endian */
name|iWrite
operator|=
operator|(
literal|0xFF
operator|<<
literal|24
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBACKblue
operator|>>
literal|8
argument_list|)
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBACKgreen
operator|>>
literal|8
argument_list|)
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBACKred
operator|>>
literal|8
argument_list|)
operator|)
operator|)
expr_stmt|;
else|#
directive|else
comment|/* generic way, works on all platforms */
comment|/* put the data in memory in the correct order */
block|{
name|mng_uint8
name|aBytes
index|[
literal|4
index|]
decl_stmt|;
name|aBytes
index|[
literal|0
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBACKred
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|aBytes
index|[
literal|1
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBACKgreen
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|aBytes
index|[
literal|2
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBACKblue
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|aBytes
index|[
literal|3
index|]
operator|=
literal|0xFF
expr_stmt|;
comment|/* load that data into a register */
name|iWrite
operator|=
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|aBytes
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* ok; drop the background-color in there */
for|for
control|(
name|iX
operator|=
operator|(
name|pData
operator|->
name|iSourcer
operator|-
name|pData
operator|->
name|iSourcel
operator|)
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
operator|*
name|pWork32
operator|++
operator|=
name|iWrite
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_BACKCOLOR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_bKGD
end_ifndef
begin_function
DECL|function|mng_restore_bkgd_bkgd
name|mng_retcode
name|mng_restore_bkgd_bkgd
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8p
name|pWork
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_imagep
name|pImage
init|=
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pCurrentobj
decl_stmt|;
name|mng_imagedatap
name|pBuf
init|=
name|pImage
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8
name|iRed
init|=
literal|0
decl_stmt|;
name|mng_uint8
name|iGreen
init|=
literal|0
decl_stmt|;
name|mng_uint8
name|iBlue
init|=
literal|0
decl_stmt|;
name|mng_uint32p
name|pWork32
init|=
operator|(
name|mng_uint32p
operator|)
name|pWork
decl_stmt|;
name|mng_uint32
name|iWrite
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_BKGD
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
switch|switch
condition|(
name|pBuf
operator|->
name|iColortype
condition|)
block|{
case|case
literal|0
case|:
empty_stmt|;
comment|/* gray types */
case|case
literal|4
case|:
block|{
name|mng_uint8
name|iGray
decl_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|>
literal|8
condition|)
name|iGray
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pBuf
operator|->
name|iBKGDgray
operator|>>
literal|8
argument_list|)
expr_stmt|;
else|else
endif|#
directive|endif
block|{
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
comment|/* LBR scaling */
name|mng_uint8
name|multiplier
index|[]
init|=
block|{
literal|0
block|,
literal|255
block|,
literal|85
block|,
literal|0
block|,
literal|17
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|1
block|}
decl_stmt|;
name|iGray
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|multiplier
index|[
name|pBuf
operator|->
name|iBitdepth
index|]
operator|*
name|pBuf
operator|->
name|iBKGDgray
argument_list|)
expr_stmt|;
else|#
directive|else
name|iGray
operator|=
operator|(
name|mng_uint8
operator|)
name|pBuf
operator|->
name|iBKGDgray
expr_stmt|;
endif|#
directive|endif
block|}
name|iRed
operator|=
name|iGray
expr_stmt|;
name|iGreen
operator|=
name|iGray
expr_stmt|;
name|iBlue
operator|=
name|iGray
expr_stmt|;
break|break;
block|}
case|case
literal|3
case|:
block|{
comment|/* indexed type */
name|iRed
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|pBuf
operator|->
name|iBKGDindex
index|]
operator|.
name|iRed
expr_stmt|;
name|iGreen
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|pBuf
operator|->
name|iBKGDindex
index|]
operator|.
name|iGreen
expr_stmt|;
name|iBlue
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|pBuf
operator|->
name|iBKGDindex
index|]
operator|.
name|iBlue
expr_stmt|;
break|break;
block|}
case|case
literal|2
case|:
empty_stmt|;
comment|/* rgb types */
case|case
literal|6
case|:
block|{
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|pBuf
operator|->
name|iBitdepth
operator|>
literal|8
condition|)
block|{
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pBuf
operator|->
name|iBKGDred
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pBuf
operator|->
name|iBKGDgreen
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pBuf
operator|->
name|iBKGDblue
operator|>>
literal|8
argument_list|)
expr_stmt|;
block|}
else|else
endif|#
directive|endif
block|{
name|iRed
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pBuf
operator|->
name|iBKGDred
argument_list|)
expr_stmt|;
name|iGreen
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pBuf
operator|->
name|iBKGDgreen
argument_list|)
expr_stmt|;
name|iBlue
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pBuf
operator|->
name|iBKGDblue
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_BIGENDIAN_SUPPORTED
comment|/* fast way for big endian */
name|iWrite
operator|=
operator|(
name|iRed
operator|<<
literal|24
operator|)
operator||
operator|(
name|iGreen
operator|<<
literal|16
operator|)
operator||
operator|(
name|iBlue
operator|<<
literal|8
operator|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|MNG_LITTLEENDIAN_SUPPORTED
argument_list|)
comment|/* fast way for little endian */
name|iWrite
operator|=
operator|(
name|iBlue
operator|<<
literal|16
operator|)
operator||
operator|(
name|iGreen
operator|<<
literal|8
operator|)
operator||
operator|(
name|iRed
operator|)
expr_stmt|;
else|#
directive|else
comment|/* generic way, works on all platforms */
comment|/* put the data in memory in the correct order */
block|{
name|mng_uint8
name|aBytes
index|[
literal|4
index|]
decl_stmt|;
name|aBytes
index|[
literal|0
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iRed
argument_list|)
expr_stmt|;
name|aBytes
index|[
literal|1
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iGreen
argument_list|)
expr_stmt|;
name|aBytes
index|[
literal|2
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iBlue
argument_list|)
expr_stmt|;
name|aBytes
index|[
literal|3
index|]
operator|=
literal|0x00
expr_stmt|;
comment|/* load that data into a register */
name|iWrite
operator|=
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|aBytes
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* ok; drop it in there */
for|for
control|(
name|iX
operator|=
operator|(
name|pData
operator|->
name|iSourcer
operator|-
name|pData
operator|->
name|iSourcel
operator|)
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
operator|*
name|pWork32
operator|++
operator|=
name|iWrite
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_BKGD
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_restore_bkgd_bgcolor
name|mng_retcode
name|mng_restore_bkgd_bgcolor
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint32p
name|pWork32
init|=
operator|(
name|mng_uint32p
operator|)
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_uint32
name|iWrite
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_BGCOLOR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_BIGENDIAN_SUPPORTED
comment|/* fast way for big endian */
name|iWrite
operator|=
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBGred
operator|>>
literal|8
argument_list|)
operator|)
operator|<<
literal|24
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBGgreen
operator|>>
literal|8
argument_list|)
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBGblue
operator|>>
literal|8
argument_list|)
operator|)
operator|<<
literal|8
operator|)
expr_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|MNG_LITTLEENDIAN_SUPPORTED
argument_list|)
comment|/* fast way for little endian */
name|iWrite
operator|=
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBGblue
operator|>>
literal|8
argument_list|)
operator|)
operator|<<
literal|16
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBGgreen
operator|>>
literal|8
argument_list|)
operator|)
operator|<<
literal|8
operator|)
operator||
operator|(
operator|(
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBGred
operator|>>
literal|8
argument_list|)
operator|)
operator|)
expr_stmt|;
else|#
directive|else
comment|/* generic way, works on all platforms */
comment|/* put the data in memory in the correct order */
block|{
name|mng_uint8
name|aBytes
index|[
literal|4
index|]
decl_stmt|;
name|aBytes
index|[
literal|0
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBGred
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|aBytes
index|[
literal|1
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBGgreen
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|aBytes
index|[
literal|2
index|]
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|pData
operator|->
name|iBGblue
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|aBytes
index|[
literal|3
index|]
operator|=
literal|0x00
expr_stmt|;
comment|/* load that data into a register */
name|iWrite
operator|=
operator|*
operator|(
name|mng_uint32
operator|*
operator|)
name|aBytes
expr_stmt|;
block|}
endif|#
directive|endif
comment|/* ok; drop the background-color in there */
for|for
control|(
name|iX
operator|=
operator|(
name|pData
operator|->
name|iSourcer
operator|-
name|pData
operator|->
name|iSourcel
operator|)
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
operator|*
name|pWork32
operator|++
operator|=
name|iWrite
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_BGCOLOR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_RGB8
end_ifndef
begin_function
DECL|function|mng_restore_bkgd_rgb8
name|mng_retcode
name|mng_restore_bkgd_rgb8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8p
name|pBkgd
decl_stmt|;
name|mng_uint8p
name|pWork
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_RGB8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fGetbkgdline
condition|)
comment|/* can we access the background ? */
block|{
comment|/* point to the right pixel then */
name|pBkgd
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetbkgdline
argument_list|(
operator|(
name|mng_handle
operator|)
name|pData
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
argument_list|)
operator|+
operator|(
literal|3
operator|*
name|pData
operator|->
name|iDestl
operator|)
expr_stmt|;
for|for
control|(
name|iX
operator|=
operator|(
name|pData
operator|->
name|iSourcer
operator|-
name|pData
operator|->
name|iSourcel
operator|)
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
block|{
operator|*
name|pWork
operator|=
operator|*
name|pBkgd
expr_stmt|;
comment|/* ok; copy the pixel */
operator|*
operator|(
name|pWork
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pBkgd
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pWork
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pBkgd
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pWork
operator|+
literal|3
operator|)
operator|=
literal|0x00
expr_stmt|;
comment|/* transparant for alpha-canvasses */
name|pWork
operator|+=
literal|4
expr_stmt|;
name|pBkgd
operator|+=
literal|3
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_RGB8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_RGB8 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_BGR8
end_ifndef
begin_function
DECL|function|mng_restore_bkgd_bgr8
name|mng_retcode
name|mng_restore_bkgd_bgr8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8p
name|pBkgd
decl_stmt|;
name|mng_uint8p
name|pWork
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_BGR8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fGetbkgdline
condition|)
comment|/* can we access the background ? */
block|{
comment|/* point to the right pixel then */
name|pBkgd
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetbkgdline
argument_list|(
operator|(
name|mng_handle
operator|)
name|pData
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
argument_list|)
operator|+
operator|(
literal|3
operator|*
name|pData
operator|->
name|iDestl
operator|)
expr_stmt|;
for|for
control|(
name|iX
operator|=
operator|(
name|pData
operator|->
name|iSourcer
operator|-
name|pData
operator|->
name|iSourcel
operator|)
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
block|{
operator|*
name|pWork
operator|=
operator|*
operator|(
name|pBkgd
operator|+
literal|2
operator|)
expr_stmt|;
comment|/* ok; copy the pixel */
operator|*
operator|(
name|pWork
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pBkgd
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pWork
operator|+
literal|2
operator|)
operator|=
operator|*
name|pBkgd
expr_stmt|;
operator|*
operator|(
name|pWork
operator|+
literal|3
operator|)
operator|=
literal|0x00
expr_stmt|;
comment|/* transparant for alpha-canvasses */
name|pWork
operator|+=
literal|4
expr_stmt|;
name|pBkgd
operator|+=
literal|3
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_BGR8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_BGR8 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_BGRX8
end_ifndef
begin_function
DECL|function|mng_restore_bkgd_bgrx8
name|mng_retcode
name|mng_restore_bkgd_bgrx8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8p
name|pBkgd
decl_stmt|;
name|mng_uint8p
name|pWork
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_BGRX8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fGetbkgdline
condition|)
comment|/* can we access the background ? */
block|{
comment|/* point to the right pixel then */
name|pBkgd
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetbkgdline
argument_list|(
operator|(
name|mng_handle
operator|)
name|pData
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
argument_list|)
operator|+
operator|(
literal|3
operator|*
name|pData
operator|->
name|iDestl
operator|)
expr_stmt|;
for|for
control|(
name|iX
operator|=
operator|(
name|pData
operator|->
name|iSourcer
operator|-
name|pData
operator|->
name|iSourcel
operator|)
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
block|{
operator|*
name|pWork
operator|=
operator|*
operator|(
name|pBkgd
operator|+
literal|2
operator|)
expr_stmt|;
comment|/* ok; copy the pixel */
operator|*
operator|(
name|pWork
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pBkgd
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pWork
operator|+
literal|2
operator|)
operator|=
operator|*
name|pBkgd
expr_stmt|;
operator|*
operator|(
name|pWork
operator|+
literal|3
operator|)
operator|=
literal|0x00
expr_stmt|;
comment|/* transparant for alpha-canvasses */
name|pWork
operator|+=
literal|4
expr_stmt|;
name|pBkgd
operator|+=
literal|4
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_BGRX8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_BGRX8 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_BGR565
end_ifndef
begin_function
DECL|function|mng_restore_bkgd_bgr565
name|mng_retcode
name|mng_restore_bkgd_bgr565
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8p
name|pBkgd
decl_stmt|;
name|mng_uint8p
name|pWork
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_BGR565
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fGetbkgdline
condition|)
comment|/* can we access the background ? */
block|{
comment|/* point to the right pixel then */
name|pBkgd
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetbkgdline
argument_list|(
operator|(
name|mng_handle
operator|)
name|pData
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
argument_list|)
operator|+
operator|(
literal|3
operator|*
name|pData
operator|->
name|iDestl
operator|)
expr_stmt|;
for|for
control|(
name|iX
operator|=
operator|(
name|pData
operator|->
name|iSourcer
operator|-
name|pData
operator|->
name|iSourcel
operator|)
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
block|{
operator|*
name|pWork
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pBkgd
operator|+
literal|1
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
comment|/* ok; copy the pixel */
operator|*
operator|(
name|pWork
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pBkgd
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pBkgd
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pWork
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pBkgd
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pWork
operator|+
literal|3
operator|)
operator|=
literal|0x00
expr_stmt|;
comment|/* transparant for alpha-canvasses */
name|pWork
operator|+=
literal|4
expr_stmt|;
name|pBkgd
operator|+=
literal|2
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_BGR565
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_BGR565 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCANVAS_RGB565
end_ifndef
begin_function
DECL|function|mng_restore_bkgd_rgb565
name|mng_retcode
name|mng_restore_bkgd_rgb565
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8p
name|pBkgd
decl_stmt|;
name|mng_uint8p
name|pWork
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_RGB565
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fGetbkgdline
condition|)
comment|/* can we access the background ? */
block|{
comment|/* point to the right pixel then */
name|pBkgd
operator|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|fGetbkgdline
argument_list|(
operator|(
name|mng_handle
operator|)
name|pData
argument_list|,
name|pData
operator|->
name|iRow
operator|+
name|pData
operator|->
name|iDestt
argument_list|)
operator|+
operator|(
literal|3
operator|*
name|pData
operator|->
name|iDestl
operator|)
expr_stmt|;
for|for
control|(
name|iX
operator|=
operator|(
name|pData
operator|->
name|iSourcer
operator|-
name|pData
operator|->
name|iSourcel
operator|)
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
block|{
operator|*
name|pWork
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pBkgd
operator|)
operator|&
literal|0xF8
argument_list|)
expr_stmt|;
comment|/* ok; copy the pixel */
operator|*
operator|(
name|pWork
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
operator|(
name|pBkgd
operator|+
literal|1
operator|)
operator|<<
literal|5
operator|)
operator||
operator|(
operator|(
operator|(
operator|*
name|pBkgd
operator|)
operator|&
literal|0xE0
operator|)
operator|>>
literal|3
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pWork
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pBkgd
operator|+
literal|1
operator|)
operator|<<
literal|3
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pWork
operator|+
literal|3
operator|)
operator|=
literal|0x00
expr_stmt|;
comment|/* transparant for alpha-canvasses */
name|pWork
operator|+=
literal|4
expr_stmt|;
name|pBkgd
operator|+=
literal|2
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RESTORE_RGB565
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCANVAS_RBB565 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Row retrieval routines - retrieve processed& uncompressed row-data    * */
end_comment
begin_comment
comment|/* * from the current "object"                                              * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* TODO: a serious optimization is to retrieve only those pixels that will          actually be displayed; this would require changes in          the "display_image" routine (in mng_display.c)&          all the "retrieve_xxx" routines below&          the "display_xxx" routines above !!!!!          NOTE that "correct_xxx" routines would not require modification */
end_comment
begin_function
DECL|function|mng_retrieve_g8
name|mng_retcode
name|mng_retrieve_g8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pRetrieveobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iG
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_G8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|bHasTRNS
condition|)
comment|/* tRNS in buffer ? */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iG
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get the gray-value */
comment|/* is it transparent ? */
if|if
condition|(
operator|(
name|mng_uint16
operator|)
name|iG
operator|==
name|pBuf
operator|->
name|iTRNSgray
condition|)
block|{
operator|*
name|pRGBArow
operator|=
literal|0x00
expr_stmt|;
comment|/* nuttin to display */
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
literal|0x00
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
literal|0x00
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0x00
expr_stmt|;
block|}
else|else
block|{
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
name|mng_uint8
name|multiplier
index|[]
init|=
block|{
literal|0
block|,
literal|255
block|,
literal|85
block|,
literal|0
block|,
literal|17
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|1
block|}
decl_stmt|;
name|iG
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iG
operator|*
name|multiplier
index|[
name|pBuf
operator|->
name|iBitdepth
index|]
argument_list|)
expr_stmt|;
endif|#
directive|endif
operator|*
name|pRGBArow
operator|=
name|iG
expr_stmt|;
comment|/* put in intermediate row */
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
name|iG
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
name|iG
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
block|}
name|pWorkrow
operator|++
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
block|}
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
name|mng_uint8
name|multiplier
index|[]
init|=
block|{
literal|0
block|,
literal|255
block|,
literal|85
block|,
literal|0
block|,
literal|17
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|1
block|}
decl_stmt|;
comment|/* LBR scaling */
name|iG
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|multiplier
index|[
name|pBuf
operator|->
name|iBitdepth
index|]
operator|*
operator|*
name|pWorkrow
argument_list|)
expr_stmt|;
else|#
directive|else
name|iG
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get the gray-value */
endif|#
directive|endif
operator|*
name|pRGBArow
operator|=
name|iG
expr_stmt|;
comment|/* put in intermediate row */
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
name|iG
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
name|iG
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_G8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_retrieve_g16
name|mng_retcode
name|mng_retrieve_g16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pRetrieveobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iG
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_G16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pWorkrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|bHasTRNS
condition|)
comment|/* tRNS in buffer ? */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iG
operator|=
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
expr_stmt|;
comment|/* get the gray-value */
comment|/* is it transparent ? */
if|if
condition|(
name|iG
operator|==
name|pBuf
operator|->
name|iTRNSgray
condition|)
block|{
comment|/* nuttin to display */
name|mng_put_uint16
argument_list|(
name|pRGBArow
argument_list|,
literal|0x0000
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|2
argument_list|,
literal|0x0000
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|4
argument_list|,
literal|0x0000
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|6
argument_list|,
literal|0x0000
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* put in intermediate row */
name|mng_put_uint16
argument_list|(
name|pRGBArow
argument_list|,
name|iG
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|2
argument_list|,
name|iG
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|4
argument_list|,
name|iG
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|6
argument_list|,
literal|0xFFFF
argument_list|)
expr_stmt|;
block|}
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iG
operator|=
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
expr_stmt|;
comment|/* get the gray-value */
name|mng_put_uint16
argument_list|(
name|pRGBArow
argument_list|,
name|iG
argument_list|)
expr_stmt|;
comment|/* and put in intermediate row */
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|2
argument_list|,
name|iG
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|4
argument_list|,
name|iG
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|6
argument_list|,
literal|0xFFFF
argument_list|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|8
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_G16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_retrieve_rgb8
name|mng_retcode
name|mng_retrieve_rgb8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pRetrieveobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iR
decl_stmt|,
name|iG
decl_stmt|,
name|iB
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_RGB8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|bHasTRNS
condition|)
comment|/* tRNS in buffer ? */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iR
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get the rgb-values */
name|iG
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
name|iB
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
expr_stmt|;
comment|/* is it transparent ? */
if|if
condition|(
operator|(
operator|(
name|mng_uint16
operator|)
name|iR
operator|==
name|pBuf
operator|->
name|iTRNSred
operator|)
operator|&&
operator|(
operator|(
name|mng_uint16
operator|)
name|iG
operator|==
name|pBuf
operator|->
name|iTRNSgreen
operator|)
operator|&&
operator|(
operator|(
name|mng_uint16
operator|)
name|iB
operator|==
name|pBuf
operator|->
name|iTRNSblue
operator|)
condition|)
block|{
operator|*
name|pRGBArow
operator|=
literal|0x00
expr_stmt|;
comment|/* nothing to display */
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
literal|0x00
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
literal|0x00
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0x00
expr_stmt|;
block|}
else|else
block|{
operator|*
name|pRGBArow
operator|=
name|iR
expr_stmt|;
comment|/* put in intermediate row */
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
name|iG
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
block|}
name|pWorkrow
operator|+=
literal|3
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
block|}
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pRGBArow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* just copy the pixel */
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
name|pWorkrow
operator|+=
literal|3
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_RGB8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_retrieve_rgb16
name|mng_retcode
name|mng_retrieve_rgb16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pRetrieveobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iR
decl_stmt|,
name|iG
decl_stmt|,
name|iB
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_RGB16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pWorkrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|bHasTRNS
condition|)
comment|/* tRNS in buffer ? */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iR
operator|=
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
expr_stmt|;
comment|/* get the rgb-values */
name|iG
operator|=
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iB
operator|=
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* is it transparent ? */
if|if
condition|(
operator|(
name|iR
operator|==
name|pBuf
operator|->
name|iTRNSred
operator|)
operator|&&
operator|(
name|iG
operator|==
name|pBuf
operator|->
name|iTRNSgreen
operator|)
operator|&&
operator|(
name|iB
operator|==
name|pBuf
operator|->
name|iTRNSblue
operator|)
condition|)
block|{
comment|/* nothing to display */
name|mng_put_uint16
argument_list|(
name|pRGBArow
argument_list|,
literal|0x0000
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|2
argument_list|,
literal|0x0000
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|4
argument_list|,
literal|0x0000
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|6
argument_list|,
literal|0x0000
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* put in intermediate row */
name|mng_put_uint16
argument_list|(
name|pRGBArow
argument_list|,
name|iR
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|2
argument_list|,
name|iG
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|4
argument_list|,
name|iB
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|6
argument_list|,
literal|0xFFFF
argument_list|)
expr_stmt|;
block|}
name|pWorkrow
operator|+=
literal|6
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
comment|/* just copy the pixel */
name|mng_put_uint16
argument_list|(
name|pRGBArow
argument_list|,
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|2
argument_list|,
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|4
argument_list|,
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|6
argument_list|,
literal|0xFFFF
argument_list|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|6
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|8
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_RGB16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_retrieve_idx8
name|mng_retcode
name|mng_retrieve_idx8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pRetrieveobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iQ
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_IDX8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|bHasTRNS
condition|)
comment|/* tRNS in buffer ? */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iQ
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get the index */
comment|/* is it valid ? */
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iQ
operator|<
name|pBuf
operator|->
name|iPLTEcount
condition|)
block|{
comment|/* put in intermediate row */
operator|*
name|pRGBArow
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iRed
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iGreen
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iBlue
expr_stmt|;
comment|/* transparency for this index ? */
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iQ
operator|<
name|pBuf
operator|->
name|iTRNScount
condition|)
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
name|pBuf
operator|->
name|aTRNSentries
index|[
name|iQ
index|]
expr_stmt|;
else|else
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
block|}
else|else
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_PLTEINDEXERROR
argument_list|)
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
block|}
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iQ
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get the index */
comment|/* is it valid ? */
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iQ
operator|<
name|pBuf
operator|->
name|iPLTEcount
condition|)
block|{
comment|/* put in intermediate row */
operator|*
name|pRGBArow
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iRed
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iGreen
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iBlue
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
block|}
else|else
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_PLTEINDEXERROR
argument_list|)
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_IDX8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_retrieve_ga8
name|mng_retcode
name|mng_retrieve_ga8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pRetrieveobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iG
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_GA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iG
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get the gray-value */
operator|*
name|pRGBArow
operator|=
name|iG
expr_stmt|;
comment|/* put in intermediate row */
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
name|iG
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
name|iG
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_GA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_retrieve_ga16
name|mng_retcode
name|mng_retrieve_ga16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pRetrieveobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iG
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_GA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pWorkrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iG
operator|=
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
expr_stmt|;
comment|/* get the gray-value */
name|mng_put_uint16
argument_list|(
name|pRGBArow
argument_list|,
name|iG
argument_list|)
expr_stmt|;
comment|/* and put in intermediate row */
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|2
argument_list|,
name|iG
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|4
argument_list|,
name|iG
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|6
argument_list|,
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|8
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_GA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_retrieve_rgba8
name|mng_retcode
name|mng_retrieve_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pRetrieveobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
expr_stmt|;
comment|/* can't be easier than this ! */
name|MNG_COPY
argument_list|(
name|pRGBArow
argument_list|,
name|pWorkrow
argument_list|,
name|pBuf
operator|->
name|iRowsize
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_retrieve_rgba16
name|mng_retcode
name|mng_retrieve_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pRetrieveobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pWorkrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
expr_stmt|;
comment|/* can't be easier than this ! */
name|MNG_COPY
argument_list|(
name|pRGBArow
argument_list|,
name|pWorkrow
argument_list|,
name|pBuf
operator|->
name|iRowsize
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_RETRIEVE_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Row storage routines - store processed& uncompressed row-data         * */
end_comment
begin_comment
comment|/* * into the current "object"                                              * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_store_g1
name|mng_retcode
name|mng_store_g1
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_G1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0x80
expr_stmt|;
block|}
if|if
condition|(
name|iB
operator|&
name|iM
condition|)
comment|/* is it white ? */
operator|*
name|pOutrow
operator|=
literal|0x01
expr_stmt|;
comment|/* white */
else|else
operator|*
name|pOutrow
operator|=
literal|0x00
expr_stmt|;
comment|/* black */
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|1
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_G1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_g2
name|mng_retcode
name|mng_store_g2
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
name|mng_uint8
name|iQ
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_G2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xC0
expr_stmt|;
name|iS
operator|=
literal|6
expr_stmt|;
block|}
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
comment|/* get the gray level */
operator|*
name|pOutrow
operator|=
name|iQ
expr_stmt|;
comment|/* put in object buffer */
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|2
expr_stmt|;
name|iS
operator|-=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_G2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_g4
name|mng_retcode
name|mng_store_g4
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
name|mng_uint8
name|iQ
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_G4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xF0
expr_stmt|;
name|iS
operator|=
literal|4
expr_stmt|;
block|}
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
comment|/* get the gray level */
operator|*
name|pOutrow
operator|=
name|iQ
expr_stmt|;
comment|/* put in object buffer */
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|4
expr_stmt|;
name|iS
operator|-=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_G4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_g8
name|mng_retcode
name|mng_store_g8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_G8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* put in object buffer */
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_G8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_store_g16
name|mng_retcode
name|mng_store_g16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_G16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
comment|/* copy into object buffer */
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|1
operator|)
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_G16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_rgb8
name|mng_retcode
name|mng_store_rgb8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_RGB8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* copy the RGB bytes */
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|3
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_RGB8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_store_rgb16
name|mng_retcode
name|mng_store_rgb16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_RGB16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|MNG_COPY
argument_list|(
name|pOutrow
argument_list|,
name|pWorkrow
argument_list|,
literal|6
argument_list|)
expr_stmt|;
comment|/* copy the RGB bytes */
name|pWorkrow
operator|+=
literal|6
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|6
operator|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_RGB16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_store_idx1
name|mng_retcode
name|mng_store_idx1
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_IDX1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0x80
expr_stmt|;
block|}
if|if
condition|(
name|iB
operator|&
name|iM
condition|)
comment|/* store the index */
operator|*
name|pOutrow
operator|=
literal|0x01
expr_stmt|;
else|else
operator|*
name|pOutrow
operator|=
literal|0x00
expr_stmt|;
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|1
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_IDX1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_idx2
name|mng_retcode
name|mng_store_idx2
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_IDX2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xC0
expr_stmt|;
name|iS
operator|=
literal|6
expr_stmt|;
block|}
comment|/* store the index */
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|2
expr_stmt|;
name|iS
operator|-=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_IDX2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_idx4
name|mng_retcode
name|mng_store_idx4
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_IDX4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xF0
expr_stmt|;
name|iS
operator|=
literal|4
expr_stmt|;
block|}
comment|/* store the index */
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|4
expr_stmt|;
name|iS
operator|-=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_IDX4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_idx8
name|mng_retcode
name|mng_store_idx8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_IDX8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* put in object buffer */
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_IDX8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_ga8
name|mng_retcode
name|mng_store_ga8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_GA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* copy the GA bytes */
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|1
operator|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_GA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_store_ga16
name|mng_retcode
name|mng_store_ga16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_GA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|MNG_COPY
argument_list|(
name|pOutrow
argument_list|,
name|pWorkrow
argument_list|,
literal|4
argument_list|)
expr_stmt|;
comment|/* copy the GA bytes */
name|pWorkrow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_GA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_rgba8
name|mng_retcode
name|mng_store_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* copy the RGBA bytes */
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|3
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_store_rgba16
name|mng_retcode
name|mng_store_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|MNG_COPY
argument_list|(
name|pOutrow
argument_list|,
name|pWorkrow
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|/* copy the RGBA bytes */
name|pWorkrow
operator|+=
literal|8
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|3
operator|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Row storage routines (JPEG) - store processed& uncompressed row-data  * */
end_comment
begin_comment
comment|/* * into the current "object"                                              * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
end_ifdef
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_jpeg_g8
name|mng_retcode
name|mng_store_jpeg_g8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pJPEGrow
expr_stmt|;
comment|/* temporary work pointers */
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iJPEGrow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
expr_stmt|;
comment|/* easy as pie ... */
name|MNG_COPY
argument_list|(
name|pOutrow
argument_list|,
name|pWorkrow
argument_list|,
name|pData
operator|->
name|iRowsamples
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_next_jpeg_row
argument_list|(
name|pData
argument_list|)
return|;
comment|/* we've got one more row of gray-samples */
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_jpeg_rgb8
name|mng_retcode
name|mng_store_jpeg_rgb8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
if|#
directive|if
name|RGB_PIXELSIZE
operator|!=
literal|3
name|mng_int32
name|iX
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_RGB8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pJPEGrow
expr_stmt|;
comment|/* temporary work pointers */
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iJPEGrow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
expr_stmt|;
if|#
directive|if
name|RGB_PIXELSIZE
operator|==
literal|3
comment|/* easy as pie ... */
name|MNG_COPY
argument_list|(
name|pOutrow
argument_list|,
name|pWorkrow
argument_list|,
name|pData
operator|->
name|iRowsamples
operator|*
literal|3
argument_list|)
expr_stmt|;
else|#
directive|else
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* copy pixel into object buffer */
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
expr_stmt|;
name|pOutrow
operator|+=
literal|3
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|+=
name|RGB_PIXELSIZE
expr_stmt|;
block|}
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_RGB8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_next_jpeg_row
argument_list|(
name|pData
argument_list|)
return|;
comment|/* we've got one more row of rgb-samples */
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_jpeg_ga8
name|mng_retcode
name|mng_store_jpeg_ga8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_GA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pJPEGrow
expr_stmt|;
comment|/* temporary work pointers */
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iJPEGrow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* copy into object buffer */
name|pOutrow
operator|+=
literal|2
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_GA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_next_jpeg_row
argument_list|(
name|pData
argument_list|)
return|;
comment|/* we've got one more row of gray-samples */
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_jpeg_rgba8
name|mng_retcode
name|mng_store_jpeg_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pJPEGrow
expr_stmt|;
comment|/* temporary work pointers */
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iJPEGrow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* copy pixel into object buffer */
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
expr_stmt|;
name|pOutrow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|+=
name|RGB_PIXELSIZE
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_next_jpeg_row
argument_list|(
name|pData
argument_list|)
return|;
comment|/* we've got one more row of rgb-samples */
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_jpeg_g8_alpha
name|mng_retcode
name|mng_store_jpeg_g8_alpha
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G8_ALPHA
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pJPEGrow2
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iJPEGalpharow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
literal|1
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* put in object buffer */
name|pOutrow
operator|+=
literal|2
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G8_ALPHA
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* we've got one more row of alpha-samples */
return|return
name|mng_next_jpeg_alpharow
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_jpeg_rgb8_alpha
name|mng_retcode
name|mng_store_jpeg_rgb8_alpha
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_RGB8_ALPHA
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pJPEGrow2
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iJPEGalpharow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
literal|3
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* put in object buffer */
name|pOutrow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_RGB8_ALPHA
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* we've got one more row of alpha-samples */
return|return
name|mng_next_jpeg_alpharow
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_store_jpeg_g8_a1
name|mng_retcode
name|mng_store_jpeg_g8_a1
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G8_A1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
literal|1
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0x80
expr_stmt|;
block|}
if|if
condition|(
name|iB
operator|&
name|iM
condition|)
comment|/* is it opaque ? */
operator|*
name|pOutrow
operator|=
literal|0xFF
expr_stmt|;
comment|/* opaque */
else|else
operator|*
name|pOutrow
operator|=
literal|0x00
expr_stmt|;
comment|/* transparent */
name|pOutrow
operator|+=
literal|2
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|1
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G8_A1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* we've got one more row of alpha-samples */
return|return
name|mng_next_jpeg_alpharow
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_jpeg_g8_a2
name|mng_retcode
name|mng_store_jpeg_g8_a2
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G8_A2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
literal|1
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xC0
expr_stmt|;
name|iS
operator|=
literal|6
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_SWITCH
block|{
specifier|const
name|mng_uint8
name|alpha_level
index|[
literal|4
index|]
init|=
block|{
literal|0x00
block|,
literal|0x55
block|,
literal|0xAA
block|,
literal|0xFF
block|}
decl_stmt|;
operator|*
name|pOutrow
operator|=
name|alpha_level
index|[
operator|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
operator|)
index|]
expr_stmt|;
block|}
else|#
directive|else
switch|switch
condition|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
condition|)
comment|/* determine the alpha level */
block|{
case|case
literal|0x03
case|:
block|{
operator|*
name|pOutrow
operator|=
literal|0xFF
expr_stmt|;
break|break;
block|}
case|case
literal|0x02
case|:
block|{
operator|*
name|pOutrow
operator|=
literal|0xAA
expr_stmt|;
break|break;
block|}
case|case
literal|0x01
case|:
block|{
operator|*
name|pOutrow
operator|=
literal|0x55
expr_stmt|;
break|break;
block|}
default|default   :
block|{
operator|*
name|pOutrow
operator|=
literal|0x00
expr_stmt|;
block|}
block|}
endif|#
directive|endif
name|pOutrow
operator|+=
literal|2
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|2
expr_stmt|;
name|iS
operator|-=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G8_A2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* we've got one more row of alpha-samples */
return|return
name|mng_next_jpeg_alpharow
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_jpeg_g8_a4
name|mng_retcode
name|mng_store_jpeg_g8_a4
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
name|mng_uint8
name|iQ
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G8_A4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
literal|1
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xF0
expr_stmt|;
name|iS
operator|=
literal|4
expr_stmt|;
block|}
comment|/* get the alpha level */
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iQ
operator|+
operator|(
name|iQ
operator|<<
literal|4
operator|)
argument_list|)
expr_stmt|;
comment|/* expand to 8-bit by replication */
operator|*
name|pOutrow
operator|=
name|iQ
expr_stmt|;
comment|/* put in object buffer */
name|pOutrow
operator|+=
literal|2
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|4
expr_stmt|;
name|iS
operator|-=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G8_A4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* we've got one more row of alpha-samples */
return|return
name|mng_next_jpeg_alpharow
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_jpeg_g8_a8
name|mng_retcode
name|mng_store_jpeg_g8_a8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G8_A8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
literal|1
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* put in object buffer */
name|pOutrow
operator|+=
literal|2
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G8_A8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* we've got one more row of alpha-samples */
return|return
name|mng_next_jpeg_alpharow
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_store_jpeg_g8_a16
name|mng_retcode
name|mng_store_jpeg_g8_a16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G8_A16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
literal|1
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* only high-order byte! */
name|pOutrow
operator|+=
literal|2
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G8_A16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* we've got one more row of alpha-samples */
return|return
name|mng_next_jpeg_alpharow
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_store_jpeg_rgb8_a1
name|mng_retcode
name|mng_store_jpeg_rgb8_a1
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_RGB8_A1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
literal|3
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0x80
expr_stmt|;
block|}
if|if
condition|(
name|iB
operator|&
name|iM
condition|)
comment|/* is it opaque ? */
operator|*
name|pOutrow
operator|=
literal|0xFF
expr_stmt|;
comment|/* opaque */
else|else
operator|*
name|pOutrow
operator|=
literal|0x00
expr_stmt|;
comment|/* transparent */
name|pOutrow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|1
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_RGB8_A1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* we've got one more row of alpha-samples */
return|return
name|mng_next_jpeg_alpharow
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_jpeg_rgb8_a2
name|mng_retcode
name|mng_store_jpeg_rgb8_a2
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_RGB8_A2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
literal|3
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xC0
expr_stmt|;
name|iS
operator|=
literal|6
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_SWITCH
block|{
specifier|const
name|mng_uint8
name|alpha_level
index|[
literal|4
index|]
init|=
block|{
literal|0x00
block|,
literal|0x55
block|,
literal|0xAA
block|,
literal|0xFF
block|}
decl_stmt|;
operator|*
name|pOutrow
operator|=
name|alpha_level
index|[
operator|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
operator|)
index|]
expr_stmt|;
block|}
else|#
directive|else
switch|switch
condition|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
condition|)
comment|/* determine the alpha level */
block|{
case|case
literal|0x03
case|:
block|{
operator|*
name|pOutrow
operator|=
literal|0xFF
expr_stmt|;
break|break;
block|}
case|case
literal|0x02
case|:
block|{
operator|*
name|pOutrow
operator|=
literal|0xAA
expr_stmt|;
break|break;
block|}
case|case
literal|0x01
case|:
block|{
operator|*
name|pOutrow
operator|=
literal|0x55
expr_stmt|;
break|break;
block|}
default|default   :
block|{
operator|*
name|pOutrow
operator|=
literal|0x00
expr_stmt|;
block|}
block|}
endif|#
directive|endif
name|pOutrow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|2
expr_stmt|;
name|iS
operator|-=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_RGB8_A2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* we've got one more row of alpha-samples */
return|return
name|mng_next_jpeg_alpharow
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_jpeg_rgb8_a4
name|mng_retcode
name|mng_store_jpeg_rgb8_a4
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
name|mng_uint8
name|iQ
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_RGB8_A4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
literal|3
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xF0
expr_stmt|;
name|iS
operator|=
literal|4
expr_stmt|;
block|}
comment|/* get the alpha level */
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iQ
operator|+
operator|(
name|iQ
operator|<<
literal|4
operator|)
argument_list|)
expr_stmt|;
comment|/* expand to 8-bit by replication */
operator|*
name|pOutrow
operator|=
name|iQ
expr_stmt|;
comment|/* put in object buffer */
name|pOutrow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|4
expr_stmt|;
name|iS
operator|-=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_RGB8_A4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* we've got one more row of alpha-samples */
return|return
name|mng_next_jpeg_alpharow
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_store_jpeg_rgb8_a8
name|mng_retcode
name|mng_store_jpeg_rgb8_a8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_RGB8_A8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
literal|3
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* put in buffer */
name|pOutrow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_RGB8_A8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* we've got one more row of alpha-samples */
return|return
name|mng_next_jpeg_alpharow
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_store_jpeg_rgb8_a16
name|mng_retcode
name|mng_store_jpeg_rgb8_a16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_RGB8_A16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
literal|3
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* only high-order byte */
name|pOutrow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_RGB8_A16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* we've got one more row of alpha-samples */
return|return
name|mng_next_jpeg_alpharow
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_JPEG12
end_ifdef
begin_function
DECL|function|mng_store_jpeg_g12_a1
name|mng_retcode
name|mng_store_jpeg_g12_a1
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G12_A1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
literal|2
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0x80
expr_stmt|;
block|}
if|if
condition|(
name|iB
operator|&
name|iM
condition|)
comment|/* opaque ? */
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
literal|0xFFFF
argument_list|)
expr_stmt|;
comment|/* opaque */
else|else
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
literal|0x0000
argument_list|)
expr_stmt|;
comment|/* transparent */
name|pOutrow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|1
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G12_A1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* we've got one more row of alpha-samples */
return|return
name|mng_next_jpeg_alpharow
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_JPEG12 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_JPEG12
end_ifdef
begin_function
DECL|function|mng_store_jpeg_g12_a2
name|mng_retcode
name|mng_store_jpeg_g12_a2
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G12_A2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
literal|2
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xC0
expr_stmt|;
name|iS
operator|=
literal|6
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_SWITCH
block|{
specifier|const
name|mng_uint16
name|gray_level
index|[
literal|4
index|]
init|=
block|{
literal|0x0000
block|,
literal|0x5555
block|,
literal|0xAAAA
block|,
literal|0xFFFF
block|}
decl_stmt|;
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
name|gray_level
index|[
operator|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
operator|)
index|]
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
switch|switch
condition|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
condition|)
comment|/* determine the gray level */
block|{
case|case
literal|0x03
case|:
block|{
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
literal|0xFFFF
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
literal|0x02
case|:
block|{
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
literal|0xAAAA
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
literal|0x01
case|:
block|{
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
literal|0x5555
argument_list|)
expr_stmt|;
break|break;
block|}
default|default   :
block|{
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
literal|0x0000
argument_list|)
expr_stmt|;
block|}
block|}
endif|#
directive|endif
name|pOutrow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|2
expr_stmt|;
name|iS
operator|-=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G12_A2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* we've got one more row of alpha-samples */
return|return
name|mng_next_jpeg_alpharow
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_JPEG12 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_JPEG12
end_ifdef
begin_function
DECL|function|mng_store_jpeg_g12_a4
name|mng_retcode
name|mng_store_jpeg_g12_a4
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
name|mng_uint16
name|iQ
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G12_A4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
literal|2
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xF0
expr_stmt|;
name|iS
operator|=
literal|4
expr_stmt|;
block|}
comment|/* get the gray level */
name|iQ
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
name|iQ
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iQ
operator|+
operator|(
name|iQ
operator|<<
literal|4
operator|)
argument_list|)
expr_stmt|;
comment|/* expand to 16-bit by replication */
name|iQ
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iQ
operator|+
operator|(
name|iQ
operator|<<
literal|8
operator|)
argument_list|)
expr_stmt|;
comment|/* put in object buffer */
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
name|iQ
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|4
expr_stmt|;
name|iS
operator|-=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G12_A4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* we've got one more row of alpha-samples */
return|return
name|mng_next_jpeg_alpharow
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_JPEG12 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_JPEG12
end_ifdef
begin_function
DECL|function|mng_store_jpeg_g12_a8
name|mng_retcode
name|mng_store_jpeg_g12_a8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iW
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G12_A8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
literal|2
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iW
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
operator|*
name|pWorkrow
argument_list|)
expr_stmt|;
comment|/* get input byte */
name|iW
operator|=
call|(
name|mng_uint16
call|)
argument_list|(
name|iW
operator|+
operator|(
name|iW
operator|<<
literal|8
operator|)
argument_list|)
expr_stmt|;
comment|/* expand to 16-bit by replication */
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
name|iW
argument_list|)
expr_stmt|;
comment|/* put in object buffer */
name|pOutrow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G12_A8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* we've got one more row of alpha-samples */
return|return
name|mng_next_jpeg_alpharow
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_JPEG12 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_JPEG12
end_ifdef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_store_jpeg_g12_a16
name|mng_retcode
name|mng_store_jpeg_g12_a16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G12_A16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
literal|2
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
comment|/* copy it */
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_STORE_JPEG_G12_A16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* we've got one more row of alpha-samples */
return|return
name|mng_next_jpeg_alpharow
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_JPEG12 */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_INCLUDE_JNG */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Delta-image row routines - apply the processed& uncompressed row-data * */
end_comment
begin_comment
comment|/* * onto the target "object"                                               * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_delta_g1
name|mng_retcode
name|mng_delta_g1
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pDeltaImage
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlocky
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlockx
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
comment|/* pixel replace ? */
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0x80
expr_stmt|;
block|}
if|if
condition|(
name|iB
operator|&
name|iM
condition|)
comment|/* is it white ? */
operator|*
name|pOutrow
operator|=
literal|0xFF
expr_stmt|;
comment|/* white */
else|else
operator|*
name|pOutrow
operator|=
literal|0x00
expr_stmt|;
comment|/* black */
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|1
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* pixel add ! */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0x80
expr_stmt|;
block|}
if|if
condition|(
name|iB
operator|&
name|iM
condition|)
comment|/* invert if it is white ? */
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pOutrow
operator|^
literal|0xFF
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|1
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_store_g1
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_delta_g2
name|mng_retcode
name|mng_delta_g2
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pDeltaImage
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_SWITCH
specifier|const
name|mng_uint8
name|level
index|[
literal|4
index|]
init|=
block|{
literal|0x00
block|,
literal|0x55
block|,
literal|0xAA
block|,
literal|0xFF
block|}
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlocky
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlockx
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
comment|/* pixel replace ? */
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xC0
expr_stmt|;
name|iS
operator|=
literal|6
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_SWITCH
operator|*
name|pOutrow
operator|=
name|level
index|[
operator|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
operator|)
index|]
expr_stmt|;
else|#
directive|else
switch|switch
condition|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
condition|)
comment|/* determine the alpha level */
block|{
case|case
literal|0x03
case|:
block|{
operator|*
name|pOutrow
operator|=
literal|0xFF
expr_stmt|;
break|break;
block|}
case|case
literal|0x02
case|:
block|{
operator|*
name|pOutrow
operator|=
literal|0xAA
expr_stmt|;
break|break;
block|}
case|case
literal|0x01
case|:
block|{
operator|*
name|pOutrow
operator|=
literal|0x55
expr_stmt|;
break|break;
block|}
default|default   :
block|{
operator|*
name|pOutrow
operator|=
literal|0x00
expr_stmt|;
block|}
block|}
endif|#
directive|endif
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|2
expr_stmt|;
name|iS
operator|-=
literal|2
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* pixel add ! */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xC0
expr_stmt|;
name|iS
operator|=
literal|6
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_SWITCH
operator|*
name|pOutrow
operator|=
name|level
index|[
operator|(
operator|(
operator|*
name|pOutrow
operator|>>
literal|6
operator|)
operator|+
operator|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
operator|)
operator|)
operator|&
literal|0x03
index|]
expr_stmt|;
else|#
directive|else
switch|switch
condition|(
operator|(
operator|(
operator|*
name|pOutrow
operator|>>
literal|6
operator|)
operator|+
operator|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
operator|)
operator|)
operator|&
literal|0x03
condition|)
block|{
case|case
literal|0x03
case|:
block|{
operator|*
name|pOutrow
operator|=
literal|0xFF
expr_stmt|;
break|break;
block|}
case|case
literal|0x02
case|:
block|{
operator|*
name|pOutrow
operator|=
literal|0xAA
expr_stmt|;
break|break;
block|}
case|case
literal|0x01
case|:
block|{
operator|*
name|pOutrow
operator|=
literal|0x55
expr_stmt|;
break|break;
block|}
default|default   :
block|{
operator|*
name|pOutrow
operator|=
literal|0x00
expr_stmt|;
block|}
block|}
endif|#
directive|endif
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|2
expr_stmt|;
name|iS
operator|-=
literal|2
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_store_g2
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_delta_g4
name|mng_retcode
name|mng_delta_g4
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pDeltaImage
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
name|mng_uint8
name|iQ
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlocky
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlockx
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
comment|/* pixel replace ? */
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xF0
expr_stmt|;
name|iS
operator|=
literal|4
expr_stmt|;
block|}
comment|/* get the gray level */
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
comment|/* expand to 8-bit by replication */
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iQ
operator|+
operator|(
name|iQ
operator|<<
literal|4
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pOutrow
operator|=
name|iQ
expr_stmt|;
comment|/* put in object buffer */
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|4
expr_stmt|;
name|iS
operator|-=
literal|4
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* pixel add ! */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xF0
expr_stmt|;
name|iS
operator|=
literal|4
expr_stmt|;
block|}
comment|/* get the gray level */
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
operator|*
name|pOutrow
operator|>>
literal|4
operator|)
operator|+
operator|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
operator|)
operator|)
operator|&
literal|0x0F
argument_list|)
expr_stmt|;
comment|/* expand to 8-bit by replication */
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iQ
operator|+
operator|(
name|iQ
operator|<<
literal|4
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pOutrow
operator|=
name|iQ
expr_stmt|;
comment|/* put in object buffer */
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|4
expr_stmt|;
name|iS
operator|-=
literal|4
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_store_g4
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_delta_g8
name|mng_retcode
name|mng_delta_g8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pDeltaImage
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlocky
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlockx
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
comment|/* pixel replace ? */
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* put in object buffer */
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* pixel add ! */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
comment|/* add to object buffer */
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pOutrow
operator|+
operator|*
name|pWorkrow
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|++
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_store_g8
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_delta_g16
name|mng_retcode
name|mng_delta_g16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pDeltaImage
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlocky
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlockx
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
comment|/* pixel replace ? */
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* put in object buffer */
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|1
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* pixel add ! */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
comment|/* add to object buffer */
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pOutrow
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|1
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_store_g16
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_delta_rgb8
name|mng_retcode
name|mng_delta_rgb8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pDeltaImage
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGB8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlocky
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlockx
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
comment|/* pixel replace ? */
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* put in object buffer */
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|3
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* pixel add ! */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
comment|/* add to object buffer */
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pOutrow
operator|+
operator|*
name|pWorkrow
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|+
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|+
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|3
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|3
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGB8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_store_rgb8
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_delta_rgb16
name|mng_retcode
name|mng_delta_rgb16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pDeltaImage
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGB16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlocky
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlockx
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
comment|/* pixel replace ? */
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* put in object buffer */
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|3
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|4
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|5
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|5
operator|)
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|6
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|6
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* pixel add ! */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
comment|/* add to object buffer */
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pOutrow
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|4
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pOutrow
operator|+
literal|4
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|4
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|*
literal|6
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|6
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGB16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_store_rgb16
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_delta_idx1
name|mng_retcode
name|mng_delta_idx1
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pDeltaImage
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_IDX1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlocky
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlockx
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
comment|/* pixel replace ? */
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0x80
expr_stmt|;
block|}
if|if
condition|(
name|iB
operator|&
name|iM
condition|)
comment|/* put the right index value */
operator|*
name|pOutrow
operator|=
literal|1
expr_stmt|;
else|else
operator|*
name|pOutrow
operator|=
literal|0
expr_stmt|;
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|1
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* pixel add ! */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0x80
expr_stmt|;
block|}
if|if
condition|(
name|iB
operator|&
name|iM
condition|)
comment|/* invert if it is non-zero index */
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pOutrow
operator|^
literal|0x01
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|1
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_IDX1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_store_idx1
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_delta_idx2
name|mng_retcode
name|mng_delta_idx2
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pDeltaImage
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_IDX2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlocky
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlockx
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
comment|/* pixel replace ? */
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xC0
expr_stmt|;
name|iS
operator|=
literal|6
expr_stmt|;
block|}
comment|/* put the index */
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|2
expr_stmt|;
name|iS
operator|-=
literal|2
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* pixel add ! */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xC0
expr_stmt|;
name|iS
operator|=
literal|6
expr_stmt|;
block|}
comment|/* calculate the index */
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
name|pOutrow
operator|+
operator|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
operator|)
operator|)
operator|&
literal|0x03
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|2
expr_stmt|;
name|iS
operator|-=
literal|2
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_IDX2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_store_idx2
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_delta_idx4
name|mng_retcode
name|mng_delta_idx4
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pDeltaImage
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_IDX4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlocky
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlockx
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
comment|/* pixel replace ? */
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xF0
expr_stmt|;
name|iS
operator|=
literal|4
expr_stmt|;
block|}
comment|/* put the index */
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|4
expr_stmt|;
name|iS
operator|-=
literal|4
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* pixel add ! */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xF0
expr_stmt|;
name|iS
operator|=
literal|4
expr_stmt|;
block|}
comment|/* calculate the index */
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|*
name|pOutrow
operator|+
operator|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
operator|)
operator|)
operator|&
literal|0x0F
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|4
expr_stmt|;
name|iS
operator|-=
literal|4
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_IDX4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_store_idx4
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_delta_idx8
name|mng_retcode
name|mng_delta_idx8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pDeltaImage
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_IDX8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlocky
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlockx
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
comment|/* pixel replace ? */
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* put in object buffer */
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* pixel add ! */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
comment|/* add to object buffer */
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pOutrow
operator|+
operator|*
name|pWorkrow
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
name|pData
operator|->
name|iColinc
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|++
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_IDX8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_store_idx8
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_delta_ga8
name|mng_retcode
name|mng_delta_ga8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pDeltaImage
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_GA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlocky
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlockx
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
comment|/* pixel replace ? */
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* put in object buffer */
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|1
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* pixel add ! */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
comment|/* add to object buffer */
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pOutrow
operator|+
operator|*
name|pWorkrow
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|+
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|1
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_GA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_store_ga8
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_delta_ga16
name|mng_retcode
name|mng_delta_ga16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pDeltaImage
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_GA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlocky
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlockx
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
comment|/* pixel replace ? */
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* put in object buffer */
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|4
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* pixel add ! */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
comment|/* add to object buffer */
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pOutrow
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|4
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_GA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_store_ga16
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_delta_rgba8
name|mng_retcode
name|mng_delta_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pDeltaImage
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlocky
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlockx
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
comment|/* pixel replace ? */
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* put in object buffer */
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|4
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* pixel add ! */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
comment|/* add to object buffer */
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pOutrow
operator|+
operator|*
name|pWorkrow
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|+
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|+
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
operator|(
name|pOutrow
operator|+
literal|3
operator|)
operator|+
operator|*
operator|(
name|pWorkrow
operator|+
literal|3
operator|)
argument_list|)
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|2
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|4
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_store_rgba8
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_delta_rgba16
name|mng_retcode
name|mng_delta_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pDeltaImage
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlocky
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iDeltaBlockx
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
comment|/* pixel replace ? */
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|MNG_COPY
argument_list|(
name|pOutrow
argument_list|,
name|pWorkrow
argument_list|,
literal|8
argument_list|)
expr_stmt|;
comment|/* put in object buffer */
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|3
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|8
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* pixel add ! */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
comment|/* add to object buffer */
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pOutrow
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|4
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pOutrow
operator|+
literal|4
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|4
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|6
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pOutrow
operator|+
literal|6
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|6
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|/* next pixel */
name|pOutrow
operator|+=
operator|(
name|pData
operator|->
name|iColinc
operator|<<
literal|3
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|8
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_store_rgba16
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Delta-image row routines - apply the source row onto the target        * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_delta_g1_g1
name|mng_retcode
name|mng_delta_g1_g1
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G1_G1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_REPLACE
operator|)
operator|||
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
operator|)
condition|)
block|{
name|MNG_COPY
argument_list|(
name|pOutrow
argument_list|,
name|pWorkrow
argument_list|,
name|pData
operator|->
name|iRowsamples
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|mng_uint16
operator|)
operator|*
name|pOutrow
operator|+
operator|(
name|mng_uint16
operator|)
operator|*
name|pWorkrow
operator|)
operator|&
literal|0x01
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G1_G1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_delta_g2_g2
name|mng_retcode
name|mng_delta_g2_g2
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G2_G2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_REPLACE
operator|)
operator|||
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
operator|)
condition|)
block|{
name|MNG_COPY
argument_list|(
name|pOutrow
argument_list|,
name|pWorkrow
argument_list|,
name|pData
operator|->
name|iRowsamples
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|mng_uint16
operator|)
operator|*
name|pOutrow
operator|+
operator|(
name|mng_uint16
operator|)
operator|*
name|pWorkrow
operator|)
operator|&
literal|0x03
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G2_G2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_delta_g4_g4
name|mng_retcode
name|mng_delta_g4_g4
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G4_G4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_REPLACE
operator|)
operator|||
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
operator|)
condition|)
block|{
name|MNG_COPY
argument_list|(
name|pOutrow
argument_list|,
name|pWorkrow
argument_list|,
name|pData
operator|->
name|iRowsamples
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|mng_uint16
operator|)
operator|*
name|pOutrow
operator|+
operator|(
name|mng_uint16
operator|)
operator|*
name|pWorkrow
operator|)
operator|&
literal|0x0F
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G4_G4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_delta_g8_g8
name|mng_retcode
name|mng_delta_g8_g8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G8_G8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_REPLACE
operator|)
operator|||
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
operator|)
condition|)
block|{
name|MNG_COPY
argument_list|(
name|pOutrow
argument_list|,
name|pWorkrow
argument_list|,
name|pData
operator|->
name|iRowsamples
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|mng_uint16
operator|)
operator|*
name|pOutrow
operator|+
operator|(
name|mng_uint16
operator|)
operator|*
name|pWorkrow
operator|)
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G8_G8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_delta_g16_g16
name|mng_retcode
name|mng_delta_g16_g16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G16_G16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_REPLACE
operator|)
operator|||
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
operator|)
condition|)
block|{
name|MNG_COPY
argument_list|(
name|pOutrow
argument_list|,
name|pWorkrow
argument_list|,
operator|(
name|pData
operator|->
name|iRowsamples
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_get_uint16
argument_list|(
name|pOutrow
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|)
operator|&
literal|0xFFFF
argument_list|)
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|2
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_G16_G16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_DELTA_PNG */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_delta_rgb8_rgb8
name|mng_retcode
name|mng_delta_rgb8_rgb8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGB8_RGB8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_REPLACE
operator|)
operator|||
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
operator|)
condition|)
block|{
name|MNG_COPY
argument_list|(
name|pOutrow
argument_list|,
name|pWorkrow
argument_list|,
name|pData
operator|->
name|iRowsamples
operator|*
literal|3
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
operator|*
literal|3
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
operator|(
name|pData
operator|->
name|iRowsamples
operator|*
literal|3
operator|)
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|mng_uint16
operator|)
operator|*
name|pOutrow
operator|+
operator|(
name|mng_uint16
operator|)
operator|*
name|pWorkrow
operator|)
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGB8_RGB8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_delta_rgb16_rgb16
name|mng_retcode
name|mng_delta_rgb16_rgb16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGB16_RGB16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_REPLACE
operator|)
operator|||
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
operator|)
condition|)
block|{
name|MNG_COPY
argument_list|(
name|pOutrow
argument_list|,
name|pWorkrow
argument_list|,
operator|(
name|pData
operator|->
name|iRowsamples
operator|*
literal|6
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_get_uint16
argument_list|(
name|pOutrow
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|)
operator|&
literal|0xFFFF
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_get_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|2
argument_list|)
operator|)
operator|&
literal|0xFFFF
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|4
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_get_uint16
argument_list|(
name|pOutrow
operator|+
literal|4
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|4
argument_list|)
operator|)
operator|&
literal|0xFFFF
argument_list|)
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|6
expr_stmt|;
name|pWorkrow
operator|+=
literal|6
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGB16_RGB16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_function
DECL|function|mng_delta_ga8_ga8
name|mng_retcode
name|mng_delta_ga8_ga8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_GA8_GA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_REPLACE
operator|)
operator|||
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
operator|)
condition|)
block|{
name|MNG_COPY
argument_list|(
name|pOutrow
argument_list|,
name|pWorkrow
argument_list|,
name|pData
operator|->
name|iRowsamples
operator|<<
literal|1
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
operator|(
name|pData
operator|->
name|iRowsamples
operator|<<
literal|1
operator|)
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
operator|(
name|pData
operator|->
name|iRowsamples
operator|<<
literal|1
operator|)
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|mng_uint16
operator|)
operator|*
name|pOutrow
operator|+
operator|(
name|mng_uint16
operator|)
operator|*
name|pWorkrow
operator|)
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_GA8_GA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_delta_ga8_g8
name|mng_retcode
name|mng_delta_ga8_g8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_GA8_G8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKCOLORREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
name|pOutrow
operator|+=
literal|2
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKCOLORADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|mng_uint16
operator|)
operator|*
name|pOutrow
operator|+
operator|(
name|mng_uint16
operator|)
operator|*
name|pWorkrow
operator|)
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|2
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_GA8_G8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_delta_ga8_a8
name|mng_retcode
name|mng_delta_ga8_a8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_GA8_A8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
literal|1
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKALPHAREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
name|pOutrow
operator|+=
literal|2
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKALPHAADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|mng_uint16
operator|)
operator|*
name|pOutrow
operator|+
operator|(
name|mng_uint16
operator|)
operator|*
name|pWorkrow
operator|)
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|2
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_GA8_A8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_delta_ga16_ga16
name|mng_retcode
name|mng_delta_ga16_ga16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_GA16_GA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_REPLACE
operator|)
operator|||
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
operator|)
condition|)
block|{
name|MNG_COPY
argument_list|(
name|pOutrow
argument_list|,
name|pWorkrow
argument_list|,
operator|(
name|pData
operator|->
name|iRowsamples
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_get_uint16
argument_list|(
name|pOutrow
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|)
operator|&
literal|0xFFFF
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_get_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|2
argument_list|)
operator|)
operator|&
literal|0xFFFF
argument_list|)
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|4
expr_stmt|;
name|pWorkrow
operator|+=
literal|4
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_GA16_GA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_delta_ga16_g16
name|mng_retcode
name|mng_delta_ga16_g16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_GA16_G16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKCOLORREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|4
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKCOLORADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_get_uint16
argument_list|(
name|pOutrow
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|)
operator|&
literal|0xFFFF
argument_list|)
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|4
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_GA16_G16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_delta_ga16_a16
name|mng_retcode
name|mng_delta_ga16_a16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_GA16_A16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKALPHAREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|,
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|4
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKALPHAADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_get_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|)
operator|&
literal|0xFFFF
argument_list|)
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|4
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_GA16_A16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_DELTA_PNG */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_delta_rgba8_rgba8
name|mng_retcode
name|mng_delta_rgba8_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGBA8_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_REPLACE
operator|)
operator|||
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
operator|)
condition|)
block|{
name|MNG_COPY
argument_list|(
name|pOutrow
argument_list|,
name|pWorkrow
argument_list|,
name|pData
operator|->
name|iRowsamples
operator|<<
literal|2
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
operator|(
name|pData
operator|->
name|iRowsamples
operator|<<
literal|2
operator|)
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
operator|(
name|pData
operator|->
name|iRowsamples
operator|<<
literal|2
operator|)
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|mng_uint16
operator|)
operator|*
name|pOutrow
operator|+
operator|(
name|mng_uint16
operator|)
operator|*
name|pWorkrow
operator|)
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGBA8_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_function
DECL|function|mng_delta_rgba8_rgb8
name|mng_retcode
name|mng_delta_rgba8_rgb8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGBA8_RGB8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKCOLORREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
expr_stmt|;
name|pOutrow
operator|+=
literal|4
expr_stmt|;
name|pWorkrow
operator|+=
literal|3
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKCOLORADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|mng_uint16
operator|)
operator|*
name|pOutrow
operator|+
operator|(
name|mng_uint16
operator|)
operator|*
name|pWorkrow
operator|)
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|mng_uint16
operator|)
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|+
operator|(
name|mng_uint16
operator|)
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
operator|)
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|mng_uint16
operator|)
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|+
operator|(
name|mng_uint16
operator|)
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
operator|)
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|4
expr_stmt|;
name|pWorkrow
operator|+=
literal|3
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGBA8_RGB8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_delta_rgba8_a8
name|mng_retcode
name|mng_delta_rgba8_a8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGBA8_A8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
operator|+
literal|3
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKALPHAREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
name|pOutrow
operator|+=
literal|4
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKALPHAADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
name|mng_uint16
operator|)
operator|*
name|pOutrow
operator|+
operator|(
name|mng_uint16
operator|)
operator|*
name|pWorkrow
operator|)
operator|&
literal|0xFF
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|4
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGBA8_A8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_DELTA_PNG */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_delta_rgba16_rgba16
name|mng_retcode
name|mng_delta_rgba16_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGBA16_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_REPLACE
operator|)
operator|||
operator|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELREPLACE
operator|)
condition|)
block|{
name|MNG_COPY
argument_list|(
name|pOutrow
argument_list|,
name|pWorkrow
argument_list|,
operator|(
name|pData
operator|->
name|iRowsamples
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKPIXELADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_get_uint16
argument_list|(
name|pOutrow
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|)
operator|&
literal|0xFFFF
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_get_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|2
argument_list|)
operator|)
operator|&
literal|0xFFFF
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|4
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_get_uint16
argument_list|(
name|pOutrow
operator|+
literal|4
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|4
argument_list|)
operator|)
operator|&
literal|0xFFFF
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|6
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_get_uint16
argument_list|(
name|pOutrow
operator|+
literal|6
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|6
argument_list|)
operator|)
operator|&
literal|0xFFFF
argument_list|)
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|8
expr_stmt|;
name|pWorkrow
operator|+=
literal|8
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGBA16_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_delta_rgba16_rgb16
name|mng_retcode
name|mng_delta_rgba16_rgb16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGBA16_RGB16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKCOLORREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|,
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|4
argument_list|,
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|8
expr_stmt|;
name|pWorkrow
operator|+=
literal|6
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKCOLORADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|mng_put_uint16
argument_list|(
name|pOutrow
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_get_uint16
argument_list|(
name|pOutrow
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|)
operator|&
literal|0xFFFF
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_get_uint16
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|2
argument_list|)
operator|)
operator|&
literal|0xFFFF
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|4
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_get_uint16
argument_list|(
name|pOutrow
operator|+
literal|4
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|4
argument_list|)
operator|)
operator|&
literal|0xFFFF
argument_list|)
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|8
expr_stmt|;
name|pWorkrow
operator|+=
literal|6
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGBA16_RGB16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_delta_rgba16_a16
name|mng_retcode
name|mng_delta_rgba16_a16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGBA16_A16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKALPHAREPLACE
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|6
argument_list|,
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|8
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|iDeltatype
operator|==
name|MNG_DELTATYPE_BLOCKALPHAADD
condition|)
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|mng_put_uint16
argument_list|(
name|pOutrow
operator|+
literal|6
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_get_uint16
argument_list|(
name|pOutrow
operator|+
literal|6
argument_list|)
operator|+
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|)
operator|&
literal|0xFFFF
argument_list|)
argument_list|)
expr_stmt|;
name|pOutrow
operator|+=
literal|8
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DELTA_RGBA16_A16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_DELTA_PNG */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Delta-image row routines - scale the delta to bitdepth of target       * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_scale_g1_g2
name|mng_retcode
name|mng_scale_g1_g2
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G1_G2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pWorkrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pWorkrow
operator|<<
literal|1
argument_list|)
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G1_G2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_scale_g1_g4
name|mng_retcode
name|mng_scale_g1_g4
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G1_G4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pWorkrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pWorkrow
operator|<<
literal|3
argument_list|)
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G1_G4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_scale_g1_g8
name|mng_retcode
name|mng_scale_g1_g8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G1_G8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pWorkrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pWorkrow
operator|<<
literal|7
argument_list|)
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G1_G8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_scale_g1_g16
name|mng_retcode
name|mng_scale_g1_g16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_uint8p
name|pOutrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G1_G16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pWorkrow
operator|+
operator|(
name|pData
operator|->
name|iRowsamples
operator|-
literal|1
operator|)
expr_stmt|;
name|pOutrow
operator|=
name|pOutrow
operator|+
operator|(
operator|(
name|pData
operator|->
name|iRowsamples
operator|-
literal|1
operator|)
operator|<<
literal|1
operator|)
expr_stmt|;
comment|/*  pWorkrow = (mng_uint8p)((mng_uint32)pWorkrow + pData->iRowsamples - 1); */
comment|/*  pOutrow  = (mng_uint8p)((mng_uint32)pOutrow  + ((pData->iRowsamples - 1)<< 1)); */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pWorkrow
operator|<<
literal|7
argument_list|)
expr_stmt|;
name|pWorkrow
operator|--
expr_stmt|;
name|pOutrow
operator|-=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G1_G16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_scale_g2_g4
name|mng_retcode
name|mng_scale_g2_g4
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G2_G4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pWorkrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pWorkrow
operator|<<
literal|2
argument_list|)
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G2_G4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_scale_g2_g8
name|mng_retcode
name|mng_scale_g2_g8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G2_G8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pWorkrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pWorkrow
operator|<<
literal|6
argument_list|)
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G2_G8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_scale_g2_g16
name|mng_retcode
name|mng_scale_g2_g16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_uint8p
name|pOutrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G2_G16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pWorkrow
operator|+
operator|(
name|pData
operator|->
name|iRowsamples
operator|-
literal|1
operator|)
expr_stmt|;
name|pOutrow
operator|=
name|pOutrow
operator|+
operator|(
operator|(
name|pData
operator|->
name|iRowsamples
operator|-
literal|1
operator|)
operator|<<
literal|1
operator|)
expr_stmt|;
comment|/*  pWorkrow = (mng_uint8p)((mng_uint32)pWorkrow + pData->iRowsamples - 1); */
comment|/*  pOutrow  = (mng_uint8p)((mng_uint32)pOutrow  + ((pData->iRowsamples - 1)<< 1)); */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pWorkrow
operator|<<
literal|6
argument_list|)
expr_stmt|;
name|pWorkrow
operator|--
expr_stmt|;
name|pOutrow
operator|-=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G2_G16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_scale_g4_g8
name|mng_retcode
name|mng_scale_g4_g8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G4_G8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pWorkrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pWorkrow
operator|<<
literal|4
argument_list|)
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G4_G8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_scale_g4_g16
name|mng_retcode
name|mng_scale_g4_g16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_uint8p
name|pOutrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G4_G16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pWorkrow
operator|+
operator|(
name|pData
operator|->
name|iRowsamples
operator|-
literal|1
operator|)
expr_stmt|;
name|pOutrow
operator|=
name|pOutrow
operator|+
operator|(
operator|(
name|pData
operator|->
name|iRowsamples
operator|-
literal|1
operator|)
operator|<<
literal|1
operator|)
expr_stmt|;
comment|/*  pWorkrow = (mng_uint8p)((mng_uint32)pWorkrow + pData->iRowsamples - 1); */
comment|/*  pOutrow  = (mng_uint8p)((mng_uint32)pOutrow  + ((pData->iRowsamples - 1)<< 1)); */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pWorkrow
operator|<<
literal|4
argument_list|)
expr_stmt|;
name|pWorkrow
operator|--
expr_stmt|;
name|pOutrow
operator|-=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G4_G16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_scale_g8_g16
name|mng_retcode
name|mng_scale_g8_g16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_uint8p
name|pOutrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G8_G16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pWorkrow
operator|+
operator|(
name|pData
operator|->
name|iRowsamples
operator|-
literal|1
operator|)
expr_stmt|;
name|pOutrow
operator|=
name|pOutrow
operator|+
operator|(
operator|(
name|pData
operator|->
name|iRowsamples
operator|-
literal|1
operator|)
operator|<<
literal|1
operator|)
expr_stmt|;
comment|/*  pWorkrow = (mng_uint8p)((mng_uint32)pWorkrow + pData->iRowsamples - 1); */
comment|/*  pOutrow  = (mng_uint8p)((mng_uint32)pOutrow  + ((pData->iRowsamples - 1)<< 1)); */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
name|pWorkrow
operator|--
expr_stmt|;
name|pOutrow
operator|-=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G8_G16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_scale_ga8_ga16
name|mng_retcode
name|mng_scale_ga8_ga16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_uint8p
name|pOutrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_GA8_GA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pWorkrow
operator|+
operator|(
operator|(
name|pData
operator|->
name|iRowsamples
operator|-
literal|1
operator|)
operator|<<
literal|1
operator|)
expr_stmt|;
name|pOutrow
operator|=
name|pOutrow
operator|+
operator|(
operator|(
name|pData
operator|->
name|iRowsamples
operator|-
literal|1
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
comment|/*  pWorkrow = (mng_uint8p)((mng_uint32)pWorkrow + ((pData->iRowsamples - 1)<< 1)); */
comment|/*  pOutrow  = (mng_uint8p)((mng_uint32)pOutrow  + ((pData->iRowsamples - 1)<< 2)); */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
operator|(
name|pOutrow
operator|+
literal|3
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
name|pWorkrow
operator|-=
literal|2
expr_stmt|;
name|pOutrow
operator|-=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_GA8_GA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_scale_rgb8_rgb16
name|mng_retcode
name|mng_scale_rgb8_rgb16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_uint8p
name|pOutrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_RGB8_RGB16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pWorkrow
operator|+
operator|(
literal|3
operator|*
operator|(
name|pData
operator|->
name|iRowsamples
operator|-
literal|1
operator|)
operator|)
expr_stmt|;
name|pOutrow
operator|=
name|pOutrow
operator|+
operator|(
literal|6
operator|*
operator|(
name|pData
operator|->
name|iRowsamples
operator|-
literal|1
operator|)
operator|)
expr_stmt|;
comment|/*  pWorkrow = (mng_uint8p)((mng_uint32)pWorkrow + 3 * (pData->iRowsamples - 1)); */
comment|/*  pOutrow  = (mng_uint8p)((mng_uint32)pOutrow  + 6 * (pData->iRowsamples - 1)); */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
operator|(
name|pOutrow
operator|+
literal|5
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|4
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|3
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
name|pWorkrow
operator|-=
literal|3
expr_stmt|;
name|pOutrow
operator|-=
literal|6
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_RGB8_RGB16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_scale_rgba8_rgba16
name|mng_retcode
name|mng_scale_rgba8_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_uint8p
name|pOutrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_RGBA8_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pWorkrow
operator|+
operator|(
operator|(
name|pData
operator|->
name|iRowsamples
operator|-
literal|1
operator|)
operator|<<
literal|2
operator|)
expr_stmt|;
name|pOutrow
operator|=
name|pOutrow
operator|+
operator|(
operator|(
name|pData
operator|->
name|iRowsamples
operator|-
literal|1
operator|)
operator|<<
literal|3
operator|)
expr_stmt|;
comment|/*  pWorkrow = (mng_uint8p)((mng_uint32)pWorkrow + ((pData->iRowsamples - 1)<< 2)); */
comment|/*  pOutrow  = (mng_uint8p)((mng_uint32)pOutrow  + ((pData->iRowsamples - 1)<< 3)); */
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
operator|(
name|pOutrow
operator|+
literal|7
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|6
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|3
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|5
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|4
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|3
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
name|pWorkrow
operator|-=
literal|4
expr_stmt|;
name|pOutrow
operator|-=
literal|8
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_RGBA8_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_scale_g2_g1
name|mng_retcode
name|mng_scale_g2_g1
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G2_G1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pWorkrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pWorkrow
operator|>>
literal|1
argument_list|)
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G2_G1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_scale_g4_g1
name|mng_retcode
name|mng_scale_g4_g1
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G4_G1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pWorkrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pWorkrow
operator|>>
literal|3
argument_list|)
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G4_G1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_scale_g8_g1
name|mng_retcode
name|mng_scale_g8_g1
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G8_G1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pWorkrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pWorkrow
operator|>>
literal|7
argument_list|)
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G8_G1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_scale_g16_g1
name|mng_retcode
name|mng_scale_g16_g1
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_uint8p
name|pOutrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G16_G1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|>>
literal|15
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G16_G1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_scale_g4_g2
name|mng_retcode
name|mng_scale_g4_g2
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G4_G2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pWorkrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pWorkrow
operator|>>
literal|2
argument_list|)
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G4_G2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_scale_g8_g2
name|mng_retcode
name|mng_scale_g8_g2
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G8_G2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pWorkrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pWorkrow
operator|>>
literal|6
argument_list|)
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G8_G2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_scale_g16_g2
name|mng_retcode
name|mng_scale_g16_g2
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_uint8p
name|pOutrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G16_G2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|>>
literal|14
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G16_G2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_scale_g8_g4
name|mng_retcode
name|mng_scale_g8_g4
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G8_G4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pWorkrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|*
name|pWorkrow
operator|>>
literal|4
argument_list|)
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G8_G4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_scale_g16_g4
name|mng_retcode
name|mng_scale_g16_g4
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_uint8p
name|pOutrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G16_G4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|>>
literal|12
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G16_G4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* NO_1_2_4BIT_SUPPORT */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_scale_g16_g8
name|mng_retcode
name|mng_scale_g16_g8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_uint8p
name|pOutrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G16_G8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_G16_G8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_scale_ga16_ga8
name|mng_retcode
name|mng_scale_ga16_ga8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_uint8p
name|pOutrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_GA16_GA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_GA16_GA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_scale_rgb16_rgb8
name|mng_retcode
name|mng_scale_rgb16_rgb8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_uint8p
name|pOutrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_RGB16_RGB8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_RGB16_RGB8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_scale_rgba16_rgba8
name|mng_retcode
name|mng_scale_rgba16_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_uint8p
name|pOutrow
init|=
name|pData
operator|->
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_RGBA16_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
operator|*
name|pOutrow
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
operator|>>
literal|8
argument_list|)
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_SCALE_RGBA16_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Delta-image bit routines - promote bit_depth                           * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_replicate_1_2
name|mng_uint8
name|mng_promote_replicate_1_2
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
return|return
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|<<
literal|1
operator|)
operator||
name|iB
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_replicate_1_4
name|mng_uint8
name|mng_promote_replicate_1_4
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
name|iB
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|<<
literal|1
operator|)
operator|+
name|iB
argument_list|)
expr_stmt|;
return|return
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|<<
literal|2
operator|)
operator|+
name|iB
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_replicate_1_8
name|mng_uint8
name|mng_promote_replicate_1_8
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
name|iB
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|<<
literal|1
operator|)
operator|+
name|iB
argument_list|)
expr_stmt|;
name|iB
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|<<
literal|2
operator|)
operator|+
name|iB
argument_list|)
expr_stmt|;
return|return
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|<<
literal|4
operator|)
operator|+
name|iB
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_replicate_1_16
name|mng_uint16
name|mng_promote_replicate_1_16
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
name|iB
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|<<
literal|1
operator|)
operator|+
name|iB
argument_list|)
expr_stmt|;
name|iB
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|<<
literal|2
operator|)
operator|+
name|iB
argument_list|)
expr_stmt|;
name|iB
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|<<
literal|4
operator|)
operator|+
name|iB
argument_list|)
expr_stmt|;
return|return
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
name|mng_uint16
operator|)
name|iB
operator|<<
literal|8
operator|)
operator|+
operator|(
name|mng_uint16
operator|)
name|iB
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_replicate_2_4
name|mng_uint8
name|mng_promote_replicate_2_4
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
return|return
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|<<
literal|2
operator|)
operator|+
name|iB
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_replicate_2_8
name|mng_uint8
name|mng_promote_replicate_2_8
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
name|iB
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|<<
literal|2
operator|)
operator|+
name|iB
argument_list|)
expr_stmt|;
return|return
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|<<
literal|4
operator|)
operator|+
name|iB
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_replicate_2_16
name|mng_uint16
name|mng_promote_replicate_2_16
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
name|iB
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|<<
literal|2
operator|)
operator|+
name|iB
argument_list|)
expr_stmt|;
name|iB
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|<<
literal|4
operator|)
operator|+
name|iB
argument_list|)
expr_stmt|;
return|return
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
name|mng_uint16
operator|)
name|iB
operator|<<
literal|8
operator|)
operator|+
operator|(
name|mng_uint16
operator|)
name|iB
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_replicate_4_8
name|mng_uint8
name|mng_promote_replicate_4_8
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
return|return
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|<<
literal|4
operator|)
operator|+
name|iB
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_replicate_4_16
name|mng_uint16
name|mng_promote_replicate_4_16
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
name|iB
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|<<
literal|4
operator|)
operator|+
name|iB
argument_list|)
expr_stmt|;
return|return
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
name|mng_uint16
operator|)
name|iB
operator|<<
literal|8
operator|)
operator|+
operator|(
name|mng_uint16
operator|)
name|iB
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* NO_1_2_4BIT_SUPPORT */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_replicate_8_16
name|mng_uint16
name|mng_promote_replicate_8_16
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
return|return
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
name|mng_uint16
operator|)
name|iB
operator|<<
literal|8
operator|)
operator|+
operator|(
name|mng_uint16
operator|)
name|iB
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|MNG_NO_DELTA_PNG
argument_list|)
end_if
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_zerofill_1_2
name|mng_uint8
name|mng_promote_zerofill_1_2
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
return|return
call|(
name|mng_uint8
call|)
argument_list|(
name|iB
operator|<<
literal|1
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_zerofill_1_4
name|mng_uint8
name|mng_promote_zerofill_1_4
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
return|return
call|(
name|mng_uint8
call|)
argument_list|(
name|iB
operator|<<
literal|3
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_zerofill_1_8
name|mng_uint8
name|mng_promote_zerofill_1_8
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
return|return
call|(
name|mng_uint8
call|)
argument_list|(
name|iB
operator|<<
literal|7
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_zerofill_1_16
name|mng_uint16
name|mng_promote_zerofill_1_16
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
return|return
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint16
operator|)
name|iB
operator|<<
literal|15
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_zerofill_2_4
name|mng_uint8
name|mng_promote_zerofill_2_4
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
return|return
call|(
name|mng_uint8
call|)
argument_list|(
name|iB
operator|<<
literal|2
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_zerofill_2_8
name|mng_uint8
name|mng_promote_zerofill_2_8
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
return|return
call|(
name|mng_uint8
call|)
argument_list|(
name|iB
operator|<<
literal|6
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_zerofill_2_16
name|mng_uint16
name|mng_promote_zerofill_2_16
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
return|return
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint16
operator|)
name|iB
operator|<<
literal|14
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_zerofill_4_8
name|mng_uint8
name|mng_promote_zerofill_4_8
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
return|return
call|(
name|mng_uint8
call|)
argument_list|(
name|iB
operator|<<
literal|4
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_zerofill_4_16
name|mng_uint16
name|mng_promote_zerofill_4_16
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
return|return
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint16
operator|)
name|iB
operator|<<
literal|12
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_zerofill_8_16
name|mng_uint16
name|mng_promote_zerofill_8_16
parameter_list|(
name|mng_uint8
name|iB
parameter_list|)
block|{
return|return
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
name|mng_uint16
operator|)
name|iB
operator|<<
literal|8
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_DELTA_PNG */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Delta-image row routines - promote color_type                          * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|MNG_NO_DELTA_PNG
argument_list|)
operator|||
operator|!
name|defined
argument_list|(
name|MNG_SKIPCHUNK_PAST
argument_list|)
operator|||
operator|!
name|defined
argument_list|(
name|MNG_SKIPCHUNK_MAGN
argument_list|)
end_if
begin_function
DECL|function|mng_promote_g8_g8
name|mng_retcode
name|mng_promote_g8_g8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G8_G8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iB
operator|=
operator|*
name|pSrcline
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|fPromBitdepth
condition|)
comment|/* bitdepth promoted ? */
name|iB
operator|=
operator|(
operator|(
name|mng_bitdepth_8
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
name|iB
operator|)
expr_stmt|;
operator|*
name|pDstline
operator|=
name|iB
expr_stmt|;
name|pSrcline
operator|++
expr_stmt|;
name|pDstline
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G8_G8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_g8_g16
name|mng_retcode
name|mng_promote_g8_g16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint16
name|iW
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G8_G16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iW
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
operator|*
name|pSrcline
operator|)
expr_stmt|;
operator|*
name|pDstline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iW
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iW
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
name|pSrcline
operator|++
expr_stmt|;
name|pDstline
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G8_G16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_g16_g16
name|mng_retcode
name|mng_promote_g16_g16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint16p
name|pSrcline
init|=
operator|(
name|mng_uint16p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint16p
name|pDstline
init|=
operator|(
name|mng_uint16p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G16_G16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pDstline
operator|=
operator|*
name|pSrcline
expr_stmt|;
name|pSrcline
operator|++
expr_stmt|;
name|pDstline
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G16_G16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_g8_ga8
name|mng_retcode
name|mng_promote_g8_ga8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pPromBuf
decl_stmt|;
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G8_GA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iB
operator|=
operator|*
name|pSrcline
expr_stmt|;
comment|/* no cheap transparency ? */
if|if
condition|(
operator|(
operator|!
name|pBuf
operator|->
name|bHasTRNS
operator|)
operator|||
operator|(
operator|(
name|mng_uint16
operator|)
name|iB
operator|!=
name|pBuf
operator|->
name|iTRNSgray
operator|)
condition|)
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
literal|0xFF
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|fPromBitdepth
condition|)
comment|/* bitdepth promoted ? */
name|iB
operator|=
operator|(
operator|(
name|mng_bitdepth_8
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
name|iB
operator|)
expr_stmt|;
operator|*
name|pDstline
operator|=
name|iB
expr_stmt|;
name|pSrcline
operator|++
expr_stmt|;
name|pDstline
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G8_GA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_g8_ga16
name|mng_retcode
name|mng_promote_g8_ga16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pPromBuf
decl_stmt|;
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint16
name|iW
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G8_GA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iB
operator|=
operator|*
name|pSrcline
expr_stmt|;
comment|/* no cheap transparency ? */
if|if
condition|(
operator|(
operator|!
name|pBuf
operator|->
name|bHasTRNS
operator|)
operator|||
operator|(
operator|(
name|mng_uint16
operator|)
name|iB
operator|!=
name|pBuf
operator|->
name|iTRNSgray
operator|)
condition|)
block|{
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
literal|0xFF
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
block|}
name|iW
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
name|iB
operator|)
expr_stmt|;
operator|*
name|pDstline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iW
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iW
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
name|pSrcline
operator|++
expr_stmt|;
name|pDstline
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G8_GA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_g16_ga16
name|mng_retcode
name|mng_promote_g16_ga16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pPromBuf
decl_stmt|;
name|mng_uint16p
name|pSrcline
init|=
operator|(
name|mng_uint16p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint16p
name|pDstline
init|=
operator|(
name|mng_uint16p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint16
name|iW
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G16_GA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iW
operator|=
operator|*
name|pSrcline
expr_stmt|;
comment|/* no cheap transparency ? */
if|if
condition|(
operator|(
operator|!
name|pBuf
operator|->
name|bHasTRNS
operator|)
operator|||
operator|(
operator|(
name|mng_uint16
operator|)
name|iW
operator|!=
name|pBuf
operator|->
name|iTRNSgray
operator|)
condition|)
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
literal|0xFFFF
expr_stmt|;
operator|*
name|pDstline
operator|=
name|iW
expr_stmt|;
name|pSrcline
operator|++
expr_stmt|;
name|pDstline
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G16_GA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_g8_rgb8
name|mng_retcode
name|mng_promote_g8_rgb8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G8_RGB8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iB
operator|=
operator|*
name|pSrcline
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|fPromBitdepth
condition|)
comment|/* bitdepth promoted ? */
name|iB
operator|=
operator|(
operator|(
name|mng_bitdepth_8
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
name|iB
operator|)
expr_stmt|;
operator|*
name|pDstline
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
name|iB
expr_stmt|;
name|pSrcline
operator|++
expr_stmt|;
name|pDstline
operator|+=
literal|3
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G8_RGB8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_g8_rgb16
name|mng_retcode
name|mng_promote_g8_rgb16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint16
name|iW
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G8_RGB16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iB
operator|=
operator|*
name|pSrcline
expr_stmt|;
name|iW
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
name|iB
operator|)
expr_stmt|;
name|iB
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iW
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
name|pDstline
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|4
operator|)
operator|=
name|iB
expr_stmt|;
name|iB
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iW
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|5
operator|)
operator|=
name|iB
expr_stmt|;
name|pSrcline
operator|++
expr_stmt|;
name|pDstline
operator|+=
literal|6
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G8_RGB16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_g16_rgb16
name|mng_retcode
name|mng_promote_g16_rgb16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint16p
name|pSrcline
init|=
operator|(
name|mng_uint16p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint16p
name|pDstline
init|=
operator|(
name|mng_uint16p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint16
name|iW
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G16_RGB16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iW
operator|=
operator|*
name|pSrcline
expr_stmt|;
operator|*
name|pDstline
operator|=
name|iW
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
name|iW
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
name|iW
expr_stmt|;
name|pSrcline
operator|++
expr_stmt|;
name|pDstline
operator|+=
literal|3
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G16_RGB16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_g8_rgba8
name|mng_retcode
name|mng_promote_g8_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pPromBuf
decl_stmt|;
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G8_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iB
operator|=
operator|*
name|pSrcline
expr_stmt|;
comment|/* no cheap transparency ? */
if|if
condition|(
operator|(
operator|!
name|pBuf
operator|->
name|bHasTRNS
operator|)
operator|||
operator|(
operator|(
name|mng_uint16
operator|)
name|iB
operator|!=
name|pBuf
operator|->
name|iTRNSgray
operator|)
condition|)
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|fPromBitdepth
condition|)
comment|/* bitdepth promoted ? */
name|iB
operator|=
operator|(
operator|(
name|mng_bitdepth_8
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
name|iB
operator|)
expr_stmt|;
operator|*
name|pDstline
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
name|iB
expr_stmt|;
name|pSrcline
operator|++
expr_stmt|;
name|pDstline
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G8_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_g8_rgba16
name|mng_retcode
name|mng_promote_g8_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pPromBuf
decl_stmt|;
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint16
name|iW
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G8_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iB
operator|=
operator|*
name|pSrcline
expr_stmt|;
comment|/* no cheap transparency ? */
if|if
condition|(
operator|(
operator|!
name|pBuf
operator|->
name|bHasTRNS
operator|)
operator|||
operator|(
operator|(
name|mng_uint16
operator|)
name|iB
operator|!=
name|pBuf
operator|->
name|iTRNSgray
operator|)
condition|)
block|{
operator|*
operator|(
name|pDstline
operator|+
literal|6
operator|)
operator|=
literal|0xFF
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|7
operator|)
operator|=
literal|0xFF
expr_stmt|;
block|}
name|iW
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
name|iB
operator|)
expr_stmt|;
name|iB
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iW
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
name|pDstline
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|4
operator|)
operator|=
name|iB
expr_stmt|;
name|iB
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iW
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|5
operator|)
operator|=
name|iB
expr_stmt|;
empty_stmt|;
name|pSrcline
operator|++
expr_stmt|;
name|pDstline
operator|+=
literal|8
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G8_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_g16_rgba16
name|mng_retcode
name|mng_promote_g16_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pPromBuf
decl_stmt|;
name|mng_uint16p
name|pSrcline
init|=
operator|(
name|mng_uint16p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint16p
name|pDstline
init|=
operator|(
name|mng_uint16p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint16
name|iW
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G16_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iW
operator|=
operator|*
name|pSrcline
expr_stmt|;
comment|/* no cheap transparency ? */
if|if
condition|(
operator|(
operator|!
name|pBuf
operator|->
name|bHasTRNS
operator|)
operator|||
operator|(
name|iW
operator|!=
name|pBuf
operator|->
name|iTRNSgray
operator|)
condition|)
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
literal|0xFFFF
expr_stmt|;
operator|*
name|pDstline
operator|=
name|iW
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
name|iW
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
name|iW
expr_stmt|;
name|pSrcline
operator|++
expr_stmt|;
name|pDstline
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_G16_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_ga8_ga16
name|mng_retcode
name|mng_promote_ga8_ga16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint16
name|iW
decl_stmt|;
name|mng_uint16
name|iA
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_GA8_GA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iW
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
operator|*
name|pSrcline
operator|)
expr_stmt|;
name|iA
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
operator|*
operator|(
name|pSrcline
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
operator|*
name|pDstline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iW
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iW
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iA
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iA
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
name|pSrcline
operator|+=
literal|2
expr_stmt|;
name|pDstline
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_GA8_GA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_ga8_rgba8
name|mng_retcode
name|mng_promote_ga8_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iA
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_GA8_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iB
operator|=
operator|*
name|pSrcline
expr_stmt|;
name|iA
operator|=
operator|*
operator|(
name|pSrcline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
name|pDstline
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
name|iA
expr_stmt|;
name|pSrcline
operator|+=
literal|2
expr_stmt|;
name|pDstline
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_GA8_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_ga8_rgba16
name|mng_retcode
name|mng_promote_ga8_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint16
name|iW
decl_stmt|;
name|mng_uint16
name|iA
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_GA8_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iW
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
operator|*
name|pSrcline
operator|)
expr_stmt|;
name|iA
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
operator|*
operator|(
name|pSrcline
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
name|iB
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iW
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
name|pDstline
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|4
operator|)
operator|=
name|iB
expr_stmt|;
name|iB
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iW
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|5
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|6
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iA
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|7
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iA
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
name|pSrcline
operator|+=
literal|2
expr_stmt|;
name|pDstline
operator|+=
literal|8
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_GA8_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_ga16_rgba16
name|mng_retcode
name|mng_promote_ga16_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint16p
name|pSrcline
init|=
operator|(
name|mng_uint16p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint16p
name|pDstline
init|=
operator|(
name|mng_uint16p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint16
name|iW
decl_stmt|;
name|mng_uint16
name|iA
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_GA16_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iW
operator|=
operator|*
name|pSrcline
expr_stmt|;
name|iA
operator|=
operator|*
operator|(
name|pSrcline
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
name|pDstline
operator|=
name|iW
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
name|iW
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
name|iW
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
name|iA
expr_stmt|;
name|pSrcline
operator|+=
literal|2
expr_stmt|;
name|pDstline
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_GA16_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_rgb8_rgb16
name|mng_retcode
name|mng_promote_rgb8_rgb16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint16
name|iR
decl_stmt|;
name|mng_uint16
name|iG
decl_stmt|;
name|mng_uint16
name|iB
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_RGB8_RGB16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iR
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
operator|*
name|pSrcline
operator|)
expr_stmt|;
name|iG
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
operator|*
operator|(
name|pSrcline
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
name|iB
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
operator|*
operator|(
name|pSrcline
operator|+
literal|2
operator|)
operator|)
expr_stmt|;
operator|*
name|pDstline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iR
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iR
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iG
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iG
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|4
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iB
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|5
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iB
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
name|pSrcline
operator|+=
literal|3
expr_stmt|;
name|pDstline
operator|+=
literal|6
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_RGB8_RGB16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_rgb8_rgba8
name|mng_retcode
name|mng_promote_rgb8_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pPromBuf
decl_stmt|;
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8
name|iR
decl_stmt|;
name|mng_uint8
name|iG
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_RGB8_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iR
operator|=
operator|*
name|pSrcline
expr_stmt|;
name|iG
operator|=
operator|*
operator|(
name|pSrcline
operator|+
literal|1
operator|)
expr_stmt|;
name|iB
operator|=
operator|*
operator|(
name|pSrcline
operator|+
literal|2
operator|)
expr_stmt|;
comment|/* no cheap transparency ? */
if|if
condition|(
operator|(
operator|!
name|pBuf
operator|->
name|bHasTRNS
operator|)
operator|||
operator|(
operator|(
name|mng_uint16
operator|)
name|iR
operator|!=
name|pBuf
operator|->
name|iTRNSred
operator|)
operator|||
operator|(
operator|(
name|mng_uint16
operator|)
name|iG
operator|!=
name|pBuf
operator|->
name|iTRNSgreen
operator|)
operator|||
operator|(
operator|(
name|mng_uint16
operator|)
name|iB
operator|!=
name|pBuf
operator|->
name|iTRNSblue
operator|)
condition|)
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
operator|*
name|pDstline
operator|=
name|iR
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
name|iG
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
name|iB
expr_stmt|;
name|pSrcline
operator|+=
literal|3
expr_stmt|;
name|pDstline
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_RGB8_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_rgb8_rgba16
name|mng_retcode
name|mng_promote_rgb8_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pPromBuf
decl_stmt|;
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8
name|iR
decl_stmt|;
name|mng_uint8
name|iG
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint16
name|iRw
decl_stmt|;
name|mng_uint16
name|iGw
decl_stmt|;
name|mng_uint16
name|iBw
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_RGB8_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iR
operator|=
operator|*
name|pSrcline
expr_stmt|;
name|iG
operator|=
operator|*
operator|(
name|pSrcline
operator|+
literal|1
operator|)
expr_stmt|;
name|iB
operator|=
operator|*
operator|(
name|pSrcline
operator|+
literal|2
operator|)
expr_stmt|;
comment|/* no cheap transparency ? */
if|if
condition|(
operator|(
operator|!
name|pBuf
operator|->
name|bHasTRNS
operator|)
operator|||
operator|(
operator|(
name|mng_uint16
operator|)
name|iR
operator|!=
name|pBuf
operator|->
name|iTRNSred
operator|)
operator|||
operator|(
operator|(
name|mng_uint16
operator|)
name|iG
operator|!=
name|pBuf
operator|->
name|iTRNSgreen
operator|)
operator|||
operator|(
operator|(
name|mng_uint16
operator|)
name|iB
operator|!=
name|pBuf
operator|->
name|iTRNSblue
operator|)
condition|)
block|{
operator|*
operator|(
name|pDstline
operator|+
literal|6
operator|)
operator|=
literal|0xFF
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|7
operator|)
operator|=
literal|0xFF
expr_stmt|;
block|}
name|iRw
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
name|iR
operator|)
expr_stmt|;
name|iGw
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
name|iG
operator|)
expr_stmt|;
name|iBw
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
name|iB
operator|)
expr_stmt|;
operator|*
name|pDstline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iRw
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iRw
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iGw
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iGw
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|4
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iBw
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|5
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iBw
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
name|pSrcline
operator|+=
literal|3
expr_stmt|;
name|pDstline
operator|+=
literal|8
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_RGB8_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_rgb16_rgba16
name|mng_retcode
name|mng_promote_rgb16_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pPromBuf
decl_stmt|;
name|mng_uint16p
name|pSrcline
init|=
operator|(
name|mng_uint16p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint16p
name|pDstline
init|=
operator|(
name|mng_uint16p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint16
name|iR
decl_stmt|;
name|mng_uint16
name|iG
decl_stmt|;
name|mng_uint16
name|iB
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_RGB16_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iR
operator|=
operator|*
name|pSrcline
expr_stmt|;
name|iG
operator|=
operator|*
operator|(
name|pSrcline
operator|+
literal|1
operator|)
expr_stmt|;
name|iB
operator|=
operator|*
operator|(
name|pSrcline
operator|+
literal|2
operator|)
expr_stmt|;
comment|/* no cheap transparency ? */
if|if
condition|(
operator|(
operator|!
name|pBuf
operator|->
name|bHasTRNS
operator|)
operator|||
operator|(
name|iR
operator|!=
name|pBuf
operator|->
name|iTRNSred
operator|)
operator|||
operator|(
name|iG
operator|!=
name|pBuf
operator|->
name|iTRNSgreen
operator|)
operator|||
operator|(
name|iB
operator|!=
name|pBuf
operator|->
name|iTRNSblue
operator|)
condition|)
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
literal|0xFFFF
expr_stmt|;
operator|*
name|pDstline
operator|=
name|iR
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
name|iG
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
name|iB
expr_stmt|;
name|pSrcline
operator|+=
literal|3
expr_stmt|;
name|pDstline
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_RGB16_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_idx8_rgb8
name|mng_retcode
name|mng_promote_idx8_rgb8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pPromBuf
decl_stmt|;
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_IDX8_RGB8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iB
operator|=
operator|*
name|pSrcline
expr_stmt|;
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iB
operator|<
name|pBuf
operator|->
name|iPLTEcount
condition|)
block|{
operator|*
name|pDstline
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iB
index|]
operator|.
name|iRed
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iB
index|]
operator|.
name|iGreen
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iB
index|]
operator|.
name|iBlue
expr_stmt|;
block|}
name|pSrcline
operator|++
expr_stmt|;
name|pDstline
operator|+=
literal|3
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_IDX8_RGB8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_idx8_rgb16
name|mng_retcode
name|mng_promote_idx8_rgb16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pPromBuf
decl_stmt|;
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8
name|iN
decl_stmt|;
name|mng_uint16
name|iR
decl_stmt|;
name|mng_uint16
name|iG
decl_stmt|;
name|mng_uint16
name|iB
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_IDX8_RGB16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iN
operator|=
operator|*
name|pSrcline
expr_stmt|;
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iN
operator|<
name|pBuf
operator|->
name|iPLTEcount
condition|)
block|{
name|iR
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iN
index|]
operator|.
name|iRed
operator|)
expr_stmt|;
name|iG
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iN
index|]
operator|.
name|iGreen
operator|)
expr_stmt|;
name|iB
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iN
index|]
operator|.
name|iBlue
operator|)
expr_stmt|;
operator|*
name|pDstline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iR
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iR
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iG
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iG
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|4
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iB
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|5
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iB
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
block|}
name|pSrcline
operator|++
expr_stmt|;
name|pDstline
operator|+=
literal|6
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_IDX8_RGB16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_idx8_rgba8
name|mng_retcode
name|mng_promote_idx8_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pPromBuf
decl_stmt|;
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_IDX8_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iB
operator|=
operator|*
name|pSrcline
expr_stmt|;
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iB
operator|<
name|pBuf
operator|->
name|iPLTEcount
condition|)
block|{
operator|*
name|pDstline
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iB
index|]
operator|.
name|iRed
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iB
index|]
operator|.
name|iGreen
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iB
index|]
operator|.
name|iBlue
expr_stmt|;
if|if
condition|(
operator|(
name|pBuf
operator|->
name|bHasTRNS
operator|)
operator|&&
operator|(
operator|(
name|mng_uint32
operator|)
name|iB
operator|<
name|pBuf
operator|->
name|iTRNScount
operator|)
condition|)
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
name|pBuf
operator|->
name|aTRNSentries
index|[
name|iB
index|]
expr_stmt|;
else|else
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
block|}
name|pSrcline
operator|++
expr_stmt|;
name|pDstline
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_IDX8_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_promote_idx8_rgba16
name|mng_retcode
name|mng_promote_idx8_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pPromBuf
decl_stmt|;
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8
name|iN
decl_stmt|;
name|mng_uint16
name|iR
decl_stmt|;
name|mng_uint16
name|iG
decl_stmt|;
name|mng_uint16
name|iB
decl_stmt|;
name|mng_uint16
name|iA
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_IDX8_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iN
operator|=
operator|*
name|pSrcline
expr_stmt|;
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iN
operator|<
name|pBuf
operator|->
name|iPLTEcount
condition|)
block|{
name|iR
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iN
index|]
operator|.
name|iRed
operator|)
expr_stmt|;
name|iG
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iN
index|]
operator|.
name|iGreen
operator|)
expr_stmt|;
name|iB
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iN
index|]
operator|.
name|iBlue
operator|)
expr_stmt|;
if|if
condition|(
operator|(
name|pBuf
operator|->
name|bHasTRNS
operator|)
operator|&&
operator|(
operator|(
name|mng_uint32
operator|)
name|iN
operator|<
name|pBuf
operator|->
name|iTRNScount
operator|)
condition|)
name|iA
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
name|pBuf
operator|->
name|aTRNSentries
index|[
name|iN
index|]
operator|)
expr_stmt|;
else|else
name|iA
operator|=
literal|0xFFFF
expr_stmt|;
operator|*
name|pDstline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iR
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iR
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iG
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iG
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|4
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iB
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|5
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iB
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|6
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iA
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|7
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iA
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
block|}
name|pSrcline
operator|++
expr_stmt|;
name|pDstline
operator|+=
literal|8
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_IDX8_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_promote_rgba8_rgba16
name|mng_retcode
name|mng_promote_rgba8_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pSrcline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromSrc
decl_stmt|;
name|mng_uint8p
name|pDstline
init|=
operator|(
name|mng_uint8p
operator|)
name|pData
operator|->
name|pPromDst
decl_stmt|;
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint16
name|iR
decl_stmt|;
name|mng_uint16
name|iG
decl_stmt|;
name|mng_uint16
name|iB
decl_stmt|;
name|mng_uint16
name|iA
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_RGBA8_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPromWidth
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPromWidth
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iR
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
operator|*
name|pSrcline
operator|)
expr_stmt|;
name|iG
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
operator|*
operator|(
name|pSrcline
operator|+
literal|1
operator|)
operator|)
expr_stmt|;
name|iB
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
operator|*
operator|(
name|pSrcline
operator|+
literal|2
operator|)
operator|)
expr_stmt|;
name|iA
operator|=
operator|(
operator|(
name|mng_bitdepth_16
operator|)
name|pData
operator|->
name|fPromBitdepth
operator|)
operator|(
operator|*
operator|(
name|pSrcline
operator|+
literal|3
operator|)
operator|)
expr_stmt|;
operator|*
name|pDstline
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iR
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|1
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iR
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|2
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iG
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iG
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|4
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iB
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|5
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iB
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|6
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iA
operator|>>
literal|8
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pDstline
operator|+
literal|7
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iA
operator|&&
literal|0xFF
argument_list|)
expr_stmt|;
name|pSrcline
operator|+=
literal|4
expr_stmt|;
name|pDstline
operator|+=
literal|8
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROMOTE_RGBA8_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* !defined(MNG_NO_DELTA_PNG) || !defined(MNG_SKIPCHUNK_PAST) || !defined(MNG_SKIPCHUNK_MAGN) */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Row processing routines - convert uncompressed data from zlib to       * */
end_comment
begin_comment
comment|/* * managable row-data which serves as input to the color-management       * */
end_comment
begin_comment
comment|/* * routines                                                               * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_process_g1
name|mng_retcode
name|mng_process_g1
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_G1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|pBuf
condition|)
comment|/* no object? then use obj 0 */
name|pBuf
operator|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pObjzero
operator|)
operator|->
name|pImgbuf
expr_stmt|;
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|bHasTRNS
condition|)
comment|/* tRNS encountered ? */
block|{
if|if
condition|(
name|pBuf
operator|->
name|iTRNSgray
condition|)
comment|/* white transparent ? */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0x80
expr_stmt|;
block|}
if|if
condition|(
name|iB
operator|&
name|iM
condition|)
comment|/* is it white ? */
comment|/* transparent ! */
name|mng_put_uint32
argument_list|(
name|pRGBArow
argument_list|,
literal|0x00000000
argument_list|)
expr_stmt|;
else|else
comment|/* opaque black */
name|mng_put_uint32
argument_list|(
name|pRGBArow
argument_list|,
literal|0x000000FF
argument_list|)
expr_stmt|;
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|1
expr_stmt|;
block|}
block|}
else|else
comment|/* black transparent */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0x80
expr_stmt|;
block|}
if|if
condition|(
name|iB
operator|&
name|iM
condition|)
comment|/* is it white ? */
comment|/* opaque white */
name|mng_put_uint32
argument_list|(
name|pRGBArow
argument_list|,
literal|0xFFFFFFFF
argument_list|)
expr_stmt|;
else|else
comment|/* transparent */
name|mng_put_uint32
argument_list|(
name|pRGBArow
argument_list|,
literal|0x00000000
argument_list|)
expr_stmt|;
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|1
expr_stmt|;
block|}
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* it's not fully opaque */
block|}
else|else
comment|/* no transparency */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0x80
expr_stmt|;
block|}
if|if
condition|(
name|iB
operator|&
name|iM
condition|)
comment|/* is it white ? */
comment|/* opaque white */
name|mng_put_uint32
argument_list|(
name|pRGBArow
argument_list|,
literal|0xFFFFFFFF
argument_list|)
expr_stmt|;
else|else
comment|/* opaque black */
name|mng_put_uint32
argument_list|(
name|pRGBArow
argument_list|,
literal|0x000000FF
argument_list|)
expr_stmt|;
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|1
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* it's fully opaque */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_G1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_g2
name|mng_retcode
name|mng_process_g2
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
name|mng_uint8
name|iQ
decl_stmt|;
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_SWITCH
specifier|const
name|mng_uint32
name|level
index|[
literal|4
index|]
init|=
block|{
literal|0x000000FF
block|,
literal|0x555555FF
block|,
literal|0xAAAAAAFF
block|,
literal|0xFFFFFFFF
block|}
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_G2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|pBuf
condition|)
comment|/* no object? then use obj 0 */
name|pBuf
operator|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pObjzero
operator|)
operator|->
name|pImgbuf
expr_stmt|;
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|bHasTRNS
condition|)
comment|/* tRNS encountered ? */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xC0
expr_stmt|;
name|iS
operator|=
literal|6
expr_stmt|;
block|}
comment|/* determine gray level */
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
if|if
condition|(
name|iQ
operator|==
name|pBuf
operator|->
name|iTRNSgray
condition|)
comment|/* transparent ? */
name|mng_put_uint32
argument_list|(
name|pRGBArow
argument_list|,
literal|0x00000000
argument_list|)
expr_stmt|;
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_SWITCH
name|mng_put_uint32
argument_list|(
name|pRGBArow
argument_list|,
name|level
index|[
name|iQ
index|]
argument_list|)
expr_stmt|;
else|#
directive|else
switch|switch
condition|(
name|iQ
condition|)
comment|/* determine the gray level */
block|{
case|case
literal|0x03
case|:
block|{
name|mng_put_uint32
argument_list|(
name|pRGBArow
argument_list|,
literal|0xFFFFFFFF
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
literal|0x02
case|:
block|{
name|mng_put_uint32
argument_list|(
name|pRGBArow
argument_list|,
literal|0xAAAAAAFF
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
literal|0x01
case|:
block|{
name|mng_put_uint32
argument_list|(
name|pRGBArow
argument_list|,
literal|0x555555FF
argument_list|)
expr_stmt|;
break|break;
block|}
default|default   :
block|{
name|mng_put_uint32
argument_list|(
name|pRGBArow
argument_list|,
literal|0x000000FF
argument_list|)
expr_stmt|;
block|}
block|}
endif|#
directive|endif
block|}
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|2
expr_stmt|;
name|iS
operator|-=
literal|2
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* it's not fully opaque */
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xC0
expr_stmt|;
name|iS
operator|=
literal|6
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_SWITCH
name|mng_put_uint32
argument_list|(
name|pRGBArow
argument_list|,
name|level
index|[
operator|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
operator|)
index|]
argument_list|)
expr_stmt|;
else|#
directive|else
switch|switch
condition|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
condition|)
comment|/* determine the gray level */
block|{
case|case
literal|0x03
case|:
block|{
name|mng_put_uint32
argument_list|(
name|pRGBArow
argument_list|,
literal|0xFFFFFFFF
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
literal|0x02
case|:
block|{
name|mng_put_uint32
argument_list|(
name|pRGBArow
argument_list|,
literal|0xAAAAAAFF
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
literal|0x01
case|:
block|{
name|mng_put_uint32
argument_list|(
name|pRGBArow
argument_list|,
literal|0x555555FF
argument_list|)
expr_stmt|;
break|break;
block|}
default|default   :
block|{
name|mng_put_uint32
argument_list|(
name|pRGBArow
argument_list|,
literal|0x000000FF
argument_list|)
expr_stmt|;
block|}
block|}
endif|#
directive|endif
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|2
expr_stmt|;
name|iS
operator|-=
literal|2
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* it's fully opaque */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_G2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_g4
name|mng_retcode
name|mng_process_g4
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
name|mng_uint8
name|iQ
decl_stmt|;
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_G4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|pBuf
condition|)
comment|/* no object? then use obj 0 */
name|pBuf
operator|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pObjzero
operator|)
operator|->
name|pImgbuf
expr_stmt|;
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|bHasTRNS
condition|)
comment|/* tRNS encountered ? */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xF0
expr_stmt|;
name|iS
operator|=
literal|4
expr_stmt|;
block|}
comment|/* get the gray level */
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
if|if
condition|(
name|iQ
operator|==
name|pBuf
operator|->
name|iTRNSgray
condition|)
comment|/* transparent ? */
block|{
operator|*
name|pRGBArow
operator|=
literal|0
expr_stmt|;
comment|/* put in intermediate row */
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
comment|/* expand to 8-bit by replication */
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iQ
operator|+
operator|(
name|iQ
operator|<<
literal|4
operator|)
argument_list|)
expr_stmt|;
operator|*
name|pRGBArow
operator|=
name|iQ
expr_stmt|;
comment|/* put in intermediate row */
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
name|iQ
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
name|iQ
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
block|}
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|4
expr_stmt|;
name|iS
operator|-=
literal|4
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* it's not fully opaque */
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xF0
expr_stmt|;
name|iS
operator|=
literal|4
expr_stmt|;
block|}
comment|/* get the gray level */
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
name|iQ
operator|+
operator|(
name|iQ
operator|<<
literal|4
operator|)
argument_list|)
expr_stmt|;
comment|/* expand to 8-bit by replication */
operator|*
name|pRGBArow
operator|=
name|iQ
expr_stmt|;
comment|/* put in intermediate row */
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
name|iQ
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
name|iQ
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|4
expr_stmt|;
name|iS
operator|-=
literal|4
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* it's fully opaque */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_G4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_g8
name|mng_retcode
name|mng_process_g8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_G8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|pBuf
condition|)
comment|/* no object? then use obj 0 */
name|pBuf
operator|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pObjzero
operator|)
operator|->
name|pImgbuf
expr_stmt|;
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|bHasTRNS
condition|)
comment|/* tRNS encountered ? */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
if|if
condition|(
name|iB
operator|==
name|pBuf
operator|->
name|iTRNSgray
condition|)
comment|/* transparent ? */
block|{
operator|*
name|pRGBArow
operator|=
literal|0
expr_stmt|;
comment|/* put in intermediate row */
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
operator|*
name|pRGBArow
operator|=
name|iB
expr_stmt|;
comment|/* put in intermediate row */
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
block|}
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|++
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* it's not fully opaque */
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
operator|*
name|pRGBArow
operator|=
name|iB
expr_stmt|;
comment|/* put in intermediate row */
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|++
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* it's fully opaque */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_G8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_process_g16
name|mng_retcode
name|mng_process_g16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iW
decl_stmt|;
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_G16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|pBuf
condition|)
comment|/* no object? then use obj 0 */
name|pBuf
operator|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pObjzero
operator|)
operator|->
name|pImgbuf
expr_stmt|;
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|bHasTRNS
condition|)
comment|/* tRNS encountered ? */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iW
operator|=
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
expr_stmt|;
comment|/* get input */
if|if
condition|(
name|iW
operator|==
name|pBuf
operator|->
name|iTRNSgray
condition|)
comment|/* transparent ? */
block|{
comment|/* put in intermediate row */
name|mng_put_uint16
argument_list|(
name|pRGBArow
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|4
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|6
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* put in intermediate row */
name|mng_put_uint16
argument_list|(
name|pRGBArow
argument_list|,
name|iW
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|2
argument_list|,
name|iW
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|4
argument_list|,
name|iW
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|6
argument_list|,
literal|0xFFFF
argument_list|)
expr_stmt|;
block|}
name|pRGBArow
operator|+=
literal|8
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* it's not fully opaque */
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iW
operator|=
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
expr_stmt|;
comment|/* get input */
name|mng_put_uint16
argument_list|(
name|pRGBArow
argument_list|,
name|iW
argument_list|)
expr_stmt|;
comment|/* and put in intermediate row */
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|2
argument_list|,
name|iW
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|4
argument_list|,
name|iW
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|6
argument_list|,
literal|0xFFFF
argument_list|)
expr_stmt|;
name|pRGBArow
operator|+=
literal|8
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* it's fully opaque */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_G16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_rgb8
name|mng_retcode
name|mng_process_rgb8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iR
decl_stmt|,
name|iG
decl_stmt|,
name|iB
decl_stmt|;
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_RGB8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|pBuf
condition|)
comment|/* no object? then use obj 0 */
name|pBuf
operator|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pObjzero
operator|)
operator|->
name|pImgbuf
expr_stmt|;
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|bHasTRNS
condition|)
comment|/* tRNS encountered ? */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iR
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get the RGB values */
name|iG
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
name|iB
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
expr_stmt|;
comment|/* transparent ? */
if|if
condition|(
operator|(
name|iR
operator|==
name|pBuf
operator|->
name|iTRNSred
operator|)
operator|&&
operator|(
name|iG
operator|==
name|pBuf
operator|->
name|iTRNSgreen
operator|)
operator|&&
operator|(
name|iB
operator|==
name|pBuf
operator|->
name|iTRNSblue
operator|)
condition|)
block|{
operator|*
name|pRGBArow
operator|=
literal|0
expr_stmt|;
comment|/* this pixel is transparent ! */
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
literal|0
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0
expr_stmt|;
block|}
else|else
block|{
operator|*
name|pRGBArow
operator|=
name|iR
expr_stmt|;
comment|/* copy the RGB values */
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
name|iG
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
name|iB
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
comment|/* this one isn't transparent */
block|}
name|pWorkrow
operator|+=
literal|3
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* it's not fully opaque */
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pRGBArow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* copy the RGB bytes */
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
comment|/* no alpha; so always fully opaque */
name|pWorkrow
operator|+=
literal|3
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* it's fully opaque */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_RGB8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_process_rgb16
name|mng_retcode
name|mng_process_rgb16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iR
decl_stmt|,
name|iG
decl_stmt|,
name|iB
decl_stmt|;
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_RGB16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|pBuf
condition|)
comment|/* no object? then use obj 0 */
name|pBuf
operator|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pObjzero
operator|)
operator|->
name|pImgbuf
expr_stmt|;
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|bHasTRNS
condition|)
comment|/* tRNS encountered ? */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iR
operator|=
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
expr_stmt|;
comment|/* get the RGB values */
name|iG
operator|=
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|2
argument_list|)
expr_stmt|;
name|iB
operator|=
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|4
argument_list|)
expr_stmt|;
comment|/* transparent ? */
if|if
condition|(
operator|(
name|iR
operator|==
name|pBuf
operator|->
name|iTRNSred
operator|)
operator|&&
operator|(
name|iG
operator|==
name|pBuf
operator|->
name|iTRNSgreen
operator|)
operator|&&
operator|(
name|iB
operator|==
name|pBuf
operator|->
name|iTRNSblue
operator|)
condition|)
block|{
comment|/* transparent then */
name|mng_put_uint16
argument_list|(
name|pRGBArow
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|2
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|4
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|6
argument_list|,
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* put in intermediate row */
name|mng_put_uint16
argument_list|(
name|pRGBArow
argument_list|,
name|iR
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|2
argument_list|,
name|iG
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|4
argument_list|,
name|iB
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|6
argument_list|,
literal|0xFFFF
argument_list|)
expr_stmt|;
block|}
name|pWorkrow
operator|+=
literal|6
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|8
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* it's not fully opaque */
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
comment|/* copy the RGB values */
name|mng_put_uint16
argument_list|(
name|pRGBArow
argument_list|,
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|2
argument_list|,
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|4
argument_list|,
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|4
argument_list|)
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|6
argument_list|,
literal|0xFFFF
argument_list|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|6
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|8
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* it's fully opaque */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_RGB16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_process_idx1
name|mng_retcode
name|mng_process_idx1
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
name|mng_uint8
name|iQ
decl_stmt|;
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_IDX1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|pBuf
condition|)
comment|/* no object? then use obj 0 */
name|pBuf
operator|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pObjzero
operator|)
operator|->
name|pImgbuf
expr_stmt|;
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|bHasTRNS
condition|)
comment|/* tRNS encountered ? */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0x80
expr_stmt|;
name|iS
operator|=
literal|7
expr_stmt|;
block|}
comment|/* get the index */
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
comment|/* index valid ? */
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iQ
operator|<
name|pBuf
operator|->
name|iPLTEcount
condition|)
block|{
comment|/* put in intermediate row */
operator|*
name|pRGBArow
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iRed
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iGreen
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iBlue
expr_stmt|;
comment|/* transparency for this index ? */
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iQ
operator|<
name|pBuf
operator|->
name|iTRNScount
condition|)
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
name|pBuf
operator|->
name|aTRNSentries
index|[
name|iQ
index|]
expr_stmt|;
else|else
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
block|}
else|else
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_PLTEINDEXERROR
argument_list|)
expr_stmt|;
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|1
expr_stmt|;
name|iS
operator|-=
literal|1
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* it's not fully opaque */
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0x80
expr_stmt|;
name|iS
operator|=
literal|7
expr_stmt|;
block|}
comment|/* get the index */
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
comment|/* index valid ? */
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iQ
operator|<
name|pBuf
operator|->
name|iPLTEcount
condition|)
block|{
comment|/* put in intermediate row */
operator|*
name|pRGBArow
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iRed
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iGreen
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iBlue
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
block|}
else|else
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_PLTEINDEXERROR
argument_list|)
expr_stmt|;
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|1
expr_stmt|;
name|iS
operator|-=
literal|1
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* it's fully opaque */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_IDX1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_idx2
name|mng_retcode
name|mng_process_idx2
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
name|mng_uint8
name|iQ
decl_stmt|;
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_IDX2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|pBuf
condition|)
comment|/* no object? then use obj 0 */
name|pBuf
operator|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pObjzero
operator|)
operator|->
name|pImgbuf
expr_stmt|;
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|bHasTRNS
condition|)
comment|/* tRNS encountered ? */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xC0
expr_stmt|;
name|iS
operator|=
literal|6
expr_stmt|;
block|}
comment|/* get the index */
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
comment|/* index valid ? */
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iQ
operator|<
name|pBuf
operator|->
name|iPLTEcount
condition|)
block|{
comment|/* put in intermediate row */
operator|*
name|pRGBArow
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iRed
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iGreen
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iBlue
expr_stmt|;
comment|/* transparency for this index ? */
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iQ
operator|<
name|pBuf
operator|->
name|iTRNScount
condition|)
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
name|pBuf
operator|->
name|aTRNSentries
index|[
name|iQ
index|]
expr_stmt|;
else|else
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
block|}
else|else
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_PLTEINDEXERROR
argument_list|)
expr_stmt|;
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|2
expr_stmt|;
name|iS
operator|-=
literal|2
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* it's not fully opaque */
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xC0
expr_stmt|;
name|iS
operator|=
literal|6
expr_stmt|;
block|}
comment|/* get the index */
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
comment|/* index valid ? */
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iQ
operator|<
name|pBuf
operator|->
name|iPLTEcount
condition|)
block|{
comment|/* put in intermediate row */
operator|*
name|pRGBArow
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iRed
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iGreen
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iBlue
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
block|}
else|else
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_PLTEINDEXERROR
argument_list|)
expr_stmt|;
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|2
expr_stmt|;
name|iS
operator|-=
literal|2
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* it's fully opaque */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_IDX2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_idx4
name|mng_retcode
name|mng_process_idx4
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iB
decl_stmt|;
name|mng_uint8
name|iM
decl_stmt|;
name|mng_uint32
name|iS
decl_stmt|;
name|mng_uint8
name|iQ
decl_stmt|;
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_IDX4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|pBuf
condition|)
comment|/* no object? then use obj 0 */
name|pBuf
operator|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pObjzero
operator|)
operator|->
name|pImgbuf
expr_stmt|;
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|iM
operator|=
literal|0
expr_stmt|;
comment|/* start at pixel 0 */
name|iB
operator|=
literal|0
expr_stmt|;
name|iS
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|bHasTRNS
condition|)
comment|/* tRNS encountered ? */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
name|pWorkrow
index|[
literal|0
index|]
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xF0
expr_stmt|;
name|iS
operator|=
literal|4
expr_stmt|;
block|}
comment|/* get the index */
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
comment|/* index valid ? */
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iQ
operator|<
name|pBuf
operator|->
name|iPLTEcount
condition|)
block|{
comment|/* put in intermediate row */
name|pRGBArow
index|[
literal|0
index|]
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iRed
expr_stmt|;
name|pRGBArow
index|[
literal|1
index|]
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iGreen
expr_stmt|;
name|pRGBArow
index|[
literal|2
index|]
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iBlue
expr_stmt|;
comment|/* transparency for this index ? */
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iQ
operator|<
name|pBuf
operator|->
name|iTRNScount
condition|)
name|pRGBArow
index|[
literal|3
index|]
operator|=
name|pBuf
operator|->
name|aTRNSentries
index|[
name|iQ
index|]
expr_stmt|;
else|else
name|pRGBArow
index|[
literal|3
index|]
operator|=
literal|0xFF
expr_stmt|;
block|}
else|else
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_PLTEINDEXERROR
argument_list|)
expr_stmt|;
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|4
expr_stmt|;
name|iS
operator|-=
literal|4
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* it's not fully opaque */
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|!
name|iM
condition|)
comment|/* mask underflow ? */
block|{
name|iB
operator|=
name|pWorkrow
index|[
literal|0
index|]
expr_stmt|;
comment|/* get next input-byte */
name|pWorkrow
operator|++
expr_stmt|;
name|iM
operator|=
literal|0xF0
expr_stmt|;
name|iS
operator|=
literal|4
expr_stmt|;
block|}
comment|/* get the index */
name|iQ
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
name|iB
operator|&
name|iM
operator|)
operator|>>
name|iS
argument_list|)
expr_stmt|;
comment|/* index valid ? */
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iQ
operator|<
name|pBuf
operator|->
name|iPLTEcount
condition|)
block|{
comment|/* put in intermediate row */
name|pRGBArow
index|[
literal|0
index|]
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iRed
expr_stmt|;
name|pRGBArow
index|[
literal|1
index|]
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iGreen
expr_stmt|;
name|pRGBArow
index|[
literal|2
index|]
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iBlue
expr_stmt|;
name|pRGBArow
index|[
literal|3
index|]
operator|=
literal|0xFF
expr_stmt|;
block|}
else|else
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_PLTEINDEXERROR
argument_list|)
expr_stmt|;
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|iM
operator|>>=
literal|4
expr_stmt|;
name|iS
operator|-=
literal|4
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* it's fully opaque */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_IDX4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_idx8
name|mng_retcode
name|mng_process_idx8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iQ
decl_stmt|;
name|mng_imagedatap
name|pBuf
init|=
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_IDX8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|pBuf
condition|)
comment|/* no object? then use obj 0 */
name|pBuf
operator|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pObjzero
operator|)
operator|->
name|pImgbuf
expr_stmt|;
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
if|if
condition|(
name|pBuf
operator|->
name|bHasTRNS
condition|)
comment|/* tRNS encountered ? */
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iQ
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get input byte */
comment|/* index valid ? */
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iQ
operator|<
name|pBuf
operator|->
name|iPLTEcount
condition|)
block|{
comment|/* put in intermediate row */
name|pRGBArow
index|[
literal|0
index|]
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iRed
expr_stmt|;
name|pRGBArow
index|[
literal|1
index|]
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iGreen
expr_stmt|;
name|pRGBArow
index|[
literal|2
index|]
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iBlue
expr_stmt|;
comment|/* transparency for this index ? */
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iQ
operator|<
name|pBuf
operator|->
name|iTRNScount
condition|)
name|pRGBArow
index|[
literal|3
index|]
operator|=
name|pBuf
operator|->
name|aTRNSentries
index|[
name|iQ
index|]
expr_stmt|;
else|else
name|pRGBArow
index|[
literal|3
index|]
operator|=
literal|0xFF
expr_stmt|;
block|}
else|else
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_PLTEINDEXERROR
argument_list|)
expr_stmt|;
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|++
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* it's not fully opaque */
block|}
else|else
block|{
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iQ
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* get input byte */
comment|/* index valid ? */
if|if
condition|(
operator|(
name|mng_uint32
operator|)
name|iQ
operator|<
name|pBuf
operator|->
name|iPLTEcount
condition|)
block|{
comment|/* put in intermediate row */
name|pRGBArow
index|[
literal|0
index|]
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iRed
expr_stmt|;
name|pRGBArow
index|[
literal|1
index|]
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iGreen
expr_stmt|;
name|pRGBArow
index|[
literal|2
index|]
operator|=
name|pBuf
operator|->
name|aPLTEentries
index|[
name|iQ
index|]
operator|.
name|iBlue
expr_stmt|;
name|pRGBArow
index|[
literal|3
index|]
operator|=
literal|0xFF
expr_stmt|;
block|}
else|else
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_PLTEINDEXERROR
argument_list|)
expr_stmt|;
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|pWorkrow
operator|++
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* it's fully opaque */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_IDX8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_ga8
name|mng_retcode
name|mng_process_ga8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_GA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
operator|*
name|pRGBArow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
comment|/* copy the gray value */
operator|*
operator|(
name|pRGBArow
operator|+
literal|1
operator|)
operator|=
operator|*
name|pWorkrow
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|2
operator|)
operator|=
operator|*
name|pWorkrow
expr_stmt|;
operator|*
operator|(
name|pRGBArow
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
comment|/* copy the alpha value */
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|4
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* it's definitely not fully opaque */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_GA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_process_ga16
name|mng_retcode
name|mng_process_ga16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pRGBArow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iW
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_GA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* temporary work pointers */
name|pWorkrow
operator|=
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pRGBArow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iW
operator|=
name|mng_get_uint16
argument_list|(
name|pWorkrow
argument_list|)
expr_stmt|;
comment|/* copy the gray value */
name|mng_put_uint16
argument_list|(
name|pRGBArow
argument_list|,
name|iW
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|2
argument_list|,
name|iW
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|4
argument_list|,
name|iW
argument_list|)
expr_stmt|;
comment|/* copy the alpha value */
name|mng_put_uint16
argument_list|(
name|pRGBArow
operator|+
literal|6
argument_list|,
name|mng_get_uint16
argument_list|(
name|pWorkrow
operator|+
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|4
expr_stmt|;
comment|/* next pixel */
name|pRGBArow
operator|+=
literal|8
expr_stmt|;
block|}
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* it's definitely not fully opaque */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_GA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_process_rgba8
name|mng_retcode
name|mng_process_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* this is the easiest transform */
name|MNG_COPY
argument_list|(
name|pData
operator|->
name|pRGBArow
argument_list|,
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
argument_list|,
name|pData
operator|->
name|iRowsize
argument_list|)
expr_stmt|;
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* it's definitely not fully opaque */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_process_rgba16
name|mng_retcode
name|mng_process_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* this is the easiest transform */
name|MNG_COPY
argument_list|(
name|pData
operator|->
name|pRGBArow
argument_list|,
name|pData
operator|->
name|pWorkrow
operator|+
name|pData
operator|->
name|iPixelofs
argument_list|,
name|pData
operator|->
name|iRowsize
argument_list|)
expr_stmt|;
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* it's definitely not fully opaque */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_PROCESS_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Row processing initialization routines - set up the variables needed   * */
end_comment
begin_comment
comment|/* * to process uncompressed row-data                                       * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_INIT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_init_g1_ni
name|mng_retcode
name|mng_init_g1_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G1_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_g1
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_g1
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_g1
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g1
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|7
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|3
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
operator|(
name|pData
operator|->
name|iRowsamples
operator|+
literal|7
operator|)
operator|>>
literal|3
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G1_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_g1_i
name|mng_retcode
name|mng_init_g1_i
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G1_I
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_g1
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_g1
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_g1
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g1
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
literal|0
expr_stmt|;
comment|/* from 0..6; is 1..7 in specifications */
name|pData
operator|->
name|iRow
operator|=
name|interlace_row
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
name|interlace_rowskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
name|interlace_col
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
name|interlace_colskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
name|interlace_roundoff
index|[
literal|0
index|]
operator|)
operator|>>
name|interlace_divider
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|7
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|3
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
operator|(
operator|(
name|pData
operator|->
name|iRowsamples
operator|+
literal|7
operator|)
operator|>>
literal|3
operator|)
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
operator|(
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
literal|7
operator|)
operator|>>
literal|3
operator|)
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G1_I
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_g2_ni
name|mng_retcode
name|mng_init_g2_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G2_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_g2
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_g2
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_g2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g2
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|3
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|2
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
operator|(
name|pData
operator|->
name|iRowsamples
operator|+
literal|3
operator|)
operator|>>
literal|2
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G2_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_g2_i
name|mng_retcode
name|mng_init_g2_i
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G2_I
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_g2
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_g2
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_g2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g2
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
literal|0
expr_stmt|;
comment|/* from 0..6; is 1..7 in specifications */
name|pData
operator|->
name|iRow
operator|=
name|interlace_row
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
name|interlace_rowskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
name|interlace_col
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
name|interlace_colskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
name|interlace_roundoff
index|[
literal|0
index|]
operator|)
operator|>>
name|interlace_divider
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|3
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|2
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
operator|(
operator|(
name|pData
operator|->
name|iRowsamples
operator|+
literal|3
operator|)
operator|>>
literal|2
operator|)
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
operator|(
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
literal|3
operator|)
operator|>>
literal|2
operator|)
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G2_I
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_g4_ni
name|mng_retcode
name|mng_init_g4_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G4_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_g4
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_g4
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_g4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g4
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
operator|(
name|pData
operator|->
name|iRowsamples
operator|+
literal|1
operator|)
operator|>>
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G4_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_g4_i
name|mng_retcode
name|mng_init_g4_i
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G4_I
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_g4
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_g4
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_g4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g4
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
literal|0
expr_stmt|;
comment|/* from 0..6; is 1..7 in specifications */
name|pData
operator|->
name|iRow
operator|=
name|interlace_row
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
name|interlace_rowskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
name|interlace_col
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
name|interlace_colskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
name|interlace_roundoff
index|[
literal|0
index|]
operator|)
operator|>>
name|interlace_divider
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
operator|(
operator|(
name|pData
operator|->
name|iRowsamples
operator|+
literal|1
operator|)
operator|>>
literal|1
operator|)
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
operator|(
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
literal|1
operator|)
operator|>>
literal|1
operator|)
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G4_I
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_g8_ni
name|mng_retcode
name|mng_init_g8_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G8_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_g8
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_g8
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_g8
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g8
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G8_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_g8_i
name|mng_retcode
name|mng_init_g8_i
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G8_I
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_g8
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_g8
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_g8
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g8
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
literal|0
expr_stmt|;
comment|/* from 0..6; is 1..7 in specifications */
name|pData
operator|->
name|iRow
operator|=
name|interlace_row
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
name|interlace_rowskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
name|interlace_col
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
name|interlace_colskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
name|interlace_roundoff
index|[
literal|0
index|]
operator|)
operator|>>
name|interlace_divider
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iDatawidth
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G8_I
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_init_g16_ni
name|mng_retcode
name|mng_init_g16_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G16_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_g16
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_g16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_g16
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g16
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|2
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|<<
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|2
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* intermediate row is 16-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G16_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_init_g16_i
name|mng_retcode
name|mng_init_g16_i
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G16_I
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_g16
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_g16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_g16
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g16
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
literal|0
expr_stmt|;
comment|/* from 0..6; is 1..7 in specifications */
name|pData
operator|->
name|iRow
operator|=
name|interlace_row
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
name|interlace_rowskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
name|interlace_col
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
name|interlace_colskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
name|interlace_roundoff
index|[
literal|0
index|]
operator|)
operator|>>
name|interlace_divider
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|2
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|<<
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|<<
literal|1
operator|)
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|2
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* intermediate row is 16-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_G16_I
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_rgb8_ni
name|mng_retcode
name|mng_init_rgb8_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_RGB8_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_rgb8
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_rgb8
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_rgb8
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_rgb8
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|3
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|*
literal|3
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|3
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_RGB8_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_rgb8_i
name|mng_retcode
name|mng_init_rgb8_i
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_RGB8_I
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_rgb8
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_rgb8
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_rgb8
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_rgb8
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
literal|0
expr_stmt|;
comment|/* from 0..6; is 1..7 in specifications */
name|pData
operator|->
name|iRow
operator|=
name|interlace_row
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
name|interlace_rowskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
name|interlace_col
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
name|interlace_colskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
name|interlace_roundoff
index|[
literal|0
index|]
operator|)
operator|>>
name|interlace_divider
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|3
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|*
literal|3
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|*
literal|3
operator|)
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|3
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_RGB8_I
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_init_rgb16_ni
name|mng_retcode
name|mng_init_rgb16_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_RGB16_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_rgb16
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_rgb16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_rgb16
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_rgb16
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|6
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|*
literal|6
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|6
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* intermediate row is 16-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_RGB16_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_init_rgb16_i
name|mng_retcode
name|mng_init_rgb16_i
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_RGB16_I
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_rgb16
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_rgb16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_rgb16
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_rgb16
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
literal|0
expr_stmt|;
comment|/* from 0..6; is 1..7 in specifications */
name|pData
operator|->
name|iRow
operator|=
name|interlace_row
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
name|interlace_rowskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
name|interlace_col
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
name|interlace_colskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
name|interlace_roundoff
index|[
literal|0
index|]
operator|)
operator|>>
name|interlace_divider
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|6
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|*
literal|6
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|*
literal|6
operator|)
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|6
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* intermediate row is 16-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_RGB16_I
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_init_idx1_ni
name|mng_retcode
name|mng_init_idx1_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_IDX1_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_idx1
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_idx1
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_idx1
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_idx1
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|7
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|3
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
operator|(
name|pData
operator|->
name|iRowsamples
operator|+
literal|7
operator|)
operator|>>
literal|3
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_IDX1_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_idx1_i
name|mng_retcode
name|mng_init_idx1_i
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_IDX1_I
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_idx1
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_idx1
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_idx1
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_idx1
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
literal|0
expr_stmt|;
comment|/* from 0..6; is 1..7 in specifications */
name|pData
operator|->
name|iRow
operator|=
name|interlace_row
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
name|interlace_rowskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
name|interlace_col
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
name|interlace_colskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
name|interlace_roundoff
index|[
literal|0
index|]
operator|)
operator|>>
name|interlace_divider
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|7
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|3
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
operator|(
name|pData
operator|->
name|iRowsamples
operator|+
literal|7
operator|)
operator|>>
literal|3
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
operator|(
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
literal|7
operator|)
operator|>>
literal|3
operator|)
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_IDX1_I
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_idx2_ni
name|mng_retcode
name|mng_init_idx2_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_IDX2_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_idx2
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_idx2
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_idx2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_idx2
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|3
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|2
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
operator|(
name|pData
operator|->
name|iRowsamples
operator|+
literal|3
operator|)
operator|>>
literal|2
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_IDX2_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_idx2_i
name|mng_retcode
name|mng_init_idx2_i
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_IDX2_I
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_idx2
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_idx2
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_idx2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_idx2
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
literal|0
expr_stmt|;
comment|/* from 0..6; is 1..7 in specifications */
name|pData
operator|->
name|iRow
operator|=
name|interlace_row
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
name|interlace_rowskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
name|interlace_col
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
name|interlace_colskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
name|interlace_roundoff
index|[
literal|0
index|]
operator|)
operator|>>
name|interlace_divider
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|3
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|2
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
operator|(
name|pData
operator|->
name|iRowsamples
operator|+
literal|3
operator|)
operator|>>
literal|2
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
operator|(
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
literal|3
operator|)
operator|>>
literal|2
operator|)
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_IDX2_I
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_idx4_ni
name|mng_retcode
name|mng_init_idx4_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_IDX4_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_idx4
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_idx4
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_idx4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_idx4
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
operator|(
name|pData
operator|->
name|iRowsamples
operator|+
literal|1
operator|)
operator|>>
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_IDX4_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_idx4_i
name|mng_retcode
name|mng_init_idx4_i
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_IDX4_I
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_idx4
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_idx4
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_idx4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_idx4
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
literal|0
expr_stmt|;
comment|/* from 0..6; is 1..7 in specifications */
name|pData
operator|->
name|iRow
operator|=
name|interlace_row
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
name|interlace_rowskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
name|interlace_col
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
name|interlace_colskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
name|interlace_roundoff
index|[
literal|0
index|]
operator|)
operator|>>
name|interlace_divider
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
operator|(
name|pData
operator|->
name|iRowsamples
operator|+
literal|1
operator|)
operator|>>
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
operator|(
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
literal|1
operator|)
operator|>>
literal|1
operator|)
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_IDX4_I
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_idx8_ni
name|mng_retcode
name|mng_init_idx8_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_IDX8_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_idx8
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_idx8
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_idx8
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_idx8
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_IDX8_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_idx8_i
name|mng_retcode
name|mng_init_idx8_i
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_IDX8_I
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_idx8
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_idx8
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_idx8
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_idx8
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
literal|0
expr_stmt|;
comment|/* from 0..6; is 1..7 in specifications */
name|pData
operator|->
name|iRow
operator|=
name|interlace_row
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
name|interlace_rowskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
name|interlace_col
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
name|interlace_colskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
name|interlace_roundoff
index|[
literal|0
index|]
operator|)
operator|>>
name|interlace_divider
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iDatawidth
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_IDX8_I
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_ga8_ni
name|mng_retcode
name|mng_init_ga8_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_GA8_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_ga8
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_ga8
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_ga8
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_ga8
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|2
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|<<
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|2
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_GA8_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_ga8_i
name|mng_retcode
name|mng_init_ga8_i
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_GA8_I
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_ga8
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_ga8
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_ga8
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_ga8
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
literal|0
expr_stmt|;
comment|/* from 0..6; is 1..7 in specifications */
name|pData
operator|->
name|iRow
operator|=
name|interlace_row
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
name|interlace_rowskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
name|interlace_col
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
name|interlace_colskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
name|interlace_roundoff
index|[
literal|0
index|]
operator|)
operator|>>
name|interlace_divider
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|2
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|<<
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|<<
literal|1
operator|)
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|2
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_GA8_I
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_init_ga16_ni
name|mng_retcode
name|mng_init_ga16_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_GA16_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_ga16
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_ga16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_ga16
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_ga16
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|4
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|<<
literal|2
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|4
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* intermediate row is 16-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_GA16_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_init_ga16_i
name|mng_retcode
name|mng_init_ga16_i
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_GA16_I
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_ga16
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_ga16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_ga16
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_ga16
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
literal|0
expr_stmt|;
comment|/* from 0..6; is 1..7 in specifications */
name|pData
operator|->
name|iRow
operator|=
name|interlace_row
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
name|interlace_rowskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
name|interlace_col
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
name|interlace_colskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
name|interlace_roundoff
index|[
literal|0
index|]
operator|)
operator|>>
name|interlace_divider
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|4
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|<<
literal|2
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|<<
literal|2
operator|)
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|4
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* intermediate row is 16-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_GA16_I
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_rgba8_ni
name|mng_retcode
name|mng_init_rgba8_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_RGBA8_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_rgba8
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_rgba8
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_rgba8
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_rgba8
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|4
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|<<
literal|2
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|4
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_RGBA8_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_rgba8_i
name|mng_retcode
name|mng_init_rgba8_i
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_RGBA8_I
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_rgba8
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_rgba8
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_rgba8
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_rgba8
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
literal|0
expr_stmt|;
comment|/* from 0..6; is 1..7 in specifications */
name|pData
operator|->
name|iRow
operator|=
name|interlace_row
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
name|interlace_rowskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
name|interlace_col
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
name|interlace_colskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
name|interlace_roundoff
index|[
literal|0
index|]
operator|)
operator|>>
name|interlace_divider
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|4
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|<<
literal|2
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|<<
literal|2
operator|)
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|4
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* intermediate row is 8-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_RGBA8_I
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_init_rgba16_ni
name|mng_retcode
name|mng_init_rgba16_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_RGBA16_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_rgba16
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_rgba16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_rgba16
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_rgba16
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|8
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|<<
literal|3
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|8
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* intermediate row is 16-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_RGBA16_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_init_rgba16_i
name|mng_retcode
name|mng_init_rgba16_i
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_RGBA16_I
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_rgba16
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
comment|/* immediate delta ? */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_rgba16
expr_stmt|;
else|else
endif|#
directive|endif
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_rgba16
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_rgba16
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
literal|0
expr_stmt|;
comment|/* from 0..6; (1..7 in specification) */
name|pData
operator|->
name|iRow
operator|=
name|interlace_row
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
name|interlace_rowskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
name|interlace_col
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
name|interlace_colskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
name|interlace_roundoff
index|[
literal|0
index|]
operator|)
operator|>>
name|interlace_divider
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|8
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|<<
literal|3
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|<<
literal|3
operator|)
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|8
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* intermediate row is 16-bit deep */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_RGBA16_I
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Row processing initialization routines (JPEG) - set up the variables   * */
end_comment
begin_comment
comment|/* * needed to process uncompressed row-data                                * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
end_ifdef
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_init_jpeg_a1_ni
name|mng_retcode
name|mng_init_jpeg_a1_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_JPEG_A1_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
if|if
condition|(
name|pData
operator|->
name|iJHDRimgbitdepth
operator|==
literal|8
condition|)
block|{
switch|switch
condition|(
name|pData
operator|->
name|iJHDRcolortype
condition|)
block|{
case|case
literal|12
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_g8_a1
expr_stmt|;
break|break;
block|}
case|case
literal|14
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_rgb8_a1
expr_stmt|;
break|break;
block|}
block|}
block|}
comment|/* TODO: bitdepth 12& 20 */
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g1
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|7
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|3
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
operator|(
name|pData
operator|->
name|iRowsamples
operator|+
literal|7
operator|)
operator|>>
literal|3
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_JPEG_A1_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_jpeg_a2_ni
name|mng_retcode
name|mng_init_jpeg_a2_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_JPEG_A2_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
if|if
condition|(
name|pData
operator|->
name|iJHDRimgbitdepth
operator|==
literal|8
condition|)
block|{
switch|switch
condition|(
name|pData
operator|->
name|iJHDRcolortype
condition|)
block|{
case|case
literal|12
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_g8_a2
expr_stmt|;
break|break;
block|}
case|case
literal|14
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_rgb8_a2
expr_stmt|;
break|break;
block|}
block|}
block|}
comment|/* TODO: bitdepth 12& 20 */
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g2
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|3
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|2
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
operator|(
name|pData
operator|->
name|iRowsamples
operator|+
literal|3
operator|)
operator|>>
literal|2
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_JPEG_A2_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_jpeg_a4_ni
name|mng_retcode
name|mng_init_jpeg_a4_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_JPEG_A4_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
if|if
condition|(
name|pData
operator|->
name|iJHDRimgbitdepth
operator|==
literal|8
condition|)
block|{
switch|switch
condition|(
name|pData
operator|->
name|iJHDRcolortype
condition|)
block|{
case|case
literal|12
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_g8_a4
expr_stmt|;
break|break;
block|}
case|case
literal|14
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_rgb8_a4
expr_stmt|;
break|break;
block|}
block|}
block|}
comment|/* TODO: bitdepth 12& 20 */
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g4
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
operator|(
name|pData
operator|->
name|iRowsamples
operator|+
literal|1
operator|)
operator|>>
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_JPEG_A4_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_jpeg_a8_ni
name|mng_retcode
name|mng_init_jpeg_a8_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_JPEG_A8_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
if|if
condition|(
name|pData
operator|->
name|iJHDRimgbitdepth
operator|==
literal|8
condition|)
block|{
switch|switch
condition|(
name|pData
operator|->
name|iJHDRcolortype
condition|)
block|{
case|case
literal|12
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_g8_a8
expr_stmt|;
break|break;
block|}
case|case
literal|14
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_rgb8_a8
expr_stmt|;
break|break;
block|}
block|}
block|}
comment|/* TODO: bitdepth 12& 20 */
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g8
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_JPEG_A8_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_init_jpeg_a16_ni
name|mng_retcode
name|mng_init_jpeg_a16_ni
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_JPEG_A16_NI
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
if|if
condition|(
name|pData
operator|->
name|iJHDRimgbitdepth
operator|==
literal|8
condition|)
block|{
switch|switch
condition|(
name|pData
operator|->
name|iJHDRcolortype
condition|)
block|{
case|case
literal|12
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_g8_a16
expr_stmt|;
break|break;
block|}
case|case
literal|14
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_rgb8_a16
expr_stmt|;
break|break;
block|}
block|}
block|}
comment|/* TODO: bitdepth 12& 20 */
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g16
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|2
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|<<
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|2
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_JPEG_A16_NI
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|mng_init_rowproc
argument_list|(
name|pData
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_INCLUDE_JNG */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_INIT */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Generic row processing initialization& cleanup routines               * */
end_comment
begin_comment
comment|/* * - initialize the buffers used by the row processing routines           * */
end_comment
begin_comment
comment|/* * - cleanup the buffers used by the row processing routines              * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_init_rowproc
name|mng_retcode
name|mng_init_rowproc
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_ROWPROC
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_INIT
if|if
condition|(
name|pData
operator|->
name|ePng_imgtype
operator|!=
name|png_none
condition|)
block|{
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
switch|switch
condition|(
name|pData
operator|->
name|ePng_imgtype
condition|)
block|{
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
case|case
name|png_g1
case|:
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_g1
expr_stmt|;
break|break;
case|case
name|png_g2
case|:
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_g2
expr_stmt|;
break|break;
case|case
name|png_g4
case|:
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_g4
expr_stmt|;
break|break;
endif|#
directive|endif
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
case|case
name|png_g8
case|:
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_g8
expr_stmt|;
break|break;
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
case|case
name|png_idx1
case|:
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_idx1
expr_stmt|;
break|break;
case|case
name|png_idx2
case|:
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_idx2
expr_stmt|;
break|break;
case|case
name|png_idx4
case|:
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_idx4
expr_stmt|;
break|break;
endif|#
directive|endif
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
case|case
name|png_idx8
case|:
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_idx8
expr_stmt|;
break|break;
case|case
name|png_ga8
case|:
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_ga8
expr_stmt|;
break|break;
case|case
name|png_rgb8
case|:
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_rgb8
expr_stmt|;
break|break;
case|case
name|png_rgba8
case|:
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_rgba8
expr_stmt|;
break|break;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
case|case
name|png_g16
case|:
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_g16
expr_stmt|;
break|break;
case|case
name|png_ga16
case|:
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_ga16
expr_stmt|;
break|break;
case|case
name|png_rgb16
case|:
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_rgb16
expr_stmt|;
break|break;
case|case
name|png_rgba16
case|:
name|pData
operator|->
name|fProcessrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_process_rgba16
expr_stmt|;
break|break;
endif|#
directive|endif
default|default:
break|break;
block|}
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* store in object too ? */
block|{
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
if|if
condition|(
operator|(
name|pData
operator|->
name|bHasDHDR
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bDeltaimmediate
operator|)
condition|)
switch|switch
condition|(
name|pData
operator|->
name|ePng_imgtype
condition|)
block|{
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
case|case
name|png_g1
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_g1
expr_stmt|;
break|break;
case|case
name|png_g2
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_g2
expr_stmt|;
break|break;
case|case
name|png_g4
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_g4
expr_stmt|;
break|break;
endif|#
directive|endif
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
case|case
name|png_g8
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_g8
expr_stmt|;
break|break;
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
case|case
name|png_idx1
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_idx1
expr_stmt|;
break|break;
case|case
name|png_idx2
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_idx2
expr_stmt|;
break|break;
case|case
name|png_idx4
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_idx4
expr_stmt|;
break|break;
endif|#
directive|endif
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
case|case
name|png_idx8
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_idx8
expr_stmt|;
break|break;
case|case
name|png_ga8
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_ga8
expr_stmt|;
break|break;
case|case
name|png_rgb8
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_rgb8
expr_stmt|;
break|break;
case|case
name|png_rgba8
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_rgba8
expr_stmt|;
break|break;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
case|case
name|png_g16
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_g16
expr_stmt|;
break|break;
case|case
name|png_ga16
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_ga16
expr_stmt|;
break|break;
case|case
name|png_rgb16
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_rgb16
expr_stmt|;
break|break;
case|case
name|png_rgba16
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_delta_rgba16
expr_stmt|;
break|break;
endif|#
directive|endif
default|default:
break|break;
block|}
else|else
endif|#
directive|endif
comment|/* MNG_NO_DELTA_PNG */
switch|switch
condition|(
name|pData
operator|->
name|ePng_imgtype
condition|)
block|{
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
case|case
name|png_g1
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_g1
expr_stmt|;
break|break;
case|case
name|png_g2
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_g2
expr_stmt|;
break|break;
case|case
name|png_g4
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_g4
expr_stmt|;
break|break;
endif|#
directive|endif
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
case|case
name|png_g8
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_g8
expr_stmt|;
break|break;
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
case|case
name|png_idx1
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_idx1
expr_stmt|;
break|break;
case|case
name|png_idx2
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_idx2
expr_stmt|;
break|break;
case|case
name|png_idx4
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_idx4
expr_stmt|;
break|break;
endif|#
directive|endif
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
case|case
name|png_idx8
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_idx8
expr_stmt|;
break|break;
case|case
name|png_ga8
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_ga8
expr_stmt|;
break|break;
case|case
name|png_rgb8
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_rgb8
expr_stmt|;
break|break;
case|case
name|png_rgba8
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_rgba8
expr_stmt|;
break|break;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
case|case
name|png_g16
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_g16
expr_stmt|;
break|break;
case|case
name|png_ga16
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_ga16
expr_stmt|;
break|break;
case|case
name|png_rgb16
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_rgb16
expr_stmt|;
break|break;
case|case
name|png_rgba16
case|:
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_rgba16
expr_stmt|;
break|break;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
case|case
name|png_jpeg_a1
case|:
comment|/*  if (pData->iJHDRimgbitdepth == 8) */
block|{
switch|switch
condition|(
name|pData
operator|->
name|iJHDRcolortype
condition|)
block|{
case|case
literal|12
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_g8_a1
expr_stmt|;
break|break;
block|}
case|case
literal|14
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_rgb8_a1
expr_stmt|;
break|break;
block|}
block|}
block|}
comment|/* TODO: bitdepth 12& 20 */
break|break;
case|case
name|png_jpeg_a2
case|:
comment|/*  if (pData->iJHDRimgbitdepth == 8) */
block|{
switch|switch
condition|(
name|pData
operator|->
name|iJHDRcolortype
condition|)
block|{
case|case
literal|12
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_g8_a2
expr_stmt|;
break|break;
block|}
case|case
literal|14
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_rgb8_a2
expr_stmt|;
break|break;
block|}
block|}
block|}
break|break;
comment|/* TODO: bitdepth 12& 20 */
case|case
name|png_jpeg_a4
case|:
comment|/*  if (pData->iJHDRimgbitdepth == 8) */
block|{
switch|switch
condition|(
name|pData
operator|->
name|iJHDRcolortype
condition|)
block|{
case|case
literal|12
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_g8_a4
expr_stmt|;
break|break;
block|}
case|case
literal|14
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_rgb8_a4
expr_stmt|;
break|break;
block|}
block|}
block|}
break|break;
endif|#
directive|endif
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
comment|/* TODO: bitdepth 12& 20 */
case|case
name|png_jpeg_a8
case|:
comment|/*  if (pData->iJHDRimgbitdepth == 8) */
block|{
switch|switch
condition|(
name|pData
operator|->
name|iJHDRcolortype
condition|)
block|{
case|case
literal|12
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_g8_a8
expr_stmt|;
break|break;
block|}
case|case
literal|14
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_rgb8_a8
expr_stmt|;
break|break;
block|}
block|}
block|}
break|break;
comment|/* TODO: bitdepth 12& 20 */
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
case|case
name|png_jpeg_a16
case|:
comment|/*  if (pData->iJHDRimgbitdepth == 8) */
block|{
switch|switch
condition|(
name|pData
operator|->
name|iJHDRcolortype
condition|)
block|{
case|case
literal|12
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_g8_a16
expr_stmt|;
break|break;
block|}
case|case
literal|14
case|:
block|{
name|pData
operator|->
name|fStorerow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_store_jpeg_rgb8_a16
expr_stmt|;
break|break;
block|}
block|}
block|}
break|break;
comment|/* TODO: bitdepth 12& 20 */
endif|#
directive|endif
endif|#
directive|endif
comment|/* MNG_INCLUDE_JNG */
default|default:
break|break;
block|}
block|}
ifdef|#
directive|ifdef
name|FILTER192
comment|/* leveling& differing ? */
if|if
condition|(
name|pData
operator|->
name|iFilter
operator|==
name|MNG_FILTER_DIFFERING
condition|)
switch|switch
condition|(
name|pData
operator|->
name|ePng_imgtype
condition|)
block|{
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
case|case
name|png_g1
case|:
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
case|case
name|png_jpeg_a1
case|:
endif|#
directive|endif
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g1
expr_stmt|;
break|break;
case|case
name|png_g2
case|:
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
case|case
name|png_jpeg_a2
case|:
endif|#
directive|endif
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g2
expr_stmt|;
break|break;
case|case
name|png_g4
case|:
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
case|case
name|png_jpeg_a4
case|:
endif|#
directive|endif
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g4
expr_stmt|;
break|break;
endif|#
directive|endif
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
case|case
name|png_g8
case|:
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
case|case
name|png_jpeg_a8
case|:
endif|#
directive|endif
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g8
expr_stmt|;
break|break;
case|case
name|png_rgb8
case|:
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_rgb8
expr_stmt|;
break|break;
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
case|case
name|png_idx1
case|:
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_idx1
expr_stmt|;
break|break;
case|case
name|png_idx2
case|:
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_idx2
expr_stmt|;
break|break;
case|case
name|png_idx4
case|:
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_idx4
expr_stmt|;
break|break;
endif|#
directive|endif
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
case|case
name|png_idx8
case|:
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_idx8
expr_stmt|;
break|break;
case|case
name|png_ga8
case|:
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_ga8
expr_stmt|;
break|break;
case|case
name|png_rgb8
case|:
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_rgb8
expr_stmt|;
break|break;
case|case
name|png_rgba8
case|:
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_rgba8
expr_stmt|;
break|break;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
case|case
name|png_g16
case|:
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
case|case
name|png_jpeg_a16
case|:
endif|#
directive|endif
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_g16
expr_stmt|;
break|break;
case|case
name|png_ga16
case|:
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_ga16
expr_stmt|;
break|break;
case|case
name|png_rgb16
case|:
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_rgb16
expr_stmt|;
break|break;
case|case
name|png_rgba16
case|:
name|pData
operator|->
name|fDifferrow
operator|=
operator|(
name|mng_fptr
operator|)
name|mng_differ_rgba16
expr_stmt|;
break|break;
endif|#
directive|endif
default|default:
break|break;
block|}
endif|#
directive|endif
switch|switch
condition|(
name|pData
operator|->
name|ePng_imgtype
condition|)
block|{
ifndef|#
directive|ifndef
name|MNG_NO_1_2_4BIT_SUPPORT
case|case
name|png_g1
case|:
case|case
name|png_idx1
case|:
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
case|case
name|png_jpeg_a1
case|:
endif|#
directive|endif
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|7
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|3
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|png_g2
case|:
case|case
name|png_idx2
case|:
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
case|case
name|png_jpeg_a2
case|:
endif|#
directive|endif
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|3
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|2
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|png_g4
case|:
case|case
name|png_idx4
case|:
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
case|case
name|png_jpeg_a4
case|:
endif|#
directive|endif
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
break|break;
endif|#
directive|endif
comment|/* MNG_NO_1_2_4BIT_SUPPORT */
case|case
name|png_g8
case|:
case|case
name|png_idx8
case|:
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
case|case
name|png_jpeg_a8
case|:
endif|#
directive|endif
name|pData
operator|->
name|iSamplemul
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
break|break;
case|case
name|png_ga8
case|:
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
case|case
name|png_g16
case|:
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
case|case
name|png_jpeg_a16
case|:
endif|#
directive|endif
endif|#
directive|endif
name|pData
operator|->
name|iSamplemul
operator|=
literal|2
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|2
expr_stmt|;
break|break;
case|case
name|png_rgb8
case|:
name|pData
operator|->
name|iSamplemul
operator|=
literal|3
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|3
expr_stmt|;
break|break;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
case|case
name|png_ga16
case|:
endif|#
directive|endif
case|case
name|png_rgba8
case|:
name|pData
operator|->
name|iSamplemul
operator|=
literal|4
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|4
expr_stmt|;
break|break;
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
case|case
name|png_rgb16
case|:
name|pData
operator|->
name|iSamplemul
operator|=
literal|6
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|6
expr_stmt|;
break|break;
case|case
name|png_rgba16
case|:
name|pData
operator|->
name|iSamplemul
operator|=
literal|8
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|8
expr_stmt|;
break|break;
endif|#
directive|endif
default|default:
break|break;
block|}
if|if
condition|(
name|pData
operator|->
name|iInterlace
condition|)
comment|/* noninterlaced */
block|{
name|pData
operator|->
name|iPass
operator|=
literal|0
expr_stmt|;
comment|/* from 0..6; (1..7 in specification) */
name|pData
operator|->
name|iRow
operator|=
name|interlace_row
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
name|interlace_rowskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
name|interlace_col
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
name|interlace_colskip
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|+
name|interlace_roundoff
index|[
literal|0
index|]
operator|)
operator|>>
name|interlace_divider
index|[
literal|0
index|]
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
operator|(
operator|(
name|pData
operator|->
name|iDatawidth
operator|*
name|pData
operator|->
name|iSamplemul
operator|+
name|pData
operator|->
name|iSampleofs
operator|)
operator|>>
name|pData
operator|->
name|iSamplediv
operator|)
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
block|}
else|else
comment|/* interlaced */
block|{
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
name|pData
operator|->
name|iDatawidth
expr_stmt|;
block|}
if|if
condition|(
name|pData
operator|->
name|iSamplediv
operator|>
literal|0
condition|)
name|pData
operator|->
name|iRowsize
operator|=
operator|(
name|pData
operator|->
name|iRowsamples
operator|+
name|pData
operator|->
name|iSampleofs
operator|)
operator|>>
name|pData
operator|->
name|iSamplediv
expr_stmt|;
else|else
name|pData
operator|->
name|iRowsize
operator|=
operator|(
name|pData
operator|->
name|iRowsamples
operator|*
name|pData
operator|->
name|iSamplemul
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|pData
operator|->
name|iInterlace
condition|)
comment|/* noninterlaced */
name|pData
operator|->
name|iRowmax
operator|=
name|pData
operator|->
name|iRowsize
operator|+
name|pData
operator|->
name|iPixelofs
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_NO_16BIT_SUPPORT
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
else|#
directive|else
switch|switch
condition|(
name|pData
operator|->
name|ePng_imgtype
condition|)
block|{
case|case
name|png_g16
case|:
case|case
name|png_ga16
case|:
case|case
name|png_rgb16
case|:
case|case
name|png_rgba16
case|:
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_TRUE
expr_stmt|;
break|break;
default|default:
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_FALSE
expr_stmt|;
break|break;
block|}
endif|#
directive|endif
block|}
endif|#
directive|endif
comment|/* MNG_OPTIMIZE_FOOTPRINT_INIT */
if|if
condition|(
name|pData
operator|->
name|pStoreobj
condition|)
comment|/* storage object selected ? */
block|{
name|pData
operator|->
name|pStorebuf
operator|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
expr_stmt|;
comment|/* and so it becomes viewable ! */
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|bViewable
operator|=
name|MNG_TRUE
expr_stmt|;
operator|(
operator|(
name|mng_imagedatap
operator|)
name|pData
operator|->
name|pStorebuf
operator|)
operator|->
name|bViewable
operator|=
name|MNG_TRUE
expr_stmt|;
block|}
comment|/* allocate the buffers; the individual init routines have already      calculated the required maximum size; except in the case of a JNG      without alpha!!! */
if|if
condition|(
name|pData
operator|->
name|iRowmax
condition|)
block|{
if|#
directive|if
name|defined
argument_list|(
name|MNG_NO_16BIT_SUPPORT
argument_list|)
operator|||
name|defined
argument_list|(
name|MNG_NO_1_2_4BIT_SUPPORT
argument_list|)
name|mng_uint8
name|iRowadd
init|=
literal|0
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_NO_1_2_4BIT_SUPPORT
if|if
condition|(
name|pData
operator|->
name|iPNGdepth
operator|<
literal|8
condition|)
name|iRowadd
operator|=
operator|(
name|pData
operator|->
name|iPNGdepth
operator|*
name|pData
operator|->
name|iRowmax
operator|+
literal|7
operator|)
operator|/
literal|8
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_NO_16BIT_SUPPORT
if|if
condition|(
name|pData
operator|->
name|iPNGdepth
operator|>
literal|8
condition|)
name|iRowadd
operator|=
name|pData
operator|->
name|iRowmax
expr_stmt|;
endif|#
directive|endif
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pWorkrow
argument_list|,
name|pData
operator|->
name|iRowmax
operator|+
name|iRowadd
argument_list|)
expr_stmt|;
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pPrevrow
argument_list|,
name|pData
operator|->
name|iRowmax
operator|+
name|iRowadd
argument_list|)
expr_stmt|;
else|#
directive|else
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pWorkrow
argument_list|,
name|pData
operator|->
name|iRowmax
argument_list|)
expr_stmt|;
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pPrevrow
argument_list|,
name|pData
operator|->
name|iRowmax
argument_list|)
expr_stmt|;
endif|#
directive|endif
block|}
comment|/* allocate an RGBA16 row for intermediate processing */
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pRGBArow
argument_list|,
operator|(
name|pData
operator|->
name|iDatawidth
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_CMS
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
comment|/* display "on-the-fly" ? */
block|{
if|#
directive|if
name|defined
argument_list|(
name|MNG_FULL_CMS
argument_list|)
comment|/* determine color-management initialization */
name|mng_retcode
name|iRetcode
init|=
name|mng_init_full_cms
argument_list|(
name|pData
argument_list|,
name|MNG_TRUE
argument_list|,
name|MNG_TRUE
argument_list|,
name|MNG_FALSE
argument_list|)
decl_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|MNG_GAMMA_ONLY
argument_list|)
name|mng_retcode
name|iRetcode
init|=
name|mng_init_gamma_only
argument_list|(
name|pData
argument_list|,
name|MNG_TRUE
argument_list|,
name|MNG_TRUE
argument_list|,
name|MNG_FALSE
argument_list|)
decl_stmt|;
elif|#
directive|elif
name|defined
argument_list|(
name|MNG_APP_CMS
argument_list|)
name|mng_retcode
name|iRetcode
init|=
name|mng_init_app_cms
argument_list|(
name|pData
argument_list|,
name|MNG_TRUE
argument_list|,
name|MNG_TRUE
argument_list|,
name|MNG_FALSE
argument_list|)
decl_stmt|;
endif|#
directive|endif
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
block|}
endif|#
directive|endif
comment|/* !MNG_NO_CMS */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INIT_ROWPROC
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_next_row
name|mng_retcode
name|mng_next_row
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_NEXT_ROW
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iRow
operator|+=
name|pData
operator|->
name|iRowinc
expr_stmt|;
comment|/* increase the row counter */
if|if
condition|(
name|pData
operator|->
name|iPass
operator|>=
literal|0
condition|)
comment|/* interlaced ? */
block|{
while|while
condition|(
operator|(
name|pData
operator|->
name|iPass
operator|<
literal|7
operator|)
operator|&&
comment|/* went 'outside' the image ? */
operator|(
operator|(
name|pData
operator|->
name|iRow
operator|>=
operator|(
name|mng_int32
operator|)
name|pData
operator|->
name|iDataheight
operator|)
operator|||
operator|(
name|pData
operator|->
name|iCol
operator|>=
operator|(
name|mng_int32
operator|)
name|pData
operator|->
name|iDatawidth
operator|)
operator|)
condition|)
block|{
name|pData
operator|->
name|iPass
operator|++
expr_stmt|;
comment|/* next pass ! */
if|if
condition|(
name|pData
operator|->
name|iPass
operator|<
literal|7
condition|)
comment|/* there's only 7 passes ! */
block|{
name|pData
operator|->
name|iRow
operator|=
name|interlace_row
index|[
name|pData
operator|->
name|iPass
index|]
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
name|interlace_rowskip
index|[
name|pData
operator|->
name|iPass
index|]
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
name|interlace_col
index|[
name|pData
operator|->
name|iPass
index|]
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
name|interlace_colskip
index|[
name|pData
operator|->
name|iPass
index|]
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
operator|(
name|pData
operator|->
name|iDatawidth
operator|-
name|pData
operator|->
name|iCol
operator|+
name|interlace_roundoff
index|[
name|pData
operator|->
name|iPass
index|]
operator|)
operator|>>
name|interlace_divider
index|[
name|pData
operator|->
name|iPass
index|]
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|iSamplemul
operator|>
literal|1
condition|)
comment|/* recalculate row dimension */
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
operator|*
name|pData
operator|->
name|iSamplemul
expr_stmt|;
elseif|else
if|if
condition|(
name|pData
operator|->
name|iSamplediv
operator|>
literal|0
condition|)
name|pData
operator|->
name|iRowsize
operator|=
operator|(
name|pData
operator|->
name|iRowsamples
operator|+
name|pData
operator|->
name|iSampleofs
operator|)
operator|>>
name|pData
operator|->
name|iSamplediv
expr_stmt|;
else|else
name|pData
operator|->
name|iRowsize
operator|=
name|pData
operator|->
name|iRowsamples
expr_stmt|;
block|}
if|if
condition|(
operator|(
name|pData
operator|->
name|iPass
operator|<
literal|7
operator|)
operator|&&
comment|/* reset previous row to zeroes ? */
operator|(
name|pData
operator|->
name|iRow
operator|<
operator|(
name|mng_int32
operator|)
name|pData
operator|->
name|iDataheight
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iCol
operator|<
operator|(
name|mng_int32
operator|)
name|pData
operator|->
name|iDatawidth
operator|)
condition|)
block|{
comment|/* making sure the filters will work properly! */
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8p
name|pTemp
init|=
name|pData
operator|->
name|pPrevrow
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_NO_16BIT_SUPPORT
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iPNGmult
operator|*
name|pData
operator|->
name|iRowsize
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iPNGmult
operator|*
name|pData
operator|->
name|iRowsize
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
else|#
directive|else
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsize
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsize
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
endif|#
directive|endif
block|{
operator|*
name|pTemp
operator|=
literal|0
expr_stmt|;
name|pTemp
operator|++
expr_stmt|;
block|}
block|}
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_NEXT_ROW
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_cleanup_rowproc
name|mng_retcode
name|mng_cleanup_rowproc
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CLEANUP_ROWPROC
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_INCLUDE_LCMS
comment|/* cleanup cms profile/transform */
block|{
name|mng_retcode
name|iRetcode
init|=
name|mng_clear_cms
argument_list|(
name|pData
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
block|}
endif|#
directive|endif
comment|/* MNG_INCLUDE_LCMS */
if|if
condition|(
name|pData
operator|->
name|pRGBArow
condition|)
comment|/* cleanup buffer for intermediate row */
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pRGBArow
argument_list|,
operator|(
name|pData
operator|->
name|iDatawidth
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pPrevrow
condition|)
comment|/* cleanup buffer for previous row */
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pPrevrow
argument_list|,
name|pData
operator|->
name|iRowmax
argument_list|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|pWorkrow
condition|)
comment|/* cleanup buffer for working row */
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pWorkrow
argument_list|,
name|pData
operator|->
name|iRowmax
argument_list|)
expr_stmt|;
name|pData
operator|->
name|pWorkrow
operator|=
name|MNG_NULL
expr_stmt|;
comment|/* propogate uninitialized buffers */
name|pData
operator|->
name|pPrevrow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pRGBArow
operator|=
name|MNG_NULL
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_CLEANUP_ROWPROC
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
comment|/* woohiii */
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * Generic row processing routines for JNG                                * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
end_ifdef
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_display_jpeg_rows
name|mng_retcode
name|mng_display_jpeg_rows
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_JPEG_ROWS
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* any completed rows ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iJPEGrow
operator|>
name|pData
operator|->
name|iJPEGdisprow
operator|)
operator|&&
operator|(
name|pData
operator|->
name|iJPEGalpharow
operator|>
name|pData
operator|->
name|iJPEGdisprow
operator|)
condition|)
block|{
name|mng_uint32
name|iX
decl_stmt|,
name|iMax
decl_stmt|;
name|mng_uint32
name|iSaverow
init|=
name|pData
operator|->
name|iRow
decl_stmt|;
comment|/* save alpha decompression row-count */
comment|/* determine the highest complete(!) row */
if|if
condition|(
name|pData
operator|->
name|iJPEGrow
operator|>
name|pData
operator|->
name|iJPEGalpharow
condition|)
name|iMax
operator|=
name|pData
operator|->
name|iJPEGalpharow
expr_stmt|;
else|else
name|iMax
operator|=
name|pData
operator|->
name|iJPEGrow
expr_stmt|;
comment|/* display the rows */
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iJPEGdisprow
init|;
name|iX
operator|<
name|iMax
condition|;
name|iX
operator|++
control|)
block|{
name|pData
operator|->
name|iRow
operator|=
name|iX
expr_stmt|;
comment|/* make sure we all know which row to handle */
comment|/* makeup an intermediate row from the buffer */
name|iRetcode
operator|=
operator|(
operator|(
name|mng_retrieverow
operator|)
name|pData
operator|->
name|fRetrieverow
operator|)
operator|(
name|pData
operator|)
expr_stmt|;
comment|/* color-correct it if necessary */
if|if
condition|(
operator|(
operator|!
name|iRetcode
operator|)
operator|&&
operator|(
name|pData
operator|->
name|fCorrectrow
operator|)
condition|)
name|iRetcode
operator|=
operator|(
operator|(
name|mng_correctrow
operator|)
name|pData
operator|->
name|fCorrectrow
operator|)
operator|(
name|pData
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|iRetcode
condition|)
comment|/* and display it */
block|{
name|iRetcode
operator|=
operator|(
operator|(
name|mng_displayrow
operator|)
name|pData
operator|->
name|fDisplayrow
operator|)
operator|(
name|pData
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|iRetcode
condition|)
comment|/* check progressive display refresh */
name|iRetcode
operator|=
name|mng_display_progressive_check
argument_list|(
name|pData
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
block|}
name|pData
operator|->
name|iJPEGdisprow
operator|=
name|iMax
expr_stmt|;
comment|/* keep track of the last displayed row */
name|pData
operator|->
name|iRow
operator|=
name|iSaverow
expr_stmt|;
comment|/* restore alpha decompression row-count */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DISPLAY_JPEG_ROWS
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_next_jpeg_alpharow
name|mng_retcode
name|mng_next_jpeg_alpharow
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_NEXT_JPEG_ALPHAROW
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iJPEGalpharow
operator|++
expr_stmt|;
comment|/* count the row */
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
comment|/* display "on-the-fly" ? */
block|{
comment|/* try to display what you can */
name|iRetcode
operator|=
name|mng_display_jpeg_rows
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_NEXT_JPEG_ALPHAROW
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_next_jpeg_row
name|mng_retcode
name|mng_next_jpeg_row
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_NEXT_JPEG_ROW
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iJPEGrow
operator|++
expr_stmt|;
comment|/* increase the row-counter */
if|if
condition|(
name|pData
operator|->
name|fDisplayrow
condition|)
comment|/* display "on-the-fly" ? */
block|{
comment|/* has alpha channel ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iJHDRcolortype
operator|==
name|MNG_COLORTYPE_JPEGGRAYA
operator|)
operator|||
operator|(
name|pData
operator|->
name|iJHDRcolortype
operator|==
name|MNG_COLORTYPE_JPEGCOLORA
operator|)
condition|)
block|{
comment|/* try to display what you can */
name|iRetcode
operator|=
name|mng_display_jpeg_rows
argument_list|(
name|pData
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* make sure we all know which row to handle */
name|pData
operator|->
name|iRow
operator|=
name|pData
operator|->
name|iJPEGrow
operator|-
literal|1
expr_stmt|;
comment|/* makeup an intermediate row from the buffer */
name|iRetcode
operator|=
operator|(
operator|(
name|mng_retrieverow
operator|)
name|pData
operator|->
name|fRetrieverow
operator|)
operator|(
name|pData
operator|)
expr_stmt|;
comment|/* color-correct it if necessary */
if|if
condition|(
operator|(
operator|!
name|iRetcode
operator|)
operator|&&
operator|(
name|pData
operator|->
name|fCorrectrow
operator|)
condition|)
name|iRetcode
operator|=
operator|(
operator|(
name|mng_correctrow
operator|)
name|pData
operator|->
name|fCorrectrow
operator|)
operator|(
name|pData
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|iRetcode
condition|)
comment|/* and display it */
block|{
name|iRetcode
operator|=
operator|(
operator|(
name|mng_displayrow
operator|)
name|pData
operator|->
name|fDisplayrow
operator|)
operator|(
name|pData
operator|)
expr_stmt|;
if|if
condition|(
operator|!
name|iRetcode
condition|)
comment|/* check progressive display refresh */
name|iRetcode
operator|=
name|mng_display_progressive_check
argument_list|(
name|pData
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
block|}
comment|/* surpassed last filled row ? */
if|if
condition|(
name|pData
operator|->
name|iJPEGrow
operator|>
name|pData
operator|->
name|iJPEGrgbrow
condition|)
name|pData
operator|->
name|iJPEGrgbrow
operator|=
name|pData
operator|->
name|iJPEGrow
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_NEXT_JPEG_ROW
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_INCLUDE_JNG */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_MAGN
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_MAGN
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_GRAY_SUPPORT
end_ifndef
begin_function
DECL|function|mng_magnify_g8_x1
name|mng_retcode
name|mng_magnify_g8_x1
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|,
name|iS
decl_stmt|,
name|iM
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G8_X1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
name|iM
operator|=
name|iML
expr_stmt|;
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|1
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* fill interval */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
block|}
name|pTempsrc1
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G8_X1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_g8_x2
name|mng_retcode
name|mng_magnify_g8_x2
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G8_X2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|1
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
comment|/* is it same as first ? */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* then just repeat the first */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* calculate the distances */
block|{
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G8_X2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_g8_x3
name|mng_retcode
name|mng_magnify_g8_x3
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|,
name|iH
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G8_X3
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|1
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
comment|/* is it same as first ? */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* then just repeat the first */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
name|iH
operator|=
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
comment|/* calculate halfway point */
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iH
condition|;
name|iS
operator|++
control|)
comment|/* replicate first half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
for|for
control|(
name|iS
operator|=
name|iH
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* replicate second half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc2
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G8_X3
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_GRAY_SUPPORT */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgb8_x1
name|mng_retcode
name|mng_magnify_rgb8_x1
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|,
name|iS
decl_stmt|,
name|iM
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB8_X1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
name|iM
operator|=
name|iML
expr_stmt|;
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|1
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* fill interval */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
name|pTempsrc1
operator|+=
literal|3
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB8_X1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgb8_x2
name|mng_retcode
name|mng_magnify_rgb8_x2
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB8_X2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|3
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|3
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB8_X2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgb8_x3
name|mng_retcode
name|mng_magnify_rgb8_x3
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|,
name|iH
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB8_X3
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|3
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
name|iH
operator|=
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
comment|/* calculate halfway point */
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iH
condition|;
name|iS
operator|++
control|)
comment|/* replicate first half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|+=
literal|3
expr_stmt|;
block|}
for|for
control|(
name|iS
operator|=
name|iH
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* replicate second half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc2
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|+=
literal|3
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|3
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB8_X3
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_GRAY_SUPPORT
end_ifndef
begin_function
DECL|function|mng_magnify_ga8_x1
name|mng_retcode
name|mng_magnify_ga8_x1
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|,
name|iS
decl_stmt|,
name|iM
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_X1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
name|iM
operator|=
name|iML
expr_stmt|;
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|1
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* fill interval */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
name|pTempsrc1
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_X1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_ga8_x2
name|mng_retcode
name|mng_magnify_ga8_x2
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_X2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|2
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_X2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_ga8_x3
name|mng_retcode
name|mng_magnify_ga8_x3
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|,
name|iH
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_X3
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|2
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
name|iH
operator|=
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
comment|/* calculate halfway point */
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iH
condition|;
name|iS
operator|++
control|)
comment|/* replicate first half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|+=
literal|2
expr_stmt|;
block|}
for|for
control|(
name|iS
operator|=
name|iH
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* replicate second half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc2
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|+=
literal|2
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_X3
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_ga8_x4
name|mng_retcode
name|mng_magnify_ga8_x4
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|,
name|iH
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_X4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|2
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
name|iH
operator|=
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
comment|/* calculate halfway point */
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iH
condition|;
name|iS
operator|++
control|)
comment|/* first half */
block|{
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
comment|/* replicate alpha from left */
name|pTempdst
operator|++
expr_stmt|;
block|}
for|for
control|(
name|iS
operator|=
name|iH
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* second half */
block|{
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
expr_stmt|;
comment|/* replicate alpha from right */
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_X4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_ga8_x5
name|mng_retcode
name|mng_magnify_ga8_x5
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|,
name|iH
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_X5
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|2
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
name|iH
operator|=
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
comment|/* calculate halfway point */
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iH
condition|;
name|iS
operator|++
control|)
comment|/* first half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* replicate gray from left */
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
for|for
control|(
name|iS
operator|=
name|iH
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* second half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc2
expr_stmt|;
comment|/* replicate gray from right */
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_X5
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_GRAY_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_MAGN */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba8_x1
name|mng_retcode
name|mng_magnify_rgba8_x1
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|,
name|iS
decl_stmt|,
name|iM
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_X1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
name|iM
operator|=
name|iML
expr_stmt|;
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|1
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* fill interval */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
name|pTempsrc1
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_X1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba8_x2
name|mng_retcode
name|mng_magnify_rgba8_x2
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_X2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|4
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|3
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc2
operator|+
literal|3
operator|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_X2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba8_x3
name|mng_retcode
name|mng_magnify_rgba8_x3
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|,
name|iH
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_X3
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|4
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
name|iH
operator|=
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
comment|/* calculate halfway point */
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iH
condition|;
name|iS
operator|++
control|)
comment|/* replicate first half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|+=
literal|4
expr_stmt|;
block|}
for|for
control|(
name|iS
operator|=
name|iH
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* replicate second half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc2
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|+=
literal|4
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_X3
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba8_x4
name|mng_retcode
name|mng_magnify_rgba8_x4
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|,
name|iH
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_X4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|4
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
name|iH
operator|=
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
comment|/* calculate halfway point */
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iH
condition|;
name|iS
operator|++
control|)
comment|/* first half */
block|{
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
comment|/* replicate alpha from left */
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
for|for
control|(
name|iS
operator|=
name|iH
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* second half */
block|{
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
comment|/* replicate alpha from right */
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_X4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba8_x5
name|mng_retcode
name|mng_magnify_rgba8_x5
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|,
name|iH
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_X5
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|4
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
name|iH
operator|=
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
comment|/* calculate halfway point */
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iH
condition|;
name|iS
operator|++
control|)
comment|/* first half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* replicate color from left */
operator|*
operator|(
name|pTempdst
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|3
operator|)
condition|)
operator|*
operator|(
name|pTempdst
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
else|else
operator|*
operator|(
name|pTempdst
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc2
operator|+
literal|3
operator|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|+=
literal|4
expr_stmt|;
block|}
for|for
control|(
name|iS
operator|=
name|iH
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* second half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc2
expr_stmt|;
comment|/* replicate color from right */
operator|*
operator|(
name|pTempdst
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|3
operator|)
condition|)
operator|*
operator|(
name|pTempdst
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
else|else
operator|*
operator|(
name|pTempdst
operator|+
literal|3
operator|)
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc2
operator|+
literal|3
operator|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|+=
literal|4
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_X4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_MAGN
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_GRAY_SUPPORT
end_ifndef
begin_function
DECL|function|mng_magnify_g8_y1
name|mng_retcode
name|mng_magnify_g8_y1
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G8_Y1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline1
argument_list|,
name|iWidth
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G8_Y1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_g8_y2
name|mng_retcode
name|mng_magnify_g8_y2
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G8_Y2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline1
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempsrc2
operator|=
name|pSrcline2
expr_stmt|;
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have a second line ? */
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
comment|/* calculate the distances */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pTempdst
argument_list|,
name|pTempsrc1
argument_list|,
name|iWidth
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G8_Y2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_g8_y3
name|mng_retcode
name|mng_magnify_g8_y3
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G8_Y3
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pSrcline2
condition|)
comment|/* do we have a second line ? */
block|{
if|if
condition|(
name|iS
operator|<
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
condition|)
comment|/* top half ? */
name|MNG_COPY
argument_list|(
argument|pDstline
argument_list|,
argument|pSrcline1
argument_list|,
argument|iWidth
argument_list|)
else|else
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline2
argument_list|,
name|iWidth
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline1
argument_list|,
name|iWidth
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G8_Y3
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_GRAY_SUPPORT */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgb8_y1
name|mng_retcode
name|mng_magnify_rgb8_y1
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB8_Y1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline1
argument_list|,
name|iWidth
operator|*
literal|3
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB8_Y1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgb8_y2
name|mng_retcode
name|mng_magnify_rgb8_y2
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB8_Y2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline1
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempsrc2
operator|=
name|pSrcline2
expr_stmt|;
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have a second line ? */
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
comment|/* calculate the distances */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pTempdst
argument_list|,
name|pTempsrc1
argument_list|,
name|iWidth
operator|*
literal|3
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB8_Y2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgb8_y3
name|mng_retcode
name|mng_magnify_rgb8_y3
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB8_Y3
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pSrcline2
condition|)
comment|/* do we have a second line ? */
block|{
if|if
condition|(
name|iS
operator|<
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
condition|)
comment|/* top half ? */
name|MNG_COPY
argument_list|(
argument|pDstline
argument_list|,
argument|pSrcline1
argument_list|,
argument|iWidth *
literal|3
argument_list|)
else|else
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline2
argument_list|,
name|iWidth
operator|*
literal|3
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline1
argument_list|,
name|iWidth
operator|*
literal|3
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB8_Y3
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_GRAY_SUPPORT
end_ifndef
begin_function
DECL|function|mng_magnify_ga8_y1
name|mng_retcode
name|mng_magnify_ga8_y1
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_Y1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline1
argument_list|,
name|iWidth
operator|<<
literal|1
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_Y1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_ga8_y2
name|mng_retcode
name|mng_magnify_ga8_y2
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_Y2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline1
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempsrc2
operator|=
name|pSrcline2
expr_stmt|;
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have a second line ? */
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
comment|/* calculate the distances */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pTempdst
argument_list|,
name|pTempsrc1
argument_list|,
name|iWidth
operator|<<
literal|1
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_Y2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_ga8_y3
name|mng_retcode
name|mng_magnify_ga8_y3
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_Y3
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pSrcline2
condition|)
comment|/* do we have a second line ? */
block|{
if|if
condition|(
name|iS
operator|<
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
condition|)
comment|/* top half ? */
name|MNG_COPY
argument_list|(
argument|pDstline
argument_list|,
argument|pSrcline1
argument_list|,
argument|iWidth<<
literal|1
argument_list|)
else|else
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline2
argument_list|,
name|iWidth
operator|<<
literal|1
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline1
argument_list|,
name|iWidth
operator|<<
literal|1
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_Y2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_ga8_y4
name|mng_retcode
name|mng_magnify_ga8_y4
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_Y4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline1
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempsrc2
operator|=
name|pSrcline2
expr_stmt|;
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have a second line ? */
block|{
if|if
condition|(
name|iS
operator|<
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
condition|)
comment|/* top half ? */
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
comment|/* calculate the distances */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|+=
literal|2
expr_stmt|;
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc1
operator|++
expr_stmt|;
comment|/* replicate alpha from top */
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
comment|/* calculate the distances */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|+=
literal|2
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc2
operator|++
expr_stmt|;
comment|/* replicate alpha from bottom */
block|}
block|}
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pTempdst
argument_list|,
name|pTempsrc1
argument_list|,
name|iWidth
operator|<<
literal|1
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_Y4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_ga8_y5
name|mng_retcode
name|mng_magnify_ga8_y5
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_Y5
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline1
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempsrc2
operator|=
name|pSrcline2
expr_stmt|;
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have a second line ? */
block|{
if|if
condition|(
name|iS
operator|<
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
condition|)
comment|/* top half ? */
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* replicate gray from top */
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
comment|/* calculate the distances */
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc2
expr_stmt|;
comment|/* replicate gray from bottom */
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
comment|/* calculate the distances */
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pTempdst
argument_list|,
name|pTempsrc1
argument_list|,
name|iWidth
operator|<<
literal|1
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA8_Y5
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_GRAY_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_MAGN */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba8_y1
name|mng_retcode
name|mng_magnify_rgba8_y1
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_Y1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline1
argument_list|,
name|iWidth
operator|<<
literal|2
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_Y1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba8_y2
name|mng_retcode
name|mng_magnify_rgba8_y2
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_Y2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline1
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempsrc2
operator|=
name|pSrcline2
expr_stmt|;
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have a second line ? */
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
comment|/* calculate the distances */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pTempdst
argument_list|,
name|pTempsrc1
argument_list|,
name|iWidth
operator|<<
literal|2
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_Y2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba8_y3
name|mng_retcode
name|mng_magnify_rgba8_y3
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_Y3
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pSrcline2
condition|)
comment|/* do we have a second line ? */
block|{
if|if
condition|(
name|iS
operator|<
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
condition|)
comment|/* top half ? */
name|MNG_COPY
argument_list|(
argument|pDstline
argument_list|,
argument|pSrcline1
argument_list|,
argument|iWidth<<
literal|2
argument_list|)
else|else
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline2
argument_list|,
name|iWidth
operator|<<
literal|2
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline1
argument_list|,
name|iWidth
operator|<<
literal|2
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_Y2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba8_y4
name|mng_retcode
name|mng_magnify_rgba8_y4
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_Y4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline1
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempsrc2
operator|=
name|pSrcline2
expr_stmt|;
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have a second line ? */
block|{
if|if
condition|(
name|iS
operator|<
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
condition|)
comment|/* top half ? */
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
comment|/* calculate the distances */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|+=
literal|2
expr_stmt|;
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc1
operator|++
expr_stmt|;
comment|/* replicate alpha from top */
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
comment|/* calculate the distances */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|+=
literal|2
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc2
operator|++
expr_stmt|;
comment|/* replicate alpha from bottom */
block|}
block|}
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pTempdst
argument_list|,
name|pTempsrc1
argument_list|,
name|iWidth
operator|<<
literal|2
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_Y4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba8_y5
name|mng_retcode
name|mng_magnify_rgba8_y5
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint8p
name|pTempsrc1
decl_stmt|;
name|mng_uint8p
name|pTempsrc2
decl_stmt|;
name|mng_uint8p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_Y5
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
name|pSrcline1
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempsrc2
operator|=
name|pSrcline2
expr_stmt|;
name|pTempdst
operator|=
name|pDstline
expr_stmt|;
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have a second line ? */
block|{
if|if
condition|(
name|iS
operator|<
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
condition|)
comment|/* top half ? */
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc1
operator|++
expr_stmt|;
comment|/* replicate color from top */
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc1
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|+=
literal|3
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
comment|/* calculate the distances */
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc2
operator|++
expr_stmt|;
comment|/* replicate color from bottom */
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc2
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc2
operator|++
expr_stmt|;
name|pTempsrc1
operator|+=
literal|3
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
comment|/* calculate the distances */
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
operator|*
name|pTempdst
operator|=
call|(
name|mng_uint8
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc2
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
operator|*
name|pTempsrc1
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pTempdst
argument_list|,
name|pTempsrc1
argument_list|,
name|iWidth
operator|<<
literal|2
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA8_Y5
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_OPTIMIZE_FOOTPRINT_MAGN
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_GRAY_SUPPORT
end_ifndef
begin_function
DECL|function|mng_magnify_g16_x1
name|mng_retcode
name|mng_magnify_g16_x1
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|,
name|iS
decl_stmt|,
name|iM
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G16_X1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
name|iM
operator|=
name|iML
expr_stmt|;
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|1
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* fill interval */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
block|}
name|pTempsrc1
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G16_X1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_g16_x2
name|mng_retcode
name|mng_magnify_g16_x2
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G16_X2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|1
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
comment|/* is it same as first ? */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* then just repeat the first */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* calculate the distances */
block|{
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G16_X2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_g16_x3
name|mng_retcode
name|mng_magnify_g16_x3
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|,
name|iH
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G16_X3
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|1
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
comment|/* is it same as first ? */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* then just repeat the first */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
name|iH
operator|=
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
comment|/* calculate halfway point */
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iH
condition|;
name|iS
operator|++
control|)
comment|/* replicate first half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
for|for
control|(
name|iS
operator|=
name|iH
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* replicate second half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc2
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|++
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G16_X3
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_GRAY_SUPPORT */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgb16_x1
name|mng_retcode
name|mng_magnify_rgb16_x1
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|,
name|iS
decl_stmt|,
name|iM
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB16_X1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
name|iM
operator|=
name|iML
expr_stmt|;
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|1
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* fill interval */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
name|pTempsrc1
operator|+=
literal|3
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB16_X1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgb16_x2
name|mng_retcode
name|mng_magnify_rgb16_x2
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB16_X2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|3
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc2
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc2
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|3
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB16_X2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgb16_x3
name|mng_retcode
name|mng_magnify_rgb16_x3
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|,
name|iH
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB16_X3
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|3
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
name|iH
operator|=
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
comment|/* calculate halfway point */
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iH
condition|;
name|iS
operator|++
control|)
comment|/* replicate first half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|+=
literal|3
expr_stmt|;
block|}
for|for
control|(
name|iS
operator|=
name|iH
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* replicate second half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc2
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|+=
literal|3
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|3
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB16_X3
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_GRAY_SUPPORT
end_ifndef
begin_function
DECL|function|mng_magnify_ga16_x1
name|mng_retcode
name|mng_magnify_ga16_x1
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|,
name|iS
decl_stmt|,
name|iM
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_X1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
name|iM
operator|=
name|iML
expr_stmt|;
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|1
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* fill interval */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
name|pTempsrc1
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_X1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_ga16_x2
name|mng_retcode
name|mng_magnify_ga16_x2
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_X2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|2
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc2
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_X2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_ga16_x3
name|mng_retcode
name|mng_magnify_ga16_x3
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|,
name|iH
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_X3
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|2
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
name|iH
operator|=
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
comment|/* calculate halfway point */
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iH
condition|;
name|iS
operator|++
control|)
comment|/* replicate first half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|+=
literal|2
expr_stmt|;
block|}
for|for
control|(
name|iS
operator|=
name|iH
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* replicate second half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc2
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|+=
literal|2
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_X3
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_ga16_x4
name|mng_retcode
name|mng_magnify_ga16_x4
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|,
name|iH
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_X4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|2
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
name|iH
operator|=
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
comment|/* calculate halfway point */
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iH
condition|;
name|iS
operator|++
control|)
comment|/* first half */
block|{
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
comment|/* replicate alpha from left */
name|pTempdst
operator|++
expr_stmt|;
block|}
for|for
control|(
name|iS
operator|=
name|iH
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* second half */
block|{
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
expr_stmt|;
comment|/* replicate alpha from right */
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_X4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_ga16_x5
name|mng_retcode
name|mng_magnify_ga16_x5
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|,
name|iH
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_X5
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|2
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
name|iH
operator|=
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
comment|/* calculate halfway point */
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iH
condition|;
name|iS
operator|++
control|)
comment|/* first half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* replicate gray from left */
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc2
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
for|for
control|(
name|iS
operator|=
name|iH
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* second half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc2
expr_stmt|;
comment|/* replicate gray from right */
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc2
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_X5
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_GRAY_SUPPORT */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba16_x1
name|mng_retcode
name|mng_magnify_rgba16_x1
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|,
name|iS
decl_stmt|,
name|iM
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_X1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
name|iM
operator|=
name|iML
expr_stmt|;
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|1
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
name|iMX
expr_stmt|;
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* fill interval */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
name|pTempsrc1
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_X1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba16_x2
name|mng_retcode
name|mng_magnify_rgba16_x2
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_X2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|4
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc2
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc2
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|3
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc2
operator|+
literal|3
argument_list|)
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|3
argument_list|)
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|3
argument_list|)
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_X2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba16_x3
name|mng_retcode
name|mng_magnify_rgba16_x3
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|,
name|iH
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_X3
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|4
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
name|iH
operator|=
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
comment|/* calculate halfway point */
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iH
condition|;
name|iS
operator|++
control|)
comment|/* replicate first half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|+=
literal|4
expr_stmt|;
block|}
for|for
control|(
name|iS
operator|=
name|iH
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* replicate second half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc2
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|+=
literal|4
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_X3
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba16_x4
name|mng_retcode
name|mng_magnify_rgba16_x4
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|,
name|iH
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_X4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|4
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
name|iH
operator|=
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
comment|/* calculate halfway point */
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iH
condition|;
name|iS
operator|++
control|)
comment|/* first half */
block|{
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc2
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc2
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
comment|/* replicate alpha from left */
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
for|for
control|(
name|iS
operator|=
name|iH
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* second half */
block|{
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* just repeat the first */
else|else
comment|/* calculate the distance */
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc2
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
condition|)
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc2
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|2
argument_list|)
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
comment|/* replicate alpha from right */
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_X4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba16_x5
name|mng_retcode
name|mng_magnify_rgba16_x5
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_uint16
name|iMX
parameter_list|,
name|mng_uint16
name|iML
parameter_list|,
name|mng_uint16
name|iMR
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_int32
name|iS
decl_stmt|,
name|iM
decl_stmt|,
name|iH
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_X5
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
name|pTempsrc2
operator|=
name|pTempsrc1
operator|+
literal|4
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* copy original source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
if|if
condition|(
name|iX
operator|==
literal|0
condition|)
comment|/* first interval ? */
block|{
if|if
condition|(
name|iWidth
operator|==
literal|1
condition|)
comment|/* single pixel ? */
name|pTempsrc2
operator|=
name|MNG_NULL
expr_stmt|;
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iML
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|iX
operator|==
operator|(
name|iWidth
operator|-
literal|2
operator|)
condition|)
comment|/* last interval ? */
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMR
expr_stmt|;
else|else
name|iM
operator|=
operator|(
name|mng_int32
operator|)
name|iMX
expr_stmt|;
comment|/* fill interval ? */
if|if
condition|(
operator|(
name|iX
operator|<
name|iWidth
operator|-
literal|1
operator|)
operator|||
operator|(
name|iWidth
operator|==
literal|1
operator|)
condition|)
block|{
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have the second pixel ? */
block|{
name|iH
operator|=
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
expr_stmt|;
comment|/* calculate halfway point */
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iH
condition|;
name|iS
operator|++
control|)
comment|/* first half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* replicate color from left */
operator|*
operator|(
name|pTempdst
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|3
operator|)
condition|)
operator|*
operator|(
name|pTempdst
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempdst
operator|+
literal|3
argument_list|)
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc2
operator|+
literal|3
argument_list|)
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|3
argument_list|)
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|3
argument_list|)
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|+=
literal|4
expr_stmt|;
block|}
for|for
control|(
name|iS
operator|=
name|iH
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
comment|/* second half */
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc2
expr_stmt|;
comment|/* replicate color from right */
operator|*
operator|(
name|pTempdst
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pTempdst
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pTempsrc2
operator|+
literal|2
operator|)
expr_stmt|;
if|if
condition|(
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
operator|==
operator|*
operator|(
name|pTempsrc2
operator|+
literal|3
operator|)
condition|)
operator|*
operator|(
name|pTempdst
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempdst
operator|+
literal|3
argument_list|)
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc2
operator|+
literal|3
argument_list|)
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|3
argument_list|)
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pTempsrc1
operator|+
literal|3
argument_list|)
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|+=
literal|4
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iS
operator|=
literal|1
init|;
name|iS
operator|<
name|iM
condition|;
name|iS
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* repeat first source pixel */
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|1
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|2
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|=
operator|*
operator|(
name|pTempsrc1
operator|+
literal|3
operator|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
block|}
block|}
block|}
name|pTempsrc1
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_X4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_GRAY_SUPPORT
end_ifndef
begin_function
DECL|function|mng_magnify_g16_y1
name|mng_retcode
name|mng_magnify_g16_y1
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G16_Y1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline1
argument_list|,
operator|(
name|iWidth
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G16_Y1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_g16_y2
name|mng_retcode
name|mng_magnify_g16_y2
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G16_Y2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline1
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempsrc2
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline2
expr_stmt|;
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have a second line ? */
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
comment|/* calculate the distances */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pTempdst
argument_list|,
name|pTempsrc1
argument_list|,
operator|(
name|iWidth
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G16_Y2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_g16_y3
name|mng_retcode
name|mng_magnify_g16_y3
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G16_Y3
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pSrcline2
condition|)
comment|/* do we have a second line ? */
block|{
if|if
condition|(
name|iS
operator|<
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
condition|)
comment|/* top half ? */
name|MNG_COPY
argument_list|(
argument|pDstline
argument_list|,
argument|pSrcline1
argument_list|,
argument|(iWidth<<
literal|1
argument|)
argument_list|)
else|else
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline2
argument_list|,
operator|(
name|iWidth
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline1
argument_list|,
operator|(
name|iWidth
operator|<<
literal|1
operator|)
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_G16_Y3
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_GRAY_SUPPORT */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgb16_y1
name|mng_retcode
name|mng_magnify_rgb16_y1
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB16_Y1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline1
argument_list|,
name|iWidth
operator|*
literal|6
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB16_Y1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgb16_y2
name|mng_retcode
name|mng_magnify_rgb16_y2
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB16_Y2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline1
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempsrc2
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline2
expr_stmt|;
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have a second line ? */
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
comment|/* calculate the distances */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pTempdst
argument_list|,
name|pTempsrc1
argument_list|,
name|iWidth
operator|*
literal|6
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB16_Y2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgb16_y3
name|mng_retcode
name|mng_magnify_rgb16_y3
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB16_Y3
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pSrcline2
condition|)
comment|/* do we have a second line ? */
block|{
if|if
condition|(
name|iS
operator|<
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
condition|)
comment|/* top half ? */
name|MNG_COPY
argument_list|(
argument|pDstline
argument_list|,
argument|pSrcline1
argument_list|,
argument|iWidth *
literal|6
argument_list|)
else|else
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline2
argument_list|,
name|iWidth
operator|*
literal|6
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline1
argument_list|,
name|iWidth
operator|*
literal|6
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGB16_Y3
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_GRAY_SUPPORT
end_ifndef
begin_function
DECL|function|mng_magnify_ga16_y1
name|mng_retcode
name|mng_magnify_ga16_y1
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_Y1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline1
argument_list|,
operator|(
name|iWidth
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_Y1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_ga16_y2
name|mng_retcode
name|mng_magnify_ga16_y2
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_Y2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline1
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempsrc2
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline2
expr_stmt|;
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have a second line ? */
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
comment|/* calculate the distances */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pTempdst
argument_list|,
name|pTempsrc1
argument_list|,
operator|(
name|iWidth
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_Y2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_ga16_y3
name|mng_retcode
name|mng_magnify_ga16_y3
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_Y3
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pSrcline2
condition|)
comment|/* do we have a second line ? */
block|{
if|if
condition|(
name|iS
operator|<
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
condition|)
comment|/* top half ? */
name|MNG_COPY
argument_list|(
argument|pDstline
argument_list|,
argument|pSrcline1
argument_list|,
argument|(iWidth<<
literal|2
argument|)
argument_list|)
else|else
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline2
argument_list|,
operator|(
name|iWidth
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline1
argument_list|,
operator|(
name|iWidth
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_Y2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_ga16_y4
name|mng_retcode
name|mng_magnify_ga16_y4
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_Y4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline1
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempsrc2
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline2
expr_stmt|;
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have a second line ? */
block|{
if|if
condition|(
name|iS
operator|<
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
condition|)
comment|/* top half ? */
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
comment|/* calculate the distances */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|+=
literal|2
expr_stmt|;
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc1
operator|++
expr_stmt|;
comment|/* replicate alpha from top */
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
comment|/* calculate the distances */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|+=
literal|2
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc2
operator|++
expr_stmt|;
comment|/* replicate alpha from bottom */
block|}
block|}
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pTempdst
argument_list|,
name|pTempsrc1
argument_list|,
operator|(
name|iWidth
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_Y4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_ga16_y5
name|mng_retcode
name|mng_magnify_ga16_y5
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_Y5
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline1
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempsrc2
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline2
expr_stmt|;
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have a second line ? */
block|{
if|if
condition|(
name|iS
operator|<
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
condition|)
comment|/* top half ? */
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
comment|/* replicate gray from top */
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
comment|/* calculate the distances */
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc2
expr_stmt|;
comment|/* replicate gray from bottom */
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
comment|/* calculate the distances */
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pTempdst
argument_list|,
name|pTempsrc1
argument_list|,
operator|(
name|iWidth
operator|<<
literal|2
operator|)
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_GA16_Y5
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_GRAY_SUPPORT */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba16_y1
name|mng_retcode
name|mng_magnify_rgba16_y1
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_Y1
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline1
argument_list|,
operator|(
name|iWidth
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_Y1
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba16_y2
name|mng_retcode
name|mng_magnify_rgba16_y2
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_Y2
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline1
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempsrc2
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline2
expr_stmt|;
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have a second line ? */
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
comment|/* calculate the distances */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pTempdst
argument_list|,
name|pTempsrc1
argument_list|,
operator|(
name|iWidth
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_Y2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba16_y3
name|mng_retcode
name|mng_magnify_rgba16_y3
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_Y3
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pSrcline2
condition|)
comment|/* do we have a second line ? */
block|{
if|if
condition|(
name|iS
operator|<
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
condition|)
comment|/* top half ? */
name|MNG_COPY
argument_list|(
argument|pDstline
argument_list|,
argument|pSrcline1
argument_list|,
argument|(iWidth<<
literal|3
argument|)
argument_list|)
else|else
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline2
argument_list|,
operator|(
name|iWidth
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pDstline
argument_list|,
name|pSrcline1
argument_list|,
operator|(
name|iWidth
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_Y2
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba16_y4
name|mng_retcode
name|mng_magnify_rgba16_y4
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_Y4
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline1
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempsrc2
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline2
expr_stmt|;
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have a second line ? */
block|{
if|if
condition|(
name|iS
operator|<
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
condition|)
comment|/* top half ? */
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
comment|/* calculate the distances */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|+=
literal|2
expr_stmt|;
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc1
operator|++
expr_stmt|;
comment|/* replicate alpha from top */
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
comment|/* calculate the distances */
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|+=
literal|2
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc2
operator|++
expr_stmt|;
comment|/* replicate alpha from bottom */
block|}
block|}
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pTempdst
argument_list|,
name|pTempsrc1
argument_list|,
operator|(
name|iWidth
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_Y4
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_magnify_rgba16_y5
name|mng_retcode
name|mng_magnify_rgba16_y5
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_int32
name|iS
parameter_list|,
name|mng_int32
name|iM
parameter_list|,
name|mng_uint32
name|iWidth
parameter_list|,
name|mng_uint8p
name|pSrcline1
parameter_list|,
name|mng_uint8p
name|pSrcline2
parameter_list|,
name|mng_uint8p
name|pDstline
parameter_list|)
block|{
name|mng_uint32
name|iX
decl_stmt|;
name|mng_uint16p
name|pTempsrc1
decl_stmt|;
name|mng_uint16p
name|pTempsrc2
decl_stmt|;
name|mng_uint16p
name|pTempdst
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_Y5
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pTempsrc1
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline1
expr_stmt|;
comment|/* initialize pixel-loop */
name|pTempsrc2
operator|=
operator|(
name|mng_uint16p
operator|)
name|pSrcline2
expr_stmt|;
name|pTempdst
operator|=
operator|(
name|mng_uint16p
operator|)
name|pDstline
expr_stmt|;
if|if
condition|(
name|pTempsrc2
condition|)
comment|/* do we have a second line ? */
block|{
if|if
condition|(
name|iS
operator|<
operator|(
name|iM
operator|+
literal|1
operator|)
operator|/
literal|2
condition|)
comment|/* top half ? */
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc1
operator|++
expr_stmt|;
comment|/* replicate color from top */
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc1
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|+=
literal|3
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
comment|/* calculate the distances */
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
block|}
block|}
else|else
block|{
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|iWidth
condition|;
name|iX
operator|++
control|)
block|{
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc2
operator|++
expr_stmt|;
comment|/* replicate color from bottom */
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc2
operator|++
expr_stmt|;
operator|*
name|pTempdst
operator|++
operator|=
operator|*
name|pTempsrc2
operator|++
expr_stmt|;
name|pTempsrc1
operator|+=
literal|3
expr_stmt|;
if|if
condition|(
operator|*
name|pTempsrc1
operator|==
operator|*
name|pTempsrc2
condition|)
comment|/* calculate the distances */
operator|*
name|pTempdst
operator|=
operator|*
name|pTempsrc1
expr_stmt|;
else|else
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempdst
argument_list|,
call|(
name|mng_uint16
call|)
argument_list|(
operator|(
operator|(
literal|2
operator|*
name|iS
operator|*
operator|(
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc2
argument_list|)
argument_list|)
operator|-
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
operator|)
operator|+
name|iM
operator|)
operator|/
operator|(
name|iM
operator|*
literal|2
operator|)
operator|)
operator|+
call|(
name|mng_int32
call|)
argument_list|(
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pTempsrc1
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|pTempdst
operator|++
expr_stmt|;
name|pTempsrc1
operator|++
expr_stmt|;
name|pTempsrc2
operator|++
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
comment|/* just repeat the entire line */
name|MNG_COPY
argument_list|(
name|pTempdst
argument_list|,
name|pTempsrc1
argument_list|,
operator|(
name|iWidth
operator|<<
literal|3
operator|)
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_MAGNIFY_RGBA16_Y5
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_NO_16BIT_SUPPORT */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_OPTIMIZE_FOOTPRINT_MAGN */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCHUNK_MAGN */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * PAST composition routines - compose over/under with a target object    * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_PAST
end_ifndef
begin_function
DECL|function|mng_composeover_rgba8
name|mng_retcode
name|mng_composeover_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|,
name|iCa8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_COMPOSEOVER_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
operator|(
name|pOutrow
operator|+
literal|3
operator|)
expr_stmt|;
if|if
condition|(
name|iFGa8
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa8
operator|==
literal|0xFF
operator|)
operator|||
operator|(
name|iBGa8
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|3
operator|)
operator|=
name|iFGa8
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pOutrow
operator|+
name|i
operator|)
argument_list|,
operator|*
operator|(
name|pWorkrow
operator|+
name|i
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pOutrow
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|MNG_COMPOSE8
argument_list|(
operator|*
name|pOutrow
argument_list|,
operator|*
name|pWorkrow
argument_list|,
name|iFGa8
argument_list|,
operator|*
name|pOutrow
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* alpha remains fully opaque !!! */
block|}
else|else
block|{
comment|/* here we'll have to blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pWorkrow
argument_list|,
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
name|pOutrow
argument_list|,
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pOutrow
operator|=
name|iCr8
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
name|iCg8
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
name|iCb8
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|3
operator|)
operator|=
name|iCa8
expr_stmt|;
block|}
block|}
block|}
name|pOutrow
operator|+=
literal|4
expr_stmt|;
name|pWorkrow
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_COMPOSEOVER_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_composeover_rgba16
name|mng_retcode
name|mng_composeover_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint16p
name|pWorkrow
decl_stmt|;
name|mng_uint16p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iFGa16
decl_stmt|,
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGa16
decl_stmt|,
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|,
name|iCa16
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_COMPOSEOVER_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
operator|(
name|mng_uint16p
operator|)
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
call|(
name|mng_uint16p
call|)
argument_list|(
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
comment|/* get alpha values */
name|iFGa16
operator|=
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pWorkrow
operator|+
literal|3
argument_list|)
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pOutrow
operator|+
literal|3
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iFGa16
condition|)
comment|/* any opacity at all ? */
block|{
comment|/* fully opaque or background fully transparent ? */
if|if
condition|(
operator|(
name|iFGa16
operator|==
literal|0xFFFF
operator|)
operator|||
operator|(
name|iBGa16
operator|==
literal|0
operator|)
condition|)
block|{
comment|/* then simply copy the values */
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|3
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|3
operator|)
expr_stmt|;
block|}
else|else
block|{
comment|/* get color values */
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pWorkrow
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pWorkrow
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pWorkrow
operator|+
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pOutrow
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pOutrow
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iFGa16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iFGa16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pOutrow
argument_list|,
name|iFGr16
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pOutrow
operator|+
literal|1
argument_list|)
argument_list|,
name|iFGg16
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|)
argument_list|,
name|iFGb16
argument_list|)
expr_stmt|;
comment|/* alpha remains fully opaque !!! */
block|}
else|else
block|{
comment|/* here we'll have to blend */
name|MNG_BLEND16
argument_list|(
name|iFGr16
argument_list|,
name|iFGg16
argument_list|,
name|iFGb16
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pOutrow
argument_list|,
name|iCr16
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pOutrow
operator|+
literal|1
argument_list|)
argument_list|,
name|iCg16
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|)
argument_list|,
name|iCb16
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pOutrow
operator|+
literal|3
argument_list|)
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
block|}
block|}
block|}
name|pOutrow
operator|+=
literal|4
expr_stmt|;
name|pWorkrow
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_COMPOSEOVER_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_composeunder_rgba8
name|mng_retcode
name|mng_composeunder_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint8p
name|pWorkrow
decl_stmt|;
name|mng_uint8p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint8
name|iFGa8
decl_stmt|,
name|iBGa8
decl_stmt|;
name|mng_uint8
name|iCr8
decl_stmt|,
name|iCg8
decl_stmt|,
name|iCb8
decl_stmt|,
name|iCa8
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_COMPOSEUNDER_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
name|iFGa8
operator|=
operator|*
operator|(
name|pOutrow
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* get alpha values */
name|iBGa8
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|3
operator|)
expr_stmt|;
comment|/* anything to do at all ? */
if|if
condition|(
operator|(
name|iBGa8
operator|)
operator|&&
operator|(
name|iFGa8
operator|!=
literal|0xFF
operator|)
condition|)
block|{
if|if
condition|(
name|iBGa8
operator|==
literal|0xFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
ifdef|#
directive|ifdef
name|MNG_OPTIMIZE_FOOTPRINT_COMPOSE
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|2
init|;
name|i
operator|>=
literal|0
condition|;
name|i
operator|--
control|)
block|{
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pOutrow
operator|+
name|i
operator|)
argument_list|,
operator|*
operator|(
name|pOutrow
operator|+
name|i
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pWorkrow
operator|+
name|i
operator|)
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|MNG_COMPOSE8
argument_list|(
operator|*
name|pOutrow
argument_list|,
operator|*
name|pOutrow
argument_list|,
name|iFGa8
argument_list|,
operator|*
name|pWorkrow
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
argument_list|)
expr_stmt|;
name|MNG_COMPOSE8
argument_list|(
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
argument_list|,
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
operator|*
operator|(
name|pOutrow
operator|+
literal|3
operator|)
operator|=
literal|0xFF
expr_stmt|;
comment|/* alpha becomes fully opaque !!! */
block|}
else|else
block|{
comment|/* here we'll have to blend */
name|MNG_BLEND8
argument_list|(
operator|*
name|pOutrow
argument_list|,
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
argument_list|,
name|iFGa8
argument_list|,
operator|*
name|pWorkrow
argument_list|,
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
argument_list|,
operator|*
operator|(
name|pWorkrow
operator|+
literal|2
operator|)
argument_list|,
name|iBGa8
argument_list|,
name|iCr8
argument_list|,
name|iCg8
argument_list|,
name|iCb8
argument_list|,
name|iCa8
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
operator|*
name|pOutrow
operator|=
name|iCr8
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
name|iCg8
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|2
operator|)
operator|=
name|iCb8
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|3
operator|)
operator|=
name|iCa8
expr_stmt|;
block|}
block|}
name|pOutrow
operator|+=
literal|4
expr_stmt|;
name|pWorkrow
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_COMPOSEUNDER_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_composeunder_rgba16
name|mng_retcode
name|mng_composeunder_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_imagedatap
name|pBuf
init|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pStoreobj
operator|)
operator|->
name|pImgbuf
decl_stmt|;
name|mng_uint16p
name|pWorkrow
decl_stmt|;
name|mng_uint16p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint16
name|iFGa16
decl_stmt|,
name|iFGr16
decl_stmt|,
name|iFGg16
decl_stmt|,
name|iFGb16
decl_stmt|;
name|mng_uint16
name|iBGa16
decl_stmt|,
name|iBGr16
decl_stmt|,
name|iBGg16
decl_stmt|,
name|iBGb16
decl_stmt|;
name|mng_uint16
name|iCr16
decl_stmt|,
name|iCg16
decl_stmt|,
name|iCb16
decl_stmt|,
name|iCa16
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_COMPOSEUNDER_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pWorkrow
operator|=
operator|(
name|mng_uint16p
operator|)
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pOutrow
operator|=
call|(
name|mng_uint16p
call|)
argument_list|(
name|pBuf
operator|->
name|pImgdata
operator|+
operator|(
name|pData
operator|->
name|iRow
operator|*
name|pBuf
operator|->
name|iRowsize
operator|)
operator|+
operator|(
name|pData
operator|->
name|iCol
operator|*
name|pBuf
operator|->
name|iSamplesize
operator|)
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
comment|/* get alpha values */
name|iFGa16
operator|=
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pOutrow
operator|+
literal|3
argument_list|)
argument_list|)
expr_stmt|;
name|iBGa16
operator|=
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pWorkrow
operator|+
literal|3
argument_list|)
argument_list|)
expr_stmt|;
comment|/* anything to do at all ? */
if|if
condition|(
operator|(
name|iBGa16
operator|)
operator|&&
operator|(
name|iFGa16
operator|!=
literal|0xFFFF
operator|)
condition|)
block|{
name|iFGr16
operator|=
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pOutrow
argument_list|)
expr_stmt|;
name|iFGg16
operator|=
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pOutrow
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|iFGb16
operator|=
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|)
argument_list|)
expr_stmt|;
name|iBGr16
operator|=
name|mng_get_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pWorkrow
argument_list|)
expr_stmt|;
name|iBGg16
operator|=
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pWorkrow
operator|+
literal|1
argument_list|)
argument_list|)
expr_stmt|;
name|iBGb16
operator|=
name|mng_get_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pWorkrow
operator|+
literal|2
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|iBGa16
operator|==
literal|0xFFFF
condition|)
comment|/* background fully opaque ? */
block|{
comment|/* do alpha composing */
name|MNG_COMPOSE16
argument_list|(
name|iFGr16
argument_list|,
name|iFGr16
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGg16
argument_list|,
name|iFGg16
argument_list|,
name|iFGa16
argument_list|,
name|iBGg16
argument_list|)
expr_stmt|;
name|MNG_COMPOSE16
argument_list|(
name|iFGb16
argument_list|,
name|iFGb16
argument_list|,
name|iFGa16
argument_list|,
name|iBGb16
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pOutrow
argument_list|,
name|iFGr16
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pOutrow
operator|+
literal|1
argument_list|)
argument_list|,
name|iFGg16
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|)
argument_list|,
name|iFGb16
argument_list|)
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|3
operator|)
operator|=
literal|0xFFFF
expr_stmt|;
comment|/* alpha becomes fully opaque !!! */
block|}
else|else
block|{
comment|/* here we'll have to blend */
name|MNG_BLEND16
argument_list|(
name|iFGr16
argument_list|,
name|iFGg16
argument_list|,
name|iFGb16
argument_list|,
name|iFGa16
argument_list|,
name|iBGr16
argument_list|,
name|iBGg16
argument_list|,
name|iBGb16
argument_list|,
name|iBGa16
argument_list|,
name|iCr16
argument_list|,
name|iCg16
argument_list|,
name|iCb16
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
comment|/* and return the composed values */
name|mng_put_uint16
argument_list|(
operator|(
name|mng_uint8p
operator|)
name|pOutrow
argument_list|,
name|iCr16
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pOutrow
operator|+
literal|1
argument_list|)
argument_list|,
name|iCg16
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pOutrow
operator|+
literal|2
argument_list|)
argument_list|,
name|iCb16
argument_list|)
expr_stmt|;
name|mng_put_uint16
argument_list|(
call|(
name|mng_uint8p
call|)
argument_list|(
name|pOutrow
operator|+
literal|3
argument_list|)
argument_list|,
name|iCa16
argument_list|)
expr_stmt|;
block|}
block|}
name|pOutrow
operator|+=
literal|4
expr_stmt|;
name|pWorkrow
operator|+=
literal|4
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_COMPOSEUNDER_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * PAST flip& tile routines - flip or tile a row of pixels               * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_PAST
end_ifndef
begin_function
DECL|function|mng_flip_rgba8
name|mng_retcode
name|mng_flip_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint32p
name|pWorkrow
decl_stmt|;
name|mng_uint32p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FLIP_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* setup temp pointers */
name|pWorkrow
operator|=
operator|(
name|mng_uint32p
operator|)
name|pData
operator|->
name|pRGBArow
operator|+
name|pData
operator|->
name|iRowsamples
operator|-
literal|1
expr_stmt|;
name|pOutrow
operator|=
operator|(
name|mng_uint32p
operator|)
name|pData
operator|->
name|pWorkrow
expr_stmt|;
comment|/* swap original buffers */
name|pData
operator|->
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pData
operator|->
name|pRGBArow
operator|=
operator|(
name|mng_uint8p
operator|)
name|pOutrow
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
comment|/* let's flip */
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|pWorkrow
operator|--
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FLIP_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_flip_rgba16
name|mng_retcode
name|mng_flip_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint32p
name|pWorkrow
decl_stmt|;
name|mng_uint32p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FLIP_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|/* setup temp pointers */
name|pWorkrow
operator|=
operator|(
name|mng_uint32p
operator|)
name|pData
operator|->
name|pRGBArow
operator|+
operator|(
operator|(
name|pData
operator|->
name|iRowsamples
operator|-
literal|1
operator|)
operator|<<
literal|1
operator|)
expr_stmt|;
name|pOutrow
operator|=
operator|(
name|mng_uint32p
operator|)
name|pData
operator|->
name|pWorkrow
expr_stmt|;
comment|/* swap original buffers */
name|pData
operator|->
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pData
operator|->
name|pRGBArow
operator|=
operator|(
name|mng_uint8p
operator|)
name|pOutrow
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_DECREMENT_LOOPS
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iRowsamples
init|;
name|iX
operator|>
literal|0
condition|;
name|iX
operator|--
control|)
else|#
directive|else
for|for
control|(
name|iX
operator|=
literal|0
init|;
name|iX
operator|<
name|pData
operator|->
name|iRowsamples
condition|;
name|iX
operator|++
control|)
endif|#
directive|endif
block|{
comment|/* let's flip */
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
name|pOutrow
operator|+=
literal|2
expr_stmt|;
name|pWorkrow
operator|-=
literal|2
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_FLIP_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_tile_rgba8
name|mng_retcode
name|mng_tile_rgba8
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint32p
name|pWorkrow
decl_stmt|;
name|mng_uint32p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint32
name|iZ
decl_stmt|,
name|iMax
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_TILE_RGBA8
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iZ
operator|=
name|pData
operator|->
name|iSourcel
expr_stmt|;
comment|/* indent ? */
comment|/* what's our source-length */
name|iMax
operator|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pRetrieveobj
operator|)
operator|->
name|pImgbuf
operator|->
name|iWidth
expr_stmt|;
comment|/* setup temp pointers */
name|pWorkrow
operator|=
operator|(
name|mng_uint32p
operator|)
name|pData
operator|->
name|pRGBArow
operator|+
name|iZ
expr_stmt|;
name|pOutrow
operator|=
operator|(
name|mng_uint32p
operator|)
name|pData
operator|->
name|pWorkrow
expr_stmt|;
comment|/* swap original buffers */
name|pData
operator|->
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pData
operator|->
name|pRGBArow
operator|=
operator|(
name|mng_uint8p
operator|)
name|pOutrow
expr_stmt|;
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iDestl
init|;
name|iX
operator|<
name|pData
operator|->
name|iDestr
condition|;
name|iX
operator|++
control|)
block|{
comment|/* tiiiile */
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
name|pWorkrow
operator|++
expr_stmt|;
name|pOutrow
operator|++
expr_stmt|;
name|iZ
operator|++
expr_stmt|;
if|if
condition|(
name|iZ
operator|>=
name|iMax
condition|)
comment|/* end of source ? */
block|{
name|iZ
operator|=
literal|0
expr_stmt|;
name|pWorkrow
operator|=
operator|(
name|mng_uint32p
operator|)
name|pData
operator|->
name|pWorkrow
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_TILE_RGBA8
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_16BIT_SUPPORT
end_ifndef
begin_function
DECL|function|mng_tile_rgba16
name|mng_retcode
name|mng_tile_rgba16
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_uint32p
name|pWorkrow
decl_stmt|;
name|mng_uint32p
name|pOutrow
decl_stmt|;
name|mng_int32
name|iX
decl_stmt|;
name|mng_uint32
name|iZ
decl_stmt|,
name|iMax
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_TILE_RGBA16
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iZ
operator|=
name|pData
operator|->
name|iSourcel
expr_stmt|;
comment|/* indent ? */
comment|/* what's our source-length */
name|iMax
operator|=
operator|(
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pRetrieveobj
operator|)
operator|->
name|pImgbuf
operator|->
name|iWidth
expr_stmt|;
comment|/* setup temp pointers */
name|pWorkrow
operator|=
operator|(
name|mng_uint32p
operator|)
name|pData
operator|->
name|pRGBArow
operator|+
operator|(
name|iZ
operator|<<
literal|1
operator|)
expr_stmt|;
name|pOutrow
operator|=
operator|(
name|mng_uint32p
operator|)
name|pData
operator|->
name|pWorkrow
expr_stmt|;
comment|/* swap original buffers */
name|pData
operator|->
name|pWorkrow
operator|=
name|pData
operator|->
name|pRGBArow
expr_stmt|;
name|pData
operator|->
name|pRGBArow
operator|=
operator|(
name|mng_uint8p
operator|)
name|pOutrow
expr_stmt|;
for|for
control|(
name|iX
operator|=
name|pData
operator|->
name|iDestl
init|;
name|iX
operator|<
name|pData
operator|->
name|iDestr
condition|;
name|iX
operator|++
control|)
block|{
comment|/* tiiiile */
operator|*
name|pOutrow
operator|=
operator|*
name|pWorkrow
expr_stmt|;
operator|*
operator|(
name|pOutrow
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|pWorkrow
operator|+
literal|1
operator|)
expr_stmt|;
name|pWorkrow
operator|+=
literal|2
expr_stmt|;
name|pOutrow
operator|+=
literal|2
expr_stmt|;
name|iZ
operator|++
expr_stmt|;
if|if
condition|(
name|iZ
operator|>=
name|iMax
condition|)
comment|/* end of source ? */
block|{
name|iZ
operator|=
literal|0
expr_stmt|;
name|pWorkrow
operator|=
operator|(
name|mng_uint32p
operator|)
name|pData
operator|->
name|pWorkrow
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_TILE_RGBA16
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SKIPCHUNK_PAST */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_INCLUDE_DISPLAY_PROCS */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* * end of file                                                            * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
end_unit
