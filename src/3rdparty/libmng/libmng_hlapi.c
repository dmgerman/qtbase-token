begin_unit
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *             For conditions of distribution and use,                    * */
end_comment
begin_comment
comment|/* *                see copyright notice in libmng.h                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * project   : libmng                                                     * */
end_comment
begin_comment
comment|/* * file      : libmng_hlapi.c            copyright (c) 2000-2007 G.Juyn   * */
end_comment
begin_comment
comment|/* * version   : 1.0.10                                                     * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * purpose   : high-level application API (implementation)                * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * author    : G.Juyn                                                     * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * comment   : implementation of the high-level function interface        * */
end_comment
begin_comment
comment|/* *             for applications.                                          * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * changes   : 0.5.1 - 05/06/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added init of iPLTEcount                                 * */
end_comment
begin_comment
comment|/* *             0.5.1 - 05/08/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed calling-convention definition                    * */
end_comment
begin_comment
comment|/* *             - changed status-handling of display-routines              * */
end_comment
begin_comment
comment|/* *             - added versioning-control routines                        * */
end_comment
begin_comment
comment|/* *             - filled the write routine                                 * */
end_comment
begin_comment
comment|/* *             - changed strict-ANSI stuff                                * */
end_comment
begin_comment
comment|/* *             0.5.1 - 05/11/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added callback error-reporting support                   * */
end_comment
begin_comment
comment|/* *             0.5.1 - 05/12/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed trace to macro for callback error-reporting      * */
end_comment
begin_comment
comment|/* *             0.5.1 - 05/13/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added eMNGma hack (will be removed in 1.0.0 !!!)         * */
end_comment
begin_comment
comment|/* *             - added TERM animation object pointer (easier reference)   * */
end_comment
begin_comment
comment|/* *             0.5.1 - 05/14/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added cleanup of saved-data (SAVE/SEEK processing)       * */
end_comment
begin_comment
comment|/* *             0.5.1 - 05/16/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - moved the actual write_graphic functionality from here   * */
end_comment
begin_comment
comment|/* *               to its appropriate function in the mng_write module      * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.5.2 - 05/19/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - cleaned up some code regarding mixed support             * */
end_comment
begin_comment
comment|/* *             - added JNG support                                        * */
end_comment
begin_comment
comment|/* *             0.5.2 - 05/24/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - moved init of default zlib parms here from "mng_zlib.c"  * */
end_comment
begin_comment
comment|/* *             - added init of default IJG parms                          * */
end_comment
begin_comment
comment|/* *             0.5.2 - 05/29/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed inconsistancy with freeing global iCCP profile     * */
end_comment
begin_comment
comment|/* *             0.5.2 - 05/30/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added delta-image field initialization                   * */
end_comment
begin_comment
comment|/* *             0.5.2 - 06/06/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added initialization of the buffer-suspend parameter     * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.5.3 - 06/16/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added initialization of update-region for refresh        * */
end_comment
begin_comment
comment|/* *             - added initialization of Needrefresh parameter            * */
end_comment
begin_comment
comment|/* *             0.5.3 - 06/17/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added initialization of Deltaimmediate                   * */
end_comment
begin_comment
comment|/* *             0.5.3 - 06/21/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added initialization of Speed                            * */
end_comment
begin_comment
comment|/* *             - added initialization of Imagelevel                       * */
end_comment
begin_comment
comment|/* *             0.5.3 - 06/26/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed userdata variable to mng_ptr                     * */
end_comment
begin_comment
comment|/* *             0.5.3 - 06/29/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed initialization routine for new mng_handle type     * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.1 - 07/06/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed mng_display_resume to allow to be called after   * */
end_comment
begin_comment
comment|/* *               a suspension return with MNG_NEEDMOREDATA                * */
end_comment
begin_comment
comment|/* *             - added returncode MNG_NEEDTIMERWAIT for timer breaks      * */
end_comment
begin_comment
comment|/* *             0.9.1 - 07/07/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - implemented support for freeze/reset/resume& go_xxxx    * */
end_comment
begin_comment
comment|/* *             0.9.1 - 07/08/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added support for improved timing                        * */
end_comment
begin_comment
comment|/* *             - added support for improved I/O-suspension                * */
end_comment
begin_comment
comment|/* *             0.9.1 - 07/14/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed EOF processing behavior                          * */
end_comment
begin_comment
comment|/* *             0.9.1 - 07/15/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added callbacks for SAVE/SEEK processing                 * */
end_comment
begin_comment
comment|/* *             - added variable for NEEDSECTIONWAIT breaks                * */
end_comment
begin_comment
comment|/* *             - added variable for freeze& reset processing             * */
end_comment
begin_comment
comment|/* *             0.9.1 - 07/17/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added error cleanup processing                           * */
end_comment
begin_comment
comment|/* *             - fixed support for mng_display_reset()                    * */
end_comment
begin_comment
comment|/* *             - fixed suspension-buffering for 32K+ chunks               * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.2 - 07/29/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed small bugs in display processing                   * */
end_comment
begin_comment
comment|/* *             0.9.2 - 07/31/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed wrapping of suspension parameters                  * */
end_comment
begin_comment
comment|/* *             0.9.2 - 08/04/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - B111096 - fixed large-buffer read-suspension             * */
end_comment
begin_comment
comment|/* *             0.9.2 - 08/05/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed file-prefixes                                    * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.3 - 09/07/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added support for new filter_types                       * */
end_comment
begin_comment
comment|/* *             0.9.3 - 09/10/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed DEFI behavior                                      * */
end_comment
begin_comment
comment|/* *             0.9.3 - 10/11/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added support for nEED                                   * */
end_comment
begin_comment
comment|/* *             0.9.3 - 10/16/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added optional support for bKGD for PNG images           * */
end_comment
begin_comment
comment|/* *             - raised initial maximum canvas size                       * */
end_comment
begin_comment
comment|/* *             - added support for JDAA                                   * */
end_comment
begin_comment
comment|/* *             0.9.3 - 10/17/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added callback to process non-critical unknown chunks    * */
end_comment
begin_comment
comment|/* *             - fixed support for delta-images during read() / display() * */
end_comment
begin_comment
comment|/* *             0.9.3 - 10/18/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added closestream() processing for mng_cleanup()         * */
end_comment
begin_comment
comment|/* *             0.9.3 - 10/27/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed separate read()& display() processing             * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             0.9.4 - 11/20/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed unwanted repetition in mng_readdisplay()           * */
end_comment
begin_comment
comment|/* *             0.9.4 - 11/24/2000 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - moved restore of object 0 to libmng_display              * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.1 - 02/08/2001 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added MEND processing callback                           * */
end_comment
begin_comment
comment|/* *             1.0.1 - 02/13/2001 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed first FRAM_MODE=4 timing problem                   * */
end_comment
begin_comment
comment|/* *             1.0.1 - 04/21/2001 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed bug with display_reset/display_resume (Thanks G!)  * */
end_comment
begin_comment
comment|/* *             1.0.1 - 04/22/2001 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed memory-leak (Thanks Gregg!)                        * */
end_comment
begin_comment
comment|/* *             1.0.1 - 04/23/2001 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed reset_rundata to drop all objects                  * */
end_comment
begin_comment
comment|/* *             1.0.1 - 04/25/2001 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - moved mng_clear_cms to libmng_cms                        * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.2 - 06/23/2001 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added optimization option for MNG-video playback         * */
end_comment
begin_comment
comment|/* *             - added processterm callback                               * */
end_comment
begin_comment
comment|/* *             1.0.2 - 06/25/2001 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added option to turn off progressive refresh             * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.5 - 07/08/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - B578572 - removed eMNGma hack (thanks Dimitri!)          * */
end_comment
begin_comment
comment|/* *             1.0.5 - 07/16/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - B581625 - large chunks fail with suspension reads        * */
end_comment
begin_comment
comment|/* *             1.0.5 - 08/19/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - B597134 - libmng pollutes the linker namespace           * */
end_comment
begin_comment
comment|/* *             1.0.5 - 09/15/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed LOOP iteration=0 special case                      * */
end_comment
begin_comment
comment|/* *             1.0.5 - 10/07/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added another fix for misplaced TERM chunk               * */
end_comment
begin_comment
comment|/* *             - completed support for condition=2 in TERM chunk          * */
end_comment
begin_comment
comment|/* *             - added beta version function& constant                   * */
end_comment
begin_comment
comment|/* *             1.0.5 - 10/11/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added mng_status_dynamic to supports function            * */
end_comment
begin_comment
comment|/* *             1.0.5 - 11/04/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - changed FRAMECOUNT/LAYERCOUNT/PLAYTIME error to warning  * */
end_comment
begin_comment
comment|/* *             1.0.5 - 11/07/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added support to get totals after mng_read()             * */
end_comment
begin_comment
comment|/* *             1.0.5 - 11/29/2002 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - fixed goxxxxx() support for zero values                  * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.6 - 05/25/2003 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added MNG_SKIPCHUNK_cHNK footprint optimizations         * */
end_comment
begin_comment
comment|/* *             1.0.6 - 07/11/2003 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added conditionals zlib and jpeg property accessors      * */
end_comment
begin_comment
comment|/* *             1.0.6 - 07/14/2003 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added conditionals around "mng_display_go*" and other    * */
end_comment
begin_comment
comment|/* *               unused functions                                         * */
end_comment
begin_comment
comment|/* *             1.0.6 - 07/29/2003 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added conditionals around PAST chunk support             * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.7 - 03/07/2004 - G. Randers-Pehrson                    * */
end_comment
begin_comment
comment|/* *             - put gamma, cms-related declarations inside #ifdef        * */
end_comment
begin_comment
comment|/* *             1.0.7 - 03/10/2004 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added conditionals around openstream/closestream         * */
end_comment
begin_comment
comment|/* *             1.0.7 - 03/24/2004 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - fixed zTXT -> zTXt typo                                  * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.8 - 04/02/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added CRC existence& checking flags                     * */
end_comment
begin_comment
comment|/* *             1.0.8 - 04/10/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added data-push mechanisms for specialized decoders      * */
end_comment
begin_comment
comment|/* *             1.0.8 - 07/06/2004 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - defend against using undefined openstream function       * */
end_comment
begin_comment
comment|/* *             1.0.8 - 08/02/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added conditional to allow easier writing of large MNG's * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.9 - 08/17/2004 - G.R-P                                 * */
end_comment
begin_comment
comment|/* *             - added more SKIPCHUNK conditionals                        * */
end_comment
begin_comment
comment|/* *             1.0.9 - 09/25/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - replaced MNG_TWEAK_LARGE_FILES with permanent solution   * */
end_comment
begin_comment
comment|/* *             1.0.9 - 10/03/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - added function to retrieve current FRAM delay            * */
end_comment
begin_comment
comment|/* *             1.0.9 - 12/20/2004 - G.Juyn                                * */
end_comment
begin_comment
comment|/* *             - cleaned up macro-invocations (thanks to D. Airlie)       * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *             1.0.10 - 07/06/2005 - G.R-P                                * */
end_comment
begin_comment
comment|/* *             - added more SKIPCHUNK conditionals                        * */
end_comment
begin_comment
comment|/* *             1.0.10 - 04/08/2007 - G.Juyn                               * */
end_comment
begin_comment
comment|/* *             - added support for mPNG proposal                          * */
end_comment
begin_comment
comment|/* *             1.0.10 - 04/12/2007 - G.Juyn                               * */
end_comment
begin_comment
comment|/* *             - added support for ANG proposal                           * */
end_comment
begin_comment
comment|/* *             1.0.10 - 07/06/2007 - G.R-P bugfix by Lucas Quintana       * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_include
include|#
directive|include
file|"libmng.h"
end_include
begin_include
include|#
directive|include
file|"libmng_data.h"
end_include
begin_include
include|#
directive|include
file|"libmng_error.h"
end_include
begin_include
include|#
directive|include
file|"libmng_trace.h"
end_include
begin_ifdef
ifdef|#
directive|ifdef
name|__BORLANDC__
end_ifdef
begin_pragma
pragma|#
directive|pragma
name|hdrstop
end_pragma
begin_endif
endif|#
directive|endif
end_endif
begin_include
include|#
directive|include
file|"libmng_objects.h"
end_include
begin_include
include|#
directive|include
file|"libmng_object_prc.h"
end_include
begin_include
include|#
directive|include
file|"libmng_chunks.h"
end_include
begin_include
include|#
directive|include
file|"libmng_memory.h"
end_include
begin_include
include|#
directive|include
file|"libmng_read.h"
end_include
begin_include
include|#
directive|include
file|"libmng_write.h"
end_include
begin_include
include|#
directive|include
file|"libmng_display.h"
end_include
begin_include
include|#
directive|include
file|"libmng_zlib.h"
end_include
begin_include
include|#
directive|include
file|"libmng_jpeg.h"
end_include
begin_include
include|#
directive|include
file|"libmng_cms.h"
end_include
begin_include
include|#
directive|include
file|"libmng_pixels.h"
end_include
begin_if
if|#
directive|if
name|defined
argument_list|(
name|__BORLANDC__
argument_list|)
operator|&&
name|defined
argument_list|(
name|MNG_STRICT_ANSI
argument_list|)
end_if
begin_pragma
pragma|#
directive|pragma
name|option
name|-
name|A
end_pragma
begin_comment
comment|/* force ANSI-C */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * local routines                                                         * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
end_ifdef
begin_function
DECL|function|mng_drop_objects
name|MNG_LOCAL
name|mng_retcode
name|mng_drop_objects
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_bool
name|bDropaniobj
parameter_list|)
block|{
name|mng_objectp
name|pObject
decl_stmt|;
name|mng_objectp
name|pNext
decl_stmt|;
name|mng_cleanupobject
name|fCleanup
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DROP_OBJECTS
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|pObject
operator|=
name|pData
operator|->
name|pFirstimgobj
expr_stmt|;
comment|/* get first stored image-object (if any) */
while|while
condition|(
name|pObject
condition|)
comment|/* more objects to discard ? */
block|{
name|pNext
operator|=
operator|(
operator|(
name|mng_object_headerp
operator|)
name|pObject
operator|)
operator|->
name|pNext
expr_stmt|;
comment|/* call appropriate cleanup */
name|fCleanup
operator|=
operator|(
operator|(
name|mng_object_headerp
operator|)
name|pObject
operator|)
operator|->
name|fCleanup
expr_stmt|;
name|fCleanup
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|)
expr_stmt|;
name|pObject
operator|=
name|pNext
expr_stmt|;
comment|/* neeeext */
block|}
name|pData
operator|->
name|pFirstimgobj
operator|=
name|MNG_NULL
expr_stmt|;
comment|/* clean this up!!! */
name|pData
operator|->
name|pLastimgobj
operator|=
name|MNG_NULL
expr_stmt|;
if|if
condition|(
name|bDropaniobj
condition|)
comment|/* drop animation objects ? */
block|{
name|pObject
operator|=
name|pData
operator|->
name|pFirstaniobj
expr_stmt|;
comment|/* get first stored animation-object (if any) */
while|while
condition|(
name|pObject
condition|)
comment|/* more objects to discard ? */
block|{
name|pNext
operator|=
operator|(
operator|(
name|mng_object_headerp
operator|)
name|pObject
operator|)
operator|->
name|pNext
expr_stmt|;
comment|/* call appropriate cleanup */
name|fCleanup
operator|=
operator|(
operator|(
name|mng_object_headerp
operator|)
name|pObject
operator|)
operator|->
name|fCleanup
expr_stmt|;
name|fCleanup
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|)
expr_stmt|;
name|pObject
operator|=
name|pNext
expr_stmt|;
comment|/* neeeext */
block|}
name|pData
operator|->
name|pFirstaniobj
operator|=
name|MNG_NULL
expr_stmt|;
comment|/* clean this up!!! */
name|pData
operator|->
name|pLastaniobj
operator|=
name|MNG_NULL
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DYNAMICMNG
name|pObject
operator|=
name|pData
operator|->
name|pFirstevent
expr_stmt|;
comment|/* get first event-object (if any) */
while|while
condition|(
name|pObject
condition|)
comment|/* more objects to discard ? */
block|{
name|pNext
operator|=
operator|(
operator|(
name|mng_object_headerp
operator|)
name|pObject
operator|)
operator|->
name|pNext
expr_stmt|;
comment|/* call appropriate cleanup */
name|fCleanup
operator|=
operator|(
operator|(
name|mng_object_headerp
operator|)
name|pObject
operator|)
operator|->
name|fCleanup
expr_stmt|;
name|fCleanup
argument_list|(
name|pData
argument_list|,
name|pObject
argument_list|)
expr_stmt|;
name|pObject
operator|=
name|pNext
expr_stmt|;
comment|/* neeeext */
block|}
name|pData
operator|->
name|pFirstevent
operator|=
name|MNG_NULL
expr_stmt|;
comment|/* clean this up!!! */
name|pData
operator|->
name|pLastevent
operator|=
name|MNG_NULL
expr_stmt|;
endif|#
directive|endif
block|}
ifdef|#
directive|ifdef
name|MNG_INCLUDE_MPNG_PROPOSAL
if|if
condition|(
name|pData
operator|->
name|pMPNG
condition|)
comment|/* drop MPNG data (if any) */
block|{
name|fCleanup
operator|=
operator|(
operator|(
name|mng_object_headerp
operator|)
name|pData
operator|->
name|pMPNG
operator|)
operator|->
name|fCleanup
expr_stmt|;
name|fCleanup
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pMPNG
argument_list|)
expr_stmt|;
name|pData
operator|->
name|pMPNG
operator|=
name|MNG_NULL
expr_stmt|;
block|}
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_INCLUDE_ANG_PROPOSAL
if|if
condition|(
name|pData
operator|->
name|pANG
condition|)
comment|/* drop ANG data (if any) */
block|{
name|fCleanup
operator|=
operator|(
operator|(
name|mng_object_headerp
operator|)
name|pData
operator|->
name|pANG
operator|)
operator|->
name|fCleanup
expr_stmt|;
name|fCleanup
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pANG
argument_list|)
expr_stmt|;
name|pData
operator|->
name|pANG
operator|=
name|MNG_NULL
expr_stmt|;
block|}
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DROP_OBJECTS
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_DISPLAY */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
end_ifdef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SAVE
end_ifndef
begin_function
DECL|function|mng_drop_savedata
name|MNG_LOCAL
name|mng_retcode
name|mng_drop_savedata
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DROP_SAVEDATA
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
name|pData
operator|->
name|pSavedata
condition|)
comment|/* sanity check */
block|{
comment|/* address it more directly */
name|mng_savedatap
name|pSave
init|=
name|pData
operator|->
name|pSavedata
decl_stmt|;
if|if
condition|(
name|pSave
operator|->
name|iGlobalProfilesize
condition|)
comment|/* cleanup the profile ? */
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pSave
operator|->
name|pGlobalProfile
argument_list|,
name|pSave
operator|->
name|iGlobalProfilesize
argument_list|)
expr_stmt|;
comment|/* cleanup the save structure */
name|MNG_FREE
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pSavedata
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_savedata
argument_list|)
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
name|pData
argument_list|,
name|MNG_FN_DROP_SAVEDATA
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_DISPLAY */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
end_ifdef
begin_function
DECL|function|mng_reset_rundata
name|MNG_LOCAL
name|mng_retcode
name|mng_reset_rundata
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|mng_drop_invalid_objects
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* drop invalidly stored objects */
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SAVE
name|mng_drop_savedata
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* drop stored savedata */
endif|#
directive|endif
name|mng_reset_objzero
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* reset object 0 */
comment|/* drop stored objects (if any) */
name|mng_drop_objects
argument_list|(
name|pData
argument_list|,
name|MNG_FALSE
argument_list|)
expr_stmt|;
name|pData
operator|->
name|bFramedone
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iFrameseq
operator|=
literal|0
expr_stmt|;
comment|/* reset counters& stuff */
name|pData
operator|->
name|iLayerseq
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFrametime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bSkipping
operator|=
name|MNG_FALSE
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DYNAMICMNG
name|pData
operator|->
name|bRunningevent
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bStopafterseek
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iEventx
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iEventy
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|pLastmousemove
operator|=
name|MNG_NULL
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iRequestframe
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRequestlayer
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRequesttime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bSearching
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iRuntime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSynctime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iStarttime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iEndtime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bRunning
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bTimerset
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iBreakpoint
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bSectionwait
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bFreezing
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bResetting
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bNeedrefresh
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bOnlyfirstframe
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iFramesafterTERM
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iIterations
operator|=
literal|0
expr_stmt|;
comment|/* start of animation objects! */
name|pData
operator|->
name|pCurraniobj
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|iUpdateleft
operator|=
literal|0
expr_stmt|;
comment|/* reset region */
name|pData
operator|->
name|iUpdateright
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iUpdatetop
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iUpdatebottom
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iPLTEcount
operator|=
literal|0
expr_stmt|;
comment|/* reset PLTE data */
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_DEFI
name|pData
operator|->
name|iDEFIobjectid
operator|=
literal|0
expr_stmt|;
comment|/* reset DEFI data */
name|pData
operator|->
name|bDEFIhasdonotshow
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iDEFIdonotshow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bDEFIhasconcrete
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iDEFIconcrete
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bDEFIhasloca
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iDEFIlocax
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDEFIlocay
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bDEFIhasclip
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iDEFIclipl
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDEFIclipr
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDEFIclipt
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDEFIclipb
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_BACK
name|pData
operator|->
name|iBACKred
operator|=
literal|0
expr_stmt|;
comment|/* reset BACK data */
name|pData
operator|->
name|iBACKgreen
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iBACKblue
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iBACKmandatory
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iBACKimageid
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iBACKtile
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_FRAM
name|pData
operator|->
name|iFRAMmode
operator|=
literal|1
expr_stmt|;
comment|/* default global FRAM variables */
name|pData
operator|->
name|iFRAMdelay
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iFRAMtimeout
operator|=
literal|0x7fffffffl
expr_stmt|;
name|pData
operator|->
name|bFRAMclipping
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iFRAMclipl
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFRAMclipr
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFRAMclipt
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFRAMclipb
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFramemode
operator|=
literal|1
expr_stmt|;
comment|/* again for the current frame */
name|pData
operator|->
name|iFramedelay
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iFrametimeout
operator|=
literal|0x7fffffffl
expr_stmt|;
name|pData
operator|->
name|bFrameclipping
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iFrameclipl
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFrameclipr
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFrameclipt
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFrameclipb
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iNextdelay
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bForcedelay
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iAccumdelay
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SHOW
name|pData
operator|->
name|iSHOWmode
operator|=
literal|0
expr_stmt|;
comment|/* reset SHOW data */
name|pData
operator|->
name|iSHOWfromid
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSHOWtoid
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSHOWnextid
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSHOWskip
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iGlobalPLTEcount
operator|=
literal|0
expr_stmt|;
comment|/* reset global PLTE data */
name|pData
operator|->
name|iGlobalTRNSrawlen
operator|=
literal|0
expr_stmt|;
comment|/* reset global tRNS data */
name|pData
operator|->
name|iGlobalGamma
operator|=
literal|0
expr_stmt|;
comment|/* reset global gAMA data */
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_cHRM
name|pData
operator|->
name|iGlobalWhitepointx
operator|=
literal|0
expr_stmt|;
comment|/* reset global cHRM data */
name|pData
operator|->
name|iGlobalWhitepointy
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimaryredx
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimaryredy
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimarygreenx
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimarygreeny
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimarybluex
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimarybluey
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_sRGB
name|pData
operator|->
name|iGlobalRendintent
operator|=
literal|0
expr_stmt|;
comment|/* reset global sRGB data */
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
if|if
condition|(
name|pData
operator|->
name|iGlobalProfilesize
condition|)
comment|/* drop global profile (if any) */
name|MNG_FREE
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pGlobalProfile
argument_list|,
name|pData
operator|->
name|iGlobalProfilesize
argument_list|)
expr_stmt|;
name|pData
operator|->
name|iGlobalProfilesize
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_bKGD
name|pData
operator|->
name|iGlobalBKGDred
operator|=
literal|0
expr_stmt|;
comment|/* reset global bKGD data */
name|pData
operator|->
name|iGlobalBKGDgreen
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalBKGDblue
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
comment|/* reset delta-image */
name|pData
operator|->
name|pDeltaImage
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|iDeltaImagetype
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDeltatype
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDeltaBlockwidth
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDeltaBlockheight
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDeltaBlockx
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDeltaBlocky
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bDeltaimmediate
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|fDeltagetrow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fDeltaaddrow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fDeltareplacerow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fDeltaputrow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fPromoterow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fPromBitdepth
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pPromBuf
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|iPromColortype
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iPromBitdepth
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iPromFilltype
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iPromWidth
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|pPromSrc
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pPromDst
operator|=
name|MNG_NULL
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_MAGN
name|pData
operator|->
name|iMAGNfromid
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iMAGNtoid
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_PAST
name|pData
operator|->
name|iPastx
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iPasty
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|pLastseek
operator|=
name|MNG_NULL
expr_stmt|;
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_DISPLAY */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|cleanup_errors
name|MNG_LOCAL
name|void
name|cleanup_errors
parameter_list|(
name|mng_datap
name|pData
parameter_list|)
block|{
name|pData
operator|->
name|iErrorcode
operator|=
name|MNG_NOERROR
expr_stmt|;
name|pData
operator|->
name|iSeverity
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iErrorx1
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iErrorx2
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|zErrortext
operator|=
name|MNG_NULL
expr_stmt|;
return|return;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_READ
end_ifdef
begin_function
DECL|function|make_pushbuffer
name|MNG_LOCAL
name|mng_retcode
name|make_pushbuffer
parameter_list|(
name|mng_datap
name|pData
parameter_list|,
name|mng_ptr
name|pPushdata
parameter_list|,
name|mng_size_t
name|iLength
parameter_list|,
name|mng_bool
name|bTakeownership
parameter_list|,
name|mng_pushdatap
modifier|*
name|pPush
parameter_list|)
block|{
name|mng_pushdatap
name|pTemp
decl_stmt|;
name|MNG_ALLOC
argument_list|(
name|pData
argument_list|,
name|pTemp
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_pushdata
argument_list|)
argument_list|)
expr_stmt|;
name|pTemp
operator|->
name|pNext
operator|=
name|MNG_NULL
expr_stmt|;
if|if
condition|(
name|bTakeownership
condition|)
comment|/* are we going to own the buffer? */
block|{
comment|/* then just copy the pointer */
name|pTemp
operator|->
name|pData
operator|=
operator|(
name|mng_uint8p
operator|)
name|pPushdata
expr_stmt|;
block|}
else|else
block|{
comment|/* otherwise create new buffer */
name|MNG_ALLOCX
argument_list|(
name|pData
argument_list|,
name|pTemp
operator|->
name|pData
argument_list|,
name|iLength
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pTemp
operator|->
name|pData
condition|)
comment|/* succeeded? */
block|{
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pTemp
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_pushdata
argument_list|)
argument_list|)
expr_stmt|;
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_OUTOFMEMORY
argument_list|)
expr_stmt|;
block|}
comment|/* and copy the bytes across */
name|MNG_COPY
argument_list|(
name|pTemp
operator|->
name|pData
argument_list|,
name|pPushdata
argument_list|,
name|iLength
argument_list|)
expr_stmt|;
block|}
name|pTemp
operator|->
name|iLength
operator|=
name|iLength
expr_stmt|;
name|pTemp
operator|->
name|bOwned
operator|=
name|bTakeownership
expr_stmt|;
name|pTemp
operator|->
name|pDatanext
operator|=
name|pTemp
operator|->
name|pData
expr_stmt|;
name|pTemp
operator|->
name|iRemaining
operator|=
name|iLength
expr_stmt|;
operator|*
name|pPush
operator|=
name|pTemp
expr_stmt|;
comment|/* return it */
return|return
name|MNG_NOERROR
return|;
comment|/* and all's well */
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_VERSION_QUERY_SUPPORT
end_ifdef
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* *  Versioning control                                                    * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_version_text
name|mng_pchar
name|MNG_DECL
name|mng_version_text
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|MNG_VERSION_TEXT
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_version_so
name|mng_uint8
name|MNG_DECL
name|mng_version_so
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|MNG_VERSION_SO
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_version_dll
name|mng_uint8
name|MNG_DECL
name|mng_version_dll
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|MNG_VERSION_DLL
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_version_major
name|mng_uint8
name|MNG_DECL
name|mng_version_major
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|MNG_VERSION_MAJOR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_version_minor
name|mng_uint8
name|MNG_DECL
name|mng_version_minor
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|MNG_VERSION_MINOR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_version_release
name|mng_uint8
name|MNG_DECL
name|mng_version_release
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|MNG_VERSION_RELEASE
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_version_beta
name|mng_bool
name|MNG_DECL
name|mng_version_beta
parameter_list|(
name|void
parameter_list|)
block|{
return|return
name|MNG_VERSION_BETA
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * 'supports' function                                                    * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_FUNCQUERY
end_ifdef
begin_typedef
typedef|typedef
struct|struct
block|{
DECL|member|zFunction
name|mng_pchar
name|zFunction
decl_stmt|;
DECL|member|iMajor
name|mng_uint8
name|iMajor
decl_stmt|;
comment|/* Major == 0 means not implemented ! */
DECL|member|iMinor
name|mng_uint8
name|iMinor
decl_stmt|;
DECL|member|iRelease
name|mng_uint8
name|iRelease
decl_stmt|;
block|}
DECL|typedef|mng_func_entry
name|mng_func_entry
typedef|;
end_typedef
begin_typedef
DECL|typedef|mng_func_entryp
typedef|typedef
name|mng_func_entry
specifier|const
modifier|*
name|mng_func_entryp
typedef|;
end_typedef
begin_decl_stmt
DECL|variable|func_table
name|MNG_LOCAL
name|mng_func_entry
specifier|const
name|func_table
index|[]
init|=
block|{
comment|/* keep it alphabetically sorted !!!!! */
block|{
literal|"mng_cleanup"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_copy_chunk"
block|,
literal|1
block|,
literal|0
block|,
literal|5
block|}
block|,
block|{
literal|"mng_create"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_display"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_display_freeze"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_NO_DISPLAY_GO_SUPPORTED
block|{
literal|"mng_display_goframe"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_display_golayer"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_display_gotime"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_display_reset"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_display_resume"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_alphabitdepth"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_alphacompression"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_alphadepth"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_alphafilter"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_alphainterlace"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_bgcolor"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_bitdepth"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_bkgdstyle"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_cacheplayback"
block|,
literal|1
block|,
literal|0
block|,
literal|2
block|}
block|,
block|{
literal|"mng_get_canvasstyle"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_colortype"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_compression"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_NO_CURRENT_INFO
block|{
literal|"mng_get_currentframe"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_currentlayer"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_currentplaytime"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_get_currframdelay"
block|,
literal|1
block|,
literal|0
block|,
literal|9
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_NO_DFLT_INFO
block|{
literal|"mng_get_dfltimggamma"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_dfltimggammaint"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_get_displaygamma"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_displaygammaint"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_doprogressive"
block|,
literal|1
block|,
literal|0
block|,
literal|2
block|}
block|,
block|{
literal|"mng_get_filter"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_framecount"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_imageheight"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_imagelevel"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_imagetype"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_imagewidth"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_interlace"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifdef|#
directive|ifdef
name|MNG_ACCESS_JPEG
block|{
literal|"mng_get_jpeg_dctmethod"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_jpeg_maxjdat"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_jpeg_optimized"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_jpeg_progressive"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_jpeg_quality"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_jpeg_smoothing"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_get_lastbackchunk"
block|,
literal|1
block|,
literal|0
block|,
literal|3
block|}
block|,
block|{
literal|"mng_get_lastseekname"
block|,
literal|1
block|,
literal|0
block|,
literal|5
block|}
block|,
block|{
literal|"mng_get_layercount"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_SKIP_MAXCANVAS
block|{
literal|"mng_get_maxcanvasheight"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_maxcanvaswidth"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_get_playtime"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_refreshpass"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_runtime"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_sectionbreaks"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_sigtype"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_simplicity"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_speed"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_srgb"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_starttime"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_storechunks"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_suspensionmode"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_ticks"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_NO_CURRENT_INFO
block|{
literal|"mng_get_totalframes"
block|,
literal|1
block|,
literal|0
block|,
literal|5
block|}
block|,
block|{
literal|"mng_get_totallayers"
block|,
literal|1
block|,
literal|0
block|,
literal|5
block|}
block|,
block|{
literal|"mng_get_totalplaytime"
block|,
literal|1
block|,
literal|0
block|,
literal|5
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_get_usebkgd"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_userdata"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
if|#
directive|if
name|defined
argument_list|(
name|MNG_FULL_CMS
argument_list|)
operator|||
name|defined
argument_list|(
name|MNG_GAMMA_ONLY
argument_list|)
operator|||
name|defined
argument_list|(
name|MNG_APP_CMS
argument_list|)
block|{
literal|"mng_get_viewgamma"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_viewgammaint"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_ACCESS_ZLIB
block|{
literal|"mng_get_zlib_level"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_zlib_maxidat"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_zlib_memlevel"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_zlib_method"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_zlib_strategy"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_get_zlib_windowbits"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_NO_OPEN_CLOSE_STREAM
block|{
literal|"mng_getcb_closestream"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_getcb_errorproc"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_getalphaline"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_getbkgdline"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_getcanvasline"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_gettickcount"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_memalloc"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_memfree"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_NO_OPEN_CLOSE_STREAM
block|{
literal|"mng_getcb_openstream"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_getcb_processarow"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_processchroma"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_processgamma"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_processheader"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_processiccp"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_processmend"
block|,
literal|1
block|,
literal|0
block|,
literal|1
block|}
block|,
block|{
literal|"mng_getcb_processneed"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_processsave"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_processseek"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_processsrgb"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_processterm"
block|,
literal|1
block|,
literal|0
block|,
literal|2
block|}
block|,
block|{
literal|"mng_getcb_processtext"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_processunknown"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_readdata"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_refresh"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_releasedata"
block|,
literal|1
block|,
literal|0
block|,
literal|8
block|}
block|,
block|{
literal|"mng_getcb_settimer"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_traceproc"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getcb_writedata"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_back"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_basi"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_bKGD
block|{
literal|"mng_getchunk_bkgd"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_cHRM
block|{
literal|"mng_getchunk_chrm"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_getchunk_clip"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_clon"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_dBYK
block|{
literal|"mng_getchunk_dbyk"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
endif|#
directive|endif
block|{
literal|"mng_getchunk_defi"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
block|{
literal|"mng_getchunk_dhdr"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_getchunk_disc"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
block|{
literal|"mng_getchunk_drop"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_getchunk_endl"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifdef|#
directive|ifdef
name|MNG_INCLUDE_MPNG_PROPOSAL
block|{
literal|"mng_getchunk_mpng"
block|,
literal|1
block|,
literal|0
block|,
literal|10
block|}
block|,
block|{
literal|"mng_getchunk_mpng_frame"
block|,
literal|1
block|,
literal|0
block|,
literal|10
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_evNT
block|{
literal|"mng_getchunk_evnt"
block|,
literal|1
block|,
literal|0
block|,
literal|5
block|}
block|,
block|{
literal|"mng_getchunk_evnt_entry"
block|,
literal|1
block|,
literal|0
block|,
literal|5
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_eXPI
block|{
literal|"mng_getchunk_expi"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_fPRI
block|{
literal|"mng_getchunk_fpri"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_getchunk_fram"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_gama"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_hIST
block|{
literal|"mng_getchunk_hist"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
block|{
literal|"mng_getchunk_iccp"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_getchunk_idat"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_iend"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_ihdr"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
block|{
literal|"mng_getchunk_ijng"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_getchunk_ipng"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iTXt
block|{
literal|"mng_getchunk_itxt"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
block|{
literal|"mng_getchunk_jdaa"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_jdat"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_jhdr"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_jsep"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_getchunk_loop"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_MAGN
block|{
literal|"mng_getchunk_magn"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_getchunk_mend"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_mhdr"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_move"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_nEED
block|{
literal|"mng_getchunk_need"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_ORDR
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
block|{
literal|"mng_getchunk_ordr"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_ordr_entry"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_PAST
block|{
literal|"mng_getchunk_past"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_past_src"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_pHYg
block|{
literal|"mng_getchunk_phyg"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_pHYs
block|{
literal|"mng_getchunk_phys"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
block|{
literal|"mng_getchunk_plte"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_pplt"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_pplt_entry"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_prom"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SAVE
block|{
literal|"mng_getchunk_save"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_save_entry"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_sBIT
block|{
literal|"mng_getchunk_sbit"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SEEK
block|{
literal|"mng_getchunk_seek"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_getchunk_show"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_sPLT
block|{
literal|"mng_getchunk_splt"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_sRGB
block|{
literal|"mng_getchunk_srgb"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_getchunk_term"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_tEXt
block|{
literal|"mng_getchunk_text"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_tIME
block|{
literal|"mng_getchunk_time"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_getchunk_trns"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getchunk_unkown"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_zTXt
block|{
literal|"mng_getchunk_ztxt"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_getimgdata_chunk"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getimgdata_chunkseq"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getimgdata_seq"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_getlasterror"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_initialize"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_iterate_chunks"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_putchunk_back"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_BASI
block|{
literal|"mng_putchunk_basi"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_bKGD
block|{
literal|"mng_putchunk_bkgd"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_cHRM
block|{
literal|"mng_putchunk_chrm"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_putchunk_clip"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_putchunk_clon"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_DBYK
block|{
literal|"mng_putchunk_dbyk"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
endif|#
directive|endif
block|{
literal|"mng_putchunk_defi"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
block|{
literal|"mng_putchunk_dhdr"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_putchunk_disc"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
block|{
literal|"mng_putchunk_drop"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_putchunk_endl"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifdef|#
directive|ifdef
name|MNG_INCLUDE_MPNG_PROPOSAL
block|{
literal|"mng_putchunk_mpng"
block|,
literal|1
block|,
literal|0
block|,
literal|10
block|}
block|,
block|{
literal|"mng_putchunk_mpng_frame"
block|,
literal|1
block|,
literal|0
block|,
literal|10
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_evNT
block|{
literal|"mng_putchunk_evnt"
block|,
literal|1
block|,
literal|0
block|,
literal|5
block|}
block|,
block|{
literal|"mng_putchunk_evnt_entry"
block|,
literal|1
block|,
literal|0
block|,
literal|5
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_eXPI
block|{
literal|"mng_putchunk_expi"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_fPRI
block|{
literal|"mng_putchunk_fpri"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_FRAM
block|{
literal|"mng_putchunk_fram"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_putchunk_gama"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_hIST
block|{
literal|"mng_putchunk_hist"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
block|{
literal|"mng_putchunk_iccp"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_putchunk_idat"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_putchunk_iend"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_putchunk_ihdr"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
block|{
literal|"mng_putchunk_ijng"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_putchunk_ipng"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iTXt
block|{
literal|"mng_putchunk_itxt"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
block|{
literal|"mng_putchunk_jdaa"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_putchunk_jdat"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_putchunk_jhdr"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_putchunk_jsep"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_putchunk_loop"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_MAGN
block|{
literal|"mng_putchunk_magn"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_putchunk_mend"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_putchunk_mhdr"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_putchunk_move"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_nEED
block|{
literal|"mng_putchunk_need"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_ORDR
block|{
literal|"mng_putchunk_ordr"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_putchunk_ordr_entry"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_PAST
block|{
literal|"mng_putchunk_past"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_putchunk_past_src"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_pHYg
block|{
literal|"mng_putchunk_phyg"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_pHYs
block|{
literal|"mng_putchunk_phys"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
block|{
literal|"mng_putchunk_plte"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_putchunk_pplt"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_putchunk_pplt_entry"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_putchunk_prom"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SAVE
block|{
literal|"mng_putchunk_save"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_putchunk_save_entry"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_sBIT
block|{
literal|"mng_putchunk_sbit"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SEEK
block|{
literal|"mng_putchunk_seek"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_putchunk_show"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_sPLT
block|{
literal|"mng_putchunk_splt"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_sRGB
block|{
literal|"mng_putchunk_srgb"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_putchunk_term"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_tEXt
block|{
literal|"mng_putchunk_text"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_tIME
block|{
literal|"mng_putchunk_time"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_putchunk_trns"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_putchunk_unkown"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_zTXt
block|{
literal|"mng_putchunk_ztxt"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_putimgdata_ihdr"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_putimgdata_jhdr"
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_reset"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_read"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_read_pushchunk"
block|,
literal|1
block|,
literal|0
block|,
literal|8
block|}
block|,
block|{
literal|"mng_read_pushdata"
block|,
literal|1
block|,
literal|0
block|,
literal|8
block|}
block|,
block|{
literal|"mng_read_pushsig"
block|,
literal|1
block|,
literal|0
block|,
literal|8
block|}
block|,
block|{
literal|"mng_read_resume"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_readdisplay"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_bgcolor"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_bkgdstyle"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_cacheplayback"
block|,
literal|1
block|,
literal|0
block|,
literal|2
block|}
block|,
block|{
literal|"mng_set_canvasstyle"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_dfltimggamma"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_NO_DFLT_INFO
block|{
literal|"mng_set_dfltimggammaint"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_set_displaygamma"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_displaygammaint"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_doprogressive"
block|,
literal|1
block|,
literal|0
block|,
literal|2
block|}
block|,
ifdef|#
directive|ifdef
name|MNG_ACCESS_JPEG
block|{
literal|"mng_set_jpeg_dctmethod"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_jpeg_maxjdat"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_jpeg_optimized"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_jpeg_progressive"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_jpeg_quality"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_jpeg_smoothing"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIP_MAXCANVAS
block|{
literal|"mng_set_maxcanvasheight"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_maxcanvassize"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_maxcanvaswidth"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_set_outputprofile"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_outputprofile2"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_outputsrgb"
block|,
literal|1
block|,
literal|0
block|,
literal|1
block|}
block|,
block|{
literal|"mng_set_sectionbreaks"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_speed"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_srgb"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_srgbimplicit"
block|,
literal|1
block|,
literal|0
block|,
literal|1
block|}
block|,
block|{
literal|"mng_set_srgbprofile"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_srgbprofile2"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_storechunks"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_suspensionmode"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_usebkgd"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_userdata"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
if|#
directive|if
name|defined
argument_list|(
name|MNG_FULL_CMS
argument_list|)
operator|||
name|defined
argument_list|(
name|MNG_GAMMA_ONLY
argument_list|)
operator|||
name|defined
argument_list|(
name|MNG_APP_CMS
argument_list|)
block|{
literal|"mng_set_viewgamma"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_viewgammaint"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_ACCESS_ZLIB
block|{
literal|"mng_set_zlib_level"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_zlib_maxidat"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_zlib_memlevel"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_zlib_method"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_zlib_strategy"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_set_zlib_windowbits"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_NO_OPEN_CLOSE_STREAM
block|{
literal|"mng_setcb_closestream"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_setcb_errorproc"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_getalphaline"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_getbkgdline"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_getcanvasline"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_gettickcount"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_memalloc"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_memfree"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
ifndef|#
directive|ifndef
name|MNG_NO_OPEN_CLOSE_STREAM
block|{
literal|"mng_setcb_openstream"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
endif|#
directive|endif
block|{
literal|"mng_setcb_processarow"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_processchroma"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_processgamma"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_processheader"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_processiccp"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_processmend"
block|,
literal|1
block|,
literal|0
block|,
literal|1
block|}
block|,
block|{
literal|"mng_setcb_processneed"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_processsave"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_processseek"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_processsrgb"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_processterm"
block|,
literal|1
block|,
literal|0
block|,
literal|2
block|}
block|,
block|{
literal|"mng_setcb_processtext"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_processunknown"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_readdata"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_refresh"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_releasedata"
block|,
literal|1
block|,
literal|0
block|,
literal|8
block|}
block|,
block|{
literal|"mng_setcb_settimer"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_traceproc"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_setcb_writedata"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_status_creating"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_status_displaying"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_status_dynamic"
block|,
literal|1
block|,
literal|0
block|,
literal|5
block|}
block|,
block|{
literal|"mng_status_error"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_status_reading"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_status_running"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_status_runningevent"
block|,
literal|1
block|,
literal|0
block|,
literal|5
block|}
block|,
block|{
literal|"mng_status_suspendbreak"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_status_timerbreak"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_status_writing"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_supports_func"
block|,
literal|1
block|,
literal|0
block|,
literal|5
block|}
block|,
block|{
literal|"mng_trapevent"
block|,
literal|1
block|,
literal|0
block|,
literal|5
block|}
block|,
block|{
literal|"mng_updatemngheader"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_updatemngsimplicity"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_version_beta"
block|,
literal|1
block|,
literal|0
block|,
literal|5
block|}
block|,
block|{
literal|"mng_version_dll"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_version_major"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_version_minor"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_version_release"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_version_so"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_version_text"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,
block|{
literal|"mng_write"
block|,
literal|1
block|,
literal|0
block|,
literal|0
block|}
block|,   }
decl_stmt|;
end_decl_stmt
begin_function
DECL|function|mng_supports_func
name|mng_bool
name|MNG_DECL
name|mng_supports_func
parameter_list|(
name|mng_pchar
name|zFunction
parameter_list|,
name|mng_uint8
modifier|*
name|iMajor
parameter_list|,
name|mng_uint8
modifier|*
name|iMinor
parameter_list|,
name|mng_uint8
modifier|*
name|iRelease
parameter_list|)
block|{
name|mng_int32
name|iTop
decl_stmt|,
name|iLower
decl_stmt|,
name|iUpper
decl_stmt|,
name|iMiddle
decl_stmt|;
name|mng_func_entryp
name|pEntry
decl_stmt|;
comment|/* pointer to found entry */
comment|/* determine max index of table */
name|iTop
operator|=
operator|(
sizeof|sizeof
argument_list|(
name|func_table
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|func_table
index|[
literal|0
index|]
argument_list|)
operator|)
operator|-
literal|1
expr_stmt|;
name|iLower
operator|=
literal|0
expr_stmt|;
comment|/* initialize binary search */
name|iMiddle
operator|=
name|iTop
operator|>>
literal|1
expr_stmt|;
comment|/* start in the middle */
name|iUpper
operator|=
name|iTop
expr_stmt|;
name|pEntry
operator|=
literal|0
expr_stmt|;
comment|/* no goods yet! */
do|do
comment|/* the binary search itself */
block|{
name|mng_int32
name|iRslt
init|=
name|strcmp
argument_list|(
name|func_table
index|[
name|iMiddle
index|]
operator|.
name|zFunction
argument_list|,
name|zFunction
argument_list|)
decl_stmt|;
if|if
condition|(
name|iRslt
operator|<
literal|0
condition|)
name|iLower
operator|=
name|iMiddle
operator|+
literal|1
expr_stmt|;
elseif|else
if|if
condition|(
name|iRslt
operator|>
literal|0
condition|)
name|iUpper
operator|=
name|iMiddle
operator|-
literal|1
expr_stmt|;
else|else
block|{
name|pEntry
operator|=
operator|&
name|func_table
index|[
name|iMiddle
index|]
expr_stmt|;
break|break;
block|}
empty_stmt|;
name|iMiddle
operator|=
operator|(
name|iLower
operator|+
name|iUpper
operator|)
operator|>>
literal|1
expr_stmt|;
block|}
do|while
condition|(
name|iLower
operator|<=
name|iUpper
condition|)
do|;
if|if
condition|(
name|pEntry
condition|)
comment|/* found it ? */
block|{
operator|*
name|iMajor
operator|=
name|pEntry
operator|->
name|iMajor
expr_stmt|;
operator|*
name|iMinor
operator|=
name|pEntry
operator|->
name|iMinor
expr_stmt|;
operator|*
name|iRelease
operator|=
name|pEntry
operator|->
name|iRelease
expr_stmt|;
return|return
name|MNG_TRUE
return|;
block|}
else|else
block|{
operator|*
name|iMajor
operator|=
literal|0
expr_stmt|;
operator|*
name|iMinor
operator|=
literal|0
expr_stmt|;
operator|*
name|iRelease
operator|=
literal|0
expr_stmt|;
return|return
name|MNG_FALSE
return|;
block|}
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* * HLAPI routines                                                         * */
end_comment
begin_comment
comment|/* *                                                                        * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_initialize
name|mng_handle
name|MNG_DECL
name|mng_initialize
parameter_list|(
name|mng_ptr
name|pUserdata
parameter_list|,
name|mng_memalloc
name|fMemalloc
parameter_list|,
name|mng_memfree
name|fMemfree
parameter_list|,
name|mng_traceproc
name|fTraceproc
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
name|mng_retcode
name|iRetcode
decl_stmt|;
name|mng_imagep
name|pImage
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_INTERNAL_MEMMNGMT
comment|/* allocate the main datastruc */
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|calloc
argument_list|(
literal|1
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_data
argument_list|)
argument_list|)
expr_stmt|;
else|#
directive|else
name|pData
operator|=
operator|(
name|mng_datap
operator|)
name|fMemalloc
argument_list|(
sizeof|sizeof
argument_list|(
name|mng_data
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|pData
condition|)
return|return
name|MNG_NULL
return|;
comment|/* error: out of memory?? */
comment|/* validate the structure */
name|pData
operator|->
name|iMagic
operator|=
name|MNG_MAGIC
expr_stmt|;
comment|/* save userdata field */
name|pData
operator|->
name|pUserdata
operator|=
name|pUserdata
expr_stmt|;
comment|/* remember trace callback */
name|pData
operator|->
name|fTraceproc
operator|=
name|fTraceproc
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
if|if
condition|(
name|mng_trace
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INITIALIZE
argument_list|,
name|MNG_LC_INITIALIZE
argument_list|)
condition|)
block|{
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_data
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|MNG_NULL
return|;
block|}
endif|#
directive|endif
comment|/* default canvas styles are 8-bit RGB */
name|pData
operator|->
name|iCanvasstyle
operator|=
name|MNG_CANVAS_RGB8
expr_stmt|;
name|pData
operator|->
name|iBkgdstyle
operator|=
name|MNG_CANVAS_RGB8
expr_stmt|;
name|pData
operator|->
name|iBGred
operator|=
literal|0
expr_stmt|;
comment|/* black */
name|pData
operator|->
name|iBGgreen
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iBGblue
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bUseBKGD
operator|=
name|MNG_TRUE
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_FULL_CMS
name|pData
operator|->
name|bIssRGB
operator|=
name|MNG_TRUE
expr_stmt|;
name|pData
operator|->
name|hProf1
operator|=
literal|0
expr_stmt|;
comment|/* no profiles yet */
name|pData
operator|->
name|hProf2
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|hProf3
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|hTrans
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|dViewgamma
operator|=
literal|1.0
expr_stmt|;
name|pData
operator|->
name|dDisplaygamma
operator|=
literal|2.2
expr_stmt|;
name|pData
operator|->
name|dDfltimggamma
operator|=
literal|0.45455
expr_stmt|;
comment|/* initially remember chunks */
name|pData
operator|->
name|bStorechunks
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* no breaks at section-borders */
name|pData
operator|->
name|bSectionbreaks
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* initially cache playback info */
name|pData
operator|->
name|bCacheplayback
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* progressive refresh for large images */
name|pData
operator|->
name|bDoProgressive
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* crc exists; should check; error for                                           critical chunks; warning for ancillery;                                           generate crc for output */
name|pData
operator|->
name|iCrcmode
operator|=
name|MNG_CRC_DEFAULT
expr_stmt|;
comment|/* normal animation-speed ! */
name|pData
operator|->
name|iSpeed
operator|=
name|mng_st_normal
expr_stmt|;
comment|/* initial image limits */
name|pData
operator|->
name|iMaxwidth
operator|=
literal|10000
expr_stmt|;
name|pData
operator|->
name|iMaxheight
operator|=
literal|10000
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_INTERNAL_MEMMNGMT
comment|/* internal management */
name|pData
operator|->
name|fMemalloc
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fMemfree
operator|=
name|MNG_NULL
expr_stmt|;
else|#
directive|else
comment|/* keep callbacks */
name|pData
operator|->
name|fMemalloc
operator|=
name|fMemalloc
expr_stmt|;
name|pData
operator|->
name|fMemfree
operator|=
name|fMemfree
expr_stmt|;
endif|#
directive|endif
comment|/* no value (yet) */
name|pData
operator|->
name|fReleasedata
operator|=
name|MNG_NULL
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_OPEN_CLOSE_STREAM
name|pData
operator|->
name|fOpenstream
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fClosestream
operator|=
name|MNG_NULL
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|fReaddata
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fWritedata
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fErrorproc
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fProcessheader
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fProcesstext
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fProcesssave
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fProcessseek
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fProcessneed
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fProcessmend
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fProcessunknown
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fProcessterm
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fGetcanvasline
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fGetbkgdline
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fGetalphaline
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fRefresh
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fGettickcount
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fSettimer
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fProcessgamma
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fProcesschroma
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fProcesssrgb
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fProcessiccp
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fProcessarow
operator|=
name|MNG_NULL
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|MNG_SUPPORT_DISPLAY
argument_list|)
operator|&&
operator|(
name|defined
argument_list|(
name|MNG_GAMMA_ONLY
argument_list|)
operator|||
name|defined
argument_list|(
name|MNG_FULL_CMS
argument_list|)
operator|)
name|pData
operator|->
name|dLastgamma
operator|=
literal|0
expr_stmt|;
comment|/* lookup table needs first-time calc */
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
comment|/* create object 0 */
name|iRetcode
operator|=
name|mng_create_imageobject
argument_list|(
name|pData
argument_list|,
literal|0
argument_list|,
name|MNG_TRUE
argument_list|,
name|MNG_TRUE
argument_list|,
name|MNG_TRUE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
name|MNG_FALSE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
operator|&
name|pImage
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error drop out */
block|{
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_data
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|MNG_NULL
return|;
block|}
name|pData
operator|->
name|pObjzero
operator|=
name|pImage
expr_stmt|;
endif|#
directive|endif
if|#
directive|if
name|defined
argument_list|(
name|MNG_SUPPORT_DISPLAY
argument_list|)
operator|&&
name|defined
argument_list|(
name|MNG_INCLUDE_LCMS
argument_list|)
name|mnglcms_initlibrary
argument_list|()
expr_stmt|;
comment|/* init lcms particulars */
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_READ
name|pData
operator|->
name|bSuspensionmode
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iSuspendbufsize
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|pSuspendbuf
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pSuspendbufnext
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|iSuspendbufleft
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iChunklen
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|pReadbufnext
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pLargebufnext
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pFirstpushchunk
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pLastpushchunk
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pFirstpushdata
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pLastpushdata
operator|=
name|MNG_NULL
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_INCLUDE_ZLIB
name|mngzlib_initialize
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* initialize zlib structures and such */
comment|/* default zlib compression parameters */
name|pData
operator|->
name|iZlevel
operator|=
name|MNG_ZLIB_LEVEL
expr_stmt|;
name|pData
operator|->
name|iZmethod
operator|=
name|MNG_ZLIB_METHOD
expr_stmt|;
name|pData
operator|->
name|iZwindowbits
operator|=
name|MNG_ZLIB_WINDOWBITS
expr_stmt|;
name|pData
operator|->
name|iZmemlevel
operator|=
name|MNG_ZLIB_MEMLEVEL
expr_stmt|;
name|pData
operator|->
name|iZstrategy
operator|=
name|MNG_ZLIB_STRATEGY
expr_stmt|;
comment|/* default maximum IDAT data size */
name|pData
operator|->
name|iMaxIDAT
operator|=
name|MNG_MAX_IDAT_SIZE
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
comment|/* default IJG compression parameters */
name|pData
operator|->
name|eJPEGdctmethod
operator|=
name|MNG_JPEG_DCT
expr_stmt|;
name|pData
operator|->
name|iJPEGquality
operator|=
name|MNG_JPEG_QUALITY
expr_stmt|;
name|pData
operator|->
name|iJPEGsmoothing
operator|=
name|MNG_JPEG_SMOOTHING
expr_stmt|;
name|pData
operator|->
name|bJPEGcompressprogr
operator|=
name|MNG_JPEG_PROGRESSIVE
expr_stmt|;
name|pData
operator|->
name|bJPEGcompressopt
operator|=
name|MNG_JPEG_OPTIMIZED
expr_stmt|;
comment|/* default maximum JDAT data size */
name|pData
operator|->
name|iMaxJDAT
operator|=
name|MNG_MAX_JDAT_SIZE
expr_stmt|;
endif|#
directive|endif
name|mng_reset
argument_list|(
operator|(
name|mng_handle
operator|)
name|pData
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
if|if
condition|(
name|mng_trace
argument_list|(
name|pData
argument_list|,
name|MNG_FN_INITIALIZE
argument_list|,
name|MNG_LC_END
argument_list|)
condition|)
block|{
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pData
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_data
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|MNG_NULL
return|;
block|}
endif|#
directive|endif
return|return
operator|(
name|mng_handle
operator|)
name|pData
return|;
comment|/* if we get here, we're in business */
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_reset
name|mng_retcode
name|MNG_DECL
name|mng_reset
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_RESET
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
call|(
name|mng_datap
call|)
argument_list|(
name|hHandle
argument_list|)
operator|)
expr_stmt|;
comment|/* address main structure */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SAVE
name|mng_drop_savedata
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup saved-data from SAVE/SEEK */
endif|#
directive|endif
endif|#
directive|endif
if|#
directive|if
name|defined
argument_list|(
name|MNG_SUPPORT_DISPLAY
argument_list|)
operator|&&
name|defined
argument_list|(
name|MNG_FULL_CMS
argument_list|)
name|mng_clear_cms
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup left-over cms stuff if any */
endif|#
directive|endif
if|#
directive|if
name|defined
argument_list|(
name|MNG_SUPPORT_DISPLAY
argument_list|)
operator|&&
name|defined
argument_list|(
name|MNG_INCLUDE_JNG
argument_list|)
name|mngjpeg_cleanup
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup jpeg stuff */
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_INCLUDE_ZLIB
if|if
condition|(
name|pData
operator|->
name|bInflating
condition|)
comment|/* if we've been inflating */
block|{
ifdef|#
directive|ifdef
name|MNG_INCLUDE_DISPLAY_PROCS
name|mng_cleanup_rowproc
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup row-processing, */
endif|#
directive|endif
name|mngzlib_inflatefree
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup inflate! */
block|}
endif|#
directive|endif
comment|/* MNG_INCLUDE_ZLIB */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_READ
if|if
condition|(
operator|(
name|pData
operator|->
name|bReading
operator|)
operator|&&
operator|(
operator|!
name|pData
operator|->
name|bEOF
operator|)
condition|)
name|mng_process_eof
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup app streaming */
comment|/* cleanup default read buffers */
name|MNG_FREE
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pReadbuf
argument_list|,
name|pData
operator|->
name|iReadbufsize
argument_list|)
expr_stmt|;
name|MNG_FREE
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pLargebuf
argument_list|,
name|pData
operator|->
name|iLargebufsize
argument_list|)
expr_stmt|;
name|MNG_FREE
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pSuspendbuf
argument_list|,
name|pData
operator|->
name|iSuspendbufsize
argument_list|)
expr_stmt|;
while|while
condition|(
name|pData
operator|->
name|pFirstpushdata
condition|)
comment|/* release any pushed data& chunks */
name|mng_release_pushdata
argument_list|(
name|pData
argument_list|)
expr_stmt|;
while|while
condition|(
name|pData
operator|->
name|pFirstpushchunk
condition|)
name|mng_release_pushchunk
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_WRITE
comment|/* cleanup default write buffer */
name|MNG_FREE
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pWritebuf
argument_list|,
name|pData
operator|->
name|iWritebufsize
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|#
directive|if
name|defined
argument_list|(
name|MNG_SUPPORT_READ
argument_list|)
operator|||
name|defined
argument_list|(
name|MNG_SUPPORT_WRITE
argument_list|)
name|mng_drop_chunks
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* drop stored chunks (if any) */
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
name|mng_drop_objects
argument_list|(
name|pData
argument_list|,
name|MNG_TRUE
argument_list|)
expr_stmt|;
comment|/* drop stored objects (if any) */
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
if|if
condition|(
name|pData
operator|->
name|iGlobalProfilesize
condition|)
comment|/* drop global profile (if any) */
name|MNG_FREEX
argument_list|(
name|pData
argument_list|,
name|pData
operator|->
name|pGlobalProfile
argument_list|,
name|pData
operator|->
name|iGlobalProfilesize
argument_list|)
expr_stmt|;
endif|#
directive|endif
endif|#
directive|endif
name|pData
operator|->
name|eSigtype
operator|=
name|mng_it_unknown
expr_stmt|;
name|pData
operator|->
name|eImagetype
operator|=
name|mng_it_unknown
expr_stmt|;
name|pData
operator|->
name|iWidth
operator|=
literal|0
expr_stmt|;
comment|/* these are unknown yet */
name|pData
operator|->
name|iHeight
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iTicks
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iLayercount
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFramecount
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iPlaytime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSimplicity
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iAlphadepth
operator|=
literal|16
expr_stmt|;
comment|/* assume the worst! */
name|pData
operator|->
name|iImagelevel
operator|=
literal|0
expr_stmt|;
comment|/* no image encountered */
name|pData
operator|->
name|iMagnify
operator|=
literal|0
expr_stmt|;
comment|/* 1-to-1 display */
name|pData
operator|->
name|iOffsetx
operator|=
literal|0
expr_stmt|;
comment|/* no offsets */
name|pData
operator|->
name|iOffsety
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iCanvaswidth
operator|=
literal|0
expr_stmt|;
comment|/* let the app decide during processheader */
name|pData
operator|->
name|iCanvasheight
operator|=
literal|0
expr_stmt|;
comment|/* so far, so good */
name|pData
operator|->
name|iErrorcode
operator|=
name|MNG_NOERROR
expr_stmt|;
name|pData
operator|->
name|iSeverity
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iErrorx1
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iErrorx2
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|zErrortext
operator|=
name|MNG_NULL
expr_stmt|;
if|#
directive|if
name|defined
argument_list|(
name|MNG_SUPPORT_READ
argument_list|)
operator|||
name|defined
argument_list|(
name|MNG_SUPPORT_WRITE
argument_list|)
comment|/* let's assume the best scenario */
ifndef|#
directive|ifndef
name|MNG_NO_OLD_VERSIONS
name|pData
operator|->
name|bPreDraft48
operator|=
name|MNG_FALSE
expr_stmt|;
endif|#
directive|endif
comment|/* the unknown chunk */
name|pData
operator|->
name|iChunkname
operator|=
name|MNG_UINT_HUH
expr_stmt|;
name|pData
operator|->
name|iChunkseq
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|pFirstchunk
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pLastchunk
operator|=
name|MNG_NULL
expr_stmt|;
comment|/* nothing processed yet */
name|pData
operator|->
name|bHasheader
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasMHDR
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasIHDR
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasBASI
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasDHDR
operator|=
name|MNG_FALSE
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
name|pData
operator|->
name|bHasJHDR
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasJSEP
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasJDAA
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasJDAT
operator|=
name|MNG_FALSE
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|bHasPLTE
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasTRNS
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasGAMA
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasCHRM
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasSRGB
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasICCP
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasBKGD
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasIDAT
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasSAVE
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasBACK
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasFRAM
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasTERM
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasLOOP
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* there's no global stuff yet either */
name|pData
operator|->
name|bHasglobalPLTE
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasglobalTRNS
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasglobalGAMA
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasglobalCHRM
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasglobalSRGB
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHasglobalICCP
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iDatawidth
operator|=
literal|0
expr_stmt|;
comment|/* no IHDR/BASI/DHDR done yet */
name|pData
operator|->
name|iDataheight
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iBitdepth
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColortype
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iCompression
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFilter
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iInterlace
operator|=
literal|0
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_INCLUDE_JNG
name|pData
operator|->
name|iJHDRcolortype
operator|=
literal|0
expr_stmt|;
comment|/* no JHDR data */
name|pData
operator|->
name|iJHDRimgbitdepth
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iJHDRimgcompression
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iJHDRimginterlace
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iJHDRalphabitdepth
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iJHDRalphacompression
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iJHDRalphafilter
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iJHDRalphainterlace
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
endif|#
directive|endif
comment|/* MNG_SUPPORT_READ || MNG_SUPPORT_WRITE */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_READ
comment|/* no reading done */
name|pData
operator|->
name|bReading
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bHavesig
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bEOF
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iReadbufsize
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|pReadbuf
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|iLargebufsize
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|pLargebuf
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|iSuspendtime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bSuspended
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iSuspendpoint
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|pSuspendbufnext
operator|=
name|pData
operator|->
name|pSuspendbuf
expr_stmt|;
name|pData
operator|->
name|iSuspendbufleft
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
comment|/* MNG_SUPPORT_READ */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_WRITE
comment|/* no creating/writing done */
name|pData
operator|->
name|bCreating
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bWriting
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iFirstchunkadded
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iWritebufsize
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|pWritebuf
operator|=
name|MNG_NULL
expr_stmt|;
endif|#
directive|endif
comment|/* MNG_SUPPORT_WRITE */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
comment|/* done nuttin' yet */
name|pData
operator|->
name|bDisplaying
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iFrameseq
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iLayerseq
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFrametime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iTotallayers
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iTotalframes
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iTotalplaytime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bSkipping
operator|=
name|MNG_FALSE
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DYNAMICMNG
name|pData
operator|->
name|bDynamic
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bRunningevent
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bStopafterseek
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iEventx
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iEventy
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|pLastmousemove
operator|=
name|MNG_NULL
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iRequestframe
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRequestlayer
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRequesttime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bSearching
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bRestorebkgd
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iRuntime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSynctime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iStarttime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iEndtime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bRunning
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bTimerset
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iBreakpoint
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bSectionwait
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bFreezing
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bResetting
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bNeedrefresh
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bMisplacedTERM
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|bOnlyfirstframe
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iFramesafterTERM
operator|=
literal|0
expr_stmt|;
comment|/* these don't exist yet */
name|pData
operator|->
name|pCurrentobj
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pCurraniobj
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pTermaniobj
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pLastclone
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pStoreobj
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pStorebuf
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pRetrieveobj
operator|=
name|MNG_NULL
expr_stmt|;
comment|/* no saved data ! */
name|pData
operator|->
name|pSavedata
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|iUpdateleft
operator|=
literal|0
expr_stmt|;
comment|/* no region updated yet */
name|pData
operator|->
name|iUpdateright
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iUpdatetop
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iUpdatebottom
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iPass
operator|=
operator|-
literal|1
expr_stmt|;
comment|/* interlacing stuff and temp buffers */
name|pData
operator|->
name|iRow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iCol
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iColinc
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iRowsamples
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplemul
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSampleofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSamplediv
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowsize
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRowmax
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFilterofs
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iPixelofs
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iLevel0
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iLevel1
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iLevel2
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iLevel3
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|pWorkrow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pPrevrow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pRGBArow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|bIsRGBA16
operator|=
name|MNG_TRUE
expr_stmt|;
name|pData
operator|->
name|bIsOpaque
operator|=
name|MNG_TRUE
expr_stmt|;
name|pData
operator|->
name|iFilterbpp
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iSourcel
operator|=
literal|0
expr_stmt|;
comment|/* always initialized just before */
name|pData
operator|->
name|iSourcer
operator|=
literal|0
expr_stmt|;
comment|/* compositing the next layer */
name|pData
operator|->
name|iSourcet
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSourceb
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDestl
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDestr
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDestt
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDestb
operator|=
literal|0
expr_stmt|;
comment|/* lists are empty */
name|pData
operator|->
name|pFirstimgobj
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pLastimgobj
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pFirstaniobj
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pLastaniobj
operator|=
name|MNG_NULL
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DYNAMICMNG
name|pData
operator|->
name|pFirstevent
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pLastevent
operator|=
name|MNG_NULL
expr_stmt|;
endif|#
directive|endif
comment|/* no processing callbacks */
name|pData
operator|->
name|fDisplayrow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fRestbkgdrow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fCorrectrow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fRetrieverow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fStorerow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fProcessrow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fDifferrow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fScalerow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fDeltarow
operator|=
name|MNG_NULL
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_PAST
name|pData
operator|->
name|fFliprow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fTilerow
operator|=
name|MNG_NULL
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|fInitrowproc
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|iPLTEcount
operator|=
literal|0
expr_stmt|;
comment|/* no PLTE data */
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_DEFI
name|pData
operator|->
name|iDEFIobjectid
operator|=
literal|0
expr_stmt|;
comment|/* no DEFI data */
name|pData
operator|->
name|bDEFIhasdonotshow
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iDEFIdonotshow
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bDEFIhasconcrete
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iDEFIconcrete
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bDEFIhasloca
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iDEFIlocax
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDEFIlocay
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bDEFIhasclip
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iDEFIclipl
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDEFIclipr
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDEFIclipt
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDEFIclipb
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_BACK
name|pData
operator|->
name|iBACKred
operator|=
literal|0
expr_stmt|;
comment|/* no BACK data */
name|pData
operator|->
name|iBACKgreen
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iBACKblue
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iBACKmandatory
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iBACKimageid
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iBACKtile
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_FRAM
name|pData
operator|->
name|iFRAMmode
operator|=
literal|1
expr_stmt|;
comment|/* default global FRAM variables */
name|pData
operator|->
name|iFRAMdelay
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iFRAMtimeout
operator|=
literal|0x7fffffffl
expr_stmt|;
name|pData
operator|->
name|bFRAMclipping
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iFRAMclipl
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFRAMclipr
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFRAMclipt
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFRAMclipb
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFramemode
operator|=
literal|1
expr_stmt|;
comment|/* again for the current frame */
name|pData
operator|->
name|iFramedelay
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|iFrametimeout
operator|=
literal|0x7fffffffl
expr_stmt|;
name|pData
operator|->
name|bFrameclipping
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iFrameclipl
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFrameclipr
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFrameclipt
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFrameclipb
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iNextdelay
operator|=
literal|1
expr_stmt|;
name|pData
operator|->
name|bForcedelay
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iAccumdelay
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_SHOW
name|pData
operator|->
name|iSHOWmode
operator|=
literal|0
expr_stmt|;
comment|/* no SHOW data */
name|pData
operator|->
name|iSHOWfromid
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSHOWtoid
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSHOWnextid
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSHOWskip
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iGlobalPLTEcount
operator|=
literal|0
expr_stmt|;
comment|/* no global PLTE data */
name|pData
operator|->
name|iGlobalTRNSrawlen
operator|=
literal|0
expr_stmt|;
comment|/* no global tRNS data */
name|pData
operator|->
name|iGlobalGamma
operator|=
literal|0
expr_stmt|;
comment|/* no global gAMA data */
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_cHRM
name|pData
operator|->
name|iGlobalWhitepointx
operator|=
literal|0
expr_stmt|;
comment|/* no global cHRM data */
name|pData
operator|->
name|iGlobalWhitepointy
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimaryredx
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimaryredy
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimarygreenx
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimarygreeny
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimarybluex
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalPrimarybluey
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iGlobalRendintent
operator|=
literal|0
expr_stmt|;
comment|/* no global sRGB data */
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_iCCP
name|pData
operator|->
name|iGlobalProfilesize
operator|=
literal|0
expr_stmt|;
comment|/* no global iCCP data */
name|pData
operator|->
name|pGlobalProfile
operator|=
name|MNG_NULL
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_bKGD
name|pData
operator|->
name|iGlobalBKGDred
operator|=
literal|0
expr_stmt|;
comment|/* no global bKGD data */
name|pData
operator|->
name|iGlobalBKGDgreen
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iGlobalBKGDblue
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
comment|/* no delta-image */
ifndef|#
directive|ifndef
name|MNG_NO_DELTA_PNG
name|pData
operator|->
name|pDeltaImage
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|iDeltaImagetype
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDeltatype
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDeltaBlockwidth
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDeltaBlockheight
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDeltaBlockx
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iDeltaBlocky
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bDeltaimmediate
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|fDeltagetrow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fDeltaaddrow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fDeltareplacerow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fDeltaputrow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fPromoterow
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|fPromBitdepth
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pPromBuf
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|iPromColortype
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iPromBitdepth
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iPromFilltype
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iPromWidth
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|pPromSrc
operator|=
name|MNG_NULL
expr_stmt|;
name|pData
operator|->
name|pPromDst
operator|=
name|MNG_NULL
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_MAGN
name|pData
operator|->
name|iMAGNfromid
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iMAGNtoid
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_SKIPCHUNK_PAST
name|pData
operator|->
name|iPastx
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iPasty
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|pLastseek
operator|=
name|MNG_NULL
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_INCLUDE_ZLIB
name|pData
operator|->
name|bInflating
operator|=
literal|0
expr_stmt|;
comment|/* no inflating or deflating */
name|pData
operator|->
name|bDeflating
operator|=
literal|0
expr_stmt|;
comment|/* going on at the moment */
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
comment|/* reset object 0 */
name|mng_reset_objzero
argument_list|(
name|pData
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_RESET
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_cleanup
name|mng_retcode
name|MNG_DECL
name|mng_cleanup
parameter_list|(
name|mng_handle
modifier|*
name|hHandle
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
comment|/* local vars */
ifndef|#
directive|ifndef
name|MNG_INTERNAL_MEMMNGMT
name|mng_memfree
name|fFree
decl_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
operator|*
name|hHandle
operator|)
argument_list|,
name|MNG_FN_CLEANUP
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|*hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
call|(
name|mng_datap
call|)
argument_list|(
operator|*
name|hHandle
argument_list|)
operator|)
expr_stmt|;
comment|/* and address main structure */
name|mng_reset
argument_list|(
operator|*
name|hHandle
argument_list|)
expr_stmt|;
comment|/* do an implicit reset to cleanup most stuff */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
comment|/* drop object 0 */
name|mng_free_imageobject
argument_list|(
name|pData
argument_list|,
operator|(
name|mng_imagep
operator|)
name|pData
operator|->
name|pObjzero
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|#
directive|if
name|defined
argument_list|(
name|MNG_SUPPORT_DISPLAY
argument_list|)
operator|&&
name|defined
argument_list|(
name|MNG_FULL_CMS
argument_list|)
if|if
condition|(
name|pData
operator|->
name|hProf2
condition|)
comment|/* output profile defined ? */
name|mnglcms_freeprofile
argument_list|(
name|pData
operator|->
name|hProf2
argument_list|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|hProf3
condition|)
comment|/* sRGB profile defined ? */
name|mnglcms_freeprofile
argument_list|(
name|pData
operator|->
name|hProf3
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_INCLUDE_ZLIB
name|mngzlib_cleanup
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup zlib stuff */
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
argument|((mng_datap)*hHandle)
argument_list|,
argument|MNG_FN_CLEANUP
argument_list|,
argument|MNG_LC_CLEANUP
argument_list|)
endif|#
directive|endif
name|pData
operator|->
name|iMagic
operator|=
literal|0
expr_stmt|;
comment|/* invalidate the actual memory */
ifdef|#
directive|ifdef
name|MNG_INTERNAL_MEMMNGMT
name|free
argument_list|(
operator|(
name|void
operator|*
operator|)
operator|*
name|hHandle
argument_list|)
expr_stmt|;
comment|/* cleanup the data-structure */
else|#
directive|else
name|fFree
operator|=
operator|(
operator|(
name|mng_datap
operator|)
operator|*
name|hHandle
operator|)
operator|->
name|fMemfree
expr_stmt|;
name|fFree
argument_list|(
operator|(
name|mng_ptr
operator|)
operator|*
name|hHandle
argument_list|,
sizeof|sizeof
argument_list|(
name|mng_data
argument_list|)
argument_list|)
expr_stmt|;
endif|#
directive|endif
operator|*
name|hHandle
operator|=
literal|0
expr_stmt|;
comment|/* wipe pointer to inhibit future use */
return|return
name|MNG_NOERROR
return|;
comment|/* and we're done */
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_READ
end_ifdef
begin_function
DECL|function|mng_read
name|mng_retcode
name|MNG_DECL
name|mng_read
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
comment|/* local vars */
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_READ
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle and callbacks */
name|pData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
ifndef|#
directive|ifndef
name|MNG_INTERNAL_MEMMNGMT
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fMemalloc
argument_list|)
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fMemfree
argument_list|)
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_NO_OPEN_CLOSE_STREAM
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fOpenstream
argument_list|)
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fClosestream
argument_list|)
endif|#
directive|endif
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fReaddata
argument_list|)
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
comment|/* valid at this point ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|bReading
operator|)
operator|||
operator|(
name|pData
operator|->
name|bDisplaying
operator|)
condition|)
else|#
directive|else
if|if
condition|(
name|pData
operator|->
name|bReading
condition|)
endif|#
directive|endif
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_WRITE
if|if
condition|(
operator|(
name|pData
operator|->
name|bWriting
operator|)
operator|||
operator|(
name|pData
operator|->
name|bCreating
operator|)
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|!
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* must store playback info to work!! */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
name|cleanup_errors
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup previous errors */
name|pData
operator|->
name|bReading
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* read only! */
ifndef|#
directive|ifndef
name|MNG_NO_OPEN_CLOSE_STREAM
if|if
condition|(
name|pData
operator|->
name|fOpenstream
operator|&&
operator|!
name|pData
operator|->
name|fOpenstream
argument_list|(
name|hHandle
argument_list|)
condition|)
comment|/* open it and start reading */
name|iRetcode
operator|=
name|MNG_APPIOERROR
expr_stmt|;
else|else
endif|#
directive|endif
name|iRetcode
operator|=
name|mng_read_graphic
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bEOF
condition|)
comment|/* already at EOF ? */
block|{
name|pData
operator|->
name|bReading
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* then we're no longer reading */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
name|mng_reset_rundata
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* reset rundata */
endif|#
directive|endif
block|}
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
if|if
condition|(
name|pData
operator|->
name|bSuspended
condition|)
comment|/* read suspension ? */
block|{
name|iRetcode
operator|=
name|MNG_NEEDMOREDATA
expr_stmt|;
name|pData
operator|->
name|iSuspendtime
operator|=
name|pData
operator|->
name|fGettickcount
argument_list|(
operator|(
name|mng_handle
operator|)
name|pData
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_READ
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_READ */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_READ
end_ifdef
begin_function
DECL|function|mng_read_pushdata
name|mng_retcode
name|MNG_DECL
name|mng_read_pushdata
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_ptr
name|pData
parameter_list|,
name|mng_size_t
name|iLength
parameter_list|,
name|mng_bool
name|bTakeownership
parameter_list|)
block|{
name|mng_datap
name|pMyData
decl_stmt|;
comment|/* local vars */
name|mng_pushdatap
name|pPush
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_READ_PUSHDATA
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pMyData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
comment|/* create a containing buffer */
name|iRetcode
operator|=
name|make_pushbuffer
argument_list|(
name|pMyData
argument_list|,
name|pData
argument_list|,
name|iLength
argument_list|,
name|bTakeownership
argument_list|,
operator|&
name|pPush
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
if|if
condition|(
name|pMyData
operator|->
name|pLastpushdata
condition|)
comment|/* and update the buffer chain */
name|pMyData
operator|->
name|pLastpushdata
operator|->
name|pNext
operator|=
name|pPush
expr_stmt|;
else|else
name|pMyData
operator|->
name|pFirstpushdata
operator|=
name|pPush
expr_stmt|;
name|pMyData
operator|->
name|pLastpushdata
operator|=
name|pPush
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_READ_PUSHDATA
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_READ */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_READ
end_ifdef
begin_function
DECL|function|mng_read_pushsig
name|mng_retcode
name|MNG_DECL
name|mng_read_pushsig
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_imgtype
name|eSigtype
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
comment|/* local vars */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_READ_PUSHSIG
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
name|pData
operator|->
name|bHavesig
condition|)
comment|/* can we expect this call ? */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
name|pData
operator|->
name|eSigtype
operator|=
name|eSigtype
expr_stmt|;
name|pData
operator|->
name|bHavesig
operator|=
name|MNG_TRUE
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_READ_PUSHSIG
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_READ */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_READ
end_ifdef
begin_function
DECL|function|mng_read_pushchunk
name|mng_retcode
name|MNG_DECL
name|mng_read_pushchunk
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_ptr
name|pChunk
parameter_list|,
name|mng_size_t
name|iLength
parameter_list|,
name|mng_bool
name|bTakeownership
parameter_list|)
block|{
name|mng_datap
name|pMyData
decl_stmt|;
comment|/* local vars */
name|mng_pushdatap
name|pPush
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_READ_PUSHCHUNK
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pMyData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
comment|/* create a containing buffer */
name|iRetcode
operator|=
name|make_pushbuffer
argument_list|(
name|pMyData
argument_list|,
name|pChunk
argument_list|,
name|iLength
argument_list|,
name|bTakeownership
argument_list|,
operator|&
name|pPush
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
return|return
name|iRetcode
return|;
if|if
condition|(
name|pMyData
operator|->
name|pLastpushchunk
condition|)
comment|/* and update the buffer chain */
name|pMyData
operator|->
name|pLastpushchunk
operator|->
name|pNext
operator|=
name|pPush
expr_stmt|;
else|else
name|pMyData
operator|->
name|pFirstpushchunk
operator|=
name|pPush
expr_stmt|;
name|pMyData
operator|->
name|pLastpushchunk
operator|=
name|pPush
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_READ_PUSHCHUNK
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_READ */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_READ
end_ifdef
begin_function
DECL|function|mng_read_resume
name|mng_retcode
name|MNG_DECL
name|mng_read_resume
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
comment|/* local vars */
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_READ_RESUME
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
comment|/* can we expect this call ? */
if|if
condition|(
operator|(
operator|!
name|pData
operator|->
name|bReading
operator|)
operator|||
operator|(
operator|!
name|pData
operator|->
name|bSuspended
operator|)
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
name|cleanup_errors
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup previous errors */
name|pData
operator|->
name|bSuspended
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* reset the flag */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
comment|/* re-synchronize ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|bDisplaying
operator|)
operator|&&
operator|(
name|pData
operator|->
name|bRunning
operator|)
condition|)
name|pData
operator|->
name|iSynctime
operator|=
name|pData
operator|->
name|iSynctime
operator|-
name|pData
operator|->
name|iSuspendtime
operator|+
name|pData
operator|->
name|fGettickcount
argument_list|(
name|hHandle
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|iRetcode
operator|=
name|mng_read_graphic
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* continue reading now */
if|if
condition|(
name|pData
operator|->
name|bEOF
condition|)
comment|/* at EOF ? */
block|{
name|pData
operator|->
name|bReading
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* then we're no longer reading */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
name|mng_reset_rundata
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* reset rundata */
endif|#
directive|endif
block|}
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
if|if
condition|(
name|pData
operator|->
name|bSuspended
condition|)
comment|/* read suspension ? */
block|{
name|iRetcode
operator|=
name|MNG_NEEDMOREDATA
expr_stmt|;
name|pData
operator|->
name|iSuspendtime
operator|=
name|pData
operator|->
name|fGettickcount
argument_list|(
operator|(
name|mng_handle
operator|)
name|pData
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_READ_RESUME
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_READ */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_WRITE
end_ifdef
begin_function
DECL|function|mng_write
name|mng_retcode
name|MNG_DECL
name|mng_write
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_WRITE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle and callbacks */
name|pData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
ifndef|#
directive|ifndef
name|MNG_INTERNAL_MEMMNGMT
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fMemalloc
argument_list|)
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fMemfree
argument_list|)
endif|#
directive|endif
ifndef|#
directive|ifndef
name|MNG_NO_OPEN_CLOSE_STREAM
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fOpenstream
argument_list|)
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fClosestream
argument_list|)
endif|#
directive|endif
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fWritedata
argument_list|)
ifdef|#
directive|ifdef
name|MNG_SUPPORT_READ
if|if
condition|(
name|pData
operator|->
name|bReading
condition|)
comment|/* valid at this point ? */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|cleanup_errors
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup previous errors */
name|iRetcode
operator|=
name|mng_write_graphic
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* do the write */
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_WRITE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_WRITE */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_WRITE
end_ifdef
begin_function
DECL|function|mng_create
name|mng_retcode
name|MNG_DECL
name|mng_create
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_CREATE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle and callbacks */
name|pData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
ifndef|#
directive|ifndef
name|MNG_INTERNAL_MEMMNGMT
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fMemalloc
argument_list|)
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fMemfree
argument_list|)
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_READ
if|if
condition|(
name|pData
operator|->
name|bReading
condition|)
comment|/* valid at this point ? */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
endif|#
directive|endif
if|if
condition|(
operator|(
name|pData
operator|->
name|bWriting
operator|)
operator|||
operator|(
name|pData
operator|->
name|bCreating
operator|)
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
name|cleanup_errors
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup previous errors */
name|iRetcode
operator|=
name|mng_reset
argument_list|(
name|hHandle
argument_list|)
expr_stmt|;
comment|/* clear any previous stuff */
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
name|pData
operator|->
name|bCreating
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* indicate we're creating a new file */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_CREATE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_WRITE */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_if
if|#
directive|if
name|defined
argument_list|(
name|MNG_SUPPORT_DISPLAY
argument_list|)
operator|&&
name|defined
argument_list|(
name|MNG_SUPPORT_READ
argument_list|)
end_if
begin_function
DECL|function|mng_readdisplay
name|mng_retcode
name|MNG_DECL
name|mng_readdisplay
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
comment|/* local vars */
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_READDISPLAY
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle and callbacks */
name|pData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
ifndef|#
directive|ifndef
name|MNG_INTERNAL_MEMMNGMT
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fMemalloc
argument_list|)
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fMemfree
argument_list|)
endif|#
directive|endif
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fReaddata
argument_list|)
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fGetcanvasline
argument_list|)
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fRefresh
argument_list|)
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fGettickcount
argument_list|)
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fSettimer
argument_list|)
comment|/* valid at this point ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|bReading
operator|)
operator|||
operator|(
name|pData
operator|->
name|bDisplaying
operator|)
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_WRITE
if|if
condition|(
operator|(
name|pData
operator|->
name|bWriting
operator|)
operator|||
operator|(
name|pData
operator|->
name|bCreating
operator|)
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|cleanup_errors
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup previous errors */
name|pData
operator|->
name|bReading
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* read& display! */
name|pData
operator|->
name|bDisplaying
operator|=
name|MNG_TRUE
expr_stmt|;
name|pData
operator|->
name|bRunning
operator|=
name|MNG_TRUE
expr_stmt|;
name|pData
operator|->
name|iFrameseq
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iLayerseq
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFrametime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRequestframe
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRequestlayer
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRequesttime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bSearching
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iRuntime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSynctime
operator|=
name|pData
operator|->
name|fGettickcount
argument_list|(
name|hHandle
argument_list|)
expr_stmt|;
name|pData
operator|->
name|iSuspendtime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iStarttime
operator|=
name|pData
operator|->
name|iSynctime
expr_stmt|;
name|pData
operator|->
name|iEndtime
operator|=
literal|0
expr_stmt|;
ifndef|#
directive|ifndef
name|MNG_NO_OPEN_CLOSE_STREAM
if|if
condition|(
name|pData
operator|->
name|fOpenstream
operator|&&
operator|!
name|pData
operator|->
name|fOpenstream
argument_list|(
name|hHandle
argument_list|)
condition|)
comment|/* open it and start reading */
name|iRetcode
operator|=
name|MNG_APPIOERROR
expr_stmt|;
else|else
endif|#
directive|endif
name|iRetcode
operator|=
name|mng_read_graphic
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bEOF
condition|)
comment|/* already at EOF ? */
block|{
name|pData
operator|->
name|bReading
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* then we're no longer reading */
name|mng_drop_invalid_objects
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* drop invalidly stored objects */
block|}
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
if|if
condition|(
name|pData
operator|->
name|bSuspended
condition|)
comment|/* read suspension ? */
block|{
name|iRetcode
operator|=
name|MNG_NEEDMOREDATA
expr_stmt|;
name|pData
operator|->
name|iSuspendtime
operator|=
name|pData
operator|->
name|fGettickcount
argument_list|(
operator|(
name|mng_handle
operator|)
name|pData
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|bTimerset
condition|)
comment|/* indicate timer break ? */
name|iRetcode
operator|=
name|MNG_NEEDTIMERWAIT
expr_stmt|;
elseif|else
if|if
condition|(
name|pData
operator|->
name|bSectionwait
condition|)
comment|/* indicate section break ? */
name|iRetcode
operator|=
name|MNG_NEEDSECTIONWAIT
expr_stmt|;
else|else
block|{
comment|/* no breaks = end of run */
name|pData
operator|->
name|bRunning
operator|=
name|MNG_FALSE
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bFreezing
condition|)
comment|/* dynamic MNG reached SEEK ? */
name|pData
operator|->
name|bFreezing
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* reset it ! */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_READDISPLAY
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_DISPLAY&& MNG_SUPPORT_READ */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
end_ifdef
begin_function
DECL|function|mng_display
name|mng_retcode
name|MNG_DECL
name|mng_display
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
comment|/* local vars */
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_DISPLAY
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle and callbacks */
name|pData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
ifndef|#
directive|ifndef
name|MNG_INTERNAL_MEMMNGMT
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fMemalloc
argument_list|)
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fMemfree
argument_list|)
endif|#
directive|endif
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fGetcanvasline
argument_list|)
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fRefresh
argument_list|)
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fGettickcount
argument_list|)
name|MNG_VALIDCB
argument_list|(
argument|hHandle
argument_list|,
argument|fSettimer
argument_list|)
if|if
condition|(
name|pData
operator|->
name|bDisplaying
condition|)
comment|/* valid at this point ? */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_READ
if|if
condition|(
name|pData
operator|->
name|bReading
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
endif|#
directive|endif
ifdef|#
directive|ifdef
name|MNG_SUPPORT_WRITE
if|if
condition|(
operator|(
name|pData
operator|->
name|bWriting
operator|)
operator|||
operator|(
name|pData
operator|->
name|bCreating
operator|)
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|cleanup_errors
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup previous errors */
name|pData
operator|->
name|bDisplaying
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* display! */
name|pData
operator|->
name|bRunning
operator|=
name|MNG_TRUE
expr_stmt|;
name|pData
operator|->
name|iFrameseq
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iLayerseq
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iFrametime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRequestframe
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRequestlayer
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iRequesttime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|bSearching
operator|=
name|MNG_FALSE
expr_stmt|;
name|pData
operator|->
name|iRuntime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|iSynctime
operator|=
name|pData
operator|->
name|fGettickcount
argument_list|(
name|hHandle
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_READ
name|pData
operator|->
name|iSuspendtime
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
name|pData
operator|->
name|iStarttime
operator|=
name|pData
operator|->
name|iSynctime
expr_stmt|;
name|pData
operator|->
name|iEndtime
operator|=
literal|0
expr_stmt|;
name|pData
operator|->
name|pCurraniobj
operator|=
name|pData
operator|->
name|pFirstaniobj
expr_stmt|;
comment|/* go do it */
name|iRetcode
operator|=
name|mng_process_display
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
if|if
condition|(
name|pData
operator|->
name|bTimerset
condition|)
comment|/* indicate timer break ? */
name|iRetcode
operator|=
name|MNG_NEEDTIMERWAIT
expr_stmt|;
else|else
block|{
comment|/* no breaks = end of run */
name|pData
operator|->
name|bRunning
operator|=
name|MNG_FALSE
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bFreezing
condition|)
comment|/* dynamic MNG reached SEEK ? */
name|pData
operator|->
name|bFreezing
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* reset it ! */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_DISPLAY
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_DISPLAY */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
end_ifdef
begin_function
DECL|function|mng_display_resume
name|mng_retcode
name|MNG_DECL
name|mng_display_resume
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
comment|/* local vars */
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_DISPLAY_RESUME
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
operator|!
name|pData
operator|->
name|bDisplaying
condition|)
comment|/* can we expect this call ? */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
name|cleanup_errors
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup previous errors */
comment|/* was it running ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|bRunning
operator|)
operator|||
operator|(
name|pData
operator|->
name|bReading
operator|)
condition|)
block|{
comment|/* are we expecting this call ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|bTimerset
operator|)
operator|||
operator|(
name|pData
operator|->
name|bSuspended
operator|)
operator|||
operator|(
name|pData
operator|->
name|bSectionwait
operator|)
condition|)
block|{
name|pData
operator|->
name|bTimerset
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* reset the flags */
name|pData
operator|->
name|bSectionwait
operator|=
name|MNG_FALSE
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_READ
if|if
condition|(
name|pData
operator|->
name|bReading
condition|)
comment|/* set during read&display ? */
block|{
if|if
condition|(
name|pData
operator|->
name|bSuspended
condition|)
comment|/* calculate proper synchronization */
name|pData
operator|->
name|iSynctime
operator|=
name|pData
operator|->
name|iSynctime
operator|-
name|pData
operator|->
name|iSuspendtime
operator|+
name|pData
operator|->
name|fGettickcount
argument_list|(
name|hHandle
argument_list|)
expr_stmt|;
else|else
name|pData
operator|->
name|iSynctime
operator|=
name|pData
operator|->
name|fGettickcount
argument_list|(
name|hHandle
argument_list|)
expr_stmt|;
name|pData
operator|->
name|bSuspended
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* now reset this flag */
comment|/* and continue reading */
name|iRetcode
operator|=
name|mng_read_graphic
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bEOF
condition|)
comment|/* already at EOF ? */
block|{
name|pData
operator|->
name|bReading
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* then we're no longer reading */
comment|/* drop invalidly stored objects */
name|mng_drop_invalid_objects
argument_list|(
name|pData
argument_list|)
expr_stmt|;
block|}
block|}
else|else
endif|#
directive|endif
comment|/* MNG_SUPPORT_READ */
block|{
comment|/* synchronize timing */
name|pData
operator|->
name|iSynctime
operator|=
name|pData
operator|->
name|fGettickcount
argument_list|(
name|hHandle
argument_list|)
expr_stmt|;
comment|/* resume display processing */
name|iRetcode
operator|=
name|mng_process_display
argument_list|(
name|pData
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
block|}
block|}
else|else
block|{
comment|/* synchronize timing */
name|pData
operator|->
name|iSynctime
operator|=
name|pData
operator|->
name|fGettickcount
argument_list|(
name|hHandle
argument_list|)
expr_stmt|;
name|pData
operator|->
name|bRunning
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* it's restarted again ! */
comment|/* resume display processing */
name|iRetcode
operator|=
name|mng_process_display
argument_list|(
name|pData
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
if|if
condition|(
name|pData
operator|->
name|bSuspended
condition|)
comment|/* read suspension ? */
block|{
name|iRetcode
operator|=
name|MNG_NEEDMOREDATA
expr_stmt|;
name|pData
operator|->
name|iSuspendtime
operator|=
name|pData
operator|->
name|fGettickcount
argument_list|(
operator|(
name|mng_handle
operator|)
name|pData
argument_list|)
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|pData
operator|->
name|bTimerset
condition|)
comment|/* indicate timer break ? */
name|iRetcode
operator|=
name|MNG_NEEDTIMERWAIT
expr_stmt|;
elseif|else
if|if
condition|(
name|pData
operator|->
name|bSectionwait
condition|)
comment|/* indicate section break ? */
name|iRetcode
operator|=
name|MNG_NEEDSECTIONWAIT
expr_stmt|;
else|else
block|{
comment|/* no breaks = end of run */
name|pData
operator|->
name|bRunning
operator|=
name|MNG_FALSE
expr_stmt|;
if|if
condition|(
name|pData
operator|->
name|bFreezing
condition|)
comment|/* trying to freeze ? */
name|pData
operator|->
name|bFreezing
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* then we're there */
if|if
condition|(
name|pData
operator|->
name|bResetting
condition|)
comment|/* trying to reset as well ? */
block|{
comment|/* full stop!!! */
name|pData
operator|->
name|bDisplaying
operator|=
name|MNG_FALSE
expr_stmt|;
name|iRetcode
operator|=
name|mng_reset_rundata
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_DISPLAY_RESUME
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|iRetcode
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_DISPLAY */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
end_ifdef
begin_function
DECL|function|mng_display_freeze
name|mng_retcode
name|MNG_DECL
name|mng_display_freeze
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_DISPLAY_FREEZE
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
comment|/* can we expect this call ? */
if|if
condition|(
operator|(
operator|!
name|pData
operator|->
name|bDisplaying
operator|)
operator|||
operator|(
name|pData
operator|->
name|bReading
operator|)
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
name|cleanup_errors
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup previous errors */
if|if
condition|(
name|pData
operator|->
name|bRunning
condition|)
comment|/* is it running ? */
block|{
name|mng_retcode
name|iRetcode
decl_stmt|;
name|pData
operator|->
name|bFreezing
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* indicate we need to freeze */
comment|/* continue "normal" processing */
name|iRetcode
operator|=
name|mng_display_resume
argument_list|(
name|hHandle
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_DISPLAY_FREEZE
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_DISPLAY */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
end_ifdef
begin_function
DECL|function|mng_display_reset
name|mng_retcode
name|MNG_DECL
name|mng_display_reset
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_DISPLAY_RESET
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
comment|/* can we expect this call ? */
if|if
condition|(
operator|(
operator|!
name|pData
operator|->
name|bDisplaying
operator|)
operator|||
operator|(
name|pData
operator|->
name|bReading
operator|)
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* must store playback info to work!! */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
name|cleanup_errors
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup previous errors */
if|if
condition|(
name|pData
operator|->
name|bRunning
condition|)
comment|/* is it running ? */
block|{
name|pData
operator|->
name|bFreezing
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* indicate we need to freeze */
name|pData
operator|->
name|bResetting
operator|=
name|MNG_TRUE
expr_stmt|;
comment|/* indicate we're about to reset too */
comment|/* continue normal processing ? */
name|iRetcode
operator|=
name|mng_display_resume
argument_list|(
name|hHandle
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
block|}
else|else
block|{
comment|/* full stop!!! */
name|pData
operator|->
name|bDisplaying
operator|=
name|MNG_FALSE
expr_stmt|;
name|iRetcode
operator|=
name|mng_reset_rundata
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_DISPLAY_RESET
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_DISPLAY */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
end_ifdef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DISPLAY_GO_SUPPORTED
end_ifndef
begin_function
DECL|function|mng_display_goframe
name|mng_retcode
name|MNG_DECL
name|mng_display_goframe
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iFramenr
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_DISPLAY_GOFRAME
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
name|pData
operator|->
name|eImagetype
operator|!=
name|mng_it_mng
condition|)
comment|/* is it an animation ? */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_NOTANANIMATION
argument_list|)
expr_stmt|;
comment|/* can we expect this call ? */
if|if
condition|(
operator|(
operator|!
name|pData
operator|->
name|bDisplaying
operator|)
operator|||
operator|(
name|pData
operator|->
name|bRunning
operator|)
condition|)
name|MNG_ERROR
argument_list|(
operator|(
name|mng_datap
operator|)
name|hHandle
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* must store playback info to work!! */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
if|if
condition|(
name|iFramenr
operator|>
name|pData
operator|->
name|iTotalframes
condition|)
comment|/* is the parameter within bounds ? */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FRAMENRTOOHIGH
argument_list|)
expr_stmt|;
comment|/* within MHDR bounds ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iFramecount
operator|)
operator|&&
operator|(
name|iFramenr
operator|>
name|pData
operator|->
name|iFramecount
operator|)
condition|)
name|MNG_WARNING
argument_list|(
name|pData
argument_list|,
name|MNG_FRAMENRTOOHIGH
argument_list|)
expr_stmt|;
name|cleanup_errors
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup previous errors */
if|if
condition|(
name|pData
operator|->
name|iFrameseq
operator|>
name|iFramenr
condition|)
comment|/* search from current or go back to start ? */
block|{
name|iRetcode
operator|=
name|mng_reset_rundata
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
block|}
if|if
condition|(
name|iFramenr
condition|)
block|{
name|pData
operator|->
name|iRequestframe
operator|=
name|iFramenr
expr_stmt|;
comment|/* go find the requested frame then */
name|iRetcode
operator|=
name|mng_process_display
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
name|pData
operator|->
name|bTimerset
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* reset just to be safe */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_DISPLAY_GOFRAME
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_DISPLAY */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
end_ifdef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DISPLAY_GO_SUPPORTED
end_ifndef
begin_function
DECL|function|mng_display_golayer
name|mng_retcode
name|MNG_DECL
name|mng_display_golayer
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iLayernr
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_DISPLAY_GOLAYER
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
name|pData
operator|->
name|eImagetype
operator|!=
name|mng_it_mng
condition|)
comment|/* is it an animation ? */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_NOTANANIMATION
argument_list|)
expr_stmt|;
comment|/* can we expect this call ? */
if|if
condition|(
operator|(
operator|!
name|pData
operator|->
name|bDisplaying
operator|)
operator|||
operator|(
name|pData
operator|->
name|bRunning
operator|)
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* must store playback info to work!! */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
if|if
condition|(
name|iLayernr
operator|>
name|pData
operator|->
name|iTotallayers
condition|)
comment|/* is the parameter within bounds ? */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_LAYERNRTOOHIGH
argument_list|)
expr_stmt|;
comment|/* within MHDR bounds ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iLayercount
operator|)
operator|&&
operator|(
name|iLayernr
operator|>
name|pData
operator|->
name|iLayercount
operator|)
condition|)
name|MNG_WARNING
argument_list|(
name|pData
argument_list|,
name|MNG_LAYERNRTOOHIGH
argument_list|)
expr_stmt|;
name|cleanup_errors
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup previous errors */
if|if
condition|(
name|pData
operator|->
name|iLayerseq
operator|>
name|iLayernr
condition|)
comment|/* search from current or go back to start ? */
block|{
name|iRetcode
operator|=
name|mng_reset_rundata
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
block|}
if|if
condition|(
name|iLayernr
condition|)
block|{
name|pData
operator|->
name|iRequestlayer
operator|=
name|iLayernr
expr_stmt|;
comment|/* go find the requested layer then */
name|iRetcode
operator|=
name|mng_process_display
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
name|pData
operator|->
name|bTimerset
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* reset just to be safe */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_DISPLAY_GOLAYER
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_DISPLAY */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|MNG_SUPPORT_DISPLAY
end_ifdef
begin_ifndef
ifndef|#
directive|ifndef
name|MNG_NO_DISPLAY_GO_SUPPORTED
end_ifndef
begin_function
DECL|function|mng_display_gotime
name|mng_retcode
name|MNG_DECL
name|mng_display_gotime
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint32
name|iPlaytime
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_DISPLAY_GOTIME
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
name|pData
operator|->
name|eImagetype
operator|!=
name|mng_it_mng
condition|)
comment|/* is it an animation ? */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_NOTANANIMATION
argument_list|)
expr_stmt|;
comment|/* can we expect this call ? */
if|if
condition|(
operator|(
operator|!
name|pData
operator|->
name|bDisplaying
operator|)
operator|||
operator|(
name|pData
operator|->
name|bRunning
operator|)
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* must store playback info to work!! */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
comment|/* is the parameter within bounds ? */
if|if
condition|(
name|iPlaytime
operator|>
name|pData
operator|->
name|iTotalplaytime
condition|)
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_PLAYTIMETOOHIGH
argument_list|)
expr_stmt|;
comment|/* within MHDR bounds ? */
if|if
condition|(
operator|(
name|pData
operator|->
name|iPlaytime
operator|)
operator|&&
operator|(
name|iPlaytime
operator|>
name|pData
operator|->
name|iPlaytime
operator|)
condition|)
name|MNG_WARNING
argument_list|(
name|pData
argument_list|,
name|MNG_PLAYTIMETOOHIGH
argument_list|)
expr_stmt|;
name|cleanup_errors
argument_list|(
name|pData
argument_list|)
expr_stmt|;
comment|/* cleanup previous errors */
if|if
condition|(
name|pData
operator|->
name|iFrametime
operator|>
name|iPlaytime
condition|)
comment|/* search from current or go back to start ? */
block|{
name|iRetcode
operator|=
name|mng_reset_rundata
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
block|}
if|if
condition|(
name|iPlaytime
condition|)
block|{
name|pData
operator|->
name|iRequesttime
operator|=
name|iPlaytime
expr_stmt|;
comment|/* go find the requested playtime then */
name|iRetcode
operator|=
name|mng_process_display
argument_list|(
name|pData
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
name|pData
operator|->
name|bTimerset
operator|=
name|MNG_FALSE
expr_stmt|;
comment|/* reset just to be safe */
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_DISPLAY_GOTIME
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* MNG_SUPPORT_DISPLAY */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_if
if|#
directive|if
name|defined
argument_list|(
name|MNG_SUPPORT_DISPLAY
argument_list|)
operator|&&
name|defined
argument_list|(
name|MNG_SUPPORT_DYNAMICMNG
argument_list|)
end_if
begin_function
DECL|function|mng_trapevent
name|mng_retcode
name|MNG_DECL
name|mng_trapevent
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_uint8
name|iEventtype
parameter_list|,
name|mng_int32
name|iX
parameter_list|,
name|mng_int32
name|iY
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
name|mng_eventp
name|pEvent
decl_stmt|;
name|mng_bool
name|bFound
init|=
name|MNG_FALSE
decl_stmt|;
name|mng_retcode
name|iRetcode
decl_stmt|;
name|mng_imagep
name|pImage
decl_stmt|;
name|mng_uint8p
name|pPixel
decl_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_TRAPEVENT
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
if|if
condition|(
name|pData
operator|->
name|eImagetype
operator|!=
name|mng_it_mng
condition|)
comment|/* is it an animation ? */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_NOTANANIMATION
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pData
operator|->
name|bDisplaying
condition|)
comment|/* can we expect this call ? */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|pData
operator|->
name|bCacheplayback
condition|)
comment|/* must store playback info to work!! */
name|MNG_ERROR
argument_list|(
name|pData
argument_list|,
name|MNG_FUNCTIONINVALID
argument_list|)
expr_stmt|;
comment|/* let's find a matching event object */
name|pEvent
operator|=
operator|(
name|mng_eventp
operator|)
name|pData
operator|->
name|pFirstevent
expr_stmt|;
while|while
condition|(
operator|(
name|pEvent
operator|)
operator|&&
operator|(
operator|!
name|bFound
operator|)
condition|)
block|{
comment|/* matching eventtype ? */
if|if
condition|(
name|pEvent
operator|->
name|iEventtype
operator|==
name|iEventtype
condition|)
block|{
switch|switch
condition|(
name|pEvent
operator|->
name|iMasktype
condition|)
comment|/* check X/Y on basis of masktype */
block|{
case|case
name|MNG_MASK_NONE
case|:
comment|/* no mask is easy */
block|{
name|bFound
operator|=
name|MNG_TRUE
expr_stmt|;
break|break;
block|}
case|case
name|MNG_MASK_BOX
case|:
comment|/* inside the given box ? */
block|{
comment|/* right- and bottom-border don't count ! */
if|if
condition|(
operator|(
name|iX
operator|>=
name|pEvent
operator|->
name|iLeft
operator|)
operator|&&
operator|(
name|iX
operator|<
name|pEvent
operator|->
name|iRight
operator|)
operator|&&
operator|(
name|iY
operator|>=
name|pEvent
operator|->
name|iTop
operator|)
operator|&&
operator|(
name|iY
operator|<
name|pEvent
operator|->
name|iBottom
operator|)
condition|)
name|bFound
operator|=
name|MNG_TRUE
expr_stmt|;
break|break;
block|}
case|case
name|MNG_MASK_OBJECT
case|:
comment|/* non-zero pixel in the image object ? */
block|{
name|pImage
operator|=
name|mng_find_imageobject
argument_list|(
name|pData
argument_list|,
name|pEvent
operator|->
name|iObjectid
argument_list|)
expr_stmt|;
comment|/* valid image ? */
if|if
condition|(
operator|(
name|pImage
operator|)
operator|&&
operator|(
name|pImage
operator|->
name|pImgbuf
operator|->
name|iBitdepth
operator|<=
literal|8
operator|)
operator|&&
operator|(
operator|(
name|pImage
operator|->
name|pImgbuf
operator|->
name|iColortype
operator|==
literal|0
operator|)
operator|||
operator|(
name|pImage
operator|->
name|pImgbuf
operator|->
name|iColortype
operator|==
literal|3
operator|)
operator|)
operator|&&
operator|(
operator|(
name|mng_int32
operator|)
name|pImage
operator|->
name|pImgbuf
operator|->
name|iWidth
operator|>
name|iX
operator|)
operator|&&
operator|(
operator|(
name|mng_int32
operator|)
name|pImage
operator|->
name|pImgbuf
operator|->
name|iHeight
operator|>
name|iY
operator|)
condition|)
block|{
name|pPixel
operator|=
name|pImage
operator|->
name|pImgbuf
operator|->
name|pImgdata
operator|+
operator|(
operator|(
name|pImage
operator|->
name|pImgbuf
operator|->
name|iWidth
operator|*
name|iY
operator|)
operator|+
name|iX
operator|)
expr_stmt|;
if|if
condition|(
operator|*
name|pPixel
condition|)
comment|/* non-zero ? */
name|bFound
operator|=
name|MNG_TRUE
expr_stmt|;
block|}
break|break;
block|}
case|case
name|MNG_MASK_OBJECTIX
case|:
comment|/* pixel in the image object matches index ? */
block|{
name|pImage
operator|=
name|mng_find_imageobject
argument_list|(
name|pData
argument_list|,
name|pEvent
operator|->
name|iObjectid
argument_list|)
expr_stmt|;
comment|/* valid image ? */
if|if
condition|(
operator|(
name|pImage
operator|)
operator|&&
operator|(
name|pImage
operator|->
name|pImgbuf
operator|->
name|iBitdepth
operator|<=
literal|8
operator|)
operator|&&
operator|(
operator|(
name|pImage
operator|->
name|pImgbuf
operator|->
name|iColortype
operator|==
literal|0
operator|)
operator|||
operator|(
name|pImage
operator|->
name|pImgbuf
operator|->
name|iColortype
operator|==
literal|3
operator|)
operator|)
operator|&&
operator|(
operator|(
name|mng_int32
operator|)
name|pImage
operator|->
name|pImgbuf
operator|->
name|iWidth
operator|>
name|iX
operator|)
operator|&&
operator|(
name|iX
operator|>=
literal|0
operator|)
operator|&&
operator|(
operator|(
name|mng_int32
operator|)
name|pImage
operator|->
name|pImgbuf
operator|->
name|iHeight
operator|>
name|iY
operator|)
operator|&&
operator|(
name|iY
operator|>=
literal|0
operator|)
condition|)
block|{
name|pPixel
operator|=
name|pImage
operator|->
name|pImgbuf
operator|->
name|pImgdata
operator|+
operator|(
operator|(
name|pImage
operator|->
name|pImgbuf
operator|->
name|iWidth
operator|*
name|iY
operator|)
operator|+
name|iX
operator|)
expr_stmt|;
comment|/* matching index ? */
if|if
condition|(
operator|*
name|pPixel
operator|==
name|pEvent
operator|->
name|iIndex
condition|)
name|bFound
operator|=
name|MNG_TRUE
expr_stmt|;
block|}
break|break;
block|}
case|case
name|MNG_MASK_BOXOBJECT
case|:
comment|/* non-zero pixel in the image object ? */
block|{
name|mng_int32
name|iTempx
init|=
name|iX
operator|-
name|pEvent
operator|->
name|iLeft
decl_stmt|;
name|mng_int32
name|iTempy
init|=
name|iY
operator|-
name|pEvent
operator|->
name|iTop
decl_stmt|;
name|pImage
operator|=
name|mng_find_imageobject
argument_list|(
name|pData
argument_list|,
name|pEvent
operator|->
name|iObjectid
argument_list|)
expr_stmt|;
comment|/* valid image ? */
if|if
condition|(
operator|(
name|pImage
operator|)
operator|&&
operator|(
name|pImage
operator|->
name|pImgbuf
operator|->
name|iBitdepth
operator|<=
literal|8
operator|)
operator|&&
operator|(
operator|(
name|pImage
operator|->
name|pImgbuf
operator|->
name|iColortype
operator|==
literal|0
operator|)
operator|||
operator|(
name|pImage
operator|->
name|pImgbuf
operator|->
name|iColortype
operator|==
literal|3
operator|)
operator|)
operator|&&
operator|(
name|iTempx
operator|<
operator|(
name|mng_int32
operator|)
name|pImage
operator|->
name|pImgbuf
operator|->
name|iWidth
operator|)
operator|&&
operator|(
name|iTempx
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|iX
operator|<
name|pEvent
operator|->
name|iRight
operator|)
operator|&&
operator|(
name|iTempy
operator|<
operator|(
name|mng_int32
operator|)
name|pImage
operator|->
name|pImgbuf
operator|->
name|iHeight
operator|)
operator|&&
operator|(
name|iTempy
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|iY
operator|<
name|pEvent
operator|->
name|iBottom
operator|)
condition|)
block|{
name|pPixel
operator|=
name|pImage
operator|->
name|pImgbuf
operator|->
name|pImgdata
operator|+
operator|(
operator|(
name|pImage
operator|->
name|pImgbuf
operator|->
name|iWidth
operator|*
name|iTempy
operator|)
operator|+
name|iTempx
operator|)
expr_stmt|;
if|if
condition|(
operator|*
name|pPixel
condition|)
comment|/* non-zero ? */
name|bFound
operator|=
name|MNG_TRUE
expr_stmt|;
block|}
break|break;
block|}
case|case
name|MNG_MASK_BOXOBJECTIX
case|:
comment|/* pixel in the image object matches index ? */
block|{
name|mng_int32
name|iTempx
init|=
name|iX
operator|-
name|pEvent
operator|->
name|iLeft
decl_stmt|;
name|mng_int32
name|iTempy
init|=
name|iY
operator|-
name|pEvent
operator|->
name|iTop
decl_stmt|;
name|pImage
operator|=
name|mng_find_imageobject
argument_list|(
name|pData
argument_list|,
name|pEvent
operator|->
name|iObjectid
argument_list|)
expr_stmt|;
comment|/* valid image ? */
if|if
condition|(
operator|(
name|pImage
operator|)
operator|&&
operator|(
name|pImage
operator|->
name|pImgbuf
operator|->
name|iBitdepth
operator|<=
literal|8
operator|)
operator|&&
operator|(
operator|(
name|pImage
operator|->
name|pImgbuf
operator|->
name|iColortype
operator|==
literal|0
operator|)
operator|||
operator|(
name|pImage
operator|->
name|pImgbuf
operator|->
name|iColortype
operator|==
literal|3
operator|)
operator|)
operator|&&
operator|(
name|iTempx
operator|<
operator|(
name|mng_int32
operator|)
name|pImage
operator|->
name|pImgbuf
operator|->
name|iWidth
operator|)
operator|&&
operator|(
name|iTempx
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|iX
operator|<
name|pEvent
operator|->
name|iRight
operator|)
operator|&&
operator|(
name|iTempy
operator|<
operator|(
name|mng_int32
operator|)
name|pImage
operator|->
name|pImgbuf
operator|->
name|iHeight
operator|)
operator|&&
operator|(
name|iTempy
operator|>=
literal|0
operator|)
operator|&&
operator|(
name|iY
operator|<
name|pEvent
operator|->
name|iBottom
operator|)
condition|)
block|{
name|pPixel
operator|=
name|pImage
operator|->
name|pImgbuf
operator|->
name|pImgdata
operator|+
operator|(
operator|(
name|pImage
operator|->
name|pImgbuf
operator|->
name|iWidth
operator|*
name|iTempy
operator|)
operator|+
name|iTempx
operator|)
expr_stmt|;
comment|/* matching index ? */
if|if
condition|(
operator|*
name|pPixel
operator|==
name|pEvent
operator|->
name|iIndex
condition|)
name|bFound
operator|=
name|MNG_TRUE
expr_stmt|;
block|}
break|break;
block|}
block|}
block|}
if|if
condition|(
operator|!
name|bFound
condition|)
comment|/* try the next one */
name|pEvent
operator|=
operator|(
name|mng_eventp
operator|)
name|pEvent
operator|->
name|sHeader
operator|.
name|pNext
expr_stmt|;
block|}
comment|/* found one that's not the last mousemove ? */
if|if
condition|(
operator|(
name|pEvent
operator|)
operator|&&
operator|(
operator|(
name|mng_objectp
operator|)
name|pEvent
operator|!=
name|pData
operator|->
name|pLastmousemove
operator|)
condition|)
block|{
comment|/* can we start an event process now ? */
if|if
condition|(
operator|(
operator|!
name|pData
operator|->
name|bReading
operator|)
operator|&&
operator|(
operator|!
name|pData
operator|->
name|bRunning
operator|)
condition|)
block|{
name|pData
operator|->
name|iEventx
operator|=
name|iX
expr_stmt|;
comment|/* save coordinates */
name|pData
operator|->
name|iEventy
operator|=
name|iY
expr_stmt|;
comment|/* do it then ! */
name|iRetcode
operator|=
name|pEvent
operator|->
name|sHeader
operator|.
name|fProcess
argument_list|(
name|pData
argument_list|,
name|pEvent
argument_list|)
expr_stmt|;
if|if
condition|(
name|iRetcode
condition|)
comment|/* on error bail out */
return|return
name|iRetcode
return|;
comment|/* remember last mousemove event */
if|if
condition|(
name|pEvent
operator|->
name|iEventtype
operator|==
name|MNG_EVENT_MOUSEMOVE
condition|)
name|pData
operator|->
name|pLastmousemove
operator|=
operator|(
name|mng_objectp
operator|)
name|pEvent
expr_stmt|;
else|else
name|pData
operator|->
name|pLastmousemove
operator|=
name|MNG_NULL
expr_stmt|;
block|}
else|else
block|{
comment|/* TODO: store unprocessed events or not ??? */
block|}
block|}
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_TRAPEVENT
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|MNG_NOERROR
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_function
DECL|function|mng_getlasterror
name|mng_retcode
name|MNG_DECL
name|mng_getlasterror
parameter_list|(
name|mng_handle
name|hHandle
parameter_list|,
name|mng_int8
modifier|*
name|iSeverity
parameter_list|,
name|mng_chunkid
modifier|*
name|iChunkname
parameter_list|,
name|mng_uint32
modifier|*
name|iChunkseq
parameter_list|,
name|mng_int32
modifier|*
name|iExtra1
parameter_list|,
name|mng_int32
modifier|*
name|iExtra2
parameter_list|,
name|mng_pchar
modifier|*
name|zErrortext
parameter_list|)
block|{
name|mng_datap
name|pData
decl_stmt|;
comment|/* local vars */
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETLASTERROR
argument_list|,
name|MNG_LC_START
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|MNG_VALIDHANDLE
argument_list|(
argument|hHandle
argument_list|)
comment|/* check validity handle */
name|pData
operator|=
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
expr_stmt|;
comment|/* and make it addressable */
operator|*
name|iSeverity
operator|=
name|pData
operator|->
name|iSeverity
expr_stmt|;
comment|/* return the appropriate fields */
if|#
directive|if
name|defined
argument_list|(
name|MNG_SUPPORT_READ
argument_list|)
operator|||
name|defined
argument_list|(
name|MNG_SUPPORT_WRITE
argument_list|)
operator|*
name|iChunkname
operator|=
name|pData
operator|->
name|iChunkname
expr_stmt|;
operator|*
name|iChunkseq
operator|=
name|pData
operator|->
name|iChunkseq
expr_stmt|;
else|#
directive|else
operator|*
name|iChunkname
operator|=
name|MNG_UINT_HUH
expr_stmt|;
operator|*
name|iChunkseq
operator|=
literal|0
expr_stmt|;
endif|#
directive|endif
operator|*
name|iExtra1
operator|=
name|pData
operator|->
name|iErrorx1
expr_stmt|;
operator|*
name|iExtra2
operator|=
name|pData
operator|->
name|iErrorx2
expr_stmt|;
operator|*
name|zErrortext
operator|=
name|pData
operator|->
name|zErrortext
expr_stmt|;
ifdef|#
directive|ifdef
name|MNG_SUPPORT_TRACE
name|MNG_TRACE
argument_list|(
operator|(
operator|(
name|mng_datap
operator|)
name|hHandle
operator|)
argument_list|,
name|MNG_FN_GETLASTERROR
argument_list|,
name|MNG_LC_END
argument_list|)
expr_stmt|;
endif|#
directive|endif
return|return
name|pData
operator|->
name|iErrorcode
return|;
comment|/* and the errorcode */
block|}
end_function
begin_comment
comment|/* ************************************************************************** */
end_comment
begin_comment
comment|/* * end of file                                                            * */
end_comment
begin_comment
comment|/* ************************************************************************** */
end_comment
end_unit
