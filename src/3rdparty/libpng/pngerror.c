begin_unit
begin_comment
comment|/* pngerror.c - stub functions for i/o and memory allocation  *  * Last changed in libpng 1.5.1 [February 3, 2011]  * Copyright (c) 1998-2011 Glenn Randers-Pehrson  * (Version 0.96 Copyright (c) 1996, 1997 Andreas Dilger)  * (Version 0.88 Copyright (c) 1995, 1996 Guy Eric Schalnat, Group 42, Inc.)  *  * This code is released under the libpng license.  * For conditions of distribution and use, see the disclaimer  * and license in png.h  *  * This file provides a location for all error handling.  Users who  * need special error handling are expected to write replacement functions  * and use png_set_error_fn() to use those functions.  See the instructions  * at each function.  */
end_comment
begin_include
include|#
directive|include
file|"pngpriv.h"
end_include
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_SUPPORTED
argument_list|)
operator|||
name|defined
argument_list|(
name|PNG_WRITE_SUPPORTED
argument_list|)
end_if
begin_expr_stmt
specifier|static
name|PNG_FUNCTION
argument_list|(
name|void
argument_list|,
name|png_default_error
argument_list|,
name|PNGARG
argument_list|(
operator|(
name|png_structp
name|png_ptr
operator|,
name|png_const_charp
name|error_message
operator|)
argument_list|)
argument_list|,
name|PNG_NORETURN
argument_list|)
expr_stmt|;
end_expr_stmt
begin_ifdef
ifdef|#
directive|ifdef
name|PNG_WARNINGS_SUPPORTED
end_ifdef
begin_decl_stmt
specifier|static
name|void
comment|/* PRIVATE */
name|png_default_warning
name|PNGARG
argument_list|(
operator|(
name|png_structp
name|png_ptr
operator|,
name|png_const_charp
name|warning_message
operator|)
argument_list|)
decl_stmt|;
end_decl_stmt
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* PNG_WARNINGS_SUPPORTED */
end_comment
begin_comment
comment|/* This function is called whenever there is a fatal error.  This function  * should not be changed.  If there is a need to handle errors differently,  * you should supply a replacement error function and use png_set_error_fn()  * to replace the error function at run-time.  */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|PNG_ERROR_TEXT_SUPPORTED
end_ifdef
begin_macro
DECL|function|PNG_FUNCTION
name|PNG_FUNCTION
argument_list|(
argument|void
argument_list|,
argument|PNGAPI png_error
argument_list|,
argument|(png_structp png_ptr, png_const_charp error_message)
argument_list|,
argument|PNG_NORETURN
argument_list|)
end_macro
begin_block
block|{
ifdef|#
directive|ifdef
name|PNG_ERROR_NUMBERS_SUPPORTED
name|char
name|msg
index|[
literal|16
index|]
decl_stmt|;
if|if
condition|(
name|png_ptr
operator|!=
name|NULL
condition|)
block|{
if|if
condition|(
name|png_ptr
operator|->
name|flags
operator|&
operator|(
name|PNG_FLAG_STRIP_ERROR_NUMBERS
operator||
name|PNG_FLAG_STRIP_ERROR_TEXT
operator|)
condition|)
block|{
if|if
condition|(
operator|*
name|error_message
operator|==
name|PNG_LITERAL_SHARP
condition|)
block|{
comment|/* Strip "#nnnn " from beginning of error message. */
name|int
name|offset
decl_stmt|;
for|for
control|(
name|offset
operator|=
literal|1
init|;
name|offset
operator|<
literal|15
condition|;
name|offset
operator|++
control|)
if|if
condition|(
name|error_message
index|[
name|offset
index|]
operator|==
literal|' '
condition|)
break|break;
if|if
condition|(
name|png_ptr
operator|->
name|flags
operator|&
name|PNG_FLAG_STRIP_ERROR_TEXT
condition|)
block|{
name|int
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|offset
operator|-
literal|1
condition|;
name|i
operator|++
control|)
name|msg
index|[
name|i
index|]
operator|=
name|error_message
index|[
name|i
operator|+
literal|1
index|]
expr_stmt|;
name|msg
index|[
name|i
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|error_message
operator|=
name|msg
expr_stmt|;
block|}
else|else
name|error_message
operator|+=
name|offset
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|png_ptr
operator|->
name|flags
operator|&
name|PNG_FLAG_STRIP_ERROR_TEXT
condition|)
block|{
name|msg
index|[
literal|0
index|]
operator|=
literal|'0'
expr_stmt|;
name|msg
index|[
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|error_message
operator|=
name|msg
expr_stmt|;
block|}
block|}
block|}
block|}
endif|#
directive|endif
if|if
condition|(
name|png_ptr
operator|!=
name|NULL
operator|&&
name|png_ptr
operator|->
name|error_fn
operator|!=
name|NULL
condition|)
operator|(
operator|*
operator|(
name|png_ptr
operator|->
name|error_fn
operator|)
operator|)
operator|(
name|png_ptr
operator|,
name|error_message
operator|)
expr_stmt|;
comment|/* If the custom handler doesn't exist, or if it returns,       use the default handler, which will not return. */
name|png_default_error
argument_list|(
name|png_ptr
argument_list|,
name|error_message
argument_list|)
expr_stmt|;
block|}
end_block
begin_else
else|#
directive|else
end_else
begin_macro
DECL|function|PNG_FUNCTION
name|PNG_FUNCTION
argument_list|(
argument|void
argument_list|,
argument|PNGAPI png_err
argument_list|,
argument|(png_structp png_ptr)
argument_list|,
argument|PNG_NORETURN
argument_list|)
end_macro
begin_block
block|{
if|if
condition|(
name|png_ptr
operator|!=
name|NULL
operator|&&
name|png_ptr
operator|->
name|error_fn
operator|!=
name|NULL
condition|)
operator|(
operator|*
operator|(
name|png_ptr
operator|->
name|error_fn
operator|)
operator|)
operator|(
name|png_ptr
operator|,
literal|'\0'
operator|)
expr_stmt|;
comment|/* If the custom handler doesn't exist, or if it returns,       use the default handler, which will not return. */
name|png_default_error
argument_list|(
name|png_ptr
argument_list|,
literal|'\0'
argument_list|)
expr_stmt|;
block|}
end_block
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* PNG_ERROR_TEXT_SUPPORTED */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|PNG_WARNINGS_SUPPORTED
end_ifdef
begin_comment
comment|/* This function is called whenever there is a non-fatal error.  This function  * should not be changed.  If there is a need to handle warnings differently,  * you should supply a replacement warning function and use  * png_set_error_fn() to replace the warning function at run-time.  */
end_comment
begin_function
name|void
name|PNGAPI
DECL|function|png_warning
name|png_warning
parameter_list|(
name|png_structp
name|png_ptr
parameter_list|,
name|png_const_charp
name|warning_message
parameter_list|)
block|{
name|int
name|offset
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|png_ptr
operator|!=
name|NULL
condition|)
block|{
ifdef|#
directive|ifdef
name|PNG_ERROR_NUMBERS_SUPPORTED
if|if
condition|(
name|png_ptr
operator|->
name|flags
operator|&
operator|(
name|PNG_FLAG_STRIP_ERROR_NUMBERS
operator||
name|PNG_FLAG_STRIP_ERROR_TEXT
operator|)
condition|)
endif|#
directive|endif
block|{
if|if
condition|(
operator|*
name|warning_message
operator|==
name|PNG_LITERAL_SHARP
condition|)
block|{
for|for
control|(
name|offset
operator|=
literal|1
init|;
name|offset
operator|<
literal|15
condition|;
name|offset
operator|++
control|)
if|if
condition|(
name|warning_message
index|[
name|offset
index|]
operator|==
literal|' '
condition|)
break|break;
block|}
block|}
block|}
if|if
condition|(
name|png_ptr
operator|!=
name|NULL
operator|&&
name|png_ptr
operator|->
name|warning_fn
operator|!=
name|NULL
condition|)
operator|(
operator|*
operator|(
name|png_ptr
operator|->
name|warning_fn
operator|)
operator|)
operator|(
name|png_ptr
operator|,
name|warning_message
operator|+
name|offset
operator|)
expr_stmt|;
else|else
name|png_default_warning
argument_list|(
name|png_ptr
argument_list|,
name|warning_message
operator|+
name|offset
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* PNG_WARNINGS_SUPPORTED */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|PNG_BENIGN_ERRORS_SUPPORTED
end_ifdef
begin_function
name|void
name|PNGAPI
DECL|function|png_benign_error
name|png_benign_error
parameter_list|(
name|png_structp
name|png_ptr
parameter_list|,
name|png_const_charp
name|error_message
parameter_list|)
block|{
if|if
condition|(
name|png_ptr
operator|->
name|flags
operator|&
name|PNG_FLAG_BENIGN_ERRORS_WARN
condition|)
name|png_warning
argument_list|(
name|png_ptr
argument_list|,
name|error_message
argument_list|)
expr_stmt|;
else|else
name|png_error
argument_list|(
name|png_ptr
argument_list|,
name|error_message
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* These utilities are used internally to build an error message that relates  * to the current chunk.  The chunk name comes from png_ptr->chunk_name,  * this is used to prefix the message.  The message is limited in length  * to 63 bytes, the name characters are output as hex digits wrapped in []  * if the character is invalid.  */
end_comment
begin_define
DECL|macro|isnonalpha
define|#
directive|define
name|isnonalpha
parameter_list|(
name|c
parameter_list|)
value|((c)< 65 || (c)> 122 || ((c)> 90&& (c)< 97))
end_define
begin_decl_stmt
DECL|variable|png_digit
specifier|static
name|PNG_CONST
name|char
name|png_digit
index|[
literal|16
index|]
init|=
block|{
literal|'0'
block|,
literal|'1'
block|,
literal|'2'
block|,
literal|'3'
block|,
literal|'4'
block|,
literal|'5'
block|,
literal|'6'
block|,
literal|'7'
block|,
literal|'8'
block|,
literal|'9'
block|,
literal|'A'
block|,
literal|'B'
block|,
literal|'C'
block|,
literal|'D'
block|,
literal|'E'
block|,
literal|'F'
block|}
decl_stmt|;
end_decl_stmt
begin_define
DECL|macro|PNG_MAX_ERROR_TEXT
define|#
directive|define
name|PNG_MAX_ERROR_TEXT
value|64
end_define
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_WARNINGS_SUPPORTED
argument_list|)
operator|||
name|defined
argument_list|(
name|PNG_ERROR_TEXT_SUPPORTED
argument_list|)
end_if
begin_function
specifier|static
name|void
comment|/* PRIVATE */
DECL|function|png_format_buffer
name|png_format_buffer
parameter_list|(
name|png_structp
name|png_ptr
parameter_list|,
name|png_charp
name|buffer
parameter_list|,
name|png_const_charp
name|error_message
parameter_list|)
block|{
name|int
name|iout
init|=
literal|0
decl_stmt|,
name|iin
init|=
literal|0
decl_stmt|;
while|while
condition|(
name|iin
operator|<
literal|4
condition|)
block|{
name|int
name|c
init|=
name|png_ptr
operator|->
name|chunk_name
index|[
name|iin
operator|++
index|]
decl_stmt|;
if|if
condition|(
name|isnonalpha
argument_list|(
name|c
argument_list|)
condition|)
block|{
name|buffer
index|[
name|iout
operator|++
index|]
operator|=
name|PNG_LITERAL_LEFT_SQUARE_BRACKET
expr_stmt|;
name|buffer
index|[
name|iout
operator|++
index|]
operator|=
name|png_digit
index|[
operator|(
name|c
operator|&
literal|0xf0
operator|)
operator|>>
literal|4
index|]
expr_stmt|;
name|buffer
index|[
name|iout
operator|++
index|]
operator|=
name|png_digit
index|[
name|c
operator|&
literal|0x0f
index|]
expr_stmt|;
name|buffer
index|[
name|iout
operator|++
index|]
operator|=
name|PNG_LITERAL_RIGHT_SQUARE_BRACKET
expr_stmt|;
block|}
else|else
block|{
name|buffer
index|[
name|iout
operator|++
index|]
operator|=
operator|(
name|png_byte
operator|)
name|c
expr_stmt|;
block|}
block|}
if|if
condition|(
name|error_message
operator|==
name|NULL
condition|)
name|buffer
index|[
name|iout
index|]
operator|=
literal|'\0'
expr_stmt|;
else|else
block|{
name|buffer
index|[
name|iout
operator|++
index|]
operator|=
literal|':'
expr_stmt|;
name|buffer
index|[
name|iout
operator|++
index|]
operator|=
literal|' '
expr_stmt|;
name|png_memcpy
argument_list|(
name|buffer
operator|+
name|iout
argument_list|,
name|error_message
argument_list|,
name|PNG_MAX_ERROR_TEXT
argument_list|)
expr_stmt|;
name|buffer
index|[
name|iout
operator|+
name|PNG_MAX_ERROR_TEXT
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
block|}
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* PNG_WARNINGS_SUPPORTED || PNG_ERROR_TEXT_SUPPORTED */
end_comment
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_SUPPORTED
argument_list|)
operator|&&
name|defined
argument_list|(
name|PNG_ERROR_TEXT_SUPPORTED
argument_list|)
end_if
begin_macro
DECL|function|PNG_FUNCTION
name|PNG_FUNCTION
argument_list|(
argument|void
argument_list|,
argument|PNGAPI png_chunk_error
argument_list|,
argument|(png_structp png_ptr, png_const_charp error_message)
argument_list|,
argument|PNG_NORETURN
argument_list|)
end_macro
begin_block
block|{
name|char
name|msg
index|[
literal|18
operator|+
name|PNG_MAX_ERROR_TEXT
index|]
decl_stmt|;
if|if
condition|(
name|png_ptr
operator|==
name|NULL
condition|)
name|png_error
argument_list|(
name|png_ptr
argument_list|,
name|error_message
argument_list|)
expr_stmt|;
else|else
block|{
name|png_format_buffer
argument_list|(
name|png_ptr
argument_list|,
name|msg
argument_list|,
name|error_message
argument_list|)
expr_stmt|;
name|png_error
argument_list|(
name|png_ptr
argument_list|,
name|msg
argument_list|)
expr_stmt|;
block|}
block|}
end_block
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* PNG_READ_SUPPORTED&& PNG_ERROR_TEXT_SUPPORTED */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|PNG_WARNINGS_SUPPORTED
end_ifdef
begin_function
name|void
name|PNGAPI
DECL|function|png_chunk_warning
name|png_chunk_warning
parameter_list|(
name|png_structp
name|png_ptr
parameter_list|,
name|png_const_charp
name|warning_message
parameter_list|)
block|{
name|char
name|msg
index|[
literal|18
operator|+
name|PNG_MAX_ERROR_TEXT
index|]
decl_stmt|;
if|if
condition|(
name|png_ptr
operator|==
name|NULL
condition|)
name|png_warning
argument_list|(
name|png_ptr
argument_list|,
name|warning_message
argument_list|)
expr_stmt|;
else|else
block|{
name|png_format_buffer
argument_list|(
name|png_ptr
argument_list|,
name|msg
argument_list|,
name|warning_message
argument_list|)
expr_stmt|;
name|png_warning
argument_list|(
name|png_ptr
argument_list|,
name|msg
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* PNG_WARNINGS_SUPPORTED */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|PNG_READ_SUPPORTED
end_ifdef
begin_ifdef
ifdef|#
directive|ifdef
name|PNG_BENIGN_ERRORS_SUPPORTED
end_ifdef
begin_function
name|void
name|PNGAPI
DECL|function|png_chunk_benign_error
name|png_chunk_benign_error
parameter_list|(
name|png_structp
name|png_ptr
parameter_list|,
name|png_const_charp
name|error_message
parameter_list|)
block|{
if|if
condition|(
name|png_ptr
operator|->
name|flags
operator|&
name|PNG_FLAG_BENIGN_ERRORS_WARN
condition|)
name|png_chunk_warning
argument_list|(
name|png_ptr
argument_list|,
name|error_message
argument_list|)
expr_stmt|;
else|else
name|png_chunk_error
argument_list|(
name|png_ptr
argument_list|,
name|error_message
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* PNG_READ_SUPPORTED */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|PNG_ERROR_TEXT_SUPPORTED
end_ifdef
begin_ifdef
ifdef|#
directive|ifdef
name|PNG_FLOATING_POINT_SUPPORTED
end_ifdef
begin_macro
DECL|function|PNG_FUNCTION
name|PNG_FUNCTION
argument_list|(
argument|void
argument_list|,
argument|png_fixed_error
argument_list|,
argument|(png_structp png_ptr, png_const_charp name)
argument_list|,
argument|PNG_NORETURN
argument_list|)
end_macro
begin_block
block|{
DECL|macro|fixed_message
define|#
directive|define
name|fixed_message
value|"fixed point overflow in "
DECL|macro|fixed_message_ln
define|#
directive|define
name|fixed_message_ln
value|((sizeof fixed_message)-1)
name|int
name|iin
decl_stmt|;
name|char
name|msg
index|[
name|fixed_message_ln
operator|+
name|PNG_MAX_ERROR_TEXT
index|]
decl_stmt|;
name|png_memcpy
argument_list|(
name|msg
argument_list|,
name|fixed_message
argument_list|,
name|fixed_message_ln
argument_list|)
expr_stmt|;
name|iin
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|name
operator|!=
name|NULL
condition|)
while|while
condition|(
name|iin
operator|<
operator|(
name|PNG_MAX_ERROR_TEXT
operator|-
literal|1
operator|)
operator|&&
name|name
index|[
name|iin
index|]
operator|!=
literal|0
condition|)
block|{
name|msg
index|[
name|fixed_message_ln
operator|+
name|iin
index|]
operator|=
name|name
index|[
name|iin
index|]
expr_stmt|;
operator|++
name|iin
expr_stmt|;
block|}
name|msg
index|[
name|fixed_message_ln
operator|+
name|iin
index|]
operator|=
literal|0
expr_stmt|;
name|png_error
argument_list|(
name|png_ptr
argument_list|,
name|msg
argument_list|)
expr_stmt|;
block|}
end_block
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_ifdef
ifdef|#
directive|ifdef
name|PNG_SETJMP_SUPPORTED
end_ifdef
begin_comment
comment|/* This API only exists if ANSI-C style error handling is used,  * otherwise it is necessary for png_default_error to be overridden.  */
end_comment
begin_function
name|jmp_buf
modifier|*
name|PNGAPI
DECL|function|png_set_longjmp_fn
name|png_set_longjmp_fn
parameter_list|(
name|png_structp
name|png_ptr
parameter_list|,
name|png_longjmp_ptr
name|longjmp_fn
parameter_list|,
name|size_t
name|jmp_buf_size
parameter_list|)
block|{
if|if
condition|(
name|png_ptr
operator|==
name|NULL
operator|||
name|jmp_buf_size
operator|!=
name|png_sizeof
argument_list|(
name|jmp_buf
argument_list|)
condition|)
return|return
name|NULL
return|;
name|png_ptr
operator|->
name|longjmp_fn
operator|=
name|longjmp_fn
expr_stmt|;
return|return
operator|&
name|png_ptr
operator|->
name|png_jmpbuf
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* This is the default error handling function.  Note that replacements for  * this function MUST NOT RETURN, or the program will likely crash.  This  * function is used by default, or if the program supplies NULL for the  * error function pointer in png_set_error_fn().  */
end_comment
begin_expr_stmt
DECL|function|PNG_FUNCTION
specifier|static
name|PNG_FUNCTION
argument_list|(
argument|void
comment|/* PRIVATE */
argument_list|,
argument|png_default_error
argument_list|,
argument|(png_structp png_ptr, png_const_charp error_message)
argument_list|,
argument|PNG_NORETURN
argument_list|)
block|{
ifdef|#
directive|ifdef
name|PNG_CONSOLE_IO_SUPPORTED
ifdef|#
directive|ifdef
name|PNG_ERROR_NUMBERS_SUPPORTED
if|if
condition|(
operator|*
name|error_message
operator|==
name|PNG_LITERAL_SHARP
condition|)
block|{
comment|/* Strip "#nnnn " from beginning of error message. */
name|int
name|offset
decl_stmt|;
name|char
name|error_number
index|[
literal|16
index|]
decl_stmt|;
for|for
control|(
name|offset
operator|=
literal|0
init|;
name|offset
operator|<
literal|15
condition|;
name|offset
operator|++
control|)
block|{
name|error_number
index|[
name|offset
index|]
operator|=
name|error_message
index|[
name|offset
operator|+
literal|1
index|]
expr_stmt|;
if|if
condition|(
name|error_message
index|[
name|offset
index|]
operator|==
literal|' '
condition|)
break|break;
block|}
end_expr_stmt
begin_if
if|if
condition|(
operator|(
name|offset
operator|>
literal|1
operator|)
operator|&&
operator|(
name|offset
operator|<
literal|15
operator|)
condition|)
block|{
name|error_number
index|[
name|offset
operator|-
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"libpng error no. %s: %s"
argument_list|,
name|error_number
argument_list|,
name|error_message
operator|+
name|offset
operator|+
literal|1
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|PNG_STRING_NEWLINE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"libpng error: %s, offset=%d"
argument_list|,
name|error_message
argument_list|,
name|offset
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|PNG_STRING_NEWLINE
argument_list|)
expr_stmt|;
block|}
end_if
begin_endif
unit|}    else
endif|#
directive|endif
end_endif
begin_block
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"libpng error: %s"
argument_list|,
name|error_message
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|PNG_STRING_NEWLINE
argument_list|)
expr_stmt|;
block|}
end_block
begin_endif
endif|#
directive|endif
end_endif
begin_ifndef
ifndef|#
directive|ifndef
name|PNG_CONSOLE_IO_SUPPORTED
end_ifndef
begin_macro
name|PNG_UNUSED
argument_list|(
argument|error_message
argument_list|)
end_macro
begin_comment
comment|/* Make compiler happy */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_expr_stmt
name|png_longjmp
argument_list|(
name|png_ptr
argument_list|,
literal|1
argument_list|)
expr_stmt|;
end_expr_stmt
begin_expr_stmt
unit|}  PNG_FUNCTION
DECL|function|PNG_FUNCTION
operator|(
name|void
operator|,
name|PNGAPI
name|png_longjmp
operator|,
operator|(
name|png_structp
name|png_ptr
operator|,
name|int
name|val
operator|)
operator|,
name|PNG_NORETURN
operator|)
block|{
ifdef|#
directive|ifdef
name|PNG_SETJMP_SUPPORTED
if|if
condition|(
name|png_ptr
operator|&&
name|png_ptr
operator|->
name|longjmp_fn
condition|)
block|{
ifdef|#
directive|ifdef
name|USE_FAR_KEYWORD
block|{
name|jmp_buf
name|png_jmpbuf
decl_stmt|;
name|png_memcpy
argument_list|(
name|png_jmpbuf
argument_list|,
name|png_ptr
operator|->
name|png_jmpbuf
argument_list|,
name|png_sizeof
argument_list|(
name|jmp_buf
argument_list|)
argument_list|)
expr_stmt|;
name|png_ptr
operator|->
name|longjmp_fn
argument_list|(
name|png_jmpbuf
argument_list|,
name|val
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|png_ptr
operator|->
name|longjmp_fn
argument_list|(
name|png_ptr
operator|->
name|png_jmpbuf
argument_list|,
name|val
argument_list|)
expr_stmt|;
end_expr_stmt
begin_endif
endif|#
directive|endif
end_endif
begin_endif
unit|}
endif|#
directive|endif
end_endif
begin_comment
comment|/* Here if not setjmp support or if png_ptr is null. */
end_comment
begin_expr_stmt
unit|PNG_ABORT
operator|(
operator|)
expr_stmt|;
end_expr_stmt
begin_ifdef
unit|}
ifdef|#
directive|ifdef
name|PNG_WARNINGS_SUPPORTED
end_ifdef
begin_comment
comment|/* This function is called when there is a warning, but the library thinks  * it can continue anyway.  Replacement functions don't have to do anything  * here if you don't want them to.  In the default configuration, png_ptr is  * not used, but it is passed in case it may be useful.  */
end_comment
begin_function
unit|static
name|void
comment|/* PRIVATE */
DECL|function|png_default_warning
name|png_default_warning
parameter_list|(
name|png_structp
name|png_ptr
parameter_list|,
name|png_const_charp
name|warning_message
parameter_list|)
block|{
ifdef|#
directive|ifdef
name|PNG_CONSOLE_IO_SUPPORTED
ifdef|#
directive|ifdef
name|PNG_ERROR_NUMBERS_SUPPORTED
if|if
condition|(
operator|*
name|warning_message
operator|==
name|PNG_LITERAL_SHARP
condition|)
block|{
name|int
name|offset
decl_stmt|;
name|char
name|warning_number
index|[
literal|16
index|]
decl_stmt|;
for|for
control|(
name|offset
operator|=
literal|0
init|;
name|offset
operator|<
literal|15
condition|;
name|offset
operator|++
control|)
block|{
name|warning_number
index|[
name|offset
index|]
operator|=
name|warning_message
index|[
name|offset
operator|+
literal|1
index|]
expr_stmt|;
if|if
condition|(
name|warning_message
index|[
name|offset
index|]
operator|==
literal|' '
condition|)
break|break;
block|}
if|if
condition|(
operator|(
name|offset
operator|>
literal|1
operator|)
operator|&&
operator|(
name|offset
operator|<
literal|15
operator|)
condition|)
block|{
name|warning_number
index|[
name|offset
operator|+
literal|1
index|]
operator|=
literal|'\0'
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"libpng warning no. %s: %s"
argument_list|,
name|warning_number
argument_list|,
name|warning_message
operator|+
name|offset
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|PNG_STRING_NEWLINE
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"libpng warning: %s"
argument_list|,
name|warning_message
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|PNG_STRING_NEWLINE
argument_list|)
expr_stmt|;
block|}
block|}
else|else
endif|#
directive|endif
block|{
name|fprintf
argument_list|(
name|stderr
argument_list|,
literal|"libpng warning: %s"
argument_list|,
name|warning_message
argument_list|)
expr_stmt|;
name|fprintf
argument_list|(
name|stderr
argument_list|,
name|PNG_STRING_NEWLINE
argument_list|)
expr_stmt|;
block|}
else|#
directive|else
name|PNG_UNUSED
argument_list|(
argument|warning_message
argument_list|)
comment|/* Make compiler happy */
endif|#
directive|endif
name|PNG_UNUSED
argument_list|(
argument|png_ptr
argument_list|)
comment|/* Make compiler happy */
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* PNG_WARNINGS_SUPPORTED */
end_comment
begin_comment
comment|/* This function is called when the application wants to use another method  * of handling errors and warnings.  Note that the error function MUST NOT  * return to the calling routine or serious problems will occur.  The return  * method used in the default routine calls longjmp(png_ptr->png_jmpbuf, 1)  */
end_comment
begin_function
name|void
name|PNGAPI
DECL|function|png_set_error_fn
name|png_set_error_fn
parameter_list|(
name|png_structp
name|png_ptr
parameter_list|,
name|png_voidp
name|error_ptr
parameter_list|,
name|png_error_ptr
name|error_fn
parameter_list|,
name|png_error_ptr
name|warning_fn
parameter_list|)
block|{
if|if
condition|(
name|png_ptr
operator|==
name|NULL
condition|)
return|return;
name|png_ptr
operator|->
name|error_ptr
operator|=
name|error_ptr
expr_stmt|;
name|png_ptr
operator|->
name|error_fn
operator|=
name|error_fn
expr_stmt|;
name|png_ptr
operator|->
name|warning_fn
operator|=
name|warning_fn
expr_stmt|;
block|}
end_function
begin_comment
comment|/* This function returns a pointer to the error_ptr associated with the user  * functions.  The application should free any memory associated with this  * pointer before png_write_destroy and png_read_destroy are called.  */
end_comment
begin_function
name|png_voidp
name|PNGAPI
DECL|function|png_get_error_ptr
name|png_get_error_ptr
parameter_list|(
name|png_const_structp
name|png_ptr
parameter_list|)
block|{
if|if
condition|(
name|png_ptr
operator|==
name|NULL
condition|)
return|return
name|NULL
return|;
return|return
operator|(
operator|(
name|png_voidp
operator|)
name|png_ptr
operator|->
name|error_ptr
operator|)
return|;
block|}
end_function
begin_ifdef
ifdef|#
directive|ifdef
name|PNG_ERROR_NUMBERS_SUPPORTED
end_ifdef
begin_function
name|void
name|PNGAPI
DECL|function|png_set_strip_error_numbers
name|png_set_strip_error_numbers
parameter_list|(
name|png_structp
name|png_ptr
parameter_list|,
name|png_uint_32
name|strip_mode
parameter_list|)
block|{
if|if
condition|(
name|png_ptr
operator|!=
name|NULL
condition|)
block|{
name|png_ptr
operator|->
name|flags
operator|&=
operator|(
operator|(
operator|~
operator|(
name|PNG_FLAG_STRIP_ERROR_NUMBERS
operator||
name|PNG_FLAG_STRIP_ERROR_TEXT
operator|)
operator|)
operator|&
name|strip_mode
operator|)
expr_stmt|;
block|}
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* PNG_READ_SUPPORTED || PNG_WRITE_SUPPORTED */
end_comment
end_unit
