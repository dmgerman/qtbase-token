begin_unit
begin_comment
comment|/* pngtrans.c - transforms the data in a row (used by both readers and writers)  *  * Last changed in libpng 1.6.17 [March 26, 2015]  * Copyright (c) 1998-2015 Glenn Randers-Pehrson  * (Version 0.96 Copyright (c) 1996, 1997 Andreas Dilger)  * (Version 0.88 Copyright (c) 1995, 1996 Guy Eric Schalnat, Group 42, Inc.)  *  * This code is released under the libpng license.  * For conditions of distribution and use, see the disclaimer  * and license in png.h  */
end_comment
begin_include
include|#
directive|include
file|"pngpriv.h"
end_include
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_SUPPORTED
argument_list|)
operator|||
name|defined
argument_list|(
name|PNG_WRITE_SUPPORTED
argument_list|)
end_if
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_BGR_SUPPORTED
argument_list|)
operator|||
name|defined
argument_list|(
name|PNG_WRITE_BGR_SUPPORTED
argument_list|)
end_if
begin_comment
comment|/* Turn on BGR-to-RGB mapping */
end_comment
begin_function
name|void
name|PNGAPI
DECL|function|png_set_bgr
name|png_set_bgr
parameter_list|(
name|png_structrp
name|png_ptr
parameter_list|)
block|{
name|png_debug
argument_list|(
literal|1
argument_list|,
literal|"in png_set_bgr"
argument_list|)
expr_stmt|;
if|if
condition|(
name|png_ptr
operator|==
name|NULL
condition|)
return|return;
name|png_ptr
operator|->
name|transformations
operator||=
name|PNG_BGR
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_SWAP_SUPPORTED
argument_list|)
operator|||
name|defined
argument_list|(
name|PNG_WRITE_SWAP_SUPPORTED
argument_list|)
end_if
begin_comment
comment|/* Turn on 16 bit byte swapping */
end_comment
begin_function
name|void
name|PNGAPI
DECL|function|png_set_swap
name|png_set_swap
parameter_list|(
name|png_structrp
name|png_ptr
parameter_list|)
block|{
name|png_debug
argument_list|(
literal|1
argument_list|,
literal|"in png_set_swap"
argument_list|)
expr_stmt|;
if|if
condition|(
name|png_ptr
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|png_ptr
operator|->
name|bit_depth
operator|==
literal|16
condition|)
name|png_ptr
operator|->
name|transformations
operator||=
name|PNG_SWAP_BYTES
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_PACK_SUPPORTED
argument_list|)
operator|||
name|defined
argument_list|(
name|PNG_WRITE_PACK_SUPPORTED
argument_list|)
end_if
begin_comment
comment|/* Turn on pixel packing */
end_comment
begin_function
name|void
name|PNGAPI
DECL|function|png_set_packing
name|png_set_packing
parameter_list|(
name|png_structrp
name|png_ptr
parameter_list|)
block|{
name|png_debug
argument_list|(
literal|1
argument_list|,
literal|"in png_set_packing"
argument_list|)
expr_stmt|;
if|if
condition|(
name|png_ptr
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|png_ptr
operator|->
name|bit_depth
operator|<
literal|8
condition|)
block|{
name|png_ptr
operator|->
name|transformations
operator||=
name|PNG_PACK
expr_stmt|;
ifdef|#
directive|ifdef
name|PNG_WRITE_SUPPORTED
name|png_ptr
operator|->
name|usr_bit_depth
operator|=
literal|8
expr_stmt|;
endif|#
directive|endif
block|}
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_PACKSWAP_SUPPORTED
argument_list|)
operator|||
name|defined
argument_list|(
name|PNG_WRITE_PACKSWAP_SUPPORTED
argument_list|)
end_if
begin_comment
comment|/* Turn on packed pixel swapping */
end_comment
begin_function
name|void
name|PNGAPI
DECL|function|png_set_packswap
name|png_set_packswap
parameter_list|(
name|png_structrp
name|png_ptr
parameter_list|)
block|{
name|png_debug
argument_list|(
literal|1
argument_list|,
literal|"in png_set_packswap"
argument_list|)
expr_stmt|;
if|if
condition|(
name|png_ptr
operator|==
name|NULL
condition|)
return|return;
if|if
condition|(
name|png_ptr
operator|->
name|bit_depth
operator|<
literal|8
condition|)
name|png_ptr
operator|->
name|transformations
operator||=
name|PNG_PACKSWAP
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_SHIFT_SUPPORTED
argument_list|)
operator|||
name|defined
argument_list|(
name|PNG_WRITE_SHIFT_SUPPORTED
argument_list|)
end_if
begin_function
name|void
name|PNGAPI
DECL|function|png_set_shift
name|png_set_shift
parameter_list|(
name|png_structrp
name|png_ptr
parameter_list|,
name|png_const_color_8p
name|true_bits
parameter_list|)
block|{
name|png_debug
argument_list|(
literal|1
argument_list|,
literal|"in png_set_shift"
argument_list|)
expr_stmt|;
if|if
condition|(
name|png_ptr
operator|==
name|NULL
condition|)
return|return;
name|png_ptr
operator|->
name|transformations
operator||=
name|PNG_SHIFT
expr_stmt|;
name|png_ptr
operator|->
name|shift
operator|=
operator|*
name|true_bits
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_INTERLACING_SUPPORTED
argument_list|)
operator|||
expr|\
name|defined
argument_list|(
name|PNG_WRITE_INTERLACING_SUPPORTED
argument_list|)
end_if
begin_function
name|int
name|PNGAPI
DECL|function|png_set_interlace_handling
name|png_set_interlace_handling
parameter_list|(
name|png_structrp
name|png_ptr
parameter_list|)
block|{
name|png_debug
argument_list|(
literal|1
argument_list|,
literal|"in png_set_interlace handling"
argument_list|)
expr_stmt|;
if|if
condition|(
name|png_ptr
operator|!=
literal|0
operator|&&
name|png_ptr
operator|->
name|interlaced
operator|!=
literal|0
condition|)
block|{
name|png_ptr
operator|->
name|transformations
operator||=
name|PNG_INTERLACE
expr_stmt|;
return|return
operator|(
literal|7
operator|)
return|;
block|}
return|return
operator|(
literal|1
operator|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_FILLER_SUPPORTED
argument_list|)
operator|||
name|defined
argument_list|(
name|PNG_WRITE_FILLER_SUPPORTED
argument_list|)
end_if
begin_comment
comment|/* Add a filler byte on read, or remove a filler or alpha byte on write.  * The filler type has changed in v0.95 to allow future 2-byte fillers  * for 48-bit input data, as well as to avoid problems with some compilers  * that don't like bytes as parameters.  */
end_comment
begin_function
name|void
name|PNGAPI
DECL|function|png_set_filler
name|png_set_filler
parameter_list|(
name|png_structrp
name|png_ptr
parameter_list|,
name|png_uint_32
name|filler
parameter_list|,
name|int
name|filler_loc
parameter_list|)
block|{
name|png_debug
argument_list|(
literal|1
argument_list|,
literal|"in png_set_filler"
argument_list|)
expr_stmt|;
if|if
condition|(
name|png_ptr
operator|==
name|NULL
condition|)
return|return;
comment|/* In libpng 1.6 it is possible to determine whether this is a read or write     * operation and therefore to do more checking here for a valid call.     */
if|if
condition|(
operator|(
name|png_ptr
operator|->
name|mode
operator|&
name|PNG_IS_READ_STRUCT
operator|)
operator|!=
literal|0
condition|)
block|{
ifdef|#
directive|ifdef
name|PNG_READ_FILLER_SUPPORTED
comment|/* On read png_set_filler is always valid, regardless of the base PNG           * format, because other transformations can give a format where the           * filler code can execute (basically an 8 or 16-bit component RGB or G           * format.)           *           * NOTE: usr_channels is not used by the read code!  (This has led to           * confusion in the past.)  The filler is only used in the read code.           */
name|png_ptr
operator|->
name|filler
operator|=
operator|(
name|png_uint_16
operator|)
name|filler
expr_stmt|;
else|#
directive|else
name|png_app_error
argument_list|(
name|png_ptr
argument_list|,
literal|"png_set_filler not supported on read"
argument_list|)
expr_stmt|;
name|PNG_UNUSED
argument_list|(
argument|filler
argument_list|)
comment|/* not used in the write case */
return|return;
endif|#
directive|endif
block|}
else|else
comment|/* write */
block|{
ifdef|#
directive|ifdef
name|PNG_WRITE_FILLER_SUPPORTED
comment|/* On write the usr_channels parameter must be set correctly at the           * start to record the number of channels in the app-supplied data.           */
switch|switch
condition|(
name|png_ptr
operator|->
name|color_type
condition|)
block|{
case|case
name|PNG_COLOR_TYPE_RGB
case|:
name|png_ptr
operator|->
name|usr_channels
operator|=
literal|4
expr_stmt|;
break|break;
case|case
name|PNG_COLOR_TYPE_GRAY
case|:
if|if
condition|(
name|png_ptr
operator|->
name|bit_depth
operator|>=
literal|8
condition|)
block|{
name|png_ptr
operator|->
name|usr_channels
operator|=
literal|2
expr_stmt|;
break|break;
block|}
else|else
block|{
comment|/* There simply isn't any code in libpng to strip out bits                    * from bytes when the components are less than a byte in                    * size!                    */
name|png_app_error
argument_list|(
name|png_ptr
argument_list|,
literal|"png_set_filler is invalid for low bit depth gray output"
argument_list|)
expr_stmt|;
return|return;
block|}
default|default:
name|png_app_error
argument_list|(
name|png_ptr
argument_list|,
literal|"png_set_filler: inappropriate color type"
argument_list|)
expr_stmt|;
return|return;
block|}
else|#
directive|else
name|png_app_error
argument_list|(
name|png_ptr
argument_list|,
literal|"png_set_filler not supported on write"
argument_list|)
expr_stmt|;
return|return;
endif|#
directive|endif
block|}
comment|/* Here on success - libpng supports the operation, set the transformation     * and the flag to say where the filler channel is.     */
name|png_ptr
operator|->
name|transformations
operator||=
name|PNG_FILLER
expr_stmt|;
if|if
condition|(
name|filler_loc
operator|==
name|PNG_FILLER_AFTER
condition|)
name|png_ptr
operator|->
name|flags
operator||=
name|PNG_FLAG_FILLER_AFTER
expr_stmt|;
else|else
name|png_ptr
operator|->
name|flags
operator|&=
operator|~
name|PNG_FLAG_FILLER_AFTER
expr_stmt|;
block|}
end_function
begin_comment
comment|/* Added to libpng-1.2.7 */
end_comment
begin_function
name|void
name|PNGAPI
DECL|function|png_set_add_alpha
name|png_set_add_alpha
parameter_list|(
name|png_structrp
name|png_ptr
parameter_list|,
name|png_uint_32
name|filler
parameter_list|,
name|int
name|filler_loc
parameter_list|)
block|{
name|png_debug
argument_list|(
literal|1
argument_list|,
literal|"in png_set_add_alpha"
argument_list|)
expr_stmt|;
if|if
condition|(
name|png_ptr
operator|==
name|NULL
condition|)
return|return;
name|png_set_filler
argument_list|(
name|png_ptr
argument_list|,
name|filler
argument_list|,
name|filler_loc
argument_list|)
expr_stmt|;
comment|/* The above may fail to do anything. */
if|if
condition|(
operator|(
name|png_ptr
operator|->
name|transformations
operator|&
name|PNG_FILLER
operator|)
operator|!=
literal|0
condition|)
name|png_ptr
operator|->
name|transformations
operator||=
name|PNG_ADD_ALPHA
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_SWAP_ALPHA_SUPPORTED
argument_list|)
operator|||
expr|\
name|defined
argument_list|(
name|PNG_WRITE_SWAP_ALPHA_SUPPORTED
argument_list|)
end_if
begin_function
name|void
name|PNGAPI
DECL|function|png_set_swap_alpha
name|png_set_swap_alpha
parameter_list|(
name|png_structrp
name|png_ptr
parameter_list|)
block|{
name|png_debug
argument_list|(
literal|1
argument_list|,
literal|"in png_set_swap_alpha"
argument_list|)
expr_stmt|;
if|if
condition|(
name|png_ptr
operator|==
name|NULL
condition|)
return|return;
name|png_ptr
operator|->
name|transformations
operator||=
name|PNG_SWAP_ALPHA
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_INVERT_ALPHA_SUPPORTED
argument_list|)
operator|||
expr|\
name|defined
argument_list|(
name|PNG_WRITE_INVERT_ALPHA_SUPPORTED
argument_list|)
end_if
begin_function
name|void
name|PNGAPI
DECL|function|png_set_invert_alpha
name|png_set_invert_alpha
parameter_list|(
name|png_structrp
name|png_ptr
parameter_list|)
block|{
name|png_debug
argument_list|(
literal|1
argument_list|,
literal|"in png_set_invert_alpha"
argument_list|)
expr_stmt|;
if|if
condition|(
name|png_ptr
operator|==
name|NULL
condition|)
return|return;
name|png_ptr
operator|->
name|transformations
operator||=
name|PNG_INVERT_ALPHA
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_INVERT_SUPPORTED
argument_list|)
operator|||
name|defined
argument_list|(
name|PNG_WRITE_INVERT_SUPPORTED
argument_list|)
end_if
begin_function
name|void
name|PNGAPI
DECL|function|png_set_invert_mono
name|png_set_invert_mono
parameter_list|(
name|png_structrp
name|png_ptr
parameter_list|)
block|{
name|png_debug
argument_list|(
literal|1
argument_list|,
literal|"in png_set_invert_mono"
argument_list|)
expr_stmt|;
if|if
condition|(
name|png_ptr
operator|==
name|NULL
condition|)
return|return;
name|png_ptr
operator|->
name|transformations
operator||=
name|PNG_INVERT_MONO
expr_stmt|;
block|}
end_function
begin_comment
comment|/* Invert monochrome grayscale data */
end_comment
begin_function
name|void
comment|/* PRIVATE */
DECL|function|png_do_invert
name|png_do_invert
parameter_list|(
name|png_row_infop
name|row_info
parameter_list|,
name|png_bytep
name|row
parameter_list|)
block|{
name|png_debug
argument_list|(
literal|1
argument_list|,
literal|"in png_do_invert"
argument_list|)
expr_stmt|;
comment|/* This test removed from libpng version 1.0.13 and 1.2.0:    *   if (row_info->bit_depth == 1&&    */
if|if
condition|(
name|row_info
operator|->
name|color_type
operator|==
name|PNG_COLOR_TYPE_GRAY
condition|)
block|{
name|png_bytep
name|rp
init|=
name|row
decl_stmt|;
name|png_size_t
name|i
decl_stmt|;
name|png_size_t
name|istop
init|=
name|row_info
operator|->
name|rowbytes
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|istop
condition|;
name|i
operator|++
control|)
block|{
operator|*
name|rp
operator|=
call|(
name|png_byte
call|)
argument_list|(
operator|~
operator|(
operator|*
name|rp
operator|)
argument_list|)
expr_stmt|;
name|rp
operator|++
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|row_info
operator|->
name|color_type
operator|==
name|PNG_COLOR_TYPE_GRAY_ALPHA
operator|&&
name|row_info
operator|->
name|bit_depth
operator|==
literal|8
condition|)
block|{
name|png_bytep
name|rp
init|=
name|row
decl_stmt|;
name|png_size_t
name|i
decl_stmt|;
name|png_size_t
name|istop
init|=
name|row_info
operator|->
name|rowbytes
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|istop
condition|;
name|i
operator|+=
literal|2
control|)
block|{
operator|*
name|rp
operator|=
call|(
name|png_byte
call|)
argument_list|(
operator|~
operator|(
operator|*
name|rp
operator|)
argument_list|)
expr_stmt|;
name|rp
operator|+=
literal|2
expr_stmt|;
block|}
block|}
ifdef|#
directive|ifdef
name|PNG_16BIT_SUPPORTED
elseif|else
if|if
condition|(
name|row_info
operator|->
name|color_type
operator|==
name|PNG_COLOR_TYPE_GRAY_ALPHA
operator|&&
name|row_info
operator|->
name|bit_depth
operator|==
literal|16
condition|)
block|{
name|png_bytep
name|rp
init|=
name|row
decl_stmt|;
name|png_size_t
name|i
decl_stmt|;
name|png_size_t
name|istop
init|=
name|row_info
operator|->
name|rowbytes
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|istop
condition|;
name|i
operator|+=
literal|4
control|)
block|{
operator|*
name|rp
operator|=
call|(
name|png_byte
call|)
argument_list|(
operator|~
operator|(
operator|*
name|rp
operator|)
argument_list|)
expr_stmt|;
operator|*
operator|(
name|rp
operator|+
literal|1
operator|)
operator|=
call|(
name|png_byte
call|)
argument_list|(
operator|~
operator|(
operator|*
operator|(
name|rp
operator|+
literal|1
operator|)
operator|)
argument_list|)
expr_stmt|;
name|rp
operator|+=
literal|4
expr_stmt|;
block|}
block|}
endif|#
directive|endif
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_ifdef
ifdef|#
directive|ifdef
name|PNG_16BIT_SUPPORTED
end_ifdef
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_SWAP_SUPPORTED
argument_list|)
operator|||
name|defined
argument_list|(
name|PNG_WRITE_SWAP_SUPPORTED
argument_list|)
end_if
begin_comment
comment|/* Swaps byte order on 16 bit depth images */
end_comment
begin_function
name|void
comment|/* PRIVATE */
DECL|function|png_do_swap
name|png_do_swap
parameter_list|(
name|png_row_infop
name|row_info
parameter_list|,
name|png_bytep
name|row
parameter_list|)
block|{
name|png_debug
argument_list|(
literal|1
argument_list|,
literal|"in png_do_swap"
argument_list|)
expr_stmt|;
if|if
condition|(
name|row_info
operator|->
name|bit_depth
operator|==
literal|16
condition|)
block|{
name|png_bytep
name|rp
init|=
name|row
decl_stmt|;
name|png_uint_32
name|i
decl_stmt|;
name|png_uint_32
name|istop
init|=
name|row_info
operator|->
name|width
operator|*
name|row_info
operator|->
name|channels
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
init|;
name|i
operator|<
name|istop
condition|;
name|i
operator|++
operator|,
name|rp
operator|+=
literal|2
control|)
block|{
ifdef|#
directive|ifdef
name|PNG_BUILTIN_BSWAP16_SUPPORTED
comment|/* Feature added to libpng-1.6.11 for testing purposes, not           * enabled by default.           */
operator|*
operator|(
name|png_uint_16
operator|*
operator|)
name|rp
operator|=
name|__builtin_bswap16
argument_list|(
operator|*
operator|(
name|png_uint_16
operator|*
operator|)
name|rp
argument_list|)
expr_stmt|;
else|#
directive|else
name|png_byte
name|t
init|=
operator|*
name|rp
decl_stmt|;
operator|*
name|rp
operator|=
operator|*
operator|(
name|rp
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|rp
operator|+
literal|1
operator|)
operator|=
name|t
expr_stmt|;
endif|#
directive|endif
block|}
block|}
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_PACKSWAP_SUPPORTED
argument_list|)
operator|||
name|defined
argument_list|(
name|PNG_WRITE_PACKSWAP_SUPPORTED
argument_list|)
end_if
begin_decl_stmt
DECL|variable|onebppswaptable
specifier|static
name|PNG_CONST
name|png_byte
name|onebppswaptable
index|[
literal|256
index|]
init|=
block|{
literal|0x00
block|,
literal|0x80
block|,
literal|0x40
block|,
literal|0xC0
block|,
literal|0x20
block|,
literal|0xA0
block|,
literal|0x60
block|,
literal|0xE0
block|,
literal|0x10
block|,
literal|0x90
block|,
literal|0x50
block|,
literal|0xD0
block|,
literal|0x30
block|,
literal|0xB0
block|,
literal|0x70
block|,
literal|0xF0
block|,
literal|0x08
block|,
literal|0x88
block|,
literal|0x48
block|,
literal|0xC8
block|,
literal|0x28
block|,
literal|0xA8
block|,
literal|0x68
block|,
literal|0xE8
block|,
literal|0x18
block|,
literal|0x98
block|,
literal|0x58
block|,
literal|0xD8
block|,
literal|0x38
block|,
literal|0xB8
block|,
literal|0x78
block|,
literal|0xF8
block|,
literal|0x04
block|,
literal|0x84
block|,
literal|0x44
block|,
literal|0xC4
block|,
literal|0x24
block|,
literal|0xA4
block|,
literal|0x64
block|,
literal|0xE4
block|,
literal|0x14
block|,
literal|0x94
block|,
literal|0x54
block|,
literal|0xD4
block|,
literal|0x34
block|,
literal|0xB4
block|,
literal|0x74
block|,
literal|0xF4
block|,
literal|0x0C
block|,
literal|0x8C
block|,
literal|0x4C
block|,
literal|0xCC
block|,
literal|0x2C
block|,
literal|0xAC
block|,
literal|0x6C
block|,
literal|0xEC
block|,
literal|0x1C
block|,
literal|0x9C
block|,
literal|0x5C
block|,
literal|0xDC
block|,
literal|0x3C
block|,
literal|0xBC
block|,
literal|0x7C
block|,
literal|0xFC
block|,
literal|0x02
block|,
literal|0x82
block|,
literal|0x42
block|,
literal|0xC2
block|,
literal|0x22
block|,
literal|0xA2
block|,
literal|0x62
block|,
literal|0xE2
block|,
literal|0x12
block|,
literal|0x92
block|,
literal|0x52
block|,
literal|0xD2
block|,
literal|0x32
block|,
literal|0xB2
block|,
literal|0x72
block|,
literal|0xF2
block|,
literal|0x0A
block|,
literal|0x8A
block|,
literal|0x4A
block|,
literal|0xCA
block|,
literal|0x2A
block|,
literal|0xAA
block|,
literal|0x6A
block|,
literal|0xEA
block|,
literal|0x1A
block|,
literal|0x9A
block|,
literal|0x5A
block|,
literal|0xDA
block|,
literal|0x3A
block|,
literal|0xBA
block|,
literal|0x7A
block|,
literal|0xFA
block|,
literal|0x06
block|,
literal|0x86
block|,
literal|0x46
block|,
literal|0xC6
block|,
literal|0x26
block|,
literal|0xA6
block|,
literal|0x66
block|,
literal|0xE6
block|,
literal|0x16
block|,
literal|0x96
block|,
literal|0x56
block|,
literal|0xD6
block|,
literal|0x36
block|,
literal|0xB6
block|,
literal|0x76
block|,
literal|0xF6
block|,
literal|0x0E
block|,
literal|0x8E
block|,
literal|0x4E
block|,
literal|0xCE
block|,
literal|0x2E
block|,
literal|0xAE
block|,
literal|0x6E
block|,
literal|0xEE
block|,
literal|0x1E
block|,
literal|0x9E
block|,
literal|0x5E
block|,
literal|0xDE
block|,
literal|0x3E
block|,
literal|0xBE
block|,
literal|0x7E
block|,
literal|0xFE
block|,
literal|0x01
block|,
literal|0x81
block|,
literal|0x41
block|,
literal|0xC1
block|,
literal|0x21
block|,
literal|0xA1
block|,
literal|0x61
block|,
literal|0xE1
block|,
literal|0x11
block|,
literal|0x91
block|,
literal|0x51
block|,
literal|0xD1
block|,
literal|0x31
block|,
literal|0xB1
block|,
literal|0x71
block|,
literal|0xF1
block|,
literal|0x09
block|,
literal|0x89
block|,
literal|0x49
block|,
literal|0xC9
block|,
literal|0x29
block|,
literal|0xA9
block|,
literal|0x69
block|,
literal|0xE9
block|,
literal|0x19
block|,
literal|0x99
block|,
literal|0x59
block|,
literal|0xD9
block|,
literal|0x39
block|,
literal|0xB9
block|,
literal|0x79
block|,
literal|0xF9
block|,
literal|0x05
block|,
literal|0x85
block|,
literal|0x45
block|,
literal|0xC5
block|,
literal|0x25
block|,
literal|0xA5
block|,
literal|0x65
block|,
literal|0xE5
block|,
literal|0x15
block|,
literal|0x95
block|,
literal|0x55
block|,
literal|0xD5
block|,
literal|0x35
block|,
literal|0xB5
block|,
literal|0x75
block|,
literal|0xF5
block|,
literal|0x0D
block|,
literal|0x8D
block|,
literal|0x4D
block|,
literal|0xCD
block|,
literal|0x2D
block|,
literal|0xAD
block|,
literal|0x6D
block|,
literal|0xED
block|,
literal|0x1D
block|,
literal|0x9D
block|,
literal|0x5D
block|,
literal|0xDD
block|,
literal|0x3D
block|,
literal|0xBD
block|,
literal|0x7D
block|,
literal|0xFD
block|,
literal|0x03
block|,
literal|0x83
block|,
literal|0x43
block|,
literal|0xC3
block|,
literal|0x23
block|,
literal|0xA3
block|,
literal|0x63
block|,
literal|0xE3
block|,
literal|0x13
block|,
literal|0x93
block|,
literal|0x53
block|,
literal|0xD3
block|,
literal|0x33
block|,
literal|0xB3
block|,
literal|0x73
block|,
literal|0xF3
block|,
literal|0x0B
block|,
literal|0x8B
block|,
literal|0x4B
block|,
literal|0xCB
block|,
literal|0x2B
block|,
literal|0xAB
block|,
literal|0x6B
block|,
literal|0xEB
block|,
literal|0x1B
block|,
literal|0x9B
block|,
literal|0x5B
block|,
literal|0xDB
block|,
literal|0x3B
block|,
literal|0xBB
block|,
literal|0x7B
block|,
literal|0xFB
block|,
literal|0x07
block|,
literal|0x87
block|,
literal|0x47
block|,
literal|0xC7
block|,
literal|0x27
block|,
literal|0xA7
block|,
literal|0x67
block|,
literal|0xE7
block|,
literal|0x17
block|,
literal|0x97
block|,
literal|0x57
block|,
literal|0xD7
block|,
literal|0x37
block|,
literal|0xB7
block|,
literal|0x77
block|,
literal|0xF7
block|,
literal|0x0F
block|,
literal|0x8F
block|,
literal|0x4F
block|,
literal|0xCF
block|,
literal|0x2F
block|,
literal|0xAF
block|,
literal|0x6F
block|,
literal|0xEF
block|,
literal|0x1F
block|,
literal|0x9F
block|,
literal|0x5F
block|,
literal|0xDF
block|,
literal|0x3F
block|,
literal|0xBF
block|,
literal|0x7F
block|,
literal|0xFF
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|variable|twobppswaptable
specifier|static
name|PNG_CONST
name|png_byte
name|twobppswaptable
index|[
literal|256
index|]
init|=
block|{
literal|0x00
block|,
literal|0x40
block|,
literal|0x80
block|,
literal|0xC0
block|,
literal|0x10
block|,
literal|0x50
block|,
literal|0x90
block|,
literal|0xD0
block|,
literal|0x20
block|,
literal|0x60
block|,
literal|0xA0
block|,
literal|0xE0
block|,
literal|0x30
block|,
literal|0x70
block|,
literal|0xB0
block|,
literal|0xF0
block|,
literal|0x04
block|,
literal|0x44
block|,
literal|0x84
block|,
literal|0xC4
block|,
literal|0x14
block|,
literal|0x54
block|,
literal|0x94
block|,
literal|0xD4
block|,
literal|0x24
block|,
literal|0x64
block|,
literal|0xA4
block|,
literal|0xE4
block|,
literal|0x34
block|,
literal|0x74
block|,
literal|0xB4
block|,
literal|0xF4
block|,
literal|0x08
block|,
literal|0x48
block|,
literal|0x88
block|,
literal|0xC8
block|,
literal|0x18
block|,
literal|0x58
block|,
literal|0x98
block|,
literal|0xD8
block|,
literal|0x28
block|,
literal|0x68
block|,
literal|0xA8
block|,
literal|0xE8
block|,
literal|0x38
block|,
literal|0x78
block|,
literal|0xB8
block|,
literal|0xF8
block|,
literal|0x0C
block|,
literal|0x4C
block|,
literal|0x8C
block|,
literal|0xCC
block|,
literal|0x1C
block|,
literal|0x5C
block|,
literal|0x9C
block|,
literal|0xDC
block|,
literal|0x2C
block|,
literal|0x6C
block|,
literal|0xAC
block|,
literal|0xEC
block|,
literal|0x3C
block|,
literal|0x7C
block|,
literal|0xBC
block|,
literal|0xFC
block|,
literal|0x01
block|,
literal|0x41
block|,
literal|0x81
block|,
literal|0xC1
block|,
literal|0x11
block|,
literal|0x51
block|,
literal|0x91
block|,
literal|0xD1
block|,
literal|0x21
block|,
literal|0x61
block|,
literal|0xA1
block|,
literal|0xE1
block|,
literal|0x31
block|,
literal|0x71
block|,
literal|0xB1
block|,
literal|0xF1
block|,
literal|0x05
block|,
literal|0x45
block|,
literal|0x85
block|,
literal|0xC5
block|,
literal|0x15
block|,
literal|0x55
block|,
literal|0x95
block|,
literal|0xD5
block|,
literal|0x25
block|,
literal|0x65
block|,
literal|0xA5
block|,
literal|0xE5
block|,
literal|0x35
block|,
literal|0x75
block|,
literal|0xB5
block|,
literal|0xF5
block|,
literal|0x09
block|,
literal|0x49
block|,
literal|0x89
block|,
literal|0xC9
block|,
literal|0x19
block|,
literal|0x59
block|,
literal|0x99
block|,
literal|0xD9
block|,
literal|0x29
block|,
literal|0x69
block|,
literal|0xA9
block|,
literal|0xE9
block|,
literal|0x39
block|,
literal|0x79
block|,
literal|0xB9
block|,
literal|0xF9
block|,
literal|0x0D
block|,
literal|0x4D
block|,
literal|0x8D
block|,
literal|0xCD
block|,
literal|0x1D
block|,
literal|0x5D
block|,
literal|0x9D
block|,
literal|0xDD
block|,
literal|0x2D
block|,
literal|0x6D
block|,
literal|0xAD
block|,
literal|0xED
block|,
literal|0x3D
block|,
literal|0x7D
block|,
literal|0xBD
block|,
literal|0xFD
block|,
literal|0x02
block|,
literal|0x42
block|,
literal|0x82
block|,
literal|0xC2
block|,
literal|0x12
block|,
literal|0x52
block|,
literal|0x92
block|,
literal|0xD2
block|,
literal|0x22
block|,
literal|0x62
block|,
literal|0xA2
block|,
literal|0xE2
block|,
literal|0x32
block|,
literal|0x72
block|,
literal|0xB2
block|,
literal|0xF2
block|,
literal|0x06
block|,
literal|0x46
block|,
literal|0x86
block|,
literal|0xC6
block|,
literal|0x16
block|,
literal|0x56
block|,
literal|0x96
block|,
literal|0xD6
block|,
literal|0x26
block|,
literal|0x66
block|,
literal|0xA6
block|,
literal|0xE6
block|,
literal|0x36
block|,
literal|0x76
block|,
literal|0xB6
block|,
literal|0xF6
block|,
literal|0x0A
block|,
literal|0x4A
block|,
literal|0x8A
block|,
literal|0xCA
block|,
literal|0x1A
block|,
literal|0x5A
block|,
literal|0x9A
block|,
literal|0xDA
block|,
literal|0x2A
block|,
literal|0x6A
block|,
literal|0xAA
block|,
literal|0xEA
block|,
literal|0x3A
block|,
literal|0x7A
block|,
literal|0xBA
block|,
literal|0xFA
block|,
literal|0x0E
block|,
literal|0x4E
block|,
literal|0x8E
block|,
literal|0xCE
block|,
literal|0x1E
block|,
literal|0x5E
block|,
literal|0x9E
block|,
literal|0xDE
block|,
literal|0x2E
block|,
literal|0x6E
block|,
literal|0xAE
block|,
literal|0xEE
block|,
literal|0x3E
block|,
literal|0x7E
block|,
literal|0xBE
block|,
literal|0xFE
block|,
literal|0x03
block|,
literal|0x43
block|,
literal|0x83
block|,
literal|0xC3
block|,
literal|0x13
block|,
literal|0x53
block|,
literal|0x93
block|,
literal|0xD3
block|,
literal|0x23
block|,
literal|0x63
block|,
literal|0xA3
block|,
literal|0xE3
block|,
literal|0x33
block|,
literal|0x73
block|,
literal|0xB3
block|,
literal|0xF3
block|,
literal|0x07
block|,
literal|0x47
block|,
literal|0x87
block|,
literal|0xC7
block|,
literal|0x17
block|,
literal|0x57
block|,
literal|0x97
block|,
literal|0xD7
block|,
literal|0x27
block|,
literal|0x67
block|,
literal|0xA7
block|,
literal|0xE7
block|,
literal|0x37
block|,
literal|0x77
block|,
literal|0xB7
block|,
literal|0xF7
block|,
literal|0x0B
block|,
literal|0x4B
block|,
literal|0x8B
block|,
literal|0xCB
block|,
literal|0x1B
block|,
literal|0x5B
block|,
literal|0x9B
block|,
literal|0xDB
block|,
literal|0x2B
block|,
literal|0x6B
block|,
literal|0xAB
block|,
literal|0xEB
block|,
literal|0x3B
block|,
literal|0x7B
block|,
literal|0xBB
block|,
literal|0xFB
block|,
literal|0x0F
block|,
literal|0x4F
block|,
literal|0x8F
block|,
literal|0xCF
block|,
literal|0x1F
block|,
literal|0x5F
block|,
literal|0x9F
block|,
literal|0xDF
block|,
literal|0x2F
block|,
literal|0x6F
block|,
literal|0xAF
block|,
literal|0xEF
block|,
literal|0x3F
block|,
literal|0x7F
block|,
literal|0xBF
block|,
literal|0xFF
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|variable|fourbppswaptable
specifier|static
name|PNG_CONST
name|png_byte
name|fourbppswaptable
index|[
literal|256
index|]
init|=
block|{
literal|0x00
block|,
literal|0x10
block|,
literal|0x20
block|,
literal|0x30
block|,
literal|0x40
block|,
literal|0x50
block|,
literal|0x60
block|,
literal|0x70
block|,
literal|0x80
block|,
literal|0x90
block|,
literal|0xA0
block|,
literal|0xB0
block|,
literal|0xC0
block|,
literal|0xD0
block|,
literal|0xE0
block|,
literal|0xF0
block|,
literal|0x01
block|,
literal|0x11
block|,
literal|0x21
block|,
literal|0x31
block|,
literal|0x41
block|,
literal|0x51
block|,
literal|0x61
block|,
literal|0x71
block|,
literal|0x81
block|,
literal|0x91
block|,
literal|0xA1
block|,
literal|0xB1
block|,
literal|0xC1
block|,
literal|0xD1
block|,
literal|0xE1
block|,
literal|0xF1
block|,
literal|0x02
block|,
literal|0x12
block|,
literal|0x22
block|,
literal|0x32
block|,
literal|0x42
block|,
literal|0x52
block|,
literal|0x62
block|,
literal|0x72
block|,
literal|0x82
block|,
literal|0x92
block|,
literal|0xA2
block|,
literal|0xB2
block|,
literal|0xC2
block|,
literal|0xD2
block|,
literal|0xE2
block|,
literal|0xF2
block|,
literal|0x03
block|,
literal|0x13
block|,
literal|0x23
block|,
literal|0x33
block|,
literal|0x43
block|,
literal|0x53
block|,
literal|0x63
block|,
literal|0x73
block|,
literal|0x83
block|,
literal|0x93
block|,
literal|0xA3
block|,
literal|0xB3
block|,
literal|0xC3
block|,
literal|0xD3
block|,
literal|0xE3
block|,
literal|0xF3
block|,
literal|0x04
block|,
literal|0x14
block|,
literal|0x24
block|,
literal|0x34
block|,
literal|0x44
block|,
literal|0x54
block|,
literal|0x64
block|,
literal|0x74
block|,
literal|0x84
block|,
literal|0x94
block|,
literal|0xA4
block|,
literal|0xB4
block|,
literal|0xC4
block|,
literal|0xD4
block|,
literal|0xE4
block|,
literal|0xF4
block|,
literal|0x05
block|,
literal|0x15
block|,
literal|0x25
block|,
literal|0x35
block|,
literal|0x45
block|,
literal|0x55
block|,
literal|0x65
block|,
literal|0x75
block|,
literal|0x85
block|,
literal|0x95
block|,
literal|0xA5
block|,
literal|0xB5
block|,
literal|0xC5
block|,
literal|0xD5
block|,
literal|0xE5
block|,
literal|0xF5
block|,
literal|0x06
block|,
literal|0x16
block|,
literal|0x26
block|,
literal|0x36
block|,
literal|0x46
block|,
literal|0x56
block|,
literal|0x66
block|,
literal|0x76
block|,
literal|0x86
block|,
literal|0x96
block|,
literal|0xA6
block|,
literal|0xB6
block|,
literal|0xC6
block|,
literal|0xD6
block|,
literal|0xE6
block|,
literal|0xF6
block|,
literal|0x07
block|,
literal|0x17
block|,
literal|0x27
block|,
literal|0x37
block|,
literal|0x47
block|,
literal|0x57
block|,
literal|0x67
block|,
literal|0x77
block|,
literal|0x87
block|,
literal|0x97
block|,
literal|0xA7
block|,
literal|0xB7
block|,
literal|0xC7
block|,
literal|0xD7
block|,
literal|0xE7
block|,
literal|0xF7
block|,
literal|0x08
block|,
literal|0x18
block|,
literal|0x28
block|,
literal|0x38
block|,
literal|0x48
block|,
literal|0x58
block|,
literal|0x68
block|,
literal|0x78
block|,
literal|0x88
block|,
literal|0x98
block|,
literal|0xA8
block|,
literal|0xB8
block|,
literal|0xC8
block|,
literal|0xD8
block|,
literal|0xE8
block|,
literal|0xF8
block|,
literal|0x09
block|,
literal|0x19
block|,
literal|0x29
block|,
literal|0x39
block|,
literal|0x49
block|,
literal|0x59
block|,
literal|0x69
block|,
literal|0x79
block|,
literal|0x89
block|,
literal|0x99
block|,
literal|0xA9
block|,
literal|0xB9
block|,
literal|0xC9
block|,
literal|0xD9
block|,
literal|0xE9
block|,
literal|0xF9
block|,
literal|0x0A
block|,
literal|0x1A
block|,
literal|0x2A
block|,
literal|0x3A
block|,
literal|0x4A
block|,
literal|0x5A
block|,
literal|0x6A
block|,
literal|0x7A
block|,
literal|0x8A
block|,
literal|0x9A
block|,
literal|0xAA
block|,
literal|0xBA
block|,
literal|0xCA
block|,
literal|0xDA
block|,
literal|0xEA
block|,
literal|0xFA
block|,
literal|0x0B
block|,
literal|0x1B
block|,
literal|0x2B
block|,
literal|0x3B
block|,
literal|0x4B
block|,
literal|0x5B
block|,
literal|0x6B
block|,
literal|0x7B
block|,
literal|0x8B
block|,
literal|0x9B
block|,
literal|0xAB
block|,
literal|0xBB
block|,
literal|0xCB
block|,
literal|0xDB
block|,
literal|0xEB
block|,
literal|0xFB
block|,
literal|0x0C
block|,
literal|0x1C
block|,
literal|0x2C
block|,
literal|0x3C
block|,
literal|0x4C
block|,
literal|0x5C
block|,
literal|0x6C
block|,
literal|0x7C
block|,
literal|0x8C
block|,
literal|0x9C
block|,
literal|0xAC
block|,
literal|0xBC
block|,
literal|0xCC
block|,
literal|0xDC
block|,
literal|0xEC
block|,
literal|0xFC
block|,
literal|0x0D
block|,
literal|0x1D
block|,
literal|0x2D
block|,
literal|0x3D
block|,
literal|0x4D
block|,
literal|0x5D
block|,
literal|0x6D
block|,
literal|0x7D
block|,
literal|0x8D
block|,
literal|0x9D
block|,
literal|0xAD
block|,
literal|0xBD
block|,
literal|0xCD
block|,
literal|0xDD
block|,
literal|0xED
block|,
literal|0xFD
block|,
literal|0x0E
block|,
literal|0x1E
block|,
literal|0x2E
block|,
literal|0x3E
block|,
literal|0x4E
block|,
literal|0x5E
block|,
literal|0x6E
block|,
literal|0x7E
block|,
literal|0x8E
block|,
literal|0x9E
block|,
literal|0xAE
block|,
literal|0xBE
block|,
literal|0xCE
block|,
literal|0xDE
block|,
literal|0xEE
block|,
literal|0xFE
block|,
literal|0x0F
block|,
literal|0x1F
block|,
literal|0x2F
block|,
literal|0x3F
block|,
literal|0x4F
block|,
literal|0x5F
block|,
literal|0x6F
block|,
literal|0x7F
block|,
literal|0x8F
block|,
literal|0x9F
block|,
literal|0xAF
block|,
literal|0xBF
block|,
literal|0xCF
block|,
literal|0xDF
block|,
literal|0xEF
block|,
literal|0xFF
block|}
decl_stmt|;
end_decl_stmt
begin_comment
comment|/* Swaps pixel packing order within bytes */
end_comment
begin_function
name|void
comment|/* PRIVATE */
DECL|function|png_do_packswap
name|png_do_packswap
parameter_list|(
name|png_row_infop
name|row_info
parameter_list|,
name|png_bytep
name|row
parameter_list|)
block|{
name|png_debug
argument_list|(
literal|1
argument_list|,
literal|"in png_do_packswap"
argument_list|)
expr_stmt|;
if|if
condition|(
name|row_info
operator|->
name|bit_depth
operator|<
literal|8
condition|)
block|{
name|png_bytep
name|rp
decl_stmt|;
name|png_const_bytep
name|end
decl_stmt|,
name|table
decl_stmt|;
name|end
operator|=
name|row
operator|+
name|row_info
operator|->
name|rowbytes
expr_stmt|;
if|if
condition|(
name|row_info
operator|->
name|bit_depth
operator|==
literal|1
condition|)
name|table
operator|=
name|onebppswaptable
expr_stmt|;
elseif|else
if|if
condition|(
name|row_info
operator|->
name|bit_depth
operator|==
literal|2
condition|)
name|table
operator|=
name|twobppswaptable
expr_stmt|;
elseif|else
if|if
condition|(
name|row_info
operator|->
name|bit_depth
operator|==
literal|4
condition|)
name|table
operator|=
name|fourbppswaptable
expr_stmt|;
else|else
return|return;
for|for
control|(
name|rp
operator|=
name|row
init|;
name|rp
operator|<
name|end
condition|;
name|rp
operator|++
control|)
operator|*
name|rp
operator|=
name|table
index|[
operator|*
name|rp
index|]
expr_stmt|;
block|}
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* PACKSWAP || WRITE_PACKSWAP */
end_comment
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_WRITE_FILLER_SUPPORTED
argument_list|)
operator|||
expr|\
name|defined
argument_list|(
name|PNG_READ_STRIP_ALPHA_SUPPORTED
argument_list|)
end_if
begin_comment
comment|/* Remove a channel - this used to be 'png_do_strip_filler' but it used a  * somewhat weird combination of flags to determine what to do.  All the calls  * to png_do_strip_filler are changed in 1.5.2 to call this instead with the  * correct arguments.  *  * The routine isn't general - the channel must be the channel at the start or  * end (not in the middle) of each pixel.  */
end_comment
begin_function
name|void
comment|/* PRIVATE */
DECL|function|png_do_strip_channel
name|png_do_strip_channel
parameter_list|(
name|png_row_infop
name|row_info
parameter_list|,
name|png_bytep
name|row
parameter_list|,
name|int
name|at_start
parameter_list|)
block|{
name|png_bytep
name|sp
init|=
name|row
decl_stmt|;
comment|/* source pointer */
name|png_bytep
name|dp
init|=
name|row
decl_stmt|;
comment|/* destination pointer */
name|png_bytep
name|ep
init|=
name|row
operator|+
name|row_info
operator|->
name|rowbytes
decl_stmt|;
comment|/* One beyond end of row */
comment|/* At the start sp will point to the first byte to copy and dp to where     * it is copied to.  ep always points just beyond the end of the row, so     * the loop simply copies (channels-1) channels until sp reaches ep.     *     * at_start:        0 -- convert AG, XG, ARGB, XRGB, AAGG, XXGG, etc.     *            nonzero -- convert GA, GX, RGBA, RGBX, GGAA, RRGGBBXX, etc.     */
comment|/* GA, GX, XG cases */
if|if
condition|(
name|row_info
operator|->
name|channels
operator|==
literal|2
condition|)
block|{
if|if
condition|(
name|row_info
operator|->
name|bit_depth
operator|==
literal|8
condition|)
block|{
if|if
condition|(
name|at_start
operator|!=
literal|0
condition|)
comment|/* Skip initial filler */
operator|++
name|sp
expr_stmt|;
else|else
comment|/* Skip initial channel and, for sp, the filler */
name|sp
operator|+=
literal|2
operator|,
operator|++
name|dp
expr_stmt|;
comment|/* For a 1 pixel wide image there is nothing to do */
while|while
condition|(
name|sp
operator|<
name|ep
condition|)
operator|*
name|dp
operator|++
operator|=
operator|*
name|sp
operator|,
name|sp
operator|+=
literal|2
expr_stmt|;
name|row_info
operator|->
name|pixel_depth
operator|=
literal|8
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|row_info
operator|->
name|bit_depth
operator|==
literal|16
condition|)
block|{
if|if
condition|(
name|at_start
operator|!=
literal|0
condition|)
comment|/* Skip initial filler */
name|sp
operator|+=
literal|2
expr_stmt|;
else|else
comment|/* Skip initial channel and, for sp, the filler */
name|sp
operator|+=
literal|4
operator|,
name|dp
operator|+=
literal|2
expr_stmt|;
while|while
condition|(
name|sp
operator|<
name|ep
condition|)
operator|*
name|dp
operator|++
operator|=
operator|*
name|sp
operator|++
operator|,
operator|*
name|dp
operator|++
operator|=
operator|*
name|sp
operator|,
name|sp
operator|+=
literal|3
expr_stmt|;
name|row_info
operator|->
name|pixel_depth
operator|=
literal|16
expr_stmt|;
block|}
else|else
return|return;
comment|/* bad bit depth */
name|row_info
operator|->
name|channels
operator|=
literal|1
expr_stmt|;
comment|/* Finally fix the color type if it records an alpha channel */
if|if
condition|(
name|row_info
operator|->
name|color_type
operator|==
name|PNG_COLOR_TYPE_GRAY_ALPHA
condition|)
name|row_info
operator|->
name|color_type
operator|=
name|PNG_COLOR_TYPE_GRAY
expr_stmt|;
block|}
comment|/* RGBA, RGBX, XRGB cases */
elseif|else
if|if
condition|(
name|row_info
operator|->
name|channels
operator|==
literal|4
condition|)
block|{
if|if
condition|(
name|row_info
operator|->
name|bit_depth
operator|==
literal|8
condition|)
block|{
if|if
condition|(
name|at_start
operator|!=
literal|0
condition|)
comment|/* Skip initial filler */
operator|++
name|sp
expr_stmt|;
else|else
comment|/* Skip initial channels and, for sp, the filler */
name|sp
operator|+=
literal|4
operator|,
name|dp
operator|+=
literal|3
expr_stmt|;
comment|/* Note that the loop adds 3 to dp and 4 to sp each time. */
while|while
condition|(
name|sp
operator|<
name|ep
condition|)
operator|*
name|dp
operator|++
operator|=
operator|*
name|sp
operator|++
operator|,
operator|*
name|dp
operator|++
operator|=
operator|*
name|sp
operator|++
operator|,
operator|*
name|dp
operator|++
operator|=
operator|*
name|sp
operator|,
name|sp
operator|+=
literal|2
expr_stmt|;
name|row_info
operator|->
name|pixel_depth
operator|=
literal|24
expr_stmt|;
block|}
elseif|else
if|if
condition|(
name|row_info
operator|->
name|bit_depth
operator|==
literal|16
condition|)
block|{
if|if
condition|(
name|at_start
operator|!=
literal|0
condition|)
comment|/* Skip initial filler */
name|sp
operator|+=
literal|2
expr_stmt|;
else|else
comment|/* Skip initial channels and, for sp, the filler */
name|sp
operator|+=
literal|8
operator|,
name|dp
operator|+=
literal|6
expr_stmt|;
while|while
condition|(
name|sp
operator|<
name|ep
condition|)
block|{
comment|/* Copy 6 bytes, skip 2 */
operator|*
name|dp
operator|++
operator|=
operator|*
name|sp
operator|++
operator|,
operator|*
name|dp
operator|++
operator|=
operator|*
name|sp
operator|++
expr_stmt|;
operator|*
name|dp
operator|++
operator|=
operator|*
name|sp
operator|++
operator|,
operator|*
name|dp
operator|++
operator|=
operator|*
name|sp
operator|++
expr_stmt|;
operator|*
name|dp
operator|++
operator|=
operator|*
name|sp
operator|++
operator|,
operator|*
name|dp
operator|++
operator|=
operator|*
name|sp
operator|,
name|sp
operator|+=
literal|3
expr_stmt|;
block|}
name|row_info
operator|->
name|pixel_depth
operator|=
literal|48
expr_stmt|;
block|}
else|else
return|return;
comment|/* bad bit depth */
name|row_info
operator|->
name|channels
operator|=
literal|3
expr_stmt|;
comment|/* Finally fix the color type if it records an alpha channel */
if|if
condition|(
name|row_info
operator|->
name|color_type
operator|==
name|PNG_COLOR_TYPE_RGB_ALPHA
condition|)
name|row_info
operator|->
name|color_type
operator|=
name|PNG_COLOR_TYPE_RGB
expr_stmt|;
block|}
else|else
return|return;
comment|/* The filler channel has gone already */
comment|/* Fix the rowbytes value. */
name|row_info
operator|->
name|rowbytes
operator|=
name|dp
operator|-
name|row
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_BGR_SUPPORTED
argument_list|)
operator|||
name|defined
argument_list|(
name|PNG_WRITE_BGR_SUPPORTED
argument_list|)
end_if
begin_comment
comment|/* Swaps red and blue bytes within a pixel */
end_comment
begin_function
name|void
comment|/* PRIVATE */
DECL|function|png_do_bgr
name|png_do_bgr
parameter_list|(
name|png_row_infop
name|row_info
parameter_list|,
name|png_bytep
name|row
parameter_list|)
block|{
name|png_debug
argument_list|(
literal|1
argument_list|,
literal|"in png_do_bgr"
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|row_info
operator|->
name|color_type
operator|&
name|PNG_COLOR_MASK_COLOR
operator|)
operator|!=
literal|0
condition|)
block|{
name|png_uint_32
name|row_width
init|=
name|row_info
operator|->
name|width
decl_stmt|;
if|if
condition|(
name|row_info
operator|->
name|bit_depth
operator|==
literal|8
condition|)
block|{
if|if
condition|(
name|row_info
operator|->
name|color_type
operator|==
name|PNG_COLOR_TYPE_RGB
condition|)
block|{
name|png_bytep
name|rp
decl_stmt|;
name|png_uint_32
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|rp
operator|=
name|row
init|;
name|i
operator|<
name|row_width
condition|;
name|i
operator|++
operator|,
name|rp
operator|+=
literal|3
control|)
block|{
name|png_byte
name|save
init|=
operator|*
name|rp
decl_stmt|;
operator|*
name|rp
operator|=
operator|*
operator|(
name|rp
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|rp
operator|+
literal|2
operator|)
operator|=
name|save
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|row_info
operator|->
name|color_type
operator|==
name|PNG_COLOR_TYPE_RGB_ALPHA
condition|)
block|{
name|png_bytep
name|rp
decl_stmt|;
name|png_uint_32
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|rp
operator|=
name|row
init|;
name|i
operator|<
name|row_width
condition|;
name|i
operator|++
operator|,
name|rp
operator|+=
literal|4
control|)
block|{
name|png_byte
name|save
init|=
operator|*
name|rp
decl_stmt|;
operator|*
name|rp
operator|=
operator|*
operator|(
name|rp
operator|+
literal|2
operator|)
expr_stmt|;
operator|*
operator|(
name|rp
operator|+
literal|2
operator|)
operator|=
name|save
expr_stmt|;
block|}
block|}
block|}
ifdef|#
directive|ifdef
name|PNG_16BIT_SUPPORTED
elseif|else
if|if
condition|(
name|row_info
operator|->
name|bit_depth
operator|==
literal|16
condition|)
block|{
if|if
condition|(
name|row_info
operator|->
name|color_type
operator|==
name|PNG_COLOR_TYPE_RGB
condition|)
block|{
name|png_bytep
name|rp
decl_stmt|;
name|png_uint_32
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|rp
operator|=
name|row
init|;
name|i
operator|<
name|row_width
condition|;
name|i
operator|++
operator|,
name|rp
operator|+=
literal|6
control|)
block|{
name|png_byte
name|save
init|=
operator|*
name|rp
decl_stmt|;
operator|*
name|rp
operator|=
operator|*
operator|(
name|rp
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|rp
operator|+
literal|4
operator|)
operator|=
name|save
expr_stmt|;
name|save
operator|=
operator|*
operator|(
name|rp
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|rp
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|rp
operator|+
literal|5
operator|)
expr_stmt|;
operator|*
operator|(
name|rp
operator|+
literal|5
operator|)
operator|=
name|save
expr_stmt|;
block|}
block|}
elseif|else
if|if
condition|(
name|row_info
operator|->
name|color_type
operator|==
name|PNG_COLOR_TYPE_RGB_ALPHA
condition|)
block|{
name|png_bytep
name|rp
decl_stmt|;
name|png_uint_32
name|i
decl_stmt|;
for|for
control|(
name|i
operator|=
literal|0
operator|,
name|rp
operator|=
name|row
init|;
name|i
operator|<
name|row_width
condition|;
name|i
operator|++
operator|,
name|rp
operator|+=
literal|8
control|)
block|{
name|png_byte
name|save
init|=
operator|*
name|rp
decl_stmt|;
operator|*
name|rp
operator|=
operator|*
operator|(
name|rp
operator|+
literal|4
operator|)
expr_stmt|;
operator|*
operator|(
name|rp
operator|+
literal|4
operator|)
operator|=
name|save
expr_stmt|;
name|save
operator|=
operator|*
operator|(
name|rp
operator|+
literal|1
operator|)
expr_stmt|;
operator|*
operator|(
name|rp
operator|+
literal|1
operator|)
operator|=
operator|*
operator|(
name|rp
operator|+
literal|5
operator|)
expr_stmt|;
operator|*
operator|(
name|rp
operator|+
literal|5
operator|)
operator|=
name|save
expr_stmt|;
block|}
block|}
block|}
endif|#
directive|endif
block|}
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* READ_BGR || WRITE_BGR */
end_comment
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_CHECK_FOR_INVALID_INDEX_SUPPORTED
argument_list|)
operator|||
expr|\
name|defined
argument_list|(
name|PNG_WRITE_CHECK_FOR_INVALID_INDEX_SUPPORTED
argument_list|)
end_if
begin_comment
comment|/* Added at libpng-1.5.10 */
end_comment
begin_function
name|void
comment|/* PRIVATE */
DECL|function|png_do_check_palette_indexes
name|png_do_check_palette_indexes
parameter_list|(
name|png_structrp
name|png_ptr
parameter_list|,
name|png_row_infop
name|row_info
parameter_list|)
block|{
if|if
condition|(
name|png_ptr
operator|->
name|num_palette
operator|<
operator|(
literal|1
operator|<<
name|row_info
operator|->
name|bit_depth
operator|)
operator|&&
name|png_ptr
operator|->
name|num_palette
operator|>
literal|0
condition|)
comment|/* num_palette can be 0 in MNG files */
block|{
comment|/* Calculations moved outside switch in an attempt to stop different        * compiler warnings.  'padding' is in *bits* within the last byte, it is        * an 'int' because pixel_depth becomes an 'int' in the expression below,        * and this calculation is used because it avoids warnings that other        * forms produced on either GCC or MSVC.        */
name|int
name|padding
init|=
operator|(
operator|-
name|row_info
operator|->
name|pixel_depth
operator|*
name|row_info
operator|->
name|width
operator|)
operator|&
literal|7
decl_stmt|;
name|png_bytep
name|rp
init|=
name|png_ptr
operator|->
name|row_buf
operator|+
name|row_info
operator|->
name|rowbytes
decl_stmt|;
switch|switch
condition|(
name|row_info
operator|->
name|bit_depth
condition|)
block|{
case|case
literal|1
case|:
block|{
comment|/* in this case, all bytes must be 0 so we don't need              * to unpack the pixels except for the rightmost one.              */
for|for
control|(
init|;
name|rp
operator|>
name|png_ptr
operator|->
name|row_buf
condition|;
name|rp
operator|--
control|)
block|{
if|if
condition|(
operator|*
name|rp
operator|>>
name|padding
operator|!=
literal|0
condition|)
name|png_ptr
operator|->
name|num_palette_max
operator|=
literal|1
expr_stmt|;
name|padding
operator|=
literal|0
expr_stmt|;
block|}
break|break;
block|}
case|case
literal|2
case|:
block|{
for|for
control|(
init|;
name|rp
operator|>
name|png_ptr
operator|->
name|row_buf
condition|;
name|rp
operator|--
control|)
block|{
name|int
name|i
init|=
operator|(
operator|(
operator|*
name|rp
operator|>>
name|padding
operator|)
operator|&
literal|0x03
operator|)
decl_stmt|;
if|if
condition|(
name|i
operator|>
name|png_ptr
operator|->
name|num_palette_max
condition|)
name|png_ptr
operator|->
name|num_palette_max
operator|=
name|i
expr_stmt|;
name|i
operator|=
operator|(
operator|(
operator|(
operator|*
name|rp
operator|>>
name|padding
operator|)
operator|>>
literal|2
operator|)
operator|&
literal|0x03
operator|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|png_ptr
operator|->
name|num_palette_max
condition|)
name|png_ptr
operator|->
name|num_palette_max
operator|=
name|i
expr_stmt|;
name|i
operator|=
operator|(
operator|(
operator|(
operator|*
name|rp
operator|>>
name|padding
operator|)
operator|>>
literal|4
operator|)
operator|&
literal|0x03
operator|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|png_ptr
operator|->
name|num_palette_max
condition|)
name|png_ptr
operator|->
name|num_palette_max
operator|=
name|i
expr_stmt|;
name|i
operator|=
operator|(
operator|(
operator|(
operator|*
name|rp
operator|>>
name|padding
operator|)
operator|>>
literal|6
operator|)
operator|&
literal|0x03
operator|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|png_ptr
operator|->
name|num_palette_max
condition|)
name|png_ptr
operator|->
name|num_palette_max
operator|=
name|i
expr_stmt|;
name|padding
operator|=
literal|0
expr_stmt|;
block|}
break|break;
block|}
case|case
literal|4
case|:
block|{
for|for
control|(
init|;
name|rp
operator|>
name|png_ptr
operator|->
name|row_buf
condition|;
name|rp
operator|--
control|)
block|{
name|int
name|i
init|=
operator|(
operator|(
operator|*
name|rp
operator|>>
name|padding
operator|)
operator|&
literal|0x0f
operator|)
decl_stmt|;
if|if
condition|(
name|i
operator|>
name|png_ptr
operator|->
name|num_palette_max
condition|)
name|png_ptr
operator|->
name|num_palette_max
operator|=
name|i
expr_stmt|;
name|i
operator|=
operator|(
operator|(
operator|(
operator|*
name|rp
operator|>>
name|padding
operator|)
operator|>>
literal|4
operator|)
operator|&
literal|0x0f
operator|)
expr_stmt|;
if|if
condition|(
name|i
operator|>
name|png_ptr
operator|->
name|num_palette_max
condition|)
name|png_ptr
operator|->
name|num_palette_max
operator|=
name|i
expr_stmt|;
name|padding
operator|=
literal|0
expr_stmt|;
block|}
break|break;
block|}
case|case
literal|8
case|:
block|{
for|for
control|(
init|;
name|rp
operator|>
name|png_ptr
operator|->
name|row_buf
condition|;
name|rp
operator|--
control|)
block|{
if|if
condition|(
operator|*
name|rp
operator|>
name|png_ptr
operator|->
name|num_palette_max
condition|)
name|png_ptr
operator|->
name|num_palette_max
operator|=
operator|(
name|int
operator|)
operator|*
name|rp
expr_stmt|;
block|}
break|break;
block|}
default|default:
break|break;
block|}
block|}
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* CHECK_FOR_INVALID_INDEX */
end_comment
begin_if
if|#
directive|if
name|defined
argument_list|(
name|PNG_READ_USER_TRANSFORM_SUPPORTED
argument_list|)
operator|||
expr|\
name|defined
argument_list|(
name|PNG_WRITE_USER_TRANSFORM_SUPPORTED
argument_list|)
end_if
begin_ifdef
ifdef|#
directive|ifdef
name|PNG_USER_TRANSFORM_PTR_SUPPORTED
end_ifdef
begin_function
name|void
name|PNGAPI
DECL|function|png_set_user_transform_info
name|png_set_user_transform_info
parameter_list|(
name|png_structrp
name|png_ptr
parameter_list|,
name|png_voidp
name|user_transform_ptr
parameter_list|,
name|int
name|user_transform_depth
parameter_list|,
name|int
name|user_transform_channels
parameter_list|)
block|{
name|png_debug
argument_list|(
literal|1
argument_list|,
literal|"in png_set_user_transform_info"
argument_list|)
expr_stmt|;
if|if
condition|(
name|png_ptr
operator|==
name|NULL
condition|)
return|return;
ifdef|#
directive|ifdef
name|PNG_READ_USER_TRANSFORM_SUPPORTED
if|if
condition|(
operator|(
name|png_ptr
operator|->
name|mode
operator|&
name|PNG_IS_READ_STRUCT
operator|)
operator|!=
literal|0
operator|&&
operator|(
name|png_ptr
operator|->
name|flags
operator|&
name|PNG_FLAG_ROW_INIT
operator|)
operator|!=
literal|0
condition|)
block|{
name|png_app_error
argument_list|(
name|png_ptr
argument_list|,
literal|"info change after png_start_read_image or png_read_update_info"
argument_list|)
expr_stmt|;
return|return;
block|}
endif|#
directive|endif
name|png_ptr
operator|->
name|user_transform_ptr
operator|=
name|user_transform_ptr
expr_stmt|;
name|png_ptr
operator|->
name|user_transform_depth
operator|=
operator|(
name|png_byte
operator|)
name|user_transform_depth
expr_stmt|;
name|png_ptr
operator|->
name|user_transform_channels
operator|=
operator|(
name|png_byte
operator|)
name|user_transform_channels
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* This function returns a pointer to the user_transform_ptr associated with  * the user transform functions.  The application should free any memory  * associated with this pointer before png_write_destroy and png_read_destroy  * are called.  */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|PNG_USER_TRANSFORM_PTR_SUPPORTED
end_ifdef
begin_function
name|png_voidp
name|PNGAPI
DECL|function|png_get_user_transform_ptr
name|png_get_user_transform_ptr
parameter_list|(
name|png_const_structrp
name|png_ptr
parameter_list|)
block|{
if|if
condition|(
name|png_ptr
operator|==
name|NULL
condition|)
return|return
operator|(
name|NULL
operator|)
return|;
return|return
name|png_ptr
operator|->
name|user_transform_ptr
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_ifdef
ifdef|#
directive|ifdef
name|PNG_USER_TRANSFORM_INFO_SUPPORTED
end_ifdef
begin_function
name|png_uint_32
name|PNGAPI
DECL|function|png_get_current_row_number
name|png_get_current_row_number
parameter_list|(
name|png_const_structrp
name|png_ptr
parameter_list|)
block|{
comment|/* See the comments in png.h - this is the sub-image row when reading an     * interlaced image.     */
if|if
condition|(
name|png_ptr
operator|!=
name|NULL
condition|)
return|return
name|png_ptr
operator|->
name|row_number
return|;
return|return
name|PNG_UINT_32_MAX
return|;
comment|/* help the app not to fail silently */
block|}
end_function
begin_function
name|png_byte
name|PNGAPI
DECL|function|png_get_current_pass_number
name|png_get_current_pass_number
parameter_list|(
name|png_const_structrp
name|png_ptr
parameter_list|)
block|{
if|if
condition|(
name|png_ptr
operator|!=
name|NULL
condition|)
return|return
name|png_ptr
operator|->
name|pass
return|;
return|return
literal|8
return|;
comment|/* invalid */
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* USER_TRANSFORM_INFO */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* READ_USER_TRANSFORM || WRITE_USER_TRANSFORM */
end_comment
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|/* READ || WRITE */
end_comment
end_unit
