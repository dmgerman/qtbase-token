begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2012 Nokia Corporation and/or its subsidiary(-ies). ** Contact: http://www.qt-project.org/ ** ** This file is part of the QtCore module of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL$ ** GNU Lesser General Public License Usage ** This file may be used under the terms of the GNU Lesser General Public ** License version 2.1 as published by the Free Software Foundation and ** appearing in the file LICENSE.LGPL included in the packaging of this ** file. Please review the following information to ensure the GNU Lesser ** General Public License version 2.1 requirements will be met: ** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html. ** ** In addition, as a special exception, Nokia gives you certain additional ** rights. These rights are described in the Nokia Qt LGPL Exception ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package. ** ** GNU General Public License Usage ** Alternatively, this file may be used under the terms of the GNU General ** Public License version 3.0 as published by the Free Software Foundation ** and appearing in the file LICENSE.GPL included in the packaging of this ** file. Please review the following information to ensure the GNU General ** Public License version 3.0 requirements will be met: ** http://www.gnu.org/copyleft/gpl.html. ** ** Other Usage ** Alternatively, this file may be used in accordance with the terms and ** conditions contained in a signed written agreement between you and Nokia. ** ** ** ** ** ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|QATOMIC_MSVC_H
end_ifndef
begin_define
DECL|macro|QATOMIC_MSVC_H
define|#
directive|define
name|QATOMIC_MSVC_H
end_define
begin_include
include|#
directive|include
file|<QtCore/qgenericatomic.h>
end_include
begin_expr_stmt
name|QT_BEGIN_HEADER
name|QT_BEGIN_NAMESPACE
if|#
directive|if
literal|0
pragma|#
directive|pragma
name|qt_sync_stop_processing
endif|#
directive|endif
comment|////////////////////////////////////////////////////////////////////////////////////////////////////
ifndef|#
directive|ifndef
name|Q_OS_WINCE
comment|// use compiler intrinsics for all atomic functions
DECL|macro|QT_INTERLOCKED_PREFIX
define|#
directive|define
name|QT_INTERLOCKED_PREFIX
value|_
DECL|macro|QT_INTERLOCKED_PROTOTYPE
define|#
directive|define
name|QT_INTERLOCKED_PROTOTYPE
value|__cdecl
DECL|macro|QT_INTERLOCKED_DECLARE_PROTOTYPES
define|#
directive|define
name|QT_INTERLOCKED_DECLARE_PROTOTYPES
DECL|macro|QT_INTERLOCKED_INTRINSIC
define|#
directive|define
name|QT_INTERLOCKED_INTRINSIC
else|#
directive|else
comment|// Q_OS_WINCE
if|#
directive|if
name|_WIN32_WCE
operator|<
literal|0x600
operator|&&
name|defined
argument_list|(
name|_X86_
argument_list|)
comment|// For X86 Windows CE, include winbase.h to catch inline functions which
comment|// override the regular definitions inside of coredll.dll.
comment|// Though one could use the original version of Increment/Decrement, others are
comment|// not exported at all.
include|#
directive|include
file|<winbase.h>
comment|// It's safer to remove the volatile and let the compiler add it as needed.
define|#
directive|define
name|QT_INTERLOCKED_VOLATILE
else|#
directive|else
comment|// _WIN32_WCE>= 0x600 || !_X86_
define|#
directive|define
name|QT_INTERLOCKED_PROTOTYPE
value|__cdecl
define|#
directive|define
name|QT_INTERLOCKED_DECLARE_PROTOTYPES
if|#
directive|if
name|_WIN32_WCE
operator|>=
literal|0x600
if|#
directive|if
name|defined
argument_list|(
name|_X86_
argument_list|)
define|#
directive|define
name|QT_INTERLOCKED_PREFIX
value|_
define|#
directive|define
name|QT_INTERLOCKED_INTRINSIC
endif|#
directive|endif
else|#
directive|else
define|#
directive|define
name|QT_INTERLOCKED_VOLATILE
endif|#
directive|endif
endif|#
directive|endif
comment|// _WIN32_WCE>= 0x600 || !_X86_
endif|#
directive|endif
comment|// Q_OS_WINCE
comment|////////////////////////////////////////////////////////////////////////////////////////////////////
comment|// Prototype declaration
DECL|macro|QT_INTERLOCKED_CONCAT_I
define|#
directive|define
name|QT_INTERLOCKED_CONCAT_I
parameter_list|(
name|prefix
parameter_list|,
name|suffix
parameter_list|)
define|\
value|prefix ## suffix
DECL|macro|QT_INTERLOCKED_CONCAT
define|#
directive|define
name|QT_INTERLOCKED_CONCAT
parameter_list|(
name|prefix
parameter_list|,
name|suffix
parameter_list|)
define|\
value|QT_INTERLOCKED_CONCAT_I(prefix, suffix)
comment|// MSVC intrinsics prefix function names with an underscore. Also, if platform
comment|// SDK headers have been included, the Interlocked names may be defined as
comment|// macros.
comment|// To avoid double underscores, we paste the prefix with Interlocked first and
comment|// then the remainder of the function name.
DECL|macro|QT_INTERLOCKED_FUNCTION
define|#
directive|define
name|QT_INTERLOCKED_FUNCTION
parameter_list|(
name|name
parameter_list|)
define|\
value|QT_INTERLOCKED_CONCAT( \         QT_INTERLOCKED_CONCAT(QT_INTERLOCKED_PREFIX, Interlocked), name)
ifndef|#
directive|ifndef
name|QT_INTERLOCKED_VOLATILE
DECL|macro|QT_INTERLOCKED_VOLATILE
define|#
directive|define
name|QT_INTERLOCKED_VOLATILE
value|volatile
endif|#
directive|endif
ifndef|#
directive|ifndef
name|QT_INTERLOCKED_PREFIX
DECL|macro|QT_INTERLOCKED_PREFIX
define|#
directive|define
name|QT_INTERLOCKED_PREFIX
endif|#
directive|endif
ifndef|#
directive|ifndef
name|QT_INTERLOCKED_PROTOTYPE
DECL|macro|QT_INTERLOCKED_PROTOTYPE
define|#
directive|define
name|QT_INTERLOCKED_PROTOTYPE
endif|#
directive|endif
ifdef|#
directive|ifdef
name|QT_INTERLOCKED_DECLARE_PROTOTYPES
DECL|macro|QT_INTERLOCKED_DECLARE_PROTOTYPES
undef|#
directive|undef
name|QT_INTERLOCKED_DECLARE_PROTOTYPES
specifier|extern
literal|"C"
block|{
name|long
name|QT_INTERLOCKED_PROTOTYPE
name|QT_INTERLOCKED_FUNCTION
argument_list|(
argument|Increment
argument_list|)
operator|(
name|long
name|QT_INTERLOCKED_VOLATILE
operator|*
operator|)
block|;
name|long
name|QT_INTERLOCKED_PROTOTYPE
name|QT_INTERLOCKED_FUNCTION
argument_list|(
argument|Decrement
argument_list|)
operator|(
name|long
name|QT_INTERLOCKED_VOLATILE
operator|*
operator|)
block|;
name|long
name|QT_INTERLOCKED_PROTOTYPE
name|QT_INTERLOCKED_FUNCTION
argument_list|(
argument|CompareExchange
argument_list|)
operator|(
name|long
name|QT_INTERLOCKED_VOLATILE
operator|*
operator|,
name|long
operator|,
name|long
operator|)
block|;
name|long
name|QT_INTERLOCKED_PROTOTYPE
name|QT_INTERLOCKED_FUNCTION
argument_list|(
argument|Exchange
argument_list|)
operator|(
name|long
name|QT_INTERLOCKED_VOLATILE
operator|*
operator|,
name|long
operator|)
block|;
name|long
name|QT_INTERLOCKED_PROTOTYPE
name|QT_INTERLOCKED_FUNCTION
argument_list|(
argument|ExchangeAdd
argument_list|)
operator|(
name|long
name|QT_INTERLOCKED_VOLATILE
operator|*
operator|,
name|long
operator|)
block|;
if|#
directive|if
operator|!
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|__i386__
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|_M_IX86
argument_list|)
name|void
operator|*
name|QT_INTERLOCKED_FUNCTION
argument_list|(
name|CompareExchangePointer
argument_list|)
argument_list|(
name|void
operator|*
name|QT_INTERLOCKED_VOLATILE
operator|*
argument_list|,
name|void
operator|*
argument_list|,
name|void
operator|*
argument_list|)
block|;
name|void
operator|*
name|QT_INTERLOCKED_FUNCTION
argument_list|(
name|ExchangePointer
argument_list|)
argument_list|(
name|void
operator|*
name|QT_INTERLOCKED_VOLATILE
operator|*
argument_list|,
name|void
operator|*
argument_list|)
block|;
name|__int64
name|QT_INTERLOCKED_FUNCTION
argument_list|(
argument|ExchangeAdd64
argument_list|)
operator|(
name|__int64
name|QT_INTERLOCKED_VOLATILE
operator|*
operator|,
name|__int64
operator|)
block|;
endif|#
directive|endif
block|}
endif|#
directive|endif
comment|// QT_INTERLOCKED_DECLARE_PROTOTYPES
DECL|macro|QT_INTERLOCKED_PROTOTYPE
undef|#
directive|undef
name|QT_INTERLOCKED_PROTOTYPE
comment|////////////////////////////////////////////////////////////////////////////////////////////////////
ifdef|#
directive|ifdef
name|QT_INTERLOCKED_INTRINSIC
DECL|macro|QT_INTERLOCKED_INTRINSIC
undef|#
directive|undef
name|QT_INTERLOCKED_INTRINSIC
pragma|#
directive|pragma
name|intrinsic
name|(
name|_InterlockedIncrement
name|)
pragma|#
directive|pragma
name|intrinsic
name|(
name|_InterlockedDecrement
name|)
pragma|#
directive|pragma
name|intrinsic
name|(
name|_InterlockedExchange
name|)
pragma|#
directive|pragma
name|intrinsic
name|(
name|_InterlockedCompareExchange
name|)
pragma|#
directive|pragma
name|intrinsic
name|(
name|_InterlockedExchangeAdd
name|)
if|#
directive|if
operator|!
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
operator|&&
operator|!
name|defined
argument_list|(
name|_M_IX86
argument_list|)
pragma|#
directive|pragma
name|intrinsic
name|(
name|_InterlockedCompareExchangePointer
name|)
pragma|#
directive|pragma
name|intrinsic
name|(
name|_InterlockedExchangePointer
name|)
pragma|#
directive|pragma
name|intrinsic
name|(
name|_InterlockedExchangeAdd64
name|)
endif|#
directive|endif
endif|#
directive|endif
comment|// QT_INTERLOCKED_INTRINSIC
comment|////////////////////////////////////////////////////////////////////////////////////////////////////
comment|// Interlocked* replacement macros
DECL|macro|QT_INTERLOCKED_INCREMENT
define|#
directive|define
name|QT_INTERLOCKED_INCREMENT
parameter_list|(
name|value
parameter_list|)
define|\
value|QT_INTERLOCKED_FUNCTION(Increment)(value)
DECL|macro|QT_INTERLOCKED_DECREMENT
define|#
directive|define
name|QT_INTERLOCKED_DECREMENT
parameter_list|(
name|value
parameter_list|)
define|\
value|QT_INTERLOCKED_FUNCTION(Decrement)(value)
DECL|macro|QT_INTERLOCKED_COMPARE_EXCHANGE
define|#
directive|define
name|QT_INTERLOCKED_COMPARE_EXCHANGE
parameter_list|(
name|value
parameter_list|,
name|newValue
parameter_list|,
name|expectedValue
parameter_list|)
define|\
value|QT_INTERLOCKED_FUNCTION(CompareExchange)((value), (newValue), (expectedValue))
DECL|macro|QT_INTERLOCKED_EXCHANGE
define|#
directive|define
name|QT_INTERLOCKED_EXCHANGE
parameter_list|(
name|value
parameter_list|,
name|newValue
parameter_list|)
define|\
value|QT_INTERLOCKED_FUNCTION(Exchange)((value), (newValue))
DECL|macro|QT_INTERLOCKED_EXCHANGE_ADD
define|#
directive|define
name|QT_INTERLOCKED_EXCHANGE_ADD
parameter_list|(
name|value
parameter_list|,
name|valueToAdd
parameter_list|)
define|\
value|QT_INTERLOCKED_FUNCTION(ExchangeAdd)((value), (valueToAdd))
if|#
directive|if
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
operator|||
name|defined
argument_list|(
name|__i386__
argument_list|)
operator|||
name|defined
argument_list|(
name|_M_IX86
argument_list|)
DECL|macro|QT_INTERLOCKED_COMPARE_EXCHANGE_POINTER
define|#
directive|define
name|QT_INTERLOCKED_COMPARE_EXCHANGE_POINTER
parameter_list|(
name|value
parameter_list|,
name|newValue
parameter_list|,
name|expectedValue
parameter_list|)
define|\
value|reinterpret_cast<void *>( \         QT_INTERLOCKED_FUNCTION(CompareExchange)( \                 reinterpret_cast<long QT_INTERLOCKED_VOLATILE *>(value), \                 long(newValue), \                 long(expectedValue)))
DECL|macro|QT_INTERLOCKED_EXCHANGE_POINTER
define|#
directive|define
name|QT_INTERLOCKED_EXCHANGE_POINTER
parameter_list|(
name|value
parameter_list|,
name|newValue
parameter_list|)
define|\
value|QT_INTERLOCKED_FUNCTION(Exchange)( \             reinterpret_cast<long QT_INTERLOCKED_VOLATILE *>(value), \             long(newValue))
DECL|macro|QT_INTERLOCKED_EXCHANGE_ADD_POINTER
define|#
directive|define
name|QT_INTERLOCKED_EXCHANGE_ADD_POINTER
parameter_list|(
name|value
parameter_list|,
name|valueToAdd
parameter_list|)
define|\
value|QT_INTERLOCKED_FUNCTION(ExchangeAdd)( \             reinterpret_cast<long QT_INTERLOCKED_VOLATILE *>(value), \             (valueToAdd))
else|#
directive|else
comment|// !defined(Q_OS_WINCE)&& !defined(__i386__)&& !defined(_M_IX86)
DECL|macro|QT_INTERLOCKED_COMPARE_EXCHANGE_POINTER
define|#
directive|define
name|QT_INTERLOCKED_COMPARE_EXCHANGE_POINTER
parameter_list|(
name|value
parameter_list|,
name|newValue
parameter_list|,
name|expectedValue
parameter_list|)
define|\
value|QT_INTERLOCKED_FUNCTION(CompareExchangePointer)( \             (void * QT_INTERLOCKED_VOLATILE *)(value), \             (void *) (newValue), \             (void *) (expectedValue))
DECL|macro|QT_INTERLOCKED_EXCHANGE_POINTER
define|#
directive|define
name|QT_INTERLOCKED_EXCHANGE_POINTER
parameter_list|(
name|value
parameter_list|,
name|newValue
parameter_list|)
define|\
value|QT_INTERLOCKED_FUNCTION(ExchangePointer)( \             (void * QT_INTERLOCKED_VOLATILE *)(value), \             (void *) (newValue))
DECL|macro|QT_INTERLOCKED_EXCHANGE_ADD_POINTER
define|#
directive|define
name|QT_INTERLOCKED_EXCHANGE_ADD_POINTER
parameter_list|(
name|value
parameter_list|,
name|valueToAdd
parameter_list|)
define|\
value|QT_INTERLOCKED_FUNCTION(ExchangeAdd64)( \             reinterpret_cast<qint64 QT_INTERLOCKED_VOLATILE *>(value), \             (valueToAdd))
endif|#
directive|endif
comment|// !defined(Q_OS_WINCE)&& !defined(__i386__)&& !defined(_M_IX86)
comment|////////////////////////////////////////////////////////////////////////////////////////////////////
DECL|macro|Q_ATOMIC_INT_REFERENCE_COUNTING_IS_ALWAYS_NATIVE
define|#
directive|define
name|Q_ATOMIC_INT_REFERENCE_COUNTING_IS_ALWAYS_NATIVE
DECL|macro|Q_ATOMIC_INT_REFERENCE_COUNTING_IS_WAIT_FREE
define|#
directive|define
name|Q_ATOMIC_INT_REFERENCE_COUNTING_IS_WAIT_FREE
DECL|macro|Q_ATOMIC_INT_TEST_AND_SET_IS_ALWAYS_NATIVE
define|#
directive|define
name|Q_ATOMIC_INT_TEST_AND_SET_IS_ALWAYS_NATIVE
DECL|macro|Q_ATOMIC_INT_TEST_AND_SET_IS_WAIT_FREE
define|#
directive|define
name|Q_ATOMIC_INT_TEST_AND_SET_IS_WAIT_FREE
DECL|macro|Q_ATOMIC_INT_FETCH_AND_STORE_IS_ALWAYS_NATIVE
define|#
directive|define
name|Q_ATOMIC_INT_FETCH_AND_STORE_IS_ALWAYS_NATIVE
DECL|macro|Q_ATOMIC_INT_FETCH_AND_STORE_IS_WAIT_FREE
define|#
directive|define
name|Q_ATOMIC_INT_FETCH_AND_STORE_IS_WAIT_FREE
DECL|macro|Q_ATOMIC_INT_FETCH_AND_ADD_IS_ALWAYS_NATIVE
define|#
directive|define
name|Q_ATOMIC_INT_FETCH_AND_ADD_IS_ALWAYS_NATIVE
DECL|macro|Q_ATOMIC_INT_FETCH_AND_ADD_IS_WAIT_FREE
define|#
directive|define
name|Q_ATOMIC_INT_FETCH_AND_ADD_IS_WAIT_FREE
DECL|macro|Q_ATOMIC_INT32_IS_SUPPORTED
define|#
directive|define
name|Q_ATOMIC_INT32_IS_SUPPORTED
DECL|macro|Q_ATOMIC_INT32_REFERENCE_COUNTING_IS_ALWAYS_NATIVE
define|#
directive|define
name|Q_ATOMIC_INT32_REFERENCE_COUNTING_IS_ALWAYS_NATIVE
DECL|macro|Q_ATOMIC_INT32_REFERENCE_COUNTING_IS_WAIT_FREE
define|#
directive|define
name|Q_ATOMIC_INT32_REFERENCE_COUNTING_IS_WAIT_FREE
DECL|macro|Q_ATOMIC_INT32_TEST_AND_SET_IS_ALWAYS_NATIVE
define|#
directive|define
name|Q_ATOMIC_INT32_TEST_AND_SET_IS_ALWAYS_NATIVE
DECL|macro|Q_ATOMIC_INT32_TEST_AND_SET_IS_WAIT_FREE
define|#
directive|define
name|Q_ATOMIC_INT32_TEST_AND_SET_IS_WAIT_FREE
DECL|macro|Q_ATOMIC_INT32_FETCH_AND_STORE_IS_ALWAYS_NATIVE
define|#
directive|define
name|Q_ATOMIC_INT32_FETCH_AND_STORE_IS_ALWAYS_NATIVE
DECL|macro|Q_ATOMIC_INT32_FETCH_AND_STORE_IS_WAIT_FREE
define|#
directive|define
name|Q_ATOMIC_INT32_FETCH_AND_STORE_IS_WAIT_FREE
DECL|macro|Q_ATOMIC_INT32_FETCH_AND_ADD_IS_ALWAYS_NATIVE
define|#
directive|define
name|Q_ATOMIC_INT32_FETCH_AND_ADD_IS_ALWAYS_NATIVE
DECL|macro|Q_ATOMIC_INT32_FETCH_AND_ADD_IS_WAIT_FREE
define|#
directive|define
name|Q_ATOMIC_INT32_FETCH_AND_ADD_IS_WAIT_FREE
DECL|macro|Q_ATOMIC_POINTER_TEST_AND_SET_IS_ALWAYS_NATIVE
define|#
directive|define
name|Q_ATOMIC_POINTER_TEST_AND_SET_IS_ALWAYS_NATIVE
DECL|macro|Q_ATOMIC_POINTER_TEST_AND_SET_IS_WAIT_FREE
define|#
directive|define
name|Q_ATOMIC_POINTER_TEST_AND_SET_IS_WAIT_FREE
DECL|macro|Q_ATOMIC_POINTER_FETCH_AND_STORE_IS_ALWAYS_NATIVE
define|#
directive|define
name|Q_ATOMIC_POINTER_FETCH_AND_STORE_IS_ALWAYS_NATIVE
DECL|macro|Q_ATOMIC_POINTER_FETCH_AND_STORE_IS_WAIT_FREE
define|#
directive|define
name|Q_ATOMIC_POINTER_FETCH_AND_STORE_IS_WAIT_FREE
DECL|macro|Q_ATOMIC_POINTER_FETCH_AND_ADD_IS_ALWAYS_NATIVE
define|#
directive|define
name|Q_ATOMIC_POINTER_FETCH_AND_ADD_IS_ALWAYS_NATIVE
DECL|macro|Q_ATOMIC_POINTER_FETCH_AND_ADD_IS_WAIT_FREE
define|#
directive|define
name|Q_ATOMIC_POINTER_FETCH_AND_ADD_IS_WAIT_FREE
comment|////////////////////////////////////////////////////////////////////////////////////////////////////
name|template
operator|<
operator|>
expr|struct
name|QAtomicIntegerTraits
operator|<
name|int
operator|>
block|{ enum
block|{
name|IsInteger
operator|=
literal|1
block|}
block|; }
expr_stmt|;
end_expr_stmt
begin_expr_stmt
name|template
operator|<
operator|>
expr|struct
name|QAtomicIntegerTraits
operator|<
name|unsigned
name|int
operator|>
block|{ enum
block|{
name|IsInteger
operator|=
literal|1
block|}
block|; }
expr_stmt|;
end_expr_stmt
begin_expr_stmt
name|template
operator|<
operator|>
expr|struct
name|QAtomicIntegerTraits
operator|<
name|long
operator|>
block|{ enum
block|{
name|IsInteger
operator|=
literal|1
block|}
block|; }
expr_stmt|;
end_expr_stmt
begin_expr_stmt
name|template
operator|<
operator|>
expr|struct
name|QAtomicIntegerTraits
operator|<
name|unsigned
name|long
operator|>
block|{ enum
block|{
name|IsInteger
operator|=
literal|1
block|}
block|; }
expr_stmt|;
end_expr_stmt
begin_comment
comment|// No definition, needs specialization
end_comment
begin_expr_stmt
name|template
operator|<
name|int
name|N
operator|>
expr|struct
name|QAtomicOpsBySize
expr_stmt|;
end_expr_stmt
begin_expr_stmt
name|template
operator|<
operator|>
expr|struct
DECL|struct|QAtomicOpsBySize
name|QAtomicOpsBySize
operator|<
literal|4
operator|>
operator|:
name|QGenericAtomicOps
operator|<
name|QAtomicOpsBySize
operator|<
literal|4
operator|>
expr|>
block|{
comment|// The 32-bit Interlocked*() API takes paramters as longs.
DECL|typedef|Type
typedef|typedef
name|long
name|Type
typedef|;
DECL|function|isReferenceCountingNative
specifier|static
specifier|inline
name|bool
name|isReferenceCountingNative
argument_list|()
block|{
return|return
name|true
return|;
block|}
DECL|function|isReferenceCountingWaitFree
specifier|static
specifier|inline
name|bool
name|isReferenceCountingWaitFree
argument_list|()
block|{
return|return
name|true
return|;
block|}
specifier|static
name|bool
name|ref
argument_list|(
name|long
operator|&
name|_q_value
argument_list|)
expr_stmt|;
end_expr_stmt
begin_function_decl
specifier|static
name|bool
name|deref
parameter_list|(
name|long
modifier|&
name|_q_value
parameter_list|)
function_decl|;
end_function_decl
begin_function
DECL|function|isTestAndSetNative
specifier|static
specifier|inline
name|bool
name|isTestAndSetNative
parameter_list|()
block|{
return|return
name|true
return|;
block|}
end_function
begin_function
DECL|function|isTestAndSetWaitFree
specifier|static
specifier|inline
name|bool
name|isTestAndSetWaitFree
parameter_list|()
block|{
return|return
name|true
return|;
block|}
end_function
begin_function_decl
specifier|static
name|bool
name|testAndSetRelaxed
parameter_list|(
name|long
modifier|&
name|_q_value
parameter_list|,
name|long
name|expectedValue
parameter_list|,
name|long
name|newValue
parameter_list|)
function_decl|;
end_function_decl
begin_function
DECL|function|isFetchAndStoreNative
specifier|static
specifier|inline
name|bool
name|isFetchAndStoreNative
parameter_list|()
block|{
return|return
name|true
return|;
block|}
end_function
begin_function
DECL|function|isFetchAndStoreWaitFree
specifier|static
specifier|inline
name|bool
name|isFetchAndStoreWaitFree
parameter_list|()
block|{
return|return
name|true
return|;
block|}
end_function
begin_function_decl
specifier|static
name|long
name|fetchAndStoreRelaxed
parameter_list|(
name|long
modifier|&
name|_q_value
parameter_list|,
name|long
name|newValue
parameter_list|)
function_decl|;
end_function_decl
begin_function
DECL|function|isFetchAndAddNative
specifier|static
specifier|inline
name|bool
name|isFetchAndAddNative
parameter_list|()
block|{
return|return
name|true
return|;
block|}
end_function
begin_function
DECL|function|isFetchAndAddWaitFree
specifier|static
specifier|inline
name|bool
name|isFetchAndAddWaitFree
parameter_list|()
block|{
return|return
name|true
return|;
block|}
end_function
begin_decl_stmt
specifier|static
name|long
name|fetchAndAddRelaxed
argument_list|(
name|long
operator|&
name|_q_value
argument_list|,
name|QAtomicAdditiveType
operator|<
name|long
operator|>
operator|::
name|AdditiveT
name|valueToAdd
argument_list|)
decl_stmt|;
end_decl_stmt
begin_expr_stmt
unit|};
name|template
operator|<
name|typename
name|T
operator|>
expr|struct
DECL|function|sizeof
name|QAtomicOps
operator|:
name|QAtomicOpsBySize
operator|<
sizeof|sizeof
argument_list|(
name|T
argument_list|)
operator|>
block|{ }
expr_stmt|;
end_expr_stmt
begin_expr_stmt
DECL|function|ref
specifier|inline
name|bool
name|QAtomicOpsBySize
operator|<
literal|4
operator|>
operator|::
name|ref
argument_list|(
argument|long&_q_value
argument_list|)
block|{
return|return
name|QT_INTERLOCKED_INCREMENT
argument_list|(
operator|&
name|_q_value
argument_list|)
operator|!=
literal|0
return|;
block|}
end_expr_stmt
begin_expr_stmt
DECL|function|deref
specifier|inline
name|bool
name|QAtomicOpsBySize
operator|<
literal|4
operator|>
operator|::
name|deref
argument_list|(
argument|long&_q_value
argument_list|)
block|{
return|return
name|QT_INTERLOCKED_DECREMENT
argument_list|(
operator|&
name|_q_value
argument_list|)
operator|!=
literal|0
return|;
block|}
end_expr_stmt
begin_expr_stmt
DECL|function|testAndSetRelaxed
specifier|inline
name|bool
name|QAtomicOpsBySize
operator|<
literal|4
operator|>
operator|::
name|testAndSetRelaxed
argument_list|(
argument|long&_q_value
argument_list|,
argument|long expectedValue
argument_list|,
argument|long newValue
argument_list|)
block|{
return|return
name|QT_INTERLOCKED_COMPARE_EXCHANGE
argument_list|(
operator|&
name|_q_value
argument_list|,
name|newValue
argument_list|,
name|expectedValue
argument_list|)
operator|==
name|expectedValue
return|;
block|}
end_expr_stmt
begin_expr_stmt
DECL|function|fetchAndStoreRelaxed
specifier|inline
name|long
name|QAtomicOpsBySize
operator|<
literal|4
operator|>
operator|::
name|fetchAndStoreRelaxed
argument_list|(
argument|long&_q_value
argument_list|,
argument|long newValue
argument_list|)
block|{
return|return
name|QT_INTERLOCKED_EXCHANGE
argument_list|(
operator|&
name|_q_value
argument_list|,
name|newValue
argument_list|)
return|;
block|}
end_expr_stmt
begin_expr_stmt
DECL|function|fetchAndAddRelaxed
specifier|inline
name|long
name|QAtomicOpsBySize
operator|<
literal|4
operator|>
operator|::
name|fetchAndAddRelaxed
argument_list|(
argument|long&_q_value
argument_list|,
argument|QAtomicAdditiveType<long>::AdditiveT valueToAdd
argument_list|)
block|{
return|return
name|QT_INTERLOCKED_EXCHANGE_ADD
argument_list|(
operator|&
name|_q_value
argument_list|,
name|valueToAdd
operator|*
name|QAtomicAdditiveType
operator|<
name|long
operator|>
operator|::
name|AddScale
argument_list|)
return|;
block|}
end_expr_stmt
begin_comment
comment|// Specialization for pointer types, since we have Interlocked*Pointer() variants in some configurations
end_comment
begin_expr_stmt
name|template
operator|<
name|typename
name|T
operator|>
expr|struct
DECL|struct|T
name|QAtomicOps
operator|<
name|T
operator|*
operator|>
operator|:
name|QGenericAtomicOps
operator|<
name|QAtomicOps
operator|<
name|T
operator|*
operator|>
expr|>
block|{
DECL|typedef|Type
typedef|typedef
name|T
modifier|*
name|Type
typedef|;
DECL|function|isTestAndSetNative
specifier|static
specifier|inline
name|bool
name|isTestAndSetNative
argument_list|()
block|{
return|return
name|true
return|;
block|}
DECL|function|isTestAndSetWaitFree
specifier|static
specifier|inline
name|bool
name|isTestAndSetWaitFree
argument_list|()
block|{
return|return
name|true
return|;
block|}
specifier|static
name|bool
name|testAndSetRelaxed
argument_list|(
name|T
operator|*
operator|&
name|_q_value
argument_list|,
name|T
operator|*
name|expectedValue
argument_list|,
name|T
operator|*
name|newValue
argument_list|)
expr_stmt|;
end_expr_stmt
begin_function
DECL|function|isFetchAndStoreNative
specifier|static
specifier|inline
name|bool
name|isFetchAndStoreNative
parameter_list|()
block|{
return|return
name|true
return|;
block|}
end_function
begin_function
DECL|function|isFetchAndStoreWaitFree
specifier|static
specifier|inline
name|bool
name|isFetchAndStoreWaitFree
parameter_list|()
block|{
return|return
name|true
return|;
block|}
end_function
begin_function_decl
specifier|static
name|T
modifier|*
name|fetchAndStoreRelaxed
parameter_list|(
name|T
modifier|*
modifier|&
name|_q_value
parameter_list|,
name|T
modifier|*
name|newValue
parameter_list|)
function_decl|;
end_function_decl
begin_function
DECL|function|isFetchAndAddNative
specifier|static
specifier|inline
name|bool
name|isFetchAndAddNative
parameter_list|()
block|{
return|return
name|true
return|;
block|}
end_function
begin_function
DECL|function|isFetchAndAddWaitFree
specifier|static
specifier|inline
name|bool
name|isFetchAndAddWaitFree
parameter_list|()
block|{
return|return
name|true
return|;
block|}
end_function
begin_function_decl
specifier|static
name|T
modifier|*
name|fetchAndAddRelaxed
parameter_list|(
name|T
modifier|*
modifier|&
name|_q_value
parameter_list|,
name|qptrdiff
name|valueToAdd
parameter_list|)
function_decl|;
end_function_decl
begin_expr_stmt
unit|};
name|template
operator|<
name|typename
name|T
operator|>
DECL|function|testAndSetRelaxed
specifier|inline
name|bool
name|QAtomicOps
operator|<
name|T
operator|*
operator|>
operator|::
name|testAndSetRelaxed
argument_list|(
argument|T *&_q_value
argument_list|,
argument|T *expectedValue
argument_list|,
argument|T *newValue
argument_list|)
block|{
return|return
name|QT_INTERLOCKED_COMPARE_EXCHANGE_POINTER
argument_list|(
operator|&
name|_q_value
argument_list|,
name|newValue
argument_list|,
name|expectedValue
argument_list|)
operator|==
name|expectedValue
return|;
block|}
end_expr_stmt
begin_expr_stmt
name|template
operator|<
name|typename
name|T
operator|>
DECL|function|fetchAndStoreRelaxed
specifier|inline
name|T
operator|*
name|QAtomicOps
operator|<
name|T
operator|*
operator|>
operator|::
name|fetchAndStoreRelaxed
argument_list|(
argument|T *&_q_value
argument_list|,
argument|T *newValue
argument_list|)
block|{
return|return
name|reinterpret_cast
operator|<
name|T
operator|*
operator|>
operator|(
name|QT_INTERLOCKED_EXCHANGE_POINTER
argument_list|(
operator|&
name|_q_value
argument_list|,
name|newValue
argument_list|)
operator|)
return|;
block|}
end_expr_stmt
begin_expr_stmt
name|template
operator|<
name|typename
name|T
operator|>
DECL|function|fetchAndAddRelaxed
specifier|inline
name|T
operator|*
name|QAtomicOps
operator|<
name|T
operator|*
operator|>
operator|::
name|fetchAndAddRelaxed
argument_list|(
argument|T *&_q_value
argument_list|,
argument|qptrdiff valueToAdd
argument_list|)
block|{
return|return
name|reinterpret_cast
operator|<
name|T
operator|*
operator|>
operator|(
name|QT_INTERLOCKED_EXCHANGE_ADD_POINTER
argument_list|(
operator|&
name|_q_value
argument_list|,
name|valueToAdd
operator|*
sizeof|sizeof
argument_list|(
name|T
argument_list|)
argument_list|)
operator|)
return|;
block|}
end_expr_stmt
begin_comment
comment|////////////////////////////////////////////////////////////////////////////////////////////////////
end_comment
begin_comment
comment|// Cleanup
end_comment
begin_undef
DECL|macro|QT_INTERLOCKED_CONCAT_I
undef|#
directive|undef
name|QT_INTERLOCKED_CONCAT_I
end_undef
begin_undef
DECL|macro|QT_INTERLOCKED_CONCAT
undef|#
directive|undef
name|QT_INTERLOCKED_CONCAT
end_undef
begin_undef
DECL|macro|QT_INTERLOCKED_FUNCTION
undef|#
directive|undef
name|QT_INTERLOCKED_FUNCTION
end_undef
begin_undef
DECL|macro|QT_INTERLOCKED_PREFIX
undef|#
directive|undef
name|QT_INTERLOCKED_PREFIX
end_undef
begin_undef
DECL|macro|QT_INTERLOCKED_VOLATILE
undef|#
directive|undef
name|QT_INTERLOCKED_VOLATILE
end_undef
begin_undef
DECL|macro|QT_INTERLOCKED_INCREMENT
undef|#
directive|undef
name|QT_INTERLOCKED_INCREMENT
end_undef
begin_undef
DECL|macro|QT_INTERLOCKED_DECREMENT
undef|#
directive|undef
name|QT_INTERLOCKED_DECREMENT
end_undef
begin_undef
DECL|macro|QT_INTERLOCKED_COMPARE_EXCHANGE
undef|#
directive|undef
name|QT_INTERLOCKED_COMPARE_EXCHANGE
end_undef
begin_undef
DECL|macro|QT_INTERLOCKED_EXCHANGE
undef|#
directive|undef
name|QT_INTERLOCKED_EXCHANGE
end_undef
begin_undef
DECL|macro|QT_INTERLOCKED_EXCHANGE_ADD
undef|#
directive|undef
name|QT_INTERLOCKED_EXCHANGE_ADD
end_undef
begin_undef
DECL|macro|QT_INTERLOCKED_COMPARE_EXCHANGE_POINTER
undef|#
directive|undef
name|QT_INTERLOCKED_COMPARE_EXCHANGE_POINTER
end_undef
begin_undef
DECL|macro|QT_INTERLOCKED_EXCHANGE_POINTER
undef|#
directive|undef
name|QT_INTERLOCKED_EXCHANGE_POINTER
end_undef
begin_undef
DECL|macro|QT_INTERLOCKED_EXCHANGE_ADD_POINTER
undef|#
directive|undef
name|QT_INTERLOCKED_EXCHANGE_ADD_POINTER
end_undef
begin_expr_stmt
name|QT_END_NAMESPACE
name|QT_END_HEADER
end_expr_stmt
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|// QATOMIC_MSVC_H
end_comment
end_unit
