begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2015 The Qt Company Ltd. ** Contact: http://www.qt.io/licensing/ ** ** This file is part of the plugins of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL3$ ** Commercial License Usage ** Licensees holding valid commercial Qt licenses may use this file in ** accordance with the commercial license agreement provided with the ** Software or, alternatively, in accordance with the terms contained in ** a written agreement between you and The Qt Company. For licensing terms ** and conditions see http://www.qt.io/terms-conditions. For further ** information use the contact form at http://www.qt.io/contact-us. ** ** GNU Lesser General Public License Usage ** Alternatively, this file may be used under the terms of the GNU Lesser ** General Public License version 3 as published by the Free Software ** Foundation and appearing in the file LICENSE.LGPLv3 included in the ** packaging of this file. Please review the following information to ** ensure the GNU Lesser General Public License version 3 requirements ** will be met: https://www.gnu.org/licenses/lgpl.html. ** ** GNU General Public License Usage ** Alternatively, this file may be used under the terms of the GNU ** General Public License version 2.0 or later as published by the Free ** Software Foundation and appearing in the file LICENSE.GPL included in ** the packaging of this file. Please review the following information to ** ensure the GNU General Public License version 2.0 requirements will be ** met: http://www.gnu.org/licenses/gpl-2.0.html. ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_include
include|#
directive|include
file|"qwinrtscreen.h"
end_include
begin_include
include|#
directive|include
file|"qwinrtbackingstore.h"
end_include
begin_include
include|#
directive|include
file|"qwinrtinputcontext.h"
end_include
begin_include
include|#
directive|include
file|"qwinrtcursor.h"
end_include
begin_include
include|#
directive|include
file|<private/qeventdispatcher_winrt_p.h>
end_include
begin_include
include|#
directive|include
file|<QtGui/QSurfaceFormat>
end_include
begin_include
include|#
directive|include
file|<QtGui/QGuiApplication>
end_include
begin_include
include|#
directive|include
file|<qpa/qwindowsysteminterface.h>
end_include
begin_include
include|#
directive|include
file|<QtCore/qt_windows.h>
end_include
begin_include
include|#
directive|include
file|<QtCore/qfunctions_winrt.h>
end_include
begin_include
include|#
directive|include
file|<functional>
end_include
begin_include
include|#
directive|include
file|<wrl.h>
end_include
begin_include
include|#
directive|include
file|<windows.system.h>
end_include
begin_include
include|#
directive|include
file|<Windows.Applicationmodel.h>
end_include
begin_include
include|#
directive|include
file|<Windows.ApplicationModel.core.h>
end_include
begin_include
include|#
directive|include
file|<windows.devices.input.h>
end_include
begin_include
include|#
directive|include
file|<windows.ui.h>
end_include
begin_include
include|#
directive|include
file|<windows.ui.core.h>
end_include
begin_include
include|#
directive|include
file|<windows.ui.input.h>
end_include
begin_include
include|#
directive|include
file|<windows.ui.xaml.h>
end_include
begin_include
include|#
directive|include
file|<windows.ui.viewmanagement.h>
end_include
begin_include
include|#
directive|include
file|<windows.graphics.display.h>
end_include
begin_include
include|#
directive|include
file|<windows.foundation.h>
end_include
begin_using
using|using
namespace|namespace
name|Microsoft
operator|::
name|WRL
namespace|;
end_using
begin_using
using|using
namespace|namespace
name|Microsoft
operator|::
name|WRL
operator|::
name|Wrappers
namespace|;
end_using
begin_using
using|using
namespace|namespace
name|ABI
operator|::
name|Windows
operator|::
name|ApplicationModel
namespace|;
end_using
begin_using
using|using
namespace|namespace
name|ABI
operator|::
name|Windows
operator|::
name|ApplicationModel
operator|::
name|Core
namespace|;
end_using
begin_using
using|using
namespace|namespace
name|ABI
operator|::
name|Windows
operator|::
name|Foundation
namespace|;
end_using
begin_using
using|using
namespace|namespace
name|ABI
operator|::
name|Windows
operator|::
name|System
namespace|;
end_using
begin_using
using|using
namespace|namespace
name|ABI
operator|::
name|Windows
operator|::
name|UI
namespace|;
end_using
begin_using
using|using
namespace|namespace
name|ABI
operator|::
name|Windows
operator|::
name|UI
operator|::
name|Core
namespace|;
end_using
begin_using
using|using
namespace|namespace
name|ABI
operator|::
name|Windows
operator|::
name|UI
operator|::
name|Input
namespace|;
end_using
begin_using
using|using
namespace|namespace
name|ABI
operator|::
name|Windows
operator|::
name|UI
operator|::
name|ViewManagement
namespace|;
end_using
begin_using
using|using
namespace|namespace
name|ABI
operator|::
name|Windows
operator|::
name|Devices
operator|::
name|Input
namespace|;
end_using
begin_using
using|using
namespace|namespace
name|ABI
operator|::
name|Windows
operator|::
name|Graphics
operator|::
name|Display
namespace|;
end_using
begin_typedef
DECL|typedef|ActivatedHandler
typedef|typedef
name|ITypedEventHandler
argument_list|<
name|CoreWindow
modifier|*
argument_list|,
name|WindowActivatedEventArgs
modifier|*
argument_list|>
name|ActivatedHandler
typedef|;
end_typedef
begin_typedef
DECL|typedef|ClosedHandler
typedef|typedef
name|ITypedEventHandler
argument_list|<
name|CoreWindow
modifier|*
argument_list|,
name|CoreWindowEventArgs
modifier|*
argument_list|>
name|ClosedHandler
typedef|;
end_typedef
begin_typedef
DECL|typedef|CharacterReceivedHandler
typedef|typedef
name|ITypedEventHandler
argument_list|<
name|CoreWindow
modifier|*
argument_list|,
name|CharacterReceivedEventArgs
modifier|*
argument_list|>
name|CharacterReceivedHandler
typedef|;
end_typedef
begin_typedef
DECL|typedef|InputEnabledHandler
typedef|typedef
name|ITypedEventHandler
argument_list|<
name|CoreWindow
modifier|*
argument_list|,
name|InputEnabledEventArgs
modifier|*
argument_list|>
name|InputEnabledHandler
typedef|;
end_typedef
begin_typedef
DECL|typedef|KeyHandler
typedef|typedef
name|ITypedEventHandler
argument_list|<
name|CoreWindow
modifier|*
argument_list|,
name|KeyEventArgs
modifier|*
argument_list|>
name|KeyHandler
typedef|;
end_typedef
begin_typedef
DECL|typedef|PointerHandler
typedef|typedef
name|ITypedEventHandler
argument_list|<
name|CoreWindow
modifier|*
argument_list|,
name|PointerEventArgs
modifier|*
argument_list|>
name|PointerHandler
typedef|;
end_typedef
begin_typedef
DECL|typedef|SizeChangedHandler
typedef|typedef
name|ITypedEventHandler
argument_list|<
name|CoreWindow
modifier|*
argument_list|,
name|WindowSizeChangedEventArgs
modifier|*
argument_list|>
name|SizeChangedHandler
typedef|;
end_typedef
begin_typedef
DECL|typedef|VisibilityChangedHandler
typedef|typedef
name|ITypedEventHandler
argument_list|<
name|CoreWindow
modifier|*
argument_list|,
name|VisibilityChangedEventArgs
modifier|*
argument_list|>
name|VisibilityChangedHandler
typedef|;
end_typedef
begin_typedef
DECL|typedef|DisplayInformationHandler
typedef|typedef
name|ITypedEventHandler
argument_list|<
name|DisplayInformation
modifier|*
argument_list|,
name|IInspectable
modifier|*
argument_list|>
name|DisplayInformationHandler
typedef|;
end_typedef
begin_ifdef
ifdef|#
directive|ifdef
name|Q_OS_WINPHONE
end_ifdef
begin_typedef
DECL|typedef|StatusBarHandler
typedef|typedef
name|ITypedEventHandler
argument_list|<
name|StatusBar
modifier|*
argument_list|,
name|IInspectable
modifier|*
argument_list|>
name|StatusBarHandler
typedef|;
end_typedef
begin_endif
endif|#
directive|endif
end_endif
begin_macro
name|QT_BEGIN_NAMESPACE
end_macro
begin_struct
DECL|struct|KeyInfo
struct|struct
name|KeyInfo
block|{
DECL|function|KeyInfo
name|KeyInfo
parameter_list|()
member_init_list|:
name|virtualKey
argument_list|(
literal|0
argument_list|)
block|{     }
DECL|function|KeyInfo
name|KeyInfo
parameter_list|(
specifier|const
name|QString
modifier|&
name|text
parameter_list|,
name|quint32
name|virtualKey
parameter_list|)
member_init_list|:
name|text
argument_list|(
name|text
argument_list|)
member_init_list|,
name|virtualKey
argument_list|(
name|virtualKey
argument_list|)
block|{     }
DECL|function|KeyInfo
name|KeyInfo
parameter_list|(
name|quint32
name|virtualKey
parameter_list|)
member_init_list|:
name|virtualKey
argument_list|(
name|virtualKey
argument_list|)
block|{     }
DECL|member|text
name|QString
name|text
decl_stmt|;
DECL|member|virtualKey
name|quint32
name|virtualKey
decl_stmt|;
block|}
struct|;
end_struct
begin_function
DECL|function|qtOrientationsFromNative
specifier|static
specifier|inline
name|Qt
operator|::
name|ScreenOrientations
name|qtOrientationsFromNative
parameter_list|(
name|DisplayOrientations
name|native
parameter_list|)
block|{
name|Qt
operator|::
name|ScreenOrientations
name|orientations
init|=
name|Qt
operator|::
name|PrimaryOrientation
decl_stmt|;
if|if
condition|(
name|native
operator|&
name|DisplayOrientations_Portrait
condition|)
name|orientations
operator||=
name|Qt
operator|::
name|PortraitOrientation
expr_stmt|;
if|if
condition|(
name|native
operator|&
name|DisplayOrientations_PortraitFlipped
condition|)
name|orientations
operator||=
name|Qt
operator|::
name|InvertedPortraitOrientation
expr_stmt|;
if|if
condition|(
name|native
operator|&
name|DisplayOrientations_Landscape
condition|)
name|orientations
operator||=
name|Qt
operator|::
name|LandscapeOrientation
expr_stmt|;
if|if
condition|(
name|native
operator|&
name|DisplayOrientations_LandscapeFlipped
condition|)
name|orientations
operator||=
name|Qt
operator|::
name|InvertedLandscapeOrientation
expr_stmt|;
return|return
name|orientations
return|;
block|}
end_function
begin_function
DECL|function|nativeOrientationsFromQt
specifier|static
specifier|inline
name|DisplayOrientations
name|nativeOrientationsFromQt
parameter_list|(
name|Qt
operator|::
name|ScreenOrientations
name|orientation
parameter_list|)
block|{
name|DisplayOrientations
name|native
init|=
name|DisplayOrientations_None
decl_stmt|;
if|if
condition|(
name|orientation
operator|&
name|Qt
operator|::
name|PortraitOrientation
condition|)
name|native
operator||=
name|DisplayOrientations_Portrait
expr_stmt|;
if|if
condition|(
name|orientation
operator|&
name|Qt
operator|::
name|InvertedPortraitOrientation
condition|)
name|native
operator||=
name|DisplayOrientations_PortraitFlipped
expr_stmt|;
if|if
condition|(
name|orientation
operator|&
name|Qt
operator|::
name|LandscapeOrientation
condition|)
name|native
operator||=
name|DisplayOrientations_Landscape
expr_stmt|;
if|if
condition|(
name|orientation
operator|&
name|Qt
operator|::
name|InvertedLandscapeOrientation
condition|)
name|native
operator||=
name|DisplayOrientations_LandscapeFlipped
expr_stmt|;
return|return
name|native
return|;
block|}
end_function
begin_function
DECL|function|qIsNonPrintable
specifier|static
specifier|inline
name|bool
name|qIsNonPrintable
parameter_list|(
name|quint32
name|keyCode
parameter_list|)
block|{
switch|switch
condition|(
name|keyCode
condition|)
block|{
case|case
literal|'\b'
case|:
case|case
literal|'\n'
case|:
case|case
literal|'\t'
case|:
case|case
literal|'\r'
case|:
case|case
literal|'\v'
case|:
case|case
literal|'\f'
case|:
return|return
literal|true
return|;
default|default:
return|return
literal|false
return|;
block|}
block|}
end_function
begin_comment
comment|// Return Qt meta key from VirtualKey
end_comment
begin_function
DECL|function|qKeyFromVirtual
specifier|static
specifier|inline
name|Qt
operator|::
name|Key
name|qKeyFromVirtual
parameter_list|(
name|VirtualKey
name|key
parameter_list|)
block|{
switch|switch
condition|(
name|key
condition|)
block|{
default|default:
return|return
name|Qt
operator|::
name|Key_unknown
return|;
comment|// Non-printable characters
case|case
name|VirtualKey_Enter
case|:
return|return
name|Qt
operator|::
name|Key_Enter
return|;
case|case
name|VirtualKey_Tab
case|:
return|return
name|Qt
operator|::
name|Key_Tab
return|;
case|case
name|VirtualKey_Back
case|:
return|return
name|Qt
operator|::
name|Key_Backspace
return|;
comment|// Modifiers
case|case
name|VirtualKey_Shift
case|:
case|case
name|VirtualKey_LeftShift
case|:
case|case
name|VirtualKey_RightShift
case|:
return|return
name|Qt
operator|::
name|Key_Shift
return|;
case|case
name|VirtualKey_Control
case|:
case|case
name|VirtualKey_LeftControl
case|:
case|case
name|VirtualKey_RightControl
case|:
return|return
name|Qt
operator|::
name|Key_Control
return|;
case|case
name|VirtualKey_Menu
case|:
case|case
name|VirtualKey_LeftMenu
case|:
case|case
name|VirtualKey_RightMenu
case|:
return|return
name|Qt
operator|::
name|Key_Alt
return|;
case|case
name|VirtualKey_LeftWindows
case|:
case|case
name|VirtualKey_RightWindows
case|:
return|return
name|Qt
operator|::
name|Key_Meta
return|;
comment|// Toggle keys
case|case
name|VirtualKey_CapitalLock
case|:
return|return
name|Qt
operator|::
name|Key_CapsLock
return|;
case|case
name|VirtualKey_NumberKeyLock
case|:
return|return
name|Qt
operator|::
name|Key_NumLock
return|;
case|case
name|VirtualKey_Scroll
case|:
return|return
name|Qt
operator|::
name|Key_ScrollLock
return|;
comment|// East-Asian language keys
case|case
name|VirtualKey_Kana
case|:
comment|//case VirtualKey_Hangul: // Same enum as Kana
return|return
name|Qt
operator|::
name|Key_Kana_Shift
return|;
case|case
name|VirtualKey_Junja
case|:
return|return
name|Qt
operator|::
name|Key_Hangul_Jeonja
return|;
case|case
name|VirtualKey_Kanji
case|:
comment|//case VirtualKey_Hanja: // Same enum as Kanji
return|return
name|Qt
operator|::
name|Key_Kanji
return|;
case|case
name|VirtualKey_ModeChange
case|:
return|return
name|Qt
operator|::
name|Key_Mode_switch
return|;
case|case
name|VirtualKey_Convert
case|:
return|return
name|Qt
operator|::
name|Key_Henkan
return|;
case|case
name|VirtualKey_NonConvert
case|:
return|return
name|Qt
operator|::
name|Key_Muhenkan
return|;
comment|// Misc. keys
case|case
name|VirtualKey_Cancel
case|:
return|return
name|Qt
operator|::
name|Key_Cancel
return|;
case|case
name|VirtualKey_Clear
case|:
return|return
name|Qt
operator|::
name|Key_Clear
return|;
case|case
name|VirtualKey_Application
case|:
return|return
name|Qt
operator|::
name|Key_ApplicationLeft
return|;
case|case
name|VirtualKey_Sleep
case|:
return|return
name|Qt
operator|::
name|Key_Sleep
return|;
case|case
name|VirtualKey_Pause
case|:
return|return
name|Qt
operator|::
name|Key_Pause
return|;
case|case
name|VirtualKey_PageUp
case|:
return|return
name|Qt
operator|::
name|Key_PageUp
return|;
case|case
name|VirtualKey_PageDown
case|:
return|return
name|Qt
operator|::
name|Key_PageDown
return|;
case|case
name|VirtualKey_End
case|:
return|return
name|Qt
operator|::
name|Key_End
return|;
case|case
name|VirtualKey_Home
case|:
return|return
name|Qt
operator|::
name|Key_Home
return|;
case|case
name|VirtualKey_Left
case|:
return|return
name|Qt
operator|::
name|Key_Left
return|;
case|case
name|VirtualKey_Up
case|:
return|return
name|Qt
operator|::
name|Key_Up
return|;
case|case
name|VirtualKey_Right
case|:
return|return
name|Qt
operator|::
name|Key_Right
return|;
case|case
name|VirtualKey_Down
case|:
return|return
name|Qt
operator|::
name|Key_Down
return|;
case|case
name|VirtualKey_Select
case|:
return|return
name|Qt
operator|::
name|Key_Select
return|;
case|case
name|VirtualKey_Print
case|:
return|return
name|Qt
operator|::
name|Key_Print
return|;
case|case
name|VirtualKey_Execute
case|:
return|return
name|Qt
operator|::
name|Key_Execute
return|;
case|case
name|VirtualKey_Insert
case|:
return|return
name|Qt
operator|::
name|Key_Insert
return|;
case|case
name|VirtualKey_Delete
case|:
return|return
name|Qt
operator|::
name|Key_Delete
return|;
case|case
name|VirtualKey_Help
case|:
return|return
name|Qt
operator|::
name|Key_Help
return|;
case|case
name|VirtualKey_Snapshot
case|:
return|return
name|Qt
operator|::
name|Key_Camera
return|;
case|case
name|VirtualKey_Escape
case|:
return|return
name|Qt
operator|::
name|Key_Escape
return|;
comment|// Function Keys
case|case
name|VirtualKey_F1
case|:
return|return
name|Qt
operator|::
name|Key_F1
return|;
case|case
name|VirtualKey_F2
case|:
return|return
name|Qt
operator|::
name|Key_F2
return|;
case|case
name|VirtualKey_F3
case|:
return|return
name|Qt
operator|::
name|Key_F3
return|;
case|case
name|VirtualKey_F4
case|:
return|return
name|Qt
operator|::
name|Key_F4
return|;
case|case
name|VirtualKey_F5
case|:
return|return
name|Qt
operator|::
name|Key_F5
return|;
case|case
name|VirtualKey_F6
case|:
return|return
name|Qt
operator|::
name|Key_F6
return|;
case|case
name|VirtualKey_F7
case|:
return|return
name|Qt
operator|::
name|Key_F7
return|;
case|case
name|VirtualKey_F8
case|:
return|return
name|Qt
operator|::
name|Key_F8
return|;
case|case
name|VirtualKey_F9
case|:
return|return
name|Qt
operator|::
name|Key_F9
return|;
case|case
name|VirtualKey_F10
case|:
return|return
name|Qt
operator|::
name|Key_F10
return|;
case|case
name|VirtualKey_F11
case|:
return|return
name|Qt
operator|::
name|Key_F11
return|;
case|case
name|VirtualKey_F12
case|:
return|return
name|Qt
operator|::
name|Key_F12
return|;
case|case
name|VirtualKey_F13
case|:
return|return
name|Qt
operator|::
name|Key_F13
return|;
case|case
name|VirtualKey_F14
case|:
return|return
name|Qt
operator|::
name|Key_F14
return|;
case|case
name|VirtualKey_F15
case|:
return|return
name|Qt
operator|::
name|Key_F15
return|;
case|case
name|VirtualKey_F16
case|:
return|return
name|Qt
operator|::
name|Key_F16
return|;
case|case
name|VirtualKey_F17
case|:
return|return
name|Qt
operator|::
name|Key_F17
return|;
case|case
name|VirtualKey_F18
case|:
return|return
name|Qt
operator|::
name|Key_F18
return|;
case|case
name|VirtualKey_F19
case|:
return|return
name|Qt
operator|::
name|Key_F19
return|;
case|case
name|VirtualKey_F20
case|:
return|return
name|Qt
operator|::
name|Key_F20
return|;
case|case
name|VirtualKey_F21
case|:
return|return
name|Qt
operator|::
name|Key_F21
return|;
case|case
name|VirtualKey_F22
case|:
return|return
name|Qt
operator|::
name|Key_F22
return|;
case|case
name|VirtualKey_F23
case|:
return|return
name|Qt
operator|::
name|Key_F23
return|;
case|case
name|VirtualKey_F24
case|:
return|return
name|Qt
operator|::
name|Key_F24
return|;
comment|// Character keys
case|case
name|VirtualKey_Space
case|:
return|return
name|Qt
operator|::
name|Key_Space
return|;
case|case
name|VirtualKey_Number0
case|:
case|case
name|VirtualKey_NumberPad0
case|:
return|return
name|Qt
operator|::
name|Key_0
return|;
case|case
name|VirtualKey_Number1
case|:
case|case
name|VirtualKey_NumberPad1
case|:
return|return
name|Qt
operator|::
name|Key_1
return|;
case|case
name|VirtualKey_Number2
case|:
case|case
name|VirtualKey_NumberPad2
case|:
return|return
name|Qt
operator|::
name|Key_2
return|;
case|case
name|VirtualKey_Number3
case|:
case|case
name|VirtualKey_NumberPad3
case|:
return|return
name|Qt
operator|::
name|Key_3
return|;
case|case
name|VirtualKey_Number4
case|:
case|case
name|VirtualKey_NumberPad4
case|:
return|return
name|Qt
operator|::
name|Key_4
return|;
case|case
name|VirtualKey_Number5
case|:
case|case
name|VirtualKey_NumberPad5
case|:
return|return
name|Qt
operator|::
name|Key_5
return|;
case|case
name|VirtualKey_Number6
case|:
case|case
name|VirtualKey_NumberPad6
case|:
return|return
name|Qt
operator|::
name|Key_6
return|;
case|case
name|VirtualKey_Number7
case|:
case|case
name|VirtualKey_NumberPad7
case|:
return|return
name|Qt
operator|::
name|Key_7
return|;
case|case
name|VirtualKey_Number8
case|:
case|case
name|VirtualKey_NumberPad8
case|:
return|return
name|Qt
operator|::
name|Key_8
return|;
case|case
name|VirtualKey_Number9
case|:
case|case
name|VirtualKey_NumberPad9
case|:
return|return
name|Qt
operator|::
name|Key_9
return|;
case|case
name|VirtualKey_A
case|:
return|return
name|Qt
operator|::
name|Key_A
return|;
case|case
name|VirtualKey_B
case|:
return|return
name|Qt
operator|::
name|Key_B
return|;
case|case
name|VirtualKey_C
case|:
return|return
name|Qt
operator|::
name|Key_C
return|;
case|case
name|VirtualKey_D
case|:
return|return
name|Qt
operator|::
name|Key_D
return|;
case|case
name|VirtualKey_E
case|:
return|return
name|Qt
operator|::
name|Key_E
return|;
case|case
name|VirtualKey_F
case|:
return|return
name|Qt
operator|::
name|Key_F
return|;
case|case
name|VirtualKey_G
case|:
return|return
name|Qt
operator|::
name|Key_G
return|;
case|case
name|VirtualKey_H
case|:
return|return
name|Qt
operator|::
name|Key_H
return|;
case|case
name|VirtualKey_I
case|:
return|return
name|Qt
operator|::
name|Key_I
return|;
case|case
name|VirtualKey_J
case|:
return|return
name|Qt
operator|::
name|Key_J
return|;
case|case
name|VirtualKey_K
case|:
return|return
name|Qt
operator|::
name|Key_K
return|;
case|case
name|VirtualKey_L
case|:
return|return
name|Qt
operator|::
name|Key_L
return|;
case|case
name|VirtualKey_M
case|:
return|return
name|Qt
operator|::
name|Key_M
return|;
case|case
name|VirtualKey_N
case|:
return|return
name|Qt
operator|::
name|Key_N
return|;
case|case
name|VirtualKey_O
case|:
return|return
name|Qt
operator|::
name|Key_O
return|;
case|case
name|VirtualKey_P
case|:
return|return
name|Qt
operator|::
name|Key_P
return|;
case|case
name|VirtualKey_Q
case|:
return|return
name|Qt
operator|::
name|Key_Q
return|;
case|case
name|VirtualKey_R
case|:
return|return
name|Qt
operator|::
name|Key_R
return|;
case|case
name|VirtualKey_S
case|:
return|return
name|Qt
operator|::
name|Key_S
return|;
case|case
name|VirtualKey_T
case|:
return|return
name|Qt
operator|::
name|Key_T
return|;
case|case
name|VirtualKey_U
case|:
return|return
name|Qt
operator|::
name|Key_U
return|;
case|case
name|VirtualKey_V
case|:
return|return
name|Qt
operator|::
name|Key_V
return|;
case|case
name|VirtualKey_W
case|:
return|return
name|Qt
operator|::
name|Key_W
return|;
case|case
name|VirtualKey_X
case|:
return|return
name|Qt
operator|::
name|Key_X
return|;
case|case
name|VirtualKey_Y
case|:
return|return
name|Qt
operator|::
name|Key_Y
return|;
case|case
name|VirtualKey_Z
case|:
return|return
name|Qt
operator|::
name|Key_Z
return|;
case|case
name|VirtualKey_Multiply
case|:
return|return
name|Qt
operator|::
name|Key_9
return|;
case|case
name|VirtualKey_Add
case|:
return|return
name|Qt
operator|::
name|Key_9
return|;
case|case
name|VirtualKey_Separator
case|:
return|return
name|Qt
operator|::
name|Key_9
return|;
case|case
name|VirtualKey_Subtract
case|:
return|return
name|Qt
operator|::
name|Key_9
return|;
case|case
name|VirtualKey_Decimal
case|:
return|return
name|Qt
operator|::
name|Key_9
return|;
case|case
name|VirtualKey_Divide
case|:
return|return
name|Qt
operator|::
name|Key_9
return|;
comment|/* Keys with no matching Qt enum (?)     case VirtualKey_None:     case VirtualKey_LeftButton:     case VirtualKey_RightButton:     case VirtualKey_MiddleButton:     case VirtualKey_XButton1:     case VirtualKey_XButton2:     case VirtualKey_Final:     case VirtualKey_Accept:*/
block|}
block|}
end_function
begin_function
DECL|function|qKeyFromCode
specifier|static
specifier|inline
name|Qt
operator|::
name|Key
name|qKeyFromCode
parameter_list|(
name|quint32
name|code
parameter_list|,
name|int
name|mods
parameter_list|)
block|{
if|if
condition|(
name|code
operator|>=
literal|'a'
operator|&&
name|code
operator|<=
literal|'z'
condition|)
name|code
operator|=
name|toupper
argument_list|(
name|code
argument_list|)
expr_stmt|;
if|if
condition|(
operator|(
name|mods
operator|&
name|Qt
operator|::
name|ControlModifier
operator|)
operator|!=
literal|0
condition|)
block|{
if|if
condition|(
name|code
operator|>=
literal|0
operator|&&
name|code
operator|<=
literal|31
condition|)
comment|// Ctrl+@..Ctrl+A..CTRL+Z..Ctrl+_
name|code
operator|+=
literal|'@'
expr_stmt|;
comment|// to @..A..Z.._
block|}
return|return
cast|static_cast
argument_list|<
name|Qt
operator|::
name|Key
argument_list|>
argument_list|(
name|code
operator|&
literal|0xff
argument_list|)
return|;
block|}
end_function
begin_typedef
DECL|typedef|CoreWindowCallbackRemover
typedef|typedef
name|HRESULT
function_decl|(
name|__stdcall
name|ICoreWindow
operator|::
modifier|*
name|CoreWindowCallbackRemover
function_decl|)
parameter_list|(
name|EventRegistrationToken
parameter_list|)
function_decl|;
end_typedef
begin_function
DECL|function|qHash
name|uint
name|qHash
parameter_list|(
name|CoreWindowCallbackRemover
name|key
parameter_list|)
block|{
name|void
modifier|*
name|ptr
init|=
operator|*
operator|(
name|void
operator|*
operator|*
operator|)
operator|(
operator|&
name|key
operator|)
decl_stmt|;
return|return
name|qHash
argument_list|(
name|ptr
argument_list|)
return|;
block|}
end_function
begin_typedef
DECL|typedef|DisplayCallbackRemover
typedef|typedef
name|HRESULT
function_decl|(
name|__stdcall
name|IDisplayInformation
operator|::
modifier|*
name|DisplayCallbackRemover
function_decl|)
parameter_list|(
name|EventRegistrationToken
parameter_list|)
function_decl|;
end_typedef
begin_function
DECL|function|qHash
name|uint
name|qHash
parameter_list|(
name|DisplayCallbackRemover
name|key
parameter_list|)
block|{
name|void
modifier|*
name|ptr
init|=
operator|*
operator|(
name|void
operator|*
operator|*
operator|)
operator|(
operator|&
name|key
operator|)
decl_stmt|;
return|return
name|qHash
argument_list|(
name|ptr
argument_list|)
return|;
block|}
end_function
begin_ifdef
ifdef|#
directive|ifdef
name|Q_OS_WINPHONE
end_ifdef
begin_typedef
DECL|typedef|StatusBarCallbackRemover
typedef|typedef
name|HRESULT
function_decl|(
name|__stdcall
name|IStatusBar
operator|::
modifier|*
name|StatusBarCallbackRemover
function_decl|)
parameter_list|(
name|EventRegistrationToken
parameter_list|)
function_decl|;
end_typedef
begin_function
DECL|function|qHash
name|uint
name|qHash
parameter_list|(
name|StatusBarCallbackRemover
name|key
parameter_list|)
block|{
name|void
modifier|*
name|ptr
init|=
operator|*
operator|(
name|void
operator|*
operator|*
operator|)
operator|(
operator|&
name|key
operator|)
decl_stmt|;
return|return
name|qHash
argument_list|(
name|ptr
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_class
DECL|class|QWinRTScreenPrivate
class|class
name|QWinRTScreenPrivate
block|{
public|public:
DECL|member|touchDevice
name|QTouchDevice
modifier|*
name|touchDevice
decl_stmt|;
DECL|member|coreWindow
name|ComPtr
argument_list|<
name|ICoreWindow
argument_list|>
name|coreWindow
decl_stmt|;
DECL|member|canvas
name|ComPtr
argument_list|<
name|Xaml
operator|::
name|IDependencyObject
argument_list|>
name|canvas
decl_stmt|;
DECL|member|view
name|ComPtr
argument_list|<
name|IApplicationView
argument_list|>
name|view
decl_stmt|;
DECL|member|displayInformation
name|ComPtr
argument_list|<
name|IDisplayInformation
argument_list|>
name|displayInformation
decl_stmt|;
ifdef|#
directive|ifdef
name|Q_OS_WINPHONE
DECL|member|statusBar
name|ComPtr
argument_list|<
name|IStatusBar
argument_list|>
name|statusBar
decl_stmt|;
endif|#
directive|endif
DECL|member|cursor
name|QScopedPointer
argument_list|<
name|QWinRTCursor
argument_list|>
name|cursor
decl_stmt|;
DECL|member|touchPoints
name|QHash
argument_list|<
name|quint32
argument_list|,
name|QWindowSystemInterface
operator|::
name|TouchPoint
argument_list|>
name|touchPoints
decl_stmt|;
DECL|member|logicalSize
name|QSizeF
name|logicalSize
decl_stmt|;
DECL|member|surfaceFormat
name|QSurfaceFormat
name|surfaceFormat
decl_stmt|;
DECL|member|logicalDpi
name|qreal
name|logicalDpi
decl_stmt|;
DECL|member|physicalDpi
name|QDpi
name|physicalDpi
decl_stmt|;
DECL|member|scaleFactor
name|qreal
name|scaleFactor
decl_stmt|;
DECL|member|nativeOrientation
name|Qt
operator|::
name|ScreenOrientation
name|nativeOrientation
decl_stmt|;
DECL|member|orientation
name|Qt
operator|::
name|ScreenOrientation
name|orientation
decl_stmt|;
DECL|member|visibleWindows
name|QList
argument_list|<
name|QWindow
modifier|*
argument_list|>
name|visibleWindows
decl_stmt|;
DECL|member|activeKeys
name|QHash
argument_list|<
name|Qt
operator|::
name|Key
argument_list|,
name|KeyInfo
argument_list|>
name|activeKeys
decl_stmt|;
DECL|member|windowTokens
name|QHash
argument_list|<
name|CoreWindowCallbackRemover
argument_list|,
name|EventRegistrationToken
argument_list|>
name|windowTokens
decl_stmt|;
DECL|member|displayTokens
name|QHash
argument_list|<
name|DisplayCallbackRemover
argument_list|,
name|EventRegistrationToken
argument_list|>
name|displayTokens
decl_stmt|;
ifdef|#
directive|ifdef
name|Q_OS_WINPHONE
DECL|member|statusBarTokens
name|QHash
argument_list|<
name|StatusBarCallbackRemover
argument_list|,
name|EventRegistrationToken
argument_list|>
name|statusBarTokens
decl_stmt|;
endif|#
directive|endif
block|}
class|;
end_class
begin_comment
comment|// To be called from the XAML thread
end_comment
begin_constructor
DECL|function|QWinRTScreen
name|QWinRTScreen
operator|::
name|QWinRTScreen
parameter_list|()
member_init_list|:
name|d_ptr
argument_list|(
operator|new
name|QWinRTScreenPrivate
argument_list|)
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
name|d
operator|->
name|orientation
operator|=
name|Qt
operator|::
name|PrimaryOrientation
expr_stmt|;
name|d
operator|->
name|touchDevice
operator|=
name|Q_NULLPTR
expr_stmt|;
name|HRESULT
name|hr
decl_stmt|;
name|ComPtr
argument_list|<
name|Xaml
operator|::
name|IWindowStatics
argument_list|>
name|windowStatics
decl_stmt|;
name|hr
operator|=
name|RoGetActivationFactory
argument_list|(
name|HString
operator|::
name|MakeReference
argument_list|(
name|RuntimeClass_Windows_UI_Xaml_Window
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
name|IID_PPV_ARGS
argument_list|(
operator|&
name|windowStatics
argument_list|)
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|ComPtr
argument_list|<
name|Xaml
operator|::
name|IWindow
argument_list|>
name|window
decl_stmt|;
name|hr
operator|=
name|windowStatics
operator|->
name|get_Current
argument_list|(
operator|&
name|window
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|window
operator|->
name|Activate
argument_list|()
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|window
operator|->
name|get_CoreWindow
argument_list|(
operator|&
name|d
operator|->
name|coreWindow
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|d
operator|->
name|coreWindow
operator|->
name|Activate
argument_list|()
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|Rect
name|rect
decl_stmt|;
name|hr
operator|=
name|d
operator|->
name|coreWindow
operator|->
name|get_Bounds
argument_list|(
operator|&
name|rect
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|d
operator|->
name|logicalSize
operator|=
name|QSizeF
argument_list|(
name|rect
operator|.
name|Width
argument_list|,
name|rect
operator|.
name|Height
argument_list|)
expr_stmt|;
comment|// Orientation handling
name|ComPtr
argument_list|<
name|IDisplayInformationStatics
argument_list|>
name|displayInformationStatics
decl_stmt|;
name|hr
operator|=
name|RoGetActivationFactory
argument_list|(
name|HString
operator|::
name|MakeReference
argument_list|(
name|RuntimeClass_Windows_Graphics_Display_DisplayInformation
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
name|IID_PPV_ARGS
argument_list|(
operator|&
name|displayInformationStatics
argument_list|)
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|displayInformationStatics
operator|->
name|GetForCurrentView
argument_list|(
operator|&
name|d
operator|->
name|displayInformation
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
comment|// Set native orientation
name|DisplayOrientations
name|displayOrientation
decl_stmt|;
name|hr
operator|=
name|d
operator|->
name|displayInformation
operator|->
name|get_NativeOrientation
argument_list|(
operator|&
name|displayOrientation
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|d
operator|->
name|nativeOrientation
operator|=
cast|static_cast
argument_list|<
name|Qt
operator|::
name|ScreenOrientation
argument_list|>
argument_list|(
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|qtOrientationsFromNative
argument_list|(
name|displayOrientation
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
comment|// Set initial pixel density
name|onDpiChanged
argument_list|(
name|Q_NULLPTR
argument_list|,
name|Q_NULLPTR
argument_list|)
expr_stmt|;
name|d
operator|->
name|orientation
operator|=
name|d
operator|->
name|nativeOrientation
expr_stmt|;
name|ComPtr
argument_list|<
name|IApplicationViewStatics2
argument_list|>
name|applicationViewStatics
decl_stmt|;
name|hr
operator|=
name|RoGetActivationFactory
argument_list|(
name|HString
operator|::
name|MakeReference
argument_list|(
name|RuntimeClass_Windows_UI_ViewManagement_ApplicationView
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
name|IID_PPV_ARGS
argument_list|(
operator|&
name|applicationViewStatics
argument_list|)
argument_list|)
expr_stmt|;
name|RETURN_VOID_IF_FAILED
argument_list|(
literal|"Could not get ApplicationViewStatics"
argument_list|)
expr_stmt|;
name|hr
operator|=
name|applicationViewStatics
operator|->
name|GetForCurrentView
argument_list|(
operator|&
name|d
operator|->
name|view
argument_list|)
expr_stmt|;
name|RETURN_VOID_IF_FAILED
argument_list|(
literal|"Could not access currentView"
argument_list|)
expr_stmt|;
comment|// Create a canvas and set it as the window content. Eventually, this should have its own method so multiple "screens" can be added
name|ComPtr
argument_list|<
name|Xaml
operator|::
name|Controls
operator|::
name|ICanvas
argument_list|>
name|canvas
decl_stmt|;
name|hr
operator|=
name|RoActivateInstance
argument_list|(
name|HString
operator|::
name|MakeReference
argument_list|(
name|RuntimeClass_Windows_UI_Xaml_Controls_Canvas
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|canvas
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|ComPtr
argument_list|<
name|Xaml
operator|::
name|IFrameworkElement
argument_list|>
name|frameworkElement
decl_stmt|;
name|hr
operator|=
name|canvas
operator|.
name|As
argument_list|(
operator|&
name|frameworkElement
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|frameworkElement
operator|->
name|put_Width
argument_list|(
name|d
operator|->
name|logicalSize
operator|.
name|width
argument_list|()
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|frameworkElement
operator|->
name|put_Height
argument_list|(
name|d
operator|->
name|logicalSize
operator|.
name|height
argument_list|()
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|ComPtr
argument_list|<
name|Xaml
operator|::
name|IUIElement
argument_list|>
name|uiElement
decl_stmt|;
name|hr
operator|=
name|canvas
operator|.
name|As
argument_list|(
operator|&
name|uiElement
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|window
operator|->
name|put_Content
argument_list|(
name|uiElement
operator|.
name|Get
argument_list|()
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|canvas
operator|.
name|As
argument_list|(
operator|&
name|d
operator|->
name|canvas
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|d
operator|->
name|cursor
operator|.
name|reset
argument_list|(
operator|new
name|QWinRTCursor
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|Q_OS_WINPHONE
name|ComPtr
argument_list|<
name|IStatusBarStatics
argument_list|>
name|statusBarStatics
decl_stmt|;
name|hr
operator|=
name|RoGetActivationFactory
argument_list|(
name|HString
operator|::
name|MakeReference
argument_list|(
name|RuntimeClass_Windows_UI_ViewManagement_StatusBar
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
name|IID_PPV_ARGS
argument_list|(
operator|&
name|statusBarStatics
argument_list|)
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|statusBarStatics
operator|->
name|GetForCurrentView
argument_list|(
operator|&
name|d
operator|->
name|statusBar
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|// Q_OS_WINPHONE
block|}
end_constructor
begin_destructor
DECL|function|~QWinRTScreen
name|QWinRTScreen
operator|::
name|~
name|QWinRTScreen
parameter_list|()
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
comment|// Unregister callbacks
name|HRESULT
name|hr
decl_stmt|;
name|hr
operator|=
name|QEventDispatcherWinRT
operator|::
name|runOnXamlThread
argument_list|(
capture|[
name|this
capture|,
name|d
capture|]
parameter_list|()
block|{
name|HRESULT
name|hr
decl_stmt|;
for|for
control|(
name|QHash
argument_list|<
name|CoreWindowCallbackRemover
argument_list|,
name|EventRegistrationToken
argument_list|>
operator|::
name|const_iterator
name|i
type|=
name|d
operator|->
name|windowTokens
operator|.
name|begin
type|(
control|)
empty_stmt|;
name|i
operator|!=
name|d
operator|->
name|windowTokens
operator|.
name|end
argument_list|()
expr_stmt|;
operator|++
name|i
argument_list|)
block|{
name|hr
operator|=
operator|(
name|d
operator|->
name|coreWindow
operator|.
name|Get
argument_list|()
operator|->*
name|i
operator|.
name|key
argument_list|()
operator|)
operator|(
name|i
operator|.
name|value
argument_list|()
operator|)
block|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
block|;         }
for|for
control|(
name|QHash
argument_list|<
name|DisplayCallbackRemover
argument_list|,
name|EventRegistrationToken
argument_list|>
operator|::
name|const_iterator
name|i
init|=
name|d
operator|->
name|displayTokens
operator|.
name|begin
argument_list|()
init|;
name|i
operator|!=
name|d
operator|->
name|displayTokens
operator|.
name|end
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|hr
operator|=
operator|(
name|d
operator|->
name|displayInformation
operator|.
name|Get
argument_list|()
operator|->*
name|i
operator|.
name|key
argument_list|()
operator|)
operator|(
name|i
operator|.
name|value
argument_list|()
operator|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
block|}
ifdef|#
directive|ifdef
name|Q_OS_WINPHONE
for|for
control|(
name|QHash
argument_list|<
name|StatusBarCallbackRemover
argument_list|,
name|EventRegistrationToken
argument_list|>
operator|::
name|const_iterator
name|i
init|=
name|d
operator|->
name|statusBarTokens
operator|.
name|begin
argument_list|()
init|;
name|i
operator|!=
name|d
operator|->
name|statusBarTokens
operator|.
name|end
argument_list|()
condition|;
operator|++
name|i
control|)
block|{
name|hr
operator|=
operator|(
name|d
operator|->
name|statusBar
operator|.
name|Get
argument_list|()
operator|->*
name|i
operator|.
name|key
argument_list|()
operator|)
operator|(
name|i
operator|.
name|value
argument_list|()
operator|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
block|}
endif|#
directive|endif
comment|//Q_OS_WINPHONE
return|return
name|hr
return|;
block|}
end_destructor
begin_empty_stmt
unit|)
empty_stmt|;
end_empty_stmt
begin_expr_stmt
name|RETURN_VOID_IF_FAILED
argument_list|(
literal|"Failed to unregister screen event callbacks"
argument_list|)
expr_stmt|;
end_expr_stmt
begin_macro
unit|}  QRect
DECL|function|geometry
name|QWinRTScreen
end_macro
begin_expr_stmt
DECL|function|geometry
operator|::
name|geometry
operator|(
operator|)
specifier|const
block|{
name|Q_D
argument_list|(
specifier|const
name|QWinRTScreen
argument_list|)
block|;
return|return
name|QRect
argument_list|(
name|QPoint
argument_list|()
argument_list|,
operator|(
name|d
operator|->
name|logicalSize
operator|*
name|d
operator|->
name|scaleFactor
operator|)
operator|.
name|toSize
argument_list|()
argument_list|)
return|;
block|}
end_expr_stmt
begin_ifdef
ifdef|#
directive|ifdef
name|Q_OS_WINPHONE
end_ifdef
begin_function
DECL|function|availableGeometry
name|QRect
name|QWinRTScreen
operator|::
name|availableGeometry
parameter_list|()
specifier|const
block|{
name|Q_D
argument_list|(
specifier|const
name|QWinRTScreen
argument_list|)
expr_stmt|;
name|QRect
name|statusBar
decl_stmt|;
name|QEventDispatcherWinRT
operator|::
name|runOnXamlThread
argument_list|(
capture|[
name|d
capture|,
modifier|&
name|statusBar
capture|]
parameter_list|()
block|{
name|HRESULT
name|hr
decl_stmt|;
name|Rect
name|rect
decl_stmt|;
name|hr
operator|=
name|d
operator|->
name|statusBar
operator|->
name|get_OccludedRect
argument_list|(
operator|&
name|rect
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|statusBar
operator|.
name|setRect
argument_list|(
name|qRound
argument_list|(
name|rect
operator|.
name|X
operator|*
name|d
operator|->
name|scaleFactor
argument_list|)
argument_list|,
name|qRound
argument_list|(
name|rect
operator|.
name|Y
operator|*
name|d
operator|->
name|scaleFactor
argument_list|)
argument_list|,
name|qRound
argument_list|(
name|rect
operator|.
name|Width
operator|*
name|d
operator|->
name|scaleFactor
argument_list|)
argument_list|,
name|qRound
argument_list|(
name|rect
operator|.
name|Height
operator|*
name|d
operator|->
name|scaleFactor
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|S_OK
return|;
block|}
argument_list|)
expr_stmt|;
return|return
name|geometry
argument_list|()
operator|.
name|adjusted
argument_list|(
name|d
operator|->
name|orientation
operator|==
name|Qt
operator|::
name|LandscapeOrientation
condition|?
name|statusBar
operator|.
name|width
argument_list|()
else|:
literal|0
argument_list|,
name|d
operator|->
name|orientation
operator|==
name|Qt
operator|::
name|PortraitOrientation
condition|?
name|statusBar
operator|.
name|height
argument_list|()
else|:
literal|0
argument_list|,
name|d
operator|->
name|orientation
operator|==
name|Qt
operator|::
name|InvertedLandscapeOrientation
condition|?
operator|-
name|statusBar
operator|.
name|width
argument_list|()
else|:
literal|0
argument_list|,
literal|0
argument_list|)
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|//Q_OS_WINPHONE
end_comment
begin_function
DECL|function|depth
name|int
name|QWinRTScreen
operator|::
name|depth
parameter_list|()
specifier|const
block|{
return|return
literal|32
return|;
block|}
end_function
begin_function
DECL|function|format
name|QImage
operator|::
name|Format
name|QWinRTScreen
operator|::
name|format
parameter_list|()
specifier|const
block|{
return|return
name|QImage
operator|::
name|Format_ARGB32_Premultiplied
return|;
block|}
end_function
begin_function
DECL|function|physicalSize
name|QSizeF
name|QWinRTScreen
operator|::
name|physicalSize
parameter_list|()
specifier|const
block|{
name|Q_D
argument_list|(
specifier|const
name|QWinRTScreen
argument_list|)
expr_stmt|;
return|return
name|QSizeF
argument_list|(
name|d
operator|->
name|logicalSize
operator|.
name|width
argument_list|()
operator|*
name|d
operator|->
name|scaleFactor
operator|/
name|d
operator|->
name|physicalDpi
operator|.
name|first
operator|*
name|qreal
argument_list|(
literal|25.4
argument_list|)
argument_list|,
name|d
operator|->
name|logicalSize
operator|.
name|height
argument_list|()
operator|*
name|d
operator|->
name|scaleFactor
operator|/
name|d
operator|->
name|physicalDpi
operator|.
name|second
operator|*
name|qreal
argument_list|(
literal|25.4
argument_list|)
argument_list|)
return|;
block|}
end_function
begin_function
DECL|function|logicalDpi
name|QDpi
name|QWinRTScreen
operator|::
name|logicalDpi
parameter_list|()
specifier|const
block|{
name|Q_D
argument_list|(
specifier|const
name|QWinRTScreen
argument_list|)
expr_stmt|;
return|return
name|QDpi
argument_list|(
name|d
operator|->
name|logicalDpi
argument_list|,
name|d
operator|->
name|logicalDpi
argument_list|)
return|;
block|}
end_function
begin_function
DECL|function|scaleFactor
name|qreal
name|QWinRTScreen
operator|::
name|scaleFactor
parameter_list|()
specifier|const
block|{
name|Q_D
argument_list|(
specifier|const
name|QWinRTScreen
argument_list|)
expr_stmt|;
return|return
name|d
operator|->
name|scaleFactor
return|;
block|}
end_function
begin_function
DECL|function|cursor
name|QPlatformCursor
modifier|*
name|QWinRTScreen
operator|::
name|cursor
parameter_list|()
specifier|const
block|{
name|Q_D
argument_list|(
specifier|const
name|QWinRTScreen
argument_list|)
expr_stmt|;
return|return
name|d
operator|->
name|cursor
operator|.
name|data
argument_list|()
return|;
block|}
end_function
begin_function
DECL|function|keyboardModifiers
name|Qt
operator|::
name|KeyboardModifiers
name|QWinRTScreen
operator|::
name|keyboardModifiers
parameter_list|()
specifier|const
block|{
name|Q_D
argument_list|(
specifier|const
name|QWinRTScreen
argument_list|)
expr_stmt|;
name|Qt
operator|::
name|KeyboardModifiers
name|mods
decl_stmt|;
name|CoreVirtualKeyStates
name|mod
decl_stmt|;
name|d
operator|->
name|coreWindow
operator|->
name|GetAsyncKeyState
argument_list|(
name|VirtualKey_Shift
argument_list|,
operator|&
name|mod
argument_list|)
expr_stmt|;
if|if
condition|(
name|mod
operator|==
name|CoreVirtualKeyStates_Down
condition|)
name|mods
operator||=
name|Qt
operator|::
name|ShiftModifier
expr_stmt|;
name|d
operator|->
name|coreWindow
operator|->
name|GetAsyncKeyState
argument_list|(
name|VirtualKey_Menu
argument_list|,
operator|&
name|mod
argument_list|)
expr_stmt|;
if|if
condition|(
name|mod
operator|==
name|CoreVirtualKeyStates_Down
condition|)
name|mods
operator||=
name|Qt
operator|::
name|AltModifier
expr_stmt|;
name|d
operator|->
name|coreWindow
operator|->
name|GetAsyncKeyState
argument_list|(
name|VirtualKey_Control
argument_list|,
operator|&
name|mod
argument_list|)
expr_stmt|;
if|if
condition|(
name|mod
operator|==
name|CoreVirtualKeyStates_Down
condition|)
name|mods
operator||=
name|Qt
operator|::
name|ControlModifier
expr_stmt|;
name|d
operator|->
name|coreWindow
operator|->
name|GetAsyncKeyState
argument_list|(
name|VirtualKey_LeftWindows
argument_list|,
operator|&
name|mod
argument_list|)
expr_stmt|;
if|if
condition|(
name|mod
operator|==
name|CoreVirtualKeyStates_Down
condition|)
block|{
name|mods
operator||=
name|Qt
operator|::
name|MetaModifier
expr_stmt|;
block|}
else|else
block|{
name|d
operator|->
name|coreWindow
operator|->
name|GetAsyncKeyState
argument_list|(
name|VirtualKey_RightWindows
argument_list|,
operator|&
name|mod
argument_list|)
expr_stmt|;
if|if
condition|(
name|mod
operator|==
name|CoreVirtualKeyStates_Down
condition|)
name|mods
operator||=
name|Qt
operator|::
name|MetaModifier
expr_stmt|;
block|}
return|return
name|mods
return|;
block|}
end_function
begin_function
DECL|function|nativeOrientation
name|Qt
operator|::
name|ScreenOrientation
name|QWinRTScreen
operator|::
name|nativeOrientation
parameter_list|()
specifier|const
block|{
name|Q_D
argument_list|(
specifier|const
name|QWinRTScreen
argument_list|)
expr_stmt|;
return|return
name|d
operator|->
name|nativeOrientation
return|;
block|}
end_function
begin_function
DECL|function|orientation
name|Qt
operator|::
name|ScreenOrientation
name|QWinRTScreen
operator|::
name|orientation
parameter_list|()
specifier|const
block|{
name|Q_D
argument_list|(
specifier|const
name|QWinRTScreen
argument_list|)
expr_stmt|;
return|return
name|d
operator|->
name|orientation
return|;
block|}
end_function
begin_function
DECL|function|coreWindow
name|ICoreWindow
modifier|*
name|QWinRTScreen
operator|::
name|coreWindow
parameter_list|()
specifier|const
block|{
name|Q_D
argument_list|(
specifier|const
name|QWinRTScreen
argument_list|)
expr_stmt|;
return|return
name|d
operator|->
name|coreWindow
operator|.
name|Get
argument_list|()
return|;
block|}
end_function
begin_function
DECL|function|canvas
name|Xaml
operator|::
name|IDependencyObject
modifier|*
name|QWinRTScreen
operator|::
name|canvas
parameter_list|()
specifier|const
block|{
name|Q_D
argument_list|(
specifier|const
name|QWinRTScreen
argument_list|)
expr_stmt|;
return|return
name|d
operator|->
name|canvas
operator|.
name|Get
argument_list|()
return|;
block|}
end_function
begin_ifdef
ifdef|#
directive|ifdef
name|Q_OS_WINPHONE
end_ifdef
begin_function
DECL|function|setStatusBarVisibility
name|void
name|QWinRTScreen
operator|::
name|setStatusBarVisibility
parameter_list|(
name|bool
name|visible
parameter_list|,
name|QWindow
modifier|*
name|window
parameter_list|)
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
specifier|const
name|Qt
operator|::
name|WindowFlags
name|windowType
init|=
name|window
operator|->
name|flags
argument_list|()
operator|&
name|Qt
operator|::
name|WindowType_Mask
decl_stmt|;
if|if
condition|(
operator|!
name|window
operator|||
operator|(
name|windowType
operator|!=
name|Qt
operator|::
name|Window
operator|&&
name|windowType
operator|!=
name|Qt
operator|::
name|Dialog
operator|)
condition|)
return|return;
name|QEventDispatcherWinRT
operator|::
name|runOnXamlThread
argument_list|(
capture|[
name|d
capture|,
name|visible
capture|]
parameter_list|()
block|{
name|HRESULT
name|hr
decl_stmt|;
name|ComPtr
argument_list|<
name|IAsyncAction
argument_list|>
name|op
decl_stmt|;
if|if
condition|(
name|visible
condition|)
name|hr
operator|=
name|d
operator|->
name|statusBar
operator|->
name|ShowAsync
argument_list|(
operator|&
name|op
argument_list|)
expr_stmt|;
else|else
name|hr
operator|=
name|d
operator|->
name|statusBar
operator|->
name|HideAsync
argument_list|(
operator|&
name|op
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
return|return
name|S_OK
return|;
block|}
argument_list|)
expr_stmt|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|//Q_OS_WINPHONE
end_comment
begin_function
DECL|function|initialize
name|void
name|QWinRTScreen
operator|::
name|initialize
parameter_list|()
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
name|HRESULT
name|hr
decl_stmt|;
name|hr
operator|=
name|d
operator|->
name|coreWindow
operator|->
name|add_KeyDown
argument_list|(
name|Callback
argument_list|<
name|KeyHandler
argument_list|>
argument_list|(
name|this
argument_list|,
operator|&
name|QWinRTScreen
operator|::
name|onKeyDown
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|d
operator|->
name|windowTokens
index|[
operator|&
name|ICoreWindow
operator|::
name|remove_KeyDown
index|]
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|d
operator|->
name|coreWindow
operator|->
name|add_KeyUp
argument_list|(
name|Callback
argument_list|<
name|KeyHandler
argument_list|>
argument_list|(
name|this
argument_list|,
operator|&
name|QWinRTScreen
operator|::
name|onKeyUp
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|d
operator|->
name|windowTokens
index|[
operator|&
name|ICoreWindow
operator|::
name|remove_KeyUp
index|]
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|d
operator|->
name|coreWindow
operator|->
name|add_CharacterReceived
argument_list|(
name|Callback
argument_list|<
name|CharacterReceivedHandler
argument_list|>
argument_list|(
name|this
argument_list|,
operator|&
name|QWinRTScreen
operator|::
name|onCharacterReceived
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|d
operator|->
name|windowTokens
index|[
operator|&
name|ICoreWindow
operator|::
name|remove_CharacterReceived
index|]
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|d
operator|->
name|coreWindow
operator|->
name|add_PointerEntered
argument_list|(
name|Callback
argument_list|<
name|PointerHandler
argument_list|>
argument_list|(
name|this
argument_list|,
operator|&
name|QWinRTScreen
operator|::
name|onPointerEntered
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|d
operator|->
name|windowTokens
index|[
operator|&
name|ICoreWindow
operator|::
name|remove_PointerEntered
index|]
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|d
operator|->
name|coreWindow
operator|->
name|add_PointerExited
argument_list|(
name|Callback
argument_list|<
name|PointerHandler
argument_list|>
argument_list|(
name|this
argument_list|,
operator|&
name|QWinRTScreen
operator|::
name|onPointerExited
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|d
operator|->
name|windowTokens
index|[
operator|&
name|ICoreWindow
operator|::
name|remove_PointerExited
index|]
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|d
operator|->
name|coreWindow
operator|->
name|add_PointerMoved
argument_list|(
name|Callback
argument_list|<
name|PointerHandler
argument_list|>
argument_list|(
name|this
argument_list|,
operator|&
name|QWinRTScreen
operator|::
name|onPointerUpdated
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|d
operator|->
name|windowTokens
index|[
operator|&
name|ICoreWindow
operator|::
name|remove_PointerMoved
index|]
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|d
operator|->
name|coreWindow
operator|->
name|add_PointerPressed
argument_list|(
name|Callback
argument_list|<
name|PointerHandler
argument_list|>
argument_list|(
name|this
argument_list|,
operator|&
name|QWinRTScreen
operator|::
name|onPointerUpdated
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|d
operator|->
name|windowTokens
index|[
operator|&
name|ICoreWindow
operator|::
name|remove_PointerPressed
index|]
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|d
operator|->
name|coreWindow
operator|->
name|add_PointerReleased
argument_list|(
name|Callback
argument_list|<
name|PointerHandler
argument_list|>
argument_list|(
name|this
argument_list|,
operator|&
name|QWinRTScreen
operator|::
name|onPointerUpdated
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|d
operator|->
name|windowTokens
index|[
operator|&
name|ICoreWindow
operator|::
name|remove_PointerReleased
index|]
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|d
operator|->
name|coreWindow
operator|->
name|add_PointerWheelChanged
argument_list|(
name|Callback
argument_list|<
name|PointerHandler
argument_list|>
argument_list|(
name|this
argument_list|,
operator|&
name|QWinRTScreen
operator|::
name|onPointerUpdated
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|d
operator|->
name|windowTokens
index|[
operator|&
name|ICoreWindow
operator|::
name|remove_PointerWheelChanged
index|]
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|Q_OS_WINPHONE
name|hr
operator|=
name|d
operator|->
name|coreWindow
operator|->
name|add_SizeChanged
argument_list|(
name|Callback
argument_list|<
name|SizeChangedHandler
argument_list|>
argument_list|(
name|this
argument_list|,
operator|&
name|QWinRTScreen
operator|::
name|onSizeChanged
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|d
operator|->
name|windowTokens
index|[
operator|&
name|ICoreWindow
operator|::
name|remove_SizeChanged
index|]
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
else|#
directive|else
name|hr
operator|=
name|d
operator|->
name|statusBar
operator|->
name|add_Showing
argument_list|(
name|Callback
argument_list|<
name|StatusBarHandler
argument_list|>
argument_list|(
name|this
argument_list|,
operator|&
name|QWinRTScreen
operator|::
name|onStatusBarShowing
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|d
operator|->
name|statusBarTokens
index|[
operator|&
name|IStatusBar
operator|::
name|remove_Showing
index|]
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|d
operator|->
name|statusBar
operator|->
name|add_Hiding
argument_list|(
name|Callback
argument_list|<
name|StatusBarHandler
argument_list|>
argument_list|(
name|this
argument_list|,
operator|&
name|QWinRTScreen
operator|::
name|onStatusBarHiding
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|d
operator|->
name|statusBarTokens
index|[
operator|&
name|IStatusBar
operator|::
name|remove_Hiding
index|]
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|hr
operator|=
name|d
operator|->
name|coreWindow
operator|->
name|add_Activated
argument_list|(
name|Callback
argument_list|<
name|ActivatedHandler
argument_list|>
argument_list|(
name|this
argument_list|,
operator|&
name|QWinRTScreen
operator|::
name|onActivated
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|d
operator|->
name|windowTokens
index|[
operator|&
name|ICoreWindow
operator|::
name|remove_Activated
index|]
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|d
operator|->
name|coreWindow
operator|->
name|add_Closed
argument_list|(
name|Callback
argument_list|<
name|ClosedHandler
argument_list|>
argument_list|(
name|this
argument_list|,
operator|&
name|QWinRTScreen
operator|::
name|onClosed
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|d
operator|->
name|windowTokens
index|[
operator|&
name|ICoreWindow
operator|::
name|remove_Closed
index|]
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|d
operator|->
name|coreWindow
operator|->
name|add_VisibilityChanged
argument_list|(
name|Callback
argument_list|<
name|VisibilityChangedHandler
argument_list|>
argument_list|(
name|this
argument_list|,
operator|&
name|QWinRTScreen
operator|::
name|onVisibilityChanged
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|d
operator|->
name|windowTokens
index|[
operator|&
name|ICoreWindow
operator|::
name|remove_VisibilityChanged
index|]
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|d
operator|->
name|displayInformation
operator|->
name|add_OrientationChanged
argument_list|(
name|Callback
argument_list|<
name|DisplayInformationHandler
argument_list|>
argument_list|(
name|this
argument_list|,
operator|&
name|QWinRTScreen
operator|::
name|onOrientationChanged
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|d
operator|->
name|displayTokens
index|[
operator|&
name|IDisplayInformation
operator|::
name|remove_OrientationChanged
index|]
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|hr
operator|=
name|d
operator|->
name|displayInformation
operator|->
name|add_DpiChanged
argument_list|(
name|Callback
argument_list|<
name|DisplayInformationHandler
argument_list|>
argument_list|(
name|this
argument_list|,
operator|&
name|QWinRTScreen
operator|::
name|onDpiChanged
argument_list|)
operator|.
name|Get
argument_list|()
argument_list|,
operator|&
name|d
operator|->
name|displayTokens
index|[
operator|&
name|IDisplayInformation
operator|::
name|remove_DpiChanged
index|]
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|onOrientationChanged
argument_list|(
name|Q_NULLPTR
argument_list|,
name|Q_NULLPTR
argument_list|)
expr_stmt|;
name|onVisibilityChanged
argument_list|(
literal|nullptr
argument_list|,
literal|nullptr
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|topWindow
name|QWindow
modifier|*
name|QWinRTScreen
operator|::
name|topWindow
parameter_list|()
specifier|const
block|{
name|Q_D
argument_list|(
specifier|const
name|QWinRTScreen
argument_list|)
expr_stmt|;
return|return
name|d
operator|->
name|visibleWindows
operator|.
name|isEmpty
argument_list|()
condition|?
literal|0
else|:
name|d
operator|->
name|visibleWindows
operator|.
name|first
argument_list|()
return|;
block|}
end_function
begin_function
DECL|function|addWindow
name|void
name|QWinRTScreen
operator|::
name|addWindow
parameter_list|(
name|QWindow
modifier|*
name|window
parameter_list|)
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
if|if
condition|(
name|window
operator|==
name|topWindow
argument_list|()
condition|)
return|return;
ifdef|#
directive|ifdef
name|Q_OS_WINPHONE
if|if
condition|(
name|window
operator|->
name|visibility
argument_list|()
operator|!=
name|QWindow
operator|::
name|Maximized
operator|&&
name|window
operator|->
name|visibility
argument_list|()
operator|!=
name|QWindow
operator|::
name|Windowed
condition|)
name|setStatusBarVisibility
argument_list|(
literal|false
argument_list|,
name|window
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|d
operator|->
name|visibleWindows
operator|.
name|prepend
argument_list|(
name|window
argument_list|)
expr_stmt|;
name|QWindowSystemInterface
operator|::
name|handleWindowActivated
argument_list|(
name|window
argument_list|,
name|Qt
operator|::
name|OtherFocusReason
argument_list|)
expr_stmt|;
name|handleExpose
argument_list|()
expr_stmt|;
name|QWindowSystemInterface
operator|::
name|flushWindowSystemEvents
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|removeWindow
name|void
name|QWinRTScreen
operator|::
name|removeWindow
parameter_list|(
name|QWindow
modifier|*
name|window
parameter_list|)
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
ifdef|#
directive|ifdef
name|Q_OS_WINPHONE
if|if
condition|(
name|window
operator|->
name|visibility
argument_list|()
operator|==
name|QWindow
operator|::
name|Minimized
condition|)
name|setStatusBarVisibility
argument_list|(
literal|false
argument_list|,
name|window
argument_list|)
expr_stmt|;
endif|#
directive|endif
specifier|const
name|bool
name|wasTopWindow
init|=
name|window
operator|==
name|topWindow
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|d
operator|->
name|visibleWindows
operator|.
name|removeAll
argument_list|(
name|window
argument_list|)
condition|)
return|return;
if|if
condition|(
name|wasTopWindow
condition|)
name|QWindowSystemInterface
operator|::
name|handleWindowActivated
argument_list|(
name|window
argument_list|,
name|Qt
operator|::
name|OtherFocusReason
argument_list|)
expr_stmt|;
name|handleExpose
argument_list|()
expr_stmt|;
name|QWindowSystemInterface
operator|::
name|flushWindowSystemEvents
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|raise
name|void
name|QWinRTScreen
operator|::
name|raise
parameter_list|(
name|QWindow
modifier|*
name|window
parameter_list|)
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
name|d
operator|->
name|visibleWindows
operator|.
name|removeAll
argument_list|(
name|window
argument_list|)
expr_stmt|;
name|addWindow
argument_list|(
name|window
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|lower
name|void
name|QWinRTScreen
operator|::
name|lower
parameter_list|(
name|QWindow
modifier|*
name|window
parameter_list|)
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
specifier|const
name|bool
name|wasTopWindow
init|=
name|window
operator|==
name|topWindow
argument_list|()
decl_stmt|;
if|if
condition|(
name|wasTopWindow
operator|&&
name|d
operator|->
name|visibleWindows
operator|.
name|size
argument_list|()
operator|==
literal|1
condition|)
return|return;
name|d
operator|->
name|visibleWindows
operator|.
name|removeAll
argument_list|(
name|window
argument_list|)
expr_stmt|;
name|d
operator|->
name|visibleWindows
operator|.
name|append
argument_list|(
name|window
argument_list|)
expr_stmt|;
if|if
condition|(
name|wasTopWindow
condition|)
name|QWindowSystemInterface
operator|::
name|handleWindowActivated
argument_list|(
name|window
argument_list|,
name|Qt
operator|::
name|OtherFocusReason
argument_list|)
expr_stmt|;
name|handleExpose
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|updateWindowTitle
name|void
name|QWinRTScreen
operator|::
name|updateWindowTitle
parameter_list|()
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
name|QWindow
modifier|*
name|window
init|=
name|topWindow
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|window
condition|)
return|return;
specifier|const
name|QString
name|title
init|=
name|window
operator|->
name|title
argument_list|()
decl_stmt|;
name|HStringReference
name|titleRef
argument_list|(
cast|reinterpret_cast
argument_list|<
name|LPCWSTR
argument_list|>
argument_list|(
name|title
operator|.
name|utf16
argument_list|()
argument_list|)
argument_list|,
name|title
operator|.
name|length
argument_list|()
argument_list|)
decl_stmt|;
name|HRESULT
name|hr
init|=
name|d
operator|->
name|view
operator|->
name|put_Title
argument_list|(
name|titleRef
operator|.
name|Get
argument_list|()
argument_list|)
decl_stmt|;
name|RETURN_VOID_IF_FAILED
argument_list|(
literal|"Unable to set window title"
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|handleExpose
name|void
name|QWinRTScreen
operator|::
name|handleExpose
parameter_list|()
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
if|if
condition|(
name|d
operator|->
name|visibleWindows
operator|.
name|isEmpty
argument_list|()
condition|)
return|return;
name|QList
argument_list|<
name|QWindow
modifier|*
argument_list|>
operator|::
name|const_iterator
name|it
init|=
name|d
operator|->
name|visibleWindows
operator|.
name|constBegin
argument_list|()
decl_stmt|;
name|QWindowSystemInterface
operator|::
name|handleExposeEvent
argument_list|(
operator|*
name|it
argument_list|,
name|geometry
argument_list|()
argument_list|)
expr_stmt|;
while|while
condition|(
operator|++
name|it
operator|!=
name|d
operator|->
name|visibleWindows
operator|.
name|constEnd
argument_list|()
condition|)
name|QWindowSystemInterface
operator|::
name|handleExposeEvent
argument_list|(
operator|*
name|it
argument_list|,
name|QRegion
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|onKeyDown
name|HRESULT
name|QWinRTScreen
operator|::
name|onKeyDown
parameter_list|(
name|ABI
operator|::
name|Windows
operator|::
name|UI
operator|::
name|Core
operator|::
name|ICoreWindow
modifier|*
parameter_list|,
name|ABI
operator|::
name|Windows
operator|::
name|UI
operator|::
name|Core
operator|::
name|IKeyEventArgs
modifier|*
name|args
parameter_list|)
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
name|VirtualKey
name|virtualKey
decl_stmt|;
name|HRESULT
name|hr
init|=
name|args
operator|->
name|get_VirtualKey
argument_list|(
operator|&
name|virtualKey
argument_list|)
decl_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|CorePhysicalKeyStatus
name|status
decl_stmt|;
name|hr
operator|=
name|args
operator|->
name|get_KeyStatus
argument_list|(
operator|&
name|status
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|Qt
operator|::
name|Key
name|key
init|=
name|qKeyFromVirtual
argument_list|(
name|virtualKey
argument_list|)
decl_stmt|;
comment|// Defer character key presses to onCharacterReceived
if|if
condition|(
name|key
operator|==
name|Qt
operator|::
name|Key_unknown
operator|||
operator|(
name|key
operator|>=
name|Qt
operator|::
name|Key_Space
operator|&&
name|key
operator|<=
name|Qt
operator|::
name|Key_ydiaeresis
operator|)
condition|)
block|{
name|d
operator|->
name|activeKeys
operator|.
name|insert
argument_list|(
name|key
argument_list|,
name|KeyInfo
argument_list|(
name|virtualKey
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|S_OK
return|;
block|}
name|QWindowSystemInterface
operator|::
name|handleExtendedKeyEvent
argument_list|(
name|topWindow
argument_list|()
argument_list|,
name|QEvent
operator|::
name|KeyPress
argument_list|,
name|key
argument_list|,
name|keyboardModifiers
argument_list|()
argument_list|,
operator|!
name|status
operator|.
name|ScanCode
condition|?
operator|-
literal|1
else|:
name|status
operator|.
name|ScanCode
argument_list|,
name|virtualKey
argument_list|,
literal|0
argument_list|,
name|QString
argument_list|()
argument_list|,
name|status
operator|.
name|RepeatCount
operator|>
literal|1
argument_list|,
operator|!
name|status
operator|.
name|RepeatCount
condition|?
literal|1
else|:
name|status
operator|.
name|RepeatCount
argument_list|,
literal|false
argument_list|)
expr_stmt|;
return|return
name|S_OK
return|;
block|}
end_function
begin_function
DECL|function|onKeyUp
name|HRESULT
name|QWinRTScreen
operator|::
name|onKeyUp
parameter_list|(
name|ABI
operator|::
name|Windows
operator|::
name|UI
operator|::
name|Core
operator|::
name|ICoreWindow
modifier|*
parameter_list|,
name|ABI
operator|::
name|Windows
operator|::
name|UI
operator|::
name|Core
operator|::
name|IKeyEventArgs
modifier|*
name|args
parameter_list|)
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
name|VirtualKey
name|virtualKey
decl_stmt|;
name|HRESULT
name|hr
init|=
name|args
operator|->
name|get_VirtualKey
argument_list|(
operator|&
name|virtualKey
argument_list|)
decl_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|CorePhysicalKeyStatus
name|status
decl_stmt|;
name|hr
operator|=
name|args
operator|->
name|get_KeyStatus
argument_list|(
operator|&
name|status
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|Qt
operator|::
name|Key
name|key
init|=
name|qKeyFromVirtual
argument_list|(
name|virtualKey
argument_list|)
decl_stmt|;
specifier|const
name|KeyInfo
name|info
init|=
name|d
operator|->
name|activeKeys
operator|.
name|take
argument_list|(
name|key
argument_list|)
decl_stmt|;
name|QWindowSystemInterface
operator|::
name|handleExtendedKeyEvent
argument_list|(
name|topWindow
argument_list|()
argument_list|,
name|QEvent
operator|::
name|KeyRelease
argument_list|,
name|key
argument_list|,
name|keyboardModifiers
argument_list|()
argument_list|,
operator|!
name|status
operator|.
name|ScanCode
condition|?
operator|-
literal|1
else|:
name|status
operator|.
name|ScanCode
argument_list|,
name|virtualKey
argument_list|,
literal|0
argument_list|,
name|info
operator|.
name|text
argument_list|,
name|status
operator|.
name|RepeatCount
operator|>
literal|1
argument_list|,
operator|!
name|status
operator|.
name|RepeatCount
condition|?
literal|1
else|:
name|status
operator|.
name|RepeatCount
argument_list|,
literal|false
argument_list|)
expr_stmt|;
return|return
name|S_OK
return|;
block|}
end_function
begin_function
DECL|function|onCharacterReceived
name|HRESULT
name|QWinRTScreen
operator|::
name|onCharacterReceived
parameter_list|(
name|ICoreWindow
modifier|*
parameter_list|,
name|ICharacterReceivedEventArgs
modifier|*
name|args
parameter_list|)
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
name|quint32
name|keyCode
decl_stmt|;
name|HRESULT
name|hr
init|=
name|args
operator|->
name|get_KeyCode
argument_list|(
operator|&
name|keyCode
argument_list|)
decl_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
name|CorePhysicalKeyStatus
name|status
decl_stmt|;
name|hr
operator|=
name|args
operator|->
name|get_KeyStatus
argument_list|(
operator|&
name|status
argument_list|)
expr_stmt|;
name|Q_ASSERT_SUCCEEDED
argument_list|(
name|hr
argument_list|)
expr_stmt|;
comment|// Don't generate character events for non-printables; the meta key stage is enough
if|if
condition|(
name|qIsNonPrintable
argument_list|(
name|keyCode
argument_list|)
condition|)
return|return
name|S_OK
return|;
specifier|const
name|Qt
operator|::
name|KeyboardModifiers
name|modifiers
init|=
name|keyboardModifiers
argument_list|()
decl_stmt|;
specifier|const
name|Qt
operator|::
name|Key
name|key
init|=
name|qKeyFromCode
argument_list|(
name|keyCode
argument_list|,
name|modifiers
argument_list|)
decl_stmt|;
specifier|const
name|QString
name|text
init|=
name|QChar
argument_list|(
name|keyCode
argument_list|)
decl_stmt|;
specifier|const
name|quint32
name|virtualKey
init|=
name|d
operator|->
name|activeKeys
operator|.
name|value
argument_list|(
name|key
argument_list|)
operator|.
name|virtualKey
decl_stmt|;
name|QWindowSystemInterface
operator|::
name|handleExtendedKeyEvent
argument_list|(
name|topWindow
argument_list|()
argument_list|,
name|QEvent
operator|::
name|KeyPress
argument_list|,
name|key
argument_list|,
name|modifiers
argument_list|,
operator|!
name|status
operator|.
name|ScanCode
condition|?
operator|-
literal|1
else|:
name|status
operator|.
name|ScanCode
argument_list|,
name|virtualKey
argument_list|,
literal|0
argument_list|,
name|text
argument_list|,
name|status
operator|.
name|RepeatCount
operator|>
literal|1
argument_list|,
operator|!
name|status
operator|.
name|RepeatCount
condition|?
literal|1
else|:
name|status
operator|.
name|RepeatCount
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|d
operator|->
name|activeKeys
operator|.
name|insert
argument_list|(
name|key
argument_list|,
name|KeyInfo
argument_list|(
name|text
argument_list|,
name|virtualKey
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|S_OK
return|;
block|}
end_function
begin_function
DECL|function|onPointerEntered
name|HRESULT
name|QWinRTScreen
operator|::
name|onPointerEntered
parameter_list|(
name|ICoreWindow
modifier|*
parameter_list|,
name|IPointerEventArgs
modifier|*
name|args
parameter_list|)
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
name|ComPtr
argument_list|<
name|IPointerPoint
argument_list|>
name|pointerPoint
decl_stmt|;
if|if
condition|(
name|SUCCEEDED
argument_list|(
name|args
operator|->
name|get_CurrentPoint
argument_list|(
operator|&
name|pointerPoint
argument_list|)
argument_list|)
condition|)
block|{
comment|// Assumes full-screen window
name|Point
name|point
decl_stmt|;
name|pointerPoint
operator|->
name|get_Position
argument_list|(
operator|&
name|point
argument_list|)
expr_stmt|;
name|QPoint
name|pos
argument_list|(
name|point
operator|.
name|X
operator|*
name|d
operator|->
name|scaleFactor
argument_list|,
name|point
operator|.
name|Y
operator|*
name|d
operator|->
name|scaleFactor
argument_list|)
decl_stmt|;
name|QWindowSystemInterface
operator|::
name|handleEnterEvent
argument_list|(
name|topWindow
argument_list|()
argument_list|,
name|pos
argument_list|,
name|pos
argument_list|)
expr_stmt|;
block|}
return|return
name|S_OK
return|;
block|}
end_function
begin_function
DECL|function|onPointerExited
name|HRESULT
name|QWinRTScreen
operator|::
name|onPointerExited
parameter_list|(
name|ICoreWindow
modifier|*
parameter_list|,
name|IPointerEventArgs
modifier|*
parameter_list|)
block|{
name|QWindowSystemInterface
operator|::
name|handleLeaveEvent
argument_list|(
literal|0
argument_list|)
expr_stmt|;
return|return
name|S_OK
return|;
block|}
end_function
begin_function
DECL|function|onPointerUpdated
name|HRESULT
name|QWinRTScreen
operator|::
name|onPointerUpdated
parameter_list|(
name|ICoreWindow
modifier|*
parameter_list|,
name|IPointerEventArgs
modifier|*
name|args
parameter_list|)
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
name|ComPtr
argument_list|<
name|IPointerPoint
argument_list|>
name|pointerPoint
decl_stmt|;
if|if
condition|(
name|FAILED
argument_list|(
name|args
operator|->
name|get_CurrentPoint
argument_list|(
operator|&
name|pointerPoint
argument_list|)
argument_list|)
condition|)
return|return
name|E_INVALIDARG
return|;
comment|// Common traits - point, modifiers, properties
name|Point
name|point
decl_stmt|;
name|pointerPoint
operator|->
name|get_Position
argument_list|(
operator|&
name|point
argument_list|)
expr_stmt|;
name|QPointF
name|pos
argument_list|(
name|point
operator|.
name|X
operator|*
name|d
operator|->
name|scaleFactor
argument_list|,
name|point
operator|.
name|Y
operator|*
name|d
operator|->
name|scaleFactor
argument_list|)
decl_stmt|;
name|QPointF
name|localPos
init|=
name|pos
decl_stmt|;
if|if
condition|(
name|topWindow
argument_list|()
condition|)
block|{
specifier|const
name|QPointF
name|globalPosDelta
init|=
name|pos
operator|-
name|pos
operator|.
name|toPoint
argument_list|()
decl_stmt|;
name|localPos
operator|=
name|topWindow
argument_list|()
operator|->
name|mapFromGlobal
argument_list|(
name|pos
operator|.
name|toPoint
argument_list|()
argument_list|)
operator|+
name|globalPosDelta
expr_stmt|;
block|}
name|VirtualKeyModifiers
name|modifiers
decl_stmt|;
name|args
operator|->
name|get_KeyModifiers
argument_list|(
operator|&
name|modifiers
argument_list|)
expr_stmt|;
name|Qt
operator|::
name|KeyboardModifiers
name|mods
decl_stmt|;
if|if
condition|(
name|modifiers
operator|&
name|VirtualKeyModifiers_Control
condition|)
name|mods
operator||=
name|Qt
operator|::
name|ControlModifier
expr_stmt|;
if|if
condition|(
name|modifiers
operator|&
name|VirtualKeyModifiers_Menu
condition|)
name|mods
operator||=
name|Qt
operator|::
name|AltModifier
expr_stmt|;
if|if
condition|(
name|modifiers
operator|&
name|VirtualKeyModifiers_Shift
condition|)
name|mods
operator||=
name|Qt
operator|::
name|ShiftModifier
expr_stmt|;
if|if
condition|(
name|modifiers
operator|&
name|VirtualKeyModifiers_Windows
condition|)
name|mods
operator||=
name|Qt
operator|::
name|MetaModifier
expr_stmt|;
name|ComPtr
argument_list|<
name|IPointerPointProperties
argument_list|>
name|properties
decl_stmt|;
if|if
condition|(
name|FAILED
argument_list|(
name|pointerPoint
operator|->
name|get_Properties
argument_list|(
operator|&
name|properties
argument_list|)
argument_list|)
condition|)
return|return
name|E_INVALIDARG
return|;
name|ComPtr
argument_list|<
name|IPointerDevice
argument_list|>
name|pointerDevice
decl_stmt|;
name|HRESULT
name|hr
init|=
name|pointerPoint
operator|->
name|get_PointerDevice
argument_list|(
operator|&
name|pointerDevice
argument_list|)
decl_stmt|;
name|RETURN_OK_IF_FAILED
argument_list|(
literal|"Failed to get pointer device."
argument_list|)
expr_stmt|;
name|PointerDeviceType
name|pointerDeviceType
decl_stmt|;
name|hr
operator|=
name|pointerDevice
operator|->
name|get_PointerDeviceType
argument_list|(
operator|&
name|pointerDeviceType
argument_list|)
expr_stmt|;
name|RETURN_OK_IF_FAILED
argument_list|(
literal|"Failed to get pointer device type."
argument_list|)
expr_stmt|;
switch|switch
condition|(
name|pointerDeviceType
condition|)
block|{
case|case
name|PointerDeviceType_Mouse
case|:
block|{
name|qint32
name|delta
decl_stmt|;
name|properties
operator|->
name|get_MouseWheelDelta
argument_list|(
operator|&
name|delta
argument_list|)
expr_stmt|;
if|if
condition|(
name|delta
condition|)
block|{
name|boolean
name|isHorizontal
decl_stmt|;
name|properties
operator|->
name|get_IsHorizontalMouseWheel
argument_list|(
operator|&
name|isHorizontal
argument_list|)
expr_stmt|;
name|QPoint
name|angleDelta
argument_list|(
name|isHorizontal
condition|?
name|delta
else|:
literal|0
argument_list|,
name|isHorizontal
condition|?
literal|0
else|:
name|delta
argument_list|)
decl_stmt|;
name|QWindowSystemInterface
operator|::
name|handleWheelEvent
argument_list|(
name|topWindow
argument_list|()
argument_list|,
name|localPos
argument_list|,
name|pos
argument_list|,
name|QPoint
argument_list|()
argument_list|,
name|angleDelta
argument_list|,
name|mods
argument_list|)
expr_stmt|;
break|break;
block|}
name|boolean
name|isPressed
decl_stmt|;
name|Qt
operator|::
name|MouseButtons
name|buttons
init|=
name|Qt
operator|::
name|NoButton
decl_stmt|;
name|properties
operator|->
name|get_IsLeftButtonPressed
argument_list|(
operator|&
name|isPressed
argument_list|)
expr_stmt|;
if|if
condition|(
name|isPressed
condition|)
name|buttons
operator||=
name|Qt
operator|::
name|LeftButton
expr_stmt|;
name|properties
operator|->
name|get_IsMiddleButtonPressed
argument_list|(
operator|&
name|isPressed
argument_list|)
expr_stmt|;
if|if
condition|(
name|isPressed
condition|)
name|buttons
operator||=
name|Qt
operator|::
name|MiddleButton
expr_stmt|;
name|properties
operator|->
name|get_IsRightButtonPressed
argument_list|(
operator|&
name|isPressed
argument_list|)
expr_stmt|;
if|if
condition|(
name|isPressed
condition|)
name|buttons
operator||=
name|Qt
operator|::
name|RightButton
expr_stmt|;
name|properties
operator|->
name|get_IsXButton1Pressed
argument_list|(
operator|&
name|isPressed
argument_list|)
expr_stmt|;
if|if
condition|(
name|isPressed
condition|)
name|buttons
operator||=
name|Qt
operator|::
name|XButton1
expr_stmt|;
name|properties
operator|->
name|get_IsXButton2Pressed
argument_list|(
operator|&
name|isPressed
argument_list|)
expr_stmt|;
if|if
condition|(
name|isPressed
condition|)
name|buttons
operator||=
name|Qt
operator|::
name|XButton2
expr_stmt|;
name|QWindowSystemInterface
operator|::
name|handleMouseEvent
argument_list|(
name|topWindow
argument_list|()
argument_list|,
name|localPos
argument_list|,
name|pos
argument_list|,
name|buttons
argument_list|,
name|mods
argument_list|)
expr_stmt|;
break|break;
block|}
case|case
name|PointerDeviceType_Touch
case|:
block|{
if|if
condition|(
operator|!
name|d
operator|->
name|touchDevice
condition|)
block|{
name|d
operator|->
name|touchDevice
operator|=
operator|new
name|QTouchDevice
expr_stmt|;
name|d
operator|->
name|touchDevice
operator|->
name|setName
argument_list|(
name|QStringLiteral
argument_list|(
literal|"WinRTTouchScreen"
argument_list|)
argument_list|)
expr_stmt|;
name|d
operator|->
name|touchDevice
operator|->
name|setType
argument_list|(
name|QTouchDevice
operator|::
name|TouchScreen
argument_list|)
expr_stmt|;
name|d
operator|->
name|touchDevice
operator|->
name|setCapabilities
argument_list|(
name|QTouchDevice
operator|::
name|Position
operator||
name|QTouchDevice
operator|::
name|Area
operator||
name|QTouchDevice
operator|::
name|Pressure
operator||
name|QTouchDevice
operator|::
name|NormalizedPosition
argument_list|)
expr_stmt|;
name|QWindowSystemInterface
operator|::
name|registerTouchDevice
argument_list|(
name|d
operator|->
name|touchDevice
argument_list|)
expr_stmt|;
block|}
name|quint32
name|id
decl_stmt|;
name|pointerPoint
operator|->
name|get_PointerId
argument_list|(
operator|&
name|id
argument_list|)
expr_stmt|;
name|Rect
name|area
decl_stmt|;
name|properties
operator|->
name|get_ContactRect
argument_list|(
operator|&
name|area
argument_list|)
expr_stmt|;
name|float
name|pressure
decl_stmt|;
name|properties
operator|->
name|get_Pressure
argument_list|(
operator|&
name|pressure
argument_list|)
expr_stmt|;
name|QHash
argument_list|<
name|quint32
argument_list|,
name|QWindowSystemInterface
operator|::
name|TouchPoint
argument_list|>
operator|::
name|iterator
name|it
init|=
name|d
operator|->
name|touchPoints
operator|.
name|find
argument_list|(
name|id
argument_list|)
decl_stmt|;
if|if
condition|(
name|it
operator|!=
name|d
operator|->
name|touchPoints
operator|.
name|end
argument_list|()
condition|)
block|{
name|boolean
name|isPressed
decl_stmt|;
ifndef|#
directive|ifndef
name|Q_OS_WINPHONE
name|pointerPoint
operator|->
name|get_IsInContact
argument_list|(
operator|&
name|isPressed
argument_list|)
expr_stmt|;
else|#
directive|else
name|properties
operator|->
name|get_IsLeftButtonPressed
argument_list|(
operator|&
name|isPressed
argument_list|)
expr_stmt|;
comment|// IsInContact not reliable on phone
endif|#
directive|endif
name|it
operator|.
name|value
argument_list|()
operator|.
name|state
operator|=
name|isPressed
condition|?
name|Qt
operator|::
name|TouchPointMoved
else|:
name|Qt
operator|::
name|TouchPointReleased
expr_stmt|;
block|}
else|else
block|{
name|it
operator|=
name|d
operator|->
name|touchPoints
operator|.
name|insert
argument_list|(
name|id
argument_list|,
name|QWindowSystemInterface
operator|::
name|TouchPoint
argument_list|()
argument_list|)
expr_stmt|;
name|it
operator|.
name|value
argument_list|()
operator|.
name|state
operator|=
name|Qt
operator|::
name|TouchPointPressed
expr_stmt|;
name|it
operator|.
name|value
argument_list|()
operator|.
name|id
operator|=
name|id
expr_stmt|;
block|}
name|it
operator|.
name|value
argument_list|()
operator|.
name|area
operator|=
name|QRectF
argument_list|(
name|area
operator|.
name|X
operator|*
name|d
operator|->
name|scaleFactor
argument_list|,
name|area
operator|.
name|Y
operator|*
name|d
operator|->
name|scaleFactor
argument_list|,
name|area
operator|.
name|Width
operator|*
name|d
operator|->
name|scaleFactor
argument_list|,
name|area
operator|.
name|Height
operator|*
name|d
operator|->
name|scaleFactor
argument_list|)
expr_stmt|;
name|it
operator|.
name|value
argument_list|()
operator|.
name|normalPosition
operator|=
name|QPointF
argument_list|(
name|point
operator|.
name|X
operator|/
name|d
operator|->
name|logicalSize
operator|.
name|width
argument_list|()
argument_list|,
name|point
operator|.
name|Y
operator|/
name|d
operator|->
name|logicalSize
operator|.
name|height
argument_list|()
argument_list|)
expr_stmt|;
name|it
operator|.
name|value
argument_list|()
operator|.
name|pressure
operator|=
name|pressure
expr_stmt|;
name|QWindowSystemInterface
operator|::
name|handleTouchEvent
argument_list|(
name|topWindow
argument_list|()
argument_list|,
name|d
operator|->
name|touchDevice
argument_list|,
name|d
operator|->
name|touchPoints
operator|.
name|values
argument_list|()
argument_list|,
name|mods
argument_list|)
expr_stmt|;
comment|// Remove released points, station others
for|for
control|(
name|QHash
argument_list|<
name|quint32
argument_list|,
name|QWindowSystemInterface
operator|::
name|TouchPoint
argument_list|>
operator|::
name|iterator
name|i
init|=
name|d
operator|->
name|touchPoints
operator|.
name|begin
argument_list|()
init|;
name|i
operator|!=
name|d
operator|->
name|touchPoints
operator|.
name|end
argument_list|()
condition|;
control|)
block|{
if|if
condition|(
name|i
operator|.
name|value
argument_list|()
operator|.
name|state
operator|==
name|Qt
operator|::
name|TouchPointReleased
condition|)
name|i
operator|=
name|d
operator|->
name|touchPoints
operator|.
name|erase
argument_list|(
name|i
argument_list|)
expr_stmt|;
else|else
operator|(
name|i
operator|++
operator|)
operator|.
name|value
argument_list|()
operator|.
name|state
operator|=
name|Qt
operator|::
name|TouchPointStationary
expr_stmt|;
block|}
break|break;
block|}
case|case
name|PointerDeviceType_Pen
case|:
block|{
name|quint32
name|id
decl_stmt|;
name|pointerPoint
operator|->
name|get_PointerId
argument_list|(
operator|&
name|id
argument_list|)
expr_stmt|;
name|boolean
name|isPressed
decl_stmt|;
name|pointerPoint
operator|->
name|get_IsInContact
argument_list|(
operator|&
name|isPressed
argument_list|)
expr_stmt|;
name|boolean
name|isEraser
decl_stmt|;
name|properties
operator|->
name|get_IsEraser
argument_list|(
operator|&
name|isEraser
argument_list|)
expr_stmt|;
name|int
name|pointerType
init|=
name|isEraser
condition|?
literal|3
else|:
literal|1
decl_stmt|;
name|float
name|pressure
decl_stmt|;
name|properties
operator|->
name|get_Pressure
argument_list|(
operator|&
name|pressure
argument_list|)
expr_stmt|;
name|float
name|xTilt
decl_stmt|;
name|properties
operator|->
name|get_XTilt
argument_list|(
operator|&
name|xTilt
argument_list|)
expr_stmt|;
name|float
name|yTilt
decl_stmt|;
name|properties
operator|->
name|get_YTilt
argument_list|(
operator|&
name|yTilt
argument_list|)
expr_stmt|;
name|float
name|rotation
decl_stmt|;
name|properties
operator|->
name|get_Twist
argument_list|(
operator|&
name|rotation
argument_list|)
expr_stmt|;
name|QWindowSystemInterface
operator|::
name|handleTabletEvent
argument_list|(
name|topWindow
argument_list|()
argument_list|,
name|isPressed
argument_list|,
name|pos
argument_list|,
name|pos
argument_list|,
literal|0
argument_list|,
name|pointerType
argument_list|,
name|pressure
argument_list|,
name|xTilt
argument_list|,
name|yTilt
argument_list|,
literal|0
argument_list|,
name|rotation
argument_list|,
literal|0
argument_list|,
name|id
argument_list|,
name|mods
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
return|return
name|S_OK
return|;
block|}
end_function
begin_function
DECL|function|onSizeChanged
name|HRESULT
name|QWinRTScreen
operator|::
name|onSizeChanged
parameter_list|(
name|ICoreWindow
modifier|*
parameter_list|,
name|IWindowSizeChangedEventArgs
modifier|*
parameter_list|)
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
name|Rect
name|size
decl_stmt|;
name|HRESULT
name|hr
decl_stmt|;
name|hr
operator|=
name|d
operator|->
name|coreWindow
operator|->
name|get_Bounds
argument_list|(
operator|&
name|size
argument_list|)
expr_stmt|;
name|RETURN_OK_IF_FAILED
argument_list|(
literal|"Failed to get window bounds"
argument_list|)
expr_stmt|;
name|d
operator|->
name|logicalSize
operator|=
name|QSizeF
argument_list|(
name|size
operator|.
name|Width
argument_list|,
name|size
operator|.
name|Height
argument_list|)
expr_stmt|;
name|QWindowSystemInterface
operator|::
name|handleScreenGeometryChange
argument_list|(
name|screen
argument_list|()
argument_list|,
name|geometry
argument_list|()
argument_list|,
name|availableGeometry
argument_list|()
argument_list|)
expr_stmt|;
name|QPlatformScreen
operator|::
name|resizeMaximizedWindows
argument_list|()
expr_stmt|;
name|handleExpose
argument_list|()
expr_stmt|;
return|return
name|S_OK
return|;
block|}
end_function
begin_function
DECL|function|onActivated
name|HRESULT
name|QWinRTScreen
operator|::
name|onActivated
parameter_list|(
name|ICoreWindow
modifier|*
parameter_list|,
name|IWindowActivatedEventArgs
modifier|*
name|args
parameter_list|)
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
name|CoreWindowActivationState
name|activationState
decl_stmt|;
name|args
operator|->
name|get_WindowActivationState
argument_list|(
operator|&
name|activationState
argument_list|)
expr_stmt|;
if|if
condition|(
name|activationState
operator|==
name|CoreWindowActivationState_Deactivated
condition|)
block|{
name|QWindowSystemInterface
operator|::
name|handleApplicationStateChanged
argument_list|(
name|Qt
operator|::
name|ApplicationInactive
argument_list|)
expr_stmt|;
return|return
name|S_OK
return|;
block|}
comment|// Activate topWindow
if|if
condition|(
operator|!
name|d
operator|->
name|visibleWindows
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|Qt
operator|::
name|FocusReason
name|focusReason
init|=
name|activationState
operator|==
name|CoreWindowActivationState_PointerActivated
condition|?
name|Qt
operator|::
name|MouseFocusReason
else|:
name|Qt
operator|::
name|ActiveWindowFocusReason
decl_stmt|;
name|QWindowSystemInterface
operator|::
name|handleWindowActivated
argument_list|(
name|topWindow
argument_list|()
argument_list|,
name|focusReason
argument_list|)
expr_stmt|;
block|}
return|return
name|S_OK
return|;
block|}
end_function
begin_function
DECL|function|onClosed
name|HRESULT
name|QWinRTScreen
operator|::
name|onClosed
parameter_list|(
name|ICoreWindow
modifier|*
parameter_list|,
name|ICoreWindowEventArgs
modifier|*
parameter_list|)
block|{
foreach|foreach
control|(
name|QWindow
modifier|*
name|w
decl|,
name|QGuiApplication
operator|::
name|topLevelWindows
argument_list|()
control|)
name|QWindowSystemInterface
operator|::
name|handleCloseEvent
argument_list|(
name|w
argument_list|)
expr_stmt|;
return|return
name|S_OK
return|;
block|}
end_function
begin_function
DECL|function|onVisibilityChanged
name|HRESULT
name|QWinRTScreen
operator|::
name|onVisibilityChanged
parameter_list|(
name|ICoreWindow
modifier|*
parameter_list|,
name|IVisibilityChangedEventArgs
modifier|*
name|args
parameter_list|)
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
name|boolean
name|visible
decl_stmt|;
name|HRESULT
name|hr
init|=
name|args
condition|?
name|args
operator|->
name|get_Visible
argument_list|(
operator|&
name|visible
argument_list|)
else|:
name|d
operator|->
name|coreWindow
operator|->
name|get_Visible
argument_list|(
operator|&
name|visible
argument_list|)
decl_stmt|;
name|RETURN_OK_IF_FAILED
argument_list|(
literal|"Failed to get visbile."
argument_list|)
expr_stmt|;
name|QWindowSystemInterface
operator|::
name|handleApplicationStateChanged
argument_list|(
name|visible
condition|?
name|Qt
operator|::
name|ApplicationActive
else|:
name|Qt
operator|::
name|ApplicationHidden
argument_list|)
expr_stmt|;
if|if
condition|(
name|visible
condition|)
name|handleExpose
argument_list|()
expr_stmt|;
return|return
name|S_OK
return|;
block|}
end_function
begin_function
DECL|function|onOrientationChanged
name|HRESULT
name|QWinRTScreen
operator|::
name|onOrientationChanged
parameter_list|(
name|IDisplayInformation
modifier|*
parameter_list|,
name|IInspectable
modifier|*
parameter_list|)
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
name|DisplayOrientations
name|displayOrientation
decl_stmt|;
name|HRESULT
name|hr
init|=
name|d
operator|->
name|displayInformation
operator|->
name|get_CurrentOrientation
argument_list|(
operator|&
name|displayOrientation
argument_list|)
decl_stmt|;
name|RETURN_OK_IF_FAILED
argument_list|(
literal|"Failed to get current orientations."
argument_list|)
expr_stmt|;
name|Qt
operator|::
name|ScreenOrientation
name|newOrientation
init|=
cast|static_cast
argument_list|<
name|Qt
operator|::
name|ScreenOrientation
argument_list|>
argument_list|(
cast|static_cast
argument_list|<
name|int
argument_list|>
argument_list|(
name|qtOrientationsFromNative
argument_list|(
name|displayOrientation
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|d
operator|->
name|orientation
operator|!=
name|newOrientation
condition|)
block|{
name|d
operator|->
name|orientation
operator|=
name|newOrientation
expr_stmt|;
ifdef|#
directive|ifdef
name|Q_OS_WINPHONE
name|onSizeChanged
argument_list|(
literal|nullptr
argument_list|,
literal|nullptr
argument_list|)
expr_stmt|;
endif|#
directive|endif
name|QWindowSystemInterface
operator|::
name|handleScreenOrientationChange
argument_list|(
name|screen
argument_list|()
argument_list|,
name|d
operator|->
name|orientation
argument_list|)
expr_stmt|;
name|handleExpose
argument_list|()
expr_stmt|;
comment|// Clean broken frames caused by race between Qt and ANGLE
block|}
return|return
name|S_OK
return|;
block|}
end_function
begin_function
DECL|function|onDpiChanged
name|HRESULT
name|QWinRTScreen
operator|::
name|onDpiChanged
parameter_list|(
name|IDisplayInformation
modifier|*
parameter_list|,
name|IInspectable
modifier|*
parameter_list|)
block|{
name|Q_D
argument_list|(
name|QWinRTScreen
argument_list|)
expr_stmt|;
name|HRESULT
name|hr
decl_stmt|;
ifdef|#
directive|ifdef
name|Q_OS_WINPHONE
name|ComPtr
argument_list|<
name|IDisplayInformation2
argument_list|>
name|displayInformation
decl_stmt|;
name|hr
operator|=
name|d
operator|->
name|displayInformation
operator|.
name|As
argument_list|(
operator|&
name|displayInformation
argument_list|)
expr_stmt|;
name|RETURN_OK_IF_FAILED
argument_list|(
literal|"Failed to cast display information."
argument_list|)
expr_stmt|;
name|hr
operator|=
name|displayInformation
operator|->
name|get_RawPixelsPerViewPixel
argument_list|(
operator|&
name|d
operator|->
name|scaleFactor
argument_list|)
expr_stmt|;
else|#
directive|else
name|ResolutionScale
name|resolutionScale
decl_stmt|;
name|hr
operator|=
name|d
operator|->
name|displayInformation
operator|->
name|get_ResolutionScale
argument_list|(
operator|&
name|resolutionScale
argument_list|)
expr_stmt|;
name|d
operator|->
name|scaleFactor
operator|=
name|qreal
argument_list|(
name|resolutionScale
argument_list|)
operator|/
literal|100
expr_stmt|;
endif|#
directive|endif
name|RETURN_OK_IF_FAILED
argument_list|(
literal|"Failed to get scale factor"
argument_list|)
expr_stmt|;
name|FLOAT
name|dpi
decl_stmt|;
name|hr
operator|=
name|d
operator|->
name|displayInformation
operator|->
name|get_LogicalDpi
argument_list|(
operator|&
name|dpi
argument_list|)
expr_stmt|;
name|RETURN_OK_IF_FAILED
argument_list|(
literal|"Failed to get logical DPI."
argument_list|)
expr_stmt|;
name|d
operator|->
name|logicalDpi
operator|=
name|dpi
expr_stmt|;
name|hr
operator|=
name|d
operator|->
name|displayInformation
operator|->
name|get_RawDpiX
argument_list|(
operator|&
name|dpi
argument_list|)
expr_stmt|;
name|RETURN_OK_IF_FAILED
argument_list|(
literal|"Failed to get x raw DPI."
argument_list|)
expr_stmt|;
name|d
operator|->
name|physicalDpi
operator|.
name|first
operator|=
name|dpi
condition|?
name|dpi
else|:
literal|96.0
expr_stmt|;
name|hr
operator|=
name|d
operator|->
name|displayInformation
operator|->
name|get_RawDpiY
argument_list|(
operator|&
name|dpi
argument_list|)
expr_stmt|;
name|RETURN_OK_IF_FAILED
argument_list|(
literal|"Failed to get y raw DPI."
argument_list|)
expr_stmt|;
name|d
operator|->
name|physicalDpi
operator|.
name|second
operator|=
name|dpi
condition|?
name|dpi
else|:
literal|96.0
expr_stmt|;
return|return
name|S_OK
return|;
block|}
end_function
begin_ifdef
ifdef|#
directive|ifdef
name|Q_OS_WINPHONE
end_ifdef
begin_function
DECL|function|onStatusBarShowing
name|HRESULT
name|QWinRTScreen
operator|::
name|onStatusBarShowing
parameter_list|(
name|IStatusBar
modifier|*
parameter_list|,
name|IInspectable
modifier|*
parameter_list|)
block|{
name|onSizeChanged
argument_list|(
literal|nullptr
argument_list|,
literal|nullptr
argument_list|)
expr_stmt|;
return|return
name|S_OK
return|;
block|}
end_function
begin_function
DECL|function|onStatusBarHiding
name|HRESULT
name|QWinRTScreen
operator|::
name|onStatusBarHiding
parameter_list|(
name|IStatusBar
modifier|*
parameter_list|,
name|IInspectable
modifier|*
parameter_list|)
block|{
name|onSizeChanged
argument_list|(
literal|nullptr
argument_list|,
literal|nullptr
argument_list|)
expr_stmt|;
return|return
name|S_OK
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|//Q_OS_WINPHONE
end_comment
begin_macro
name|QT_END_NAMESPACE
end_macro
end_unit
