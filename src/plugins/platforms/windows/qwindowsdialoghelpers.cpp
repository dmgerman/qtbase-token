begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2015 The Qt Company Ltd. ** Contact: http://www.qt.io/licensing/ ** ** This file is part of the plugins of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL21$ ** Commercial License Usage ** Licensees holding valid commercial Qt licenses may use this file in ** accordance with the commercial license agreement provided with the ** Software or, alternatively, in accordance with the terms contained in ** a written agreement between you and The Qt Company. For licensing terms ** and conditions see http://www.qt.io/terms-conditions. For further ** information use the contact form at http://www.qt.io/contact-us. ** ** GNU Lesser General Public License Usage ** Alternatively, this file may be used under the terms of the GNU Lesser ** General Public License version 2.1 or version 3 as published by the Free ** Software Foundation and appearing in the file LICENSE.LGPLv21 and ** LICENSE.LGPLv3 included in the packaging of this file. Please review the ** following information to ensure the GNU Lesser General Public License ** requirements will be met: https://www.gnu.org/licenses/lgpl.html and ** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html. ** ** As a special exception, The Qt Company gives you certain additional ** rights. These rights are described in The Qt Company LGPL Exception ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package. ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_define
DECL|macro|QT_NO_URL_CAST_FROM_STRING
define|#
directive|define
name|QT_NO_URL_CAST_FROM_STRING
value|1
end_define
begin_define
DECL|macro|_WIN32_WINNT
define|#
directive|define
name|_WIN32_WINNT
value|0x0600
end_define
begin_include
include|#
directive|include
file|"qwindowsdialoghelpers.h"
end_include
begin_include
include|#
directive|include
file|"qwindowscontext.h"
end_include
begin_include
include|#
directive|include
file|"qwindowswindow.h"
end_include
begin_include
include|#
directive|include
file|"qwindowsintegration.h"
end_include
begin_include
include|#
directive|include
file|"qwindowstheme.h"
end_include
begin_comment
comment|// Color conversion helpers
end_comment
begin_include
include|#
directive|include
file|<QtGui/QGuiApplication>
end_include
begin_include
include|#
directive|include
file|<QtGui/QColor>
end_include
begin_include
include|#
directive|include
file|<QtCore/QDebug>
end_include
begin_include
include|#
directive|include
file|<QtCore/QRegExp>
end_include
begin_include
include|#
directive|include
file|<QtCore/QTimer>
end_include
begin_include
include|#
directive|include
file|<QtCore/QDir>
end_include
begin_include
include|#
directive|include
file|<QtCore/QScopedArrayPointer>
end_include
begin_include
include|#
directive|include
file|<QtCore/QSharedPointer>
end_include
begin_include
include|#
directive|include
file|<QtCore/QObject>
end_include
begin_include
include|#
directive|include
file|<QtCore/QThread>
end_include
begin_include
include|#
directive|include
file|<QtCore/QSysInfo>
end_include
begin_include
include|#
directive|include
file|<QtCore/QSharedData>
end_include
begin_include
include|#
directive|include
file|<QtCore/QExplicitlySharedDataPointer>
end_include
begin_include
include|#
directive|include
file|<QtCore/QMutex>
end_include
begin_include
include|#
directive|include
file|<QtCore/QMutexLocker>
end_include
begin_include
include|#
directive|include
file|<QtCore/QUuid>
end_include
begin_include
include|#
directive|include
file|<QtCore/QRegularExpression>
end_include
begin_include
include|#
directive|include
file|<QtCore/private/qsystemlibrary_p.h>
end_include
begin_include
include|#
directive|include
file|<algorithm>
end_include
begin_include
include|#
directive|include
file|"qtwindows_additional.h"
end_include
begin_comment
comment|// #define USE_NATIVE_COLOR_DIALOG /* Testing purposes only */
end_comment
begin_ifdef
ifdef|#
directive|ifdef
name|Q_CC_MINGW
end_ifdef
begin_comment
comment|/* Add missing declarations for MinGW */
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|__IShellLibrary_FWD_DEFINED__
end_ifndef
begin_comment
comment|/* Constants obtained by running the below stream operator for  * CLSID, IID on the constants in the Windows SDK libraries. */
end_comment
begin_decl_stmt
DECL|variable|IID_IFileOpenDialog
specifier|static
specifier|const
name|IID
name|IID_IFileOpenDialog
init|=
block|{
literal|0xd57c7288
block|,
literal|0xd4ad
block|,
literal|0x4768
block|,
block|{
literal|0xbe
block|,
literal|0x02
block|,
literal|0x9d
block|,
literal|0x96
block|,
literal|0x95
block|,
literal|0x32
block|,
literal|0xd9
block|,
literal|0x60
block|}
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|variable|IID_IFileSaveDialog
specifier|static
specifier|const
name|IID
name|IID_IFileSaveDialog
init|=
block|{
literal|0x84bccd23
block|,
literal|0x5fde
block|,
literal|0x4cdb
block|,
block|{
literal|0xae
block|,
literal|0xa4
block|,
literal|0xaf
block|,
literal|0x64
block|,
literal|0xb8
block|,
literal|0x3d
block|,
literal|0x78
block|,
literal|0xab
block|}
block|}
decl_stmt|;
end_decl_stmt
begin_ifdef
ifdef|#
directive|ifdef
name|__MINGW64_VERSION_MAJOR
end_ifdef
begin_decl_stmt
DECL|variable|q_IID_IShellItem
specifier|static
specifier|const
name|IID
name|q_IID_IShellItem
init|=
block|{
literal|0x43826d1e
block|,
literal|0xe718
block|,
literal|0x42ee
block|,
block|{
literal|0xbc
block|,
literal|0x55
block|,
literal|0xa1
block|,
literal|0xe2
block|,
literal|0x61
block|,
literal|0xc3
block|,
literal|0x7b
block|,
literal|0xfe
block|}
block|}
decl_stmt|;
end_decl_stmt
begin_define
DECL|macro|IID_IShellItem
define|#
directive|define
name|IID_IShellItem
value|q_IID_IShellItem
end_define
begin_else
else|#
directive|else
end_else
begin_decl_stmt
DECL|variable|IID_IShellItem
specifier|static
specifier|const
name|IID
name|IID_IShellItem
init|=
block|{
literal|0x43826d1e
block|,
literal|0xe718
block|,
literal|0x42ee
block|,
block|{
literal|0xbc
block|,
literal|0x55
block|,
literal|0xa1
block|,
literal|0xe2
block|,
literal|0x61
block|,
literal|0xc3
block|,
literal|0x7b
block|,
literal|0xfe
block|}
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|variable|IID_IShellItemArray
specifier|static
specifier|const
name|IID
name|IID_IShellItemArray
init|=
block|{
literal|0xb63ea76d
block|,
literal|0x1f85
block|,
literal|0x456f
block|,
block|{
literal|0xa1
block|,
literal|0x9c
block|,
literal|0x48
block|,
literal|0x15
block|,
literal|0x9e
block|,
literal|0xfa
block|,
literal|0x85
block|,
literal|0x8b
block|}
block|}
decl_stmt|;
end_decl_stmt
begin_define
DECL|macro|LFF_FORCEFILESYSTEM
define|#
directive|define
name|LFF_FORCEFILESYSTEM
value|1
end_define
begin_endif
endif|#
directive|endif
end_endif
begin_decl_stmt
DECL|variable|IID_IFileDialogEvents
specifier|static
specifier|const
name|IID
name|IID_IFileDialogEvents
init|=
block|{
literal|0x973510db
block|,
literal|0x7d7f
block|,
literal|0x452b
block|,
block|{
literal|0x89
block|,
literal|0x75
block|,
literal|0x74
block|,
literal|0xa8
block|,
literal|0x58
block|,
literal|0x28
block|,
literal|0xd3
block|,
literal|0x54
block|}
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|variable|CLSID_FileOpenDialog
specifier|static
specifier|const
name|CLSID
name|CLSID_FileOpenDialog
init|=
block|{
literal|0xdc1c5a9c
block|,
literal|0xe88a
block|,
literal|0x4dde
block|,
block|{
literal|0xa5
block|,
literal|0xa1
block|,
literal|0x60
block|,
literal|0xf8
block|,
literal|0x2a
block|,
literal|0x20
block|,
literal|0xae
block|,
literal|0xf7
block|}
block|}
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|variable|CLSID_FileSaveDialog
specifier|static
specifier|const
name|CLSID
name|CLSID_FileSaveDialog
init|=
block|{
literal|0xc0b4e2f3
block|,
literal|0xba21
block|,
literal|0x4773
block|,
block|{
literal|0x8d
block|,
literal|0xba
block|,
literal|0x33
block|,
literal|0x5e
block|,
literal|0xc9
block|,
literal|0x46
block|,
literal|0xeb
block|,
literal|0x8b
block|}
block|}
decl_stmt|;
end_decl_stmt
begin_typedef
DECL|struct|_COMDLG_FILTERSPEC
typedef|typedef
struct|struct
name|_COMDLG_FILTERSPEC
block|{
DECL|member|pszName
name|LPCWSTR
name|pszName
decl_stmt|;
DECL|member|pszSpec
name|LPCWSTR
name|pszSpec
decl_stmt|;
block|}
DECL|typedef|COMDLG_FILTERSPEC
name|COMDLG_FILTERSPEC
typedef|;
end_typedef
begin_define
DECL|macro|FOS_OVERWRITEPROMPT
define|#
directive|define
name|FOS_OVERWRITEPROMPT
value|0x2
end_define
begin_define
DECL|macro|FOS_STRICTFILETYPES
define|#
directive|define
name|FOS_STRICTFILETYPES
value|0x4
end_define
begin_define
DECL|macro|FOS_NOCHANGEDIR
define|#
directive|define
name|FOS_NOCHANGEDIR
value|0x8
end_define
begin_define
DECL|macro|FOS_PICKFOLDERS
define|#
directive|define
name|FOS_PICKFOLDERS
value|0x20
end_define
begin_define
DECL|macro|FOS_FORCEFILESYSTEM
define|#
directive|define
name|FOS_FORCEFILESYSTEM
value|0x40
end_define
begin_define
DECL|macro|FOS_ALLNONSTORAGEITEMS
define|#
directive|define
name|FOS_ALLNONSTORAGEITEMS
value|0x80
end_define
begin_define
DECL|macro|FOS_NOVALIDATE
define|#
directive|define
name|FOS_NOVALIDATE
value|0x100
end_define
begin_define
DECL|macro|FOS_ALLOWMULTISELECT
define|#
directive|define
name|FOS_ALLOWMULTISELECT
value|0x200
end_define
begin_define
DECL|macro|FOS_PATHMUSTEXIST
define|#
directive|define
name|FOS_PATHMUSTEXIST
value|0x800
end_define
begin_define
DECL|macro|FOS_FILEMUSTEXIST
define|#
directive|define
name|FOS_FILEMUSTEXIST
value|0x1000
end_define
begin_define
DECL|macro|FOS_CREATEPROMPT
define|#
directive|define
name|FOS_CREATEPROMPT
value|0x2000
end_define
begin_define
DECL|macro|FOS_SHAREAWARE
define|#
directive|define
name|FOS_SHAREAWARE
value|0x4000
end_define
begin_define
DECL|macro|FOS_NOREADONLYRETURN
define|#
directive|define
name|FOS_NOREADONLYRETURN
value|0x8000
end_define
begin_define
DECL|macro|FOS_NOTESTFILECREATE
define|#
directive|define
name|FOS_NOTESTFILECREATE
value|0x10000
end_define
begin_define
DECL|macro|FOS_HIDEMRUPLACES
define|#
directive|define
name|FOS_HIDEMRUPLACES
value|0x20000
end_define
begin_define
DECL|macro|FOS_HIDEPINNEDPLACES
define|#
directive|define
name|FOS_HIDEPINNEDPLACES
value|0x40000
end_define
begin_define
DECL|macro|FOS_NODEREFERENCELINKS
define|#
directive|define
name|FOS_NODEREFERENCELINKS
value|0x100000
end_define
begin_define
DECL|macro|FOS_DONTADDTORECENT
define|#
directive|define
name|FOS_DONTADDTORECENT
value|0x2000000
end_define
begin_define
DECL|macro|FOS_FORCESHOWHIDDEN
define|#
directive|define
name|FOS_FORCESHOWHIDDEN
value|0x10000000
end_define
begin_define
DECL|macro|FOS_DEFAULTNOMINIMODE
define|#
directive|define
name|FOS_DEFAULTNOMINIMODE
value|0x20000000
end_define
begin_define
DECL|macro|FOS_FORCEPREVIEWPANEON
define|#
directive|define
name|FOS_FORCEPREVIEWPANEON
value|0x40000000
end_define
begin_if
if|#
directive|if
name|__MINGW64_VERSION_MAJOR
operator|<
literal|2
end_if
begin_typedef
DECL|typedef|GETPROPERTYSTOREFLAGS
typedef|typedef
name|int
name|GETPROPERTYSTOREFLAGS
typedef|;
end_typedef
begin_define
DECL|macro|GPS_DEFAULT
define|#
directive|define
name|GPS_DEFAULT
value|0x00000000
end_define
begin_define
DECL|macro|GPS_HANDLERPROPERTIESONLY
define|#
directive|define
name|GPS_HANDLERPROPERTIESONLY
value|0x00000001
end_define
begin_define
DECL|macro|GPS_READWRITE
define|#
directive|define
name|GPS_READWRITE
value|0x00000002
end_define
begin_define
DECL|macro|GPS_TEMPORARY
define|#
directive|define
name|GPS_TEMPORARY
value|0x00000004
end_define
begin_define
DECL|macro|GPS_FASTPROPERTIESONLY
define|#
directive|define
name|GPS_FASTPROPERTIESONLY
value|0x00000008
end_define
begin_define
DECL|macro|GPS_OPENSLOWITEM
define|#
directive|define
name|GPS_OPENSLOWITEM
value|0x00000010
end_define
begin_define
DECL|macro|GPS_DELAYCREATION
define|#
directive|define
name|GPS_DELAYCREATION
value|0x00000020
end_define
begin_define
DECL|macro|GPS_BESTEFFORT
define|#
directive|define
name|GPS_BESTEFFORT
value|0x00000040
end_define
begin_define
DECL|macro|GPS_MASK_VALID
define|#
directive|define
name|GPS_MASK_VALID
value|0x0000007F
end_define
begin_endif
endif|#
directive|endif
end_endif
begin_typedef
DECL|typedef|BFFCALLBACK
typedef|typedef
name|int
function_decl|(
name|QT_WIN_CALLBACK
modifier|*
name|BFFCALLBACK
function_decl|)
parameter_list|(
name|HWND
name|hwnd
parameter_list|,
name|UINT
name|uMsg
parameter_list|,
name|LPARAM
name|lParam
parameter_list|,
name|LPARAM
name|lpData
parameter_list|)
function_decl|;
end_typedef
begin_comment
comment|// message from browser
end_comment
begin_define
DECL|macro|BFFM_INITIALIZED
define|#
directive|define
name|BFFM_INITIALIZED
value|1
end_define
begin_define
DECL|macro|BFFM_SELCHANGED
define|#
directive|define
name|BFFM_SELCHANGED
value|2
end_define
begin_define
DECL|macro|BFFM_ENABLEOK
define|#
directive|define
name|BFFM_ENABLEOK
value|(WM_USER + 101)
end_define
begin_comment
comment|// Browsing for directory.
end_comment
begin_define
DECL|macro|BIF_NONEWFOLDERBUTTON
define|#
directive|define
name|BIF_NONEWFOLDERBUTTON
value|0x0200
end_define
begin_define
DECL|macro|BIF_NOTRANSLATETARGETS
define|#
directive|define
name|BIF_NOTRANSLATETARGETS
value|0x0400
end_define
begin_define
DECL|macro|BIF_BROWSEFORCOMPUTER
define|#
directive|define
name|BIF_BROWSEFORCOMPUTER
value|0x1000
end_define
begin_define
DECL|macro|BIF_BROWSEFORPRINTER
define|#
directive|define
name|BIF_BROWSEFORPRINTER
value|0x2000
end_define
begin_define
DECL|macro|BIF_BROWSEINCLUDEFILES
define|#
directive|define
name|BIF_BROWSEINCLUDEFILES
value|0x4000
end_define
begin_define
DECL|macro|BIF_SHAREABLE
define|#
directive|define
name|BIF_SHAREABLE
value|0x8000
end_define
begin_comment
comment|//the enums
end_comment
begin_typedef
typedef|typedef
enum|enum
block|{
DECL|enumerator|SIATTRIBFLAGS_AND
name|SIATTRIBFLAGS_AND
init|=
literal|0x1
block|,
DECL|enumerator|SIATTRIBFLAGS_OR
name|SIATTRIBFLAGS_OR
init|=
literal|0x2
block|,
DECL|enumerator|SIATTRIBFLAGS_APPCOMPAT
name|SIATTRIBFLAGS_APPCOMPAT
init|=
literal|0x3
block|,
DECL|enumerator|SIATTRIBFLAGS_MASK
name|SIATTRIBFLAGS_MASK
init|=
literal|0x3
block|}
DECL|typedef|SIATTRIBFLAGS
name|SIATTRIBFLAGS
typedef|;
end_typedef
begin_ifndef
ifndef|#
directive|ifndef
name|__MINGW64_VERSION_MAJOR
end_ifndef
begin_typedef
typedef|typedef
enum|enum
block|{
DECL|enumerator|SIGDN_NORMALDISPLAY
name|SIGDN_NORMALDISPLAY
init|=
literal|0x00000000
block|,
DECL|enumerator|SIGDN_PARENTRELATIVEPARSING
name|SIGDN_PARENTRELATIVEPARSING
init|=
literal|0x80018001
block|,
DECL|enumerator|SIGDN_PARENTRELATIVEFORADDRESSBAR
name|SIGDN_PARENTRELATIVEFORADDRESSBAR
init|=
literal|0x8001c001
block|,
DECL|enumerator|SIGDN_DESKTOPABSOLUTEPARSING
name|SIGDN_DESKTOPABSOLUTEPARSING
init|=
literal|0x80028000
block|,
DECL|enumerator|SIGDN_PARENTRELATIVEEDITING
name|SIGDN_PARENTRELATIVEEDITING
init|=
literal|0x80031001
block|,
DECL|enumerator|SIGDN_DESKTOPABSOLUTEEDITING
name|SIGDN_DESKTOPABSOLUTEEDITING
init|=
literal|0x8004c000
block|,
DECL|enumerator|SIGDN_FILESYSPATH
name|SIGDN_FILESYSPATH
init|=
literal|0x80058000
block|,
DECL|enumerator|SIGDN_URL
name|SIGDN_URL
init|=
literal|0x80068000
block|}
DECL|typedef|SIGDN
name|SIGDN
typedef|;
end_typedef
begin_endif
endif|#
directive|endif
end_endif
begin_typedef
typedef|typedef
enum|enum
block|{
DECL|enumerator|FDAP_BOTTOM
name|FDAP_BOTTOM
init|=
literal|0x00000000
block|,
DECL|enumerator|FDAP_TOP
name|FDAP_TOP
init|=
literal|0x00000001
block|}
DECL|typedef|FDAP
name|FDAP
typedef|;
end_typedef
begin_typedef
typedef|typedef
enum|enum
block|{
DECL|enumerator|FDESVR_DEFAULT
name|FDESVR_DEFAULT
init|=
literal|0x00000000
block|,
DECL|enumerator|FDESVR_ACCEPT
name|FDESVR_ACCEPT
init|=
literal|0x00000001
block|,
DECL|enumerator|FDESVR_REFUSE
name|FDESVR_REFUSE
init|=
literal|0x00000002
block|}
DECL|typedef|FDE_SHAREVIOLATION_RESPONSE
name|FDE_SHAREVIOLATION_RESPONSE
typedef|;
end_typedef
begin_typedef
DECL|typedef|FDE_OVERWRITE_RESPONSE
typedef|typedef
name|FDE_SHAREVIOLATION_RESPONSE
name|FDE_OVERWRITE_RESPONSE
typedef|;
end_typedef
begin_comment
comment|//the structs
end_comment
begin_typedef
typedef|typedef
struct|struct
block|{
DECL|member|pszName
name|LPCWSTR
name|pszName
decl_stmt|;
DECL|member|pszSpec
name|LPCWSTR
name|pszSpec
decl_stmt|;
block|}
DECL|typedef|qt_COMDLG_FILTERSPEC
name|qt_COMDLG_FILTERSPEC
typedef|;
end_typedef
begin_typedef
typedef|typedef
struct|struct
block|{
DECL|member|fmtid
name|GUID
name|fmtid
decl_stmt|;
DECL|member|pid
name|DWORD
name|pid
decl_stmt|;
block|}
DECL|typedef|qt_PROPERTYKEY
name|qt_PROPERTYKEY
typedef|;
end_typedef
begin_typedef
typedef|typedef
struct|struct
block|{
DECL|member|cb
name|USHORT
name|cb
decl_stmt|;
DECL|member|abID
name|BYTE
name|abID
index|[
literal|1
index|]
decl_stmt|;
block|}
DECL|typedef|qt_SHITEMID
DECL|typedef|qt_LPSHITEMID
name|qt_SHITEMID
operator|,
typedef|*
name|qt_LPSHITEMID
typedef|;
end_typedef
begin_typedef
typedef|typedef
struct|struct
block|{
DECL|member|mkid
name|qt_SHITEMID
name|mkid
decl_stmt|;
block|}
DECL|typedef|qt_ITEMIDLIST
DECL|typedef|qt_LPITEMIDLIST
name|qt_ITEMIDLIST
operator|,
typedef|*
name|qt_LPITEMIDLIST
typedef|;
end_typedef
begin_typedef
DECL|typedef|qt_LPCITEMIDLIST
typedef|typedef
specifier|const
name|qt_ITEMIDLIST
modifier|*
name|qt_LPCITEMIDLIST
typedef|;
end_typedef
begin_typedef
typedef|typedef
struct|struct
block|{
DECL|member|hwndOwner
name|HWND
name|hwndOwner
decl_stmt|;
DECL|member|pidlRoot
name|qt_LPCITEMIDLIST
name|pidlRoot
decl_stmt|;
DECL|member|pszDisplayName
name|LPWSTR
name|pszDisplayName
decl_stmt|;
DECL|member|lpszTitle
name|LPCWSTR
name|lpszTitle
decl_stmt|;
DECL|member|ulFlags
name|UINT
name|ulFlags
decl_stmt|;
DECL|member|lpfn
name|BFFCALLBACK
name|lpfn
decl_stmt|;
DECL|member|lParam
name|LPARAM
name|lParam
decl_stmt|;
DECL|member|iImage
name|int
name|iImage
decl_stmt|;
block|}
DECL|typedef|qt_BROWSEINFO
name|qt_BROWSEINFO
typedef|;
end_typedef
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|// __IShellLibrary_FWD_DEFINED__
end_comment
begin_ifndef
ifndef|#
directive|ifndef
name|__IFileDialogEvents_FWD_DEFINED__
end_ifndef
begin_expr_stmt
DECL|variable|IFileDialogEvents
name|DECLARE_INTERFACE
argument_list|(
name|IFileDialogEvents
argument_list|)
expr_stmt|;
end_expr_stmt
begin_endif
endif|#
directive|endif
end_endif
begin_ifndef
ifndef|#
directive|ifndef
name|__IShellItem_INTERFACE_DEFINED__
end_ifndef
begin_macro
DECL|function|DECLARE_INTERFACE_
name|DECLARE_INTERFACE_
argument_list|(
argument|IShellItem
argument_list|,
argument|IUnknown
argument_list|)
end_macro
begin_block
block|{
name|STDMETHOD
function_decl|(
name|BindToHandler
function_decl|)
parameter_list|(
name|THIS_
name|IBindCtx
modifier|*
name|pbc
parameter_list|,
name|REFGUID
name|bhid
parameter_list|,
name|REFIID
name|riid
parameter_list|,
name|void
modifier|*
modifier|*
name|ppv
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetParent
function_decl|)
parameter_list|(
name|THIS_
name|IShellItem
modifier|*
modifier|*
name|ppsi
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetDisplayName
function_decl|)
parameter_list|(
name|THIS_
name|SIGDN
name|sigdnName
parameter_list|,
name|LPWSTR
modifier|*
name|ppszName
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetAttributes
function_decl|)
parameter_list|(
name|THIS_
name|ULONG
name|sfgaoMask
parameter_list|,
name|ULONG
modifier|*
name|psfgaoAttribs
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|Compare
function_decl|)
parameter_list|(
name|THIS_
name|IShellItem
modifier|*
name|psi
parameter_list|,
name|DWORD
name|hint
parameter_list|,
name|int
modifier|*
name|piOrder
parameter_list|)
name|PURE
function_decl|;
block|}
end_block
begin_empty_stmt
empty_stmt|;
end_empty_stmt
begin_endif
endif|#
directive|endif
end_endif
begin_ifndef
ifndef|#
directive|ifndef
name|__IShellItemFilter_INTERFACE_DEFINED__
end_ifndef
begin_macro
DECL|function|DECLARE_INTERFACE_
name|DECLARE_INTERFACE_
argument_list|(
argument|IShellItemFilter
argument_list|,
argument|IUnknown
argument_list|)
end_macro
begin_block
block|{
name|STDMETHOD
function_decl|(
name|IncludeItem
function_decl|)
parameter_list|(
name|THIS_
name|IShellItem
modifier|*
name|psi
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetEnumFlagsForItem
function_decl|)
parameter_list|(
name|THIS_
name|IShellItem
modifier|*
name|psi
parameter_list|,
name|DWORD
modifier|*
name|pgrfFlags
parameter_list|)
name|PURE
function_decl|;
block|}
end_block
begin_empty_stmt
empty_stmt|;
end_empty_stmt
begin_endif
endif|#
directive|endif
end_endif
begin_ifndef
ifndef|#
directive|ifndef
name|__IEnumShellItems_INTERFACE_DEFINED__
end_ifndef
begin_macro
DECL|function|DECLARE_INTERFACE_
name|DECLARE_INTERFACE_
argument_list|(
argument|IEnumShellItems
argument_list|,
argument|IUnknown
argument_list|)
end_macro
begin_block
block|{
name|STDMETHOD
function_decl|(
name|Next
function_decl|)
parameter_list|(
name|THIS_
name|ULONG
name|celt
parameter_list|,
name|IShellItem
modifier|*
modifier|*
name|rgelt
parameter_list|,
name|ULONG
modifier|*
name|pceltFetched
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|Skip
function_decl|)
parameter_list|(
name|THIS_
name|ULONG
name|celt
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|Reset
function_decl|)
parameter_list|(
name|THIS_
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|Clone
function_decl|)
parameter_list|(
name|THIS_
name|IEnumShellItems
modifier|*
modifier|*
name|ppenum
parameter_list|)
name|PURE
function_decl|;
block|}
end_block
begin_empty_stmt
empty_stmt|;
end_empty_stmt
begin_endif
endif|#
directive|endif
end_endif
begin_ifndef
ifndef|#
directive|ifndef
name|__IShellItemArray_INTERFACE_DEFINED__
end_ifndef
begin_macro
DECL|function|DECLARE_INTERFACE_
name|DECLARE_INTERFACE_
argument_list|(
argument|IShellItemArray
argument_list|,
argument|IUnknown
argument_list|)
end_macro
begin_block
block|{
name|STDMETHOD
function_decl|(
name|BindToHandler
function_decl|)
parameter_list|(
name|THIS_
name|IBindCtx
modifier|*
name|pbc
parameter_list|,
name|REFGUID
name|rbhid
parameter_list|,
name|REFIID
name|riid
parameter_list|,
name|void
modifier|*
modifier|*
name|ppvOut
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetPropertyStore
function_decl|)
parameter_list|(
name|THIS_
name|GETPROPERTYSTOREFLAGS
name|flags
parameter_list|,
name|REFIID
name|riid
parameter_list|,
name|void
modifier|*
modifier|*
name|ppv
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetPropertyDescriptionList
function_decl|)
parameter_list|(
name|THIS_
specifier|const
name|qt_PROPERTYKEY
modifier|*
name|keyType
parameter_list|,
name|REFIID
name|riid
parameter_list|,
name|void
modifier|*
modifier|*
name|ppv
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetAttributes
function_decl|)
parameter_list|(
name|THIS_
name|SIATTRIBFLAGS
name|dwAttribFlags
parameter_list|,
name|ULONG
name|sfgaoMask
parameter_list|,
name|ULONG
modifier|*
name|psfgaoAttribs
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetCount
function_decl|)
parameter_list|(
name|THIS_
name|DWORD
modifier|*
name|pdwNumItems
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetItemAt
function_decl|)
parameter_list|(
name|THIS_
name|DWORD
name|dwIndex
parameter_list|,
name|IShellItem
modifier|*
modifier|*
name|ppsi
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|EnumItems
function_decl|)
parameter_list|(
name|THIS_
name|IEnumShellItems
modifier|*
modifier|*
name|ppenumShellItems
parameter_list|)
name|PURE
function_decl|;
block|}
end_block
begin_empty_stmt
empty_stmt|;
end_empty_stmt
begin_endif
endif|#
directive|endif
end_endif
begin_ifndef
ifndef|#
directive|ifndef
name|__IShellLibrary_INTERFACE_DEFINED__
end_ifndef
begin_enum
DECL|enum|LIBRARYOPTIONFLAGS
enum|enum
name|LIBRARYOPTIONFLAGS
block|{}
enum|;
end_enum
begin_enum
DECL|enum|DEFAULTSAVEFOLDERTYPE
DECL|enumerator|DSFT_DETECT
enum|enum
name|DEFAULTSAVEFOLDERTYPE
block|{
name|DSFT_DETECT
init|=
literal|1
block|}
enum|;
end_enum
begin_enum
DECL|enum|LIBRARYSAVEFLAGS
enum|enum
name|LIBRARYSAVEFLAGS
block|{}
enum|;
end_enum
begin_macro
DECL|function|DECLARE_INTERFACE_
name|DECLARE_INTERFACE_
argument_list|(
argument|IShellLibrary
argument_list|,
argument|IUnknown
argument_list|)
end_macro
begin_block
block|{
name|STDMETHOD
function_decl|(
name|LoadLibraryFromItem
function_decl|)
parameter_list|(
name|THIS_
name|IShellItem
modifier|*
name|psiLibrary
parameter_list|,
name|DWORD
name|grfMode
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|LoadLibraryFromKnownFolder
function_decl|)
parameter_list|(
name|THIS_
specifier|const
name|GUID
modifier|&
name|kfidLibrary
parameter_list|,
name|DWORD
name|grfMode
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|AddFolder
function_decl|)
parameter_list|(
name|THIS_
name|IShellItem
modifier|*
name|psiLocation
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|RemoveFolder
function_decl|)
parameter_list|(
name|THIS_
name|IShellItem
modifier|*
name|psiLocation
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetFolders
function_decl|)
parameter_list|(
name|THIS_
name|int
name|lff
parameter_list|,
name|REFIID
name|riid
parameter_list|,
name|void
modifier|*
modifier|*
name|ppv
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|ResolveFolder
function_decl|)
parameter_list|(
name|THIS_
name|IShellItem
modifier|*
name|psiFolderToResolve
parameter_list|,
name|DWORD
name|dwTimeout
parameter_list|,
name|REFIID
name|riid
parameter_list|,
name|void
modifier|*
modifier|*
name|ppv
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetDefaultSaveFolder
function_decl|)
parameter_list|(
name|THIS_
name|DEFAULTSAVEFOLDERTYPE
name|dsft
parameter_list|,
name|REFIID
name|riid
parameter_list|,
name|void
modifier|*
modifier|*
name|ppv
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SetDefaultSaveFolder
function_decl|)
parameter_list|(
name|THIS_
name|DEFAULTSAVEFOLDERTYPE
name|dsft
parameter_list|,
name|IShellItem
modifier|*
name|psi
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetOptions
function_decl|)
parameter_list|(
name|THIS_
name|LIBRARYOPTIONFLAGS
modifier|*
name|plofOptions
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SetOptions
function_decl|)
parameter_list|(
name|THIS_
name|LIBRARYOPTIONFLAGS
name|lofMask
parameter_list|,
name|LIBRARYOPTIONFLAGS
name|lofOptions
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetFolderType
function_decl|)
parameter_list|(
name|THIS_
name|GUID
modifier|*
name|pftid
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SetFolderType
function_decl|)
parameter_list|(
name|THIS_
specifier|const
name|GUID
modifier|&
name|ftid
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetIcon
function_decl|)
parameter_list|(
name|THIS_
name|LPWSTR
modifier|*
name|ppszIcon
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SetIcon
function_decl|)
parameter_list|(
name|THIS_
name|LPCWSTR
name|pszIcon
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|Commit
function_decl|)
parameter_list|(
name|THIS_
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|Save
function_decl|)
parameter_list|(
name|THIS_
name|IShellItem
modifier|*
name|psiFolderToSaveIn
parameter_list|,
name|LPCWSTR
name|pszLibraryName
parameter_list|,
name|LIBRARYSAVEFLAGS
name|lsf
parameter_list|,
name|IShellItem
modifier|*
modifier|*
name|ppsiSavedTo
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SaveInKnownFolder
function_decl|)
parameter_list|(
name|THIS_
specifier|const
name|GUID
modifier|&
name|kfidToSaveIn
parameter_list|,
name|LPCWSTR
name|pszLibraryName
parameter_list|,
name|LIBRARYSAVEFLAGS
name|lsf
parameter_list|,
name|IShellItem
modifier|*
modifier|*
name|ppsiSavedTo
parameter_list|)
name|PURE
function_decl|;
block|}
end_block
begin_empty_stmt
empty_stmt|;
end_empty_stmt
begin_endif
endif|#
directive|endif
end_endif
begin_ifndef
ifndef|#
directive|ifndef
name|__IModalWindow_INTERFACE_DEFINED__
end_ifndef
begin_macro
DECL|function|DECLARE_INTERFACE_
name|DECLARE_INTERFACE_
argument_list|(
argument|IModalWindow
argument_list|,
argument|IUnknown
argument_list|)
end_macro
begin_block
block|{
name|STDMETHOD
function_decl|(
name|Show
function_decl|)
parameter_list|(
name|THIS_
name|HWND
name|hwndParent
parameter_list|)
name|PURE
function_decl|;
block|}
end_block
begin_empty_stmt
empty_stmt|;
end_empty_stmt
begin_endif
endif|#
directive|endif
end_endif
begin_ifndef
ifndef|#
directive|ifndef
name|__IFileDialog_INTERFACE_DEFINED__
end_ifndef
begin_macro
DECL|function|DECLARE_INTERFACE_
name|DECLARE_INTERFACE_
argument_list|(
argument|IFileDialog
argument_list|,
argument|IModalWindow
argument_list|)
end_macro
begin_block
block|{
name|STDMETHOD
function_decl|(
name|SetFileTypes
function_decl|)
parameter_list|(
name|THIS_
name|UINT
name|cFileTypes
parameter_list|,
specifier|const
name|COMDLG_FILTERSPEC
modifier|*
name|rgFilterSpec
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SetFileTypeIndex
function_decl|)
parameter_list|(
name|THIS_
name|UINT
name|iFileType
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetFileTypeIndex
function_decl|)
parameter_list|(
name|THIS_
name|UINT
modifier|*
name|piFileType
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|Advise
function_decl|)
parameter_list|(
name|THIS_
name|IFileDialogEvents
modifier|*
name|pfde
parameter_list|,
name|DWORD
modifier|*
name|pdwCookie
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|Unadvise
function_decl|)
parameter_list|(
name|THIS_
name|DWORD
name|dwCookie
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SetOptions
function_decl|)
parameter_list|(
name|THIS_
name|DWORD
name|fos
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetOptions
function_decl|)
parameter_list|(
name|THIS_
name|DWORD
modifier|*
name|pfos
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SetDefaultFolder
function_decl|)
parameter_list|(
name|THIS_
name|IShellItem
modifier|*
name|psi
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SetFolder
function_decl|)
parameter_list|(
name|THIS_
name|IShellItem
modifier|*
name|psi
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetFolder
function_decl|)
parameter_list|(
name|THIS_
name|IShellItem
modifier|*
modifier|*
name|ppsi
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetCurrentSelection
function_decl|)
parameter_list|(
name|THIS_
name|IShellItem
modifier|*
modifier|*
name|ppsi
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SetFileName
function_decl|)
parameter_list|(
name|THIS_
name|LPCWSTR
name|pszName
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetFileName
function_decl|)
parameter_list|(
name|THIS_
name|LPWSTR
modifier|*
name|pszName
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SetTitle
function_decl|)
parameter_list|(
name|THIS_
name|LPCWSTR
name|pszTitle
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SetOkButtonLabel
function_decl|)
parameter_list|(
name|THIS_
name|LPCWSTR
name|pszText
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SetFileNameLabel
function_decl|)
parameter_list|(
name|THIS_
name|LPCWSTR
name|pszLabel
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetResult
function_decl|)
parameter_list|(
name|THIS_
name|IShellItem
modifier|*
modifier|*
name|ppsi
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|AddPlace
function_decl|)
parameter_list|(
name|THIS_
name|IShellItem
modifier|*
name|psi
parameter_list|,
name|FDAP
name|fdap
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SetDefaultExtension
function_decl|)
parameter_list|(
name|THIS_
name|LPCWSTR
name|pszDefaultExtension
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|Close
function_decl|)
parameter_list|(
name|THIS_
name|HRESULT
name|hr
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SetClientGuid
function_decl|)
parameter_list|(
name|THIS_
name|REFGUID
name|guid
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|ClearClientData
function_decl|)
parameter_list|(
name|THIS_
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SetFilter
function_decl|)
parameter_list|(
name|THIS_
name|IShellItemFilter
modifier|*
name|pFilter
parameter_list|)
name|PURE
function_decl|;
block|}
end_block
begin_empty_stmt
empty_stmt|;
end_empty_stmt
begin_endif
endif|#
directive|endif
end_endif
begin_ifndef
ifndef|#
directive|ifndef
name|__IFileDialogEvents_INTERFACE_DEFINED__
end_ifndef
begin_macro
DECL|function|DECLARE_INTERFACE_
name|DECLARE_INTERFACE_
argument_list|(
argument|IFileDialogEvents
argument_list|,
argument|IUnknown
argument_list|)
end_macro
begin_block
block|{
name|STDMETHOD
function_decl|(
name|OnFileOk
function_decl|)
parameter_list|(
name|THIS_
name|IFileDialog
modifier|*
name|pfd
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|OnFolderChanging
function_decl|)
parameter_list|(
name|THIS_
name|IFileDialog
modifier|*
name|pfd
parameter_list|,
name|IShellItem
modifier|*
name|psiFolder
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|OnFolderChange
function_decl|)
parameter_list|(
name|THIS_
name|IFileDialog
modifier|*
name|pfd
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|OnSelectionChange
function_decl|)
parameter_list|(
name|THIS_
name|IFileDialog
modifier|*
name|pfd
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|OnShareViolation
function_decl|)
parameter_list|(
name|THIS_
name|IFileDialog
modifier|*
name|pfd
parameter_list|,
name|IShellItem
modifier|*
name|psi
parameter_list|,
name|FDE_SHAREVIOLATION_RESPONSE
modifier|*
name|pResponse
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|OnTypeChange
function_decl|)
parameter_list|(
name|THIS_
name|IFileDialog
modifier|*
name|pfd
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|OnOverwrite
function_decl|)
parameter_list|(
name|THIS_
name|IFileDialog
modifier|*
name|pfd
parameter_list|,
name|IShellItem
modifier|*
name|psi
parameter_list|,
name|FDE_OVERWRITE_RESPONSE
modifier|*
name|pResponse
parameter_list|)
name|PURE
function_decl|;
block|}
end_block
begin_empty_stmt
empty_stmt|;
end_empty_stmt
begin_endif
endif|#
directive|endif
end_endif
begin_ifndef
ifndef|#
directive|ifndef
name|__IFileOpenDialog_INTERFACE_DEFINED__
end_ifndef
begin_macro
DECL|function|DECLARE_INTERFACE_
name|DECLARE_INTERFACE_
argument_list|(
argument|IFileOpenDialog
argument_list|,
argument|IFileDialog
argument_list|)
end_macro
begin_block
block|{
name|STDMETHOD
function_decl|(
name|GetResults
function_decl|)
parameter_list|(
name|THIS_
name|IShellItemArray
modifier|*
modifier|*
name|ppenum
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetSelectedItems
function_decl|)
parameter_list|(
name|THIS_
name|IShellItemArray
modifier|*
modifier|*
name|ppsai
parameter_list|)
name|PURE
function_decl|;
block|}
end_block
begin_empty_stmt
empty_stmt|;
end_empty_stmt
begin_endif
endif|#
directive|endif
end_endif
begin_ifndef
ifndef|#
directive|ifndef
name|__IPropertyStore_FWD_DEFINED__
end_ifndef
begin_typedef
DECL|typedef|IPropertyStore
typedef|typedef
name|IUnknown
name|IPropertyStore
typedef|;
end_typedef
begin_endif
endif|#
directive|endif
end_endif
begin_ifndef
ifndef|#
directive|ifndef
name|__IFileOperationProgressSink_FWD_DEFINED__
end_ifndef
begin_typedef
DECL|typedef|IFileOperationProgressSink
typedef|typedef
name|IUnknown
name|IFileOperationProgressSink
typedef|;
end_typedef
begin_endif
endif|#
directive|endif
end_endif
begin_ifndef
ifndef|#
directive|ifndef
name|__IFileSaveDialog_INTERFACE_DEFINED__
end_ifndef
begin_macro
DECL|function|DECLARE_INTERFACE_
name|DECLARE_INTERFACE_
argument_list|(
argument|IFileSaveDialog
argument_list|,
argument|IFileDialog
argument_list|)
end_macro
begin_block
block|{
public|public:
name|STDMETHOD
function_decl|(
name|SetSaveAsItem
function_decl|)
parameter_list|(
name|THIS_
name|IShellItem
modifier|*
name|psi
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SetProperties
function_decl|)
parameter_list|(
name|THIS_
name|IPropertyStore
modifier|*
name|pStore
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|SetCollectedProperties
function_decl|)
parameter_list|(
name|THIS_
name|IPropertyStore
modifier|*
name|pStore
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|GetProperties
function_decl|)
parameter_list|(
name|THIS_
name|IPropertyStore
modifier|*
modifier|*
name|ppStore
parameter_list|)
name|PURE
function_decl|;
name|STDMETHOD
function_decl|(
name|ApplyProperties
function_decl|)
parameter_list|(
name|THIS_
name|IShellItem
modifier|*
name|psi
parameter_list|,
name|IPropertyStore
modifier|*
name|pStore
parameter_list|,
name|HWND
name|hwnd
parameter_list|,
name|IFileOperationProgressSink
modifier|*
name|pSink
parameter_list|)
name|PURE
function_decl|;
block|}
end_block
begin_empty_stmt
empty_stmt|;
end_empty_stmt
begin_endif
endif|#
directive|endif
end_endif
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|// Q_CC_MINGW
end_comment
begin_function
name|QT_BEGIN_NAMESPACE
comment|/* Output UID (IID, CLSID) as C++ constants.  * The constants are contained in the Windows SDK libs, but not for MinGW. */
DECL|function|guidToString
specifier|static
specifier|inline
name|QString
name|guidToString
parameter_list|(
specifier|const
name|GUID
modifier|&
name|g
parameter_list|)
block|{
name|QString
name|rc
decl_stmt|;
name|QTextStream
name|str
argument_list|(
operator|&
name|rc
argument_list|)
decl_stmt|;
name|str
operator|.
name|setIntegerBase
argument_list|(
literal|16
argument_list|)
expr_stmt|;
name|str
operator|.
name|setNumberFlags
argument_list|(
name|str
operator|.
name|numberFlags
argument_list|()
operator||
name|QTextStream
operator|::
name|ShowBase
argument_list|)
expr_stmt|;
name|str
operator|<<
literal|'{'
operator|<<
name|g
operator|.
name|Data1
operator|<<
literal|", "
operator|<<
name|g
operator|.
name|Data2
operator|<<
literal|", "
operator|<<
name|g
operator|.
name|Data3
expr_stmt|;
name|str
operator|.
name|setFieldWidth
argument_list|(
literal|2
argument_list|)
expr_stmt|;
name|str
operator|.
name|setFieldAlignment
argument_list|(
name|QTextStream
operator|::
name|AlignRight
argument_list|)
expr_stmt|;
name|str
operator|.
name|setPadChar
argument_list|(
name|QLatin1Char
argument_list|(
literal|'0'
argument_list|)
argument_list|)
expr_stmt|;
name|str
operator|<<
literal|",{"
operator|<<
name|g
operator|.
name|Data4
index|[
literal|0
index|]
operator|<<
literal|", "
operator|<<
name|g
operator|.
name|Data4
index|[
literal|1
index|]
operator|<<
literal|", "
operator|<<
name|g
operator|.
name|Data4
index|[
literal|2
index|]
operator|<<
literal|", "
operator|<<
name|g
operator|.
name|Data4
index|[
literal|3
index|]
operator|<<
literal|", "
operator|<<
name|g
operator|.
name|Data4
index|[
literal|4
index|]
operator|<<
literal|", "
operator|<<
name|g
operator|.
name|Data4
index|[
literal|5
index|]
operator|<<
literal|", "
operator|<<
name|g
operator|.
name|Data4
index|[
literal|6
index|]
operator|<<
literal|", "
operator|<<
name|g
operator|.
name|Data4
index|[
literal|7
index|]
operator|<<
literal|"}};"
expr_stmt|;
return|return
name|rc
return|;
block|}
end_function
begin_function
DECL|function|operator <<
specifier|inline
name|QDebug
name|operator
name|<<
parameter_list|(
name|QDebug
name|d
parameter_list|,
specifier|const
name|GUID
modifier|&
name|g
parameter_list|)
block|{
name|QDebugStateSaver
name|saver
argument_list|(
name|d
argument_list|)
decl_stmt|;
name|d
operator|.
name|nospace
argument_list|()
expr_stmt|;
name|d
operator|<<
name|guidToString
argument_list|(
name|g
argument_list|)
expr_stmt|;
return|return
name|d
return|;
block|}
end_function
begin_comment
comment|// Return an allocated wchar_t array from a QString, reserve more memory if desired.
end_comment
begin_function
DECL|function|qStringToWCharArray
specifier|static
name|wchar_t
modifier|*
name|qStringToWCharArray
parameter_list|(
specifier|const
name|QString
modifier|&
name|s
parameter_list|,
name|size_t
name|reserveSize
init|=
literal|0
parameter_list|)
block|{
specifier|const
name|size_t
name|stringSize
init|=
name|s
operator|.
name|size
argument_list|()
decl_stmt|;
name|wchar_t
modifier|*
name|result
init|=
operator|new
name|wchar_t
index|[
name|qMax
argument_list|(
name|stringSize
operator|+
literal|1
argument_list|,
name|reserveSize
argument_list|)
index|]
decl_stmt|;
name|s
operator|.
name|toWCharArray
argument_list|(
name|result
argument_list|)
expr_stmt|;
name|result
index|[
name|stringSize
index|]
operator|=
literal|0
expr_stmt|;
return|return
name|result
return|;
block|}
end_function
begin_namespace
DECL|namespace|QWindowsDialogs
namespace|namespace
name|QWindowsDialogs
block|{
comment|/*!     \fn eatMouseMove()      After closing a windows dialog with a double click (i.e. open a file)     the message queue still contains a dubious WM_MOUSEMOVE message where     the left button is reported to be down (wParam != 0).     remove all those messages (usually 1) and post the last one with a     reset button state.      \ingroup qt-lighthouse-win */
DECL|function|eatMouseMove
name|void
name|eatMouseMove
parameter_list|()
block|{
name|MSG
name|msg
init|=
block|{
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
literal|0
block|,
block|{
literal|0
block|,
literal|0
block|}
block|}
decl_stmt|;
while|while
condition|(
name|PeekMessage
argument_list|(
operator|&
name|msg
argument_list|,
literal|0
argument_list|,
name|WM_MOUSEMOVE
argument_list|,
name|WM_MOUSEMOVE
argument_list|,
name|PM_REMOVE
argument_list|)
condition|)
empty_stmt|;
if|if
condition|(
name|msg
operator|.
name|message
operator|==
name|WM_MOUSEMOVE
condition|)
name|PostMessage
argument_list|(
name|msg
operator|.
name|hwnd
argument_list|,
name|msg
operator|.
name|message
argument_list|,
literal|0
argument_list|,
name|msg
operator|.
name|lParam
argument_list|)
expr_stmt|;
name|qCDebug
argument_list|(
name|lcQpaDialogs
argument_list|)
operator|<<
name|__FUNCTION__
operator|<<
literal|"triggered="
operator|<<
operator|(
name|msg
operator|.
name|message
operator|==
name|WM_MOUSEMOVE
operator|)
expr_stmt|;
block|}
block|}
end_namespace
begin_comment
comment|// namespace QWindowsDialogs
end_comment
begin_comment
comment|/*!     \class QWindowsNativeDialogBase     \brief Base class for Windows native dialogs.      Base classes for native dialogs (using the CLSID-based     dialog interfaces "IFileDialog", etc. available from Windows     Vista on) that mimick the behaviour of their QDialog     counterparts as close as possible.      Instances of derived classes are controlled by     QWindowsDialogHelperBase-derived classes.      A major difference is that there is only an exec(), which     is a modal, blocking call; there is no non-blocking show().     There 2 types of native dialogs:      \list     \li Dialogs provided by the Comdlg32 library (ChooseColor,        ChooseFont). They only provide a modal, blocking        function call (with idle processing).     \li File dialogs are classes derived from IFileDialog. They        inherit IModalWindow and their exec() method (calling        IModalWindow::Show()) is similarly blocking, but methods        like close() can be called on them from event handlers.     \endlist      \sa QWindowsDialogHelperBase     \internal     \ingroup qt-lighthouse-win */
end_comment
begin_class
DECL|class|QWindowsNativeDialogBase
class|class
name|QWindowsNativeDialogBase
super|:
specifier|public
name|QObject
block|{
name|Q_OBJECT
public|public:
specifier|virtual
name|void
name|setWindowTitle
parameter_list|(
specifier|const
name|QString
modifier|&
name|title
parameter_list|)
function_decl|=
literal|0
function_decl|;
DECL|function|executed
name|bool
name|executed
parameter_list|()
specifier|const
block|{
return|return
name|m_executed
return|;
block|}
DECL|function|exec
name|void
name|exec
parameter_list|(
name|HWND
name|owner
init|=
literal|0
parameter_list|)
block|{
name|doExec
argument_list|(
name|owner
argument_list|)
expr_stmt|;
name|m_executed
operator|=
literal|true
expr_stmt|;
block|}
signals|signals:
name|void
name|accepted
parameter_list|()
function_decl|;
name|void
name|rejected
parameter_list|()
function_decl|;
public|public
name|slots
public|:
specifier|virtual
name|void
name|close
parameter_list|()
function_decl|=
literal|0
function_decl|;
protected|protected:
DECL|function|QWindowsNativeDialogBase
name|QWindowsNativeDialogBase
parameter_list|()
member_init_list|:
name|m_executed
argument_list|(
literal|false
argument_list|)
block|{}
private|private:
specifier|virtual
name|void
name|doExec
parameter_list|(
name|HWND
name|owner
init|=
literal|0
parameter_list|)
function_decl|=
literal|0
function_decl|;
DECL|member|m_executed
name|bool
name|m_executed
decl_stmt|;
block|}
class|;
end_class
begin_comment
comment|/*!     \class QWindowsDialogHelperBase     \brief Helper for native Windows dialogs.      Provides basic functionality and introduces new virtuals.     The native dialog is created in setVisible_sys() since     then modality and the state of DontUseNativeDialog is known.      Modal dialogs are then run by exec(). Non-modal dialogs are shown using a     separate thread started in show() should they support it.      \sa QWindowsDialogThread, QWindowsNativeDialogBase     \internal     \ingroup qt-lighthouse-win */
end_comment
begin_constructor
template|template
parameter_list|<
name|class
name|BaseClass
parameter_list|>
DECL|function|QWindowsDialogHelperBase
name|QWindowsDialogHelperBase
argument_list|<
name|BaseClass
argument_list|>
operator|::
name|QWindowsDialogHelperBase
parameter_list|()
member_init_list|:
name|m_nativeDialog
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|m_ownerWindow
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|m_timerId
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|m_thread
argument_list|(
literal|0
argument_list|)
block|{ }
end_constructor
begin_function
template|template
parameter_list|<
name|class
name|BaseClass
parameter_list|>
DECL|function|cleanupThread
name|void
name|QWindowsDialogHelperBase
argument_list|<
name|BaseClass
argument_list|>
operator|::
name|cleanupThread
parameter_list|()
block|{
if|if
condition|(
name|m_thread
condition|)
block|{
comment|// Thread may be running if the dialog failed to close.
if|if
condition|(
name|m_thread
operator|->
name|isRunning
argument_list|()
condition|)
name|m_thread
operator|->
name|wait
argument_list|(
literal|500
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_thread
operator|->
name|isRunning
argument_list|()
condition|)
block|{
name|m_thread
operator|->
name|terminate
argument_list|()
expr_stmt|;
name|m_thread
operator|->
name|wait
argument_list|(
literal|300
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_thread
operator|->
name|isRunning
argument_list|()
condition|)
name|qCCritical
argument_list|(
name|lcQpaDialogs
argument_list|)
operator|<<
name|__FUNCTION__
operator|<<
literal|"Failed to terminate thread."
expr_stmt|;
else|else
name|qCWarning
argument_list|(
name|lcQpaDialogs
argument_list|)
operator|<<
name|__FUNCTION__
operator|<<
literal|"Thread terminated."
expr_stmt|;
block|}
operator|delete
name|m_thread
expr_stmt|;
name|m_thread
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function
begin_function
template|template
parameter_list|<
name|class
name|BaseClass
parameter_list|>
DECL|function|nativeDialog
name|QWindowsNativeDialogBase
modifier|*
name|QWindowsDialogHelperBase
argument_list|<
name|BaseClass
argument_list|>
operator|::
name|nativeDialog
parameter_list|()
specifier|const
block|{
if|if
condition|(
name|m_nativeDialog
operator|.
name|isNull
argument_list|()
condition|)
block|{
name|qWarning
argument_list|(
literal|"%s invoked with no native dialog present."
argument_list|,
name|__FUNCTION__
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
return|return
name|m_nativeDialog
operator|.
name|data
argument_list|()
return|;
block|}
end_function
begin_function
template|template
parameter_list|<
name|class
name|BaseClass
parameter_list|>
DECL|function|timerEvent
name|void
name|QWindowsDialogHelperBase
argument_list|<
name|BaseClass
argument_list|>
operator|::
name|timerEvent
parameter_list|(
name|QTimerEvent
modifier|*
parameter_list|)
block|{
name|startDialogThread
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
template|template
parameter_list|<
name|class
name|BaseClass
parameter_list|>
DECL|function|ensureNativeDialog
name|QWindowsNativeDialogBase
modifier|*
name|QWindowsDialogHelperBase
argument_list|<
name|BaseClass
argument_list|>
operator|::
name|ensureNativeDialog
parameter_list|()
block|{
comment|// Create dialog and apply common settings. Check "executed" flag as well
comment|// since for example IFileDialog::Show() works only once.
if|if
condition|(
name|m_nativeDialog
operator|.
name|isNull
argument_list|()
operator|||
name|m_nativeDialog
operator|->
name|executed
argument_list|()
condition|)
name|m_nativeDialog
operator|=
name|QWindowsNativeDialogBasePtr
argument_list|(
name|createNativeDialog
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|m_nativeDialog
operator|.
name|data
argument_list|()
return|;
block|}
end_function
begin_comment
comment|/*!     \class QWindowsDialogThread     \brief Run a non-modal native dialog in a separate thread.      \sa QWindowsDialogHelperBase     \internal     \ingroup qt-lighthouse-win */
end_comment
begin_class
DECL|class|QWindowsDialogThread
class|class
name|QWindowsDialogThread
super|:
specifier|public
name|QThread
block|{
public|public:
DECL|typedef|QWindowsNativeDialogBasePtr
typedef|typedef
name|QSharedPointer
argument_list|<
name|QWindowsNativeDialogBase
argument_list|>
name|QWindowsNativeDialogBasePtr
typedef|;
DECL|function|QWindowsDialogThread
specifier|explicit
name|QWindowsDialogThread
parameter_list|(
specifier|const
name|QWindowsNativeDialogBasePtr
modifier|&
name|d
parameter_list|,
name|HWND
name|owner
parameter_list|)
member_init_list|:
name|m_dialog
argument_list|(
name|d
argument_list|)
member_init_list|,
name|m_owner
argument_list|(
name|owner
argument_list|)
block|{}
name|void
name|run
parameter_list|()
function_decl|;
private|private:
DECL|member|m_dialog
specifier|const
name|QWindowsNativeDialogBasePtr
name|m_dialog
decl_stmt|;
DECL|member|m_owner
specifier|const
name|HWND
name|m_owner
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|run
name|void
name|QWindowsDialogThread
operator|::
name|run
parameter_list|()
block|{
name|qCDebug
argument_list|(
name|lcQpaDialogs
argument_list|)
operator|<<
literal|'>'
operator|<<
name|__FUNCTION__
expr_stmt|;
name|m_dialog
operator|->
name|exec
argument_list|(
name|m_owner
argument_list|)
expr_stmt|;
name|qCDebug
argument_list|(
name|lcQpaDialogs
argument_list|)
operator|<<
literal|'<'
operator|<<
name|__FUNCTION__
expr_stmt|;
block|}
end_function
begin_function
template|template
parameter_list|<
name|class
name|BaseClass
parameter_list|>
DECL|function|show
name|bool
name|QWindowsDialogHelperBase
argument_list|<
name|BaseClass
argument_list|>
operator|::
name|show
parameter_list|(
name|Qt
operator|::
name|WindowFlags
parameter_list|,
name|Qt
operator|::
name|WindowModality
name|windowModality
parameter_list|,
name|QWindow
modifier|*
name|parent
parameter_list|)
block|{
specifier|const
name|bool
name|modal
init|=
operator|(
name|windowModality
operator|!=
name|Qt
operator|::
name|NonModal
operator|)
decl_stmt|;
if|if
condition|(
operator|!
name|parent
condition|)
name|parent
operator|=
name|QGuiApplication
operator|::
name|focusWindow
argument_list|()
expr_stmt|;
comment|// Need a parent window, else the application loses activation when closed.
if|if
condition|(
name|parent
condition|)
block|{
name|m_ownerWindow
operator|=
name|QWindowsWindow
operator|::
name|handleOf
argument_list|(
name|parent
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|m_ownerWindow
operator|=
literal|0
expr_stmt|;
block|}
name|qCDebug
argument_list|(
name|lcQpaDialogs
argument_list|)
operator|<<
name|__FUNCTION__
operator|<<
literal|"modal="
operator|<<
name|modal
operator|<<
literal|" modal supported? "
operator|<<
name|supportsNonModalDialog
argument_list|(
name|parent
argument_list|)
operator|<<
literal|"native="
operator|<<
name|m_nativeDialog
operator|.
name|data
argument_list|()
operator|<<
literal|"owner"
operator|<<
name|m_ownerWindow
expr_stmt|;
if|if
condition|(
operator|!
name|modal
operator|&&
operator|!
name|supportsNonModalDialog
argument_list|(
name|parent
argument_list|)
condition|)
return|return
literal|false
return|;
comment|// Was it changed in-between?
if|if
condition|(
operator|!
name|ensureNativeDialog
argument_list|()
condition|)
return|return
literal|false
return|;
comment|// Start a background thread to show the dialog. For modal dialogs,
comment|// a subsequent call to exec() may follow. So, start an idle timer
comment|// which will start the dialog thread. If exec() is then called, the
comment|// timer is stopped and dialog->exec() is called directly.
name|cleanupThread
argument_list|()
expr_stmt|;
if|if
condition|(
name|modal
condition|)
block|{
name|m_timerId
operator|=
name|this
operator|->
name|startTimer
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|startDialogThread
argument_list|()
expr_stmt|;
block|}
return|return
literal|true
return|;
block|}
end_function
begin_function
template|template
parameter_list|<
name|class
name|BaseClass
parameter_list|>
DECL|function|startDialogThread
name|void
name|QWindowsDialogHelperBase
argument_list|<
name|BaseClass
argument_list|>
operator|::
name|startDialogThread
parameter_list|()
block|{
name|Q_ASSERT
argument_list|(
operator|!
name|m_nativeDialog
operator|.
name|isNull
argument_list|()
argument_list|)
expr_stmt|;
name|Q_ASSERT
argument_list|(
operator|!
name|m_thread
argument_list|)
expr_stmt|;
name|m_thread
operator|=
operator|new
name|QWindowsDialogThread
argument_list|(
name|m_nativeDialog
argument_list|,
name|m_ownerWindow
argument_list|)
expr_stmt|;
name|m_thread
operator|->
name|start
argument_list|()
expr_stmt|;
name|stopTimer
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
template|template
parameter_list|<
name|class
name|BaseClass
parameter_list|>
DECL|function|stopTimer
name|void
name|QWindowsDialogHelperBase
argument_list|<
name|BaseClass
argument_list|>
operator|::
name|stopTimer
parameter_list|()
block|{
if|if
condition|(
name|m_timerId
condition|)
block|{
name|this
operator|->
name|killTimer
argument_list|(
name|m_timerId
argument_list|)
expr_stmt|;
name|m_timerId
operator|=
literal|0
expr_stmt|;
block|}
block|}
end_function
begin_ifndef
ifndef|#
directive|ifndef
name|Q_OS_WINCE
end_ifndef
begin_comment
comment|// Find a file dialog window created by IFileDialog by process id, window
end_comment
begin_comment
comment|// title and class, which starts with a hash '#'.
end_comment
begin_struct
DECL|struct|FindDialogContext
struct|struct
name|FindDialogContext
block|{
DECL|function|FindDialogContext
specifier|explicit
name|FindDialogContext
parameter_list|(
specifier|const
name|QString
modifier|&
name|titleIn
parameter_list|)
member_init_list|:
name|title
argument_list|(
name|qStringToWCharArray
argument_list|(
name|titleIn
argument_list|)
argument_list|)
member_init_list|,
name|processId
argument_list|(
name|GetCurrentProcessId
argument_list|()
argument_list|)
member_init_list|,
name|hwnd
argument_list|(
literal|0
argument_list|)
block|{}
DECL|member|title
specifier|const
name|QScopedArrayPointer
argument_list|<
name|wchar_t
argument_list|>
name|title
decl_stmt|;
DECL|member|processId
specifier|const
name|DWORD
name|processId
decl_stmt|;
DECL|member|hwnd
name|HWND
name|hwnd
decl_stmt|;
comment|// contains the HWND of the window found.
block|}
struct|;
end_struct
begin_function
DECL|function|findDialogEnumWindowsProc
specifier|static
name|BOOL
name|QT_WIN_CALLBACK
name|findDialogEnumWindowsProc
parameter_list|(
name|HWND
name|hwnd
parameter_list|,
name|LPARAM
name|lParam
parameter_list|)
block|{
name|FindDialogContext
modifier|*
name|context
init|=
cast|reinterpret_cast
argument_list|<
name|FindDialogContext
operator|*
argument_list|>
argument_list|(
name|lParam
argument_list|)
decl_stmt|;
name|DWORD
name|winPid
init|=
literal|0
decl_stmt|;
name|GetWindowThreadProcessId
argument_list|(
name|hwnd
argument_list|,
operator|&
name|winPid
argument_list|)
expr_stmt|;
if|if
condition|(
name|winPid
operator|!=
name|context
operator|->
name|processId
condition|)
return|return
name|TRUE
return|;
name|wchar_t
name|buf
index|[
literal|256
index|]
decl_stmt|;
if|if
condition|(
operator|!
name|RealGetWindowClass
argument_list|(
name|hwnd
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|wchar_t
argument_list|)
argument_list|)
operator|||
name|buf
index|[
literal|0
index|]
operator|!=
literal|L'
expr|#'
condition|)
return|return
name|TRUE
return|;
if|if
condition|(
operator|!
name|GetWindowTextW
argument_list|(
name|hwnd
argument_list|,
name|buf
argument_list|,
sizeof|sizeof
argument_list|(
name|buf
argument_list|)
operator|/
sizeof|sizeof
argument_list|(
name|wchar_t
argument_list|)
argument_list|)
operator|||
name|wcscmp
argument_list|(
name|buf
argument_list|,
name|context
operator|->
name|title
operator|.
name|data
argument_list|()
argument_list|)
condition|)
return|return
name|TRUE
return|;
name|context
operator|->
name|hwnd
operator|=
name|hwnd
expr_stmt|;
return|return
name|FALSE
return|;
block|}
end_function
begin_function
DECL|function|findDialogWindow
specifier|static
specifier|inline
name|HWND
name|findDialogWindow
parameter_list|(
specifier|const
name|QString
modifier|&
name|title
parameter_list|)
block|{
name|FindDialogContext
name|context
argument_list|(
name|title
argument_list|)
decl_stmt|;
name|EnumWindows
argument_list|(
name|findDialogEnumWindowsProc
argument_list|,
cast|reinterpret_cast
argument_list|<
name|LPARAM
argument_list|>
argument_list|(
operator|&
name|context
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|context
operator|.
name|hwnd
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|// !Q_OS_WINCE
end_comment
begin_function
template|template
parameter_list|<
name|class
name|BaseClass
parameter_list|>
DECL|function|hide
name|void
name|QWindowsDialogHelperBase
argument_list|<
name|BaseClass
argument_list|>
operator|::
name|hide
parameter_list|()
block|{
if|if
condition|(
name|m_nativeDialog
condition|)
name|m_nativeDialog
operator|->
name|close
argument_list|()
expr_stmt|;
name|m_ownerWindow
operator|=
literal|0
expr_stmt|;
block|}
end_function
begin_function
template|template
parameter_list|<
name|class
name|BaseClass
parameter_list|>
DECL|function|exec
name|void
name|QWindowsDialogHelperBase
argument_list|<
name|BaseClass
argument_list|>
operator|::
name|exec
parameter_list|()
block|{
name|qCDebug
argument_list|(
name|lcQpaDialogs
argument_list|)
operator|<<
name|__FUNCTION__
expr_stmt|;
name|stopTimer
argument_list|()
expr_stmt|;
if|if
condition|(
name|QWindowsNativeDialogBase
modifier|*
name|nd
init|=
name|nativeDialog
argument_list|()
condition|)
block|{
name|nd
operator|->
name|exec
argument_list|(
name|m_ownerWindow
argument_list|)
expr_stmt|;
name|m_nativeDialog
operator|.
name|clear
argument_list|()
expr_stmt|;
block|}
block|}
end_function
begin_comment
comment|/*!     \class QWindowsFileDialogSharedData     \brief Explicitly shared file dialog parameters that are not in QFileDialogOptions.      Contain Parameters that need to be cached while the native dialog does not     exist yet. In addition, the data are updated by the change notifications of the     IFileDialogEvent, as querying them after the dialog has closed     does not reliably work. Provides thread-safe setters (for the non-modal case).      \internal     \ingroup qt-lighthouse-win     \sa QFileDialogOptions */
end_comment
begin_class
DECL|class|QWindowsFileDialogSharedData
class|class
name|QWindowsFileDialogSharedData
block|{
public|public:
DECL|function|QWindowsFileDialogSharedData
name|QWindowsFileDialogSharedData
parameter_list|()
member_init_list|:
name|m_data
argument_list|(
operator|new
name|Data
argument_list|)
block|{}
name|void
name|fromOptions
parameter_list|(
specifier|const
name|QSharedPointer
argument_list|<
name|QFileDialogOptions
argument_list|>
modifier|&
name|o
parameter_list|)
function_decl|;
name|QUrl
name|directory
parameter_list|()
specifier|const
function_decl|;
name|void
name|setDirectory
parameter_list|(
specifier|const
name|QUrl
modifier|&
parameter_list|)
function_decl|;
name|QString
name|selectedNameFilter
parameter_list|()
specifier|const
function_decl|;
name|void
name|setSelectedNameFilter
parameter_list|(
specifier|const
name|QString
modifier|&
parameter_list|)
function_decl|;
name|QList
argument_list|<
name|QUrl
argument_list|>
name|selectedFiles
parameter_list|()
specifier|const
function_decl|;
name|void
name|setSelectedFiles
parameter_list|(
specifier|const
name|QList
argument_list|<
name|QUrl
argument_list|>
modifier|&
parameter_list|)
function_decl|;
name|QString
name|selectedFile
parameter_list|()
specifier|const
function_decl|;
private|private:
DECL|class|Data
class|class
name|Data
super|:
specifier|public
name|QSharedData
block|{
public|public:
DECL|member|directory
name|QUrl
name|directory
decl_stmt|;
DECL|member|selectedNameFilter
name|QString
name|selectedNameFilter
decl_stmt|;
DECL|member|selectedFiles
name|QList
argument_list|<
name|QUrl
argument_list|>
name|selectedFiles
decl_stmt|;
DECL|member|mutex
name|QMutex
name|mutex
decl_stmt|;
block|}
class|;
DECL|member|m_data
name|QExplicitlySharedDataPointer
argument_list|<
name|Data
argument_list|>
name|m_data
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|directory
specifier|inline
name|QUrl
name|QWindowsFileDialogSharedData
operator|::
name|directory
parameter_list|()
specifier|const
block|{
name|m_data
operator|->
name|mutex
operator|.
name|lock
argument_list|()
expr_stmt|;
specifier|const
name|QUrl
name|result
init|=
name|m_data
operator|->
name|directory
decl_stmt|;
name|m_data
operator|->
name|mutex
operator|.
name|unlock
argument_list|()
expr_stmt|;
return|return
name|result
return|;
block|}
end_function
begin_function
DECL|function|setDirectory
specifier|inline
name|void
name|QWindowsFileDialogSharedData
operator|::
name|setDirectory
parameter_list|(
specifier|const
name|QUrl
modifier|&
name|d
parameter_list|)
block|{
name|QMutexLocker
argument_list|(
operator|&
name|m_data
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|m_data
operator|->
name|directory
operator|=
name|d
expr_stmt|;
block|}
end_function
begin_function
DECL|function|selectedNameFilter
specifier|inline
name|QString
name|QWindowsFileDialogSharedData
operator|::
name|selectedNameFilter
parameter_list|()
specifier|const
block|{
name|m_data
operator|->
name|mutex
operator|.
name|lock
argument_list|()
expr_stmt|;
specifier|const
name|QString
name|result
init|=
name|m_data
operator|->
name|selectedNameFilter
decl_stmt|;
name|m_data
operator|->
name|mutex
operator|.
name|unlock
argument_list|()
expr_stmt|;
return|return
name|result
return|;
block|}
end_function
begin_function
DECL|function|setSelectedNameFilter
specifier|inline
name|void
name|QWindowsFileDialogSharedData
operator|::
name|setSelectedNameFilter
parameter_list|(
specifier|const
name|QString
modifier|&
name|f
parameter_list|)
block|{
name|QMutexLocker
argument_list|(
operator|&
name|m_data
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|m_data
operator|->
name|selectedNameFilter
operator|=
name|f
expr_stmt|;
block|}
end_function
begin_function
DECL|function|selectedFiles
specifier|inline
name|QList
argument_list|<
name|QUrl
argument_list|>
name|QWindowsFileDialogSharedData
operator|::
name|selectedFiles
parameter_list|()
specifier|const
block|{
name|m_data
operator|->
name|mutex
operator|.
name|lock
argument_list|()
expr_stmt|;
specifier|const
name|QList
argument_list|<
name|QUrl
argument_list|>
name|result
init|=
name|m_data
operator|->
name|selectedFiles
decl_stmt|;
name|m_data
operator|->
name|mutex
operator|.
name|unlock
argument_list|()
expr_stmt|;
return|return
name|result
return|;
block|}
end_function
begin_function
DECL|function|selectedFile
specifier|inline
name|QString
name|QWindowsFileDialogSharedData
operator|::
name|selectedFile
parameter_list|()
specifier|const
block|{
specifier|const
name|QList
argument_list|<
name|QUrl
argument_list|>
name|files
init|=
name|selectedFiles
argument_list|()
decl_stmt|;
return|return
name|files
operator|.
name|isEmpty
argument_list|()
condition|?
name|QString
argument_list|()
else|:
name|files
operator|.
name|front
argument_list|()
operator|.
name|toLocalFile
argument_list|()
return|;
block|}
end_function
begin_function
DECL|function|setSelectedFiles
specifier|inline
name|void
name|QWindowsFileDialogSharedData
operator|::
name|setSelectedFiles
parameter_list|(
specifier|const
name|QList
argument_list|<
name|QUrl
argument_list|>
modifier|&
name|urls
parameter_list|)
block|{
name|QMutexLocker
argument_list|(
operator|&
name|m_data
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|m_data
operator|->
name|selectedFiles
operator|=
name|urls
expr_stmt|;
block|}
end_function
begin_function
DECL|function|fromOptions
specifier|inline
name|void
name|QWindowsFileDialogSharedData
operator|::
name|fromOptions
parameter_list|(
specifier|const
name|QSharedPointer
argument_list|<
name|QFileDialogOptions
argument_list|>
modifier|&
name|o
parameter_list|)
block|{
name|QMutexLocker
argument_list|(
operator|&
name|m_data
operator|->
name|mutex
argument_list|)
expr_stmt|;
name|m_data
operator|->
name|directory
operator|=
name|o
operator|->
name|initialDirectory
argument_list|()
expr_stmt|;
name|m_data
operator|->
name|selectedFiles
operator|=
name|o
operator|->
name|initiallySelectedFiles
argument_list|()
expr_stmt|;
name|m_data
operator|->
name|selectedNameFilter
operator|=
name|o
operator|->
name|initiallySelectedNameFilter
argument_list|()
expr_stmt|;
block|}
end_function
begin_comment
comment|/*!     \class QWindowsNativeFileDialogEventHandler     \brief Listens to IFileDialog events and forwards them to QWindowsNativeFileDialogBase      Events like 'folder change' that have an equivalent signal     in QFileDialog are forwarded.      \sa QWindowsNativeFileDialogBase, QWindowsFileDialogHelper     \internal     \ingroup qt-lighthouse-win */
end_comment
begin_class_decl
class_decl|class
name|QWindowsNativeFileDialogBase
class_decl|;
end_class_decl
begin_class
DECL|class|QWindowsNativeFileDialogEventHandler
class|class
name|QWindowsNativeFileDialogEventHandler
super|:
specifier|public
name|IFileDialogEvents
block|{
public|public:
specifier|static
name|IFileDialogEvents
modifier|*
name|create
parameter_list|(
name|QWindowsNativeFileDialogBase
modifier|*
name|nativeFileDialog
parameter_list|)
function_decl|;
comment|// IUnknown methods
DECL|function|QueryInterface
name|IFACEMETHODIMP
name|QueryInterface
parameter_list|(
name|REFIID
name|riid
parameter_list|,
name|void
modifier|*
modifier|*
name|ppv
parameter_list|)
block|{
if|if
condition|(
name|riid
operator|!=
name|IID_IUnknown
operator|&&
name|riid
operator|!=
name|IID_IFileDialogEvents
condition|)
block|{
operator|*
name|ppv
operator|=
name|NULL
expr_stmt|;
return|return
name|ResultFromScode
argument_list|(
name|E_NOINTERFACE
argument_list|)
return|;
block|}
operator|*
name|ppv
operator|=
name|this
expr_stmt|;
name|AddRef
argument_list|()
expr_stmt|;
return|return
name|NOERROR
return|;
block|}
DECL|function|AddRef
name|IFACEMETHODIMP_
argument_list|(
argument|ULONG
argument_list|)
name|AddRef
parameter_list|()
block|{
return|return
name|InterlockedIncrement
argument_list|(
operator|&
name|m_ref
argument_list|)
return|;
block|}
DECL|function|Release
name|IFACEMETHODIMP_
argument_list|(
argument|ULONG
argument_list|)
name|Release
parameter_list|()
block|{
specifier|const
name|long
name|ref
init|=
name|InterlockedDecrement
argument_list|(
operator|&
name|m_ref
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|ref
condition|)
operator|delete
name|this
expr_stmt|;
return|return
name|ref
return|;
block|}
comment|// IFileDialogEvents methods
name|IFACEMETHODIMP
name|OnFileOk
parameter_list|(
name|IFileDialog
modifier|*
parameter_list|)
function_decl|;
DECL|function|OnFolderChange
name|IFACEMETHODIMP
name|OnFolderChange
parameter_list|(
name|IFileDialog
modifier|*
parameter_list|)
block|{
return|return
name|S_OK
return|;
block|}
name|IFACEMETHODIMP
name|OnFolderChanging
parameter_list|(
name|IFileDialog
modifier|*
parameter_list|,
name|IShellItem
modifier|*
parameter_list|)
function_decl|;
DECL|function|OnHelp
name|IFACEMETHODIMP
name|OnHelp
parameter_list|(
name|IFileDialog
modifier|*
parameter_list|)
block|{
return|return
name|S_OK
return|;
block|}
name|IFACEMETHODIMP
name|OnSelectionChange
parameter_list|(
name|IFileDialog
modifier|*
parameter_list|)
function_decl|;
DECL|function|OnShareViolation
name|IFACEMETHODIMP
name|OnShareViolation
parameter_list|(
name|IFileDialog
modifier|*
parameter_list|,
name|IShellItem
modifier|*
parameter_list|,
name|FDE_SHAREVIOLATION_RESPONSE
modifier|*
parameter_list|)
block|{
return|return
name|S_OK
return|;
block|}
name|IFACEMETHODIMP
name|OnTypeChange
parameter_list|(
name|IFileDialog
modifier|*
parameter_list|)
function_decl|;
DECL|function|OnOverwrite
name|IFACEMETHODIMP
name|OnOverwrite
parameter_list|(
name|IFileDialog
modifier|*
parameter_list|,
name|IShellItem
modifier|*
parameter_list|,
name|FDE_OVERWRITE_RESPONSE
modifier|*
parameter_list|)
block|{
return|return
name|S_OK
return|;
block|}
DECL|function|QWindowsNativeFileDialogEventHandler
name|QWindowsNativeFileDialogEventHandler
parameter_list|(
name|QWindowsNativeFileDialogBase
modifier|*
name|nativeFileDialog
parameter_list|)
member_init_list|:
name|m_ref
argument_list|(
literal|1
argument_list|)
member_init_list|,
name|m_nativeFileDialog
argument_list|(
name|nativeFileDialog
argument_list|)
block|{}
DECL|function|~QWindowsNativeFileDialogEventHandler
specifier|virtual
name|~
name|QWindowsNativeFileDialogEventHandler
parameter_list|()
block|{}
private|private:
DECL|member|m_ref
name|long
name|m_ref
decl_stmt|;
DECL|member|m_nativeFileDialog
name|QWindowsNativeFileDialogBase
modifier|*
name|m_nativeFileDialog
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|create
name|IFileDialogEvents
modifier|*
name|QWindowsNativeFileDialogEventHandler
operator|::
name|create
parameter_list|(
name|QWindowsNativeFileDialogBase
modifier|*
name|nativeFileDialog
parameter_list|)
block|{
name|IFileDialogEvents
modifier|*
name|result
decl_stmt|;
name|QWindowsNativeFileDialogEventHandler
modifier|*
name|eventHandler
init|=
operator|new
name|QWindowsNativeFileDialogEventHandler
argument_list|(
name|nativeFileDialog
argument_list|)
decl_stmt|;
if|if
condition|(
name|FAILED
argument_list|(
name|eventHandler
operator|->
name|QueryInterface
argument_list|(
name|IID_IFileDialogEvents
argument_list|,
cast|reinterpret_cast
argument_list|<
name|void
operator|*
operator|*
argument_list|>
argument_list|(
operator|&
name|result
argument_list|)
argument_list|)
argument_list|)
condition|)
block|{
name|qErrnoWarning
argument_list|(
literal|"Unable to obtain IFileDialogEvents"
argument_list|)
expr_stmt|;
return|return
literal|0
return|;
block|}
name|eventHandler
operator|->
name|Release
argument_list|()
expr_stmt|;
return|return
name|result
return|;
block|}
end_function
begin_comment
comment|/*!     \class QWindowsNativeFileDialogBase     \brief Windows native file dialog wrapper around IFileOpenDialog, IFileSaveDialog.      Provides convenience methods.     Note that only IFileOpenDialog has multi-file functionality.      \sa QWindowsNativeFileDialogEventHandler, QWindowsFileDialogHelper     \internal     \ingroup qt-lighthouse-win */
end_comment
begin_class
DECL|class|QWindowsNativeFileDialogBase
class|class
name|QWindowsNativeFileDialogBase
super|:
specifier|public
name|QWindowsNativeDialogBase
block|{
name|Q_OBJECT
name|Q_PROPERTY
parameter_list|(
name|bool
name|hideFiltersDetails
name|READ
name|hideFiltersDetails
name|WRITE
name|setHideFiltersDetails
parameter_list|)
specifier|public
private|:
name|~
name|QWindowsNativeFileDialogBase
parameter_list|()
destructor_decl|;
specifier|inline
specifier|static
name|QWindowsNativeFileDialogBase
modifier|*
name|create
parameter_list|(
name|QFileDialogOptions
operator|::
name|AcceptMode
name|am
parameter_list|,
specifier|const
name|QWindowsFileDialogSharedData
modifier|&
name|data
parameter_list|)
function_decl|;
specifier|virtual
name|void
name|setWindowTitle
parameter_list|(
specifier|const
name|QString
modifier|&
name|title
parameter_list|)
function_decl|;
specifier|inline
name|void
name|setMode
parameter_list|(
name|QFileDialogOptions
operator|::
name|FileMode
name|mode
parameter_list|,
name|QFileDialogOptions
operator|::
name|AcceptMode
name|acceptMode
parameter_list|,
name|QFileDialogOptions
operator|::
name|FileDialogOptions
name|options
parameter_list|)
function_decl|;
specifier|inline
name|void
name|setDirectory
parameter_list|(
specifier|const
name|QUrl
modifier|&
name|directory
parameter_list|)
function_decl|;
DECL|function|updateDirectory
specifier|inline
name|void
name|updateDirectory
parameter_list|()
block|{
name|setDirectory
argument_list|(
name|m_data
operator|.
name|directory
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|inline
name|QString
name|directory
parameter_list|()
specifier|const
function_decl|;
specifier|virtual
name|void
name|doExec
parameter_list|(
name|HWND
name|owner
init|=
literal|0
parameter_list|)
function_decl|;
specifier|virtual
name|void
name|setNameFilters
parameter_list|(
specifier|const
name|QStringList
modifier|&
name|f
parameter_list|)
function_decl|;
specifier|inline
name|void
name|selectNameFilter
parameter_list|(
specifier|const
name|QString
modifier|&
name|filter
parameter_list|)
function_decl|;
DECL|function|updateSelectedNameFilter
specifier|inline
name|void
name|updateSelectedNameFilter
parameter_list|()
block|{
name|selectNameFilter
argument_list|(
name|m_data
operator|.
name|selectedNameFilter
argument_list|()
argument_list|)
expr_stmt|;
block|}
specifier|inline
name|QString
name|selectedNameFilter
parameter_list|()
specifier|const
function_decl|;
name|void
name|selectFile
parameter_list|(
specifier|const
name|QString
modifier|&
name|fileName
parameter_list|)
specifier|const
function_decl|;
DECL|function|hideFiltersDetails
name|bool
name|hideFiltersDetails
parameter_list|()
specifier|const
block|{
return|return
name|m_hideFiltersDetails
return|;
block|}
DECL|function|setHideFiltersDetails
name|void
name|setHideFiltersDetails
parameter_list|(
name|bool
name|h
parameter_list|)
block|{
name|m_hideFiltersDetails
operator|=
name|h
expr_stmt|;
block|}
name|void
name|setDefaultSuffix
parameter_list|(
specifier|const
name|QString
modifier|&
name|s
parameter_list|)
function_decl|;
DECL|function|hasDefaultSuffix
specifier|inline
name|bool
name|hasDefaultSuffix
parameter_list|()
specifier|const
block|{
return|return
name|m_hasDefaultSuffix
return|;
block|}
specifier|inline
name|void
name|setLabelText
parameter_list|(
name|QFileDialogOptions
operator|::
name|DialogLabel
name|l
parameter_list|,
specifier|const
name|QString
modifier|&
name|text
parameter_list|)
function_decl|;
comment|// Return the selected files for tracking in OnSelectionChanged().
specifier|virtual
name|QList
argument_list|<
name|QUrl
argument_list|>
name|selectedFiles
parameter_list|()
specifier|const
function_decl|=
literal|0
function_decl|;
comment|// Return the result for tracking in OnFileOk(). Differs from selection for
comment|// example by appended default suffixes, etc.
specifier|virtual
name|QList
argument_list|<
name|QUrl
argument_list|>
name|dialogResult
parameter_list|()
specifier|const
function_decl|=
literal|0
function_decl|;
specifier|inline
name|void
name|onFolderChange
parameter_list|(
name|IShellItem
modifier|*
parameter_list|)
function_decl|;
specifier|inline
name|void
name|onSelectionChange
parameter_list|()
function_decl|;
specifier|inline
name|void
name|onTypeChange
parameter_list|()
function_decl|;
specifier|inline
name|bool
name|onFileOk
parameter_list|()
function_decl|;
signals|signals:
name|void
name|directoryEntered
parameter_list|(
specifier|const
name|QUrl
modifier|&
name|directory
parameter_list|)
function_decl|;
name|void
name|currentChanged
parameter_list|(
specifier|const
name|QUrl
modifier|&
name|file
parameter_list|)
function_decl|;
name|void
name|filterSelected
parameter_list|(
specifier|const
name|QString
modifier|&
name|filter
parameter_list|)
function_decl|;
public|public
name|slots
public|:
specifier|virtual
name|void
name|close
parameter_list|()
function_decl|;
protected|protected:
specifier|explicit
name|QWindowsNativeFileDialogBase
parameter_list|(
specifier|const
name|QWindowsFileDialogSharedData
modifier|&
name|data
parameter_list|)
constructor_decl|;
name|bool
name|init
parameter_list|(
specifier|const
name|CLSID
modifier|&
name|clsId
parameter_list|,
specifier|const
name|IID
modifier|&
name|iid
parameter_list|)
function_decl|;
name|void
name|setDefaultSuffixSys
parameter_list|(
specifier|const
name|QString
modifier|&
name|s
parameter_list|)
function_decl|;
DECL|function|fileDialog
specifier|inline
name|IFileDialog
modifier|*
name|fileDialog
parameter_list|()
specifier|const
block|{
return|return
name|m_fileDialog
return|;
block|}
specifier|static
name|QString
name|itemPath
parameter_list|(
name|IShellItem
modifier|*
name|item
parameter_list|)
function_decl|;
specifier|static
name|QList
argument_list|<
name|QUrl
argument_list|>
name|libraryItemFolders
parameter_list|(
name|IShellItem
modifier|*
name|item
parameter_list|)
function_decl|;
specifier|static
name|QString
name|libraryItemDefaultSaveFolder
parameter_list|(
name|IShellItem
modifier|*
name|item
parameter_list|)
function_decl|;
specifier|static
name|int
name|itemPaths
parameter_list|(
name|IShellItemArray
modifier|*
name|items
parameter_list|,
name|QList
argument_list|<
name|QUrl
argument_list|>
modifier|*
name|fileResult
init|=
literal|0
parameter_list|)
function_decl|;
specifier|static
name|IShellItem
modifier|*
name|shellItem
parameter_list|(
specifier|const
name|QUrl
modifier|&
name|url
parameter_list|)
function_decl|;
DECL|function|data
specifier|const
name|QWindowsFileDialogSharedData
modifier|&
name|data
parameter_list|()
specifier|const
block|{
return|return
name|m_data
return|;
block|}
DECL|function|data
name|QWindowsFileDialogSharedData
modifier|&
name|data
parameter_list|()
block|{
return|return
name|m_data
return|;
block|}
private|private:
DECL|member|m_fileDialog
name|IFileDialog
modifier|*
name|m_fileDialog
decl_stmt|;
DECL|member|m_dialogEvents
name|IFileDialogEvents
modifier|*
name|m_dialogEvents
decl_stmt|;
DECL|member|m_cookie
name|DWORD
name|m_cookie
decl_stmt|;
DECL|member|m_nameFilters
name|QStringList
name|m_nameFilters
decl_stmt|;
DECL|member|m_hideFiltersDetails
name|bool
name|m_hideFiltersDetails
decl_stmt|;
DECL|member|m_hasDefaultSuffix
name|bool
name|m_hasDefaultSuffix
decl_stmt|;
DECL|member|m_data
name|QWindowsFileDialogSharedData
name|m_data
decl_stmt|;
DECL|member|m_title
name|QString
name|m_title
decl_stmt|;
block|}
class|;
end_class
begin_constructor
DECL|function|QWindowsNativeFileDialogBase
name|QWindowsNativeFileDialogBase
operator|::
name|QWindowsNativeFileDialogBase
parameter_list|(
specifier|const
name|QWindowsFileDialogSharedData
modifier|&
name|data
parameter_list|)
member_init_list|:
name|m_fileDialog
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|m_dialogEvents
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|m_cookie
argument_list|(
literal|0
argument_list|)
member_init_list|,
name|m_hideFiltersDetails
argument_list|(
literal|false
argument_list|)
member_init_list|,
name|m_hasDefaultSuffix
argument_list|(
literal|false
argument_list|)
member_init_list|,
name|m_data
argument_list|(
name|data
argument_list|)
block|{ }
end_constructor
begin_destructor
DECL|function|~QWindowsNativeFileDialogBase
name|QWindowsNativeFileDialogBase
operator|::
name|~
name|QWindowsNativeFileDialogBase
parameter_list|()
block|{
if|if
condition|(
name|m_dialogEvents
operator|&&
name|m_fileDialog
condition|)
name|m_fileDialog
operator|->
name|Unadvise
argument_list|(
name|m_cookie
argument_list|)
expr_stmt|;
if|if
condition|(
name|m_dialogEvents
condition|)
name|m_dialogEvents
operator|->
name|Release
argument_list|()
expr_stmt|;
if|if
condition|(
name|m_fileDialog
condition|)
name|m_fileDialog
operator|->
name|Release
argument_list|()
expr_stmt|;
block|}
end_destructor
begin_function
DECL|function|init
name|bool
name|QWindowsNativeFileDialogBase
operator|::
name|init
parameter_list|(
specifier|const
name|CLSID
modifier|&
name|clsId
parameter_list|,
specifier|const
name|IID
modifier|&
name|iid
parameter_list|)
block|{
name|HRESULT
name|hr
init|=
name|CoCreateInstance
argument_list|(
name|clsId
argument_list|,
name|NULL
argument_list|,
name|CLSCTX_INPROC_SERVER
argument_list|,
name|iid
argument_list|,
cast|reinterpret_cast
argument_list|<
name|void
operator|*
operator|*
argument_list|>
argument_list|(
operator|&
name|m_fileDialog
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|FAILED
argument_list|(
name|hr
argument_list|)
condition|)
block|{
name|qErrnoWarning
argument_list|(
literal|"CoCreateInstance failed"
argument_list|)
expr_stmt|;
return|return
literal|false
return|;
block|}
name|m_dialogEvents
operator|=
name|QWindowsNativeFileDialogEventHandler
operator|::
name|create
argument_list|(
name|this
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|m_dialogEvents
condition|)
return|return
literal|false
return|;
comment|// Register event handler
name|hr
operator|=
name|m_fileDialog
operator|->
name|Advise
argument_list|(
name|m_dialogEvents
argument_list|,
operator|&
name|m_cookie
argument_list|)
expr_stmt|;
if|if
condition|(
name|FAILED
argument_list|(
name|hr
argument_list|)
condition|)
block|{
name|qErrnoWarning
argument_list|(
literal|"IFileDialog::Advise failed"
argument_list|)
expr_stmt|;
return|return
literal|false
return|;
block|}
name|qCDebug
argument_list|(
name|lcQpaDialogs
argument_list|)
operator|<<
name|__FUNCTION__
operator|<<
name|m_fileDialog
operator|<<
name|m_dialogEvents
operator|<<
name|m_cookie
expr_stmt|;
return|return
literal|true
return|;
block|}
end_function
begin_function
DECL|function|setWindowTitle
name|void
name|QWindowsNativeFileDialogBase
operator|::
name|setWindowTitle
parameter_list|(
specifier|const
name|QString
modifier|&
name|title
parameter_list|)
block|{
name|m_title
operator|=
name|title
expr_stmt|;
name|m_fileDialog
operator|->
name|SetTitle
argument_list|(
cast|reinterpret_cast
argument_list|<
specifier|const
name|wchar_t
operator|*
argument_list|>
argument_list|(
name|title
operator|.
name|utf16
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|shellItem
name|IShellItem
modifier|*
name|QWindowsNativeFileDialogBase
operator|::
name|shellItem
parameter_list|(
specifier|const
name|QUrl
modifier|&
name|url
parameter_list|)
block|{
ifndef|#
directive|ifndef
name|Q_OS_WINCE
if|if
condition|(
name|url
operator|.
name|isLocalFile
argument_list|()
condition|)
block|{
if|if
condition|(
operator|!
name|QWindowsContext
operator|::
name|shell32dll
operator|.
name|sHCreateItemFromParsingName
condition|)
return|return
name|Q_NULLPTR
return|;
name|IShellItem
modifier|*
name|result
init|=
name|Q_NULLPTR
decl_stmt|;
specifier|const
name|QString
name|native
init|=
name|QDir
operator|::
name|toNativeSeparators
argument_list|(
name|url
operator|.
name|toLocalFile
argument_list|()
argument_list|)
decl_stmt|;
specifier|const
name|HRESULT
name|hr
init|=
name|QWindowsContext
operator|::
name|shell32dll
operator|.
name|sHCreateItemFromParsingName
argument_list|(
cast|reinterpret_cast
argument_list|<
specifier|const
name|wchar_t
operator|*
argument_list|>
argument_list|(
name|native
operator|.
name|utf16
argument_list|()
argument_list|)
argument_list|,
name|NULL
argument_list|,
name|IID_IShellItem
argument_list|,
cast|reinterpret_cast
argument_list|<
name|void
operator|*
operator|*
argument_list|>
argument_list|(
operator|&
name|result
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|FAILED
argument_list|(
name|hr
argument_list|)
condition|)
block|{
name|qErrnoWarning
argument_list|(
literal|"%s: SHCreateItemFromParsingName(%s)) failed"
argument_list|,
name|__FUNCTION__
argument_list|,
name|qPrintable
argument_list|(
name|url
operator|.
name|toString
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Q_NULLPTR
return|;
block|}
return|return
name|result
return|;
block|}
elseif|else
if|if
condition|(
name|url
operator|.
name|scheme
argument_list|()
operator|==
name|QLatin1String
argument_list|(
literal|"clsid"
argument_list|)
condition|)
block|{
if|if
condition|(
operator|!
name|QWindowsContext
operator|::
name|shell32dll
operator|.
name|sHGetKnownFolderIDList
operator|||
operator|!
name|QWindowsContext
operator|::
name|shell32dll
operator|.
name|sHCreateItemFromIDList
condition|)
return|return
name|Q_NULLPTR
return|;
comment|// Support for virtual folders via GUID
comment|// (see https://msdn.microsoft.com/en-us/library/windows/desktop/dd378457(v=vs.85).aspx)
comment|// specified as "clsid:<GUID>" (without '{', '}').
name|IShellItem
modifier|*
name|result
init|=
name|Q_NULLPTR
decl_stmt|;
specifier|const
name|QUuid
name|uuid
argument_list|(
name|url
operator|.
name|path
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|uuid
operator|.
name|isNull
argument_list|()
condition|)
block|{
name|qWarning
argument_list|()
operator|<<
name|__FUNCTION__
operator|<<
literal|": Invalid CLSID: "
operator|<<
name|url
operator|.
name|path
argument_list|()
expr_stmt|;
return|return
name|Q_NULLPTR
return|;
block|}
name|PIDLIST_ABSOLUTE
name|idList
decl_stmt|;
name|HRESULT
name|hr
init|=
name|QWindowsContext
operator|::
name|shell32dll
operator|.
name|sHGetKnownFolderIDList
argument_list|(
name|uuid
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|,
operator|&
name|idList
argument_list|)
decl_stmt|;
if|if
condition|(
name|FAILED
argument_list|(
name|hr
argument_list|)
condition|)
block|{
name|qErrnoWarning
argument_list|(
literal|"%s: SHGetKnownFolderIDList(%s)) failed"
argument_list|,
name|__FUNCTION__
argument_list|,
name|qPrintable
argument_list|(
name|url
operator|.
name|toString
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Q_NULLPTR
return|;
block|}
name|hr
operator|=
name|QWindowsContext
operator|::
name|shell32dll
operator|.
name|sHCreateItemFromIDList
argument_list|(
name|idList
argument_list|,
name|IID_IShellItem
argument_list|,
cast|reinterpret_cast
argument_list|<
name|void
operator|*
operator|*
argument_list|>
argument_list|(
operator|&
name|result
argument_list|)
argument_list|)
expr_stmt|;
name|CoTaskMemFree
argument_list|(
name|idList
argument_list|)
expr_stmt|;
if|if
condition|(
name|FAILED
argument_list|(
name|hr
argument_list|)
condition|)
block|{
name|qErrnoWarning
argument_list|(
literal|"%s: SHCreateItemFromIDList(%s)) failed"
argument_list|,
name|__FUNCTION__
argument_list|,
name|qPrintable
argument_list|(
name|url
operator|.
name|toString
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|Q_NULLPTR
return|;
block|}
return|return
name|result
return|;
block|}
else|else
block|{
name|qWarning
argument_list|()
operator|<<
name|__FUNCTION__
operator|<<
literal|": Unhandled scheme: "
operator|<<
name|url
operator|.
name|scheme
argument_list|()
expr_stmt|;
block|}
else|#
directive|else
comment|// !Q_OS_WINCE
name|Q_UNUSED
argument_list|(
argument|url
argument_list|)
endif|#
directive|endif
return|return
literal|0
return|;
block|}
end_function
begin_function
DECL|function|setDirectory
name|void
name|QWindowsNativeFileDialogBase
operator|::
name|setDirectory
parameter_list|(
specifier|const
name|QUrl
modifier|&
name|directory
parameter_list|)
block|{
if|if
condition|(
operator|!
name|directory
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
if|if
condition|(
name|IShellItem
modifier|*
name|psi
init|=
name|QWindowsNativeFileDialogBase
operator|::
name|shellItem
argument_list|(
name|directory
argument_list|)
condition|)
block|{
name|m_fileDialog
operator|->
name|SetFolder
argument_list|(
name|psi
argument_list|)
expr_stmt|;
name|psi
operator|->
name|Release
argument_list|()
expr_stmt|;
block|}
block|}
block|}
end_function
begin_function
DECL|function|directory
name|QString
name|QWindowsNativeFileDialogBase
operator|::
name|directory
parameter_list|()
specifier|const
block|{
ifndef|#
directive|ifndef
name|Q_OS_WINCE
name|IShellItem
modifier|*
name|item
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|m_fileDialog
operator|&&
name|SUCCEEDED
argument_list|(
name|m_fileDialog
operator|->
name|GetFolder
argument_list|(
operator|&
name|item
argument_list|)
argument_list|)
operator|&&
name|item
condition|)
return|return
name|QWindowsNativeFileDialogBase
operator|::
name|itemPath
argument_list|(
name|item
argument_list|)
return|;
endif|#
directive|endif
return|return
name|QString
argument_list|()
return|;
block|}
end_function
begin_function
DECL|function|doExec
name|void
name|QWindowsNativeFileDialogBase
operator|::
name|doExec
parameter_list|(
name|HWND
name|owner
parameter_list|)
block|{
name|qCDebug
argument_list|(
name|lcQpaDialogs
argument_list|)
operator|<<
literal|'>'
operator|<<
name|__FUNCTION__
expr_stmt|;
comment|// Show() blocks until the user closes the dialog, the dialog window
comment|// gets a WM_CLOSE or the parent window is destroyed.
specifier|const
name|HRESULT
name|hr
init|=
name|m_fileDialog
operator|->
name|Show
argument_list|(
name|owner
argument_list|)
decl_stmt|;
name|QWindowsDialogs
operator|::
name|eatMouseMove
argument_list|()
expr_stmt|;
name|qCDebug
argument_list|(
name|lcQpaDialogs
argument_list|)
operator|<<
literal|'<'
operator|<<
name|__FUNCTION__
operator|<<
literal|" returns "
operator|<<
name|hex
operator|<<
name|hr
expr_stmt|;
if|if
condition|(
name|hr
operator|==
name|S_OK
condition|)
block|{
emit|emit
name|accepted
argument_list|()
emit|;
block|}
else|else
block|{
emit|emit
name|rejected
argument_list|()
emit|;
block|}
block|}
end_function
begin_function
DECL|function|setMode
name|void
name|QWindowsNativeFileDialogBase
operator|::
name|setMode
parameter_list|(
name|QFileDialogOptions
operator|::
name|FileMode
name|mode
parameter_list|,
name|QFileDialogOptions
operator|::
name|AcceptMode
name|acceptMode
parameter_list|,
name|QFileDialogOptions
operator|::
name|FileDialogOptions
name|options
parameter_list|)
block|{
name|DWORD
name|flags
init|=
name|FOS_PATHMUSTEXIST
operator||
name|FOS_FORCESHOWHIDDEN
decl_stmt|;
if|if
condition|(
name|options
operator|&
name|QFileDialogOptions
operator|::
name|DontResolveSymlinks
condition|)
name|flags
operator||=
name|FOS_NODEREFERENCELINKS
expr_stmt|;
switch|switch
condition|(
name|mode
condition|)
block|{
case|case
name|QFileDialogOptions
operator|::
name|AnyFile
case|:
if|if
condition|(
name|acceptMode
operator|==
name|QFileDialogOptions
operator|::
name|AcceptSave
condition|)
name|flags
operator||=
name|FOS_NOREADONLYRETURN
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|options
operator|&
name|QFileDialogOptions
operator|::
name|DontConfirmOverwrite
operator|)
condition|)
name|flags
operator||=
name|FOS_OVERWRITEPROMPT
expr_stmt|;
break|break;
case|case
name|QFileDialogOptions
operator|::
name|ExistingFile
case|:
name|flags
operator||=
name|FOS_FILEMUSTEXIST
expr_stmt|;
break|break;
case|case
name|QFileDialogOptions
operator|::
name|Directory
case|:
case|case
name|QFileDialogOptions
operator|::
name|DirectoryOnly
case|:
name|flags
operator||=
name|FOS_PICKFOLDERS
operator||
name|FOS_FILEMUSTEXIST
expr_stmt|;
break|break;
case|case
name|QFileDialogOptions
operator|::
name|ExistingFiles
case|:
name|flags
operator||=
name|FOS_FILEMUSTEXIST
operator||
name|FOS_ALLOWMULTISELECT
expr_stmt|;
break|break;
block|}
name|qCDebug
argument_list|(
name|lcQpaDialogs
argument_list|)
operator|<<
name|__FUNCTION__
operator|<<
literal|"mode="
operator|<<
name|mode
operator|<<
literal|"acceptMode="
operator|<<
name|acceptMode
operator|<<
literal|"options="
operator|<<
name|options
operator|<<
literal|"results in"
operator|<<
name|showbase
operator|<<
name|hex
operator|<<
name|flags
expr_stmt|;
if|if
condition|(
name|FAILED
argument_list|(
name|m_fileDialog
operator|->
name|SetOptions
argument_list|(
name|flags
argument_list|)
argument_list|)
condition|)
name|qErrnoWarning
argument_list|(
literal|"%s: SetOptions() failed"
argument_list|,
name|__FUNCTION__
argument_list|)
expr_stmt|;
block|}
end_function
begin_if
if|#
directive|if
operator|!
name|defined
argument_list|(
name|Q_OS_WINCE
argument_list|)
operator|&&
name|defined
argument_list|(
name|__IShellLibrary_INTERFACE_DEFINED__
argument_list|)
end_if
begin_comment
comment|// Windows SDK 7
end_comment
begin_comment
comment|// Helper for "Libraries": collections of folders appearing from Windows 7
end_comment
begin_comment
comment|// on, visible in the file dialogs.
end_comment
begin_comment
comment|// Load a library from a IShellItem (sanitized copy of the inline function
end_comment
begin_comment
comment|// SHLoadLibraryFromItem from ShObjIdl.h, which does not exist for MinGW).
end_comment
begin_function
DECL|function|sHLoadLibraryFromItem
specifier|static
name|IShellLibrary
modifier|*
name|sHLoadLibraryFromItem
parameter_list|(
name|IShellItem
modifier|*
name|libraryItem
parameter_list|,
name|DWORD
name|mode
parameter_list|)
block|{
comment|// ID symbols present from Windows 7 on:
specifier|static
specifier|const
name|CLSID
name|classId_ShellLibrary
init|=
block|{
literal|0xd9b3211d
block|,
literal|0xe57f
block|,
literal|0x4426
block|,
block|{
literal|0xaa
block|,
literal|0xef
block|,
literal|0x30
block|,
literal|0xa8
block|,
literal|0x6
block|,
literal|0xad
block|,
literal|0xd3
block|,
literal|0x97
block|}
block|}
decl_stmt|;
specifier|static
specifier|const
name|IID
name|iId_IShellLibrary
init|=
block|{
literal|0x11a66efa
block|,
literal|0x382e
block|,
literal|0x451a
block|,
block|{
literal|0x92
block|,
literal|0x34
block|,
literal|0x1e
block|,
literal|0xe
block|,
literal|0x12
block|,
literal|0xef
block|,
literal|0x30
block|,
literal|0x85
block|}
block|}
decl_stmt|;
name|IShellLibrary
modifier|*
name|helper
init|=
literal|0
decl_stmt|;
name|IShellLibrary
modifier|*
name|result
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|SUCCEEDED
argument_list|(
name|CoCreateInstance
argument_list|(
name|classId_ShellLibrary
argument_list|,
name|NULL
argument_list|,
name|CLSCTX_INPROC_SERVER
argument_list|,
name|iId_IShellLibrary
argument_list|,
cast|reinterpret_cast
argument_list|<
name|void
operator|*
operator|*
argument_list|>
argument_list|(
operator|&
name|helper
argument_list|)
argument_list|)
argument_list|)
condition|)
if|if
condition|(
name|SUCCEEDED
argument_list|(
name|helper
operator|->
name|LoadLibraryFromItem
argument_list|(
name|libraryItem
argument_list|,
name|mode
argument_list|)
argument_list|)
condition|)
name|helper
operator|->
name|QueryInterface
argument_list|(
name|iId_IShellLibrary
argument_list|,
cast|reinterpret_cast
argument_list|<
name|void
operator|*
operator|*
argument_list|>
argument_list|(
operator|&
name|result
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|helper
condition|)
name|helper
operator|->
name|Release
argument_list|()
expr_stmt|;
return|return
name|result
return|;
block|}
end_function
begin_comment
comment|// Return all folders of a library-type item.
end_comment
begin_function
DECL|function|libraryItemFolders
name|QList
argument_list|<
name|QUrl
argument_list|>
name|QWindowsNativeFileDialogBase
operator|::
name|libraryItemFolders
parameter_list|(
name|IShellItem
modifier|*
name|item
parameter_list|)
block|{
name|QList
argument_list|<
name|QUrl
argument_list|>
name|result
decl_stmt|;
if|if
condition|(
name|IShellLibrary
modifier|*
name|library
init|=
name|sHLoadLibraryFromItem
argument_list|(
name|item
argument_list|,
name|STGM_READ
operator||
name|STGM_SHARE_DENY_WRITE
argument_list|)
condition|)
block|{
name|IShellItemArray
modifier|*
name|itemArray
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|SUCCEEDED
argument_list|(
name|library
operator|->
name|GetFolders
argument_list|(
name|LFF_FORCEFILESYSTEM
argument_list|,
name|IID_IShellItemArray
argument_list|,
cast|reinterpret_cast
argument_list|<
name|void
operator|*
operator|*
argument_list|>
argument_list|(
operator|&
name|itemArray
argument_list|)
argument_list|)
argument_list|)
condition|)
block|{
name|QWindowsNativeFileDialogBase
operator|::
name|itemPaths
argument_list|(
name|itemArray
argument_list|,
operator|&
name|result
argument_list|)
expr_stmt|;
name|itemArray
operator|->
name|Release
argument_list|()
expr_stmt|;
block|}
name|library
operator|->
name|Release
argument_list|()
expr_stmt|;
block|}
return|return
name|result
return|;
block|}
end_function
begin_comment
comment|// Return default save folders of a library-type item.
end_comment
begin_function
DECL|function|libraryItemDefaultSaveFolder
name|QString
name|QWindowsNativeFileDialogBase
operator|::
name|libraryItemDefaultSaveFolder
parameter_list|(
name|IShellItem
modifier|*
name|item
parameter_list|)
block|{
name|QString
name|result
decl_stmt|;
if|if
condition|(
name|IShellLibrary
modifier|*
name|library
init|=
name|sHLoadLibraryFromItem
argument_list|(
name|item
argument_list|,
name|STGM_READ
operator||
name|STGM_SHARE_DENY_WRITE
argument_list|)
condition|)
block|{
name|IShellItem
modifier|*
name|item
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|SUCCEEDED
argument_list|(
name|library
operator|->
name|GetDefaultSaveFolder
argument_list|(
name|DSFT_DETECT
argument_list|,
name|IID_IShellItem
argument_list|,
cast|reinterpret_cast
argument_list|<
name|void
operator|*
operator|*
argument_list|>
argument_list|(
operator|&
name|item
argument_list|)
argument_list|)
argument_list|)
condition|)
block|{
name|result
operator|=
name|QWindowsNativeFileDialogBase
operator|::
name|itemPath
argument_list|(
name|item
argument_list|)
expr_stmt|;
name|item
operator|->
name|Release
argument_list|()
expr_stmt|;
block|}
name|library
operator|->
name|Release
argument_list|()
expr_stmt|;
block|}
return|return
name|result
return|;
block|}
end_function
begin_else
else|#
directive|else
end_else
begin_comment
comment|// !Q_OS_WINCE&& __IShellLibrary_INTERFACE_DEFINED__
end_comment
begin_function
DECL|function|libraryItemFolders
name|QList
argument_list|<
name|QUrl
argument_list|>
name|QWindowsNativeFileDialogBase
operator|::
name|libraryItemFolders
parameter_list|(
name|IShellItem
modifier|*
parameter_list|)
block|{
return|return
name|QList
argument_list|<
name|QUrl
argument_list|>
argument_list|()
return|;
block|}
end_function
begin_function
DECL|function|libraryItemDefaultSaveFolder
name|QString
name|QWindowsNativeFileDialogBase
operator|::
name|libraryItemDefaultSaveFolder
parameter_list|(
name|IShellItem
modifier|*
parameter_list|)
block|{
return|return
name|QString
argument_list|()
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|// Q_OS_WINCE || !__IShellLibrary_INTERFACE_DEFINED__
end_comment
begin_function
DECL|function|itemPath
name|QString
name|QWindowsNativeFileDialogBase
operator|::
name|itemPath
parameter_list|(
name|IShellItem
modifier|*
name|item
parameter_list|)
block|{
name|SFGAOF
name|attributes
init|=
literal|0
decl_stmt|;
comment|// Check whether it has a file system representation?
if|if
condition|(
name|FAILED
argument_list|(
name|item
operator|->
name|GetAttributes
argument_list|(
name|SFGAO_FILESYSTEM
argument_list|,
operator|&
name|attributes
argument_list|)
argument_list|)
condition|)
return|return
name|QString
argument_list|()
return|;
if|if
condition|(
name|attributes
operator|&
name|SFGAO_FILESYSTEM
condition|)
block|{
name|LPWSTR
name|name
init|=
literal|0
decl_stmt|;
name|QString
name|result
decl_stmt|;
if|if
condition|(
name|SUCCEEDED
argument_list|(
name|item
operator|->
name|GetDisplayName
argument_list|(
name|SIGDN_FILESYSPATH
argument_list|,
operator|&
name|name
argument_list|)
argument_list|)
condition|)
block|{
name|result
operator|=
name|QDir
operator|::
name|cleanPath
argument_list|(
name|QString
operator|::
name|fromWCharArray
argument_list|(
name|name
argument_list|)
argument_list|)
expr_stmt|;
name|CoTaskMemFree
argument_list|(
name|name
argument_list|)
expr_stmt|;
block|}
return|return
name|result
return|;
block|}
comment|// Check for a "Library" item
if|if
condition|(
operator|(
name|QSysInfo
operator|::
name|windowsVersion
argument_list|()
operator|&
name|QSysInfo
operator|::
name|WV_NT_based
operator|)
operator|&&
name|QSysInfo
operator|::
name|windowsVersion
argument_list|()
operator|>=
name|QSysInfo
operator|::
name|WV_WINDOWS7
condition|)
return|return
name|QWindowsNativeFileDialogBase
operator|::
name|libraryItemDefaultSaveFolder
argument_list|(
name|item
argument_list|)
return|;
return|return
name|QString
argument_list|()
return|;
block|}
end_function
begin_function
DECL|function|itemPaths
name|int
name|QWindowsNativeFileDialogBase
operator|::
name|itemPaths
parameter_list|(
name|IShellItemArray
modifier|*
name|items
parameter_list|,
name|QList
argument_list|<
name|QUrl
argument_list|>
modifier|*
name|result
comment|/* = 0 */
parameter_list|)
block|{
name|DWORD
name|itemCount
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|result
condition|)
name|result
operator|->
name|clear
argument_list|()
expr_stmt|;
if|if
condition|(
name|FAILED
argument_list|(
name|items
operator|->
name|GetCount
argument_list|(
operator|&
name|itemCount
argument_list|)
argument_list|)
condition|)
return|return
literal|0
return|;
if|if
condition|(
name|result
operator|&&
name|itemCount
condition|)
block|{
name|result
operator|->
name|reserve
argument_list|(
name|itemCount
argument_list|)
expr_stmt|;
for|for
control|(
name|DWORD
name|i
init|=
literal|0
init|;
name|i
operator|<
name|itemCount
condition|;
operator|++
name|i
control|)
block|{
name|IShellItem
modifier|*
name|item
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|SUCCEEDED
argument_list|(
name|items
operator|->
name|GetItemAt
argument_list|(
name|i
argument_list|,
operator|&
name|item
argument_list|)
argument_list|)
condition|)
name|result
operator|->
name|push_back
argument_list|(
name|QUrl
operator|::
name|fromLocalFile
argument_list|(
name|QWindowsNativeFileDialogBase
operator|::
name|itemPath
argument_list|(
name|item
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
return|return
name|itemCount
return|;
block|}
end_function
begin_comment
comment|// Split a list of name filters into description and actual filters
end_comment
begin_struct
DECL|struct|FilterSpec
struct|struct
name|FilterSpec
block|{
DECL|member|description
name|QString
name|description
decl_stmt|;
DECL|member|filter
name|QString
name|filter
decl_stmt|;
block|}
struct|;
end_struct
begin_function
DECL|function|filterSpecs
specifier|static
name|QList
argument_list|<
name|FilterSpec
argument_list|>
name|filterSpecs
parameter_list|(
specifier|const
name|QStringList
modifier|&
name|filters
parameter_list|,
name|bool
name|hideFilterDetails
parameter_list|,
name|int
modifier|*
name|totalStringLength
parameter_list|)
block|{
name|QList
argument_list|<
name|FilterSpec
argument_list|>
name|result
decl_stmt|;
name|result
operator|.
name|reserve
argument_list|(
name|filters
operator|.
name|size
argument_list|()
argument_list|)
expr_stmt|;
operator|*
name|totalStringLength
operator|=
literal|0
expr_stmt|;
specifier|const
name|QRegExp
name|filterSeparatorRE
argument_list|(
name|QStringLiteral
argument_list|(
literal|"[;\\s]+"
argument_list|)
argument_list|)
decl_stmt|;
specifier|const
name|QString
name|separator
init|=
name|QStringLiteral
argument_list|(
literal|";"
argument_list|)
decl_stmt|;
name|Q_ASSERT
argument_list|(
name|filterSeparatorRE
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
comment|// Split filter specification as 'Texts (*.txt[;] *.doc)', '*.txt[;] *.doc'
comment|// into description and filters specification as '*.txt;*.doc'
foreach|foreach
control|(
specifier|const
name|QString
modifier|&
name|filterString
decl|,
name|filters
control|)
block|{
specifier|const
name|int
name|openingParenPos
init|=
name|filterString
operator|.
name|lastIndexOf
argument_list|(
name|QLatin1Char
argument_list|(
literal|'('
argument_list|)
argument_list|)
decl_stmt|;
specifier|const
name|int
name|closingParenPos
init|=
name|openingParenPos
operator|!=
operator|-
literal|1
condition|?
name|filterString
operator|.
name|indexOf
argument_list|(
name|QLatin1Char
argument_list|(
literal|')'
argument_list|)
argument_list|,
name|openingParenPos
operator|+
literal|1
argument_list|)
else|:
operator|-
literal|1
decl_stmt|;
name|FilterSpec
name|filterSpec
decl_stmt|;
name|filterSpec
operator|.
name|filter
operator|=
name|closingParenPos
operator|==
operator|-
literal|1
condition|?
name|filterString
else|:
name|filterString
operator|.
name|mid
argument_list|(
name|openingParenPos
operator|+
literal|1
argument_list|,
name|closingParenPos
operator|-
name|openingParenPos
operator|-
literal|1
argument_list|)
operator|.
name|trimmed
argument_list|()
expr_stmt|;
if|if
condition|(
name|filterSpec
operator|.
name|filter
operator|.
name|isEmpty
argument_list|()
condition|)
name|filterSpec
operator|.
name|filter
operator|+=
name|QLatin1Char
argument_list|(
literal|'*'
argument_list|)
expr_stmt|;
name|filterSpec
operator|.
name|filter
operator|.
name|replace
argument_list|(
name|filterSeparatorRE
argument_list|,
name|separator
argument_list|)
expr_stmt|;
name|filterSpec
operator|.
name|description
operator|=
name|filterString
expr_stmt|;
if|if
condition|(
name|hideFilterDetails
operator|&&
name|openingParenPos
operator|!=
operator|-
literal|1
condition|)
block|{
comment|// Do not show pattern in description
name|filterSpec
operator|.
name|description
operator|.
name|truncate
argument_list|(
name|openingParenPos
argument_list|)
expr_stmt|;
while|while
condition|(
name|filterSpec
operator|.
name|description
operator|.
name|endsWith
argument_list|(
name|QLatin1Char
argument_list|(
literal|' '
argument_list|)
argument_list|)
condition|)
name|filterSpec
operator|.
name|description
operator|.
name|truncate
argument_list|(
name|filterSpec
operator|.
name|description
operator|.
name|size
argument_list|()
operator|-
literal|1
argument_list|)
expr_stmt|;
block|}
operator|*
name|totalStringLength
operator|+=
name|filterSpec
operator|.
name|filter
operator|.
name|size
argument_list|()
operator|+
name|filterSpec
operator|.
name|description
operator|.
name|size
argument_list|()
expr_stmt|;
name|result
operator|.
name|push_back
argument_list|(
name|filterSpec
argument_list|)
expr_stmt|;
block|}
return|return
name|result
return|;
block|}
end_function
begin_function
DECL|function|setNameFilters
name|void
name|QWindowsNativeFileDialogBase
operator|::
name|setNameFilters
parameter_list|(
specifier|const
name|QStringList
modifier|&
name|filters
parameter_list|)
block|{
comment|/* Populates an array of COMDLG_FILTERSPEC from list of filters,      * store the strings in a flat, contiguous buffer. */
name|m_nameFilters
operator|=
name|filters
expr_stmt|;
name|int
name|totalStringLength
init|=
literal|0
decl_stmt|;
specifier|const
name|QList
argument_list|<
name|FilterSpec
argument_list|>
name|specs
init|=
name|filterSpecs
argument_list|(
name|filters
argument_list|,
name|m_hideFiltersDetails
argument_list|,
operator|&
name|totalStringLength
argument_list|)
decl_stmt|;
specifier|const
name|int
name|size
init|=
name|specs
operator|.
name|size
argument_list|()
decl_stmt|;
name|QScopedArrayPointer
argument_list|<
name|WCHAR
argument_list|>
name|buffer
argument_list|(
operator|new
name|WCHAR
index|[
name|totalStringLength
operator|+
literal|2
operator|*
name|size
index|]
argument_list|)
decl_stmt|;
name|QScopedArrayPointer
argument_list|<
name|COMDLG_FILTERSPEC
argument_list|>
name|comFilterSpec
argument_list|(
operator|new
name|COMDLG_FILTERSPEC
index|[
name|size
index|]
argument_list|)
decl_stmt|;
name|WCHAR
modifier|*
name|ptr
init|=
name|buffer
operator|.
name|data
argument_list|()
decl_stmt|;
comment|// Split filter specification as 'Texts (*.txt[;] *.doc)'
comment|// into description and filters specification as '*.txt;*.doc'
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|size
condition|;
operator|++
name|i
control|)
block|{
comment|// Display glitch (CLSID only): Any filter not filtering on suffix (such as
comment|// '*', 'a.*') will be duplicated in combo: 'All files (*) (*)',
comment|// 'AAA files (a.*) (a.*)'
name|QString
name|description
init|=
name|specs
index|[
name|i
index|]
operator|.
name|description
decl_stmt|;
specifier|const
name|QString
modifier|&
name|filter
init|=
name|specs
index|[
name|i
index|]
operator|.
name|filter
decl_stmt|;
if|if
condition|(
operator|!
name|m_hideFiltersDetails
operator|&&
operator|!
name|filter
operator|.
name|startsWith
argument_list|(
name|QLatin1String
argument_list|(
literal|"*."
argument_list|)
argument_list|)
condition|)
block|{
specifier|const
name|int
name|pos
init|=
name|description
operator|.
name|lastIndexOf
argument_list|(
name|QLatin1Char
argument_list|(
literal|'('
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|pos
operator|>
literal|0
condition|)
name|description
operator|.
name|truncate
argument_list|(
name|pos
argument_list|)
expr_stmt|;
block|}
comment|// Add to buffer.
name|comFilterSpec
index|[
name|i
index|]
operator|.
name|pszName
operator|=
name|ptr
expr_stmt|;
name|ptr
operator|+=
name|description
operator|.
name|toWCharArray
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
operator|*
name|ptr
operator|++
operator|=
literal|0
expr_stmt|;
name|comFilterSpec
index|[
name|i
index|]
operator|.
name|pszSpec
operator|=
name|ptr
expr_stmt|;
name|ptr
operator|+=
name|specs
index|[
name|i
index|]
operator|.
name|filter
operator|.
name|toWCharArray
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
operator|*
name|ptr
operator|++
operator|=
literal|0
expr_stmt|;
block|}
name|m_fileDialog
operator|->
name|SetFileTypes
argument_list|(
name|size
argument_list|,
name|comFilterSpec
operator|.
name|data
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setDefaultSuffix
name|void
name|QWindowsNativeFileDialogBase
operator|::
name|setDefaultSuffix
parameter_list|(
specifier|const
name|QString
modifier|&
name|s
parameter_list|)
block|{
name|setDefaultSuffixSys
argument_list|(
name|s
argument_list|)
expr_stmt|;
name|m_hasDefaultSuffix
operator|=
operator|!
name|s
operator|.
name|isEmpty
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setDefaultSuffixSys
name|void
name|QWindowsNativeFileDialogBase
operator|::
name|setDefaultSuffixSys
parameter_list|(
specifier|const
name|QString
modifier|&
name|s
parameter_list|)
block|{
comment|// If this parameter is non-empty, it will be appended by the dialog for the 'Any files'
comment|// filter ('*'). If this parameter is non-empty and the current filter has a suffix,
comment|// the dialog will append the filter's suffix.
name|wchar_t
modifier|*
name|wSuffix
init|=
cast|const_cast
argument_list|<
name|wchar_t
operator|*
argument_list|>
argument_list|(
cast|reinterpret_cast
argument_list|<
specifier|const
name|wchar_t
operator|*
argument_list|>
argument_list|(
name|s
operator|.
name|utf16
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|m_fileDialog
operator|->
name|SetDefaultExtension
argument_list|(
name|wSuffix
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setLabelText
name|void
name|QWindowsNativeFileDialogBase
operator|::
name|setLabelText
parameter_list|(
name|QFileDialogOptions
operator|::
name|DialogLabel
name|l
parameter_list|,
specifier|const
name|QString
modifier|&
name|text
parameter_list|)
block|{
name|wchar_t
modifier|*
name|wText
init|=
cast|const_cast
argument_list|<
name|wchar_t
operator|*
argument_list|>
argument_list|(
cast|reinterpret_cast
argument_list|<
specifier|const
name|wchar_t
operator|*
argument_list|>
argument_list|(
name|text
operator|.
name|utf16
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
switch|switch
condition|(
name|l
condition|)
block|{
case|case
name|QFileDialogOptions
operator|::
name|FileName
case|:
name|m_fileDialog
operator|->
name|SetFileNameLabel
argument_list|(
name|wText
argument_list|)
expr_stmt|;
break|break;
case|case
name|QFileDialogOptions
operator|::
name|Accept
case|:
name|m_fileDialog
operator|->
name|SetOkButtonLabel
argument_list|(
name|wText
argument_list|)
expr_stmt|;
break|break;
case|case
name|QFileDialogOptions
operator|::
name|LookIn
case|:
case|case
name|QFileDialogOptions
operator|::
name|Reject
case|:
case|case
name|QFileDialogOptions
operator|::
name|FileType
case|:
case|case
name|QFileDialogOptions
operator|::
name|DialogLabelCount
case|:
break|break;
block|}
block|}
end_function
begin_function
DECL|function|isClsid
specifier|static
specifier|inline
name|bool
name|isClsid
parameter_list|(
specifier|const
name|QString
modifier|&
name|s
parameter_list|)
block|{
comment|// detect "374DE290-123F-4565-9164-39C4925E467B".
specifier|static
specifier|const
name|QRegularExpression
name|pattern
argument_list|(
name|QLatin1String
argument_list|(
literal|"[0-9A-Fa-f]{8}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{4}-[0-9A-Fa-f]{8}"
argument_list|)
argument_list|)
decl_stmt|;
name|Q_ASSERT
argument_list|(
name|pattern
operator|.
name|isValid
argument_list|()
argument_list|)
expr_stmt|;
return|return
name|pattern
operator|.
name|match
argument_list|(
name|s
argument_list|)
operator|.
name|hasMatch
argument_list|()
return|;
block|}
end_function
begin_function
DECL|function|selectFile
name|void
name|QWindowsNativeFileDialogBase
operator|::
name|selectFile
parameter_list|(
specifier|const
name|QString
modifier|&
name|fileName
parameter_list|)
specifier|const
block|{
comment|// Hack to prevent CLSIDs from being set as file name due to
comment|// QFileDialogPrivate::initialSelection() being QString-based.
if|if
condition|(
operator|!
name|isClsid
argument_list|(
name|fileName
argument_list|)
condition|)
name|m_fileDialog
operator|->
name|SetFileName
argument_list|(
operator|(
name|wchar_t
operator|*
operator|)
name|fileName
operator|.
name|utf16
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// Return the index of the selected filter, accounting for QFileDialog
end_comment
begin_comment
comment|// sometimes stripping the filter specification depending on the
end_comment
begin_comment
comment|// hideFilterDetails setting.
end_comment
begin_function
DECL|function|indexOfNameFilter
specifier|static
name|int
name|indexOfNameFilter
parameter_list|(
specifier|const
name|QStringList
modifier|&
name|filters
parameter_list|,
specifier|const
name|QString
modifier|&
name|needle
parameter_list|)
block|{
specifier|const
name|int
name|index
init|=
name|filters
operator|.
name|indexOf
argument_list|(
name|needle
argument_list|)
decl_stmt|;
if|if
condition|(
name|index
operator|>=
literal|0
condition|)
return|return
name|index
return|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|filters
operator|.
name|size
argument_list|()
condition|;
operator|++
name|i
control|)
if|if
condition|(
name|filters
operator|.
name|at
argument_list|(
name|i
argument_list|)
operator|.
name|startsWith
argument_list|(
name|needle
argument_list|)
condition|)
return|return
name|i
return|;
return|return
operator|-
literal|1
return|;
block|}
end_function
begin_function
DECL|function|selectNameFilter
name|void
name|QWindowsNativeFileDialogBase
operator|::
name|selectNameFilter
parameter_list|(
specifier|const
name|QString
modifier|&
name|filter
parameter_list|)
block|{
if|if
condition|(
name|filter
operator|.
name|isEmpty
argument_list|()
condition|)
return|return;
specifier|const
name|int
name|index
init|=
name|indexOfNameFilter
argument_list|(
name|m_nameFilters
argument_list|,
name|filter
argument_list|)
decl_stmt|;
if|if
condition|(
name|index
operator|<
literal|0
condition|)
block|{
name|qWarning
argument_list|(
literal|"%s: Invalid parameter '%s' not found in '%s'."
argument_list|,
name|__FUNCTION__
argument_list|,
name|qPrintable
argument_list|(
name|filter
argument_list|)
argument_list|,
name|qPrintable
argument_list|(
name|m_nameFilters
operator|.
name|join
argument_list|(
name|QStringLiteral
argument_list|(
literal|", "
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return;
block|}
name|m_fileDialog
operator|->
name|SetFileTypeIndex
argument_list|(
name|index
operator|+
literal|1
argument_list|)
expr_stmt|;
comment|// one-based.
block|}
end_function
begin_function
DECL|function|selectedNameFilter
name|QString
name|QWindowsNativeFileDialogBase
operator|::
name|selectedNameFilter
parameter_list|()
specifier|const
block|{
name|UINT
name|uIndex
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|SUCCEEDED
argument_list|(
name|m_fileDialog
operator|->
name|GetFileTypeIndex
argument_list|(
operator|&
name|uIndex
argument_list|)
argument_list|)
condition|)
block|{
specifier|const
name|int
name|index
init|=
name|uIndex
operator|-
literal|1
decl_stmt|;
comment|// one-based
if|if
condition|(
name|index
operator|<
name|m_nameFilters
operator|.
name|size
argument_list|()
condition|)
return|return
name|m_nameFilters
operator|.
name|at
argument_list|(
name|index
argument_list|)
return|;
block|}
return|return
name|QString
argument_list|()
return|;
block|}
end_function
begin_function
DECL|function|onFolderChange
name|void
name|QWindowsNativeFileDialogBase
operator|::
name|onFolderChange
parameter_list|(
name|IShellItem
modifier|*
name|item
parameter_list|)
block|{
if|if
condition|(
name|item
condition|)
block|{
specifier|const
name|QUrl
name|directory
init|=
name|QUrl
operator|::
name|fromLocalFile
argument_list|(
name|QWindowsNativeFileDialogBase
operator|::
name|itemPath
argument_list|(
name|item
argument_list|)
argument_list|)
decl_stmt|;
name|m_data
operator|.
name|setDirectory
argument_list|(
name|directory
argument_list|)
expr_stmt|;
emit|emit
name|directoryEntered
argument_list|(
name|directory
argument_list|)
emit|;
block|}
block|}
end_function
begin_function
DECL|function|onSelectionChange
name|void
name|QWindowsNativeFileDialogBase
operator|::
name|onSelectionChange
parameter_list|()
block|{
specifier|const
name|QList
argument_list|<
name|QUrl
argument_list|>
name|current
init|=
name|selectedFiles
argument_list|()
decl_stmt|;
name|m_data
operator|.
name|setSelectedFiles
argument_list|(
name|current
argument_list|)
expr_stmt|;
if|if
condition|(
name|current
operator|.
name|size
argument_list|()
operator|==
literal|1
condition|)
emit|emit
name|currentChanged
argument_list|(
name|current
operator|.
name|front
argument_list|()
argument_list|)
emit|;
block|}
end_function
begin_function
DECL|function|onTypeChange
name|void
name|QWindowsNativeFileDialogBase
operator|::
name|onTypeChange
parameter_list|()
block|{
specifier|const
name|QString
name|filter
init|=
name|selectedNameFilter
argument_list|()
decl_stmt|;
name|m_data
operator|.
name|setSelectedNameFilter
argument_list|(
name|filter
argument_list|)
expr_stmt|;
emit|emit
name|filterSelected
argument_list|(
name|filter
argument_list|)
emit|;
block|}
end_function
begin_function
DECL|function|onFileOk
name|bool
name|QWindowsNativeFileDialogBase
operator|::
name|onFileOk
parameter_list|()
block|{
comment|// Store selected files as GetResults() returns invalid data after the dialog closes.
name|m_data
operator|.
name|setSelectedFiles
argument_list|(
name|dialogResult
argument_list|()
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
end_function
begin_function
DECL|function|close
name|void
name|QWindowsNativeFileDialogBase
operator|::
name|close
parameter_list|()
block|{
name|m_fileDialog
operator|->
name|Close
argument_list|(
name|S_OK
argument_list|)
expr_stmt|;
ifndef|#
directive|ifndef
name|Q_OS_WINCE
comment|// IFileDialog::Close() does not work unless invoked from a callback.
comment|// Try to find the window and send it a WM_CLOSE in addition.
specifier|const
name|HWND
name|hwnd
init|=
name|findDialogWindow
argument_list|(
name|m_title
argument_list|)
decl_stmt|;
name|qCDebug
argument_list|(
name|lcQpaDialogs
argument_list|)
operator|<<
name|__FUNCTION__
operator|<<
literal|"closing"
operator|<<
name|hwnd
expr_stmt|;
if|if
condition|(
name|hwnd
operator|&&
name|IsWindowVisible
argument_list|(
name|hwnd
argument_list|)
condition|)
name|PostMessageW
argument_list|(
name|hwnd
argument_list|,
name|WM_CLOSE
argument_list|,
literal|0
argument_list|,
literal|0
argument_list|)
expr_stmt|;
endif|#
directive|endif
comment|// !Q_OS_WINCE
block|}
end_function
begin_function
DECL|function|OnFolderChanging
name|HRESULT
name|QWindowsNativeFileDialogEventHandler
operator|::
name|OnFolderChanging
parameter_list|(
name|IFileDialog
modifier|*
parameter_list|,
name|IShellItem
modifier|*
name|item
parameter_list|)
block|{
name|m_nativeFileDialog
operator|->
name|onFolderChange
argument_list|(
name|item
argument_list|)
expr_stmt|;
return|return
name|S_OK
return|;
block|}
end_function
begin_function
DECL|function|OnSelectionChange
name|HRESULT
name|QWindowsNativeFileDialogEventHandler
operator|::
name|OnSelectionChange
parameter_list|(
name|IFileDialog
modifier|*
parameter_list|)
block|{
name|m_nativeFileDialog
operator|->
name|onSelectionChange
argument_list|()
expr_stmt|;
return|return
name|S_OK
return|;
block|}
end_function
begin_function
DECL|function|OnTypeChange
name|HRESULT
name|QWindowsNativeFileDialogEventHandler
operator|::
name|OnTypeChange
parameter_list|(
name|IFileDialog
modifier|*
parameter_list|)
block|{
name|m_nativeFileDialog
operator|->
name|onTypeChange
argument_list|()
expr_stmt|;
return|return
name|S_OK
return|;
block|}
end_function
begin_function
DECL|function|OnFileOk
name|HRESULT
name|QWindowsNativeFileDialogEventHandler
operator|::
name|OnFileOk
parameter_list|(
name|IFileDialog
modifier|*
parameter_list|)
block|{
return|return
name|m_nativeFileDialog
operator|->
name|onFileOk
argument_list|()
condition|?
name|S_OK
else|:
name|S_FALSE
return|;
block|}
end_function
begin_comment
comment|/*!     \class QWindowsNativeSaveFileDialog     \brief Windows native file save dialog wrapper around IFileSaveDialog.      Implements single-selection methods.      \internal     \ingroup qt-lighthouse-win */
end_comment
begin_class
DECL|class|QWindowsNativeSaveFileDialog
class|class
name|QWindowsNativeSaveFileDialog
super|:
specifier|public
name|QWindowsNativeFileDialogBase
block|{
name|Q_OBJECT
public|public:
DECL|function|QWindowsNativeSaveFileDialog
specifier|explicit
name|QWindowsNativeSaveFileDialog
parameter_list|(
specifier|const
name|QWindowsFileDialogSharedData
modifier|&
name|data
parameter_list|)
member_init_list|:
name|QWindowsNativeFileDialogBase
argument_list|(
name|data
argument_list|)
block|{}
specifier|virtual
name|void
name|setNameFilters
parameter_list|(
specifier|const
name|QStringList
modifier|&
name|f
parameter_list|)
function_decl|;
specifier|virtual
name|QList
argument_list|<
name|QUrl
argument_list|>
name|selectedFiles
parameter_list|()
specifier|const
function_decl|;
specifier|virtual
name|QList
argument_list|<
name|QUrl
argument_list|>
name|dialogResult
parameter_list|()
specifier|const
function_decl|;
block|}
class|;
end_class
begin_comment
comment|// Return the first suffix from the name filter "Foo files (*.foo;*.bar)" -> "foo".
end_comment
begin_function
DECL|function|suffixFromFilter
specifier|static
specifier|inline
name|QString
name|suffixFromFilter
parameter_list|(
specifier|const
name|QString
modifier|&
name|filter
parameter_list|)
block|{
name|int
name|suffixPos
init|=
name|filter
operator|.
name|indexOf
argument_list|(
name|QLatin1String
argument_list|(
literal|"(*."
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|suffixPos
operator|<
literal|0
condition|)
return|return
name|QString
argument_list|()
return|;
name|suffixPos
operator|+=
literal|3
expr_stmt|;
name|int
name|endPos
init|=
name|filter
operator|.
name|indexOf
argument_list|(
name|QLatin1Char
argument_list|(
literal|' '
argument_list|)
argument_list|,
name|suffixPos
operator|+
literal|1
argument_list|)
decl_stmt|;
if|if
condition|(
name|endPos
operator|<
literal|0
condition|)
name|endPos
operator|=
name|filter
operator|.
name|indexOf
argument_list|(
name|QLatin1Char
argument_list|(
literal|';'
argument_list|)
argument_list|,
name|suffixPos
operator|+
literal|1
argument_list|)
expr_stmt|;
if|if
condition|(
name|endPos
operator|<
literal|0
condition|)
name|endPos
operator|=
name|filter
operator|.
name|indexOf
argument_list|(
name|QLatin1Char
argument_list|(
literal|')'
argument_list|)
argument_list|,
name|suffixPos
operator|+
literal|1
argument_list|)
expr_stmt|;
return|return
name|endPos
operator|>=
literal|0
condition|?
name|filter
operator|.
name|mid
argument_list|(
name|suffixPos
argument_list|,
name|endPos
operator|-
name|suffixPos
argument_list|)
else|:
name|QString
argument_list|()
return|;
block|}
end_function
begin_function
DECL|function|setNameFilters
name|void
name|QWindowsNativeSaveFileDialog
operator|::
name|setNameFilters
parameter_list|(
specifier|const
name|QStringList
modifier|&
name|f
parameter_list|)
block|{
name|QWindowsNativeFileDialogBase
operator|::
name|setNameFilters
argument_list|(
name|f
argument_list|)
expr_stmt|;
comment|// QTBUG-31381, QTBUG-30748: IFileDialog will update the suffix of the selected name
comment|// filter only if a default suffix is set (see docs). Set the first available
comment|// suffix unless we have a defaultSuffix.
if|if
condition|(
operator|!
name|hasDefaultSuffix
argument_list|()
condition|)
block|{
foreach|foreach
control|(
specifier|const
name|QString
modifier|&
name|filter
decl|,
name|f
control|)
block|{
specifier|const
name|QString
name|suffix
init|=
name|suffixFromFilter
argument_list|(
name|filter
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|suffix
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|setDefaultSuffixSys
argument_list|(
name|suffix
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
block|}
comment|// m_hasDefaultSuffix
block|}
end_function
begin_function
DECL|function|dialogResult
name|QList
argument_list|<
name|QUrl
argument_list|>
name|QWindowsNativeSaveFileDialog
operator|::
name|dialogResult
parameter_list|()
specifier|const
block|{
name|QList
argument_list|<
name|QUrl
argument_list|>
name|result
decl_stmt|;
name|IShellItem
modifier|*
name|item
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|SUCCEEDED
argument_list|(
name|fileDialog
argument_list|()
operator|->
name|GetResult
argument_list|(
operator|&
name|item
argument_list|)
argument_list|)
operator|&&
name|item
condition|)
name|result
operator|.
name|push_back
argument_list|(
name|QUrl
operator|::
name|fromLocalFile
argument_list|(
name|QWindowsNativeFileDialogBase
operator|::
name|itemPath
argument_list|(
name|item
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function
begin_function
DECL|function|selectedFiles
name|QList
argument_list|<
name|QUrl
argument_list|>
name|QWindowsNativeSaveFileDialog
operator|::
name|selectedFiles
parameter_list|()
specifier|const
block|{
name|QList
argument_list|<
name|QUrl
argument_list|>
name|result
decl_stmt|;
name|IShellItem
modifier|*
name|item
init|=
literal|0
decl_stmt|;
specifier|const
name|HRESULT
name|hr
init|=
name|fileDialog
argument_list|()
operator|->
name|GetCurrentSelection
argument_list|(
operator|&
name|item
argument_list|)
decl_stmt|;
if|if
condition|(
name|SUCCEEDED
argument_list|(
name|hr
argument_list|)
operator|&&
name|item
condition|)
name|result
operator|.
name|push_back
argument_list|(
name|QUrl
operator|::
name|fromLocalFile
argument_list|(
name|QWindowsNativeSaveFileDialog
operator|::
name|itemPath
argument_list|(
name|item
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function
begin_comment
comment|/*!     \class QWindowsNativeOpenFileDialog     \brief Windows native file save dialog wrapper around IFileOpenDialog.      Implements multi-selection methods.      \internal     \ingroup qt-lighthouse-win */
end_comment
begin_class
DECL|class|QWindowsNativeOpenFileDialog
class|class
name|QWindowsNativeOpenFileDialog
super|:
specifier|public
name|QWindowsNativeFileDialogBase
block|{
public|public:
DECL|function|QWindowsNativeOpenFileDialog
specifier|explicit
name|QWindowsNativeOpenFileDialog
parameter_list|(
specifier|const
name|QWindowsFileDialogSharedData
modifier|&
name|data
parameter_list|)
member_init_list|:
name|QWindowsNativeFileDialogBase
argument_list|(
name|data
argument_list|)
block|{}
specifier|virtual
name|QList
argument_list|<
name|QUrl
argument_list|>
name|selectedFiles
parameter_list|()
specifier|const
function_decl|;
specifier|virtual
name|QList
argument_list|<
name|QUrl
argument_list|>
name|dialogResult
parameter_list|()
specifier|const
function_decl|;
private|private:
DECL|function|openFileDialog
specifier|inline
name|IFileOpenDialog
modifier|*
name|openFileDialog
parameter_list|()
specifier|const
block|{
return|return
cast|static_cast
argument_list|<
name|IFileOpenDialog
operator|*
argument_list|>
argument_list|(
name|fileDialog
argument_list|()
argument_list|)
return|;
block|}
block|}
class|;
end_class
begin_function
DECL|function|dialogResult
name|QList
argument_list|<
name|QUrl
argument_list|>
name|QWindowsNativeOpenFileDialog
operator|::
name|dialogResult
parameter_list|()
specifier|const
block|{
name|QList
argument_list|<
name|QUrl
argument_list|>
name|result
decl_stmt|;
name|IShellItemArray
modifier|*
name|items
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|SUCCEEDED
argument_list|(
name|openFileDialog
argument_list|()
operator|->
name|GetResults
argument_list|(
operator|&
name|items
argument_list|)
argument_list|)
operator|&&
name|items
condition|)
name|QWindowsNativeFileDialogBase
operator|::
name|itemPaths
argument_list|(
name|items
argument_list|,
operator|&
name|result
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function
begin_function
DECL|function|selectedFiles
name|QList
argument_list|<
name|QUrl
argument_list|>
name|QWindowsNativeOpenFileDialog
operator|::
name|selectedFiles
parameter_list|()
specifier|const
block|{
name|QList
argument_list|<
name|QUrl
argument_list|>
name|result
decl_stmt|;
name|IShellItemArray
modifier|*
name|items
init|=
literal|0
decl_stmt|;
specifier|const
name|HRESULT
name|hr
init|=
name|openFileDialog
argument_list|()
operator|->
name|GetSelectedItems
argument_list|(
operator|&
name|items
argument_list|)
decl_stmt|;
if|if
condition|(
name|SUCCEEDED
argument_list|(
name|hr
argument_list|)
operator|&&
name|items
condition|)
name|QWindowsNativeFileDialogBase
operator|::
name|itemPaths
argument_list|(
name|items
argument_list|,
operator|&
name|result
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function
begin_comment
comment|/*!     \brief Factory method for QWindowsNativeFileDialogBase returning     QWindowsNativeOpenFileDialog or QWindowsNativeSaveFileDialog depending on     QFileDialog::AcceptMode. */
end_comment
begin_function
DECL|function|create
name|QWindowsNativeFileDialogBase
modifier|*
name|QWindowsNativeFileDialogBase
operator|::
name|create
parameter_list|(
name|QFileDialogOptions
operator|::
name|AcceptMode
name|am
parameter_list|,
specifier|const
name|QWindowsFileDialogSharedData
modifier|&
name|data
parameter_list|)
block|{
name|QWindowsNativeFileDialogBase
modifier|*
name|result
init|=
literal|0
decl_stmt|;
if|if
condition|(
name|am
operator|==
name|QFileDialogOptions
operator|::
name|AcceptOpen
condition|)
block|{
name|result
operator|=
operator|new
name|QWindowsNativeOpenFileDialog
argument_list|(
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|result
operator|->
name|init
argument_list|(
name|CLSID_FileOpenDialog
argument_list|,
name|IID_IFileOpenDialog
argument_list|)
condition|)
block|{
operator|delete
name|result
expr_stmt|;
return|return
literal|0
return|;
block|}
block|}
else|else
block|{
name|result
operator|=
operator|new
name|QWindowsNativeSaveFileDialog
argument_list|(
name|data
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|result
operator|->
name|init
argument_list|(
name|CLSID_FileSaveDialog
argument_list|,
name|IID_IFileSaveDialog
argument_list|)
condition|)
block|{
operator|delete
name|result
expr_stmt|;
return|return
literal|0
return|;
block|}
block|}
return|return
name|result
return|;
block|}
end_function
begin_function
DECL|function|isQQuickWindow
specifier|static
specifier|inline
name|bool
name|isQQuickWindow
parameter_list|(
specifier|const
name|QWindow
modifier|*
name|w
init|=
literal|0
parameter_list|)
block|{
return|return
name|w
operator|&&
name|w
operator|->
name|inherits
argument_list|(
literal|"QQuickWindow"
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/*!     \class QWindowsFileDialogHelper     \brief Helper for native Windows file dialogs      For Qt 4 compatibility, do not create native non-modal dialogs on widgets,     but only on QQuickWindows, which do not have a fallback.      \internal     \ingroup qt-lighthouse-win */
end_comment
begin_class
DECL|class|QWindowsFileDialogHelper
class|class
name|QWindowsFileDialogHelper
super|:
specifier|public
name|QWindowsDialogHelperBase
argument_list|<
name|QPlatformFileDialogHelper
argument_list|>
block|{
public|public:
DECL|function|QWindowsFileDialogHelper
name|QWindowsFileDialogHelper
parameter_list|()
block|{}
DECL|function|supportsNonModalDialog
specifier|virtual
name|bool
name|supportsNonModalDialog
parameter_list|(
specifier|const
name|QWindow
modifier|*
comment|/* parent */
init|=
literal|0
parameter_list|)
specifier|const
block|{
return|return
literal|false
return|;
block|}
DECL|function|defaultNameFilterDisables
specifier|virtual
name|bool
name|defaultNameFilterDisables
parameter_list|()
specifier|const
block|{
return|return
literal|false
return|;
block|}
DECL|member|Q_DECL_OVERRIDE
specifier|virtual
name|void
name|setDirectory
parameter_list|(
specifier|const
name|QUrl
modifier|&
name|directory
parameter_list|)
name|Q_DECL_OVERRIDE
function_decl|;
DECL|member|Q_DECL_OVERRIDE
specifier|virtual
name|QUrl
name|directory
parameter_list|()
specifier|const
name|Q_DECL_OVERRIDE
function_decl|;
DECL|member|Q_DECL_OVERRIDE
specifier|virtual
name|void
name|selectFile
parameter_list|(
specifier|const
name|QUrl
modifier|&
name|filename
parameter_list|)
name|Q_DECL_OVERRIDE
function_decl|;
DECL|member|Q_DECL_OVERRIDE
specifier|virtual
name|QList
argument_list|<
name|QUrl
argument_list|>
name|selectedFiles
parameter_list|()
specifier|const
name|Q_DECL_OVERRIDE
function_decl|;
DECL|member|Q_DECL_OVERRIDE
specifier|virtual
name|void
name|setFilter
parameter_list|()
name|Q_DECL_OVERRIDE
function_decl|;
DECL|member|Q_DECL_OVERRIDE
specifier|virtual
name|void
name|selectNameFilter
parameter_list|(
specifier|const
name|QString
modifier|&
name|filter
parameter_list|)
name|Q_DECL_OVERRIDE
function_decl|;
DECL|member|Q_DECL_OVERRIDE
specifier|virtual
name|QString
name|selectedNameFilter
parameter_list|()
specifier|const
name|Q_DECL_OVERRIDE
function_decl|;
private|private:
specifier|virtual
name|QWindowsNativeDialogBase
modifier|*
name|createNativeDialog
parameter_list|()
function_decl|;
DECL|function|nativeFileDialog
specifier|inline
name|QWindowsNativeFileDialogBase
modifier|*
name|nativeFileDialog
parameter_list|()
specifier|const
block|{
return|return
cast|static_cast
argument_list|<
name|QWindowsNativeFileDialogBase
operator|*
argument_list|>
argument_list|(
name|nativeDialog
argument_list|()
argument_list|)
return|;
block|}
comment|// Cache for the case no native dialog is created.
DECL|member|m_data
name|QWindowsFileDialogSharedData
name|m_data
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|createNativeDialog
name|QWindowsNativeDialogBase
modifier|*
name|QWindowsFileDialogHelper
operator|::
name|createNativeDialog
parameter_list|()
block|{
name|QWindowsNativeFileDialogBase
modifier|*
name|result
init|=
name|QWindowsNativeFileDialogBase
operator|::
name|create
argument_list|(
name|options
argument_list|()
operator|->
name|acceptMode
argument_list|()
argument_list|,
name|m_data
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|result
condition|)
return|return
literal|0
return|;
name|QObject
operator|::
name|connect
argument_list|(
name|result
argument_list|,
operator|&
name|QWindowsNativeDialogBase
operator|::
name|accepted
argument_list|,
name|this
argument_list|,
operator|&
name|QPlatformDialogHelper
operator|::
name|accept
argument_list|)
expr_stmt|;
name|QObject
operator|::
name|connect
argument_list|(
name|result
argument_list|,
operator|&
name|QWindowsNativeDialogBase
operator|::
name|rejected
argument_list|,
name|this
argument_list|,
operator|&
name|QPlatformDialogHelper
operator|::
name|reject
argument_list|)
expr_stmt|;
name|QObject
operator|::
name|connect
argument_list|(
name|result
argument_list|,
operator|&
name|QWindowsNativeFileDialogBase
operator|::
name|directoryEntered
argument_list|,
name|this
argument_list|,
operator|&
name|QPlatformFileDialogHelper
operator|::
name|directoryEntered
argument_list|)
expr_stmt|;
name|QObject
operator|::
name|connect
argument_list|(
name|result
argument_list|,
operator|&
name|QWindowsNativeFileDialogBase
operator|::
name|currentChanged
argument_list|,
name|this
argument_list|,
operator|&
name|QPlatformFileDialogHelper
operator|::
name|currentChanged
argument_list|)
expr_stmt|;
name|QObject
operator|::
name|connect
argument_list|(
name|result
argument_list|,
operator|&
name|QWindowsNativeFileDialogBase
operator|::
name|filterSelected
argument_list|,
name|this
argument_list|,
operator|&
name|QPlatformFileDialogHelper
operator|::
name|filterSelected
argument_list|)
expr_stmt|;
comment|// Apply settings.
specifier|const
name|QSharedPointer
argument_list|<
name|QFileDialogOptions
argument_list|>
modifier|&
name|opts
init|=
name|options
argument_list|()
decl_stmt|;
name|m_data
operator|.
name|fromOptions
argument_list|(
name|opts
argument_list|)
expr_stmt|;
specifier|const
name|QFileDialogOptions
operator|::
name|FileMode
name|mode
init|=
name|opts
operator|->
name|fileMode
argument_list|()
decl_stmt|;
name|result
operator|->
name|setWindowTitle
argument_list|(
name|opts
operator|->
name|windowTitle
argument_list|()
argument_list|)
expr_stmt|;
name|result
operator|->
name|setMode
argument_list|(
name|mode
argument_list|,
name|opts
operator|->
name|acceptMode
argument_list|()
argument_list|,
name|opts
operator|->
name|options
argument_list|()
argument_list|)
expr_stmt|;
name|result
operator|->
name|setHideFiltersDetails
argument_list|(
name|opts
operator|->
name|testOption
argument_list|(
name|QFileDialogOptions
operator|::
name|HideNameFilterDetails
argument_list|)
argument_list|)
expr_stmt|;
specifier|const
name|QStringList
name|nameFilters
init|=
name|opts
operator|->
name|nameFilters
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|nameFilters
operator|.
name|isEmpty
argument_list|()
condition|)
name|result
operator|->
name|setNameFilters
argument_list|(
name|nameFilters
argument_list|)
expr_stmt|;
if|if
condition|(
name|opts
operator|->
name|isLabelExplicitlySet
argument_list|(
name|QFileDialogOptions
operator|::
name|FileName
argument_list|)
condition|)
name|result
operator|->
name|setLabelText
argument_list|(
name|QFileDialogOptions
operator|::
name|FileName
argument_list|,
name|opts
operator|->
name|labelText
argument_list|(
name|QFileDialogOptions
operator|::
name|FileName
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|opts
operator|->
name|isLabelExplicitlySet
argument_list|(
name|QFileDialogOptions
operator|::
name|Accept
argument_list|)
condition|)
name|result
operator|->
name|setLabelText
argument_list|(
name|QFileDialogOptions
operator|::
name|Accept
argument_list|,
name|opts
operator|->
name|labelText
argument_list|(
name|QFileDialogOptions
operator|::
name|Accept
argument_list|)
argument_list|)
expr_stmt|;
name|result
operator|->
name|updateDirectory
argument_list|()
expr_stmt|;
name|result
operator|->
name|updateSelectedNameFilter
argument_list|()
expr_stmt|;
specifier|const
name|QList
argument_list|<
name|QUrl
argument_list|>
name|initialSelection
init|=
name|opts
operator|->
name|initiallySelectedFiles
argument_list|()
decl_stmt|;
if|if
condition|(
name|initialSelection
operator|.
name|size
argument_list|()
operator|>
literal|0
condition|)
block|{
specifier|const
name|QUrl
name|url
init|=
name|initialSelection
operator|.
name|front
argument_list|()
decl_stmt|;
if|if
condition|(
name|url
operator|.
name|isLocalFile
argument_list|()
condition|)
block|{
name|QFileInfo
name|info
argument_list|(
name|url
operator|.
name|toLocalFile
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|info
operator|.
name|isDir
argument_list|()
condition|)
name|result
operator|->
name|selectFile
argument_list|(
name|info
operator|.
name|fileName
argument_list|()
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|result
operator|->
name|selectFile
argument_list|(
name|url
operator|.
name|path
argument_list|()
argument_list|)
expr_stmt|;
comment|// TODO url.fileName() once it exists
block|}
block|}
comment|// No need to select initialNameFilter if mode is Dir
if|if
condition|(
name|mode
operator|!=
name|QFileDialogOptions
operator|::
name|Directory
operator|&&
name|mode
operator|!=
name|QFileDialogOptions
operator|::
name|DirectoryOnly
condition|)
block|{
specifier|const
name|QString
name|initialNameFilter
init|=
name|opts
operator|->
name|initiallySelectedNameFilter
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|initialNameFilter
operator|.
name|isEmpty
argument_list|()
condition|)
name|result
operator|->
name|selectNameFilter
argument_list|(
name|initialNameFilter
argument_list|)
expr_stmt|;
block|}
specifier|const
name|QString
name|defaultSuffix
init|=
name|opts
operator|->
name|defaultSuffix
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|defaultSuffix
operator|.
name|isEmpty
argument_list|()
condition|)
name|result
operator|->
name|setDefaultSuffix
argument_list|(
name|defaultSuffix
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
end_function
begin_function
DECL|function|setDirectory
name|void
name|QWindowsFileDialogHelper
operator|::
name|setDirectory
parameter_list|(
specifier|const
name|QUrl
modifier|&
name|directory
parameter_list|)
block|{
name|qCDebug
argument_list|(
name|lcQpaDialogs
argument_list|)
operator|<<
name|__FUNCTION__
operator|<<
name|directory
operator|.
name|toString
argument_list|()
expr_stmt|;
name|m_data
operator|.
name|setDirectory
argument_list|(
name|directory
argument_list|)
expr_stmt|;
if|if
condition|(
name|hasNativeDialog
argument_list|()
condition|)
name|nativeFileDialog
argument_list|()
operator|->
name|updateDirectory
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|directory
name|QUrl
name|QWindowsFileDialogHelper
operator|::
name|directory
parameter_list|()
specifier|const
block|{
return|return
name|m_data
operator|.
name|directory
argument_list|()
return|;
block|}
end_function
begin_function
DECL|function|selectFile
name|void
name|QWindowsFileDialogHelper
operator|::
name|selectFile
parameter_list|(
specifier|const
name|QUrl
modifier|&
name|fileName
parameter_list|)
block|{
name|qCDebug
argument_list|(
name|lcQpaDialogs
argument_list|)
operator|<<
name|__FUNCTION__
operator|<<
name|fileName
operator|.
name|toString
argument_list|()
expr_stmt|;
if|if
condition|(
name|hasNativeDialog
argument_list|()
condition|)
comment|// Might be invoked from the QFileDialog constructor.
name|nativeFileDialog
argument_list|()
operator|->
name|selectFile
argument_list|(
name|fileName
operator|.
name|toLocalFile
argument_list|()
argument_list|)
expr_stmt|;
comment|// ## should use QUrl::fileName() once it exists
block|}
end_function
begin_function
DECL|function|selectedFiles
name|QList
argument_list|<
name|QUrl
argument_list|>
name|QWindowsFileDialogHelper
operator|::
name|selectedFiles
parameter_list|()
specifier|const
block|{
return|return
name|m_data
operator|.
name|selectedFiles
argument_list|()
return|;
block|}
end_function
begin_function
DECL|function|setFilter
name|void
name|QWindowsFileDialogHelper
operator|::
name|setFilter
parameter_list|()
block|{
name|qCDebug
argument_list|(
name|lcQpaDialogs
argument_list|)
operator|<<
name|__FUNCTION__
expr_stmt|;
block|}
end_function
begin_function
DECL|function|selectNameFilter
name|void
name|QWindowsFileDialogHelper
operator|::
name|selectNameFilter
parameter_list|(
specifier|const
name|QString
modifier|&
name|filter
parameter_list|)
block|{
name|m_data
operator|.
name|setSelectedNameFilter
argument_list|(
name|filter
argument_list|)
expr_stmt|;
if|if
condition|(
name|hasNativeDialog
argument_list|()
condition|)
name|nativeFileDialog
argument_list|()
operator|->
name|updateSelectedNameFilter
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|selectedNameFilter
name|QString
name|QWindowsFileDialogHelper
operator|::
name|selectedNameFilter
parameter_list|()
specifier|const
block|{
return|return
name|m_data
operator|.
name|selectedNameFilter
argument_list|()
return|;
block|}
end_function
begin_ifndef
ifndef|#
directive|ifndef
name|Q_OS_WINCE
end_ifndef
begin_comment
comment|/*!     \class QWindowsXpNativeFileDialog     \brief Native Windows directory dialog for Windows XP using SHlib-functions.      Uses the synchronous GetOpenFileNameW(), GetSaveFileNameW() from ComDlg32     or SHBrowseForFolder() for directories.      \internal     \sa QWindowsXpFileDialogHelper      \ingroup qt-lighthouse-win */
end_comment
begin_class
DECL|class|QWindowsXpNativeFileDialog
class|class
name|QWindowsXpNativeFileDialog
super|:
specifier|public
name|QWindowsNativeDialogBase
block|{
name|Q_OBJECT
public|public:
DECL|typedef|OptionsPtr
typedef|typedef
name|QSharedPointer
argument_list|<
name|QFileDialogOptions
argument_list|>
name|OptionsPtr
typedef|;
specifier|static
name|QWindowsXpNativeFileDialog
modifier|*
name|create
parameter_list|(
specifier|const
name|OptionsPtr
modifier|&
name|options
parameter_list|,
specifier|const
name|QWindowsFileDialogSharedData
modifier|&
name|data
parameter_list|)
function_decl|;
DECL|function|setWindowTitle
specifier|virtual
name|void
name|setWindowTitle
parameter_list|(
specifier|const
name|QString
modifier|&
name|t
parameter_list|)
block|{
name|m_title
operator|=
name|t
expr_stmt|;
block|}
specifier|virtual
name|void
name|doExec
parameter_list|(
name|HWND
name|owner
init|=
literal|0
parameter_list|)
function_decl|;
DECL|function|result
specifier|virtual
name|QPlatformDialogHelper
operator|::
name|DialogCode
name|result
parameter_list|()
specifier|const
block|{
return|return
name|m_result
return|;
block|}
name|int
name|existingDirCallback
parameter_list|(
name|HWND
name|hwnd
parameter_list|,
name|UINT
name|uMsg
parameter_list|,
name|LPARAM
name|lParam
parameter_list|)
function_decl|;
public|public
name|slots
public|:
DECL|function|close
specifier|virtual
name|void
name|close
parameter_list|()
block|{}
private|private:
DECL|typedef|PtrGetOpenFileNameW
typedef|typedef
name|BOOL
function_decl|(
name|APIENTRY
modifier|*
name|PtrGetOpenFileNameW
function_decl|)
parameter_list|(
name|LPOPENFILENAMEW
parameter_list|)
function_decl|;
DECL|typedef|PtrGetSaveFileNameW
typedef|typedef
name|BOOL
function_decl|(
name|APIENTRY
modifier|*
name|PtrGetSaveFileNameW
function_decl|)
parameter_list|(
name|LPOPENFILENAMEW
parameter_list|)
function_decl|;
specifier|explicit
name|QWindowsXpNativeFileDialog
parameter_list|(
specifier|const
name|OptionsPtr
modifier|&
name|options
parameter_list|,
specifier|const
name|QWindowsFileDialogSharedData
modifier|&
name|data
parameter_list|)
constructor_decl|;
name|void
name|populateOpenFileName
parameter_list|(
name|OPENFILENAME
modifier|*
name|ofn
parameter_list|,
name|HWND
name|owner
parameter_list|)
specifier|const
function_decl|;
name|QList
argument_list|<
name|QUrl
argument_list|>
name|execExistingDir
parameter_list|(
name|HWND
name|owner
parameter_list|)
function_decl|;
name|QList
argument_list|<
name|QUrl
argument_list|>
name|execFileNames
parameter_list|(
name|HWND
name|owner
parameter_list|,
name|int
modifier|*
name|selectedFilterIndex
parameter_list|)
specifier|const
function_decl|;
DECL|member|m_options
specifier|const
name|OptionsPtr
name|m_options
decl_stmt|;
DECL|member|m_title
name|QString
name|m_title
decl_stmt|;
DECL|member|m_result
name|QPlatformDialogHelper
operator|::
name|DialogCode
name|m_result
decl_stmt|;
DECL|member|m_data
name|QWindowsFileDialogSharedData
name|m_data
decl_stmt|;
DECL|member|m_getOpenFileNameW
specifier|static
name|PtrGetOpenFileNameW
name|m_getOpenFileNameW
decl_stmt|;
DECL|member|m_getSaveFileNameW
specifier|static
name|PtrGetSaveFileNameW
name|m_getSaveFileNameW
decl_stmt|;
block|}
class|;
end_class
begin_decl_stmt
DECL|member|m_getOpenFileNameW
name|QWindowsXpNativeFileDialog
operator|::
name|PtrGetOpenFileNameW
name|QWindowsXpNativeFileDialog
operator|::
name|m_getOpenFileNameW
init|=
literal|0
decl_stmt|;
end_decl_stmt
begin_decl_stmt
DECL|member|m_getSaveFileNameW
name|QWindowsXpNativeFileDialog
operator|::
name|PtrGetSaveFileNameW
name|QWindowsXpNativeFileDialog
operator|::
name|m_getSaveFileNameW
init|=
literal|0
decl_stmt|;
end_decl_stmt
begin_function
DECL|function|create
name|QWindowsXpNativeFileDialog
modifier|*
name|QWindowsXpNativeFileDialog
operator|::
name|create
parameter_list|(
specifier|const
name|OptionsPtr
modifier|&
name|options
parameter_list|,
specifier|const
name|QWindowsFileDialogSharedData
modifier|&
name|data
parameter_list|)
block|{
comment|// GetOpenFileNameW() GetSaveFileName() are resolved
comment|// dynamically as not to create a dependency on Comdlg32, which
comment|// is used on XP only.
if|if
condition|(
operator|!
name|m_getOpenFileNameW
condition|)
block|{
name|QSystemLibrary
name|library
argument_list|(
name|QStringLiteral
argument_list|(
literal|"Comdlg32"
argument_list|)
argument_list|)
decl_stmt|;
name|m_getOpenFileNameW
operator|=
call|(
name|PtrGetOpenFileNameW
call|)
argument_list|(
name|library
operator|.
name|resolve
argument_list|(
literal|"GetOpenFileNameW"
argument_list|)
argument_list|)
expr_stmt|;
name|m_getSaveFileNameW
operator|=
call|(
name|PtrGetSaveFileNameW
call|)
argument_list|(
name|library
operator|.
name|resolve
argument_list|(
literal|"GetSaveFileNameW"
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|m_getOpenFileNameW
operator|&&
name|m_getSaveFileNameW
condition|)
return|return
operator|new
name|QWindowsXpNativeFileDialog
argument_list|(
name|options
argument_list|,
name|data
argument_list|)
return|;
return|return
literal|0
return|;
block|}
end_function
begin_constructor
DECL|function|QWindowsXpNativeFileDialog
name|QWindowsXpNativeFileDialog
operator|::
name|QWindowsXpNativeFileDialog
parameter_list|(
specifier|const
name|OptionsPtr
modifier|&
name|options
parameter_list|,
specifier|const
name|QWindowsFileDialogSharedData
modifier|&
name|data
parameter_list|)
member_init_list|:
name|m_options
argument_list|(
name|options
argument_list|)
member_init_list|,
name|m_result
argument_list|(
name|QPlatformDialogHelper
operator|::
name|Rejected
argument_list|)
member_init_list|,
name|m_data
argument_list|(
name|data
argument_list|)
block|{
name|setWindowTitle
argument_list|(
name|m_options
operator|->
name|windowTitle
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_constructor
begin_function
DECL|function|doExec
name|void
name|QWindowsXpNativeFileDialog
operator|::
name|doExec
parameter_list|(
name|HWND
name|owner
parameter_list|)
block|{
name|int
name|selectedFilterIndex
init|=
operator|-
literal|1
decl_stmt|;
specifier|const
name|QList
argument_list|<
name|QUrl
argument_list|>
name|selectedFiles
init|=
name|m_options
operator|->
name|fileMode
argument_list|()
operator|==
name|QFileDialogOptions
operator|::
name|DirectoryOnly
condition|?
name|execExistingDir
argument_list|(
name|owner
argument_list|)
else|:
name|execFileNames
argument_list|(
name|owner
argument_list|,
operator|&
name|selectedFilterIndex
argument_list|)
decl_stmt|;
name|m_data
operator|.
name|setSelectedFiles
argument_list|(
name|selectedFiles
argument_list|)
expr_stmt|;
name|QWindowsDialogs
operator|::
name|eatMouseMove
argument_list|()
expr_stmt|;
if|if
condition|(
name|selectedFiles
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|m_result
operator|=
name|QPlatformDialogHelper
operator|::
name|Rejected
expr_stmt|;
emit|emit
name|rejected
argument_list|()
emit|;
block|}
else|else
block|{
specifier|const
name|QStringList
name|nameFilters
init|=
name|m_options
operator|->
name|nameFilters
argument_list|()
decl_stmt|;
if|if
condition|(
name|selectedFilterIndex
operator|>=
literal|0
operator|&&
name|selectedFilterIndex
operator|<
name|nameFilters
operator|.
name|size
argument_list|()
condition|)
name|m_data
operator|.
name|setSelectedNameFilter
argument_list|(
name|nameFilters
operator|.
name|at
argument_list|(
name|selectedFilterIndex
argument_list|)
argument_list|)
expr_stmt|;
name|QUrl
name|firstFile
init|=
name|selectedFiles
operator|.
name|front
argument_list|()
decl_stmt|;
name|m_data
operator|.
name|setDirectory
argument_list|(
name|firstFile
operator|.
name|adjusted
argument_list|(
name|QUrl
operator|::
name|RemoveFilename
argument_list|)
argument_list|)
expr_stmt|;
name|m_result
operator|=
name|QPlatformDialogHelper
operator|::
name|Accepted
expr_stmt|;
emit|emit
name|accepted
argument_list|()
emit|;
block|}
block|}
end_function
begin_comment
comment|// Callback for QWindowsNativeXpFileDialog directory dialog.
end_comment
begin_comment
comment|// MFC Directory Dialog. Contrib: Steve Williams (minor parts from Scott Powers)
end_comment
begin_function
DECL|function|xpFileDialogGetExistingDirCallbackProc
specifier|static
name|int
name|QT_WIN_CALLBACK
name|xpFileDialogGetExistingDirCallbackProc
parameter_list|(
name|HWND
name|hwnd
parameter_list|,
name|UINT
name|uMsg
parameter_list|,
name|LPARAM
name|lParam
parameter_list|,
name|LPARAM
name|lpData
parameter_list|)
block|{
name|QWindowsXpNativeFileDialog
modifier|*
name|dialog
init|=
cast|reinterpret_cast
argument_list|<
name|QWindowsXpNativeFileDialog
operator|*
argument_list|>
argument_list|(
name|lpData
argument_list|)
decl_stmt|;
return|return
name|dialog
operator|->
name|existingDirCallback
argument_list|(
name|hwnd
argument_list|,
name|uMsg
argument_list|,
name|lParam
argument_list|)
return|;
block|}
end_function
begin_comment
comment|/* The correct declaration of the SHGetPathFromIDList symbol is  * being used in mingw-w64 as of r6215, which is a v3 snapshot.  */
end_comment
begin_if
if|#
directive|if
name|defined
argument_list|(
name|Q_CC_MINGW
argument_list|)
operator|&&
operator|(
operator|!
name|defined
argument_list|(
name|__MINGW64_VERSION_MAJOR
argument_list|)
operator|||
name|__MINGW64_VERSION_MAJOR
operator|<
literal|3
operator|)
end_if
begin_typedef
DECL|typedef|qt_LpItemIdList
typedef|typedef
name|ITEMIDLIST
modifier|*
name|qt_LpItemIdList
typedef|;
end_typedef
begin_else
else|#
directive|else
end_else
begin_typedef
DECL|typedef|qt_LpItemIdList
typedef|typedef
name|PIDLIST_ABSOLUTE
name|qt_LpItemIdList
typedef|;
end_typedef
begin_endif
endif|#
directive|endif
end_endif
begin_function
DECL|function|existingDirCallback
name|int
name|QWindowsXpNativeFileDialog
operator|::
name|existingDirCallback
parameter_list|(
name|HWND
name|hwnd
parameter_list|,
name|UINT
name|uMsg
parameter_list|,
name|LPARAM
name|lParam
parameter_list|)
block|{
switch|switch
condition|(
name|uMsg
condition|)
block|{
case|case
name|BFFM_INITIALIZED
case|:
block|{
if|if
condition|(
operator|!
name|m_title
operator|.
name|isEmpty
argument_list|()
condition|)
name|SetWindowText
argument_list|(
name|hwnd
argument_list|,
operator|(
name|wchar_t
operator|*
operator|)
name|m_title
operator|.
name|utf16
argument_list|()
argument_list|)
expr_stmt|;
specifier|const
name|QString
name|initialFile
init|=
name|QDir
operator|::
name|toNativeSeparators
argument_list|(
name|m_data
operator|.
name|directory
argument_list|()
operator|.
name|toLocalFile
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|initialFile
operator|.
name|isEmpty
argument_list|()
condition|)
name|SendMessage
argument_list|(
name|hwnd
argument_list|,
name|BFFM_SETSELECTION
argument_list|,
name|TRUE
argument_list|,
name|LPARAM
argument_list|(
name|initialFile
operator|.
name|utf16
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
break|break;
case|case
name|BFFM_SELCHANGED
case|:
block|{
name|wchar_t
name|path
index|[
name|MAX_PATH
index|]
decl_stmt|;
specifier|const
name|bool
name|ok
init|=
name|SHGetPathFromIDList
argument_list|(
cast|reinterpret_cast
argument_list|<
name|qt_LpItemIdList
argument_list|>
argument_list|(
name|lParam
argument_list|)
argument_list|,
name|path
argument_list|)
operator|&&
name|path
index|[
literal|0
index|]
decl_stmt|;
name|SendMessage
argument_list|(
name|hwnd
argument_list|,
name|BFFM_ENABLEOK
argument_list|,
name|ok
condition|?
literal|1
else|:
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
block|}
break|break;
block|}
return|return
literal|0
return|;
block|}
end_function
begin_function
DECL|function|execExistingDir
name|QList
argument_list|<
name|QUrl
argument_list|>
name|QWindowsXpNativeFileDialog
operator|::
name|execExistingDir
parameter_list|(
name|HWND
name|owner
parameter_list|)
block|{
name|BROWSEINFO
name|bi
decl_stmt|;
name|wchar_t
name|initPath
index|[
name|MAX_PATH
index|]
decl_stmt|;
name|initPath
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
name|bi
operator|.
name|hwndOwner
operator|=
name|owner
expr_stmt|;
name|bi
operator|.
name|pidlRoot
operator|=
name|NULL
expr_stmt|;
name|bi
operator|.
name|lpszTitle
operator|=
literal|0
expr_stmt|;
name|bi
operator|.
name|pszDisplayName
operator|=
name|initPath
expr_stmt|;
name|bi
operator|.
name|ulFlags
operator|=
name|BIF_RETURNONLYFSDIRS
operator||
name|BIF_STATUSTEXT
operator||
name|BIF_NEWDIALOGSTYLE
expr_stmt|;
name|bi
operator|.
name|lpfn
operator|=
name|xpFileDialogGetExistingDirCallbackProc
expr_stmt|;
name|bi
operator|.
name|lParam
operator|=
name|LPARAM
argument_list|(
name|this
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QUrl
argument_list|>
name|selectedFiles
decl_stmt|;
if|if
condition|(
name|qt_LpItemIdList
name|pItemIDList
init|=
name|SHBrowseForFolder
argument_list|(
operator|&
name|bi
argument_list|)
condition|)
block|{
name|wchar_t
name|path
index|[
name|MAX_PATH
index|]
decl_stmt|;
name|path
index|[
literal|0
index|]
operator|=
literal|0
expr_stmt|;
if|if
condition|(
name|SHGetPathFromIDList
argument_list|(
name|pItemIDList
argument_list|,
name|path
argument_list|)
operator|&&
name|path
index|[
literal|0
index|]
condition|)
name|selectedFiles
operator|.
name|push_back
argument_list|(
name|QUrl
operator|::
name|fromLocalFile
argument_list|(
name|QDir
operator|::
name|cleanPath
argument_list|(
name|QString
operator|::
name|fromWCharArray
argument_list|(
name|path
argument_list|)
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|IMalloc
modifier|*
name|pMalloc
decl_stmt|;
if|if
condition|(
name|SHGetMalloc
argument_list|(
operator|&
name|pMalloc
argument_list|)
operator|==
name|NOERROR
condition|)
block|{
name|pMalloc
operator|->
name|Free
argument_list|(
name|pItemIDList
argument_list|)
expr_stmt|;
name|pMalloc
operator|->
name|Release
argument_list|()
expr_stmt|;
block|}
block|}
return|return
name|selectedFiles
return|;
block|}
end_function
begin_comment
comment|// Open/Save files
end_comment
begin_function
DECL|function|populateOpenFileName
name|void
name|QWindowsXpNativeFileDialog
operator|::
name|populateOpenFileName
parameter_list|(
name|OPENFILENAME
modifier|*
name|ofn
parameter_list|,
name|HWND
name|owner
parameter_list|)
specifier|const
block|{
name|ZeroMemory
argument_list|(
name|ofn
argument_list|,
sizeof|sizeof
argument_list|(
name|OPENFILENAME
argument_list|)
argument_list|)
expr_stmt|;
name|ofn
operator|->
name|lStructSize
operator|=
sizeof|sizeof
argument_list|(
name|OPENFILENAME
argument_list|)
expr_stmt|;
name|ofn
operator|->
name|hwndOwner
operator|=
name|owner
expr_stmt|;
comment|// Create a buffer with the filter strings.
name|int
name|totalStringLength
init|=
literal|0
decl_stmt|;
name|QList
argument_list|<
name|FilterSpec
argument_list|>
name|specs
init|=
name|filterSpecs
argument_list|(
name|m_options
operator|->
name|nameFilters
argument_list|()
argument_list|,
name|m_options
operator|->
name|options
argument_list|()
operator|&
name|QFileDialogOptions
operator|::
name|HideNameFilterDetails
argument_list|,
operator|&
name|totalStringLength
argument_list|)
decl_stmt|;
specifier|const
name|int
name|size
init|=
name|specs
operator|.
name|size
argument_list|()
decl_stmt|;
name|wchar_t
modifier|*
name|ptr
init|=
operator|new
name|wchar_t
index|[
name|totalStringLength
operator|+
literal|2
operator|*
name|size
operator|+
literal|1
index|]
decl_stmt|;
name|ofn
operator|->
name|lpstrFilter
operator|=
name|ptr
expr_stmt|;
foreach|foreach
control|(
specifier|const
name|FilterSpec
modifier|&
name|spec
decl|,
name|specs
control|)
block|{
name|ptr
operator|+=
name|spec
operator|.
name|description
operator|.
name|toWCharArray
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
operator|*
name|ptr
operator|++
operator|=
literal|0
expr_stmt|;
name|ptr
operator|+=
name|spec
operator|.
name|filter
operator|.
name|toWCharArray
argument_list|(
name|ptr
argument_list|)
expr_stmt|;
operator|*
name|ptr
operator|++
operator|=
literal|0
expr_stmt|;
block|}
operator|*
name|ptr
operator|=
literal|0
expr_stmt|;
specifier|const
name|int
name|nameFilterIndex
init|=
name|indexOfNameFilter
argument_list|(
name|m_options
operator|->
name|nameFilters
argument_list|()
argument_list|,
name|m_data
operator|.
name|selectedNameFilter
argument_list|()
argument_list|)
decl_stmt|;
if|if
condition|(
name|nameFilterIndex
operator|>=
literal|0
condition|)
name|ofn
operator|->
name|nFilterIndex
operator|=
name|nameFilterIndex
operator|+
literal|1
expr_stmt|;
comment|// 1..n based.
comment|// lpstrFile receives the initial selection and is the buffer
comment|// for the target. If it contains any invalid character, the dialog
comment|// will not show.
name|ofn
operator|->
name|nMaxFile
operator|=
literal|65535
expr_stmt|;
specifier|const
name|QString
name|initiallySelectedFile
init|=
name|QDir
operator|::
name|toNativeSeparators
argument_list|(
name|m_data
operator|.
name|selectedFile
argument_list|()
argument_list|)
operator|.
name|remove
argument_list|(
name|QLatin1Char
argument_list|(
literal|'<'
argument_list|)
argument_list|)
operator|.
name|remove
argument_list|(
name|QLatin1Char
argument_list|(
literal|'>'
argument_list|)
argument_list|)
operator|.
name|remove
argument_list|(
name|QLatin1Char
argument_list|(
literal|'"'
argument_list|)
argument_list|)
operator|.
name|remove
argument_list|(
name|QLatin1Char
argument_list|(
literal|'|'
argument_list|)
argument_list|)
decl_stmt|;
name|ofn
operator|->
name|lpstrFile
operator|=
name|qStringToWCharArray
argument_list|(
name|initiallySelectedFile
argument_list|,
name|ofn
operator|->
name|nMaxFile
argument_list|)
expr_stmt|;
name|ofn
operator|->
name|lpstrInitialDir
operator|=
name|qStringToWCharArray
argument_list|(
name|QDir
operator|::
name|toNativeSeparators
argument_list|(
name|m_data
operator|.
name|directory
argument_list|()
operator|.
name|toLocalFile
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|ofn
operator|->
name|lpstrTitle
operator|=
operator|(
name|wchar_t
operator|*
operator|)
name|m_title
operator|.
name|utf16
argument_list|()
expr_stmt|;
comment|// Determine lpstrDefExt. Note that the current MSDN docs document this
comment|// member wrong. It should rather be documented as "the default extension
comment|// if no extension was given and if the current filter does not have an
comment|// extension (e.g (*)). If the current filter has an extension, use
comment|// the extension of the current filter".
if|if
condition|(
name|m_options
operator|->
name|acceptMode
argument_list|()
operator|==
name|QFileDialogOptions
operator|::
name|AcceptSave
condition|)
block|{
name|QString
name|defaultSuffix
init|=
name|m_options
operator|->
name|defaultSuffix
argument_list|()
decl_stmt|;
if|if
condition|(
name|defaultSuffix
operator|.
name|startsWith
argument_list|(
name|QLatin1Char
argument_list|(
literal|'.'
argument_list|)
argument_list|)
condition|)
name|defaultSuffix
operator|.
name|remove
argument_list|(
literal|0
argument_list|,
literal|1
argument_list|)
expr_stmt|;
comment|// QTBUG-33156, also create empty strings to trigger the appending mechanism.
name|ofn
operator|->
name|lpstrDefExt
operator|=
name|qStringToWCharArray
argument_list|(
name|defaultSuffix
argument_list|)
expr_stmt|;
block|}
comment|// Flags.
name|ofn
operator|->
name|Flags
operator|=
operator|(
name|OFN_NOCHANGEDIR
operator||
name|OFN_HIDEREADONLY
operator||
name|OFN_EXPLORER
operator||
name|OFN_PATHMUSTEXIST
operator|)
expr_stmt|;
if|if
condition|(
name|m_options
operator|->
name|fileMode
argument_list|()
operator|==
name|QFileDialogOptions
operator|::
name|ExistingFile
operator|||
name|m_options
operator|->
name|fileMode
argument_list|()
operator|==
name|QFileDialogOptions
operator|::
name|ExistingFiles
condition|)
name|ofn
operator|->
name|Flags
operator||=
operator|(
name|OFN_FILEMUSTEXIST
operator|)
expr_stmt|;
if|if
condition|(
name|m_options
operator|->
name|fileMode
argument_list|()
operator|==
name|QFileDialogOptions
operator|::
name|ExistingFiles
condition|)
name|ofn
operator|->
name|Flags
operator||=
operator|(
name|OFN_ALLOWMULTISELECT
operator|)
expr_stmt|;
if|if
condition|(
operator|!
operator|(
name|m_options
operator|->
name|options
argument_list|()
operator|&
name|QFileDialogOptions
operator|::
name|DontConfirmOverwrite
operator|)
condition|)
name|ofn
operator|->
name|Flags
operator||=
name|OFN_OVERWRITEPROMPT
expr_stmt|;
block|}
end_function
begin_function
DECL|function|execFileNames
name|QList
argument_list|<
name|QUrl
argument_list|>
name|QWindowsXpNativeFileDialog
operator|::
name|execFileNames
parameter_list|(
name|HWND
name|owner
parameter_list|,
name|int
modifier|*
name|selectedFilterIndex
parameter_list|)
specifier|const
block|{
operator|*
name|selectedFilterIndex
operator|=
operator|-
literal|1
expr_stmt|;
name|OPENFILENAME
name|ofn
decl_stmt|;
name|populateOpenFileName
argument_list|(
operator|&
name|ofn
argument_list|,
name|owner
argument_list|)
expr_stmt|;
name|QList
argument_list|<
name|QUrl
argument_list|>
name|result
decl_stmt|;
specifier|const
name|bool
name|isSave
init|=
name|m_options
operator|->
name|acceptMode
argument_list|()
operator|==
name|QFileDialogOptions
operator|::
name|AcceptSave
decl_stmt|;
if|if
condition|(
name|isSave
condition|?
name|m_getSaveFileNameW
argument_list|(
operator|&
name|ofn
argument_list|)
else|:
name|m_getOpenFileNameW
argument_list|(
operator|&
name|ofn
argument_list|)
condition|)
block|{
operator|*
name|selectedFilterIndex
operator|=
name|ofn
operator|.
name|nFilterIndex
operator|-
literal|1
expr_stmt|;
specifier|const
name|QString
name|dir
init|=
name|QDir
operator|::
name|cleanPath
argument_list|(
name|QString
operator|::
name|fromWCharArray
argument_list|(
name|ofn
operator|.
name|lpstrFile
argument_list|)
argument_list|)
decl_stmt|;
name|result
operator|.
name|push_back
argument_list|(
name|QUrl
operator|::
name|fromLocalFile
argument_list|(
name|dir
argument_list|)
argument_list|)
expr_stmt|;
comment|// For multiselection, the first item is the path followed
comment|// by "\0<file1>\0<file2>\0\0".
if|if
condition|(
name|ofn
operator|.
name|Flags
operator|&
operator|(
name|OFN_ALLOWMULTISELECT
operator|)
condition|)
block|{
name|wchar_t
modifier|*
name|ptr
init|=
name|ofn
operator|.
name|lpstrFile
operator|+
name|dir
operator|.
name|size
argument_list|()
operator|+
literal|1
decl_stmt|;
if|if
condition|(
operator|*
name|ptr
condition|)
block|{
name|result
operator|.
name|pop_front
argument_list|()
expr_stmt|;
specifier|const
name|QString
name|path
init|=
name|dir
operator|+
name|QLatin1Char
argument_list|(
literal|'/'
argument_list|)
decl_stmt|;
while|while
condition|(
operator|*
name|ptr
condition|)
block|{
specifier|const
name|QString
name|fileName
init|=
name|QString
operator|::
name|fromWCharArray
argument_list|(
name|ptr
argument_list|)
decl_stmt|;
name|result
operator|.
name|push_back
argument_list|(
name|QUrl
operator|::
name|fromLocalFile
argument_list|(
name|path
operator|+
name|fileName
argument_list|)
argument_list|)
expr_stmt|;
name|ptr
operator|+=
name|fileName
operator|.
name|size
argument_list|()
operator|+
literal|1
expr_stmt|;
block|}
comment|// extract multiple files
block|}
comment|// has multiple files
block|}
comment|// multiple flag set
block|}
operator|delete
index|[]
name|ofn
operator|.
name|lpstrFile
expr_stmt|;
operator|delete
index|[]
name|ofn
operator|.
name|lpstrInitialDir
expr_stmt|;
operator|delete
index|[]
name|ofn
operator|.
name|lpstrFilter
expr_stmt|;
operator|delete
index|[]
name|ofn
operator|.
name|lpstrDefExt
expr_stmt|;
return|return
name|result
return|;
block|}
end_function
begin_comment
comment|/*!     \class QWindowsXpFileDialogHelper     \brief Dialog helper using QWindowsXpNativeFileDialog      \sa QWindowsXpNativeFileDialog     \internal     \ingroup qt-lighthouse-win */
end_comment
begin_class
DECL|class|QWindowsXpFileDialogHelper
class|class
name|QWindowsXpFileDialogHelper
super|:
specifier|public
name|QWindowsDialogHelperBase
argument_list|<
name|QPlatformFileDialogHelper
argument_list|>
block|{
public|public:
DECL|function|QWindowsXpFileDialogHelper
name|QWindowsXpFileDialogHelper
parameter_list|()
block|{}
DECL|function|supportsNonModalDialog
specifier|virtual
name|bool
name|supportsNonModalDialog
parameter_list|(
specifier|const
name|QWindow
modifier|*
comment|/* parent */
init|=
literal|0
parameter_list|)
specifier|const
block|{
return|return
literal|false
return|;
block|}
DECL|function|defaultNameFilterDisables
specifier|virtual
name|bool
name|defaultNameFilterDisables
parameter_list|()
specifier|const
block|{
return|return
literal|true
return|;
block|}
DECL|member|Q_DECL_OVERRIDE
specifier|virtual
name|void
name|setDirectory
parameter_list|(
specifier|const
name|QUrl
modifier|&
name|directory
parameter_list|)
name|Q_DECL_OVERRIDE
function_decl|;
DECL|member|Q_DECL_OVERRIDE
specifier|virtual
name|QUrl
name|directory
parameter_list|()
specifier|const
name|Q_DECL_OVERRIDE
function_decl|;
DECL|member|Q_DECL_OVERRIDE
specifier|virtual
name|void
name|selectFile
parameter_list|(
specifier|const
name|QUrl
modifier|&
name|url
parameter_list|)
name|Q_DECL_OVERRIDE
function_decl|;
DECL|member|Q_DECL_OVERRIDE
specifier|virtual
name|QList
argument_list|<
name|QUrl
argument_list|>
name|selectedFiles
parameter_list|()
specifier|const
name|Q_DECL_OVERRIDE
function_decl|;
specifier|virtual
name|void
name|setFilter
parameter_list|()
name|Q_DECL_OVERRIDE
block|{}
DECL|member|Q_DECL_OVERRIDE
specifier|virtual
name|void
name|selectNameFilter
parameter_list|(
specifier|const
name|QString
modifier|&
parameter_list|)
name|Q_DECL_OVERRIDE
function_decl|;
DECL|member|Q_DECL_OVERRIDE
specifier|virtual
name|QString
name|selectedNameFilter
parameter_list|()
specifier|const
name|Q_DECL_OVERRIDE
function_decl|;
private|private:
specifier|virtual
name|QWindowsNativeDialogBase
modifier|*
name|createNativeDialog
parameter_list|()
function_decl|;
DECL|function|nativeFileDialog
specifier|inline
name|QWindowsXpNativeFileDialog
modifier|*
name|nativeFileDialog
parameter_list|()
specifier|const
block|{
return|return
cast|static_cast
argument_list|<
name|QWindowsXpNativeFileDialog
operator|*
argument_list|>
argument_list|(
name|nativeDialog
argument_list|()
argument_list|)
return|;
block|}
DECL|member|m_data
name|QWindowsFileDialogSharedData
name|m_data
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|createNativeDialog
name|QWindowsNativeDialogBase
modifier|*
name|QWindowsXpFileDialogHelper
operator|::
name|createNativeDialog
parameter_list|()
block|{
name|m_data
operator|.
name|fromOptions
argument_list|(
name|options
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|QWindowsXpNativeFileDialog
modifier|*
name|result
init|=
name|QWindowsXpNativeFileDialog
operator|::
name|create
argument_list|(
name|options
argument_list|()
argument_list|,
name|m_data
argument_list|)
condition|)
block|{
name|QObject
operator|::
name|connect
argument_list|(
name|result
argument_list|,
operator|&
name|QWindowsNativeDialogBase
operator|::
name|accepted
argument_list|,
name|this
argument_list|,
operator|&
name|QPlatformDialogHelper
operator|::
name|accept
argument_list|)
expr_stmt|;
name|QObject
operator|::
name|connect
argument_list|(
name|result
argument_list|,
operator|&
name|QWindowsNativeDialogBase
operator|::
name|rejected
argument_list|,
name|this
argument_list|,
operator|&
name|QPlatformDialogHelper
operator|::
name|reject
argument_list|)
expr_stmt|;
return|return
name|result
return|;
block|}
return|return
literal|0
return|;
block|}
end_function
begin_function
DECL|function|setDirectory
name|void
name|QWindowsXpFileDialogHelper
operator|::
name|setDirectory
parameter_list|(
specifier|const
name|QUrl
modifier|&
name|directory
parameter_list|)
block|{
name|m_data
operator|.
name|setDirectory
argument_list|(
name|directory
argument_list|)
expr_stmt|;
comment|// Dialog cannot be updated at run-time.
block|}
end_function
begin_function
DECL|function|directory
name|QUrl
name|QWindowsXpFileDialogHelper
operator|::
name|directory
parameter_list|()
specifier|const
block|{
return|return
name|m_data
operator|.
name|directory
argument_list|()
return|;
block|}
end_function
begin_function
DECL|function|selectFile
name|void
name|QWindowsXpFileDialogHelper
operator|::
name|selectFile
parameter_list|(
specifier|const
name|QUrl
modifier|&
name|url
parameter_list|)
block|{
name|m_data
operator|.
name|setSelectedFiles
argument_list|(
name|QList
argument_list|<
name|QUrl
argument_list|>
argument_list|()
operator|<<
name|url
argument_list|)
expr_stmt|;
comment|// Dialog cannot be updated at run-time.
block|}
end_function
begin_function
DECL|function|selectedFiles
name|QList
argument_list|<
name|QUrl
argument_list|>
name|QWindowsXpFileDialogHelper
operator|::
name|selectedFiles
parameter_list|()
specifier|const
block|{
return|return
name|m_data
operator|.
name|selectedFiles
argument_list|()
return|;
block|}
end_function
begin_function
DECL|function|selectNameFilter
name|void
name|QWindowsXpFileDialogHelper
operator|::
name|selectNameFilter
parameter_list|(
specifier|const
name|QString
modifier|&
name|f
parameter_list|)
block|{
name|m_data
operator|.
name|setSelectedNameFilter
argument_list|(
name|f
argument_list|)
expr_stmt|;
comment|// Dialog cannot be updated at run-time.
block|}
end_function
begin_function
DECL|function|selectedNameFilter
name|QString
name|QWindowsXpFileDialogHelper
operator|::
name|selectedNameFilter
parameter_list|()
specifier|const
block|{
return|return
name|m_data
operator|.
name|selectedNameFilter
argument_list|()
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|// Q_OS_WINCE
end_comment
begin_comment
comment|/*!     \class QWindowsNativeColorDialog     \brief Native Windows color dialog.      Wrapper around Comdlg32's ChooseColor() function.     Not currently in use as QColorDialog is equivalent.      \sa QWindowsColorDialogHelper     \sa #define USE_NATIVE_COLOR_DIALOG     \internal     \ingroup qt-lighthouse-win */
end_comment
begin_typedef
DECL|typedef|SharedPointerColor
typedef|typedef
name|QSharedPointer
argument_list|<
name|QColor
argument_list|>
name|SharedPointerColor
typedef|;
end_typedef
begin_ifdef
ifdef|#
directive|ifdef
name|USE_NATIVE_COLOR_DIALOG
end_ifdef
begin_class
DECL|class|QWindowsNativeColorDialog
class|class
name|QWindowsNativeColorDialog
super|:
specifier|public
name|QWindowsNativeDialogBase
block|{
name|Q_OBJECT
public|public:
DECL|enumerator|CustomColorCount
enum|enum
block|{
name|CustomColorCount
init|=
literal|16
block|}
enum|;
specifier|explicit
name|QWindowsNativeColorDialog
parameter_list|(
specifier|const
name|SharedPointerColor
modifier|&
name|color
parameter_list|)
constructor_decl|;
DECL|function|setWindowTitle
specifier|virtual
name|void
name|setWindowTitle
parameter_list|(
specifier|const
name|QString
modifier|&
parameter_list|)
block|{}
DECL|function|result
specifier|virtual
name|QPlatformDialogHelper
operator|::
name|DialogCode
name|result
parameter_list|()
specifier|const
block|{
return|return
name|m_code
return|;
block|}
public|public
name|slots
public|:
DECL|function|close
specifier|virtual
name|void
name|close
parameter_list|()
block|{}
private|private:
specifier|virtual
name|void
name|doExec
parameter_list|(
name|HWND
name|owner
init|=
literal|0
parameter_list|)
function_decl|;
DECL|member|m_customColors
name|COLORREF
name|m_customColors
index|[
name|CustomColorCount
index|]
decl_stmt|;
DECL|member|m_code
name|QPlatformDialogHelper
operator|::
name|DialogCode
name|m_code
decl_stmt|;
DECL|member|m_color
name|SharedPointerColor
name|m_color
decl_stmt|;
block|}
class|;
end_class
begin_constructor
DECL|function|QWindowsNativeColorDialog
name|QWindowsNativeColorDialog
operator|::
name|QWindowsNativeColorDialog
parameter_list|(
specifier|const
name|SharedPointerColor
modifier|&
name|color
parameter_list|)
member_init_list|:
name|m_code
argument_list|(
name|QPlatformDialogHelper
operator|::
name|Rejected
argument_list|)
member_init_list|,
name|m_color
argument_list|(
name|color
argument_list|)
block|{
name|std
operator|::
name|fill
argument_list|(
name|m_customColors
argument_list|,
name|m_customColors
operator|+
literal|16
argument_list|,
name|COLORREF
argument_list|(
literal|0
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_constructor
begin_function
DECL|function|doExec
name|void
name|QWindowsNativeColorDialog
operator|::
name|doExec
parameter_list|(
name|HWND
name|owner
parameter_list|)
block|{
typedef|typedef
name|BOOL
function_decl|(
name|WINAPI
modifier|*
name|ChooseColorWType
function_decl|)
parameter_list|(
name|LPCHOOSECOLORW
parameter_list|)
function_decl|;
name|CHOOSECOLOR
name|chooseColor
decl_stmt|;
name|ZeroMemory
argument_list|(
operator|&
name|chooseColor
argument_list|,
sizeof|sizeof
argument_list|(
name|chooseColor
argument_list|)
argument_list|)
expr_stmt|;
name|chooseColor
operator|.
name|lStructSize
operator|=
sizeof|sizeof
argument_list|(
name|chooseColor
argument_list|)
expr_stmt|;
name|chooseColor
operator|.
name|hwndOwner
operator|=
name|owner
expr_stmt|;
name|chooseColor
operator|.
name|lpCustColors
operator|=
name|m_customColors
expr_stmt|;
name|QRgb
modifier|*
name|qCustomColors
init|=
name|QColorDialogOptions
operator|::
name|customColors
argument_list|()
decl_stmt|;
specifier|const
name|int
name|customColorCount
init|=
name|qMin
argument_list|(
name|QColorDialogOptions
operator|::
name|customColorCount
argument_list|()
argument_list|,
name|int
argument_list|(
name|CustomColorCount
argument_list|)
argument_list|)
decl_stmt|;
for|for
control|(
name|int
name|c
init|=
literal|0
init|;
name|c
operator|<
name|customColorCount
condition|;
operator|++
name|c
control|)
name|m_customColors
index|[
name|c
index|]
operator|=
name|qColorToCOLORREF
argument_list|(
name|QColor
argument_list|(
name|qCustomColors
index|[
name|c
index|]
argument_list|)
argument_list|)
expr_stmt|;
name|chooseColor
operator|.
name|rgbResult
operator|=
name|qColorToCOLORREF
argument_list|(
operator|*
name|m_color
argument_list|)
expr_stmt|;
name|chooseColor
operator|.
name|Flags
operator|=
name|CC_FULLOPEN
operator||
name|CC_RGBINIT
expr_stmt|;
specifier|static
name|ChooseColorWType
name|chooseColorW
init|=
literal|0
decl_stmt|;
if|if
condition|(
operator|!
name|chooseColorW
condition|)
block|{
name|QSystemLibrary
name|library
argument_list|(
name|QStringLiteral
argument_list|(
literal|"Comdlg32"
argument_list|)
argument_list|)
decl_stmt|;
name|chooseColorW
operator|=
operator|(
name|ChooseColorWType
operator|)
name|library
operator|.
name|resolve
argument_list|(
literal|"ChooseColorW"
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|chooseColorW
condition|)
block|{
name|m_code
operator|=
name|chooseColorW
argument_list|(
operator|&
name|chooseColor
argument_list|)
condition|?
name|QPlatformDialogHelper
operator|::
name|Accepted
else|:
name|QPlatformDialogHelper
operator|::
name|Rejected
expr_stmt|;
name|QWindowsDialogs
operator|::
name|eatMouseMove
argument_list|()
expr_stmt|;
block|}
else|else
block|{
name|m_code
operator|=
name|QPlatformDialogHelper
operator|::
name|Rejected
expr_stmt|;
block|}
if|if
condition|(
name|m_code
operator|==
name|QPlatformDialogHelper
operator|::
name|Accepted
condition|)
block|{
operator|*
name|m_color
operator|=
name|COLORREFToQColor
argument_list|(
name|chooseColor
operator|.
name|rgbResult
argument_list|)
expr_stmt|;
for|for
control|(
name|int
name|c
init|=
literal|0
init|;
name|c
operator|<
name|customColorCount
condition|;
operator|++
name|c
control|)
name|qCustomColors
index|[
name|c
index|]
operator|=
name|COLORREFToQColor
argument_list|(
name|m_customColors
index|[
name|c
index|]
argument_list|)
operator|.
name|rgb
argument_list|()
expr_stmt|;
emit|emit
name|accepted
argument_list|()
emit|;
block|}
else|else
block|{
emit|emit
name|rejected
argument_list|()
emit|;
block|}
block|}
end_function
begin_comment
comment|/*!     \class QWindowsColorDialogHelper     \brief Helper for native Windows color dialogs      Not currently in use as QColorDialog is equivalent.      \sa #define USE_NATIVE_COLOR_DIALOG     \sa QWindowsNativeColorDialog     \internal     \ingroup qt-lighthouse-win */
end_comment
begin_class
DECL|class|QWindowsColorDialogHelper
class|class
name|QWindowsColorDialogHelper
super|:
specifier|public
name|QWindowsDialogHelperBase
argument_list|<
name|QPlatformColorDialogHelper
argument_list|>
block|{
public|public:
DECL|function|QWindowsColorDialogHelper
name|QWindowsColorDialogHelper
parameter_list|()
member_init_list|:
name|m_currentColor
argument_list|(
operator|new
name|QColor
argument_list|)
block|{}
DECL|function|supportsNonModalDialog
specifier|virtual
name|bool
name|supportsNonModalDialog
parameter_list|()
block|{
return|return
literal|false
return|;
block|}
DECL|function|currentColor
specifier|virtual
name|QColor
name|currentColor
parameter_list|()
specifier|const
block|{
return|return
operator|*
name|m_currentColor
return|;
block|}
DECL|function|setCurrentColor
specifier|virtual
name|void
name|setCurrentColor
parameter_list|(
specifier|const
name|QColor
modifier|&
name|c
parameter_list|)
block|{
operator|*
name|m_currentColor
operator|=
name|c
expr_stmt|;
block|}
private|private:
DECL|function|nativeFileDialog
specifier|inline
name|QWindowsNativeColorDialog
modifier|*
name|nativeFileDialog
parameter_list|()
specifier|const
block|{
return|return
cast|static_cast
argument_list|<
name|QWindowsNativeColorDialog
operator|*
argument_list|>
argument_list|(
name|nativeDialog
argument_list|()
argument_list|)
return|;
block|}
specifier|virtual
name|QWindowsNativeDialogBase
modifier|*
name|createNativeDialog
parameter_list|()
function_decl|;
DECL|member|m_currentColor
name|SharedPointerColor
name|m_currentColor
decl_stmt|;
block|}
class|;
end_class
begin_function
DECL|function|createNativeDialog
name|QWindowsNativeDialogBase
modifier|*
name|QWindowsColorDialogHelper
operator|::
name|createNativeDialog
parameter_list|()
block|{
name|QWindowsNativeColorDialog
modifier|*
name|nativeDialog
init|=
operator|new
name|QWindowsNativeColorDialog
argument_list|(
name|m_currentColor
argument_list|)
decl_stmt|;
name|nativeDialog
operator|->
name|setWindowTitle
argument_list|(
name|options
argument_list|()
operator|->
name|windowTitle
argument_list|()
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|nativeDialog
argument_list|,
operator|&
name|QWindowsNativeDialogBase
operator|::
name|accepted
argument_list|,
name|this
argument_list|,
operator|&
name|QPlatformDialogHelper
operator|::
name|accept
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|nativeDialog
argument_list|,
operator|&
name|QWindowsNativeDialogBase
operator|::
name|rejected
argument_list|,
name|this
argument_list|,
operator|&
name|QPlatformDialogHelper
operator|::
name|reject
argument_list|)
expr_stmt|;
return|return
name|nativeDialog
return|;
block|}
end_function
begin_endif
endif|#
directive|endif
end_endif
begin_comment
comment|// USE_NATIVE_COLOR_DIALOG
end_comment
begin_namespace
DECL|namespace|QWindowsDialogs
namespace|namespace
name|QWindowsDialogs
block|{
comment|// QWindowsDialogHelperBase creation functions
DECL|function|useHelper
name|bool
name|useHelper
parameter_list|(
name|QPlatformTheme
operator|::
name|DialogType
name|type
parameter_list|)
block|{
if|if
condition|(
name|QWindowsIntegration
operator|::
name|instance
argument_list|()
operator|->
name|options
argument_list|()
operator|&
name|QWindowsIntegration
operator|::
name|NoNativeDialogs
condition|)
return|return
literal|false
return|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|QPlatformTheme
operator|::
name|FileDialog
case|:
return|return
name|QSysInfo
operator|::
name|windowsVersion
argument_list|()
operator|>=
name|QSysInfo
operator|::
name|WV_XP
return|;
case|case
name|QPlatformTheme
operator|::
name|ColorDialog
case|:
ifdef|#
directive|ifdef
name|USE_NATIVE_COLOR_DIALOG
return|return
literal|true
return|;
else|#
directive|else
break|break;
endif|#
directive|endif
case|case
name|QPlatformTheme
operator|::
name|FontDialog
case|:
case|case
name|QPlatformTheme
operator|::
name|MessageDialog
case|:
break|break;
default|default:
break|break;
block|}
return|return
literal|false
return|;
block|}
DECL|function|createHelper
name|QPlatformDialogHelper
modifier|*
name|createHelper
parameter_list|(
name|QPlatformTheme
operator|::
name|DialogType
name|type
parameter_list|)
block|{
if|if
condition|(
name|QWindowsIntegration
operator|::
name|instance
argument_list|()
operator|->
name|options
argument_list|()
operator|&
name|QWindowsIntegration
operator|::
name|NoNativeDialogs
condition|)
return|return
literal|0
return|;
switch|switch
condition|(
name|type
condition|)
block|{
case|case
name|QPlatformTheme
operator|::
name|FileDialog
case|:
ifndef|#
directive|ifndef
name|Q_OS_WINCE
comment|// Note: "Windows XP Professional x64 Edition has version number WV_5_2 (WV_2003).
if|if
condition|(
name|QWindowsIntegration
operator|::
name|instance
argument_list|()
operator|->
name|options
argument_list|()
operator|&
name|QWindowsIntegration
operator|::
name|XpNativeDialogs
operator|||
name|QSysInfo
operator|::
name|windowsVersion
argument_list|()
operator|<=
name|QSysInfo
operator|::
name|WV_2003
condition|)
block|{
return|return
operator|new
name|QWindowsXpFileDialogHelper
argument_list|()
return|;
block|}
if|if
condition|(
name|QSysInfo
operator|::
name|windowsVersion
argument_list|()
operator|>
name|QSysInfo
operator|::
name|WV_2003
condition|)
return|return
operator|new
name|QWindowsFileDialogHelper
argument_list|()
return|;
else|#
directive|else
return|return
operator|new
name|QWindowsFileDialogHelper
argument_list|()
return|;
endif|#
directive|endif
comment|// Q_OS_WINCE
case|case
name|QPlatformTheme
operator|::
name|ColorDialog
case|:
ifdef|#
directive|ifdef
name|USE_NATIVE_COLOR_DIALOG
return|return
operator|new
name|QWindowsColorDialogHelper
argument_list|()
return|;
else|#
directive|else
break|break;
endif|#
directive|endif
case|case
name|QPlatformTheme
operator|::
name|FontDialog
case|:
case|case
name|QPlatformTheme
operator|::
name|MessageDialog
case|:
break|break;
default|default:
break|break;
block|}
return|return
literal|0
return|;
block|}
block|}
end_namespace
begin_comment
comment|// namespace QWindowsDialogs
end_comment
begin_macro
name|QT_END_NAMESPACE
end_macro
begin_include
include|#
directive|include
file|"qwindowsdialoghelpers.moc"
end_include
end_unit
