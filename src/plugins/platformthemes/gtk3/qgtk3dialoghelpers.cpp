begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2016 The Qt Company Ltd. ** Contact: https://www.qt.io/licensing/ ** ** This file is part of the plugins of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL$ ** Commercial License Usage ** Licensees holding valid commercial Qt licenses may use this file in ** accordance with the commercial license agreement provided with the ** Software or, alternatively, in accordance with the terms contained in ** a written agreement between you and The Qt Company. For licensing terms ** and conditions see https://www.qt.io/terms-conditions. For further ** information use the contact form at https://www.qt.io/contact-us. ** ** GNU Lesser General Public License Usage ** Alternatively, this file may be used under the terms of the GNU Lesser ** General Public License version 3 as published by the Free Software ** Foundation and appearing in the file LICENSE.LGPL3 included in the ** packaging of this file. Please review the following information to ** ensure the GNU Lesser General Public License version 3 requirements ** will be met: https://www.gnu.org/licenses/lgpl-3.0.html. ** ** GNU General Public License Usage ** Alternatively, this file may be used under the terms of the GNU ** General Public License version 2.0 or (at your option) the GNU General ** Public license version 3 or any later version approved by the KDE Free ** Qt Foundation. The licenses are as published by the Free Software ** Foundation and appearing in the file LICENSE.GPL2 and LICENSE.GPL3 ** included in the packaging of this file. Please review the following ** information to ensure the GNU General Public License requirements will ** be met: https://www.gnu.org/licenses/gpl-2.0.html and ** https://www.gnu.org/licenses/gpl-3.0.html. ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_include
include|#
directive|include
file|"qgtk3dialoghelpers.h"
end_include
begin_include
include|#
directive|include
file|<qeventloop.h>
end_include
begin_include
include|#
directive|include
file|<qwindow.h>
end_include
begin_include
include|#
directive|include
file|<qcolor.h>
end_include
begin_include
include|#
directive|include
file|<qdebug.h>
end_include
begin_include
include|#
directive|include
file|<qfont.h>
end_include
begin_include
include|#
directive|include
file|<private/qguiapplication_p.h>
end_include
begin_include
include|#
directive|include
file|<qpa/qplatformfontdatabase.h>
end_include
begin_undef
DECL|macro|signals
undef|#
directive|undef
name|signals
end_undef
begin_include
include|#
directive|include
file|<gtk/gtk.h>
end_include
begin_include
include|#
directive|include
file|<gdk/gdk.h>
end_include
begin_include
include|#
directive|include
file|<gdk/gdkx.h>
end_include
begin_include
include|#
directive|include
file|<pango/pango.h>
end_include
begin_macro
name|QT_BEGIN_NAMESPACE
end_macro
begin_class
DECL|class|QGtk3Dialog
class|class
name|QGtk3Dialog
super|:
specifier|public
name|QWindow
block|{
name|Q_OBJECT
public|public:
name|QGtk3Dialog
parameter_list|(
name|GtkWidget
modifier|*
name|gtkWidget
parameter_list|)
constructor_decl|;
name|~
name|QGtk3Dialog
parameter_list|()
destructor_decl|;
name|GtkDialog
modifier|*
name|gtkDialog
parameter_list|()
specifier|const
function_decl|;
name|void
name|exec
parameter_list|()
function_decl|;
name|bool
name|show
parameter_list|(
name|Qt
operator|::
name|WindowFlags
name|flags
parameter_list|,
name|Qt
operator|::
name|WindowModality
name|modality
parameter_list|,
name|QWindow
modifier|*
name|parent
parameter_list|)
function_decl|;
name|void
name|hide
parameter_list|()
function_decl|;
name|Q_SIGNALS
label|:
name|void
name|accept
parameter_list|()
function_decl|;
name|void
name|reject
parameter_list|()
function_decl|;
protected|protected:
specifier|static
name|void
name|onResponse
parameter_list|(
name|QGtk3Dialog
modifier|*
name|dialog
parameter_list|,
name|int
name|response
parameter_list|)
function_decl|;
private|private
name|slots
private|:
name|void
name|onParentWindowDestroyed
parameter_list|()
function_decl|;
private|private:
DECL|member|gtkWidget
name|GtkWidget
modifier|*
name|gtkWidget
decl_stmt|;
block|}
class|;
end_class
begin_constructor
DECL|function|QGtk3Dialog
name|QGtk3Dialog
operator|::
name|QGtk3Dialog
parameter_list|(
name|GtkWidget
modifier|*
name|gtkWidget
parameter_list|)
member_init_list|:
name|gtkWidget
argument_list|(
name|gtkWidget
argument_list|)
block|{
name|g_signal_connect_swapped
argument_list|(
name|G_OBJECT
argument_list|(
name|gtkWidget
argument_list|)
argument_list|,
literal|"response"
argument_list|,
name|G_CALLBACK
argument_list|(
name|onResponse
argument_list|)
argument_list|,
name|this
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|G_OBJECT
argument_list|(
name|gtkWidget
argument_list|)
argument_list|,
literal|"delete-event"
argument_list|,
name|G_CALLBACK
argument_list|(
name|gtk_widget_hide_on_delete
argument_list|)
argument_list|,
name|NULL
argument_list|)
expr_stmt|;
block|}
end_constructor
begin_destructor
DECL|function|~QGtk3Dialog
name|QGtk3Dialog
operator|::
name|~
name|QGtk3Dialog
parameter_list|()
block|{
name|gtk_clipboard_store
argument_list|(
name|gtk_clipboard_get
argument_list|(
name|GDK_SELECTION_CLIPBOARD
argument_list|)
argument_list|)
expr_stmt|;
name|gtk_widget_destroy
argument_list|(
name|gtkWidget
argument_list|)
expr_stmt|;
block|}
end_destructor
begin_function
DECL|function|gtkDialog
name|GtkDialog
modifier|*
name|QGtk3Dialog
operator|::
name|gtkDialog
parameter_list|()
specifier|const
block|{
return|return
name|GTK_DIALOG
argument_list|(
name|gtkWidget
argument_list|)
return|;
block|}
end_function
begin_function
DECL|function|exec
name|void
name|QGtk3Dialog
operator|::
name|exec
parameter_list|()
block|{
if|if
condition|(
name|modality
argument_list|()
operator|==
name|Qt
operator|::
name|ApplicationModal
condition|)
block|{
comment|// block input to the whole app, including other GTK dialogs
name|gtk_dialog_run
argument_list|(
name|gtkDialog
argument_list|()
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|// block input to the window, allow input to other GTK dialogs
name|QEventLoop
name|loop
decl_stmt|;
name|connect
argument_list|(
name|this
argument_list|,
name|SIGNAL
argument_list|(
name|accept
argument_list|()
argument_list|)
argument_list|,
operator|&
name|loop
argument_list|,
name|SLOT
argument_list|(
name|quit
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|this
argument_list|,
name|SIGNAL
argument_list|(
name|reject
argument_list|()
argument_list|)
argument_list|,
operator|&
name|loop
argument_list|,
name|SLOT
argument_list|(
name|quit
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|loop
operator|.
name|exec
argument_list|()
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|show
name|bool
name|QGtk3Dialog
operator|::
name|show
parameter_list|(
name|Qt
operator|::
name|WindowFlags
name|flags
parameter_list|,
name|Qt
operator|::
name|WindowModality
name|modality
parameter_list|,
name|QWindow
modifier|*
name|parent
parameter_list|)
block|{
name|connect
argument_list|(
name|parent
argument_list|,
operator|&
name|QWindow
operator|::
name|destroyed
argument_list|,
name|this
argument_list|,
operator|&
name|QGtk3Dialog
operator|::
name|onParentWindowDestroyed
argument_list|,
name|Qt
operator|::
name|UniqueConnection
argument_list|)
expr_stmt|;
name|setParent
argument_list|(
name|parent
argument_list|)
expr_stmt|;
name|setFlags
argument_list|(
name|flags
argument_list|)
expr_stmt|;
name|setModality
argument_list|(
name|modality
argument_list|)
expr_stmt|;
name|gtk_widget_realize
argument_list|(
name|gtkWidget
argument_list|)
expr_stmt|;
comment|// creates X window
name|GdkWindow
modifier|*
name|gdkWindow
init|=
name|gtk_widget_get_window
argument_list|(
name|gtkWidget
argument_list|)
decl_stmt|;
if|if
condition|(
name|parent
condition|)
block|{
name|GdkDisplay
modifier|*
name|gdkDisplay
init|=
name|gdk_window_get_display
argument_list|(
name|gdkWindow
argument_list|)
decl_stmt|;
name|XSetTransientForHint
argument_list|(
name|gdk_x11_display_get_xdisplay
argument_list|(
name|gdkDisplay
argument_list|)
argument_list|,
name|gdk_x11_window_get_xid
argument_list|(
name|gdkWindow
argument_list|)
argument_list|,
name|parent
operator|->
name|winId
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|modality
operator|!=
name|Qt
operator|::
name|NonModal
condition|)
block|{
name|gdk_window_set_modal_hint
argument_list|(
name|gdkWindow
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|QGuiApplicationPrivate
operator|::
name|showModalWindow
argument_list|(
name|this
argument_list|)
expr_stmt|;
block|}
name|gtk_widget_show
argument_list|(
name|gtkWidget
argument_list|)
expr_stmt|;
name|gdk_window_focus
argument_list|(
name|gdkWindow
argument_list|,
name|GDK_CURRENT_TIME
argument_list|)
expr_stmt|;
return|return
literal|true
return|;
block|}
end_function
begin_function
DECL|function|hide
name|void
name|QGtk3Dialog
operator|::
name|hide
parameter_list|()
block|{
name|QGuiApplicationPrivate
operator|::
name|hideModalWindow
argument_list|(
name|this
argument_list|)
expr_stmt|;
name|gtk_widget_hide
argument_list|(
name|gtkWidget
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|onResponse
name|void
name|QGtk3Dialog
operator|::
name|onResponse
parameter_list|(
name|QGtk3Dialog
modifier|*
name|dialog
parameter_list|,
name|int
name|response
parameter_list|)
block|{
if|if
condition|(
name|response
operator|==
name|GTK_RESPONSE_OK
condition|)
emit|emit
name|dialog
operator|->
name|accept
argument_list|()
emit|;
else|else
emit|emit
name|dialog
operator|->
name|reject
argument_list|()
emit|;
block|}
end_function
begin_function
DECL|function|onParentWindowDestroyed
name|void
name|QGtk3Dialog
operator|::
name|onParentWindowDestroyed
parameter_list|()
block|{
comment|// The QGtk3*DialogHelper classes own this object. Make sure the parent doesn't delete it.
name|setParent
argument_list|(
literal|0
argument_list|)
expr_stmt|;
block|}
end_function
begin_constructor
DECL|function|QGtk3ColorDialogHelper
name|QGtk3ColorDialogHelper
operator|::
name|QGtk3ColorDialogHelper
parameter_list|()
block|{
name|d
operator|.
name|reset
argument_list|(
operator|new
name|QGtk3Dialog
argument_list|(
name|gtk_color_chooser_dialog_new
argument_list|(
literal|""
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|d
operator|.
name|data
argument_list|()
argument_list|,
name|SIGNAL
argument_list|(
name|accept
argument_list|()
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|onAccepted
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|d
operator|.
name|data
argument_list|()
argument_list|,
name|SIGNAL
argument_list|(
name|reject
argument_list|()
argument_list|)
argument_list|,
name|this
argument_list|,
name|SIGNAL
argument_list|(
name|reject
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect_swapped
argument_list|(
name|d
operator|->
name|gtkDialog
argument_list|()
argument_list|,
literal|"color-activated"
argument_list|,
name|G_CALLBACK
argument_list|(
name|onColorChanged
argument_list|)
argument_list|,
name|this
argument_list|)
expr_stmt|;
block|}
end_constructor
begin_destructor
DECL|function|~QGtk3ColorDialogHelper
name|QGtk3ColorDialogHelper
operator|::
name|~
name|QGtk3ColorDialogHelper
parameter_list|()
block|{ }
end_destructor
begin_function
DECL|function|show
name|bool
name|QGtk3ColorDialogHelper
operator|::
name|show
parameter_list|(
name|Qt
operator|::
name|WindowFlags
name|flags
parameter_list|,
name|Qt
operator|::
name|WindowModality
name|modality
parameter_list|,
name|QWindow
modifier|*
name|parent
parameter_list|)
block|{
name|applyOptions
argument_list|()
expr_stmt|;
return|return
name|d
operator|->
name|show
argument_list|(
name|flags
argument_list|,
name|modality
argument_list|,
name|parent
argument_list|)
return|;
block|}
end_function
begin_function
DECL|function|exec
name|void
name|QGtk3ColorDialogHelper
operator|::
name|exec
parameter_list|()
block|{
name|d
operator|->
name|exec
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|hide
name|void
name|QGtk3ColorDialogHelper
operator|::
name|hide
parameter_list|()
block|{
name|d
operator|->
name|hide
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|setCurrentColor
name|void
name|QGtk3ColorDialogHelper
operator|::
name|setCurrentColor
parameter_list|(
specifier|const
name|QColor
modifier|&
name|color
parameter_list|)
block|{
name|GtkDialog
modifier|*
name|gtkDialog
init|=
name|d
operator|->
name|gtkDialog
argument_list|()
decl_stmt|;
if|if
condition|(
name|color
operator|.
name|alpha
argument_list|()
operator|<
literal|255
condition|)
name|gtk_color_chooser_set_use_alpha
argument_list|(
name|GTK_COLOR_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
name|GdkRGBA
name|gdkColor
decl_stmt|;
name|gdkColor
operator|.
name|red
operator|=
name|color
operator|.
name|redF
argument_list|()
expr_stmt|;
name|gdkColor
operator|.
name|green
operator|=
name|color
operator|.
name|greenF
argument_list|()
expr_stmt|;
name|gdkColor
operator|.
name|blue
operator|=
name|color
operator|.
name|blueF
argument_list|()
expr_stmt|;
name|gdkColor
operator|.
name|alpha
operator|=
name|color
operator|.
name|alphaF
argument_list|()
expr_stmt|;
name|gtk_color_chooser_set_rgba
argument_list|(
name|GTK_COLOR_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
operator|&
name|gdkColor
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|currentColor
name|QColor
name|QGtk3ColorDialogHelper
operator|::
name|currentColor
parameter_list|()
specifier|const
block|{
name|GtkDialog
modifier|*
name|gtkDialog
init|=
name|d
operator|->
name|gtkDialog
argument_list|()
decl_stmt|;
name|GdkRGBA
name|gdkColor
decl_stmt|;
name|gtk_color_chooser_get_rgba
argument_list|(
name|GTK_COLOR_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
operator|&
name|gdkColor
argument_list|)
expr_stmt|;
return|return
name|QColor
operator|::
name|fromRgbF
argument_list|(
name|gdkColor
operator|.
name|red
argument_list|,
name|gdkColor
operator|.
name|green
argument_list|,
name|gdkColor
operator|.
name|blue
argument_list|,
name|gdkColor
operator|.
name|alpha
argument_list|)
return|;
block|}
end_function
begin_function
DECL|function|onAccepted
name|void
name|QGtk3ColorDialogHelper
operator|::
name|onAccepted
parameter_list|()
block|{
emit|emit
name|accept
argument_list|()
emit|;
emit|emit
name|colorSelected
argument_list|(
name|currentColor
argument_list|()
argument_list|)
emit|;
block|}
end_function
begin_function
DECL|function|onColorChanged
name|void
name|QGtk3ColorDialogHelper
operator|::
name|onColorChanged
parameter_list|(
name|QGtk3ColorDialogHelper
modifier|*
name|dialog
parameter_list|)
block|{
emit|emit
name|dialog
operator|->
name|currentColorChanged
argument_list|(
name|dialog
operator|->
name|currentColor
argument_list|()
argument_list|)
emit|;
block|}
end_function
begin_function
DECL|function|applyOptions
name|void
name|QGtk3ColorDialogHelper
operator|::
name|applyOptions
parameter_list|()
block|{
name|GtkDialog
modifier|*
name|gtkDialog
init|=
name|d
operator|->
name|gtkDialog
argument_list|()
decl_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
name|options
argument_list|()
operator|->
name|windowTitle
argument_list|()
operator|.
name|toUtf8
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_color_chooser_set_use_alpha
argument_list|(
name|GTK_COLOR_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
name|options
argument_list|()
operator|->
name|testOption
argument_list|(
name|QColorDialogOptions
operator|::
name|ShowAlphaChannel
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_function
begin_constructor
DECL|function|QGtk3FileDialogHelper
name|QGtk3FileDialogHelper
operator|::
name|QGtk3FileDialogHelper
parameter_list|()
block|{
name|d
operator|.
name|reset
argument_list|(
operator|new
name|QGtk3Dialog
argument_list|(
name|gtk_file_chooser_dialog_new
argument_list|(
literal|""
argument_list|,
literal|0
argument_list|,
name|GTK_FILE_CHOOSER_ACTION_OPEN
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|,
name|GTK_STOCK_OK
argument_list|,
name|GTK_RESPONSE_OK
argument_list|,
name|NULL
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|d
operator|.
name|data
argument_list|()
argument_list|,
name|SIGNAL
argument_list|(
name|accept
argument_list|()
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|onAccepted
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|d
operator|.
name|data
argument_list|()
argument_list|,
name|SIGNAL
argument_list|(
name|reject
argument_list|()
argument_list|)
argument_list|,
name|this
argument_list|,
name|SIGNAL
argument_list|(
name|reject
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|g_signal_connect
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|d
operator|->
name|gtkDialog
argument_list|()
argument_list|)
argument_list|,
literal|"selection-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|onSelectionChanged
argument_list|)
argument_list|,
name|this
argument_list|)
expr_stmt|;
name|g_signal_connect_swapped
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|d
operator|->
name|gtkDialog
argument_list|()
argument_list|)
argument_list|,
literal|"current-folder-changed"
argument_list|,
name|G_CALLBACK
argument_list|(
name|onCurrentFolderChanged
argument_list|)
argument_list|,
name|this
argument_list|)
expr_stmt|;
block|}
end_constructor
begin_destructor
DECL|function|~QGtk3FileDialogHelper
name|QGtk3FileDialogHelper
operator|::
name|~
name|QGtk3FileDialogHelper
parameter_list|()
block|{ }
end_destructor
begin_function
DECL|function|show
name|bool
name|QGtk3FileDialogHelper
operator|::
name|show
parameter_list|(
name|Qt
operator|::
name|WindowFlags
name|flags
parameter_list|,
name|Qt
operator|::
name|WindowModality
name|modality
parameter_list|,
name|QWindow
modifier|*
name|parent
parameter_list|)
block|{
name|_dir
operator|.
name|clear
argument_list|()
expr_stmt|;
name|_selection
operator|.
name|clear
argument_list|()
expr_stmt|;
name|applyOptions
argument_list|()
expr_stmt|;
return|return
name|d
operator|->
name|show
argument_list|(
name|flags
argument_list|,
name|modality
argument_list|,
name|parent
argument_list|)
return|;
block|}
end_function
begin_function
DECL|function|exec
name|void
name|QGtk3FileDialogHelper
operator|::
name|exec
parameter_list|()
block|{
name|d
operator|->
name|exec
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|hide
name|void
name|QGtk3FileDialogHelper
operator|::
name|hide
parameter_list|()
block|{
comment|// After GtkFileChooserDialog has been hidden, gtk_file_chooser_get_current_folder()
comment|//& gtk_file_chooser_get_filenames() will return bogus values -> cache the actual
comment|// values before hiding the dialog
name|_dir
operator|=
name|directory
argument_list|()
expr_stmt|;
name|_selection
operator|=
name|selectedFiles
argument_list|()
expr_stmt|;
name|d
operator|->
name|hide
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|defaultNameFilterDisables
name|bool
name|QGtk3FileDialogHelper
operator|::
name|defaultNameFilterDisables
parameter_list|()
specifier|const
block|{
return|return
literal|false
return|;
block|}
end_function
begin_function
DECL|function|setDirectory
name|void
name|QGtk3FileDialogHelper
operator|::
name|setDirectory
parameter_list|(
specifier|const
name|QUrl
modifier|&
name|directory
parameter_list|)
block|{
name|GtkDialog
modifier|*
name|gtkDialog
init|=
name|d
operator|->
name|gtkDialog
argument_list|()
decl_stmt|;
name|gtk_file_chooser_set_current_folder
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
name|directory
operator|.
name|toLocalFile
argument_list|()
operator|.
name|toUtf8
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|directory
name|QUrl
name|QGtk3FileDialogHelper
operator|::
name|directory
parameter_list|()
specifier|const
block|{
comment|// While GtkFileChooserDialog is hidden, gtk_file_chooser_get_current_folder()
comment|// returns a bogus value -> return the cached value before hiding
if|if
condition|(
operator|!
name|_dir
operator|.
name|isEmpty
argument_list|()
condition|)
return|return
name|_dir
return|;
name|QString
name|ret
decl_stmt|;
name|GtkDialog
modifier|*
name|gtkDialog
init|=
name|d
operator|->
name|gtkDialog
argument_list|()
decl_stmt|;
name|gchar
modifier|*
name|folder
init|=
name|gtk_file_chooser_get_current_folder
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|folder
condition|)
block|{
name|ret
operator|=
name|QString
operator|::
name|fromUtf8
argument_list|(
name|folder
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|folder
argument_list|)
expr_stmt|;
block|}
return|return
name|QUrl
operator|::
name|fromLocalFile
argument_list|(
name|ret
argument_list|)
return|;
block|}
end_function
begin_function
DECL|function|selectFile
name|void
name|QGtk3FileDialogHelper
operator|::
name|selectFile
parameter_list|(
specifier|const
name|QUrl
modifier|&
name|filename
parameter_list|)
block|{
name|GtkDialog
modifier|*
name|gtkDialog
init|=
name|d
operator|->
name|gtkDialog
argument_list|()
decl_stmt|;
if|if
condition|(
name|options
argument_list|()
operator|->
name|acceptMode
argument_list|()
operator|==
name|QFileDialogOptions
operator|::
name|AcceptSave
condition|)
block|{
name|QFileInfo
name|fi
argument_list|(
name|filename
operator|.
name|toLocalFile
argument_list|()
argument_list|)
decl_stmt|;
name|gtk_file_chooser_set_current_folder
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
name|fi
operator|.
name|path
argument_list|()
operator|.
name|toUtf8
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_file_chooser_set_current_name
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
name|fi
operator|.
name|fileName
argument_list|()
operator|.
name|toUtf8
argument_list|()
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|gtk_file_chooser_select_filename
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
name|filename
operator|.
name|toLocalFile
argument_list|()
operator|.
name|toUtf8
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|selectedFiles
name|QList
argument_list|<
name|QUrl
argument_list|>
name|QGtk3FileDialogHelper
operator|::
name|selectedFiles
parameter_list|()
specifier|const
block|{
comment|// While GtkFileChooserDialog is hidden, gtk_file_chooser_get_filenames()
comment|// returns a bogus value -> return the cached value before hiding
if|if
condition|(
operator|!
name|_selection
operator|.
name|isEmpty
argument_list|()
condition|)
return|return
name|_selection
return|;
name|QList
argument_list|<
name|QUrl
argument_list|>
name|selection
decl_stmt|;
name|GtkDialog
modifier|*
name|gtkDialog
init|=
name|d
operator|->
name|gtkDialog
argument_list|()
decl_stmt|;
name|GSList
modifier|*
name|filenames
init|=
name|gtk_file_chooser_get_filenames
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|)
decl_stmt|;
for|for
control|(
name|GSList
modifier|*
name|it
init|=
name|filenames
init|;
name|it
condition|;
name|it
operator|=
name|it
operator|->
name|next
control|)
name|selection
operator|+=
name|QUrl
operator|::
name|fromLocalFile
argument_list|(
name|QString
operator|::
name|fromUtf8
argument_list|(
operator|(
specifier|const
name|char
operator|*
operator|)
name|it
operator|->
name|data
argument_list|)
argument_list|)
expr_stmt|;
name|g_slist_free
argument_list|(
name|filenames
argument_list|)
expr_stmt|;
return|return
name|selection
return|;
block|}
end_function
begin_function
DECL|function|setFilter
name|void
name|QGtk3FileDialogHelper
operator|::
name|setFilter
parameter_list|()
block|{
name|applyOptions
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|selectNameFilter
name|void
name|QGtk3FileDialogHelper
operator|::
name|selectNameFilter
parameter_list|(
specifier|const
name|QString
modifier|&
name|filter
parameter_list|)
block|{
name|GtkFileFilter
modifier|*
name|gtkFilter
init|=
name|_filters
operator|.
name|value
argument_list|(
name|filter
argument_list|)
decl_stmt|;
if|if
condition|(
name|gtkFilter
condition|)
block|{
name|GtkDialog
modifier|*
name|gtkDialog
init|=
name|d
operator|->
name|gtkDialog
argument_list|()
decl_stmt|;
name|gtk_file_chooser_set_filter
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
name|gtkFilter
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|selectedNameFilter
name|QString
name|QGtk3FileDialogHelper
operator|::
name|selectedNameFilter
parameter_list|()
specifier|const
block|{
name|GtkDialog
modifier|*
name|gtkDialog
init|=
name|d
operator|->
name|gtkDialog
argument_list|()
decl_stmt|;
name|GtkFileFilter
modifier|*
name|gtkFilter
init|=
name|gtk_file_chooser_get_filter
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|)
decl_stmt|;
return|return
name|_filterNames
operator|.
name|value
argument_list|(
name|gtkFilter
argument_list|)
return|;
block|}
end_function
begin_function
DECL|function|onAccepted
name|void
name|QGtk3FileDialogHelper
operator|::
name|onAccepted
parameter_list|()
block|{
emit|emit
name|accept
argument_list|()
emit|;
name|QString
name|filter
init|=
name|selectedNameFilter
argument_list|()
decl_stmt|;
if|if
condition|(
name|filter
operator|.
name|isEmpty
argument_list|()
condition|)
emit|emit
name|filterSelected
argument_list|(
name|filter
argument_list|)
emit|;
name|QList
argument_list|<
name|QUrl
argument_list|>
name|files
init|=
name|selectedFiles
argument_list|()
decl_stmt|;
emit|emit
name|filesSelected
argument_list|(
name|files
argument_list|)
emit|;
if|if
condition|(
name|files
operator|.
name|count
argument_list|()
operator|==
literal|1
condition|)
emit|emit
name|fileSelected
argument_list|(
name|files
operator|.
name|first
argument_list|()
argument_list|)
emit|;
block|}
end_function
begin_function
DECL|function|onSelectionChanged
name|void
name|QGtk3FileDialogHelper
operator|::
name|onSelectionChanged
parameter_list|(
name|GtkDialog
modifier|*
name|gtkDialog
parameter_list|,
name|QGtk3FileDialogHelper
modifier|*
name|helper
parameter_list|)
block|{
name|QString
name|selection
decl_stmt|;
name|gchar
modifier|*
name|filename
init|=
name|gtk_file_chooser_get_filename
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
name|filename
condition|)
block|{
name|selection
operator|=
name|QString
operator|::
name|fromUtf8
argument_list|(
name|filename
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|filename
argument_list|)
expr_stmt|;
block|}
emit|emit
name|helper
operator|->
name|currentChanged
argument_list|(
name|QUrl
operator|::
name|fromLocalFile
argument_list|(
name|selection
argument_list|)
argument_list|)
emit|;
block|}
end_function
begin_function
DECL|function|onCurrentFolderChanged
name|void
name|QGtk3FileDialogHelper
operator|::
name|onCurrentFolderChanged
parameter_list|(
name|QGtk3FileDialogHelper
modifier|*
name|dialog
parameter_list|)
block|{
emit|emit
name|dialog
operator|->
name|directoryEntered
argument_list|(
name|dialog
operator|->
name|directory
argument_list|()
argument_list|)
emit|;
block|}
end_function
begin_function
DECL|function|gtkFileChooserAction
specifier|static
name|GtkFileChooserAction
name|gtkFileChooserAction
parameter_list|(
specifier|const
name|QSharedPointer
argument_list|<
name|QFileDialogOptions
argument_list|>
modifier|&
name|options
parameter_list|)
block|{
switch|switch
condition|(
name|options
operator|->
name|fileMode
argument_list|()
condition|)
block|{
case|case
name|QFileDialogOptions
operator|::
name|AnyFile
case|:
case|case
name|QFileDialogOptions
operator|::
name|ExistingFile
case|:
case|case
name|QFileDialogOptions
operator|::
name|ExistingFiles
case|:
if|if
condition|(
name|options
operator|->
name|acceptMode
argument_list|()
operator|==
name|QFileDialogOptions
operator|::
name|AcceptOpen
condition|)
return|return
name|GTK_FILE_CHOOSER_ACTION_OPEN
return|;
else|else
return|return
name|GTK_FILE_CHOOSER_ACTION_SAVE
return|;
case|case
name|QFileDialogOptions
operator|::
name|Directory
case|:
case|case
name|QFileDialogOptions
operator|::
name|DirectoryOnly
case|:
default|default:
if|if
condition|(
name|options
operator|->
name|acceptMode
argument_list|()
operator|==
name|QFileDialogOptions
operator|::
name|AcceptOpen
condition|)
return|return
name|GTK_FILE_CHOOSER_ACTION_SELECT_FOLDER
return|;
else|else
return|return
name|GTK_FILE_CHOOSER_ACTION_CREATE_FOLDER
return|;
block|}
block|}
end_function
begin_function
DECL|function|applyOptions
name|void
name|QGtk3FileDialogHelper
operator|::
name|applyOptions
parameter_list|()
block|{
name|GtkDialog
modifier|*
name|gtkDialog
init|=
name|d
operator|->
name|gtkDialog
argument_list|()
decl_stmt|;
specifier|const
name|QSharedPointer
argument_list|<
name|QFileDialogOptions
argument_list|>
modifier|&
name|opts
init|=
name|options
argument_list|()
decl_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
name|opts
operator|->
name|windowTitle
argument_list|()
operator|.
name|toUtf8
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_file_chooser_set_local_only
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
literal|true
argument_list|)
expr_stmt|;
specifier|const
name|GtkFileChooserAction
name|action
init|=
name|gtkFileChooserAction
argument_list|(
name|opts
argument_list|)
decl_stmt|;
name|gtk_file_chooser_set_action
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
name|action
argument_list|)
expr_stmt|;
specifier|const
name|bool
name|selectMultiple
init|=
name|opts
operator|->
name|fileMode
argument_list|()
operator|==
name|QFileDialogOptions
operator|::
name|ExistingFiles
decl_stmt|;
name|gtk_file_chooser_set_select_multiple
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
name|selectMultiple
argument_list|)
expr_stmt|;
specifier|const
name|bool
name|confirmOverwrite
init|=
operator|!
name|opts
operator|->
name|testOption
argument_list|(
name|QFileDialogOptions
operator|::
name|DontConfirmOverwrite
argument_list|)
decl_stmt|;
name|gtk_file_chooser_set_do_overwrite_confirmation
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
name|confirmOverwrite
argument_list|)
expr_stmt|;
specifier|const
name|QStringList
name|nameFilters
init|=
name|opts
operator|->
name|nameFilters
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|nameFilters
operator|.
name|isEmpty
argument_list|()
condition|)
name|setNameFilters
argument_list|(
name|nameFilters
argument_list|)
expr_stmt|;
if|if
condition|(
name|opts
operator|->
name|initialDirectory
argument_list|()
operator|.
name|isLocalFile
argument_list|()
condition|)
name|setDirectory
argument_list|(
name|opts
operator|->
name|initialDirectory
argument_list|()
argument_list|)
expr_stmt|;
foreach|foreach
control|(
specifier|const
name|QUrl
modifier|&
name|filename
decl|,
name|opts
operator|->
name|initiallySelectedFiles
argument_list|()
control|)
name|selectFile
argument_list|(
name|filename
argument_list|)
expr_stmt|;
specifier|const
name|QString
name|initialNameFilter
init|=
name|opts
operator|->
name|initiallySelectedNameFilter
argument_list|()
decl_stmt|;
if|if
condition|(
operator|!
name|initialNameFilter
operator|.
name|isEmpty
argument_list|()
condition|)
name|selectNameFilter
argument_list|(
name|initialNameFilter
argument_list|)
expr_stmt|;
name|GtkWidget
modifier|*
name|acceptButton
init|=
name|gtk_dialog_get_widget_for_response
argument_list|(
name|gtkDialog
argument_list|,
name|GTK_RESPONSE_OK
argument_list|)
decl_stmt|;
if|if
condition|(
name|acceptButton
condition|)
block|{
if|if
condition|(
name|opts
operator|->
name|isLabelExplicitlySet
argument_list|(
name|QFileDialogOptions
operator|::
name|Accept
argument_list|)
condition|)
name|gtk_button_set_label
argument_list|(
name|GTK_BUTTON
argument_list|(
name|acceptButton
argument_list|)
argument_list|,
name|opts
operator|->
name|labelText
argument_list|(
name|QFileDialogOptions
operator|::
name|Accept
argument_list|)
operator|.
name|toUtf8
argument_list|()
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|opts
operator|->
name|acceptMode
argument_list|()
operator|==
name|QFileDialogOptions
operator|::
name|AcceptOpen
condition|)
name|gtk_button_set_label
argument_list|(
name|GTK_BUTTON
argument_list|(
name|acceptButton
argument_list|)
argument_list|,
name|GTK_STOCK_OPEN
argument_list|)
expr_stmt|;
else|else
name|gtk_button_set_label
argument_list|(
name|GTK_BUTTON
argument_list|(
name|acceptButton
argument_list|)
argument_list|,
name|GTK_STOCK_SAVE
argument_list|)
expr_stmt|;
block|}
name|GtkWidget
modifier|*
name|rejectButton
init|=
name|gtk_dialog_get_widget_for_response
argument_list|(
name|gtkDialog
argument_list|,
name|GTK_RESPONSE_CANCEL
argument_list|)
decl_stmt|;
if|if
condition|(
name|rejectButton
condition|)
block|{
if|if
condition|(
name|opts
operator|->
name|isLabelExplicitlySet
argument_list|(
name|QFileDialogOptions
operator|::
name|Reject
argument_list|)
condition|)
name|gtk_button_set_label
argument_list|(
name|GTK_BUTTON
argument_list|(
name|rejectButton
argument_list|)
argument_list|,
name|opts
operator|->
name|labelText
argument_list|(
name|QFileDialogOptions
operator|::
name|Reject
argument_list|)
operator|.
name|toUtf8
argument_list|()
argument_list|)
expr_stmt|;
else|else
name|gtk_button_set_label
argument_list|(
name|GTK_BUTTON
argument_list|(
name|rejectButton
argument_list|)
argument_list|,
name|GTK_STOCK_CANCEL
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|setNameFilters
name|void
name|QGtk3FileDialogHelper
operator|::
name|setNameFilters
parameter_list|(
specifier|const
name|QStringList
modifier|&
name|filters
parameter_list|)
block|{
name|GtkDialog
modifier|*
name|gtkDialog
init|=
name|d
operator|->
name|gtkDialog
argument_list|()
decl_stmt|;
foreach|foreach
control|(
name|GtkFileFilter
modifier|*
name|filter
decl|,
name|_filters
control|)
name|gtk_file_chooser_remove_filter
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
name|filter
argument_list|)
expr_stmt|;
name|_filters
operator|.
name|clear
argument_list|()
expr_stmt|;
name|_filterNames
operator|.
name|clear
argument_list|()
expr_stmt|;
foreach|foreach
control|(
specifier|const
name|QString
modifier|&
name|filter
decl|,
name|filters
control|)
block|{
name|GtkFileFilter
modifier|*
name|gtkFilter
init|=
name|gtk_file_filter_new
argument_list|()
decl_stmt|;
specifier|const
name|QString
name|name
init|=
name|filter
operator|.
name|left
argument_list|(
name|filter
operator|.
name|indexOf
argument_list|(
name|QLatin1Char
argument_list|(
literal|'('
argument_list|)
argument_list|)
argument_list|)
decl_stmt|;
specifier|const
name|QStringList
name|extensions
init|=
name|cleanFilterList
argument_list|(
name|filter
argument_list|)
decl_stmt|;
name|gtk_file_filter_set_name
argument_list|(
name|gtkFilter
argument_list|,
name|name
operator|.
name|isEmpty
argument_list|()
condition|?
name|extensions
operator|.
name|join
argument_list|(
name|QStringLiteral
argument_list|(
literal|", "
argument_list|)
argument_list|)
operator|.
name|toUtf8
argument_list|()
else|:
name|name
operator|.
name|toUtf8
argument_list|()
argument_list|)
expr_stmt|;
foreach|foreach
control|(
specifier|const
name|QString
modifier|&
name|ext
decl|,
name|extensions
control|)
name|gtk_file_filter_add_pattern
argument_list|(
name|gtkFilter
argument_list|,
name|ext
operator|.
name|toUtf8
argument_list|()
argument_list|)
expr_stmt|;
name|gtk_file_chooser_add_filter
argument_list|(
name|GTK_FILE_CHOOSER
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
name|gtkFilter
argument_list|)
expr_stmt|;
name|_filters
operator|.
name|insert
argument_list|(
name|filter
argument_list|,
name|gtkFilter
argument_list|)
expr_stmt|;
name|_filterNames
operator|.
name|insert
argument_list|(
name|gtkFilter
argument_list|,
name|filter
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_constructor
DECL|function|QGtk3FontDialogHelper
name|QGtk3FontDialogHelper
operator|::
name|QGtk3FontDialogHelper
parameter_list|()
block|{
name|d
operator|.
name|reset
argument_list|(
operator|new
name|QGtk3Dialog
argument_list|(
name|gtk_font_chooser_dialog_new
argument_list|(
literal|""
argument_list|,
literal|0
argument_list|)
argument_list|)
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|d
operator|.
name|data
argument_list|()
argument_list|,
name|SIGNAL
argument_list|(
name|accept
argument_list|()
argument_list|)
argument_list|,
name|this
argument_list|,
name|SLOT
argument_list|(
name|onAccepted
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|connect
argument_list|(
name|d
operator|.
name|data
argument_list|()
argument_list|,
name|SIGNAL
argument_list|(
name|reject
argument_list|()
argument_list|)
argument_list|,
name|this
argument_list|,
name|SIGNAL
argument_list|(
name|reject
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
block|}
end_constructor
begin_destructor
DECL|function|~QGtk3FontDialogHelper
name|QGtk3FontDialogHelper
operator|::
name|~
name|QGtk3FontDialogHelper
parameter_list|()
block|{ }
end_destructor
begin_function
DECL|function|show
name|bool
name|QGtk3FontDialogHelper
operator|::
name|show
parameter_list|(
name|Qt
operator|::
name|WindowFlags
name|flags
parameter_list|,
name|Qt
operator|::
name|WindowModality
name|modality
parameter_list|,
name|QWindow
modifier|*
name|parent
parameter_list|)
block|{
name|applyOptions
argument_list|()
expr_stmt|;
return|return
name|d
operator|->
name|show
argument_list|(
name|flags
argument_list|,
name|modality
argument_list|,
name|parent
argument_list|)
return|;
block|}
end_function
begin_function
DECL|function|exec
name|void
name|QGtk3FontDialogHelper
operator|::
name|exec
parameter_list|()
block|{
name|d
operator|->
name|exec
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|hide
name|void
name|QGtk3FontDialogHelper
operator|::
name|hide
parameter_list|()
block|{
name|d
operator|->
name|hide
argument_list|()
expr_stmt|;
block|}
end_function
begin_function
DECL|function|qt_fontToString
specifier|static
name|QString
name|qt_fontToString
parameter_list|(
specifier|const
name|QFont
modifier|&
name|font
parameter_list|)
block|{
name|PangoFontDescription
modifier|*
name|desc
init|=
name|pango_font_description_new
argument_list|()
decl_stmt|;
name|pango_font_description_set_size
argument_list|(
name|desc
argument_list|,
name|font
operator|.
name|pointSizeF
argument_list|()
operator|*
name|PANGO_SCALE
argument_list|)
expr_stmt|;
name|pango_font_description_set_family
argument_list|(
name|desc
argument_list|,
name|font
operator|.
name|family
argument_list|()
operator|.
name|toUtf8
argument_list|()
argument_list|)
expr_stmt|;
name|int
name|weight
init|=
name|font
operator|.
name|weight
argument_list|()
decl_stmt|;
if|if
condition|(
name|weight
operator|>=
name|QFont
operator|::
name|Black
condition|)
name|pango_font_description_set_weight
argument_list|(
name|desc
argument_list|,
name|PANGO_WEIGHT_HEAVY
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|weight
operator|>=
name|QFont
operator|::
name|ExtraBold
condition|)
name|pango_font_description_set_weight
argument_list|(
name|desc
argument_list|,
name|PANGO_WEIGHT_ULTRABOLD
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|weight
operator|>=
name|QFont
operator|::
name|Bold
condition|)
name|pango_font_description_set_weight
argument_list|(
name|desc
argument_list|,
name|PANGO_WEIGHT_BOLD
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|weight
operator|>=
name|QFont
operator|::
name|DemiBold
condition|)
name|pango_font_description_set_weight
argument_list|(
name|desc
argument_list|,
name|PANGO_WEIGHT_SEMIBOLD
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|weight
operator|>=
name|QFont
operator|::
name|Medium
condition|)
name|pango_font_description_set_weight
argument_list|(
name|desc
argument_list|,
name|PANGO_WEIGHT_MEDIUM
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|weight
operator|>=
name|QFont
operator|::
name|Normal
condition|)
name|pango_font_description_set_weight
argument_list|(
name|desc
argument_list|,
name|PANGO_WEIGHT_NORMAL
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|weight
operator|>=
name|QFont
operator|::
name|Light
condition|)
name|pango_font_description_set_weight
argument_list|(
name|desc
argument_list|,
name|PANGO_WEIGHT_LIGHT
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|weight
operator|>=
name|QFont
operator|::
name|ExtraLight
condition|)
name|pango_font_description_set_weight
argument_list|(
name|desc
argument_list|,
name|PANGO_WEIGHT_ULTRALIGHT
argument_list|)
expr_stmt|;
else|else
name|pango_font_description_set_weight
argument_list|(
name|desc
argument_list|,
name|PANGO_WEIGHT_THIN
argument_list|)
expr_stmt|;
name|int
name|style
init|=
name|font
operator|.
name|style
argument_list|()
decl_stmt|;
if|if
condition|(
name|style
operator|==
name|QFont
operator|::
name|StyleItalic
condition|)
name|pango_font_description_set_style
argument_list|(
name|desc
argument_list|,
name|PANGO_STYLE_ITALIC
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|style
operator|==
name|QFont
operator|::
name|StyleOblique
condition|)
name|pango_font_description_set_style
argument_list|(
name|desc
argument_list|,
name|PANGO_STYLE_OBLIQUE
argument_list|)
expr_stmt|;
else|else
name|pango_font_description_set_style
argument_list|(
name|desc
argument_list|,
name|PANGO_STYLE_NORMAL
argument_list|)
expr_stmt|;
name|char
modifier|*
name|str
init|=
name|pango_font_description_to_string
argument_list|(
name|desc
argument_list|)
decl_stmt|;
name|QString
name|name
init|=
name|QString
operator|::
name|fromUtf8
argument_list|(
name|str
argument_list|)
decl_stmt|;
name|pango_font_description_free
argument_list|(
name|desc
argument_list|)
expr_stmt|;
name|g_free
argument_list|(
name|str
argument_list|)
expr_stmt|;
return|return
name|name
return|;
block|}
end_function
begin_function
DECL|function|qt_fontFromString
specifier|static
name|QFont
name|qt_fontFromString
parameter_list|(
specifier|const
name|QString
modifier|&
name|name
parameter_list|)
block|{
name|QFont
name|font
decl_stmt|;
name|PangoFontDescription
modifier|*
name|desc
init|=
name|pango_font_description_from_string
argument_list|(
name|name
operator|.
name|toUtf8
argument_list|()
argument_list|)
decl_stmt|;
name|font
operator|.
name|setPointSizeF
argument_list|(
cast|static_cast
argument_list|<
name|float
argument_list|>
argument_list|(
name|pango_font_description_get_size
argument_list|(
name|desc
argument_list|)
argument_list|)
operator|/
name|PANGO_SCALE
argument_list|)
expr_stmt|;
name|QString
name|family
init|=
name|QString
operator|::
name|fromUtf8
argument_list|(
name|pango_font_description_get_family
argument_list|(
name|desc
argument_list|)
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|family
operator|.
name|isEmpty
argument_list|()
condition|)
name|font
operator|.
name|setFamily
argument_list|(
name|family
argument_list|)
expr_stmt|;
specifier|const
name|int
name|weight
init|=
name|pango_font_description_get_weight
argument_list|(
name|desc
argument_list|)
decl_stmt|;
name|font
operator|.
name|setWeight
argument_list|(
name|QPlatformFontDatabase
operator|::
name|weightFromInteger
argument_list|(
name|weight
argument_list|)
argument_list|)
expr_stmt|;
name|PangoStyle
name|style
init|=
name|pango_font_description_get_style
argument_list|(
name|desc
argument_list|)
decl_stmt|;
if|if
condition|(
name|style
operator|==
name|PANGO_STYLE_ITALIC
condition|)
name|font
operator|.
name|setStyle
argument_list|(
name|QFont
operator|::
name|StyleItalic
argument_list|)
expr_stmt|;
elseif|else
if|if
condition|(
name|style
operator|==
name|PANGO_STYLE_OBLIQUE
condition|)
name|font
operator|.
name|setStyle
argument_list|(
name|QFont
operator|::
name|StyleOblique
argument_list|)
expr_stmt|;
else|else
name|font
operator|.
name|setStyle
argument_list|(
name|QFont
operator|::
name|StyleNormal
argument_list|)
expr_stmt|;
name|pango_font_description_free
argument_list|(
name|desc
argument_list|)
expr_stmt|;
return|return
name|font
return|;
block|}
end_function
begin_function
DECL|function|setCurrentFont
name|void
name|QGtk3FontDialogHelper
operator|::
name|setCurrentFont
parameter_list|(
specifier|const
name|QFont
modifier|&
name|font
parameter_list|)
block|{
name|GtkFontChooser
modifier|*
name|gtkDialog
init|=
name|GTK_FONT_CHOOSER
argument_list|(
name|d
operator|->
name|gtkDialog
argument_list|()
argument_list|)
decl_stmt|;
name|gtk_font_chooser_set_font
argument_list|(
name|gtkDialog
argument_list|,
name|qt_fontToString
argument_list|(
name|font
argument_list|)
operator|.
name|toUtf8
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|currentFont
name|QFont
name|QGtk3FontDialogHelper
operator|::
name|currentFont
parameter_list|()
specifier|const
block|{
name|GtkFontChooser
modifier|*
name|gtkDialog
init|=
name|GTK_FONT_CHOOSER
argument_list|(
name|d
operator|->
name|gtkDialog
argument_list|()
argument_list|)
decl_stmt|;
name|gchar
modifier|*
name|name
init|=
name|gtk_font_chooser_get_font
argument_list|(
name|gtkDialog
argument_list|)
decl_stmt|;
name|QFont
name|font
init|=
name|qt_fontFromString
argument_list|(
name|QString
operator|::
name|fromUtf8
argument_list|(
name|name
argument_list|)
argument_list|)
decl_stmt|;
name|g_free
argument_list|(
name|name
argument_list|)
expr_stmt|;
return|return
name|font
return|;
block|}
end_function
begin_function
DECL|function|onAccepted
name|void
name|QGtk3FontDialogHelper
operator|::
name|onAccepted
parameter_list|()
block|{
emit|emit
name|currentFontChanged
argument_list|(
name|currentFont
argument_list|()
argument_list|)
emit|;
emit|emit
name|accept
argument_list|()
emit|;
emit|emit
name|fontSelected
argument_list|(
name|currentFont
argument_list|()
argument_list|)
emit|;
block|}
end_function
begin_function
DECL|function|applyOptions
name|void
name|QGtk3FontDialogHelper
operator|::
name|applyOptions
parameter_list|()
block|{
name|GtkDialog
modifier|*
name|gtkDialog
init|=
name|d
operator|->
name|gtkDialog
argument_list|()
decl_stmt|;
specifier|const
name|QSharedPointer
argument_list|<
name|QFontDialogOptions
argument_list|>
modifier|&
name|opts
init|=
name|options
argument_list|()
decl_stmt|;
name|gtk_window_set_title
argument_list|(
name|GTK_WINDOW
argument_list|(
name|gtkDialog
argument_list|)
argument_list|,
name|opts
operator|->
name|windowTitle
argument_list|()
operator|.
name|toUtf8
argument_list|()
argument_list|)
expr_stmt|;
block|}
end_function
begin_macro
name|QT_END_NAMESPACE
end_macro
begin_include
include|#
directive|include
file|"qgtk3dialoghelpers.moc"
end_include
end_unit
