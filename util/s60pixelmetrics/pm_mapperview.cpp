begin_unit
begin_comment
comment|/**************************************************************************** ** ** Copyright (C) 2011 Nokia Corporation and/or its subsidiary(-ies). ** All rights reserved. ** Contact: Nokia Corporation (qt-info@nokia.com) ** ** This file is part of the utility applications of the Qt Toolkit. ** ** $QT_BEGIN_LICENSE:LGPL$ ** GNU Lesser General Public License Usage ** This file may be used under the terms of the GNU Lesser General Public ** License version 2.1 as published by the Free Software Foundation and ** appearing in the file LICENSE.LGPL included in the packaging of this ** file. Please review the following information to ensure the GNU Lesser ** General Public License version 2.1 requirements will be met: ** http://www.gnu.org/licenses/old-licenses/lgpl-2.1.html. ** ** In addition, as a special exception, Nokia gives you certain additional ** rights. These rights are described in the Nokia Qt LGPL Exception ** version 1.1, included in the file LGPL_EXCEPTION.txt in this package. ** ** GNU General Public License Usage ** Alternatively, this file may be used under the terms of the GNU General ** Public License version 3.0 as published by the Free Software Foundation ** and appearing in the file LICENSE.GPL included in the packaging of this ** file. Please review the following information to ensure the GNU General ** Public License version 3.0 requirements will be met: ** http://www.gnu.org/copyleft/gpl.html. ** ** Other Usage ** Alternatively, this file may be used in accordance with the terms and ** conditions contained in a signed written agreement between you and Nokia. ** ** ** ** ** ** $QT_END_LICENSE$ ** ****************************************************************************/
end_comment
begin_comment
comment|// INCLUDE FILES
end_comment
begin_include
include|#
directive|include
file|<eiklabel.h>
end_include
begin_include
include|#
directive|include
file|<avkon.rsg>
end_include
begin_include
include|#
directive|include
file|<aknviewappui.h>
end_include
begin_include
include|#
directive|include
file|<aknconsts.h>
end_include
begin_include
include|#
directive|include
file|"pm_mapper.hrh"
end_include
begin_include
include|#
directive|include
file|<pm_mapper.rsg>
end_include
begin_include
include|#
directive|include
file|"pm_mapperView.h"
end_include
begin_include
include|#
directive|include
file|"pm_mapperApp.h"
end_include
begin_include
include|#
directive|include
file|<aknlists.h>
end_include
begin_include
include|#
directive|include
file|<avkon.hrh>
end_include
begin_include
include|#
directive|include
file|<AknUtils.h>
end_include
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|// C++ constructor can NOT contain any code, that
end_comment
begin_comment
comment|// might leave.
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_constructor
DECL|function|CPixelMetricsMapperViewContainer
name|CPixelMetricsMapperViewContainer
operator|::
name|CPixelMetricsMapperViewContainer
parameter_list|()
member_init_list|:
name|iCount
argument_list|(
literal|1
argument_list|)
block|{     }
end_constructor
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|// Symbian 2nd phase constructor can leave.
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_function
DECL|function|ConstructL
name|void
name|CPixelMetricsMapperViewContainer
operator|::
name|ConstructL
parameter_list|(
specifier|const
name|TRect
modifier|&
name|aRect
parameter_list|)
block|{
name|CreateWindowL
argument_list|()
expr_stmt|;
name|SetCanDrawOutsideRect
argument_list|()
expr_stmt|;
name|iTexts
operator|=
operator|new
operator|(
name|ELeave
operator|)
name|CDesCArrayFlat
argument_list|(
literal|10
argument_list|)
expr_stmt|;
name|iTexts
operator|->
name|AppendL
argument_list|(
name|_L
argument_list|(
literal|"\tStarted."
argument_list|)
argument_list|)
expr_stmt|;
name|iListbox
operator|=
operator|new
operator|(
name|ELeave
operator|)
name|CAknSingleStyleListBox
expr_stmt|;
name|iListbox
operator|->
name|SetContainerWindowL
argument_list|(
operator|*
name|this
argument_list|)
expr_stmt|;
name|iListbox
operator|->
name|ConstructL
argument_list|(
name|this
argument_list|,
name|EAknListBoxViewerFlags
argument_list|)
expr_stmt|;
name|iListbox
operator|->
name|Model
argument_list|()
operator|->
name|SetItemTextArray
argument_list|(
name|iTexts
argument_list|)
expr_stmt|;
name|iListbox
operator|->
name|SetRect
argument_list|(
name|TRect
argument_list|(
name|aRect
operator|.
name|Size
argument_list|()
argument_list|)
argument_list|)
expr_stmt|;
name|iListbox
operator|->
name|CreateScrollBarFrameL
argument_list|(
name|ETrue
argument_list|)
expr_stmt|;
name|iListbox
operator|->
name|ScrollBarFrame
argument_list|()
operator|->
name|SetScrollBarVisibilityL
argument_list|(
name|CEikScrollBarFrame
operator|::
name|EOn
argument_list|,
name|CEikScrollBarFrame
operator|::
name|EOn
argument_list|)
expr_stmt|;
name|SetRect
argument_list|(
name|aRect
argument_list|)
expr_stmt|;
name|iListbox
operator|->
name|ActivateL
argument_list|()
expr_stmt|;
name|ActivateL
argument_list|()
expr_stmt|;
block|}
end_function
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_function
DECL|function|ShowL
name|void
name|CPixelMetricsMapperViewContainer
operator|::
name|ShowL
parameter_list|(
specifier|const
name|TDesC
modifier|&
name|aString
parameter_list|,
name|TBool
modifier|&
name|aLast
parameter_list|,
specifier|const
name|TBool
modifier|&
name|aFileOutput
parameter_list|)
block|{
name|MDesCArray
modifier|*
name|itemList
init|=
name|iListbox
operator|->
name|Model
argument_list|()
operator|->
name|ItemTextArray
argument_list|()
decl_stmt|;
name|CDesCArray
modifier|*
name|itemArray
init|=
operator|(
name|CDesCArray
operator|*
operator|)
name|itemList
decl_stmt|;
name|itemArray
operator|->
name|AppendL
argument_list|(
name|aString
argument_list|)
expr_stmt|;
name|iListbox
operator|->
name|HandleItemAdditionL
argument_list|()
expr_stmt|;
name|iListbox
operator|->
name|SetCurrentItemIndex
argument_list|(
name|iCount
argument_list|)
expr_stmt|;
name|iCount
operator|++
expr_stmt|;
if|if
condition|(
name|aLast
condition|)
block|{
if|if
condition|(
name|aFileOutput
condition|)
block|{
name|RFile
name|file
decl_stmt|;
name|RFs
modifier|&
name|fs
init|=
name|CEikonEnv
operator|::
name|Static
argument_list|()
operator|->
name|FsSession
argument_list|()
decl_stmt|;
name|TFileName
name|fileName
init|=
name|_L
argument_list|(
literal|"Layout_"
argument_list|)
decl_stmt|;
name|TRect
name|screenRect
decl_stmt|;
name|AknLayoutUtils
operator|::
name|LayoutMetricsRect
argument_list|(
name|AknLayoutUtils
operator|::
name|EApplicationWindow
argument_list|,
name|screenRect
argument_list|)
expr_stmt|;
comment|// Add screen dimensions
name|TInt
name|height
init|=
name|screenRect
operator|.
name|Height
argument_list|()
decl_stmt|;
name|TInt
name|width
init|=
name|screenRect
operator|.
name|Width
argument_list|()
decl_stmt|;
name|fileName
operator|.
name|AppendNum
argument_list|(
name|height
argument_list|)
expr_stmt|;
name|fileName
operator|.
name|Append
argument_list|(
literal|'_'
argument_list|)
expr_stmt|;
name|fileName
operator|.
name|AppendNum
argument_list|(
name|width
argument_list|)
expr_stmt|;
name|fileName
operator|.
name|Append
argument_list|(
name|_L
argument_list|(
literal|".txt"
argument_list|)
argument_list|)
expr_stmt|;
name|TInt
name|err
init|=
name|file
operator|.
name|Open
argument_list|(
name|fs
argument_list|,
name|fileName
argument_list|,
name|EFileStreamText
operator||
name|EFileWrite
operator||
name|EFileShareAny
argument_list|)
decl_stmt|;
if|if
condition|(
name|err
operator|==
name|KErrNotFound
condition|)
comment|// file does not exist - create it
name|err
operator|=
name|file
operator|.
name|Create
argument_list|(
name|fs
argument_list|,
name|fileName
argument_list|,
name|EFileStreamText
operator||
name|EFileWrite
operator||
name|EFileShareAny
argument_list|)
expr_stmt|;
else|else
name|file
operator|.
name|SetSize
argument_list|(
literal|0
argument_list|)
expr_stmt|;
comment|//sweep the file
name|TFileText
name|textFile
decl_stmt|;
name|textFile
operator|.
name|Set
argument_list|(
name|file
argument_list|)
expr_stmt|;
name|err
operator|=
name|textFile
operator|.
name|Seek
argument_list|(
name|ESeekStart
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|User
operator|::
name|InfoPrint
argument_list|(
name|_L
argument_list|(
literal|"File corrupted"
argument_list|)
argument_list|)
expr_stmt|;
comment|// Finally loop through all the entries:
name|TInt
name|idx
init|=
literal|0
decl_stmt|;
for|for
control|(
init|;
name|idx
operator|!=
name|itemList
operator|->
name|MdcaCount
argument_list|()
condition|;
name|idx
operator|++
control|)
block|{
name|err
operator|=
name|textFile
operator|.
name|Write
argument_list|(
name|itemList
operator|->
name|MdcaPoint
argument_list|(
name|idx
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|err
condition|)
name|User
operator|::
name|InfoPrint
argument_list|(
name|_L
argument_list|(
literal|"File corrupted"
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|file
operator|.
name|Close
argument_list|()
expr_stmt|;
block|}
name|DrawNow
argument_list|()
expr_stmt|;
block|}
block|}
end_function
begin_function
DECL|function|ClearL
name|void
name|CPixelMetricsMapperViewContainer
operator|::
name|ClearL
parameter_list|()
block|{
name|MDesCArray
modifier|*
name|itemList
init|=
name|iListbox
operator|->
name|Model
argument_list|()
operator|->
name|ItemTextArray
argument_list|()
decl_stmt|;
name|CDesCArray
modifier|*
name|itemArray
init|=
operator|(
name|CDesCArray
operator|*
operator|)
name|itemList
decl_stmt|;
name|itemArray
operator|->
name|Reset
argument_list|()
expr_stmt|;
name|iListbox
operator|->
name|HandleItemAdditionL
argument_list|()
expr_stmt|;
name|iCount
operator|=
literal|0
expr_stmt|;
name|DrawNow
argument_list|()
expr_stmt|;
block|}
end_function
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|// Destructor.
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_destructor
DECL|function|~CPixelMetricsMapperViewContainer
name|CPixelMetricsMapperViewContainer
operator|::
name|~
name|CPixelMetricsMapperViewContainer
parameter_list|()
block|{
operator|delete
name|iListbox
expr_stmt|;
block|}
end_destructor
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_function
DECL|function|SizeChanged
name|void
name|CPixelMetricsMapperViewContainer
operator|::
name|SizeChanged
parameter_list|()
block|{
name|CCoeControl
operator|::
name|SizeChanged
argument_list|()
expr_stmt|;
if|if
condition|(
name|iListbox
condition|)
block|{
name|iListbox
operator|->
name|SetRect
argument_list|(
name|Rect
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_function
DECL|function|CountComponentControls
name|TInt
name|CPixelMetricsMapperViewContainer
operator|::
name|CountComponentControls
parameter_list|()
specifier|const
block|{
return|return
literal|1
return|;
block|}
end_function
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|// CTestAppViewContainer::ComponentControl
end_comment
begin_comment
comment|//
end_comment
begin_comment
comment|//
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_function
DECL|function|ComponentControl
name|CCoeControl
modifier|*
name|CPixelMetricsMapperViewContainer
operator|::
name|ComponentControl
parameter_list|(
name|TInt
comment|/*aIndex*/
parameter_list|)
specifier|const
block|{
return|return
name|iListbox
return|;
block|}
end_function
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_function
DECL|function|Draw
name|void
name|CPixelMetricsMapperViewContainer
operator|::
name|Draw
parameter_list|(
specifier|const
name|TRect
modifier|&
comment|/*aRect*/
parameter_list|)
specifier|const
block|{     }
end_function
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_function
DECL|function|HandleControlEventL
name|void
name|CPixelMetricsMapperViewContainer
operator|::
name|HandleControlEventL
parameter_list|(
name|CCoeControl
modifier|*
comment|/*aControl*/
parameter_list|,
name|TCoeEvent
comment|/*aEventType*/
parameter_list|)
block|{     }
end_function
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_function
DECL|function|OfferKeyEventL
name|TKeyResponse
name|CPixelMetricsMapperViewContainer
operator|::
name|OfferKeyEventL
parameter_list|(
specifier|const
name|TKeyEvent
modifier|&
name|aKeyEvent
parameter_list|,
name|TEventCode
name|aType
parameter_list|)
block|{
if|if
condition|(
name|aKeyEvent
operator|.
name|iCode
operator|==
name|EKeyUpArrow
operator|||
name|aKeyEvent
operator|.
name|iCode
operator|==
name|EKeyDownArrow
condition|)
block|{
return|return
name|iListbox
operator|->
name|OfferKeyEventL
argument_list|(
name|aKeyEvent
argument_list|,
name|aType
argument_list|)
return|;
block|}
return|return
name|EKeyWasNotConsumed
return|;
block|}
end_function
begin_function
DECL|function|HandleResourceChange
name|void
name|CPixelMetricsMapperViewContainer
operator|::
name|HandleResourceChange
parameter_list|(
name|TInt
name|aType
parameter_list|)
block|{
name|CCoeControl
operator|::
name|HandleResourceChange
argument_list|(
name|aType
argument_list|)
expr_stmt|;
if|if
condition|(
name|aType
operator|==
name|KEikDynamicLayoutVariantSwitch
condition|)
block|{
name|TRect
name|mainPaneRect
decl_stmt|;
name|AknLayoutUtils
operator|::
name|LayoutMetricsRect
argument_list|(
name|AknLayoutUtils
operator|::
name|EMainPane
argument_list|,
name|mainPaneRect
argument_list|)
expr_stmt|;
name|SetRect
argument_list|(
name|mainPaneRect
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|iListbox
condition|)
name|iListbox
operator|->
name|HandleResourceChange
argument_list|(
name|aType
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_function
DECL|function|ShowL
name|void
name|CPixelMetricsMapperView
operator|::
name|ShowL
parameter_list|(
specifier|const
name|TDesC
modifier|&
name|aString
parameter_list|,
name|TBool
modifier|&
name|aLast
parameter_list|,
specifier|const
name|TBool
modifier|&
name|aFileOutput
parameter_list|)
block|{
name|iView
operator|->
name|ShowL
argument_list|(
name|aString
argument_list|,
name|aLast
argument_list|,
name|aFileOutput
argument_list|)
expr_stmt|;
block|}
end_function
begin_function
DECL|function|ClearL
name|void
name|CPixelMetricsMapperView
operator|::
name|ClearL
parameter_list|()
block|{
name|iView
operator|->
name|ClearL
argument_list|()
expr_stmt|;
block|}
end_function
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|// Symbian 2nd phase constructor can leave.
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_function
DECL|function|ConstructL
name|void
name|CPixelMetricsMapperView
operator|::
name|ConstructL
parameter_list|()
block|{
name|BaseConstructL
argument_list|(
name|R_PMMAPPER_VIEW
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|// Destructor.
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_destructor
DECL|function|~CPixelMetricsMapperView
name|CPixelMetricsMapperView
operator|::
name|~
name|CPixelMetricsMapperView
parameter_list|()
block|{
if|if
condition|(
name|iView
condition|)
block|{
name|AppUi
argument_list|()
operator|->
name|RemoveFromViewStack
argument_list|(
operator|*
name|this
argument_list|,
name|iView
argument_list|)
expr_stmt|;
block|}
operator|delete
name|iView
expr_stmt|;
block|}
end_destructor
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_function
DECL|function|Id
name|TUid
name|CPixelMetricsMapperView
operator|::
name|Id
parameter_list|()
specifier|const
block|{
return|return
name|TUid
operator|::
name|Uid
argument_list|(
name|EPMMapperViewId
argument_list|)
return|;
block|}
end_function
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_function
DECL|function|HandleCommandL
name|void
name|CPixelMetricsMapperView
operator|::
name|HandleCommandL
parameter_list|(
name|TInt
name|aCommand
parameter_list|)
block|{
name|AppUi
argument_list|()
operator|->
name|HandleCommandL
argument_list|(
name|aCommand
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_function
DECL|function|HandleStatusPaneSizeChange
name|void
name|CPixelMetricsMapperView
operator|::
name|HandleStatusPaneSizeChange
parameter_list|()
block|{
if|if
condition|(
name|iView
condition|)
block|{
name|TRect
name|cr
init|=
name|ClientRect
argument_list|()
decl_stmt|;
name|iView
operator|->
name|SetRect
argument_list|(
name|cr
argument_list|)
expr_stmt|;
block|}
block|}
end_function
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_function
DECL|function|DoActivateL
name|void
name|CPixelMetricsMapperView
operator|::
name|DoActivateL
parameter_list|(
specifier|const
name|TVwsViewId
modifier|&
comment|/*aPrevViewId*/
parameter_list|,
name|TUid
comment|/*aCustomMessageId*/
parameter_list|,
specifier|const
name|TDesC8
modifier|&
comment|/*aCustomMessage*/
parameter_list|)
block|{
name|iView
operator|=
operator|new
operator|(
name|ELeave
operator|)
name|CPixelMetricsMapperViewContainer
expr_stmt|;
name|TRect
name|cr
init|=
name|ClientRect
argument_list|()
decl_stmt|;
name|iView
operator|->
name|ConstructL
argument_list|(
name|cr
argument_list|)
expr_stmt|;
name|AppUi
argument_list|()
operator|->
name|AddToViewStackL
argument_list|(
operator|*
name|this
argument_list|,
name|iView
argument_list|)
expr_stmt|;
block|}
end_function
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_comment
comment|// -----------------------------------------------------------------------------
end_comment
begin_comment
comment|//
end_comment
begin_function
DECL|function|DoDeactivate
name|void
name|CPixelMetricsMapperView
operator|::
name|DoDeactivate
parameter_list|()
block|{
if|if
condition|(
name|iView
condition|)
block|{
name|AppUi
argument_list|()
operator|->
name|RemoveFromViewStack
argument_list|(
operator|*
name|this
argument_list|,
name|iView
argument_list|)
expr_stmt|;
block|}
operator|delete
name|iView
expr_stmt|;
name|iView
operator|=
name|NULL
expr_stmt|;
block|}
end_function
begin_comment
comment|// End of File
end_comment
end_unit
